editor.once('load', function () {
    'use strict';

    // returns skeleton script for a script with the specified url
    editor.method('sourcefiles:skeleton', function (url) {
        var parts = url.split('/');
        // remove .js extension
        var scriptName = parts[parts.length - 1].slice(0, -3).replace(/[\.-]+/g, '_');
        var objectName = scriptName.charAt(0).toUpperCase() + scriptName.slice(1);

        var result = [
            "pc.script.create('" + scriptName + "', function (app) {",
            "    // Creates a new " + objectName + " instance",
            "    var " + objectName + " = function (entity) {",
            "        this.entity = entity;",
            "    };",
            "",
            "    " + objectName + ".prototype = {",
            "        // Called once after all resources are loaded and before the first update",
            "        initialize: function () {",
            "        },",
            "",
            "        // Called every frame, dt is time in seconds since last update",
            "        update: function (dt) {",
            "        }",
            "    };",
            "",
            "    return " + objectName + ";",
            "});"
        ].join('\n');

        return result;
    });

    editor.method('sourcefiles:loadingScreen:skeleton', function () {
        return [
            "pc.script.createLoadingScreen(function (app) {",
            "    var showSplash = function () {",
            "        // splash wrapper",
            "        var wrapper = document.createElement('div');",
            "        wrapper.id = 'application-splash-wrapper';",
            "        document.body.appendChild(wrapper);",
            "",
            "        // splash",
            "        var splash = document.createElement('div');",
            "        splash.id = 'application-splash';",
            "        wrapper.appendChild(splash);",
            "        splash.style.display = 'none';",
            "",
            "        var logo = document.createElement('img');",
            "        logo.src = 'https://s3-eu-west-1.amazonaws.com/static.playcanvas.com/images/play_text_252_white.png';",
            "        splash.appendChild(logo);",
            "        logo.onload = function () {",
            "            splash.style.display = 'block';",
            "        };",
            "",
            "        var container = document.createElement('div');",
            "        container.id = 'progress-bar-container';",
            "        splash.appendChild(container);",
            "",
            "        var bar = document.createElement('div');",
            "        bar.id = 'progress-bar';",
            "        container.appendChild(bar);",
            "",
            "    };",
            "",
            "    var hideSplash = function () {",
            "        var splash = document.getElementById('application-splash-wrapper');",
            "        splash.parentElement.removeChild(splash);",
            "    };",
            "",
            "    var setProgress = function (value) {",
            "        var bar = document.getElementById('progress-bar');",
            "        if(bar) {",
            "            value = Math.min(1, Math.max(0, value));",
            "            bar.style.width = value * 100 + '%';",
            "        }",
            "    };",
            "",
            "    var createCss = function () {",
            "        var css = [",
            "            'body {',",
            "            '    background-color: #283538;',",
            "            '}',",
            "",
            "            '#application-splash-wrapper {',",
            "            '    position: absolute;',",
            "            '    top: 0;',",
            "            '    left: 0;',",
            "            '    height: 100%;',",
            "            '    width: 100%;',",
            "            '    background-color: #283538;',",
            "            '}',",
            "",
            "            '#application-splash {',",
            "            '    position: absolute;',",
            "            '    top: calc(50% - 28px);',",
            "            '    width: 264px;',",
            "            '    left: calc(50% - 132px);',",
            "            '}',",
            "",
            "            '#application-splash img {',",
            "            '    width: 100%;',",
            "            '}',",
            "",
            "            '#progress-bar-container {',",
            "            '    margin: 20px auto 0 auto;',",
            "            '    height: 2px;',",
            "            '    width: 100%;',",
            "            '    background-color: #1d292c;',",
            "            '}',",
            "",
            "            '#progress-bar {',",
            "            '    width: 0%;',",
            "            '    height: 100%;',",
            "            '    background-color: #f60;',",
            "            '}',",
            "            '@media (max-width: 480px) {',",
            "            '    #application-splash {',",
            "            '        width: 170px;',",
            "            '        left: calc(50% - 85px);',",
            "            '    }',",
            "            '}'",
            "        ].join(\"\\n\");",
            "",
            "        var style = document.createElement('style');",
            "        style.type = 'text/css';",
            "        if (style.styleSheet) {",
            "          style.styleSheet.cssText = css;",
            "        } else {",
            "          style.appendChild(document.createTextNode(css));",
            "        }",
            "",
            "        document.head.appendChild(style);",
            "    };",
            "",
            "",
            "    createCss();",
            "",
            "    showSplash();",
            "        ",
            "    app.on('preload:end', function () {",
            "        app.off('preload:progress');",
            "    });",
            "    app.on('preload:progress', setProgress);",
            "    app.on('start', hideSplash);",
            "});"
        ].join('\n');
    });
});
