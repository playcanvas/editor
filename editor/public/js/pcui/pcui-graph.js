!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.pcuiGraph=e():t.pcuiGraph=e()}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=45)}([function(t,e,i){"use strict";(function(t){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}i.d(e,"e",(function(){return r})),i.d(e,"p",(function(){return s})),i.d(e,"a",(function(){return a})),i.d(e,"c",(function(){return o})),i.d(e,"d",(function(){return l})),i.d(e,"o",(function(){return h})),i.d(e,"q",(function(){return c})),i.d(e,"t",(function(){return u})),i.d(e,"i",(function(){return d})),i.d(e,"r",(function(){return f})),i.d(e,"s",(function(){return p})),i.d(e,"k",(function(){return m})),i.d(e,"m",(function(){return g})),i.d(e,"j",(function(){return v})),i.d(e,"l",(function(){return _})),i.d(e,"g",(function(){return y})),i.d(e,"f",(function(){return b})),i.d(e,"h",(function(){return x})),i.d(e,"n",(function(){return w})),i.d(e,"b",(function(){return A}));var r="1.12.0",s="object"==("undefined"==typeof self?"undefined":n(self))&&self.self===self&&self||"object"==(void 0===t?"undefined":n(t))&&t.global===t&&t||Function("return this")()||{},a=Array.prototype,o=Object.prototype,l="undefined"!=typeof Symbol?Symbol.prototype:null,h=a.push,c=a.slice,u=o.toString,d=o.hasOwnProperty,f="undefined"!=typeof ArrayBuffer,p="undefined"!=typeof DataView,m=Array.isArray,g=Object.keys,v=Object.create,_=f&&ArrayBuffer.isView,y=isNaN,b=isFinite,x=!{toString:null}.propertyIsEnumerable("toString"),w=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],A=Math.pow(2,53)-1}).call(this,i(5))},function(t,e,i){var n,r,s;function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/*! JointJS v3.2.0 (2020-06-04) - JavaScript diagramming library


This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/if(function(o,l){"object"==a(e)&&void 0!==t?l(e,i(9),i(8),i(3)):(r=[e,i(9),i(8),i(3)],void 0===(s="function"==typeof(n=l)?n.apply(e,r):n)||(t.exports=s))}(0,(function(t,e,i,n){"use strict";var r,s,o,l;e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i,n=n&&n.hasOwnProperty("default")?n.default:n,Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),n=i.length>>>0;if(0===n)return!1;for(var r,s,a=0|e,o=Math.max(0<=a?a:n-Math.abs(a),0);o<n;){if((r=i[o])===(s=t)||"number"==typeof r&&"number"==typeof s&&isNaN(r)&&isNaN(s))return!0;o++}return!1}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=arguments[1],r=0;r<i;){var s=e[r];if(t.call(n,s,r,e))return s;r++}}}),Array.from||(Array.from=(r=Object.prototype.toString,s=function(t){return"function"==typeof t||"[object Function]"===r.call(t)},o=Math.pow(2,53)-1,l=function(t){var e,i=(e=Number(t),isNaN(e)?0:0!==e&&isFinite(e)?(0<e?1:-1)*Math.floor(Math.abs(e)):e);return Math.min(Math.max(i,0),o)},function(t){var e=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,n=1<arguments.length?arguments[1]:void 0;if(void 0!==n){if(!s(n))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(i=arguments[2])}for(var r,a=l(e.length),o=s(this)?Object(new this(a)):new Array(a),h=0;h<a;)r=e[h],o[h]=n?void 0===i?n(r,h):n.call(i,r,h):r,h+=1;return o.length=a,o})),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=arguments[1],r=0;r<i;){var s=e[r];if(t.call(n,s,r,e))return r;r++}return-1}}),function(){var e=void 0!==t?t:this,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function n(t){this.message=t}(n.prototype=new Error).name="InvalidCharacterError",e.btoa||(e.btoa=function(t){for(var e,r,s=String(t),a=0,o=i,l="";s.charAt(0|a)||(o="=",a%1);l+=o.charAt(63&e>>8-a%1*8)){if(255<(r=s.charCodeAt(a+=.75)))throw new n("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|r}return l}),e.atob||(e.atob=function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new n("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,s,a=0,o=0,l="";s=e.charAt(o++);~s&&(r=a%4?64*r+s:s,a++%4)?l+=String.fromCharCode(255&r>>(-2*a&6)):0)s=i.indexOf(s);return l})}(),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isNaN=Number.isNaN||function(t){return t!=t},String.prototype.includes||(String.prototype.includes=function(t,e){return"number"!=typeof e&&(e=0),!(e+t.length>this.length)&&-1!==this.indexOf(t,e)}),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(e||0,t.length)===t}),function(){function t(t,e){return this.slice(t,e)}function e(t,e){arguments.length<2&&(e=0);for(var i=0,n=t.length;i<n;++i,++e)this[e]=255&t[i]}function i(i){var n;if("number"==typeof i){n=new Array(i);for(var r=0;r<i;++r)n[r]=0}else n=i.slice(0);return n.subarray=t,(n.buffer=n).byteLength=n.length,n.set=e,"object"==a(i)&&i.buffer&&(n.buffer=i.buffer),n}"undefined"==typeof Uint8Array&&"undefined"!=typeof window&&(window.Uint8Array=i,window.Uint32Array=i,window.Int32Array=i)}(),"undefined"!=typeof XMLHttpRequest&&("response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype||Object.defineProperty(XMLHttpRequest.prototype,"response",{get:function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}}));var h=Math,c=h.abs,u=h.cos,d=h.sin,f=h.sqrt,p=h.min,m=h.max,g=h.atan2,v=h.round,_=h.floor,y=h.PI,b=h.pow,x={curveThroughPoints:function(t){return console.warn("deprecated"),new I(w.throughPoints(t)).serialize()},getCurveControlPoints:function(t){console.warn("deprecated");var e,i=[],n=[],r=t.length-1;if(1==r)return i[0]=new S((2*t[0].x+t[1].x)/3,(2*t[0].y+t[1].y)/3),n[0]=new S(2*i[0].x-t[0].x,2*i[0].y-t[0].y),[i,n];var s=[];for(e=1;e<r-1;e++)s[e]=4*t[e].x+2*t[e+1].x;s[0]=t[0].x+2*t[1].x,s[r-1]=(8*t[r-1].x+t[r].x)/2;var a=this.getFirstControlPoints(s);for(e=1;e<r-1;++e)s[e]=4*t[e].y+2*t[e+1].y;s[0]=t[0].y+2*t[1].y,s[r-1]=(8*t[r-1].y+t[r].y)/2;var o=this.getFirstControlPoints(s);for(e=0;e<r;e++)i.push(new S(a[e],o[e])),e<r-1?n.push(new S(2*t[e+1].x-a[e+1],2*t[e+1].y-o[e+1])):n.push(new S((t[r].x+a[r-1])/2,(t[r].y+o[r-1])/2));return[i,n]},getCurveDivider:function(t,e,i,n){console.warn("deprecated");var r=new w(t,e,i,n);return function(t){var e=r.divide(t);return[{p0:e[0].start,p1:e[0].controlPoint1,p2:e[0].controlPoint2,p3:e[0].end},{p0:e[1].start,p1:e[1].controlPoint1,p2:e[1].controlPoint2,p3:e[1].end}]}},getFirstControlPoints:function(t){console.warn("deprecated");var e=t.length,i=[],n=[],r=2;i[0]=t[0]/r;for(var s=1;s<e;s++)n[s]=1/r,r=(s<e-1?4:3.5)-n[s],i[s]=(t[s]-i[s-1])/r;for(s=1;s<e;s++)i[e-s-1]-=n[e-s]*i[e-s];return i},getInversionSolver:function(t,e,i,n){console.warn("deprecated");var r=new w(t,e,i,n);return function(t){return r.closestPointT(t)}}},w=function t(e,i,n,r){return this instanceof t?e instanceof t?new t(e.start,e.controlPoint1,e.controlPoint2,e.end):(this.start=new S(e),this.controlPoint1=new S(i),this.controlPoint2=new S(n),void(this.end=new S(r))):new t(e,i,n,r)};w.throughPoints=function(){function t(t){var e=t.length,i=[],n=[],r=2;i[0]=t[0]/r;for(var s=1;s<e;s++)n[s]=1/r,r=(s<e-1?4:3.5)-n[s],i[s]=(t[s]-i[s-1])/r;for(s=1;s<e;s++)i[e-s-1]-=n[e-s]*i[e-s];return i}return function(e){if(!e||Array.isArray(e)&&e.length<2)throw new Error("At least 2 points are required");for(var i=function(e){var i,n=[],r=[],s=e.length-1;if(1==s)return n[0]=new S((2*e[0].x+e[1].x)/3,(2*e[0].y+e[1].y)/3),r[0]=new S(2*n[0].x-e[0].x,2*n[0].y-e[0].y),[n,r];var a=[];for(i=1;i<s-1;i++)a[i]=4*e[i].x+2*e[i+1].x;a[0]=e[0].x+2*e[1].x,a[s-1]=(8*e[s-1].x+e[s].x)/2;var o=t(a);for(i=1;i<s-1;++i)a[i]=4*e[i].y+2*e[i+1].y;a[0]=e[0].y+2*e[1].y,a[s-1]=(8*e[s-1].y+e[s].y)/2;var l=t(a);for(i=0;i<s;i++)n.push(new S(o[i],l[i])),i<s-1?r.push(new S(2*e[i+1].x-o[i+1],2*e[i+1].y-l[i+1])):r.push(new S((e[s].x+o[s-1])/2,(e[s].y+l[s-1])/2));return[n,r]}(e),n=[],r=i[0].length,s=0;s<r;s++){var a=new S(i[0][s].x,i[0][s].y),o=new S(i[1][s].x,i[1][s].y);n.push(new w(e[s],a,o,e[s+1]))}return n}}(),w.prototype={bbox:function(){for(var t,e,i,n,r,s,a,o,l=this.start,h=this.controlPoint1,u=this.controlPoint2,d=this.end,g=l.x,v=l.y,_=h.x,y=h.y,b=u.x,x=u.y,w=d.x,A=d.y,C=new Array,I=new Array,S=[new Array,new Array],M=0;M<2;++M)if(i=0===M?(e=6*g-12*_+6*b,t=-3*g+9*_-9*b+3*w,3*_-3*g):(e=6*v-12*y+6*x,t=-3*v+9*y-9*x+3*A,3*y-3*v),c(t)<1e-12){if(c(e)<1e-12)continue;0<(n=-i/e)&&n<1&&I.push(n)}else o=f(a=e*e-4*i*t),a<0||(0<(r=(-e+o)/(2*t))&&r<1&&I.push(r),0<(s=(-e-o)/(2*t))&&s<1&&I.push(s));for(var P,E,k,D=I.length,O=D;D--;)E=(P=1-(n=I[D]))*P*P*g+3*P*P*n*_+3*P*n*n*b+n*n*n*w,S[0][D]=E,k=P*P*P*v+3*P*P*n*y+3*P*n*n*x+n*n*n*A,S[1][D]=k,C[D]={X:E,Y:k};I[O]=0,I[O+1]=1,C[O]={X:g,Y:v},C[O+1]={X:w,Y:A},S[0][O]=g,S[1][O]=v,S[0][O+1]=w,S[1][O+1]=A,I.length=O+2,S[0].length=O+2,S[1].length=O+2,C.length=O+2;var R=p.apply(null,S[0]),L=p.apply(null,S[1]),N=m.apply(null,S[0]),z=m.apply(null,S[1]);return new T(R,L,N-R,z-L)},clone:function(){return new w(this.start,this.controlPoint1,this.controlPoint2,this.end)},closestPoint:function(t,e){return this.pointAtT(this.closestPointT(t,e))},closestPointLength:function(t,e){var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,subdivisions:void 0===e.subdivisions?this.getSubdivisions({precision:i}):e.subdivisions};return this.lengthAtT(this.closestPointT(t,n),n)},closestPointNormalizedLength:function(t,e){var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,subdivisions:void 0===e.subdivisions?this.getSubdivisions({precision:i}):e.subdivisions},r=this.closestPointLength(t,n);if(!r)return 0;var s=this.length(n);return 0===s?0:r/s},closestPointT:function(t,e){for(var i,n,r,s,a,o,l,h=void 0===(e=e||{}).precision?this.PRECISION:e.precision,u=void 0===e.subdivisions?this.getSubdivisions({precision:h}):e.subdivisions,d=u.length,f=d?1/d:0,p=0;p<d;p++){var m=u[p],g=m.start.distance(t),v=m.end.distance(t),_=g+v;(!l||_<l)&&(n=p*f,r=(p+1)*f,s=g,a=v,o=(i=m).start.distance(m.end),l=_)}for(var y=b(10,-h);;){var x=s?c(s-a)/s:0,w=a?c(s-a)/a:0;if(x<y||w<y||!s||s<o*y||!a||a<o*y)return s<=a?n:r;var A=i.divide(.5);f/=2;var C=A[0].start.distance(t),I=A[0].end.distance(t),S=C+I,M=A[1].start.distance(t),T=A[1].end.distance(t);a=S<=M+T?(i=A[0],r-=f,s=C,I):(i=A[1],n+=f,s=M,T)}},closestPointTangent:function(t,e){return this.tangentAtT(this.closestPointT(t,e))},containsPoint:function(t,e){return this.toPolyline(e).containsPoint(t)},divideAt:function(t,e){if(t<=0)return this.divideAtT(0);if(1<=t)return this.divideAtT(1);var i=this.tAt(t,e);return this.divideAtT(i)},divideAtLength:function(t,e){var i=this.tAtLength(t,e);return this.divideAtT(i)},divideAtT:function(t){var e=this.start,i=this.controlPoint1,n=this.controlPoint2,r=this.end;if(t<=0)return[new w(e,e,e,e),new w(e,i,n,r)];if(1<=t)return[new w(e,i,n,r),new w(r,r,r,r)];var s=this.getSkeletonPoints(t),a=s.startControlPoint1,o=s.startControlPoint2,l=s.divider,h=s.dividerControlPoint1,c=s.dividerControlPoint2;return[new w(e,a,o,l),new w(l,h,c,r)]},endpointDistance:function(){return this.start.distance(this.end)},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.controlPoint1.x===t.controlPoint1.x&&this.controlPoint1.y===t.controlPoint1.y&&this.controlPoint2.x===t.controlPoint2.x&&this.controlPoint2.y===t.controlPoint2.y&&this.end.x===t.end.x&&this.end.y===t.end.y},getSkeletonPoints:function(t){var e=this.start,i=this.controlPoint1,n=this.controlPoint2,r=this.end;if(t<=0)return{startControlPoint1:e.clone(),startControlPoint2:e.clone(),divider:e.clone(),dividerControlPoint1:i.clone(),dividerControlPoint2:n.clone()};if(1<=t)return{startControlPoint1:i.clone(),startControlPoint2:n.clone(),divider:r.clone(),dividerControlPoint1:r.clone(),dividerControlPoint2:r.clone()};var s=new C(e,i).pointAt(t),a=new C(i,n).pointAt(t),o=new C(n,r).pointAt(t),l=new C(s,a).pointAt(t),h=new C(a,o).pointAt(t);return{startControlPoint1:s,startControlPoint2:l,divider:new C(l,h).pointAt(t),dividerControlPoint1:h,dividerControlPoint2:o}},getSubdivisions:function(t){var e=void 0===(t=t||{}).precision?this.PRECISION:t.precision,i=[new w(this.start,this.controlPoint1,this.controlPoint2,this.end)];if(0===e)return i;for(var n=this.endpointDistance(),r=b(10,-e),s=0;;){s+=1;for(var a=[],o=i.length,l=0;l<o;l++){var h=i[l].divide(.5);a.push(h[0],h[1])}for(var c=0,u=a.length,d=0;d<u;d++)c+=a[d].endpointDistance();if(1<s&&(0!==c?(c-n)/c:0)<r)return a;i=a,n=c}},isDifferentiable:function(){var t=this.start,e=this.controlPoint1,i=this.controlPoint2,n=this.end;return!(t.equals(e)&&e.equals(i)&&i.equals(n))},length:function(t){for(var e=void 0===(t=t||{}).precision?this.PRECISION:t.precision,i=void 0===t.subdivisions?this.getSubdivisions({precision:e}):t.subdivisions,n=0,r=i.length,s=0;s<r;s++)n+=i[s].endpointDistance();return n},lengthAtT:function(t,e){if(t<=0)return 0;var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision;return this.divide(t)[0].length({precision:i})},pointAt:function(t,e){if(t<=0)return this.start.clone();if(1<=t)return this.end.clone();var i=this.tAt(t,e);return this.pointAtT(i)},pointAtLength:function(t,e){var i=this.tAtLength(t,e);return this.pointAtT(i)},pointAtT:function(t){return t<=0?this.start.clone():1<=t?this.end.clone():this.getSkeletonPoints(t).divider},PRECISION:3,scale:function(t,e,i){return this.start.scale(t,e,i),this.controlPoint1.scale(t,e,i),this.controlPoint2.scale(t,e,i),this.end.scale(t,e,i),this},tangentAt:function(t,e){if(!this.isDifferentiable())return null;t<0?t=0:1<t&&(t=1);var i=this.tAt(t,e);return this.tangentAtT(i)},tangentAtLength:function(t,e){if(!this.isDifferentiable())return null;var i=this.tAtLength(t,e);return this.tangentAtT(i)},tangentAtT:function(t){if(!this.isDifferentiable())return null;t<0?t=0:1<t&&(t=1);var e=this.getSkeletonPoints(t),i=e.startControlPoint2,n=e.dividerControlPoint1,r=e.divider,s=new C(i,n);return s.translate(r.x-i.x,r.y-i.y),s},tAt:function(t,e){if(t<=0)return 0;if(1<=t)return 1;var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,subdivisions:void 0===e.subdivisions?this.getSubdivisions({precision:i}):e.subdivisions},r=this.length(n)*t;return this.tAtLength(r,n)},tAtLength:function(t,e){var i=!0;t<0&&(i=!1,t=-t);for(var n,r,s,a,o,l=void 0===(e=e||{}).precision?this.PRECISION:e.precision,h=void 0===e.subdivisions?this.getSubdivisions({precision:l}):e.subdivisions,c={precision:l,subdivisions:h},u=0,d=h.length,f=1/d,p=0;p<d;p++){var m=i?p:d-1-p,g=h[p],v=g.endpointDistance();if(t<=u+v){n=g,r=m*f,s=(m+1)*f,a=i?t-u:v+u-t,o=i?v+u-t:t-u;break}u+=v}if(!n)return i?1:0;for(var _=this.length(c),y=b(10,-l);;){var x,w;if((0!==_?a/_:0)<y)return r;if((0!==_?o/_:0)<y)return s;var A=n.divide(.5);f/=2;var C=A[0].endpointDistance(),I=A[1].endpointDistance();w=a<=C?(n=A[0],s-=f,C-(x=a)):(n=A[1],r+=f,I-(x=a-C)),a=x,o=w}},toPoints:function(t){for(var e=void 0===(t=t||{}).precision?this.PRECISION:t.precision,i=void 0===t.subdivisions?this.getSubdivisions({precision:e}):t.subdivisions,n=[i[0].start.clone()],r=i.length,s=0;s<r;s++){var a=i[s];n.push(a.end.clone())}return n},toPolyline:function(t){return new M(this.toPoints(t))},toString:function(){return this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){return this.start.translate(t,e),this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e),this}},w.prototype.divide=w.prototype.divideAtT;var A=function t(e,i,n){return this instanceof t?e instanceof t?new t(new S(e.x,e.y),e.a,e.b):(e=new S(e),this.x=e.x,this.y=e.y,this.a=i,void(this.b=n)):new t(e,i,n)};A.fromRect=function(t){return t=new T(t),new A(t.center(),t.width/2,t.height/2)},A.prototype={bbox:function(){return new T(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},center:function(){return new S(this.x,this.y)},clone:function(){return new A(this)},containsPoint:function(t){return this.normalizedDistance(t)<=1},equals:function(t){return!!t&&t.x===this.x&&t.y===this.y&&t.a===this.a&&t.b===this.b},inflate:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.a+=2*t,this.b+=2*e,this},intersectionWithLine:function(t){var e=[],i=t.start,n=t.end,r=this.a,s=this.b,a=t.vector(),o=i.difference(new S(this)),l=new S(a.x/(r*r),a.y/(s*s)),h=new S(o.x/(r*r),o.y/(s*s)),c=a.dot(l),u=a.dot(h),d=u*u-c*(o.dot(h)-1);if(d<0)return null;if(0<d){var p=f(d),m=(-u-p)/c,g=(-u+p)/c;if((m<0||1<m)&&(g<0||1<g))return null;0<=m&&m<=1&&e.push(i.lerp(n,m)),0<=g&&g<=1&&e.push(i.lerp(n,g))}else{var v=-u/c;if(!(0<=v&&v<=1))return null;e.push(i.lerp(n,v))}return e},intersectionWithLineFromCenterToPoint:function(t,e){t=new S(t),e&&t.rotate(new S(this.x,this.y),e);var i,n=t.x-this.x,r=t.y-this.y;if(0===n)return i=this.bbox().pointNearestToPoint(t),e?i.rotate(new S(this.x,this.y),-e):i;var s=r/n,a=s*s,o=this.a*this.a,l=this.b*this.b,h=f(1/(1/o+a/l)),c=s*(h=n<0?-h:h);return i=new S(this.x+h,this.y+c),e?i.rotate(new S(this.x,this.y),-e):i},normalizedDistance:function(t){var e=t.x,i=t.y,n=this.a,r=this.b,s=this.x,a=this.y;return(e-s)*(e-s)/(n*n)+(i-a)*(i-a)/(r*r)},tangentTheta:function(t){var e,i,n=t.x,r=t.y,s=this.a,a=this.b,o=this.bbox().center(),l=o.x,h=o.y,c=n>o.x+s/2,u=n<o.x-s/2;return c||u?i=s*s/(n-l)-s*s*(r-h)*((e=n>o.x?r-30:r+30)-h)/(a*a*(n-l))+l:e=a*a/(r-h)-a*a*(n-l)*((i=r>o.y?n+30:n-30)-l)/(s*s*(r-h))+h,new S(i,e).theta(t)},toString:function(){return new S(this.x,this.y).toString()+" "+this.a+" "+this.b}};var C=function t(e,i){return this instanceof t?e instanceof t?new t(e.start,e.end):(this.start=new S(e),void(this.end=new S(i))):new t(e,i)};C.prototype={angle:function(){var t=new S(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,t)},bbox:function(){var t=p(this.start.x,this.end.x),e=p(this.start.y,this.end.y),i=m(this.start.x,this.end.x),n=m(this.start.y,this.end.y);return new T(t,e,i-t,n-e)},bearing:function(){var t=D(this.start.y),e=D(this.end.y),i=this.start.x,n=this.end.x,r=D(n-i),s=d(r)*u(e),a=u(t)*d(e)-d(t)*u(e)*u(r),o=k(g(s,a))-22.5;return o<0&&(o+=360),["NE","E","SE","S","SW","W","NW","N"][o=parseInt(o/45)]},clone:function(){return new C(this.start,this.end)},closestPoint:function(t){return this.pointAt(this.closestPointNormalizedLength(t))},closestPointLength:function(t){return this.closestPointNormalizedLength(t)*this.length()},closestPointNormalizedLength:function(t){var e=this.vector().dot(new C(this.start,t).vector()),i=p(1,m(0,e/this.squaredLength()));return i!=i?0:i},closestPointTangent:function(t){return this.tangentAt(this.closestPointNormalizedLength(t))},containsPoint:function(t){var e=this.start,i=this.end;if(0!==e.cross(t,i))return!1;var n=this.length();return!(new C(e,t).length()>n||new C(t,i).length()>n)},divideAt:function(t){var e=this.pointAt(t);return[new C(this.start,e),new C(e,this.end)]},divideAtLength:function(t){var e=this.pointAtLength(t);return[new C(this.start,e),new C(e,this.end)]},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.end.x===t.end.x&&this.end.y===t.end.y},intersect:function(t,e){if(t instanceof C||t instanceof T||t instanceof M||t instanceof A||t instanceof I){var i=t.intersectionWithLine(this,e);return i&&t instanceof C&&(i=i[0]),i}return null},intersectionWithLine:function(t){var e=new S(this.end.x-this.start.x,this.end.y-this.start.y),i=new S(t.end.x-t.start.x,t.end.y-t.start.y),n=e.x*i.y-e.y*i.x,r=new S(t.start.x-this.start.x,t.start.y-this.start.y),s=r.x*i.y-r.y*i.x,a=r.x*e.y-r.y*e.x;if(0===n||s*n<0||a*n<0)return null;if(0<n){if(n<s||n<a)return null}else if(s<n||a<n)return null;return[new S(this.start.x+s*e.x/n,this.start.y+s*e.y/n)]},isDifferentiable:function(){return!this.start.equals(this.end)},length:function(){return f(this.squaredLength())},midpoint:function(){return new S((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},parallel:function(t){var e=this.clone();if(!this.isDifferentiable())return e;var i=e.start,n=e.end,r=i.clone().rotate(n,270),s=n.clone().rotate(i,90);return i.move(s,t),n.move(r,t),e},pointAt:function(t){var e=this.start,i=this.end;return t<=0?e.clone():1<=t?i.clone():e.lerp(i,t)},pointAtLength:function(t){var e=this.start,i=this.end,n=!0;t<0&&(n=!1,t=-t);var r=this.length();return r<=t?n?i.clone():e.clone():this.pointAt((n?t:r-t)/r)},pointOffset:function(t){t=new S(t);var e=this.start,i=this.end;return((i.x-e.x)*(t.y-e.y)-(i.y-e.y)*(t.x-e.x))/this.length()},rotate:function(t,e){return this.start.rotate(t,e),this.end.rotate(t,e),this},round:function(t){var e=b(10,t||0);return this.start.x=v(this.start.x*e)/e,this.start.y=v(this.start.y*e)/e,this.end.x=v(this.end.x*e)/e,this.end.y=v(this.end.y*e)/e,this},scale:function(t,e,i){return this.start.scale(t,e,i),this.end.scale(t,e,i),this},setLength:function(t){var e=this.length();if(!e)return this;var i=t/e;return this.scale(i,i,this.start)},squaredLength:function(){var t=this.start.x,e=this.start.y;return(t-=this.end.x)*t+(e-=this.end.y)*e},tangentAt:function(t){if(!this.isDifferentiable())return null;var e=this.start,i=this.end,n=this.pointAt(t),r=new C(e,i);return r.translate(n.x-e.x,n.y-e.y),r},tangentAtLength:function(t){if(!this.isDifferentiable())return null;var e=this.start,i=this.end,n=this.pointAtLength(t),r=new C(e,i);return r.translate(n.x-e.x,n.y-e.y),r},toString:function(){return this.start.toString()+" "+this.end.toString()},serialize:function(){return this.start.serialize()+" "+this.end.serialize()},translate:function(t,e){return this.start.translate(t,e),this.end.translate(t,e),this},vector:function(){return new S(this.end.x-this.start.x,this.end.y-this.start.y)}},C.prototype.intersection=C.prototype.intersect;var I=function t(e){if(!(this instanceof t))return new t(e);if("string"==typeof e)return new t.parse(e);var i,n;if(this.segments=[],e)if(Array.isArray(e)&&0!==e.length)if(n=(e=e.reduce((function(t,e){return t.concat(e)}),[])).length,e[0].isSegment)for(i=0;i<n;i++){var r=e[i];this.appendSegment(r)}else{var s=null;for(i=0;i<n;i++){var a=e[i];if(!(a instanceof C||a instanceof w))throw new Error("Cannot construct a path segment from the provided object.");0===i&&this.appendSegment(t.createSegment("M",a.start)),s&&!s.end.equals(a.start)&&this.appendSegment(t.createSegment("M",a.start)),a instanceof C?this.appendSegment(t.createSegment("L",a.end)):a instanceof w&&this.appendSegment(t.createSegment("C",a.controlPoint1,a.controlPoint2,a.end)),s=a}}else if(e.isSegment)this.appendSegment(e);else if(e instanceof C)this.appendSegment(t.createSegment("M",e.start)),this.appendSegment(t.createSegment("L",e.end));else if(e instanceof w)this.appendSegment(t.createSegment("M",e.start)),this.appendSegment(t.createSegment("C",e.controlPoint1,e.controlPoint2,e.end));else{if(!(e instanceof M))throw new Error("Cannot construct a path from the provided object.");if(!e.points||0===e.points.length)return;for(n=e.points.length,i=0;i<n;i++){var o=e.points[i];0===i?this.appendSegment(t.createSegment("M",o)):this.appendSegment(t.createSegment("L",o))}}};I.parse=function(t){if(!t)return new I;for(var e=new I,i=t.match(/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g),n=i.length,r=0;r<n;r++){var s=i[r].match(/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g),a=I.createSegment.apply(this,s);e.appendSegment(a)}return e},I.createSegment=function(t){var e=arguments;if(!t)throw new Error("Type must be provided.");var i=I.segmentTypes[t];if(!i)throw new Error(t+" is not a recognized path segment type.");for(var n=[],r=arguments.length,s=1;s<r;s++)n.push(e[s]);return B(i,n)},I.prototype={appendSegment:function(t){var e,i=this.segments,n=i.length,r=0!==n?i[n-1]:null;if(Array.isArray(t)){if(!(t=t.reduce((function(t,e){return t.concat(e)}),[]))[0].isSegment)throw new Error("Segments required.");for(var s=t.length,a=0;a<s;a++){var o=t[a];e=this.prepareSegment(o,r,null),i.push(e),r=e}}else{if(!t||!t.isSegment)throw new Error("Segment required.");e=this.prepareSegment(t,r,null),i.push(e)}},bbox:function(){var t,e=this.segments,i=e.length;if(0===i)return null;for(var n=0;n<i;n++){var r=e[n];if(r.isVisible){var s=r.bbox();t=t?t.union(s):s}}if(t)return t;var a=e[i-1];return new T(a.end.x,a.end.y,0,0)},clone:function(){for(var t=this.segments,e=t.length,i=new I,n=0;n<e;n++){var r=t[n].clone();i.appendSegment(r)}return i},closestPoint:function(t,e){var i=this.closestPointT(t,e);return i?this.pointAtT(i):null},closestPointLength:function(t,e){var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,segmentSubdivisions:void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions},r=this.closestPointT(t,n);return r?this.lengthAtT(r,n):0},closestPointNormalizedLength:function(t,e){var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,segmentSubdivisions:void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions},r=this.closestPointLength(t,n);if(0===r)return 0;var s=this.length(n);return 0===s?0:r/s},closestPointT:function(t,e){var i=this.segments,n=i.length;if(0===n)return null;for(var r,s=void 0===(e=e||{}).precision?this.PRECISION:e.precision,a=void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,o=1/0,l=0;l<n;l++){var h=i[l],c=a[l];if(h.isVisible){var u=h.closestPointT(t,{precision:s,subdivisions:c}),d=h.pointAtT(u),f=new C(d,t).squaredLength();f<o&&(r={segmentIndex:l,value:u},o=f)}}return r||{segmentIndex:n-1,value:1}},closestPointTangent:function(t,e){var i=this.segments,n=i.length;if(0===n)return null;for(var r,s=void 0===(e=e||{}).precision?this.PRECISION:e.precision,a=void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,o=1/0,l=0;l<n;l++){var h=i[l],c=a[l];if(h.isDifferentiable()){var u=h.closestPointT(t,{precision:s,subdivisions:c}),d=h.pointAtT(u),f=new C(d,t).squaredLength();f<o&&(r=h.tangentAtT(u),o=f)}}return r||null},containsPoint:function(t,e){var i=this.toPolylines(e);if(!i)return!1;for(var n=i.length,r=0,s=0;s<n;s++)i[s].containsPoint(t)&&r++;return r%2==1},divideAt:function(t,e){if(0===this.segments.length)return null;t<0&&(t=0),1<t&&(t=1);var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,segmentSubdivisions:void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions},r=this.length(n)*t;return this.divideAtLength(r,n)},divideAtLength:function(t,e){var i=this.segments.length;if(0===i)return null;var n=!0;t<0&&(n=!1,t=-t);var r,s,a,o,l,h,c,u=void 0===(e=e||{}).precision?this.PRECISION:e.precision,d=void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:u}):e.segmentSubdivisions,f=0;for(r=0;r<i;r++){var p=n?r:i-1-r;s=this.getSegment(p);var m=d[p],g=s.length({precision:u,subdivisions:m});if(s.isDifferentiable()&&(l=s,h=p,t<=f+g)){o=p,a=s.divideAtLength((n?1:-1)*(t-f),{precision:u,subdivisions:m});break}f+=g}if(!l)return null;a||(o=h,c=n?1:0,a=l.divideAtT(c));var v=this.clone();v.replaceSegment(o,a);var _=o,y=o+1,b=o+2;a[0].isDifferentiable()||(v.removeSegment(_),y-=1,b-=1);var x=v.getSegment(y).start;v.insertSegment(y,I.createSegment("M",x)),b+=1,a[1].isDifferentiable()||(v.removeSegment(b-1),b-=1);var w=b-_-1;for(r=b;r<v.segments.length;r++){var A=this.getSegment(r-w);if("Z"===(s=v.getSegment(r)).type&&!A.subpathStartSegment.end.equals(s.subpathStartSegment.end)){var C=I.createSegment("L",A.end);v.replaceSegment(r,C)}}return[new I(v.segments.slice(0,y)),new I(v.segments.slice(y))]},equals:function(t){if(!t)return!1;var e=this.segments,i=t.segments,n=e.length;if(i.length!==n)return!1;for(var r=0;r<n;r++){var s=e[r],a=i[r];if(s.type!==a.type||!s.equals(a))return!1}return!0},getSegment:function(t){var e=this.segments,i=e.length;if(0===i)throw new Error("Path has no segments.");if(t<0&&(t=i+t),i<=t||t<0)throw new Error("Index out of range.");return e[t]},getSegmentSubdivisions:function(t){for(var e=this.segments,i=e.length,n=void 0===(t=t||{}).precision?this.PRECISION:t.precision,r=[],s=0;s<i;s++){var a=e[s].getSubdivisions({precision:n});r.push(a)}return r},insertSegment:function(t,e){var i,n=this.segments,r=n.length;if(t<0&&(t=r+t+1),r<t||t<0)throw new Error("Index out of range.");var s=null,a=null;if(0!==r&&(a=1<=t?(s=n[t-1]).nextSegment:n[0]),Array.isArray(e)){if(!(e=e.reduce((function(t,e){return t.concat(e)}),[]))[0].isSegment)throw new Error("Segments required.");for(var o=e.length,l=0;l<o;l++){var h=e[l];i=this.prepareSegment(h,s,a),n.splice(t+l,0,i),s=i}}else{if(!e||!e.isSegment)throw new Error("Segment required.");i=this.prepareSegment(e,s,a),n.splice(t,0,i)}},intersectionWithLine:function(t,e){var i=null,n=this.toPolylines(e);if(!n)return null;for(var r=0,s=n.length;r<s;r++){var a=n[r],o=t.intersect(a);o&&(i||(i=[]),Array.isArray(o)?Array.prototype.push.apply(i,o):i.push(o))}return i},isDifferentiable:function(){for(var t=this.segments,e=t.length,i=0;i<e;i++)if(t[i].isDifferentiable())return!0;return!1},isValid:function(){var t=this.segments;return 0===t.length||"M"===t[0].type},length:function(t){var e=this.segments,i=e.length;if(0===i)return 0;for(var n=void 0===(t=t||{}).precision?this.PRECISION:t.precision,r=void 0===t.segmentSubdivisions?this.getSegmentSubdivisions({precision:n}):t.segmentSubdivisions,s=0,a=0;a<i;a++){var o=e[a],l=r[a];s+=o.length({subdivisions:l})}return s},lengthAtT:function(t,e){var i=this.segments,n=i.length;if(0===n)return 0;var r=t.segmentIndex;if(r<0)return 0;var s=t.value;n<=r?(r=n-1,s=1):s<0?s=0:1<s&&(s=1);for(var a,o=void 0===(e=e||{}).precision?this.PRECISION:e.precision,l=void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:o}):e.segmentSubdivisions,h=0,c=0;c<r;c++){var u=i[c];a=l[c],h+=u.length({precisison:o,subdivisions:a})}return u=i[r],a=l[r],h+u.lengthAtT(s,{precisison:o,subdivisions:a})},pointAt:function(t,e){if(0===this.segments.length)return null;if(t<=0)return this.start.clone();if(1<=t)return this.end.clone();var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,segmentSubdivisions:void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions},r=this.length(n)*t;return this.pointAtLength(r,n)},pointAtLength:function(t,e){var i=this.segments,n=i.length;if(0===n)return null;if(0===t)return this.start.clone();var r=!0;t<0&&(r=!1,t=-t);for(var s,a=void 0===(e=e||{}).precision?this.PRECISION:e.precision,o=void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:a}):e.segmentSubdivisions,l=0,h=0;h<n;h++){var c=r?h:n-1-h,u=i[c],d=o[c],f=u.length({precision:a,subdivisions:d});if(u.isVisible){if(t<=l+f)return u.pointAtLength((r?1:-1)*(t-l),{precision:a,subdivisions:d});s=u}l+=f}return s?r?s.end:s.start:i[n-1].end.clone()},pointAtT:function(t){var e=this.segments,i=e.length;if(0===i)return null;var n=t.segmentIndex;if(n<0)return e[0].pointAtT(0);if(i<=n)return e[i-1].pointAtT(1);var r=t.value;return r<0?r=0:1<r&&(r=1),e[n].pointAtT(r)},PRECISION:3,prepareSegment:function(t,e,i){t.previousSegment=e,t.nextSegment=i,e&&(e.nextSegment=t),i&&(i.previousSegment=t);var n=t;return t.isSubpathStart&&(t.subpathStartSegment=t,n=i),n&&this.updateSubpathStartSegment(n),t},removeSegment:function(t){var e=this.segments,i=e.length;if(0===i)throw new Error("Path has no segments.");if(t<0&&(t=i+t),i<=t||t<0)throw new Error("Index out of range.");var n=e.splice(t,1)[0],r=n.previousSegment,s=n.nextSegment;r&&(r.nextSegment=s),s&&(s.previousSegment=r),n.isSubpathStart&&s&&this.updateSubpathStartSegment(s)},replaceSegment:function(t,e){var i,n=this.segments,r=n.length;if(0===r)throw new Error("Path has no segments.");if(t<0&&(t=r+t),r<=t||t<0)throw new Error("Index out of range.");var s=n[t],a=s.previousSegment,o=s.nextSegment,l=s.isSubpathStart;if(Array.isArray(e)){if(!(e=e.reduce((function(t,e){return t.concat(e)}),[]))[0].isSegment)throw new Error("Segments required.");n.splice(t,1);for(var h=e.length,c=0;c<h;c++){var u=e[c];i=this.prepareSegment(u,a,o),n.splice(t+c,0,i),a=i,l&&i.isSubpathStart&&(l=!1)}}else{if(!e||!e.isSegment)throw new Error("Segment required.");i=this.prepareSegment(e,a,o),n.splice(t,1,i),l&&i.isSubpathStart&&(l=!1)}l&&o&&this.updateSubpathStartSegment(o)},scale:function(t,e,i){for(var n=this.segments,r=n.length,s=0;s<r;s++)n[s].scale(t,e,i);return this},segmentAt:function(t,e){var i=this.segmentIndexAt(t,e);return i?this.getSegment(i):null},segmentAtLength:function(t,e){var i=this.segmentIndexAtLength(t,e);return i?this.getSegment(i):null},segmentIndexAt:function(t,e){if(0===this.segments.length)return null;t<0&&(t=0),1<t&&(t=1);var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,segmentSubdivisions:void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions},r=this.length(n)*t;return this.segmentIndexAtLength(r,n)},segmentIndexAtLength:function(t,e){var i=this.segments,n=i.length;if(0===n)return null;var r=!0;t<0&&(r=!1,t=-t);for(var s=void 0===(e=e||{}).precision?this.PRECISION:e.precision,a=void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,o=null,l=0,h=0;h<n;h++){var c=r?h:n-1-h,u=i[c],d=a[c],f=u.length({precision:s,subdivisions:d});if(u.isVisible){if(t<=l+f)return c;o=c}l+=f}return o},serialize:function(){if(!this.isValid())throw new Error("Invalid path segments.");return this.toString()},tangentAt:function(t,e){if(0===this.segments.length)return null;t<0&&(t=0),1<t&&(t=1);var i=void 0===(e=e||{}).precision?this.PRECISION:e.precision,n={precision:i,segmentSubdivisions:void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions},r=this.length(n)*t;return this.tangentAtLength(r,n)},tangentAtLength:function(t,e){var i=this.segments,n=i.length;if(0===n)return null;var r=!0;t<0&&(r=!1,t=-t);for(var s,a=void 0===(e=e||{}).precision?this.PRECISION:e.precision,o=void 0===e.segmentSubdivisions?this.getSegmentSubdivisions({precision:a}):e.segmentSubdivisions,l=0,h=0;h<n;h++){var c=r?h:n-1-h,u=i[c],d=o[c],f=u.length({precision:a,subdivisions:d});if(u.isDifferentiable()){if(t<=l+f)return u.tangentAtLength((r?1:-1)*(t-l),{precision:a,subdivisions:d});s=u}l+=f}if(s){var p=r?1:0;return s.tangentAtT(p)}return null},tangentAtT:function(t){var e=this.segments,i=e.length;if(0===i)return null;var n=t.segmentIndex;if(n<0)return e[0].tangentAtT(0);if(i<=n)return e[i-1].tangentAtT(1);var r=t.value;return r<0?r=0:1<r&&(r=1),e[n].tangentAtT(r)},toPoints:function(t){var e=this.segments,i=e.length;if(0===i)return null;for(var n=void 0===(t=t||{}).precision?this.PRECISION:t.precision,r=void 0===t.segmentSubdivisions?this.getSegmentSubdivisions({precision:n}):t.segmentSubdivisions,s=[],a=[],o=0;o<i;o++){var l=e[o];if(l.isVisible){var h=r[o];if(0<h.length){var c=h.map((function(t){return t.start}));Array.prototype.push.apply(a,c)}else a.push(l.start)}else 0<a.length&&(a.push(e[o-1].end),s.push(a),a=[])}return 0<a.length&&(a.push(this.end),s.push(a)),s},toPolylines:function(t){var e=[],i=this.toPoints(t);if(!i)return null;for(var n=0,r=i.length;n<r;n++)e.push(new M(i[n]));return e},toString:function(){for(var t=this.segments,e=t.length,i="",n=0;n<e;n++)i+=t[n].serialize()+" ";return i.trim()},translate:function(t,e){for(var i=this.segments,n=i.length,r=0;r<n;r++)i[r].translate(t,e);return this},updateSubpathStartSegment:function(t){for(var e=t.previousSegment;t&&!t.isSubpathStart;)t.subpathStartSegment=e?e.subpathStartSegment:null,t=(e=t).nextSegment}},Object.defineProperty(I.prototype,"start",{configurable:!0,enumerable:!0,get:function(){var t=this.segments,e=t.length;if(0===e)return null;for(var i=0;i<e;i++){var n=t[i];if(n.isVisible)return n.start}return t[e-1].end}}),Object.defineProperty(I.prototype,"end",{configurable:!0,enumerable:!0,get:function(){var t=this.segments,e=t.length;if(0===e)return null;for(var i=e-1;0<=i;i--){var n=t[i];if(n.isVisible)return n.end}return t[e-1].end}});var S=function t(e,i){if(!(this instanceof t))return new t(e,i);if("string"==typeof e){var n=e.split(-1===e.indexOf("@")?" ":"@");e=parseFloat(n[0]),i=parseFloat(n[1])}else Object(e)===e&&(i=e.y,e=e.x);this.x=void 0===e?0:e,this.y=void 0===i?0:i};S.fromPolar=function(t,e,i){i=i&&new S(i)||new S(0,0);var n=c(t*u(e)),r=c(t*d(e)),s=P(k(e));return s<90?r=-r:s<180?(n=-n,r=-r):s<270&&(n=-n),new S(i.x+n,i.y+r)},S.random=function(t,e,i,n){return new S(O(t,e),O(i,n))},S.prototype={chooseClosest:function(t){var e=t.length;if(1===e)return new S(t[0]);for(var i=null,n=1/0,r=0;r<e;r++){var s=new S(t[r]),a=this.squaredDistance(s);a<n&&(i=s,n=a)}return i},adhereToRect:function(t){return t.containsPoint(this)||(this.x=p(m(this.x,t.x),t.x+t.width),this.y=p(m(this.y,t.y),t.y+t.height)),this},angleBetween:function(t,e){var i=this.equals(t)||this.equals(e)?NaN:this.theta(e)-this.theta(t);return i<0&&(i+=360),i},bearing:function(t){return new C(this,t).bearing()},changeInAngle:function(t,e,i){return this.clone().offset(-t,-e).theta(i)-this.theta(i)},clone:function(){return new S(this)},cross:function(t,e){return t&&e?(e.x-this.x)*(t.y-this.y)-(e.y-this.y)*(t.x-this.x):NaN},difference:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),new S(this.x-(t||0),this.y-(e||0))},distance:function(t){return new C(this,t).length()},dot:function(t){return t?this.x*t.x+this.y*t.y:NaN},equals:function(t){return!!t&&this.x===t.x&&this.y===t.y},lerp:function(t,e){var i=this.x,n=this.y;return new S((1-e)*i+e*t.x,(1-e)*n+e*t.y)},magnitude:function(){return f(this.x*this.x+this.y*this.y)||.01},manhattanDistance:function(t){return c(t.x-this.x)+c(t.y-this.y)},move:function(t,e){var i=D(new S(t).theta(this));return this.offset(u(i)*e,-d(i)*e)},normalize:function(t){var e=(t||1)/this.magnitude();return this.scale(e,e)},offset:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),this.x+=t||0,this.y+=e||0,this},reflection:function(t){return new S(t).move(this,this.distance(t))},rotate:function(t,e){t=t||new S(0,0),e=D(P(-e));var i=u(e),n=d(e),r=i*(this.x-t.x)-n*(this.y-t.y)+t.x,s=n*(this.x-t.x)+i*(this.y-t.y)+t.y;return this.x=r,this.y=s,this},round:function(t){var e=b(10,t||0);return this.x=v(this.x*e)/e,this.y=v(this.y*e)/e,this},scale:function(t,e,i){return i=i&&new S(i)||new S(0,0),this.x=i.x+t*(this.x-i.x),this.y=i.y+e*(this.y-i.y),this},snapToGrid:function(t,e){return this.x=E(this.x,t),this.y=E(this.y,e||t),this},squaredDistance:function(t){return new C(this,t).squaredLength()},theta:function(t){var e=-((t=new S(t)).y-this.y),i=t.x-this.x,n=g(e,i);return n<0&&(n=2*y+n),180*n/y},toJSON:function(){return{x:this.x,y:this.y}},toPolar:function(t){t=t&&new S(t)||new S(0,0);var e=this.x,i=this.y;return this.x=f((e-t.x)*(e-t.x)+(i-t.y)*(i-t.y)),this.y=D(t.theta(new S(e,i))),this},toString:function(){return this.x+"@"+this.y},serialize:function(){return this.x+","+this.y},update:function(t,e){return this.x=t||0,this.y=e||0,this},vectorAngle:function(t){return new S(0,0).angleBetween(this,t)}},S.prototype.translate=S.prototype.offset;var M=function t(e){return this instanceof t?"string"==typeof e?new t.parse(e):void(this.points=Array.isArray(e)?e.map(S):[]):new t(e)};M.parse=function(t){if(""===(t=t.trim()))return new M;for(var e=[],i=t.split(/\s*,\s*|\s+/),n=i.length,r=0;r<n;r+=2)e.push({x:+i[r],y:+i[r+1]});return new M(e)},M.prototype={bbox:function(){var t=1/0,e=-1/0,i=1/0,n=-1/0,r=this.points,s=r.length;if(0===s)return null;for(var a=0;a<s;a++){var o=r[a],l=o.x,h=o.y;l<t&&(t=l),e<l&&(e=l),h<i&&(i=h),n<h&&(n=h)}return new T(t,i,e-t,n-i)},clone:function(){var t=this.points,e=t.length;if(0===e)return new M;for(var i=[],n=0;n<e;n++){var r=t[n].clone();i.push(r)}return new M(i)},closestPoint:function(t){var e=this.closestPointLength(t);return this.pointAtLength(e)},closestPointLength:function(t){var e,i=this.points,n=i.length;if(0===n)return 0;if(1===n)return 0;for(var r=1/0,s=0,a=n-1,o=0;o<a;o++){var l=new C(i[o],i[o+1]),h=l.length(),c=l.closestPointNormalizedLength(t),u=l.pointAt(c).squaredDistance(t);u<r&&(r=u,e=s+c*h),s+=h}return e},closestPointNormalizedLength:function(t){var e=this.closestPointLength(t);if(0===e)return 0;var i=this.length();return 0===i?0:e/i},closestPointTangent:function(t){var e=this.closestPointLength(t);return this.tangentAtLength(e)},containsPoint:function(t){var e=this.points,i=e.length;if(0===i)return!1;for(var n=t.x,r=t.y,s=i-1,a=0,o=0;a<i;a++){var l=e[s],h=e[a];if(t.equals(l))return!0;var c=new C(l,h);if(c.containsPoint(t))return!0;if(r<=l.y&&r>h.y||r>l.y&&r<=h.y){var u=l.x-n>h.x-n?l.x-n:h.x-n;if(0<=u){var d=new S(n+u,r),f=new C(t,d);c.intersect(f)&&o++}}s=a}return o%2==1},convexHull:function(){var t,e,i,n=this.points,r=n.length;if(0===r)return new M;for(t=0;t<r;t++)(void 0===i||n[t].y<i.y||n[t].y===i.y&&n[t].x>i.x)&&(i=n[t]);var s=[];for(t=0;t<r;t++){var a=i.theta(n[t]);0===a&&(a=360);var o=[n[t],t,a];s.push(o)}if(s.sort((function(t,e){var i=t[2]-e[2];return 0===i&&(i=e[1]-t[1]),i})),2<s.length){var l=s[s.length-1];s.unshift(l)}for(var h,u,d,f,p,m,g,v={},_=[];0!==s.length;)if(u=(h=s.pop())[0],!v.hasOwnProperty(h[0]+"@@"+h[1]))for(var y=!1;!y;)if(_.length<2)_.push(h),y=!0;else{f=(d=_.pop())[0];var b=(m=(p=_.pop())[0]).cross(f,u);if(b<0)_.push(p),_.push(d),_.push(h),y=!0;else if(0===b){var x=f.angleBetween(m,u);c(x-180)<1e-10||f.equals(u)||m.equals(f)?(v[d[0]+"@@"+d[1]]=f,_.push(p)):c((x+1)%360-1)<1e-10&&(_.push(p),s.push(d))}else v[d[0]+"@@"+d[1]]=f,_.push(p)}2<_.length&&_.pop();var w=-1;for(e=_.length,t=0;t<e;t++){var A=_[t][1];(void 0===g||A<g)&&(g=A,w=t)}var C=[];if(0<w){var I=_.slice(w),S=_.slice(0,w);C=I.concat(S)}else C=_;var T=[];for(e=C.length,t=0;t<e;t++)T.push(C[t][0]);return new M(T)},equals:function(t){if(!t)return!1;var e=this.points,i=t.points,n=e.length;if(i.length!==n)return!1;for(var r=0;r<n;r++){var s=e[r],a=t.points[r];if(!s.equals(a))return!1}return!0},intersectionWithLine:function(t){for(var e=new C(t),i=[],n=this.points,r=0,s=n.length-1;r<s;r++){var a=n[r],o=n[r+1],l=new C(a,o),h=e.intersectionWithLine(l);h&&i.push(h[0])}return 0<i.length?i:null},isDifferentiable:function(){var t=this.points,e=t.length;if(0===e)return!1;for(var i=e-1,n=0;n<i;n++){var r=t[n],s=t[n+1];if(new C(r,s).isDifferentiable())return!0}return!1},length:function(){var t=this.points,e=t.length;if(0===e)return 0;for(var i=0,n=e-1,r=0;r<n;r++)i+=t[r].distance(t[r+1]);return i},pointAt:function(t){var e=this.points,i=e.length;if(0===i)return null;if(1===i)return e[0].clone();if(t<=0)return e[0].clone();if(1<=t)return e[i-1].clone();var n=this.length()*t;return this.pointAtLength(n)},pointAtLength:function(t){var e=this.points,i=e.length;if(0===i)return null;if(1===i)return e[0].clone();var n=!0;t<0&&(n=!1,t=-t);for(var r=0,s=i-1,a=0;a<s;a++){var o=n?a:s-1-a,l=e[o],h=e[o+1],c=new C(l,h),u=l.distance(h);if(t<=r+u)return c.pointAtLength((n?1:-1)*(t-r));r+=u}return(n?e[i-1]:e[0]).clone()},scale:function(t,e,i){var n=this.points,r=n.length;if(0===r)return this;for(var s=0;s<r;s++)n[s].scale(t,e,i);return this},simplify:function(t){void 0===t&&(t={});var e=this.points;if(e.length<3)return this;for(var i=t.threshold||0,n=0;e[n+2];){var r=n+1,s=n+2,a=e[n],o=e[r],l=e[s];new C(a,l).closestPoint(o).distance(o)<=i?e.splice(r,1):n+=1}return this},tangentAt:function(t){var e=this.points.length;if(0===e)return null;if(1===e)return null;t<0&&(t=0),1<t&&(t=1);var i=this.length()*t;return this.tangentAtLength(i)},tangentAtLength:function(t){var e=this.points,i=e.length;if(0===i)return null;if(1===i)return null;var n,r=!0;t<0&&(r=!1,t=-t);for(var s=0,a=i-1,o=0;o<a;o++){var l=r?o:a-1-o,h=e[l],c=e[l+1],u=new C(h,c),d=h.distance(c);if(u.isDifferentiable()){if(t<=s+d)return u.tangentAtLength((r?1:-1)*(t-s));n=u}s+=d}if(n){var f=r?1:0;return n.tangentAt(f)}return null},toString:function(){return this.points+""},translate:function(t,e){var i=this.points,n=i.length;if(0===n)return this;for(var r=0;r<n;r++)i[r].translate(t,e);return this},serialize:function(){var t=this.points,e=t.length;if(0===e)return"";for(var i="",n=0;n<e;n++){var r=t[n];i+=r.x+","+r.y+" "}return i.trim()}},Object.defineProperty(M.prototype,"start",{configurable:!0,enumerable:!0,get:function(){return 0===this.points.length?null:this.points[0]}}),Object.defineProperty(M.prototype,"end",{configurable:!0,enumerable:!0,get:function(){var t=this.points.length;return 0===t?null:this.points[t-1]}});var T=function t(e,i,n,r){if(!(this instanceof t))return new t(e,i,n,r);Object(e)===e&&(i=e.y,n=e.width,r=e.height,e=e.x),this.x=void 0===e?0:e,this.y=void 0===i?0:i,this.width=void 0===n?0:n,this.height=void 0===r?0:r};T.fromEllipse=function(t){return t=new A(t),new T(t.x-t.a,t.y-t.b,2*t.a,2*t.b)},T.prototype={bbox:function(t){if(!t)return this.clone();var e=D(t),i=c(d(e)),n=c(u(e)),r=this.width*n+this.height*i,s=this.width*i+this.height*n;return new T(this.x+(this.width-r)/2,this.y+(this.height-s)/2,r,s)},bottomLeft:function(){return new S(this.x,this.y+this.height)},bottomLine:function(){return new C(this.bottomLeft(),this.bottomRight())},bottomMiddle:function(){return new S(this.x+this.width/2,this.y+this.height)},center:function(){return new S(this.x+this.width/2,this.y+this.height/2)},clone:function(){return new T(this)},containsPoint:function(t){return(t=new S(t)).x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height},containsRect:function(t){var e=new T(this).normalize(),i=new T(t).normalize(),n=e.width,r=e.height,s=i.width,a=i.height;if(!(n&&r&&s&&a))return!1;var o=e.x,l=e.y,h=i.x,c=i.y;return s+=h,n+=o,a+=c,r+=l,o<=h&&s<=n&&l<=c&&a<=r},corner:function(){return new S(this.x+this.width,this.y+this.height)},equals:function(t){var e=new T(this).normalize(),i=new T(t).normalize();return e.x===i.x&&e.y===i.y&&e.width===i.width&&e.height===i.height},inflate:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},intersect:function(t){var e=this.origin(),i=this.corner(),n=t.origin(),r=t.corner();if(r.x<=e.x||r.y<=e.y||n.x>=i.x||n.y>=i.y)return null;var s=m(e.x,n.x),a=m(e.y,n.y);return new T(s,a,p(i.x,r.x)-s,p(i.y,r.y)-a)},intersectionWithLine:function(t){var e,i,n=[this.topLine(),this.rightLine(),this.bottomLine(),this.leftLine()],r=[],s=[],a=n.length;for(i=0;i<a;i++)null!==(e=t.intersect(n[i]))&&s.indexOf(e.toString())<0&&(r.push(e),s.push(e.toString()));return 0<r.length?r:null},intersectionWithLineFromCenterToPoint:function(t,e){t=new S(t);var i,n=new S(this.x+this.width/2,this.y+this.height/2);e&&t.rotate(n,e);for(var r=[this.topLine(),this.rightLine(),this.bottomLine(),this.leftLine()],s=new C(n,t),a=r.length-1;0<=a;--a){var o=r[a].intersection(s);if(null!==o){i=o;break}}return i&&e&&i.rotate(n,-e),i},leftLine:function(){return new C(this.topLeft(),this.bottomLeft())},leftMiddle:function(){return new S(this.x,this.y+this.height/2)},maxRectScaleToFit:function(t,e){var i,n,r,s,a,o,l,h;t=new T(t),e||(e=t.center());var c=e.x,u=e.y;i=n=r=s=a=o=l=h=1/0;var d=t.topLeft();d.x<c&&(i=(this.x-c)/(d.x-c)),d.y<u&&(a=(this.y-u)/(d.y-u));var f=t.bottomRight();f.x>c&&(n=(this.x+this.width-c)/(f.x-c)),f.y>u&&(o=(this.y+this.height-u)/(f.y-u));var m=t.topRight();m.x>c&&(r=(this.x+this.width-c)/(m.x-c)),m.y<u&&(l=(this.y-u)/(m.y-u));var g=t.bottomLeft();return g.x<c&&(s=(this.x-c)/(g.x-c)),g.y>u&&(h=(this.y+this.height-u)/(g.y-u)),{sx:p(i,n,r,s),sy:p(a,o,l,h)}},maxRectUniformScaleToFit:function(t,e){var i=this.maxRectScaleToFit(t,e);return p(i.sx,i.sy)},moveAndExpand:function(t){return this.x+=t.x||0,this.y+=t.y||0,this.width+=t.width||0,this.height+=t.height||0,this},normalize:function(){var t=this.x,e=this.y,i=this.width,n=this.height;return this.width<0&&(t=this.x+this.width,i=-this.width),this.height<0&&(e=this.y+this.height,n=-this.height),this.x=t,this.y=e,this.width=i,this.height=n,this},offset:function(t,e){return S.prototype.offset.call(this,t,e)},origin:function(){return new S(this.x,this.y)},pointNearestToPoint:function(t){if(t=new S(t),this.containsPoint(t))switch(this.sideNearestToPoint(t)){case"right":return new S(this.x+this.width,t.y);case"left":return new S(this.x,t.y);case"bottom":return new S(t.x,this.y+this.height);case"top":return new S(t.x,this.y)}return t.adhereToRect(this)},rightLine:function(){return new C(this.topRight(),this.bottomRight())},rightMiddle:function(){return new S(this.x+this.width,this.y+this.height/2)},round:function(t){var e=b(10,t||0);return this.x=v(this.x*e)/e,this.y=v(this.y*e)/e,this.width=v(this.width*e)/e,this.height=v(this.height*e)/e,this},scale:function(t,e,i){return i=this.origin().scale(t,e,i),this.x=i.x,this.y=i.y,this.width*=t,this.height*=e,this},sideNearestToPoint:function(t){var e=(t=new S(t)).x-this.x,i=this.x+this.width-t.x,n=t.y-this.y,r=e,s="left";return i<r&&(r=i,s="right"),n<r&&(r=n,s="top"),this.y+this.height-t.y<r&&(s="bottom"),s},snapToGrid:function(t,e){var i=this.origin().snapToGrid(t,e),n=this.corner().snapToGrid(t,e);return this.x=i.x,this.y=i.y,this.width=n.x-i.x,this.height=n.y-i.y,this},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},topLine:function(){return new C(this.topLeft(),this.topRight())},topMiddle:function(){return new S(this.x+this.width/2,this.y)},topRight:function(){return new S(this.x+this.width,this.y)},toString:function(){return this.origin().toString()+" "+this.corner().toString()},union:function(t){var e=new T(t),i=this.x,n=this.y,r=this.width,s=this.height,a=e.x,o=e.y,l=e.width,h=e.height,c=e.x=p(i,a),u=e.y=p(n,o);return e.width=m(i+r,a+l)-c,e.height=m(n+s,o+h)-u,e}},T.prototype.bottomRight=T.prototype.corner,T.prototype.topLeft=T.prototype.origin,T.prototype.translate=T.prototype.offset;var P=function(t){return t%360+(t<0?360:0)},E=function(t,e){return e*v(t/e)},k=function(t){return 180*t/y%360},D=function(t,e){return(t=(e=e||!1)?t:t%360)*y/180},O=function(t,e){if(void 0===e)e=void 0===t?1:t,t=0;else if(e<t){var i=t;t=e,e=i}return _(h.random()*(e-t+1)+t)},R=A,L=C,N=S,z=T;function B(t,e){return e.unshift(null),new(Function.prototype.bind.apply(t,e))}function F(t){var e,i,n=arguments,r=[];for(i=arguments.length,e=1;e<i;e++)r.push(n[e]);if(!t)throw new Error("Missing a parent object.");var s=Object.create(t);for(i=r.length,e=0;e<i;e++){var a,o,l=r[e];for(o in l)l.hasOwnProperty(o)&&(delete s[o],a=Object.getOwnPropertyDescriptor(l,o),Object.defineProperty(s,o,a))}return s}var j={bbox:function(){throw new Error("Declaration missing for virtual function.")},clone:function(){throw new Error("Declaration missing for virtual function.")},closestPoint:function(){throw new Error("Declaration missing for virtual function.")},closestPointLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointNormalizedLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointT:function(t){if(this.closestPointNormalizedLength)return this.closestPointNormalizedLength(t);throw new Error("Neither closestPointT() nor closestPointNormalizedLength() function is implemented.")},closestPointTangent:function(){throw new Error("Declaration missing for virtual function.")},divideAt:function(){throw new Error("Declaration missing for virtual function.")},divideAtLength:function(){throw new Error("Declaration missing for virtual function.")},divideAtT:function(t){if(this.divideAt)return this.divideAt(t);throw new Error("Neither divideAtT() nor divideAt() function is implemented.")},equals:function(){throw new Error("Declaration missing for virtual function.")},getSubdivisions:function(){throw new Error("Declaration missing for virtual function.")},isDifferentiable:function(){throw new Error("Declaration missing for virtual function.")},isSegment:!0,isSubpathStart:!1,isVisible:!0,length:function(){throw new Error("Declaration missing for virtual function.")},lengthAtT:function(t){if(t<=0)return 0;var e=this.length();return 1<=t?e:e*t},nextSegment:null,pointAt:function(){throw new Error("Declaration missing for virtual function.")},pointAtLength:function(){throw new Error("Declaration missing for virtual function.")},pointAtT:function(t){if(this.pointAt)return this.pointAt(t);throw new Error("Neither pointAtT() nor pointAt() function is implemented.")},previousSegment:null,subpathStartSegment:null,scale:function(){throw new Error("Declaration missing for virtual function.")},serialize:function(){throw new Error("Declaration missing for virtual function.")},tangentAt:function(){throw new Error("Declaration missing for virtual function.")},tangentAtLength:function(){throw new Error("Declaration missing for virtual function.")},tangentAtT:function(t){if(this.tangentAt)return this.tangentAt(t);throw new Error("Neither tangentAtT() nor tangentAt() function is implemented.")},toString:function(){throw new Error("Declaration missing for virtual function.")},translate:function(){throw new Error("Declaration missing for virtual function.")}};Object.defineProperty(j,"end",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(j,"start",{configurable:!0,enumerable:!0,get:function(){if(!this.previousSegment)throw new Error("Missing previous segment. (This segment cannot be the first segment of a path; OR segment has not yet been added to a path.)");return this.previousSegment.end}}),Object.defineProperty(j,"type",{configurable:!0,enumerable:!0,get:function(){throw new Error("Bad segment declaration. No type specified.")}});var V=function t(){for(var e,i,n=arguments,r=[],s=arguments.length,a=0;a<s;a++)r.push(n[a]);if(!(this instanceof t))return B(t,r);if(0===s)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates (none provided).");if(r[0]instanceof C){if(1===s)return this.end=r[0].end.clone(),this;throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+s+" lines provided).")}if("string"==typeof r[0]||"number"==typeof r[0]){if(2===s)return this.end=new S(+r[0],+r[1]),this;if(s<2)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+s+" coordinates provided).");var o;for(e=[],a=0;a<s;a+=2)o=r.slice(a,a+2),e.push(B(t,o));return e}if(1===s)return this.end=new S(r[0]),this;for(e=[],a=0;a<s;a+=1)i=r[a],e.push(new t(i));return e},U={clone:function(){return new V(this.end)},divideAt:function(t){var e=new C(this.start,this.end).divideAt(t);return[new V(e[0]),new V(e[1])]},divideAtLength:function(t){var e=new C(this.start,this.end).divideAtLength(t);return[new V(e[0]),new V(e[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return!!this.previousSegment&&!this.start.equals(this.end)},scale:function(t,e,i){return this.end.scale(t,e,i),this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(t,e){return this.end.translate(t,e),this}};Object.defineProperty(U,"type",{configurable:!0,enumerable:!0,value:"L"}),V.prototype=F(j,C.prototype,U);var G=function t(){for(var e,i,n=arguments,r=[],s=arguments.length,a=0;a<s;a++)r.push(n[a]);if(!(this instanceof t))return B(t,r);if(0===s)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates (none provided).");if(r[0]instanceof w){if(1===s)return this.controlPoint1=r[0].controlPoint1.clone(),this.controlPoint2=r[0].controlPoint2.clone(),this.end=r[0].end.clone(),this;throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+s+" curves provided).")}if("string"==typeof r[0]||"number"==typeof r[0]){if(6===s)return this.controlPoint1=new S(+r[0],+r[1]),this.controlPoint2=new S(+r[2],+r[3]),this.end=new S(+r[4],+r[5]),this;if(s<6)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+s+" coordinates provided).");var o;for(e=[],a=0;a<s;a+=6)o=r.slice(a,a+6),e.push(B(t,o));return e}if(3===s)return this.controlPoint1=new S(r[0]),this.controlPoint2=new S(r[1]),this.end=new S(r[2]),this;if(s<3)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+s+" points provided).");for(e=[],a=0;a<s;a+=3)i=r.slice(a,a+3),e.push(B(t,i));return e},W={clone:function(){return new G(this.controlPoint1,this.controlPoint2,this.end)},divideAt:function(t,e){var i=new w(this.start,this.controlPoint1,this.controlPoint2,this.end).divideAt(t,e);return[new G(i[0]),new G(i[1])]},divideAtLength:function(t,e){var i=new w(this.start,this.controlPoint1,this.controlPoint2,this.end).divideAtLength(t,e);return[new G(i[0]),new G(i[1])]},divideAtT:function(t){var e=new w(this.start,this.controlPoint1,this.controlPoint2,this.end).divideAtT(t);return[new G(e[0]),new G(e[1])]},isDifferentiable:function(){if(!this.previousSegment)return!1;var t=this.start,e=this.controlPoint1,i=this.controlPoint2,n=this.end;return!(t.equals(e)&&e.equals(i)&&i.equals(n))},scale:function(t,e,i){return this.controlPoint1.scale(t,e,i),this.controlPoint2.scale(t,e,i),this.end.scale(t,e,i),this},serialize:function(){var t=this.controlPoint1,e=this.controlPoint2,i=this.end;return this.type+" "+t.x+" "+t.y+" "+e.x+" "+e.y+" "+i.x+" "+i.y},toString:function(){return this.type+" "+this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){return this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e),this}};Object.defineProperty(W,"type",{configurable:!0,enumerable:!0,value:"C"}),G.prototype=F(j,w.prototype,W);var H=function t(){for(var e,i,n=arguments,r=[],s=arguments.length,a=0;a<s;a++)r.push(n[a]);if(!(this instanceof t))return B(t,r);if(0===s)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates (none provided).");if(r[0]instanceof C){if(1===s)return this.end=r[0].end.clone(),this;throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+s+" lines provided).")}if(r[0]instanceof w){if(1===s)return this.end=r[0].end.clone(),this;throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+s+" curves provided).")}if("string"==typeof r[0]||"number"==typeof r[0]){if(2===s)return this.end=new S(+r[0],+r[1]),this;if(s<2)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+s+" coordinates provided).");var o;for(e=[],a=0;a<s;a+=2)o=r.slice(a,a+2),0===a?e.push(B(t,o)):e.push(B(V,o));return e}if(1===s)return this.end=new S(r[0]),this;for(e=[],a=0;a<s;a+=1)i=r[a],0===a?e.push(new t(i)):e.push(new V(i));return e},X={bbox:function(){return null},clone:function(){return new H(this.end)},closestPoint:function(){return this.end.clone()},closestPointNormalizedLength:function(){return 0},closestPointLength:function(){return 0},closestPointT:function(){return 1},closestPointTangent:function(){return null},divideAt:function(){return[this.clone(),this.clone()]},divideAtLength:function(){return[this.clone(),this.clone()]},equals:function(t){return this.end.equals(t.end)},getSubdivisions:function(){return[]},isDifferentiable:function(){return!1},isSubpathStart:!0,isVisible:!1,length:function(){return 0},lengthAtT:function(){return 0},pointAt:function(){return this.end.clone()},pointAtLength:function(){return this.end.clone()},pointAtT:function(){return this.end.clone()},scale:function(t,e,i){return this.end.scale(t,e,i),this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},tangentAt:function(){return null},tangentAtLength:function(){return null},tangentAtT:function(){return null},toString:function(){return this.type+" "+this.end},translate:function(t,e){return this.end.translate(t,e),this}};Object.defineProperty(X,"start",{configurable:!0,enumerable:!0,get:function(){throw new Error("Illegal access. Moveto segments should not need a start property.")}}),Object.defineProperty(X,"type",{configurable:!0,enumerable:!0,value:"M"}),H.prototype=F(j,X);var Z=function t(){for(var e=arguments,i=[],n=arguments.length,r=0;r<n;r++)i.push(e[r]);if(!(this instanceof t))return B(t,i);if(0<n)throw new Error("Closepath constructor expects no arguments.");return this},Y={clone:function(){return new Z},divideAt:function(t){var e=new C(this.start,this.end).divideAt(t);return[e[1].isDifferentiable()?new V(e[0]):this.clone(),new V(e[1])]},divideAtLength:function(t){var e=new C(this.start,this.end).divideAtLength(t);return[e[1].isDifferentiable()?new V(e[0]):this.clone(),new V(e[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return!(!this.previousSegment||!this.subpathStartSegment||this.start.equals(this.end))},scale:function(){return this},serialize:function(){return this.type},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(){return this}};Object.defineProperty(Y,"end",{configurable:!0,enumerable:!0,get:function(){if(!this.subpathStartSegment)throw new Error("Missing subpath start segment. (This segment needs a subpath start segment (e.g. Moveto); OR segment has not yet been added to a path.)");return this.subpathStartSegment.end}}),Object.defineProperty(Y,"type",{configurable:!0,enumerable:!0,value:"Z"}),Z.prototype=F(j,C.prototype,Y);var q=I.segmentTypes={L:V,C:G,M:H,Z:Z,z:Z};I.regexSupportedData=new RegExp("^[\\s\\d"+Object.keys(q).join("")+",.]*$"),I.isDataSupported=function(t){return"string"==typeof t&&this.regexSupportedData.test(t)};var K,J,Q={bezier:x,Curve:w,Ellipse:A,Line:C,Path:I,Point:S,Polyline:M,Rect:T,scale:{linear:function(t,e,i){var n=t[1]-t[0],r=e[1]-e[0];return(i-t[0])/n*r+e[0]||0}},normalizeAngle:P,snapToGrid:E,toDeg:k,toRad:D,random:O,ellipse:R,line:L,point:N,rect:z},$=function(){if("object"!=("undefined"==typeof window?"undefined":a(window))||!window.SVGAngle&&!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))return function(){throw new Error("SVG is required to use Vectorizer.")};var t={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xml:"http://www.w3.org/XML/1998/namespace",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml"},e=Math,i=e.PI,n=e.atan2,r=e.sqrt,s=e.min,o=e.max,l=e.cos,h=e.sin,c=function e(i,n,r){if(!(this instanceof e))return e.apply(Object.create(e.prototype),arguments);if(i){if(e.isV(i)&&(i=i.node),n=n||{},e.isString(i)){if("svg"===i.toLowerCase())i=e.createSvgDocument();else if("<"===i[0]){var s=e.createSvgDocument(i);if(1<s.childNodes.length){var a,o,l=[];for(a=0,o=s.childNodes.length;a<o;a++){var h=s.childNodes[a];l.push(new e(document.importNode(h,!0)))}return l}i=document.importNode(s.firstChild,!0)}else i=document.createElementNS(t.svg,i);e.ensureId(i)}return this.node=i,this.setAttributes(n),r&&this.append(r),this}},u=c.prototype;function d(t,e,i){i||(i={});for(var n=i.includeAnnotationIndices,r=i.eol,s=i.lineHeight,a=i.baseSize,o=0,l={},h=e.length-1,u=0;u<=h;u++){var d=e[u],f=null;if(c.isObject(d)){var p=d.attrs,m=c("tspan",p),g=m.node,v=d.t;r&&u===h&&(v+=r),g.textContent=v;var _=p.class;_&&m.addClass(_),n&&m.attr("annotations",d.annotations),void 0===(f=parseFloat(p["font-size"]))&&(f=a),f&&o<f&&(o=f)}else r&&u===h&&(d+=r),g=document.createTextNode(d||" "),a&&o<a&&(o=a);t.appendChild(g)}return o&&(l.maxFontSize=o),s?l.lineHeight=s:o&&(l.lineHeight=1.2*o),l}Object.defineProperty(u,"id",{enumerable:!0,get:function(){return this.node.id},set:function(t){this.node.id=t}}),u.getTransformToElement=function(t){var e=this.node;if(c.isSVGGraphicsElement(t)&&c.isSVGGraphicsElement(e)){var i=c.toNode(t).getScreenCTM(),n=e.getScreenCTM();if(i&&n)return i.inverse().multiply(n)}return c.createSVGMatrix()},u.transform=function(t,e){var i=this.node;if(c.isUndefined(t))return c.transformStringToMatrix(this.attr("transform"));if(e&&e.absolute)return this.attr("transform",c.matrixToTransformString(t));var n=c.createSVGTransform(t);return i.transform.baseVal.appendItem(n),this},u.translate=function(t,e,i){i=i||{},e=e||0;var n=this.attr("transform")||"",r=c.parseTransformString(n);if(n=r.value,c.isUndefined(t))return r.translate;n=n.replace(/translate\([^)]*\)/g,"").trim();var s="translate("+(i.absolute?t:r.translate.tx+t)+","+(i.absolute?e:r.translate.ty+e)+")";return this.attr("transform",(s+" "+n).trim()),this},u.rotate=function(t,e,i,n){n=n||{};var r=this.attr("transform")||"",s=c.parseTransformString(r);if(r=s.value,c.isUndefined(t))return s.rotate;r=r.replace(/rotate\([^)]*\)/g,"").trim(),t%=360;var a="rotate("+(n.absolute?t:s.rotate.angle+t)+(void 0!==e&&void 0!==i?","+e+","+i:"")+")";return this.attr("transform",(r+" "+a).trim()),this},u.scale=function(t,e){e=c.isUndefined(e)?t:e;var i=this.attr("transform")||"",n=c.parseTransformString(i);if(i=n.value,c.isUndefined(t))return n.scale;i=i.replace(/scale\([^)]*\)/g,"").trim();var r="scale("+t+","+e+")";return this.attr("transform",(i+" "+r).trim()),this},u.bbox=function(t,e){var i,n=this.node,r=n.ownerSVGElement;if(!r)return new T(0,0,0,0);try{i=n.getBBox()}catch(t){i={x:n.clientLeft,y:n.clientTop,width:n.clientWidth,height:n.clientHeight}}if(t)return new T(i);var s=this.getTransformToElement(e||r);return c.transformRect(i,s)},u.getBBox=function(t){var e,i={},n=this.node;if(!n.ownerSVGElement||!c.isSVGGraphicsElement(n))return new T(0,0,0,0);if(t&&(t.target&&(i.target=c.toNode(t.target)),t.recursive&&(i.recursive=t.recursive)),i.recursive){var r=this.children(),s=r.length;if(0===s)return this.getBBox({target:i.target,recursive:!1});i.target||(i.target=this);for(var a=0;a<s;a++){var o,l=r[a];o=0===l.children().length?l.getBBox({target:i.target,recursive:!1}):l.getBBox({target:i.target,recursive:!0}),e=e?e.union(o):o}return e}try{e=n.getBBox()}catch(t){e={x:n.clientLeft,y:n.clientTop,width:n.clientWidth,height:n.clientHeight}}if(i.target){var h=this.getTransformToElement(i.target);return c.transformRect(e,h)}return new T(e)};var f=/em$/;function p(t,e){var i=parseFloat(t);return f.test(t)?i*e:i}u.text=function(e,i){if(e&&"string"!=typeof e)throw new Error("Vectorizer: text() expects the first argument to be a string.");e=c.sanitizeText(e),i||(i={});var n=i.displayEmpty,r=i.eol,s=i.textPath,a=i.textVerticalAnchor,o="middle"===a||"bottom"===a||"top"===a,l=i.x;void 0===l&&(l=this.attr("x")||0);var h=i.includeAnnotationIndices,u=i.annotations;u&&!c.isArray(u)&&(u=[u]);var m=i.lineHeight,g="auto"===m,v=g?"1.5em":m||"1em";this.empty(),this.attr({"xml:space":"preserve",display:e||n?null:"none"});var _=parseFloat(this.attr("font-size"));_||(_=16,(o||u)&&this.attr("font-size",_));var y,b=document;y=s?("string"==typeof s&&(s={d:s}),function(t,e){t||(t={});var i=c("textPath"),n=t.d;if(n&&void 0===t["xlink:href"]){var r=c("path").attr("d",n).appendTo(e.defs());i.attr("xlink:href","#"+r.id)}return c.isObject(t)&&i.attr(t),i.node}(s,this)):b.createDocumentFragment();for(var x,w=0,A=e.split("\n"),C=[],I=0,S=A.length-1;I<=S;I++){var M,T=v,P="v-line",E=b.createElementNS(t.svg,"tspan"),k=A[I];if(k)if(u){var D=(M=d(E,c.annotateString(k,u,{offset:-w,includeAnnotationIndices:h}),{includeAnnotationIndices:h,eol:I!==S&&r,lineHeight:g?null:v,baseSize:_})).lineHeight;D&&g&&0!==I&&(T=D),0===I&&(x=.8*M.maxFontSize)}else r&&I!==S&&(k+=r),E.textContent=k;else{E.textContent="-",P+=" v-empty-line";var O=E.style;O.fillOpacity=0,O.strokeOpacity=0,u&&(M={})}M&&C.push(M),0<I&&E.setAttribute("dy",T),(0<I||s)&&E.setAttribute("x",l),E.className.baseVal=P,y.appendChild(E),w+=k.length+1}if(o)if(u)T=function(t,e,i,n){if(!Array.isArray(e))return 0;var r=e.length;if(!r)return 0;for(var s=e[0],a=p(s.maxFontSize,i)||i,o=0,l=p(n,i),h=1;h<r;h++)o+=p((s=e[h]).lineHeight,i)||l;var c,u=p(s.maxFontSize,i)||i;switch(t){case"middle":c=a/2-.15*u-o/2;break;case"bottom":c=-.25*u-o;break;default:case"top":c=.8*a}return c}(a,C,_,v);else if("top"===a)T="0.8em";else{var R;switch(0<S?(R=parseFloat(v)||1,R*=S,f.test(v)||(R/=_)):R=0,a){case"middle":T=.3-R/2+"em";break;case"bottom":T=-R-.3+"em"}}else 0===a?T="0em":a?T=a:(T=0,null===this.attr("y")&&this.attr("y",x||"0.8em"));return y.firstChild.setAttribute("dy",T),this.append(y),this},u.removeAttr=function(t){var e=c.qualifyAttr(t),i=this.node;return e.ns?i.hasAttributeNS(e.ns,e.local)&&i.removeAttributeNS(e.ns,e.local):i.hasAttribute(t)&&i.removeAttribute(t),this},u.attr=function(t,e){if(c.isUndefined(t)){for(var i=this.node.attributes,n={},r=0;r<i.length;r++)n[i[r].name]=i[r].value;return n}if(c.isString(t)&&c.isUndefined(e))return this.node.getAttribute(t);if("object"==a(t))for(var s in t)t.hasOwnProperty(s)&&this.setAttribute(s,t[s]);else this.setAttribute(t,e);return this},u.normalizePath=function(){return"PATH"===this.tagName()&&this.attr("d",c.normalizePathData(this.attr("d"))),this},u.remove=function(){return this.node.parentNode&&this.node.parentNode.removeChild(this.node),this},u.empty=function(){for(;this.node.firstChild;)this.node.removeChild(this.node.firstChild);return this},u.setAttributes=function(t){for(var e in t)t.hasOwnProperty(e)&&this.setAttribute(e,t[e]);return this},u.append=function(t){c.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++)this.node.appendChild(c.toNode(t[e]));return this},u.prepend=function(t){var e=this.node.firstChild;return e?c(e).before(t):this.append(t)},u.before=function(t){var e=this.node,i=e.parentNode;if(i){c.isArray(t)||(t=[t]);for(var n=0,r=t.length;n<r;n++)i.insertBefore(c.toNode(t[n]),e)}return this},u.appendTo=function(t){return c.toNode(t).appendChild(this.node),this},u.svg=function(){return this.node instanceof window.SVGSVGElement?this:c(this.node.ownerSVGElement)},u.tagName=function(){return this.node.tagName.toUpperCase()},u.defs=function(){var t=this.svg()||this,e=t.node.getElementsByTagName("defs")[0];return e?c(e):c("defs").appendTo(t)},u.clone=function(){var t=c(this.node.cloneNode(!0));return t.node.id=c.uniqueId(),t},u.findOne=function(t){var e=this.node.querySelector(t);return e?c(e):void 0},u.find=function(t){var e=[],i=this.node.querySelectorAll(t);if(i)for(var n=0;n<i.length;n++)e.push(c(i[n]));return e},u.children=function(){for(var t=this.node.childNodes,e=[],i=0;i<t.length;i++)1===t[i].nodeType&&e.push(c(t[i]));return e},u.index=function(){for(var t=0,e=this.node.previousSibling;e;)1===e.nodeType&&t++,e=e.previousSibling;return t},u.findParentByClass=function(t,e){for(var i=this.node.ownerSVGElement,n=this.node.parentNode;n&&n!==e&&n!==i;){var r=c(n);if(r.hasClass(t))return r;n=n.parentNode}return null},u.contains=function(t){var e=this.node,i=c.toNode(t),n=i&&i.parentNode;return e===n||!!(n&&1===n.nodeType&&16&e.compareDocumentPosition(n))},u.toLocalPoint=function(t,e){var i=this.svg().node,n=i.createSVGPoint();n.x=t,n.y=e;try{var r=n.matrixTransform(i.getScreenCTM().inverse()),s=this.getTransformToElement(i).inverse()}catch(t){return n}return r.matrixTransform(s)},u.translateCenterToPoint=function(t){var e=this.getBBox({target:this.svg()}).center();return this.translate(t.x-e.x,t.y-e.y),this},u.translateAndAutoOrient=function(t,e,i){t=new S(t),e=new S(e),i||(i=this.svg());var n=this.scale();this.attr("transform","");var r=this.getBBox({target:i}).scale(n.sx,n.sy),s=c.createSVGTransform();s.setTranslate(-r.x-r.width/2,-r.y-r.height/2);var a=c.createSVGTransform(),o=t.angleBetween(e,t.clone().offset(1,0));o&&a.setRotate(o,0,0);var l=c.createSVGTransform(),h=t.clone().move(e,r.width/2);l.setTranslate(2*t.x-h.x,2*t.y-h.y);var u=this.getTransformToElement(i),d=c.createSVGTransform();return d.setMatrix(l.matrix.multiply(a.matrix.multiply(s.matrix.multiply(u.scale(n.sx,n.sy))))),this.attr("transform",c.matrixToTransformString(d.matrix)),this},u.animateAlongPath=function(t,e){e=c.toNode(e);var i=c.ensureId(e),n=c("animateMotion",t),r=c("mpath",{"xlink:href":"#"+i});n.append(r),this.append(n);try{n.node.beginElement()}catch(t){if("fake"===document.documentElement.getAttribute("smiling")){var s=n.node;s.animators=[];var a=s.getAttribute("id");a&&(id2anim[a]=s);for(var o=getTargets(s),l=0,h=o.length;l<h;l++){var u=o[l],d=new Animator(s,u,l);animators.push(d),(s.animators[l]=d).register()}}}return this},u.hasClass=function(t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(this.node.getAttribute("class"))},u.addClass=function(t){if(t&&!this.hasClass(t)){var e=this.node.getAttribute("class")||"";this.node.setAttribute("class",(e+" "+t).trim())}return this},u.removeClass=function(t){if(t&&this.hasClass(t)){var e=this.node.getAttribute("class").replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g"),"$2");this.node.setAttribute("class",e)}return this},u.toggleClass=function(t,e){return(c.isUndefined(e)?this.hasClass(t):!e)?this.removeClass(t):this.addClass(t),this},u.sample=function(t){t=t||1;for(var e,i=this.node,n=i.getTotalLength(),r=[],s=0;s<n;)e=i.getPointAtLength(s),r.push({x:e.x,y:e.y,distance:s}),s+=t;return r},u.convertToPath=function(){var t=c("path");t.attr(this.attr());var e=this.convertToPathData();return e&&t.attr("d",e),t},u.convertToPathData=function(){var t=this.tagName();switch(t){case"PATH":return this.attr("d");case"LINE":return c.convertLineToPathData(this.node);case"POLYGON":return c.convertPolygonToPathData(this.node);case"POLYLINE":return c.convertPolylineToPathData(this.node);case"ELLIPSE":return c.convertEllipseToPathData(this.node);case"CIRCLE":return c.convertCircleToPathData(this.node);case"RECT":return c.convertRectToPathData(this.node)}throw new Error(t+" cannot be converted to PATH.")},c.prototype.toGeometryShape=function(){var t,e,i,n,r,s,a,o,l,h,u,d,f,p,m;switch(this.tagName()){case"RECT":return t=parseFloat(this.attr("x"))||0,e=parseFloat(this.attr("y"))||0,i=parseFloat(this.attr("width"))||0,n=parseFloat(this.attr("height"))||0,new T(t,e,i,n);case"CIRCLE":return r=parseFloat(this.attr("cx"))||0,s=parseFloat(this.attr("cy"))||0,a=parseFloat(this.attr("r"))||0,new A({x:r,y:s},a,a);case"ELLIPSE":return r=parseFloat(this.attr("cx"))||0,s=parseFloat(this.attr("cy"))||0,o=parseFloat(this.attr("rx"))||0,l=parseFloat(this.attr("ry"))||0,new A({x:r,y:s},o,l);case"POLYLINE":return h=c.getPointsFromSvgNode(this),new M(h);case"POLYGON":return 1<(h=c.getPointsFromSvgNode(this)).length&&h.push(h[0]),new M(h);case"PATH":return u=this.attr("d"),I.isDataSupported(u)||(u=c.normalizePathData(u)),new I(u);case"LINE":return d=parseFloat(this.attr("x1"))||0,p=parseFloat(this.attr("y1"))||0,f=parseFloat(this.attr("x2"))||0,m=parseFloat(this.attr("y2"))||0,new C({x:d,y:p},{x:f,y:m})}return this.getBBox()},u.findIntersection=function(t,e){var i=this.svg().node;e=e||i;var n=this.getBBox({target:e}),r=n.center();if(n.intersectionWithLineFromCenterToPoint(t)){var s,a=this.tagName();if("RECT"===a){var o=new T(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height"))),l=this.getTransformToElement(e),h=c.decomposeMatrix(l),u=i.createSVGTransform();u.setRotate(-h.rotation,r.x,r.y);var d=c.transformRect(o,u.matrix.multiply(l));s=new T(d).intersectionWithLineFromCenterToPoint(t,h.rotation)}else if("PATH"===a||"POLYGON"===a||"POLYLINE"===a||"CIRCLE"===a||"ELLIPSE"===a){var f,p,m,g,v,_=("PATH"===a?this:this.convertToPath()).sample(),y=1/0,b=[];for(f=0;f<_.length;f++)p=_[f],m=(m=c.createSVGPoint(p.x,p.y)).matrixTransform(this.getTransformToElement(e)),(v=(p=new S(m)).distance(r)+(g=1.1*p.distance(t)))<y?(y=v,b=[{sample:p,refDistance:g}]):v<y+1&&b.push({sample:p,refDistance:g});b.sort((function(t,e){return t.refDistance-e.refDistance})),b[0]&&(s=b[0].sample)}return s}},u.setAttribute=function(t,e){var i=this.node;if(null===e)return this.removeAttr(t),this;var n=c.qualifyAttr(t);return n.ns?i.setAttributeNS(n.ns,t,e):"id"===t?i.id=e:i.setAttribute(t,e),this},c.createSvgDocument=function(e){if(e)return c.parseXML('<svg xmlns="'+t.svg+'" xmlns:xlink="'+t.xlink+'" version="1.1">'+e+"</svg>",{async:!1}).documentElement;var i=document.createElementNS(t.svg,"svg");return i.setAttributeNS(t.xmlns,"xmlns:xlink",t.xlink),i.setAttribute("version","1.1"),i},c.idCounter=0,c.uniqueId=function(){return"v-"+ ++c.idCounter},c.toNode=function(t){return c.isV(t)?t.node:t.nodeName&&t||t[0]},c.ensureId=function(t){return(t=c.toNode(t)).id||(t.id=c.uniqueId())},c.sanitizeText=function(t){return(t||"").replace(/ /g,"")},c.isUndefined=function(t){return void 0===t},c.isString=function(t){return"string"==typeof t},c.isObject=function(t){return t&&"object"==a(t)},c.isArray=Array.isArray,c.parseXML=function(t,e){var i;e=e||{};try{var n=new DOMParser;c.isUndefined(e.async)||(n.async=e.async),i=n.parseFromString(t,"text/xml")}catch(t){i=void 0}if(!i||i.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+t);return i},c.qualifyAttr=function(e){if(-1===e.indexOf(":"))return{ns:null,local:e};var i=e.split(":");return{ns:t[i[0]],local:i[1]}},c.transformRegex=/(\w+)\(([^,)]+),?([^)]+)?\)/gi,c.transformSeparatorRegex=/[ ,]+/,c.transformationListRegex=/^(\w+)\((.*)\)/,c.transformStringToMatrix=function(t){var e=c.createSVGMatrix(),i=t&&t.match(c.transformRegex);if(!i)return e;for(var n=0,r=i.length;n<r;n++){var s=i[n].match(c.transformationListRegex);if(s){var a,o,l,h,u,d=c.createSVGMatrix(),f=s[2].split(c.transformSeparatorRegex);switch(s[1].toLowerCase()){case"scale":a=parseFloat(f[0]),o=void 0===f[1]?a:parseFloat(f[1]),d=d.scaleNonUniform(a,o);break;case"translate":l=parseFloat(f[0]),h=parseFloat(f[1]),d=d.translate(l,h);break;case"rotate":u=parseFloat(f[0]),l=parseFloat(f[1])||0,h=parseFloat(f[2])||0,d=0!==l||0!==h?d.translate(l,h).rotate(u).translate(-l,-h):d.rotate(u);break;case"skewx":u=parseFloat(f[0]),d=d.skewX(u);break;case"skewy":u=parseFloat(f[0]),d=d.skewY(u);break;case"matrix":d.a=parseFloat(f[0]),d.b=parseFloat(f[1]),d.c=parseFloat(f[2]),d.d=parseFloat(f[3]),d.e=parseFloat(f[4]),d.f=parseFloat(f[5]);break;default:continue}e=e.multiply(d)}}return e},c.matrixToTransformString=function(t){return t||(t=!0),"matrix("+(void 0!==t.a?t.a:1)+","+(void 0!==t.b?t.b:0)+","+(void 0!==t.c?t.c:0)+","+(void 0!==t.d?t.d:1)+","+(void 0!==t.e?t.e:0)+","+(void 0!==t.f?t.f:0)+")"},c.parseTransformString=function(t){var e,i,n;if(t){var r=c.transformSeparatorRegex;if(0<=t.trim().indexOf("matrix")){var s=c.transformStringToMatrix(t),a=c.decomposeMatrix(s);e=[a.translateX,a.translateY],n=[a.scaleX,a.scaleY],i=[a.rotation];var o=[];0===e[0]&&0===e[1]||o.push("translate("+e+")"),1===n[0]&&1===n[1]||o.push("scale("+n+")"),0!==i[0]&&o.push("rotate("+i+")"),t=o.join(" ")}else{var l=t.match(/translate\((.*?)\)/);l&&(e=l[1].split(r));var h=t.match(/rotate\((.*?)\)/);h&&(i=h[1].split(r));var u=t.match(/scale\((.*?)\)/);u&&(n=u[1].split(r))}}var d=n&&n[0]?parseFloat(n[0]):1;return{value:t,translate:{tx:e&&e[0]?parseInt(e[0],10):0,ty:e&&e[1]?parseInt(e[1],10):0},rotate:{angle:i&&i[0]?parseInt(i[0],10):0,cx:i&&i[1]?parseInt(i[1],10):void 0,cy:i&&i[2]?parseInt(i[2],10):void 0},scale:{sx:d,sy:n&&n[1]?parseFloat(n[1]):d}}},c.deltaTransformPoint=function(t,e){return{x:e.x*t.a+e.y*t.c+0,y:e.x*t.b+e.y*t.d+0}},c.decomposeMatrix=function(t){var e=c.deltaTransformPoint(t,{x:0,y:1}),s=c.deltaTransformPoint(t,{x:1,y:0}),a=180/i*n(e.y,e.x)-90,o=180/i*n(s.y,s.x);return{translateX:t.e,translateY:t.f,scaleX:r(t.a*t.a+t.b*t.b),scaleY:r(t.c*t.c+t.d*t.d),skewX:a,skewY:o,rotation:a}},c.matrixToScale=function(t){var e,i,n,s;return t?(e=c.isUndefined(t.a)?1:t.a,s=c.isUndefined(t.d)?1:t.d,i=t.b,n=t.c):e=s=1,{sx:i?r(e*e+i*i):e,sy:n?r(n*n+s*s):s}},c.matrixToRotate=function(t){var e={x:0,y:1};return t&&(e=c.deltaTransformPoint(t,e)),{angle:P(k(n(e.y,e.x))-90)}},c.matrixToTranslate=function(t){return{tx:t&&t.e||0,ty:t&&t.f||0}},c.isVElement=c.isV=function(t){return t instanceof c},c.isSVGGraphicsElement=function(t){return!!t&&(t=c.toNode(t))instanceof SVGElement&&"function"==typeof t.getScreenCTM};var m=c("svg").node;return c.createSVGMatrix=function(t){var e=m.createSVGMatrix();for(var i in t)e[i]=t[i];return e},c.createSVGTransform=function(t){return c.isUndefined(t)?m.createSVGTransform():(t instanceof SVGMatrix||(t=c.createSVGMatrix(t)),m.createSVGTransformFromMatrix(t))},c.createSVGPoint=function(t,e){var i=m.createSVGPoint();return i.x=t,i.y=e,i},c.transformRect=function(t,e){var i=m.createSVGPoint();i.x=t.x,i.y=t.y;var n=i.matrixTransform(e);i.x=t.x+t.width,i.y=t.y;var r=i.matrixTransform(e);i.x=t.x+t.width,i.y=t.y+t.height;var a=i.matrixTransform(e);i.x=t.x,i.y=t.y+t.height;var l=i.matrixTransform(e),h=s(n.x,r.x,a.x,l.x),c=o(n.x,r.x,a.x,l.x),u=s(n.y,r.y,a.y,l.y),d=o(n.y,r.y,a.y,l.y);return new T(h,u,c-h,d-u)},c.transformPoint=function(t,e){return new S(c.createSVGPoint(t.x,t.y).matrixTransform(e))},c.transformLine=function(t,e){return new C(c.transformPoint(t.start,e),c.transformPoint(t.end,e))},c.transformPolyline=function(t,e){var i=t instanceof M?t.points:t;c.isArray(i)||(i=[]);for(var n=[],r=0,s=i.length;r<s;r++)n[r]=c.transformPoint(i[r],e);return new M(n)},c.styleToObject=function(t){for(var e={},i=t.split(";"),n=0;n<i.length;n++){var r=i[n].split("=");e[r[0].trim()]=r[1].trim()}return e},c.createSlicePathData=function(t,e,n,r){var s=2*i-1e-6,a=t,o=e,c=n,u=r,d=(u<c&&(d=c,c=u,u=d),u-c),f=d<i?"0":"1",p=l(c),m=h(c),g=l(u),v=h(u);return s<=d?a?"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"M0,"+a+"A"+a+","+a+" 0 1,0 0,"+-a+"A"+a+","+a+" 0 1,0 0,"+a+"Z":"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"Z":a?"M"+o*p+","+o*m+"A"+o+","+o+" 0 "+f+",1 "+o*g+","+o*v+"L"+a*g+","+a*v+"A"+a+","+a+" 0 "+f+",0 "+a*p+","+a*m+"Z":"M"+o*p+","+o*m+"A"+o+","+o+" 0 "+f+",1 "+o*g+","+o*v+"L0,0Z"},c.mergeAttrs=function(t,e){for(var i in e)"class"===i?t[i]=t[i]?t[i]+" "+e[i]:e[i]:"style"===i?c.isObject(t[i])&&c.isObject(e[i])?t[i]=c.mergeAttrs(t[i],e[i]):c.isObject(t[i])?t[i]=c.mergeAttrs(t[i],c.styleToObject(e[i])):c.isObject(e[i])?t[i]=c.mergeAttrs(c.styleToObject(t[i]),e[i]):t[i]=c.mergeAttrs(c.styleToObject(t[i]),c.styleToObject(e[i])):t[i]=e[i];return t},c.annotateString=function(t,e,i){e=e||[];for(var n,r,s,a=(i=i||{}).offset||0,o=[],l=[],h=0;h<t.length;h++){r=l[h]=t[h];for(var u=0;u<e.length;u++){var d=e[u],f=d.start+a,p=d.end+a;f<=h&&h<p&&(c.isObject(r)?r.attrs=c.mergeAttrs(c.mergeAttrs({},r.attrs),d.attrs):r=l[h]={t:t[h],attrs:d.attrs},i.includeAnnotationIndices&&(r.annotations||(r.annotations=[])).push(u))}(s=l[h-1])?c.isObject(r)&&c.isObject(s)?JSON.stringify(r.attrs)===JSON.stringify(s.attrs)?n.t+=r.t:(o.push(n),n=r):n=c.isObject(r)||c.isObject(s)?(o.push(n),r):(n||"")+r:n=r}return n&&o.push(n),o},c.findAnnotationsAtIndex=function(t,e){var i=[];return t&&t.forEach((function(t){t.start<e&&e<=t.end&&i.push(t)})),i},c.findAnnotationsBetweenIndexes=function(t,e,i){var n=[];return t&&t.forEach((function(t){(e>=t.start&&e<t.end||i>t.start&&i<=t.end||t.start>=e&&t.end<i)&&n.push(t)})),n},c.shiftAnnotations=function(t,e,i){return t&&t.forEach((function(t){t.start<e&&t.end>=e?t.end+=i:t.start>=e&&(t.start+=i,t.end+=i)})),t},c.convertLineToPathData=function(t){return["M",(t=c(t)).attr("x1"),t.attr("y1"),"L",t.attr("x2"),t.attr("y2")].join(" ")},c.convertPolygonToPathData=function(t){var e=c.getPointsFromSvgNode(t);return 0===e.length?null:c.svgPointsToPath(e)+" Z"},c.convertPolylineToPathData=function(t){var e=c.getPointsFromSvgNode(t);return 0===e.length?null:c.svgPointsToPath(e)},c.svgPointsToPath=function(t){for(var e=0,i=t.length;e<i;e++)t[e]=t[e].x+" "+t[e].y;return"M "+t.join(" L")},c.getPointsFromSvgNode=function(t){var e=[],i=(t=c.toNode(t)).points;if(i)for(var n=0,r=i.numberOfItems;n<r;n++)e.push(i.getItem(n));return e},c.KAPPA=.551784,c.convertCircleToPathData=function(t){t=c(t);var e=parseFloat(t.attr("cx"))||0,i=parseFloat(t.attr("cy"))||0,n=parseFloat(t.attr("r")),r=n*c.KAPPA;return["M",e,i-n,"C",e+r,i-n,e+n,i-r,e+n,i,"C",e+n,i+r,e+r,i+n,e,i+n,"C",e-r,i+n,e-n,i+r,e-n,i,"C",e-n,i-r,e-r,i-n,e,i-n,"Z"].join(" ")},c.convertEllipseToPathData=function(t){t=c(t);var e=parseFloat(t.attr("cx"))||0,i=parseFloat(t.attr("cy"))||0,n=parseFloat(t.attr("rx")),r=parseFloat(t.attr("ry"))||n,s=n*c.KAPPA,a=r*c.KAPPA;return["M",e,i-r,"C",e+s,i-r,e+n,i-a,e+n,i,"C",e+n,i+a,e+s,i+r,e,i+r,"C",e-s,i+r,e-n,i+a,e-n,i,"C",e-n,i-a,e-s,i-r,e,i-r,"Z"].join(" ")},c.convertRectToPathData=function(t){return t=c(t),c.rectToPath({x:parseFloat(t.attr("x"))||0,y:parseFloat(t.attr("y"))||0,width:parseFloat(t.attr("width"))||0,height:parseFloat(t.attr("height"))||0,rx:parseFloat(t.attr("rx"))||0,ry:parseFloat(t.attr("ry"))||0})},c.rectToPath=function(t){var e=t.x,i=t.y,n=t.width,r=t.height,a=s(t.rx||t["top-rx"]||0,n/2),o=s(t.rx||t["bottom-rx"]||0,n/2),l=s(t.ry||t["top-ry"]||0,r/2),h=s(t.ry||t["bottom-ry"]||0,r/2);return(a||o||l||h?["M",e,i+l,"v",r-l-h,"a",o,h,0,0,0,o,h,"h",n-2*o,"a",o,h,0,0,0,o,-h,"v",-(r-h-l),"a",a,l,0,0,0,-a,-l,"h",-(n-2*a),"a",a,l,0,0,0,-a,l,"Z"]:["M",e,i,"H",e+n,"V",i+r,"H",e,"V",i,"Z"]).join(" ")},c.normalizePathData=function(){var t="\t\n\v\f\r \u2028\u2029",e=new RegExp("([a-z])["+t+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+t+"]*,?["+t+"]*)+)","ig"),i=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+t+"]*,?["+t+"]*","ig"),n=Math,r=n.PI,s=n.sin,a=n.cos,o=n.tan,l=n.asin,h=n.sqrt,c=n.abs;function u(t,e,i,n,r,s){return[1/3*t+2/3*i,1/3*e+2/3*n,1/3*r+2/3*i,1/3*s+2/3*n,r,s]}function d(t,e,i){return{x:t*a(i)-e*s(i),y:t*s(i)+e*a(i)}}function f(t){var n=function(t){if(Array.isArray(t)&&Array.isArray(t&&t[0])||(t=function(t){if(!t)return null;var n={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=[];return String(t).replace(e,(function(t,e,s){var a=[],o=e.toLowerCase();for(s.replace(i,(function(t,e){e&&a.push(+e)})),"m"===o&&2<a.length&&(r.push([e].concat(a.splice(0,2))),o="l",e="m"===e?"l":"L");a.length>=n[o]&&(r.push([e].concat(a.splice(0,n[o]))),n[o]););})),r}(t)),!t||!t.length)return[["M",0,0]];for(var n,r=[],s=0,a=0,o=0,l=0,h=t.length,c=0;c<h;c++){var u=[];r.push(u);var d,f,p=t[c];if((n=p[0])!=n.toUpperCase())switch(u[0]=n.toUpperCase(),u[0]){case"A":u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=+p[6]+s,u[7]=+p[7]+a;break;case"V":u[1]=+p[1]+a;break;case"H":u[1]=+p[1]+s;break;case"M":for(o=+p[1]+s,l=+p[2]+a,d=p.length,f=1;f<d;f++)u[f]=+p[f]+(f%2?s:a);break;default:for(d=p.length,f=1;f<d;f++)u[f]=+p[f]+(f%2?s:a)}else for(var m=p.length,g=0;g<m;g++)u[g]=p[g];switch(u[0]){case"Z":s=+o,a=+l;break;case"H":s=u[1];break;case"V":a=u[1];break;case"M":o=u[u.length-2],l=u[u.length-1],s=u[u.length-2],a=u[u.length-1];break;default:s=u[u.length-2],a=u[u.length-1]}}return r}(t),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function p(t,e,i){var n,f;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(t[0]in{T:1,Q:1}||(e.qx=null,e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=0===parseFloat(t[1])||0===parseFloat(t[2])?["L",t[6],t[7]]:["C"].concat(function t(e,i,n,u,f,p,m,g,v,_){var y,b=120*r/180,x=r/180*(+f||0),w=[];if(_)k=_[0],D=_[1],P=_[2],E=_[3];else{e=(y=d(e,i,-x)).x,i=y.y;var A=(e-(g=(y=d(g,v,-x)).x))/2,C=(i-(v=y.y))/2,I=A*A/(n*n)+C*C/(u*u);1<I&&(n*=I=h(I),u*=I);var S=n*n,M=u*u,T=(p==m?-1:1)*h(c((S*M-S*C*C-M*A*A)/(S*C*C+M*A*A))),P=T*n*C/u+(e+g)/2,E=T*-u*A/n+(i+v)/2,k=l(((i-E)/u).toFixed(9)),D=l(((v-E)/u).toFixed(9));(k=e<P?r-k:k)<0&&(k=2*r+k),(D=g<P?r-D:D)<0&&(D=2*r+D),m&&D<k&&(k-=2*r),!m&&k<D&&(D-=2*r)}var O=D-k;if(c(O)>b){var R=D,L=g,N=v;w=t(g=P+n*a(D=k+b*(m&&k<D?1:-1)),v=E+u*s(D),n,u,f,0,m,L,N,[D,R,P,E])}O=D-k;var z=a(k),B=s(k),F=a(D),j=s(D),V=o(O/4),U=4/3*(n*V),G=4/3*(u*V),W=[e,i],H=[e+U*B,i-G*z],X=[g+U*j,v-G*F],Z=[g,v];if(H[0]=2*W[0]-H[0],H[1]=2*W[1]-H[1],_)return[H,X,Z].concat(w);for(var Y=[],q=(w=[H,X,Z].concat(w).join().split(",")).length,K=0;K<q;K++)Y[K]=K%2?d(w[K-1],w[K],x).y:d(w[K],w[K+1],x).x;return Y}.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":f="C"===i||"S"===i?(n=2*e.x-e.bx,2*e.y-e.by):(n=e.x,e.y),t=["C",n,f].concat(t.slice(1));break;case"T":e.qy="Q"===i||"T"===i?(e.qx=2*e.x-e.qx,2*e.y-e.qy):(e.qx=e.x,e.y),t=["C"].concat(u(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(u(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"H":t=["L"].concat(t[1],e.y);break;case"V":t=["L"].concat(e.x,t[1])}return t}function m(t,e){if(7<t[e].length){t[e].shift();for(var i=t[e];i.length;)g[e]="A",t.splice(e++,0,["C"].concat(i.splice(0,6)));t.splice(e,1),y=n.length}}for(var g=[],v="",_="",y=n.length,b=0;b<y;b++){n[b]&&(v=n[b][0]),"C"!==v&&(g[b]=v,0<b&&(_=g[b-1])),n[b]=p(n[b],f,_),"A"!==g[b]&&"C"===v&&(g[b]="C"),m(n,b);var x=n[b],w=x.length;f.x=x[w-2],f.y=x[w-1],f.bx=parseFloat(x[w-4])||f.x,f.by=parseFloat(x[w-3])||f.y}return n[0][0]&&"M"===n[0][0]||n.unshift(["M",0,0]),n}return function(t){return f(t).join(",").split(",").join(" ")}}(),c.namespace=t,c.g=Q,c}(),tt={useCSSSelectors:!0,classNamePrefix:"joint-",defaultTheme:"default"},et=function(t){return t?t.toString().split(" ").map((function(t){return t.substr(0,tt.classNamePrefix.length)!==tt.classNamePrefix&&(t=tt.classNamePrefix+t),t})).join(" "):t},it=function(t){return t?t.toString().split(" ").map((function(t){return t.substr(0,tt.classNamePrefix.length)===tt.classNamePrefix&&(t=t.substr(tt.classNamePrefix.length)),t})).join(" "):t},nt=function(t,e){for(var i={},r={},s=$.namespace.svg,a=e||s,o=document.createDocumentFragment(),l=[t,o,a];0<l.length;){a=l.pop();for(var h=l.pop(),c=l.pop(),u=0,d=c.length;u<d;u++){var f=c[u];if(!f.hasOwnProperty("tagName"))throw new Error("json-dom-parser: missing tagName");var p=f.tagName;f.hasOwnProperty("namespaceURI")&&(a=f.namespaceURI);var m=document.createElementNS(a,p),g=a===s,v=g?$:n,_=f.attributes;_&&v(m).attr(_);var y=f.style;if(y&&n(m).css(y),f.hasOwnProperty("className")){var b=f.className;g?m.className.baseVal=b:m.className=b}if(f.hasOwnProperty("textContent")&&(m.textContent=f.textContent),f.hasOwnProperty("selector")){var x=f.selector;if(i[x])throw new Error("json-dom-parser: selector must be unique");v(i[x]=m).attr("joint-selector",x)}if(f.hasOwnProperty("groupSelector")){var w=f.groupSelector;Array.isArray(w)||(w=[w]);for(var A=0,C=w.length;A<C;A++){var I=w[A],S=r[I];S||(S=r[I]=[]),S.push(m)}}h.appendChild(m);var M=f.children;Array.isArray(M)&&l.push(M,m,a)}}return{fragment:o,selectors:i,groupSelectors:r}},rt=function(t){var e=0;if(0===t.length)return e;for(var i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e&=e;return e},st=function(t,e,i){for(var n,r=Array.isArray(e)?e:e.split(i||"/"),s=0,a=r.length;s<a;){if(n=r[s++],Object(t)!==t||!(n in t))return;t=t[n]}return t},at=function(t,e,i,n){for(var r=Array.isArray(e)?e:e.split(n||"/"),s=t,a=0,o=r.length;a<o-1;a++)s=s[r[a]]||(s[r[a]]={});return s[r[o-1]]=i,t},ot=function(t,e,i){i||(i="/");var n=Array.isArray(e)?e.slice():e.split(i),r=n.pop();if(0<n.length){var s=st(t,n,i);s&&delete s[r]}else delete t[r];return t},lt=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},ht=function t(e){return t.id=t.id||1,e.id=void 0===e.id?"j_"+t.id++:e.id,e.id},ct=function(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()},ut=function(t){var e=t,i=t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0];if(i){for(var n in t)void 0===i[n]&&(i[n]=t[n]);e=i}var r=e.target;if(r){var s=r.correspondingUseElement;s&&(e.target=s)}return e},dt=function(){var t;if("undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!t){var e=0;t=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),r=setTimeout((function(){t(i+n)}),n);return e=i+n,r}}return function(e,i){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];return t(void 0!==i?e.bind.apply(e,[i].concat(n)):e)}}(),ft=((J="undefined"!=typeof window)&&(K=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),K=K||clearTimeout,J?K.bind(window):K),pt=function(t){return ce(t)&&"%"===t.slice(-1)},mt=function(t,e){var i=parseFloat(t);if(Number.isNaN(i))return null;var n,r={};if(r.value=i,null==e)n="[A-Za-z]*";else if(Array.isArray(e)){if(0===e.length)return null;n=e.join("|")}else ce(e)&&(n=e);var s,a=(s=new RegExp("(?:\\d+(?:\\.\\d+)*)("+n+")$").exec(t))?s[1]:null;return null===a?null:(r.unit=a,r)},gt=function(t,e,i,n){void 0===i&&(i={}),void 0===n&&(n={});var r=e.width,s=e.height,a=n.svgDocument||$("svg").node,o=$("tspan").node,l=$("text").attr(i).append(o).node,h=document.createTextNode("");l.style.opacity=0,l.style.display="block",o.style.display="block",o.appendChild(h),a.appendChild(l),n.svgDocument||document.body.appendChild(a);var c=n.separator||" ",u=n.eol||"\n",d=n.hyphen?new RegExp(n.hyphen):/[^\w\d]/,f=n.maxLineCount;he(f)||(f=1/0);for(var p,m,g,v=t.split(c),_=[],y=[],b=0,x=0,w=v.length;b<w;b++){var A=v[b];if(A)if(u&&0<=A.indexOf(u))if(1<A.length){for(var C=A.split(u),I=0,S=C.length-1;I<S;I++)C.splice(2*I+1,0,u);v.splice.apply(v,[b,1].concat(C.filter((function(t){return""!==t})))),b--,w=v.length}else y[++x]="";else{if(h.data=y[x]?y[x]+" "+A:A,o.getComputedTextLength()<=r)y[x]=h.data,(p||m)&&(_[x++]=!0,m=p=0);else{if(!y[x]||p){var M=!!p;if(p=A.length-1,M||!p){if(!p){if(!y[x]){y=[];break}v.splice(b,2,A+v[b+1]),w--,_[x++]=!0,b--;continue}v[b]=A.substring(0,p),v[b+1]=A.substring(p)+v[b+1]}else{if(m)v.splice(b,2,v[b]+v[b+1]),m=0;else{var T=A.search(d);-1<T&&T!==A.length-1&&0!==T&&(m=T+1,p=0),v.splice(b,1,A.substring(0,m||p),A.substring(m||p)),w++}x&&!_[x-1]&&x--}b--;continue}x++,b--}var P=null;if(y.length>f)P=f-1;else if(void 0!==s){var E;void 0===g&&(g=(E="auto"===i.lineHeight?{value:1.5,unit:"em"}:mt(i.lineHeight,["em"])||{value:1,unit:"em"}).value,"em"===E.unit&&(g*=l.getBBox().height)),g*y.length>s&&(P=Math.floor(s/g)-1)}if(null!==P){y.splice(P+1);var k=n.ellipsis;if(!k||P<0)break;"string"!=typeof k&&(k="");var D=y[P];if(!D)break;var O,R,L=D.length;do{if(R=D[L],O=D.substring(0,L),R?R.match(c)&&(O+=R):O+="string"==typeof c?c:" ",O+=k,h.data=O,o.getComputedTextLength()<=r){y[P]=O;break}L--}while(0<=L);break}}}return n.svgDocument?a.removeChild(l):document.body.removeChild(a),y.join(u)},vt=function(t){var e=n(n.parseHTML("<div>"+t+"</div>",null,!1));return e.find("*").each((function(){var t=this;n.each(t.attributes,(function(){var e=this.name,i=this.value;(e.startsWith("on")||i.startsWith("javascript:")||i.startsWith("data:")||i.startsWith("vbscript:"))&&n(t).removeAttr(e)}))})),e.html()},_t=function(t,e){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t,e);else{var i=window.URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i)}},yt=function(t){t=t.replace(/\s/g,"");var e,i=(t=decodeURIComponent(t)).indexOf(","),n=t.slice(0,i),r=n.split(":")[1].split(";")[0],s=t.slice(i+1);e=0<=n.indexOf("base64")?atob(s):unescape(encodeURIComponent(s));for(var a=new Uint8Array(e.length),o=0;o<e.length;o++)a[o]=e.charCodeAt(o);return new Blob([a],{type:r})},bt=function(t,e){var i=n(t),r=i.map((function(){var t=this.parentNode,e=t.insertBefore(document.createTextNode(""),this.nextSibling);return function(){if(t===this)throw new Error("You can't sort elements if any one is a descendant of another.");t.insertBefore(this,e),t.removeChild(e)}}));return Array.prototype.sort.call(i,e).each((function(t){r[t].call(this)}))},xt=function(t){if(Object(t)===t)return e=i=n=r=0,isFinite(t.vertical)&&(e=n=+t.vertical),isFinite(t.horizontal)&&(i=r=+t.horizontal),isFinite(t.top)&&(e=+t.top),isFinite(t.right)&&(i=+t.right),isFinite(t.bottom)&&(n=+t.bottom),isFinite(t.left)&&(r=+t.left),{top:e,right:i,bottom:n,left:r};var e,i,n,r,s=0;return isFinite(t)&&(s=+t),{top:s,right:s,bottom:s,left:s}},wt={linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(1<=t)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var e=0,i=1;;e+=i,i/=2)if((7-4*e)/11<=t){var n=(11-6*e-11*t)/4;return-n*n+i*i}},reverse:function(t){return function(e){return 1-t(1-e)}},reflect:function(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}},clamp:function(t,e,i){return e=e||0,i=i||1,function(n){var r=t(n);return r<e?e:i<r?i:r}},back:function(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}},elastic:function(t){return t||(t=1.5),function(e){return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)}}},At={number:function(t,e){var i=e-t;return function(e){return t+i*e}},object:function(t,e){var i=Object.keys(t);return function(n){var r,s,a={};for(r=i.length-1;-1!=r;r--)a[s=i[r]]=t[s]+(e[s]-t[s])*n;return a}},hexColor:function(t,e){var i=parseInt(t.slice(1),16),n=parseInt(e.slice(1),16),r=255&i,s=(255&n)-r,a=65280&i,o=(65280&n)-a,l=16711680&i,h=(16711680&n)-l;return function(t){return"#"+(1<<24|r+s*t&255|a+o*t&65280|l+h*t&16711680).toString(16).slice(1)}},unit:function(t,e){var i=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,n=i.exec(t),r=i.exec(e),s=r[1].indexOf("."),a=0<s?r[1].length-s-1:0;t=+n[1];var o=+r[1]-t,l=n[2];return function(e){return(t+o*e).toFixed(a)+l}}},Ct={outline:function(t){var e=Number.isFinite(t.margin)?t.margin:2,i=Number.isFinite(t.width)?t.width:1;return St('<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${outerRadius}" /><feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${innerRadius}" /><feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/><feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/><feMerge><feMergeNode in="outline"/><feMergeNode in="SourceGraphic"/></feMerge></filter>')({color:t.color||"blue",opacity:Number.isFinite(t.opacity)?t.opacity:1,outerRadius:e+i,innerRadius:e})},highlight:function(t){return St('<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${width}"/><feComposite result="composed" in="colored" in2="morphed" operator="in"/><feGaussianBlur result="blured" in="composed" stdDeviation="${blur}"/><feBlend in="SourceGraphic" in2="blured" mode="normal"/></filter>')({color:t.color||"red",width:Number.isFinite(t.width)?t.width:1,blur:Number.isFinite(t.blur)?t.blur:0,opacity:Number.isFinite(t.opacity)?t.opacity:1})},blur:function(t){var e=Number.isFinite(t.x)?t.x:2;return St('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>')({stdDeviation:Number.isFinite(t.y)?[e,t.y]:e})},dropShadow:function(t){var e="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return St(e)({dx:t.dx||0,dy:t.dy||0,opacity:Number.isFinite(t.opacity)?t.opacity:1,color:t.color||"black",blur:Number.isFinite(t.blur)?t.blur:4})},grayscale:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return St('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>')({a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},sepia:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return St('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>')({a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},saturate:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return St('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>')({amount:1-e})},hueRotate:function(t){return St('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>')({angle:t.angle||0})},invert:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return St('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:1-e})},brightness:function(t){return St('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>')({amount:Number.isFinite(t.amount)?t.amount:1})},contrast:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return St('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:.5-e/2})}},It={number:function(t,e,i){i=i||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var n=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i.exec(t),r=n[1]||" ",s=n[2]||">",a=n[3]||"",o=n[4]||"",l=n[5],h=+n[6],c=n[7],u=n[8],d=n[9],f=1,p="",m="",g=!1;switch(u&&(u=+u.substring(1)),(l||"0"===r&&"="===s)&&(l=r="0",s="=",c&&(h-=Math.floor((h-1)/4))),d){case"n":c=!0,d="g";break;case"%":f=100,m="%",d="f";break;case"p":f=100,m="%",d="r";break;case"b":case"o":case"x":case"X":"#"===o&&(p="0"+d.toLowerCase());break;case"c":case"d":g=!0,u=0;break;case"s":f=-1,d="r"}"$"===o&&(p=i.currency[0],m=i.currency[1]),"r"!=d||u||(d="g"),null!=u&&("g"==d?u=Math.max(1,Math.min(21,u)):"e"!=d&&"f"!=d||(u=Math.max(0,Math.min(20,u))));var v=l&&c;if(g&&e%1)return"";var _=e<0||0===e&&1/e<0?(e=-e,"-"):a,y=m;if(f<0){var b=this.prefix(e,u);e=b.scale(e),y=b.symbol+m}else e*=f;var x=(e=this.convert(d,e,u)).lastIndexOf("."),w=x<0?e:e.substring(0,x),A=x<0?"":i.decimal+e.substring(x+1);function C(t){for(var e=t.length,n=[],r=0,s=i.grouping[0];0<e&&0<s;)n.push(t.substring(e-=s,e+s)),s=i.grouping[r=(r+1)%i.grouping.length];return n.reverse().join(i.thousands)}!l&&c&&i.grouping&&(w=C(w));var I=p.length+w.length+A.length+(v?0:_.length),S=I<h?new Array(I=h-I+1).join(r):"";return v&&(w=C(S+w)),_+=p,e=w+A,("<"===s?_+e+S:">"===s?S+_+e:"^"===s?S.substring(0,I>>=1)+_+e+S.substring(I):_+(v?e:S+e))+y},string:function(t,e){for(var i,n="{",r=!1,s=[];-1!==(i=t.indexOf(n));){var a,o,l;if(a=t.slice(0,i),r){l=(o=a.split(":")).shift().split("."),a=e;for(var h=0;h<l.length;h++)a=a[l[h]];o.length&&(a=this.number(o,a))}s.push(a),t=t.slice(i+1),n=(r=!r)?"}":"{"}return s.push(t),s.join("")},convert:function(t,e,i){switch(t){case"b":return e.toString(2);case"c":return String.fromCharCode(e);case"o":return e.toString(8);case"x":return e.toString(16);case"X":return e.toString(16).toUpperCase();case"g":return e.toPrecision(i);case"e":return e.toExponential(i);case"f":return e.toFixed(i);case"r":return(e=this.round(e,this.precision(e,i))).toFixed(Math.max(0,Math.min(20,this.precision(e*(1+1e-15),i))));default:return e+""}},round:function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},precision:function(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)},prefix:function(t,e){var i=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map((function(t,e){var i=Math.pow(10,3*Math.abs(8-e));return{scale:8<e?function(t){return t/i}:function(t){return t*i},symbol:t}})),n=0;return t&&(t<0&&(t*=-1),e&&(t=this.round(t,this.precision(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n<=0?n+1:n-1)/3)))),i[8+n/3]}},St=function(t){var e=/<%= ([^ ]+) %>|\$\{ ?([^{} ]+) ?\}|\{\{([^{} ]+)\}\}/g;return function(i){return i=i||{},t.replace(e,(function(t){for(var e=Array.from(arguments).slice(1,4).find((function(t){return!!t})).split("."),n=i[e.shift()];void 0!==n&&e.length;)n=n[e.shift()];return void 0!==n?n:""}))}},Mt=i.assign,Tt=i.defaults,Pt=Mt,Et=i.defaultsDeep,kt=i.assign,Dt=i.defaults,Ot=i.defaultsDeep,Rt=i.invokeMap||i.invoke,Lt=i.sortedIndexBy||i.sortedIndex,Nt=i.uniqBy||i.uniq,zt=i.clone,Bt=i.cloneDeep,Ft=i.isEmpty,jt=i.isEqual,Vt=i.isFunction,Ut=i.isPlainObject,Gt=i.toArray,Wt=i.debounce,Ht=i.groupBy,Xt=i.sortBy,Zt=i.flattenDeep,Yt=i.without,qt=i.difference,Kt=i.intersection,Jt=i.union,Qt=i.has,$t=i.result,te=i.omit,ee=i.pick,ie=i.bindAll,ne=i.forIn,re=i.camelCase,se=i.uniqueId,ae=function(){if(i.mergeWith){var t=Array.from(arguments),e=t[t.length-1],n=Vt(e)?e:ue;return t.push((function(t,e){var i=n(t,e);return void 0!==i?i:Array.isArray(t)&&!Array.isArray(e)?e:void 0})),i.mergeWith.apply(this,t)}return i.merge.apply(this,arguments)},oe=function(t){var e=Object.prototype.toString;return!0===t||!1===t||!!t&&"object"==a(t)&&"[object Boolean]"===e.call(t)},le=function(t){return!!t&&("object"==a(t)||"function"==typeof t)},he=function(t){var e=Object.prototype.toString;return"number"==typeof t||!!t&&"object"==a(t)&&"[object Number]"===e.call(t)},ce=function(t){var e=Object.prototype.toString;return"string"==typeof t||!!t&&"object"==a(t)&&"[object String]"===e.call(t)},ue=function(){};function de(t){t=Nt(t);var e=Gt(t).reduce((function(t,e){return t[e.id]=e.clone(),t}),{});return Gt(t).forEach((function(t){var i=e[t.id];if(i.isLink()){var n=i.source(),r=i.target();n.id&&e[n.id]&&i.prop("source/id",e[n.id].id),r.id&&e[r.id]&&i.prop("target/id",e[r.id].id)}var s=t.get("parent");s&&e[s]&&i.set("parent",e[s].id);var a=Gt(t.get("embeds")).reduce((function(t,i){return e[i]&&t.push(e[i].id),t}),[]);Ft(a)||i.set("embeds",a)})),e}function fe(t,e){return function(i,n){var r=pt(i);i=parseFloat(i),r&&(i/=100);var s={};if(isFinite(i)){var a=r||0<=i&&i<=1?i*n[e]:Math.max(i+n[e],0);s[t]=a}return s}}function pe(t,e,i){return function(n,r){var s,a=pt(n);if(n=parseFloat(n),a&&(n/=100),isFinite(n)){var o=r[i]();s=a||0<n&&n<1?o[t]+r[e]*n:o[t]+n}var l=S();return l[t]=s||0,l}}function me(t,e,i){return function(n,r){var s;s="middle"===n?r[e]/2:n===i?r[e]:isFinite(n)?-1<n&&n<1?-r[e]*n:-n:pt(n)?r[e]*parseFloat(n)/100:0;var a=S();return a[t]=-(r[t]+s),a}}function ge(t,e){var i="joint-shape",r=e&&e.resetOffset;return function(e,s,a){var o=n(a),l=o.data(i);if(!l||l.value!==e){var h=t(e);l={value:e,shape:h,shapeBBox:h.bbox()},o.data(i,l)}var c=l.shape.clone(),u=l.shapeBBox.clone(),d=u.origin(),f=s.origin();u.x=f.x,u.y=f.y;var p=s.maxRectScaleToFit(u,f),m=0===u.width||0===s.width?1:p.sx,g=0===u.height||0===s.height?1:p.sy;return c.scale(m,g,d),r&&c.translate(-d.x,-d.y),c}}function ve(t){var e=ge((function(t){return new I($.normalizePathData(t))}),t);return function(t,i,n){return{d:e(t,i,n).serialize()}}}function _e(t){var e=ge(M,t);return function(t,i,n){return{points:e(t,i,n).serialize()}}}function ye(t,e){var i=new S(1,0);return function(n){var r,s,a=this[t](n);return a?(s=e.rotate?a.vector().vectorAngle(i):0,r=a.start):(r=this.path.start,s=0),0===s?{transform:"translate("+r.x+","+r.y+")"}:{transform:"translate("+r.x+","+r.y+") rotate("+s+")"}}}function be(t,e,i){return void 0!==i.text}function xe(){return this.model.isLink()}function we(t){var e={},i=t.stroke;"string"==typeof i&&(e.stroke=i,e.fill=i);var n=t.strokeOpacity;return void 0===n&&(n=t["stroke-opacity"]),void 0===n&&(n=t.opacity),void 0!==n&&(e["stroke-opacity"]=n,e["fill-opacity"]=n),e}var Ae,Ce,Ie={xlinkHref:{set:"xlink:href"},xlinkShow:{set:"xlink:show"},xlinkRole:{set:"xlink:role"},xlinkType:{set:"xlink:type"},xlinkArcrole:{set:"xlink:arcrole"},xlinkTitle:{set:"xlink:title"},xlinkActuate:{set:"xlink:actuate"},xmlSpace:{set:"xml:space"},xmlBase:{set:"xml:base"},xmlLang:{set:"xml:lang"},preserveAspectRatio:{set:"preserveAspectRatio"},requiredExtension:{set:"requiredExtension"},requiredFeatures:{set:"requiredFeatures"},systemLanguage:{set:"systemLanguage"},externalResourcesRequired:{set:"externalResourceRequired"},filter:{qualify:Ut,set:function(t){return"url(#"+this.paper.defineFilter(t)+")"}},fill:{qualify:Ut,set:function(t){return"url(#"+this.paper.defineGradient(t)+")"}},stroke:{qualify:Ut,set:function(t){return"url(#"+this.paper.defineGradient(t)+")"}},sourceMarker:{qualify:Ut,set:function(t,e,i,n){return t=kt(we(n),t),{"marker-start":"url(#"+this.paper.defineMarker(t)+")"}}},targetMarker:{qualify:Ut,set:function(t,e,i,n){return t=kt(we(n),{transform:"rotate(180)"},t),{"marker-end":"url(#"+this.paper.defineMarker(t)+")"}}},vertexMarker:{qualify:Ut,set:function(t,e,i,n){return t=kt(we(n),t),{"marker-mid":"url(#"+this.paper.defineMarker(t)+")"}}},text:{qualify:function(t,e,i){return!i.textWrap||!Ut(i.textWrap)},set:function(t,e,i,r){var s=n(i),a="joint-text",o=s.data(a),l=ee(r,"lineHeight","annotations","textPath","x","textVerticalAnchor","eol","displayEmpty"),h=l.fontSize=r["font-size"]||r.fontSize,c=JSON.stringify([t,l]);if(void 0===o||o!==c){h&&i.setAttribute("font-size",h);var u=l.textPath;if(le(u)){var d=u.selector;if("string"==typeof d){var f=this.findBySelector(d)[0];f instanceof SVGPathElement&&(l.textPath=kt({"xlink:href":"#"+f.id},u))}}$(i).text(""+t,l),s.data(a,c)}}},textWrap:{qualify:Ut,set:function(t,e,i,n){var r=t.width||0;pt(r)?e.width*=parseFloat(r)/100:r<=0?e.width+=r:e.width=r;var s,a=t.height||0;pt(a)?e.height*=parseFloat(a)/100:a<=0?e.height+=a:e.height=a;var o=t.text;void 0===o&&(o=n.text),s=void 0!==o?gt(""+o,e,{"font-weight":n["font-weight"]||n.fontWeight,"font-size":n["font-size"]||n.fontSize,"font-family":n["font-family"]||n.fontFamily,lineHeight:n.lineHeight},{svgDocument:this.paper.svg,ellipsis:t.ellipsis,hyphen:t.hyphen,maxLineCount:t.maxLineCount}):"",Ie.text.set.call(this,s,e,i,n)}},title:{qualify:function(t,e){return e instanceof SVGElement},set:function(t,e,i){var r=n(i),s="joint-title",a=r.data(s);if(void 0===a||a!==t){r.data(s,t);var o=i.firstChild;if(o&&"TITLE"===o.tagName.toUpperCase())o.textContent=t;else{var l=document.createElementNS(i.namespaceURI,"title");l.textContent=t,i.insertBefore(l,o)}}}},lineHeight:{qualify:be},textVerticalAnchor:{qualify:be},textPath:{qualify:be},annotations:{qualify:be},eol:{qualify:be},displayEmpty:{qualify:be},port:{set:function(t){return null===t||void 0===t.id?t:t.id}},style:{qualify:Ut,set:function(t,e,i){n(i).css(t)}},html:{set:function(t,e,i){n(i).html(t+"")}},ref:{},refX:{position:pe("x","width","origin")},refY:{position:pe("y","height","origin")},refDx:{position:pe("x","width","corner")},refDy:{position:pe("y","height","corner")},refWidth:{set:fe("width","width")},refHeight:{set:fe("height","height")},refRx:{set:fe("rx","width")},refRy:{set:fe("ry","height")},refRInscribed:{set:(Ae=fe("r","width"),Ce=fe("r","height"),function(t,e){return(e.height>e.width?Ae:Ce)(t,e)})},refRCircumscribed:{set:function(t,e){var i=pt(t);t=parseFloat(t),i&&(t/=100);var n,r=Math.sqrt(e.height*e.height+e.width*e.width);return isFinite(t)&&(n=i||0<=t&&t<=1?t*r:Math.max(t+r,0)),{r:n}}},refCx:{set:fe("cx","width")},refCy:{set:fe("cy","height")},xAlignment:{offset:me("x","width","right")},yAlignment:{offset:me("y","height","bottom")},resetOffset:{offset:function(t,e){return t?{x:-e.x,y:-e.y}:{x:0,y:0}}},refDResetOffset:{set:ve({resetOffset:!0})},refDKeepOffset:{set:ve({resetOffset:!1})},refPointsResetOffset:{set:_e({resetOffset:!0})},refPointsKeepOffset:{set:_e({resetOffset:!1})},connection:{qualify:xe,set:function(t){var e,i=t.stubs;if(void 0===i&&(i=0),isFinite(i)&&0!==i){var n;n=i<0?(this.getConnectionLength()+i)/2:i;var r=this.getConnection(),s=r.divideAtLength(n),a=r.divideAtLength(-n);s&&a&&(e=s[0].serialize()+" "+a[1].serialize())}return{d:e||this.getSerializedConnection()}}},atConnectionLengthKeepGradient:{qualify:xe,set:ye("getTangentAtLength",{rotate:!0})},atConnectionLengthIgnoreGradient:{qualify:xe,set:ye("getTangentAtLength",{rotate:!1})},atConnectionRatioKeepGradient:{qualify:xe,set:ye("getTangentAtRatio",{rotate:!0})},atConnectionRatioIgnoreGradient:{qualify:xe,set:ye("getTangentAtRatio",{rotate:!1})}};Ie.refR=Ie.refRInscribed,Ie.refD=Ie.refDResetOffset,Ie.refPoints=Ie.refPointsResetOffset,Ie.atConnectionLength=Ie.atConnectionLengthKeepGradient,Ie.atConnectionRatio=Ie.atConnectionRatioKeepGradient,Ie.refX2=Ie.refX,Ie.refY2=Ie.refY,Ie.refWidth2=Ie.refWidth,Ie.refHeight2=Ie.refHeight,Ie["ref-x"]=Ie.refX,Ie["ref-y"]=Ie.refY,Ie["ref-dy"]=Ie.refDy,Ie["ref-dx"]=Ie.refDx,Ie["ref-width"]=Ie.refWidth,Ie["ref-height"]=Ie.refHeight,Ie["x-alignment"]=Ie.xAlignment,Ie["y-alignment"]=Ie.yAlignment;var Se=Ie,Me=e.Model.extend({constructor:function(t,e){var i,n=t||{};this.cid=se("c"),this.attributes={},e&&e.collection&&(this.collection=e.collection),e&&e.parse&&(n=this.parse(n,e)||{}),(i=$t(this,"defaults"))&&(n=ae({},i,n)),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)},translate:function(t,e,i){throw new Error("Must define a translate() method.")},toJSON:function(){var t=this.constructor.prototype.defaults.attrs||{},e=this.attributes.attrs,i={};ne(e,(function(e,n){var r=t[n];ne(e,(function(t,e){le(t)&&!Array.isArray(t)?ne(t,(function(t,s){r&&r[e]&&jt(r[e][s],t)||(i[n]=i[n]||{},(i[n][e]||(i[n][e]={}))[s]=t)})):r&&jt(r[e],t)||(i[n]=i[n]||{},i[n][e]=t)}))}));var n=Bt(te(this.attributes,"attrs"));return n.attrs=i,n},initialize:function(t){t&&t.id||this.set("id",this.generateId(),{silent:!0}),this._transitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},generateId:function(){return lt()},processPorts:function(){var t=this.ports,e={};ne(this.get("attrs"),(function(t,i){t&&t.port&&(void 0!==t.port.id?e[t.port.id]=t.port:e[t.port]={id:t.port})}));var i={};ne(t,(function(t,n){e[n]||(i[n]=!0)})),this.graph&&!Ft(i)&&(this.graph.getConnectedLinks(this,{inbound:!0}).forEach((function(t){i[t.get("target").port]&&t.remove()})),this.graph.getConnectedLinks(this,{outbound:!0}).forEach((function(t){i[t.get("source").port]&&t.remove()}))),this.ports=e},remove:function(t){t=t||{};var e=this.graph;if(!e)return this.collection&&this.collection.remove(this,t),this;e.startBatch("remove");var i=this.getParentCell();i&&i.unembed(this);for(var n=this.getEmbeddedCells(),r=0,s=n.length;r<s;r++){var a=n[r];a&&a.remove(t)}return this.trigger("remove",this,e.attributes.cells,t),e.stopBatch("remove"),this},toFront:function(t){var e=this.graph;if(e){t=t||{};var i,n=e.maxZIndex();t.deep?(i=this.getEmbeddedCells({deep:!0,breadthFirst:!0})).unshift(this):i=[this],n=n-i.length+1;var r=e.get("cells"),s=r.indexOf(this)!==r.length-i.length;s||(s=i.some((function(t,e){return t.get("z")!==n+e}))),s&&(this.startBatch("to-front"),n+=i.length,i.forEach((function(e,i){e.set("z",n+i,t)})),this.stopBatch("to-front"))}return this},toBack:function(t){var e=this.graph;if(e){t=t||{};var i,n=e.minZIndex();t.deep?(i=this.getEmbeddedCells({deep:!0,breadthFirst:!0})).unshift(this):i=[this];var r=0!==e.get("cells").indexOf(this);r||(r=i.some((function(t,e){return t.get("z")!==n+e}))),r&&(this.startBatch("to-back"),n-=i.length,i.forEach((function(e,i){e.set("z",n+i,t)})),this.stopBatch("to-back"))}return this},parent:function(t,e){return void 0===t?this.get("parent"):this.set("parent",t,e)},embed:function(t,e){if(this===t||this.isEmbeddedIn(t))throw new Error("Recursive embedding not allowed.");this.startBatch("embed");var i=kt([],this.get("embeds"));return i[t.isLink()?"unshift":"push"](t.id),t.parent(this.id,e),this.set("embeds",Nt(i),e),this.stopBatch("embed"),this},unembed:function(t,e){return this.startBatch("unembed"),t.unset("parent",e),this.set("embeds",Yt(this.get("embeds"),t.id),e),this.stopBatch("unembed"),this},getParentCell:function(){var t=this.parent(),e=this.graph;return t&&e&&e.getCell(t)||null},getAncestors:function(){var t=[];if(!this.graph)return t;for(var e=this.getParentCell();e;)t.push(e),e=e.getParentCell();return t},getEmbeddedCells:function(t){if(t=t||{},this.graph){var e;if(t.deep)if(t.breadthFirst){e=[];for(var i=this.getEmbeddedCells();0<i.length;){var n=i.shift();e.push(n),i.push.apply(i,n.getEmbeddedCells())}}else(e=this.getEmbeddedCells()).forEach((function(i){e.push.apply(e,i.getEmbeddedCells(t))}));else e=Gt(this.get("embeds")).map(this.graph.getCell,this.graph);return e}return[]},isEmbeddedIn:function(t,e){var i=ce(t)?t:t.id,n=this.parent();if(e=Dt({deep:!0},e),this.graph&&e.deep){for(;n;){if(n===i)return!0;n=this.graph.getCell(n).parent()}return!1}return n===i},isEmbedded:function(){return!!this.parent()},clone:function(t){if((t=t||{}).deep)return Gt(de([this].concat(this.getEmbeddedCells({deep:!0}))));var i=e.Model.prototype.clone.apply(this,arguments);return i.set("id",this.generateId()),i.unset("embeds"),i.unset("parent"),i},prop:function(t,e,i){var n=ce(t);if(n||Array.isArray(t)){if(1<arguments.length){var r,s,a=(s=n?(r=t).split("/"):(r=t.join("/"),t.slice()))[0],o=s.length;if((i=i||{}).propertyPath=r,i.propertyValue=e,i.propertyPathArray=s,1===o)return this.set(a,e,i);for(var l={},h=l,c=a,u=1;u<o;u++){var d=s[u],f=Number.isFinite(n?Number(d):d);h=h[c]=f?[]:{},c=d}l=at(l,s,e,"/");var p=ae({},this.attributes);i.rewrite&&ot(p,r,"/");var m=ae(p,l);return this.set(a,m[a],i)}return st(this.attributes,t,"/")}return this.set(ae({},this.attributes,t),e)},removeProp:function(t,e){e=e||{};var i=Array.isArray(t)?t:t.split("/"),n=i[0];if("attrs"===n&&(e.dirty=!0),1===i.length)return this.unset(t,e);var r=i.slice(1),s=Bt(this.get(n));return ot(s,r,"/"),this.set(n,s,e)},attr:function(t,e,i){var n=Array.from(arguments);return 0===n.length?this.get("attrs"):(Array.isArray(t)?n[0]=["attrs"].concat(t):ce(t)?n[0]="attrs/"+t:n[0]={attrs:t},this.prop.apply(this,n))},removeAttr:function(t,e){return Array.isArray(t)?this.removeProp(["attrs"].concat(t)):this.removeProp("attrs/"+t,e)},transition:function(t,e,i,n){n=n||"/",i=kt({duration:100,delay:10,timingFunction:wt.linear,valueFunction:At.number},i);var r,s=0,a=function(e){var n,o,l;(o=(e-=s=s||e)/i.duration)<1?this._transitionIds[t]=n=dt(a):(o=1,delete this._transitionIds[t]),l=r(i.timingFunction(o)),i.transitionId=n,this.prop(t,l,i),n||this.trigger("transition:end",this,t)}.bind(this),o=function(s){this.stopTransitions(t),r=i.valueFunction(st(this.attributes,t,n),e),this._transitionIds[t]=dt(s),this.trigger("transition:start",this,t)}.bind(this);return setTimeout(o,i.delay,a)},getTransitions:function(){return Object.keys(this._transitionIds)},stopTransitions:function(t,e){e=e||"/";var i=t&&t.split(e);return Object.keys(this._transitionIds).filter(i&&function(t){return jt(i,t.split(e).slice(0,i.length))}).forEach((function(t){ft(this._transitionIds[t]),delete this._transitionIds[t],this.trigger("transition:end",this,t)}),this),this},addTo:function(t,e){return t.addCell(this,e),this},findView:function(t){return t.findViewByModel(this)},isElement:function(){return!1},isLink:function(){return!1},startBatch:function(t,e){return this.graph&&this.graph.startBatch(t,kt({},e,{cell:this})),this},stopBatch:function(t,e){return this.graph&&this.graph.stopBatch(t,kt({},e,{cell:this})),this},getChangeFlag:function(t){var e=0;if(!t)return e;for(var i in t)t.hasOwnProperty(i)&&this.hasChanged(i)&&(e|=t[i]);return e},angle:function(){return 0},position:function(){return new S(0,0)},getPointFromConnectedLink:function(){return new S},getBBox:function(){return new T(0,0,0,0)}},{getAttributeDefinition:function(t){var e=this.attributes,i=Se;return e&&e[t]||i[t]},define:function(t,e,i,n){i=kt({defaults:Ot({type:t},e,this.prototype.defaults)},i);var r=this.extend(i,n);return"undefined"!=typeof joint&&Qt(joint,"shapes")&&at(joint.shapes,t,r,"."),r}}),Te=function(t,e,i){if(ce(i)){if(!Pe[i])throw new Error('Unknown wrapper: "'+i+'"');i=Pe[i]}if(!Vt(i))throw new Error("Wrapper must be a function.");Gt(e).forEach((function(e){t[e]=i(t[e])}))},Pe={cells:function(t){return function(){var e=Array.from(arguments),i=e.length,n=0<i&&e[0]||[],r=1<i&&e[i-1]||{};return Array.isArray(n)||(r instanceof Me?n=e:n instanceof Me&&(1<e.length&&e.pop(),n=e)),r instanceof Me&&(r={}),t.call(this,n,r)}}},Ee={wrapWith:Te,wrappers:Pe,addClassNamePrefix:et,removeClassNamePrefix:it,parseDOMJSON:nt,hashCode:rt,getByPath:st,setByPath:at,unsetByPath:ot,flattenObject:function t(e,i,n){i=i||"/";var r={};for(var s in e)if(e.hasOwnProperty(s)){var o="object"==a(e[s]);if(o&&n&&n(e[s])&&(o=!1),o){var l=t(e[s],i,n);for(var h in l)l.hasOwnProperty(h)&&(r[s+i+h]=l[h])}else r[s]=e[s]}return r},uuid:lt,guid:ht,toKebabCase:ct,normalizeEvent:ut,nextFrame:dt,cancelFrame:ft,shapePerimeterConnectionPoint:function(t,e,i,n){var r,s;if(!i){var a=e.$(".scalable")[0],o=e.$(".rotatable")[0];a&&a.firstChild?i=a.firstChild:o&&o.firstChild&&(i=o.firstChild)}return i?(s=$(i).findIntersection(n,t.paper.cells))||(r=$(i).getBBox({target:t.paper.cells})):s=(r=e.model.getBBox()).intersectionWithLineFromCenterToPoint(n),s||r.center()},isPercentage:pt,parseCssNumeric:mt,breakText:gt,sanitizeHTML:vt,downloadBlob:_t,downloadDataUri:function(t,e){var i=yt(t);_t(i,e)},dataUriToBlob:yt,imageToDataUri:function(t,e){if(!t||"data:"===t.substr(0,"data:".length))return setTimeout((function(){e(null,t)}),0);var i=new XMLHttpRequest;i.open("GET",t,!0),i.addEventListener("error",(function(){e(new Error("Failed to load image "+t))})),i.responseType=window.FileReader?"blob":"arraybuffer",i.addEventListener("load",(function(){window.FileReader?function(e,i){if(200===e.status){var n=new FileReader;n.onload=function(t){var e=t.target.result;i(null,e)},n.onerror=function(){i(new Error("Failed to load image "+t))},n.readAsDataURL(e.response)}else i(new Error("Failed to load image "+t))}(i,e):function(e,i){if(200===e.status){var n=new Uint8Array(e.response),r=t.split(".").pop()||"png";i(null,"data:image/"+({svg:"svg+xml"}[r]||r)+";base64,"+btoa(function(t){for(var e=[],i=0;i<t.length;i+=32768)e.push(String.fromCharCode.apply(null,t.subarray(i,i+32768)));return e.join("")}(n)))}else i(new Error("Failed to load image "+t))}(i,e)})),i.send()},getElementBBox:function(t){var e=n(t);if(0===e.length)throw new Error("Element not found");var i=e[0],r=i.ownerDocument,s=i.getBoundingClientRect(),a=0,o=0;if(i.ownerSVGElement){var l=$(i),h=l.getBBox({target:l.svg()});a=s.width-h.width,o=s.height-h.height}return{x:s.left+window.pageXOffset-r.documentElement.offsetLeft+a/2,y:s.top+window.pageYOffset-r.documentElement.offsetTop+o/2,width:s.width-a,height:s.height-o}},sortElements:bt,setAttributesBySelector:function(t,e){var i=n(t);ne(e,(function(t,e){var n=i.find(e).addBack().filter(e);Qt(t,"class")&&(n.addClass(t.class),t=te(t,"class")),n.attr(t)}))},normalizeSides:xt,timing:wt,interpolate:At,filter:Ct,format:It,template:St,toggleFullScreen:function(t){var e=window.top.document;function i(t,e){for(var i=["webkit","moz","ms","o",""],n=0;n<i.length;n++){var r=i[n],s=r?r+e:e.substr(0,1).toLowerCase()+e.substr(1);if(void 0!==t[s])return Vt(t[s])?t[s]():t[s]}}t=t||e.body,i(e,"FullscreenElement")||i(e,"FullScreenElement")?i(e,"ExitFullscreen")||i(e,"CancelFullScreen"):i(t,"RequestFullscreen")||i(t,"RequestFullScreen")},mixin:Mt,supplement:Tt,deepMixin:Pt,deepSupplement:Et,assign:kt,defaults:Dt,defaultsDeep:Ot,invoke:Rt,sortedIndex:Lt,uniq:Nt,clone:zt,cloneDeep:Bt,isEmpty:Ft,isEqual:jt,isFunction:Vt,isPlainObject:Ut,toArray:Gt,debounce:Wt,groupBy:Ht,sortBy:Xt,flattenDeep:Zt,without:Yt,difference:qt,intersection:Kt,union:Jt,has:Qt,result:$t,omit:te,pick:ee,bindAll:ie,forIn:ne,camelCase:re,uniqueId:se,merge:ae,isBoolean:oe,isObject:le,isNumber:he,isString:ce,noop:ue,cloneCells:de};function ke(t,e,i){var n=t.toJSON();return n.angle=e||0,Dt({},i,n)}function De(t,e,i){return t.map((function(t,e,i){var n=this.pointAt((e+.5)/i.length);return(t.dx||t.dy)&&n.offset(t.dx||0,t.dy||0),ke(n.round(),0,t)}),L(e,i))}function Oe(t,e,i,n){var r=e.center(),s=e.width/e.height,a=e.topMiddle(),o=A.fromRect(e);return t.map((function(t,e,l){var h=i+n(e,l.length),c=a.clone().rotate(r,-h).scale(s,1,r),u=t.compensateRotation?-o.tangentTheta(c):0;return(t.dx||t.dy)&&c.offset(t.dx||0,t.dy||0),t.dr&&c.move(r,t.dr),ke(c.round(),u,t)}))}function Re(t,e){var i=e.x;ce(i)&&(i=parseFloat(i)/100*t.width);var n=e.y;return ce(n)&&(n=parseFloat(n)/100*t.height),N(i||0,n||0)}var Le={absolute:function(t,e,i){return t.map(Re.bind(null,e))},fn:function(t,e,i){return i.fn(t,e,i)},line:function(t,e,i){return De(t,Re(e,i.start||e.origin()),Re(e,i.end||e.corner()))},left:function(t,e,i){return De(t,e.origin(),e.bottomLeft())},right:function(t,e,i){return De(t,e.topRight(),e.corner())},top:function(t,e,i){return De(t,e.origin(),e.topRight())},bottom:function(t,e,i){return De(t,e.bottomLeft(),e.corner())},ellipseSpread:function(t,e,i){var n=i.startAngle||0,r=i.step||360/t.length;return Oe(t,e,n,(function(t){return t*r}))},ellipse:function(t,e,i){var n=i.startAngle||0,r=i.step||20;return Oe(t,e,n,(function(t,e){return(t+.5-e/2)*r}))}};function Ne(t,e){return Ot({},t,e,{x:0,y:0,angle:0,attrs:{".":{y:"0","text-anchor":"start"}}})}function ze(t,e,i,n){n=Dt({},n,{offset:15});var r,s,a,o,l=e.center().theta(t),h=Be(e),c=n.offset,u=0;o=l<h[1]||l>h[2]?(a=".3em",r=c,s=0,"start"):l<h[0]?(a="0",r=0,s=-c,i?(u=-90,"start"):"middle"):l<h[3]?(a=".3em",r=-c,s=0,"end"):(a=".6em",r=0,s=c,i?(u=90,"start"):"middle");var d=Math.round;return Ne({x:d(r),y:d(s),angle:u,attrs:{".":{y:a,"text-anchor":o}}})}function Be(t){var e=t.center(),i=e.theta(t.origin()),n=e.theta(t.bottomLeft()),r=e.theta(t.corner());return[i,e.theta(t.topRight()),r,n]}function Fe(t,e,i,n){var r,s,a,o,l=e.center().theta(t),h=(n=Dt({},n,{offset:15})).offset,c=0,u=Be(e);o=l<u[1]||l>u[2]?(a=".3em",r=-h,s=0,"end"):l<u[0]?(a=".6em",r=0,s=h,i?(c=90,"start"):"middle"):l<u[3]?(a=".3em",r=h,s=0,"start"):(a="0em",r=0,s=-h,i?(c=-90,"start"):"middle");var d=Math.round;return Ne({x:d(r),y:d(s),angle:c,attrs:{".":{y:a,"text-anchor":o}}})}function je(t,e,i){i=Dt({},i,{offset:20});var n,r=N(0,0),s=-t.theta(r),a=s,o=t.clone().move(r,i.offset).difference(t).round(),l=".3em";(s+90)%180==0?(n=e?"end":"middle",e||-270!==s||(l="0em")):-270<s&&s<-90?(n="start",a=s-180):n="end";var h=Math.round;return Ne({x:h(o.x),y:h(o.y),angle:e?a:0,attrs:{".":{y:l,"text-anchor":n}}})}var Ve={manual:function(t,e,i){return Ne(i,e)},left:function(t,e,i){return Ne(i,{x:-15,attrs:{".":{y:".3em","text-anchor":"end"}}})},right:function(t,e,i){return Ne(i,{x:15,attrs:{".":{y:".3em","text-anchor":"start"}}})},top:function(t,e,i){return Ne(i,{y:-15,attrs:{".":{"text-anchor":"middle"}}})},bottom:function(t,e,i){return Ne(i,{y:15,attrs:{".":{y:".6em","text-anchor":"middle"}}})},outsideOriented:function(t,e,i){return ze(t,e,!0,i)},outside:function(t,e,i){return ze(t,e,!1,i)},insideOriented:function(t,e,i){return Fe(t,e,!0,i)},inside:function(t,e,i){return Fe(t,e,!1,i)},radial:function(t,e,i){return je(t.difference(e.center()),!1,i)},radialOriented:function(t,e,i){return je(t.difference(e.center()),!0,i)}},Ue=Me.extend({markup:['<path class="connection" stroke="black" d="M 0 0 0 0"/>','<path class="marker-source" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="marker-target" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="connection-wrap" d="M 0 0 0 0"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z" />',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),doubleToolMarkup:void 0,vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaultLabel:void 0,labelMarkup:void 0,_builtins:{defaultLabel:{markup:[{tagName:"rect",selector:"rect"},{tagName:"text",selector:"text"}],attrs:{text:{fill:"#000000",fontSize:14,textAnchor:"middle",yAlignment:"middle",pointerEvents:"none"},rect:{ref:"text",fill:"#ffffff",rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}}},defaults:{type:"link",source:{},target:{}},isLink:function(){return!0},disconnect:function(t){return this.set({source:{x:0,y:0},target:{x:0,y:0}},t)},source:function(t,e,i){return void 0===t?zt(this.get("source")):(r=t instanceof Me?((n=zt(e)||{}).id=t.id,i):Ut(t)?(n=t,e):((n=zt(e)||{}).x=t.x,n.y=t.y,i),this.set("source",n,r));var n,r},target:function(t,e,i){return void 0===t?zt(this.get("target")):(r=t instanceof Me?((n=zt(e)||{}).id=t.id,i):Ut(t)?(n=t,e):((n=zt(e)||{}).x=t.x,n.y=t.y,i),this.set("target",n,r));var n,r},router:function(t,e,i){if(void 0===t){var n=this.get("router");return n?"object"==a(n)?zt(n):n:this.get("manhattan")?{name:"orthogonal"}:null}var r="object"==a(t)||"function"==typeof t,s=r?t:{name:t,args:e},o=r?e:i;return this.set("router",s,o)},connector:function(t,e,i){if(void 0===t){var n=this.get("connector");return n?"object"==a(n)?zt(n):n:this.get("smooth")?{name:"smooth"}:null}var r="object"==a(t)||"function"==typeof t,s=r?t:{name:t,args:e},o=r?e:i;return this.set("connector",s,o)},label:function(t,e,i){var n=this.labels();return(t=isFinite(t)&&null!==t?0|t:0)<0&&(t=n.length+t),arguments.length<=1?this.prop(["labels",t]):this.prop(["labels",t],e,i)},labels:function(t,e){return 0===arguments.length?(t=this.get("labels"),Array.isArray(t)?t.slice():[]):(Array.isArray(t)||(t=[]),this.set("labels",t,e))},insertLabel:function(t,e,i){if(!e)throw new Error("dia.Link: no label provided");var n=this.labels(),r=n.length;return(t=isFinite(t)&&null!==t?0|t:r)<0&&(t=r+t+1),n.splice(t,0,e),this.labels(n,i)},appendLabel:function(t,e){return this.insertLabel(-1,t,e)},removeLabel:function(t,e){var i=this.labels();return t=isFinite(t)&&null!==t?0|t:-1,i.splice(t,1),this.labels(i,e)},vertex:function(t,e,i){var n=this.vertices();if((t=isFinite(t)&&null!==t?0|t:0)<0&&(t=n.length+t),arguments.length<=1)return this.prop(["vertices",t]);var r=this._normalizeVertex(e);return this.prop(["vertices",t],r,i)},vertices:function(t,e){if(0===arguments.length)return t=this.get("vertices"),Array.isArray(t)?t.slice():[];Array.isArray(t)||(t=[]);for(var i=[],n=0;n<t.length;n++){var r=t[n],s=this._normalizeVertex(r);i.push(s)}return this.set("vertices",i,e)},insertVertex:function(t,e,i){if(!e)throw new Error("dia.Link: no vertex provided");var n=this.vertices(),r=n.length;(t=isFinite(t)&&null!==t?0|t:r)<0&&(t=r+t+1);var s=this._normalizeVertex(e);return n.splice(t,0,s),this.vertices(n,i)},removeVertex:function(t,e){var i=this.vertices();return t=isFinite(t)&&null!==t?0|t:-1,i.splice(t,1),this.vertices(i,e)},_normalizeVertex:function(t){return Ut(t)?t:{x:t.x,y:t.y}},translate:function(t,e,i){return(i=i||{}).translateBy=i.translateBy||this.id,i.tx=t,i.ty=e,this.applyToPoints((function(i){return{x:(i.x||0)+t,y:(i.y||0)+e}}),i)},scale:function(t,e,i,n){return this.applyToPoints((function(n){return S(n).scale(t,e,i).toJSON()}),n)},applyToPoints:function(t,e){if(!Vt(t))throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.");var i={},n=this.attributes,r=n.source,s=n.target;r.id||(i.source=t(r)),s.id||(i.target=t(s));var a=this.vertices();return 0<a.length&&(i.vertices=a.map(t)),this.set(i,e)},getSourcePoint:function(){var t=this.getSourceCell();return t?t.getPointFromConnectedLink(this,"source"):new S(this.source())},getTargetPoint:function(){var t=this.getTargetCell();return t?t.getPointFromConnectedLink(this,"target"):new S(this.target())},getPointFromConnectedLink:function(){return this.getPolyline().pointAt(.5)},getPolyline:function(){var t=[this.getSourcePoint(),this.getTargetPoint()],e=this.vertices();return 0<e.length&&Array.prototype.push.apply(t,e.map(S)),new M(t)},getBBox:function(){return this.getPolyline().bbox()},reparent:function(t){var e;if(this.graph){var i=this.getSourceElement(),n=this.getTargetElement(),r=this.getParentCell();i&&n&&(e=i===n||i.isEmbeddedIn(n)?n:n.isEmbeddedIn(i)?i:this.graph.getCommonAncestor(i,n)),!r||e&&e.id===r.id||r.unembed(this,t),e&&e.embed(this,t)}return e},hasLoop:function(t){t=t||{};var e=this.attributes,i=e.source,n=e.target,r=i.id,s=n.id;if(!r||!s)return!1;var a=r===s;if(!a&&t.deep&&this.graph){var o=this.getSourceCell(),l=this.getTargetCell();a=o.isEmbeddedIn(l)||l.isEmbeddedIn(o)}return a},getSourceCell:function(){var t=this.graph,e=this.attributes.source;return e&&e.id&&t&&t.getCell(e.id)||null},getSourceElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getSourceCell()}while(t&&t.isLink());return t},getTargetCell:function(){var t=this.graph,e=this.attributes.target;return e&&e.id&&t&&t.getCell(e.id)||null},getTargetElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getTargetCell()}while(t&&t.isLink());return t},getRelationshipAncestor:function(){var t;if(this.graph){var e=[this,this.getSourceElement(),this.getTargetElement()].filter((function(t){return!!t}));t=this.graph.getCommonAncestor.apply(this.graph,e)}return t||null},isRelationshipEmbeddedIn:function(t){var e=ce(t)||he(t)?t:t.id,i=this.getRelationshipAncestor();return!!i&&(i.id===e||i.isEmbeddedIn(e))},_getDefaultLabel:function(){var t=this.get("defaultLabel")||this.defaultLabel||{},e={};return e.markup=t.markup||this.get("labelMarkup")||this.labelMarkup,e.position=t.position,e.attrs=t.attrs,e.size=t.size,e}},{endsEqual:function(t,e){var i=t.port===e.port||!t.port&&!e.port;return t.id===e.id&&i}}),Ge=function(t){var e=Bt(t)||{};this.ports=[],this.groups={},this.portLayoutNamespace=Le,this.portLabelLayoutNamespace=Ve,this._init(e)};Ge.prototype={getPorts:function(){return this.ports},getGroup:function(t){return this.groups[t]||{}},getPortsByGroup:function(t){return this.ports.filter((function(e){return e.group===t}))},getGroupPortsMetrics:function(t,e){var i=this.getGroup(t),n=this.getPortsByGroup(t),r=i.position||{},s=r.name,a=this.portLayoutNamespace;a[s]||(s="left");var o=r.args||{},l=n.map((function(t){return t&&t.position&&t.position.args})),h=a[s](l,e,o),c={ports:n,result:[]};return Gt(h).reduce(function(t,i,n){var r=t.ports[n];return t.result.push({portId:r.id,portTransformation:i,labelTransformation:this._getPortLabelLayout(r,S(i),e),portAttrs:r.attrs,portSize:r.size,labelSize:r.label.size}),t}.bind(this),c),c.result},_getPortLabelLayout:function(t,e,i){var n=this.portLabelLayoutNamespace,r=t.label.position.name||"left";return n[r]?n[r](e,i,t.label.position.args):null},_init:function(t){if(le(t.groups))for(var e=Object.keys(t.groups),i=0,n=e.length;i<n;i++){var r=e[i];this.groups[r]=this._evaluateGroup(t.groups[r])}for(var s=Gt(t.items),a=0,o=s.length;a<o;a++)this.ports.push(this._evaluatePort(s[a]))},_evaluateGroup:function(t){return ae(t,{position:this._getPosition(t.position,!0),label:this._getLabel(t,!0)})},_evaluatePort:function(t){var e=kt({},t),i=this.getGroup(t.group);return e.markup=e.markup||i.markup,e.attrs=ae({},i.attrs,e.attrs),e.position=this._createPositionNode(i,e),e.label=ae({},i.label,this._getLabel(e)),e.z=this._getZIndex(i,e),e.size=kt({},i.size,e.size),e},_getZIndex:function(t,e){return he(e.z)?e.z:he(t.z)||"auto"===t.z?t.z:"auto"},_createPositionNode:function(t,e){return ae({name:"left",args:{}},t.position,{args:e.args})},_getPosition:function(t,e){var i,n={};Vt(t)?(i="fn",n.fn=t):ce(t)?i=t:void 0===t?i=e?"left":null:Array.isArray(t)?(i="absolute",n.x=t[0],n.y=t[1]):le(t)&&(i=t.name,kt(n,t.args));var r={args:n};return i&&(r.name=i),r},_getLabel:function(t,e){var i=t.label||{},n=i;return n.position=this._getPosition(i.position,e),n}};var We={_initializePorts:function(){this._createPortData(),this.on("change:ports",(function(){this._processRemovedPort(),this._createPortData()}),this)},_processRemovedPort:function(){var t=this.get("ports")||{},e={};Gt(t.items).forEach((function(t){e[t.id]=!0}));var i=this.previous("ports")||{},n={};Gt(i.items).forEach((function(t){e[t.id]||(n[t.id]=!0)}));var r=this.graph;r&&!Ft(n)&&(r.getConnectedLinks(this,{inbound:!0}).forEach((function(t){n[t.get("target").port]&&t.remove()})),r.getConnectedLinks(this,{outbound:!0}).forEach((function(t){n[t.get("source").port]&&t.remove()})))},hasPorts:function(){var t=this.prop("ports/items");return Array.isArray(t)&&0<t.length},hasPort:function(t){return-1!==this.getPortIndex(t)},getPorts:function(){return Bt(this.prop("ports/items"))||[]},getGroupPorts:function(t){var e=Gt(this.prop(["ports","items"])).filter((function(e){return e.group===t}));return Bt(e)},getPort:function(t){return Bt(Gt(this.prop("ports/items")).find((function(e){return e.id&&e.id===t})))},getPortsPositions:function(t){return this._portSettingsData.getGroupPortsMetrics(t,T(this.size())).reduce((function(t,e){var i=e.portTransformation;return t[e.portId]={x:i.x,y:i.y,angle:i.angle},t}),{})},getPortIndex:function(t){var e=le(t)?t.id:t;return this._isValidPortId(e)?Gt(this.prop("ports/items")).findIndex((function(t){return t.id===e})):-1},addPort:function(t,e){if(!le(t)||Array.isArray(t))throw new Error("Element: addPort requires an object.");var i=kt([],this.prop("ports/items"));return i.push(t),this.prop("ports/items",i,e),this},portProp:function(t,e,i,n){var r=this.getPortIndex(t);if(-1===r)throw new Error("Element: unable to find port with id "+t);var s=Array.prototype.slice.call(arguments,1);return Array.isArray(e)?s[0]=["ports","items",r].concat(e):ce(e)?s[0]=["ports/items/",r,"/",e].join(""):(s=["ports/items/"+r],Ut(e)&&(s.push(e),s.push(i))),this.prop.apply(this,s)},_validatePorts:function(){var t=this.get("ports")||{},e=[],i=Gt((t=t||{}).items);return i.forEach((function(t){"object"!=a(t)&&e.push("Element: invalid port ",t),this._isValidPortId(t.id)||(t.id=this.generatePortId())}),this),Nt(i,"id").length!==i.length&&e.push("Element: found id duplicities in ports."),e},generatePortId:function(){return this.generateId()},_isValidPortId:function(t){return null!=t&&!le(t)},addPorts:function(t,e){return t.length&&this.prop("ports/items",kt([],this.prop("ports/items")).concat(t),e),this},removePort:function(t,e){var i=e||{},n=this.getPortIndex(t);if(-1!==n){var r=kt([],this.prop(["ports","items"]));r.splice(n,1),i.rewrite=!0,this.startBatch("port-remove"),this.prop(["ports","items"],r,i),this.stopBatch("port-remove")}return this},removePorts:function(t,e){var i,n;if(Array.isArray(t)){if(i=e||{},0===t.length)return this.this;n=kt([],this.prop(["ports","items"])).filter((function(e){return!t.some((function(t){var i=le(t)?t.id:t;return e.id===i}))}))}else i=t||{},n=[];return this.startBatch("port-remove"),i.rewrite=!0,this.prop(["ports","items"],n,i),this.stopBatch("port-remove"),this},_createPortData:function(){var t,e=this._validatePorts();if(0<e.length)throw this.set("ports",this.previous("ports")),new Error(e.join(" "));this._portSettingsData&&(t=this._portSettingsData.getPorts()),this._portSettingsData=new Ge(this.get("ports"));var i=this._portSettingsData.getPorts();if(t){var n=i.filter((function(e){if(!t.find((function(t){return t.id===e.id})))return e})),r=t.filter((function(t){if(!i.find((function(e){return e.id===t.id})))return t}));0<r.length&&this.trigger("ports:remove",this,r),0<n.length&&this.trigger("ports:add",this,n)}}},He={portContainerMarkup:"g",portMarkup:[{tagName:"circle",selector:"circle",attributes:{r:10,fill:"#FFFFFF",stroke:"#000000"}}],portLabelMarkup:[{tagName:"text",selector:"text",attributes:{fill:"#000000"}}],_portElementsCache:null,_initializePorts:function(){this._cleanPortsCache()},_refreshPorts:function(){this._removePorts(),this._cleanPortsCache(),this._renderPorts()},_cleanPortsCache:function(){this._portElementsCache={}},_renderPorts:function(){for(var t=[],e=this._getContainerElement(),i=0,n=e.node.childNodes.length;i<n;i++)t.push(e.node.childNodes[i]);var r=Ht(this.model._portSettingsData.getPorts(),"z");Gt(r.auto).forEach((function(i){var n=this._getPortElement(i);e.append(n),t.push(n)}),this);for(var s=Object.keys(r),a=0;a<s.length;a++){var o=s[a];if("auto"!==o){var l=parseInt(o,10);this._appendPorts(r[o],l,t)}}this._updatePorts()},_getContainerElement:function(){return this.rotatableNode||this.vel},_appendPorts:function(t,e,i){var n=this._getContainerElement(),r=Gt(t).map(this._getPortElement,this);i[e]||e<0?$(i[Math.max(e,0)]).before(r):n.append(r)},_getPortElement:function(t){return this._portElementsCache[t.id]?this._portElementsCache[t.id].portElement:this._createPortElement(t)},findPortNode:function(t,e){var i=this._portElementsCache[t];if(!i)return null;var n=i.portContentElement.node,r=i.portContentSelectors;return this.findBySelector(e,n,r)[0]},_updatePorts:function(){this._updatePortGroup(void 0),Object.keys(this.model._portSettingsData.groups).forEach(this._updatePortGroup,this)},_removePorts:function(){Rt(this._portElementsCache,"portElement.remove")},_createPortElement:function(t){var e,i,n,r=$(this.portContainerMarkup).addClass("joint-port"),s=this._getPortMarkup(t);if(Array.isArray(s)){var a=this.parseDOMJSON(s,r.node),o=a.fragment;e=1<o.childNodes.length?$("g").append(o):$(o.firstChild),n=a.selectors}else e=$(s),Array.isArray(e)&&(e=$("g").append(e));if(!e)throw new Error("ElementView: Invalid port markup.");e.attr({port:t.id,"port-group":t.group});var l,h,c=this._getPortLabelMarkup(t.label);if(Array.isArray(c)){var u=this.parseDOMJSON(c,r.node),d=u.fragment;i=1<d.childNodes.length?$("g").append(d):$(d.firstChild),l=u.selectors}else i=$(c),Array.isArray(i)&&(i=$("g").append(i));if(!i)throw new Error("ElementView: Invalid port label markup.");if(n&&l){for(var f in l)if(n[f]&&f!==this.selector)throw new Error("ElementView: selectors within port must be unique.");h=kt({},n,l)}else h=n||l;return r.append([e.addClass("joint-port-body"),i.addClass("joint-port-label")]),this._portElementsCache[t.id]={portElement:r,portLabelElement:i,portSelectors:h,portLabelSelectors:l,portContentElement:e,portContentSelectors:n},r},_updatePortGroup:function(t){for(var e=T(this.model.size()),i=this.model._portSettingsData.getGroupPortsMetrics(t,e),n=0,r=i.length;n<r;n++){var s=i[n],a=s.portId,o=this._portElementsCache[a]||{},l=s.portTransformation;this.applyPortTransform(o.portElement,l),this.updateDOMSubtreeAttributes(o.portElement.node,s.portAttrs,{rootBBox:new T(s.portSize),selectors:o.portSelectors});var h=s.labelTransformation;h&&(this.applyPortTransform(o.portLabelElement,h,-l.angle||0),this.updateDOMSubtreeAttributes(o.portLabelElement.node,h.attrs,{rootBBox:new T(s.labelSize),selectors:o.portLabelSelectors}))}},applyPortTransform:function(t,e,i){var n=$.createSVGMatrix().rotate(i||0).translate(e.x||0,e.y||0).rotate(e.angle||0);t.transform(n,{absolute:!0})},_getPortMarkup:function(t){return t.markup||this.model.get("portMarkup")||this.model.portMarkup||this.portMarkup},_getPortLabelMarkup:function(t){return t.markup||this.model.get("portLabelMarkup")||this.model.portLabelMarkup||this.portLabelMarkup}},Xe=Me.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(){this._initializePorts(),Me.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return!0},position:function(t,e,i){var n=he(e);if((i=(n?i:t)||{}).parentRelative){if(!this.graph)throw new Error("Element must be part of a graph.");var r=this.getParentCell(),s=r&&!r.isLink()?r.get("position"):{x:0,y:0}}if(n){if(i.parentRelative&&(t+=s.x,e+=s.y),i.deep){var a=this.get("position");this.translate(t-a.x,e-a.y,i)}else this.set("position",{x:t,y:e},i);return this}var o=S(this.get("position"));return i.parentRelative?o.difference(s):o},translate:function(t,e,i){if(e=e||0,0===(t=t||0)&&0===e)return this;(i=i||{}).translateBy=i.translateBy||this.id;var n=this.get("position")||{x:0,y:0};if(i.restrictedArea&&i.translateBy===this.id){var r=this.getBBox({deep:!0}),s=i.restrictedArea,a=n.x-r.x,o=n.y-r.y,l=Math.max(s.x+a,Math.min(s.x+s.width+a-r.width,n.x+t)),h=Math.max(s.y+o,Math.min(s.y+s.height+o-r.height,n.y+e));t=l-n.x,e=h-n.y}var c={x:n.x+t,y:n.y+e};return i.tx=t,i.ty=e,i.transition?(le(i.transition)||(i.transition={}),this.transition("position",c,kt({},i.transition,{valueFunction:At.object})),Rt(this.getEmbeddedCells(),"translate",t,e,i)):(this.startBatch("translate",i),this.set("position",c,i),Rt(this.getEmbeddedCells(),"translate",t,e,i),this.stopBatch("translate",i)),this},size:function(t,e,i){var n=this.get("size");return void 0===t?{width:n.width,height:n.height}:(le(t)&&(i=e,e=he(t.height)?t.height:n.height,t=he(t.width)?t.width:n.width),this.resize(t,e,i))},resize:function(t,e,i){if(i=i||{},this.startBatch("resize",i),i.direction){var n=this.get("size");switch(i.direction){case"left":case"right":e=n.height;break;case"top":case"bottom":t=n.width}var r=P(this.get("angle")||0),s={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[i.direction];i.absolute&&(s+=Math.floor((r+45)/90),s%=4);var a=this.getBBox(),o=a[["bottomLeft","corner","topRight","origin"][s]](),l=S(o).rotate(a.center(),-r),h=Math.sqrt(t*t+e*e)/2,c=s*Math.PI/2;c+=Math.atan(s%2==0?e/t:t/e),c-=D(r);var u=S.fromPolar(h,c,l),d=S(u).offset(t/-2,e/-2);this.set("size",{width:t,height:e},i),this.position(d.x,d.y,i)}else this.set("size",{width:t,height:e},i);return this.stopBatch("resize",i),this},scale:function(t,e,i,n){var r=this.getBBox().scale(t,e,i);return this.startBatch("scale",n),this.position(r.x,r.y,n),this.resize(r.width,r.height,n),this.stopBatch("scale"),this},fitEmbeds:function(t){void 0===t&&(t={});var e=this.graph;if(!e)throw new Error("Element must be part of a graph.");var i=this.getEmbeddedCells().filter((function(t){return t.isElement()}));if(0===i.length)return this;this.startBatch("fit-embeds",t),t.deep&&Rt(i,"fitEmbeds",t);var n=xt(t.padding),r=n.left,s=n.right,a=n.top,o=n.bottom,l=e.getCellsBBox(i),h=l.x,c=l.y,u=l.width,d=l.height;return h-=r,c-=a,u+=r+s,d+=o+a,this.set({position:{x:h,y:c},size:{width:u,height:d}},t),this.stopBatch("fit-embeds"),this},rotate:function(t,e,i,n){if(i){var r=this.getBBox().center(),s=this.get("size"),a=this.get("position");r.rotate(i,this.get("angle")-t);var o=r.x-s.width/2-a.x,l=r.y-s.height/2-a.y;this.startBatch("rotate",{angle:t,absolute:e,origin:i}),this.position(a.x+o,a.y+l,n),this.rotate(t,e,null,n),this.stopBatch("rotate")}else this.set("angle",e?t:(this.get("angle")+t)%360,n);return this},angle:function(){return P(this.get("angle")||0)},getBBox:function(t){if((t=t||{}).deep&&this.graph){var e=this.getEmbeddedCells({deep:!0,breadthFirst:!0});return e.push(this),this.graph.getCellsBBox(e)}var i=this.get("position"),n=this.get("size");return new T(i.x,i.y,n.width,n.height)},getPointFromConnectedLink:function(t,e){var i=this.getBBox(),n=i.center(),r=t.get(e);if(!r)return n;var s=r.port;if(!s||!this.hasPort(s))return n;var a=this.portProp(s,["group"]),o=this.getPortsPositions(a),l=new S(o[s]).offset(i.origin()),h=this.angle();return h&&l.rotate(n,-h),l}});kt(Xe.prototype,We);var Ze=e.Collection.extend({initialize:function(t,e){e.cellNamespace?this.cellNamespace=e.cellNamespace:this.cellNamespace="undefined"!=typeof joint&&Qt(joint,"shapes")?joint.shapes:null,this.graph=e.graph},model:function(t,e){var i=e.collection,n=i.cellNamespace,r=new("link"===t.type?Ue:st(n,t.type,".")||Xe)(t,e);return e.dry||(r.graph=i.graph),r},comparator:function(t){return t.get("z")||0}}),Ye=e.Model.extend({_batches:{},initialize:function(t,i){var n=new Ze([],{model:(i=i||{}).cellModel,cellNamespace:i.cellNamespace,graph:this});e.Model.prototype.set.call(this,"cells",n),n.on("all",this.trigger,this),this.on("change:z",this._sortOnChangeZ,this),this._out={},this._in={},this._nodes={},this._edges={},n.on("add",this._restructureOnAdd,this),n.on("remove",this._restructureOnRemove,this),n.on("reset",this._restructureOnReset,this),n.on("change:source",this._restructureOnChangeSource,this),n.on("change:target",this._restructureOnChangeTarget,this),n.on("remove",this._removeCell,this)},_sortOnChangeZ:function(){this.get("cells").sort()},_restructureOnAdd:function(t){if(t.isLink()){this._edges[t.id]=!0;var e=t.attributes,i=e.source,n=e.target;i.id&&((this._out[i.id]||(this._out[i.id]={}))[t.id]=!0),n.id&&((this._in[n.id]||(this._in[n.id]={}))[t.id]=!0)}else this._nodes[t.id]=!0},_restructureOnRemove:function(t){if(t.isLink()){delete this._edges[t.id];var e=t.attributes,i=e.source,n=e.target;i.id&&this._out[i.id]&&this._out[i.id][t.id]&&delete this._out[i.id][t.id],n.id&&this._in[n.id]&&this._in[n.id][t.id]&&delete this._in[n.id][t.id]}else delete this._nodes[t.id]},_restructureOnReset:function(t){t=t.models,this._out={},this._in={},this._nodes={},this._edges={},t.forEach(this._restructureOnAdd,this)},_restructureOnChangeSource:function(t){var e=t.previous("source");e.id&&this._out[e.id]&&delete this._out[e.id][t.id];var i=t.attributes.source;i.id&&((this._out[i.id]||(this._out[i.id]={}))[t.id]=!0)},_restructureOnChangeTarget:function(t){var e=t.previous("target");e.id&&this._in[e.id]&&delete this._in[e.id][t.id];var i=t.get("target");i.id&&((this._in[i.id]||(this._in[i.id]={}))[t.id]=!0)},getOutboundEdges:function(t){return this._out&&this._out[t]||{}},getInboundEdges:function(t){return this._in&&this._in[t]||{}},toJSON:function(){var t=e.Model.prototype.toJSON.apply(this,arguments);return t.cells=this.get("cells").toJSON(),t},fromJSON:function(t,e){if(!t.cells)throw new Error("Graph JSON must contain cells array.");return this.set(t,e)},set:function(t,i,n){var r;return"object"==a(t)?(r=t,n=i):(r={})[t]=i,r.hasOwnProperty("cells")&&(this.resetCells(r.cells,n),r=te(r,"cells")),e.Model.prototype.set.call(this,r,n)},clear:function(t){t=kt({},t,{clear:!0});var e=this.get("cells");if(0===e.length)return this;this.startBatch("clear",t);for(var i=e.sortBy((function(t){return t.isLink()?1:2}));i.shift().remove(t),0<i.length;);return this.stopBatch("clear"),this},_prepareCell:function(t,i){var n;if(t instanceof e.Model?(n=t.attributes,t.graph||i&&i.dry||(t.graph=this)):n=t,!ce(n.type))throw new TypeError("dia.Graph: cell type must be a string.");return t},minZIndex:function(){var t=this.get("cells").first();return t&&t.get("z")||0},maxZIndex:function(){var t=this.get("cells").last();return t&&t.get("z")||0},addCell:function(t,i){return Array.isArray(t)?this.addCells(t,i):(t instanceof e.Model?t.has("z")||t.set("z",this.maxZIndex()+1):void 0===t.z&&(t.z=this.maxZIndex()+1),this.get("cells").add(this._prepareCell(t,i),i||{}),this)},addCells:function(t,e){return 0===t.length||(t=Zt(t),e.maxPosition=e.position=t.length-1,this.startBatch("add",e),t.forEach((function(t){this.addCell(t,e),e.position--}),this),this.stopBatch("add",e)),this},resetCells:function(t,e){var i=Gt(t).map((function(t){return this._prepareCell(t,e)}),this);return this.get("cells").reset(i,e),this},removeCells:function(t,e){return t.length&&(this.startBatch("remove"),Rt(t,"remove",e),this.stopBatch("remove")),this},_removeCell:function(t,e,i){(i=i||{}).clear||(i.disconnectLinks?this.disconnectLinks(t,i):this.removeLinks(t,i)),this.get("cells").remove(t,{silent:!0}),t.graph===this&&(t.graph=null)},getCell:function(t){return this.get("cells").get(t)},getCells:function(){return this.get("cells").toArray()},getElements:function(){return Object.keys(this._nodes).map(this.getCell,this)},getLinks:function(){return Object.keys(this._edges).map(this.getCell,this)},getFirstCell:function(){return this.get("cells").first()},getLastCell:function(){return this.get("cells").last()},getConnectedLinks:function(t,e){var i=(e=e||{}).indirect,n=e.inbound,r=e.outbound;void 0===n&&void 0===r&&(n=r=!0);var s=[],a={};function o(t,e){if(ne(t.getOutboundEdges(e.id),function(e,h){if(!a[h]){var c=t.getCell(h);s.push(c),a[h]=!0,i&&(n&&l(t,c),r&&o(t,c))}}.bind(t)),i&&e.isLink()){var h=e.getTargetCell();h&&h.isLink()&&(a[h.id]||(s.push(h),o(t,h)))}}function l(t,e){if(ne(t.getInboundEdges(e.id),function(e,h){if(!a[h]){var c=t.getCell(h);s.push(c),a[h]=!0,i&&(n&&l(t,c),r&&o(t,c))}}.bind(t)),i&&e.isLink()){var h=e.getSourceCell();h&&h.isLink()&&(a[h.id]||(s.push(h),l(t,h)))}}if(r&&o(this,t),n&&l(this,t),e.deep){var h=t.getEmbeddedCells({deep:!0}),c={};h.forEach((function(t){t.isElement()&&(c[t.id]=!0)})),h.forEach((function(t){t.isLink()||(r&&ne(this.getOutboundEdges(t.id),function(t,i){if(!a[i]){var n=this.getCell(i).attributes,r=n.source,o=n.target,l=r.id,h=o.id;if(!e.includeEnclosed&&l&&c[l]&&h&&c[h])return;s.push(this.getCell(i)),a[i]=!0}}.bind(this)),n&&ne(this.getInboundEdges(t.id),function(t,i){if(!a[i]){var n=this.getCell(i).attributes,r=n.source,o=n.target,l=r.id,h=o.id;if(!e.includeEnclosed&&l&&c[l]&&h&&c[h])return;s.push(this.getCell(i)),a[i]=!0}}.bind(this)))}),this)}return s},getNeighbors:function(t,e){e||(e={});var i=e.inbound,n=e.outbound;void 0===i&&void 0===n&&(i=n=!0);var r=this.getConnectedLinks(t,e).reduce(function(r,s){var a=s.attributes,o=a.source,l=a.target,h=s.hasLoop(e);if(i&&Qt(o,"id")&&!r[o.id]){var c=this.getCell(o.id);c.isElement()&&(!h&&(!c||c===t||e.deep&&c.isEmbeddedIn(t))||(r[o.id]=c))}if(n&&Qt(l,"id")&&!r[l.id]){var u=this.getCell(l.id);u.isElement()&&(!h&&(!u||u===t||e.deep&&u.isEmbeddedIn(t))||(r[l.id]=u))}return r}.bind(this),{});if(t.isLink()){if(i){var s=t.getSourceCell();s&&s.isElement()&&!r[s.id]&&(r[s.id]=s)}if(n){var a=t.getTargetCell();a&&a.isElement()&&!r[a.id]&&(r[a.id]=a)}}return Gt(r)},getCommonAncestor:function(){var t=Array.from(arguments).map((function(t){for(var e=[],i=t.get("parent");i;)e.push(i),i=this.getCell(i).get("parent");return e}),this);t=t.sort((function(t,e){return t.length-e.length}));var e=Gt(t.shift()).find((function(e){return t.every((function(t){return t.includes(e)}))}));return this.getCell(e)},getSuccessors:function(t,e){e=e||{};var i=[];return this.search(t,(function(e){e!==t&&i.push(e)}),kt({},e,{outbound:!0})),i},cloneCells:de,cloneSubgraph:function(t,e){var i=this.getSubgraph(t,e);return this.cloneCells(i)},getSubgraph:function(t,e){e=e||{};var i=[],n={},r=[],s=[];return Gt(t).forEach((function(t){n[t.id]||(i.push(t),(n[t.id]=t).isLink()?s.push(t):r.push(t)),e.deep&&t.getEmbeddedCells({deep:!0}).forEach((function(t){n[t.id]||(i.push(t),(n[t.id]=t).isLink()?s.push(t):r.push(t))}))})),s.forEach((function(t){var e=t.attributes,s=e.source,a=e.target;if(s.id&&!n[s.id]){var o=this.getCell(s.id);i.push(o),n[o.id]=o,r.push(o)}if(a.id&&!n[a.id]){var l=this.getCell(a.id);i.push(this.getCell(a.id)),n[l.id]=l,r.push(l)}}),this),r.forEach((function(t){this.getConnectedLinks(t,e).forEach((function(t){var e=t.attributes,r=e.source,s=e.target;!n[t.id]&&r.id&&n[r.id]&&s.id&&n[s.id]&&(i.push(t),n[t.id]=t)}))}),this),i},getPredecessors:function(t,e){e=e||{};var i=[];return this.search(t,(function(e){e!==t&&i.push(e)}),kt({},e,{inbound:!0})),i},search:function(t,e,i){(i=i||{}).breadthFirst?this.bfs(t,e,i):this.dfs(t,e,i)},bfs:function(t,e,i){void 0===i&&(i={});var n={},r={},s=[];for(s.push(t),r[t.id]=0;0<s.length;){var a=s.shift();if(!n[a.id]&&!(n[a.id]=!0)!==e.call(this,a,r[a.id]))for(var o=this.getNeighbors(a,i),l=0,h=o.length;l<h;l++){var c=o[l];r[c.id]=r[a.id]+1,s.push(c)}}},dfs:function(t,e,i){void 0===i&&(i={});var n={},r={},s=[];for(s.push(t),r[t.id]=0;0<s.length;){var a=s.pop();if(!n[a.id]&&!(n[a.id]=!0)!==e.call(this,a,r[a.id]))for(var o=this.getNeighbors(a,i),l=s.length,h=0,c=o.length;h<c;h++){var u=o[h];r[u.id]=r[a.id]+1,s.splice(l,0,u)}}},getSources:function(){var t=[];return ne(this._nodes,function(e,i){this._in[i]&&!Ft(this._in[i])||t.push(this.getCell(i))}.bind(this)),t},getSinks:function(){var t=[];return ne(this._nodes,function(e,i){this._out[i]&&!Ft(this._out[i])||t.push(this.getCell(i))}.bind(this)),t},isSource:function(t){return!this._in[t.id]||Ft(this._in[t.id])},isSink:function(t){return!this._out[t.id]||Ft(this._out[t.id])},isSuccessor:function(t,e){var i=!1;return this.search(t,(function(n){if(n===e&&n!==t)return!(i=!0)}),{outbound:!0}),i},isPredecessor:function(t,e){var i=!1;return this.search(t,(function(n){if(n===e&&n!==t)return!(i=!0)}),{inbound:!0}),i},isNeighbor:function(t,e,i){var n=(i=i||{}).inbound,r=i.outbound;void 0===n&&void 0===r&&(n=r=!0);var s=!1;return this.getConnectedLinks(t,i).forEach((function(t){var i=t.attributes,a=i.source,o=i.target;return n&&Qt(a,"id")&&a.id===e.id||r&&Qt(o,"id")&&o.id===e.id?!(s=!0):void 0})),s},disconnectLinks:function(t,e){this.getConnectedLinks(t).forEach((function(i){i.set(i.attributes.source.id===t.id?"source":"target",{x:0,y:0},e)}))},removeLinks:function(t,e){Rt(this.getConnectedLinks(t),"remove",e)},findModelsFromPoint:function(t){return this.getElements().filter((function(e){return e.getBBox().containsPoint(t)}))},findModelsInArea:function(t,e){t=z(t);var i=(e=Dt(e||{},{strict:!1})).strict?"containsRect":"intersect";return this.getElements().filter((function(e){return t[i](e.getBBox())}))},findModelsUnderElement:function(t,e){e=Dt(e||{},{searchBy:"bbox"});var i=t.getBBox();return("bbox"===e.searchBy?this.findModelsInArea(i):this.findModelsFromPoint(i[e.searchBy]())).filter((function(e){return t.id!==e.id&&!e.isEmbeddedIn(t)}))},getBBox:function(){return this.getCellsBBox(this.getCells())},getCellsBBox:function(t,e){return e||(e={}),Gt(t).reduce((function(t,i){var n=i.getBBox(e);if(!n)return t;var r=i.angle();return r&&(n=n.bbox(r)),t?t.union(n):n}),null)},translate:function(t,e,i){var n=this.getCells().filter((function(t){return!t.isEmbedded()}));return Rt(n,"translate",t,e,i),this},resize:function(t,e,i){return this.resizeCells(t,e,this.getCells(),i)},resizeCells:function(t,e,i,n){var r=this.getCellsBBox(i);if(r){var s=Math.max(t/r.width,0),a=Math.max(e/r.height,0);Rt(i,"scale",s,a,r.origin(),n)}return this},startBatch:function(t,e){return e=e||{},this._batches[t]=(this._batches[t]||0)+1,this.trigger("batch:start",kt({},e,{batchName:t}))},stopBatch:function(t,e){return e=e||{},this._batches[t]=(this._batches[t]||0)-1,this.trigger("batch:stop",kt({},e,{batchName:t}))},hasActiveBatch:function(t){var e=this._batches;return(0===arguments.length?Gt(e):Array.isArray(t)?t:[t]).some((function(t){return 0<e[t]}))}},{validations:{multiLinks:function(t,e){var i=e.attributes,n=i.source,r=i.target;if(n.id&&r.id){var s=e.getSourceCell();if(s&&1<t.getConnectedLinks(s,{outbound:!0}).filter((function(t){var e=t.attributes,i=e.source,s=e.target;return i&&i.id===n.id&&(!i.port||i.port===n.port)&&s&&s.id===r.id&&(!s.port||s.port===r.port)})).length)return!1}return!0},linkPinning:function(t,e){var i=e.attributes,n=i.source,r=i.target;return n.id&&r.id}}});Te(Ye.prototype,["resetCells","addCells","removeCells"],Pe.cells);var qe={},Ke=e.View.extend({options:{},theme:null,themeClassNamePrefix:et("theme-"),requireSetThemeOverride:!1,defaultTheme:tt.defaultTheme,children:null,childNodes:null,DETACHABLE:!0,UPDATE_PRIORITY:2,FLAG_INSERT:1<<30,FLAG_REMOVE:1<<29,constructor:function(t){this.requireSetThemeOverride=t&&!!t.theme,this.options=kt({},this.options,t),e.View.call(this,t)},initialize:function(){(qe[this.cid]=this).setTheme(this.options.theme||this.defaultTheme),this.init()},unmount:function(){this.svgElement?this.vel.remove():this.$el.remove()},renderChildren:function(t){if(t||(t=$t(this,"children")),t){var e=this.svgElement,i=$.namespace[e?"svg":"xhtml"],n=nt(t,i);(e?this.vel:this.$el).empty().append(n.fragment),this.childNodes=n.selectors}return this},findAttribute:function(t,e){for(var i=e;i&&1===i.nodeType;){var n=i.getAttribute(t);if(n)return n;if(i===this.el)return null;i=i.parentNode}return null},_ensureElement:function(){if(this.el)this.setElement($t(this,"el"));else{var t=$t(this,"tagName"),e=kt({},$t(this,"attributes")),i=kt({},$t(this,"style"));this.id&&(e.id=$t(this,"id")),this.setElement(this._createElement(t)),this._setAttributes(e),this._setStyle(i)}this._ensureElClassName()},_setAttributes:function(t){this.svgElement?this.vel.attr(t):this.$el.attr(t)},_setStyle:function(t){this.$el.css(t)},_createElement:function(t){return this.svgElement?document.createElementNS($.namespace.svg,t):document.createElement(t)},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],this.svgElement&&(this.vel=$(this.el))},_ensureElClassName:function(){var t=$t(this,"className");if(t){var e=et(t);this.svgElement?this.vel.removeClass(t).addClass(e):this.$el.removeClass(t).addClass(e)}},init:function(){},onRender:function(){},confirmUpdate:function(){return 0},setTheme:function(t,e){return e=e||{},this.theme&&this.requireSetThemeOverride&&!e.override||(this.removeThemeClassName(),this.addThemeClassName(t),this.onSetTheme(this.theme,t),this.theme=t),this},addThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.addClass(e):this.$el.addClass(e),this},removeThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.removeClass(e):this.$el.removeClass(e),this},onSetTheme:function(t,e){},remove:function(){return this.onRemove(),this.undelegateDocumentEvents(),qe[this.cid]=null,e.View.prototype.remove.apply(this,arguments),this},onRemove:function(){},getEventNamespace:function(){return".joint-event-ns-"+this.cid},delegateElementEvents:function(t,e,i){if(!e)return this;i||(i={});var r=this.getEventNamespace();for(var s in e){var a=e[s];"function"!=typeof a&&(a=this[a]),a&&n(t).on(s+r,i,a.bind(this))}return this},undelegateElementEvents:function(t){return n(t).off(this.getEventNamespace()),this},delegateDocumentEvents:function(t,e){return t||(t=$t(this,"documentEvents")),this.delegateElementEvents(document,t,e)},undelegateDocumentEvents:function(){return this.undelegateElementEvents(document)},eventData:function(t,e){if(!t)throw new Error("eventData(): event object required.");var i=t.data,n="__"+this.cid+"__";return void 0===e?i&&i[n]||{}:(i||(i=t.data={}),i[n]||(i[n]={}),kt(i[n],e),this)},stopPropagation:function(t){return this.eventData(t,{propagationStopped:!0}),this},isPropagationStopped:function(t){return!!this.eventData(t).propagationStopped}},{extend:function(){var t=Array.from(arguments),i=t[0]&&kt({},t[0])||{},n=t[1]&&kt({},t[1])||{},r=i.render||this.prototype&&this.prototype.render||null;return i.render=function(){return"function"==typeof r&&r.apply(this,arguments),this.render.__render__===r&&this.onRender(),this},i.render.__render__=r,e.View.extend.call(this,i,n)}}),Je={views:qe,View:Ke},Qe=Ke.extend({tagName:"g",svgElement:!0,selector:"root",metrics:null,className:function(){var t=["cell"],e=this.model.get("type");return e&&e.toLowerCase().split(".").forEach((function(e,i,n){t.push("type-"+n.slice(0,i+1).join("-"))})),t.join(" ")},_presentationAttributes:null,_flags:null,setFlags:function(){var t,e,i,n={},r={},s=0,a=this.presentationAttributes;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];for(Array.isArray(l)||(l=[l]),t=0,e=l.length;t<e;t++){var h=n[i=l[t]];h||(h=n[i]=1<<s++),r[o]|=h}}var c=this.initFlag;for(Array.isArray(c)||(c=[c]),t=0,e=c.length;t<e;t++)n[i=c[t]]||(n[i]=1<<s++);if(25<s)throw new Error("dia.CellView: Maximum number of flags exceeded.");this._flags=n,this._presentationAttributes=r},hasFlag:function(t,e){return t&this.getFlag(e)},removeFlag:function(t,e){return t^t&this.getFlag(e)},getFlag:function(t){var e=this._flags;if(!e)return 0;var i=0;if(Array.isArray(t))for(var n=0,r=t.length;n<r;n++)i|=e[t[n]];else i|=e[t];return i},attributes:function(){var t=this.model;return{"model-id":t.id,"data-type":t.attributes.type}},constructor:function(t){t.id=t.id||ht(this),Ke.call(this,t)},initialize:function(){this.setFlags(),Ke.prototype.initialize.apply(this,arguments),this.cleanNodesCache(),this.$el.data("view",this),this.startListening()},startListening:function(){this.listenTo(this.model,"change",this.onAttributesChange)},onAttributesChange:function(t,e){var i=t.getChangeFlag(this._presentationAttributes);if(!e.updateHandled&&i){e.dirty&&this.hasFlag(i,"UPDATE")&&(i|=this.getFlag("RENDER")),e.tool&&(e.async=!1);var n=this.paper;n&&n.requestViewUpdate(this,i,this.UPDATE_PRIORITY,e)}},parseDOMJSON:function(t,e){var i=nt(t),n=i.selectors,r=i.groupSelectors;for(var s in r){if(n[s])throw new Error("dia.CellView: ambiguous group selector");n[s]=r[s]}if(e){var a=this.selector;if(n[a])throw new Error("dia.CellView: ambiguous root selector.");n[a]=e}return{fragment:i.fragment,selectors:n}},can:function(t){var e=Vt(this.options.interactive)?this.options.interactive(this):this.options.interactive;return le(e)&&!1!==e[t]||oe(e)&&!1!==e},findBySelector:function(t,e,i){if(e||(e=this.el),i||(i=this.selectors),!t||"."===t)return[e];if(i){var r=i[t];if(r)return Array.isArray(r)?r:[r]}return tt.useCSSSelectors?n(e).find(t).toArray():[]},notify:function(t){if(this.paper){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e)),this.paper.trigger.apply(this.paper,[t,this].concat(e))}},getBBox:function(t){var e;if(t&&t.useModelGeometry){var i=this.model;e=i.getBBox().bbox(i.angle())}else e=this.getNodeBBox(this.el);return this.paper.localToPaperRect(e)},getNodeBBox:function(t){var e=this.getNodeBoundingRect(t),i=this.getNodeMatrix(t),n=this.getRootTranslateMatrix(),r=this.getRootRotateMatrix();return $.transformRect(e,n.multiply(r).multiply(i))},getNodeUnrotatedBBox:function(t){var e=this.getNodeBoundingRect(t),i=this.getNodeMatrix(t),n=this.getRootTranslateMatrix();return $.transformRect(e,n.multiply(i))},getRootTranslateMatrix:function(){var t=this.model.position();return $.createSVGMatrix().translate(t.x,t.y)},getRootRotateMatrix:function(){var t=$.createSVGMatrix(),e=this.model,i=e.angle();if(i){var n=e.getBBox(),r=n.width/2,s=n.height/2;t=t.translate(r,s).rotate(i).translate(-r,-s)}return t},highlight:function(t,e){return t=t&&this.$(t)[0]||this.el,(e=e||{}).partial=t!==this.el,this.notify("cell:highlight",t,e),this},unhighlight:function(t,e){return t=t&&this.$(t)[0]||this.el,(e=e||{}).partial=t!=this.el,this.notify("cell:unhighlight",t,e),this},findMagnet:function(t){var e=this.$(t),i=this.$el;0===e.length&&(e=i);do{var n=e.attr("magnet");if((n||e.is(i))&&"false"!==n)return e[0];e=e.parent()}while(0<e.length)},getSelector:function(t,e){var i;if(t===this.el)return"string"==typeof e&&(i="> "+e),i;if(t){var n=$(t).index()+1;i=t.tagName+":nth-child("+n+")",e&&(i+=" > "+e),i=this.getSelector(t.parentNode,i)}return i},getLinkEnd:function(t){for(var e,i=[],n=arguments.length-1;0<n--;)i[n]=arguments[n+1];var r=this.model,s=r.id,a=this.findAttribute("port",t),o=t.getAttribute("joint-selector"),l={id:s};return null!=o&&(l.magnet=o),null!=a?(l.port=a,r.hasPort(a)||o||(l.selector=this.getSelector(t))):null==o&&this.el!==t&&(l.selector=this.getSelector(t)),(e=this).customizeLinkEnd.apply(e,[l,t].concat(i))},customizeLinkEnd:function(t,e,i,n,r,s){var a=this.paper,o=a.options.connectionStrategy;if("function"==typeof o){var l=o.call(a,t,this,e,new S(i,n),r,s,a);if(l)return l}return t},getMagnetFromLinkEnd:function(t){var e=this.el,i=t.port,n=t.magnet,r=this.model;return null!=i&&r.isElement()&&r.hasPort(i)?this.findPortNode(i,n)||e:(n||(n=t.selector),n||null==i||(n='[port="'+i+'"]'),this.findBySelector(n,e,this.selectors)[0])},getAttributeDefinition:function(t){return this.model.constructor.getAttributeDefinition(t)},setNodeAttributes:function(t,e){Ft(e)||(t instanceof SVGElement?$(t).attr(e):n(t).attr(e))},processNodeAttributes:function(t,e){var i,n,r,s,a,o,l,h,c,u=[];for(i in e)e.hasOwnProperty(i)&&(n=e[i],!(r=this.getAttributeDefinition(i))||Vt(r.qualify)&&!r.qualify.call(this,n,t,e)?(o||(o={}),o[ct(i)]=n):(ce(r.set)&&(o||(o={}),o[r.set]=n),null!==n&&u.push(i,r)));for(s=0,a=u.length;s<a;s+=2)i=u[s],r=u[s+1],n=e[i],Vt(r.set)&&(l||(l={}),l[i]=n),Vt(r.position)&&(h||(h={}),h[i]=n),Vt(r.offset)&&(c||(c={}),c[i]=n);return{raw:e,normal:o,set:l,position:h,offset:c}},updateRelativeAttributes:function(t,e,i,n){var r,s;n||(n={});var a=e.raw||{},o=e.normal||{},l=e.set,h=e.position,c=e.offset;for(r in l){s=l[r];var u=this.getAttributeDefinition(r).set.call(this,s,i.clone(),t,a);le(u)?kt(o,u):void 0!==u&&(o[r]=u)}if(t instanceof HTMLElement)this.setNodeAttributes(t,o);else{var d,f,p,m=o.transform,g=$.transformStringToMatrix(m),v=S(g.e,g.f);if(m&&(o=te(o,"transform"),g.e=g.f=0),h||c){var _=this.getNodeScale(t,n.scalableNode);d=_.sx,f=_.sy}var y=!1;for(r in h)s=h[r],(p=this.getAttributeDefinition(r).position.call(this,s,i.clone(),t,a))&&(v.offset(S(p).scale(d,f)),y||(y=!0));this.setNodeAttributes(t,o);var b=!1;if(c){var x=this.getNodeBoundingRect(t);if(0<x.width&&0<x.height){var w=$.transformRect(x,g).scale(1/d,1/f);for(r in c)s=c[r],(p=this.getAttributeDefinition(r).offset.call(this,s,w,t,a))&&(v.offset(S(p).scale(d,f)),b||(b=!0))}}(void 0!==m||y||b)&&(v.round(1),g.e=v.x,g.f=v.y,t.setAttribute("transform",$.matrixToTransformString(g)))}},getNodeScale:function(t,e){var i,n;if(e&&e.contains(t)){var r=e.scale();i=1/r.sx,n=1/r.sy}else n=i=1;return{sx:i,sy:n}},cleanNodesCache:function(){this.metrics={}},nodeCache:function(t){var e=this.metrics;if(!e)return{};var i=$.ensureId(t),n=e[i];return n||(n=e[i]={}),n},getNodeData:function(t){var e=this.nodeCache(t);return e.data||(e.data={}),e.data},getNodeBoundingRect:function(t){var e=this.nodeCache(t);return void 0===e.boundingRect&&(e.boundingRect=$(t).getBBox()),new T(e.boundingRect)},getNodeMatrix:function(t){var e=this.nodeCache(t);if(void 0===e.magnetMatrix){var i=this.rotatableNode||this.el;e.magnetMatrix=$(t).getTransformToElement(i)}return $.createSVGMatrix(e.magnetMatrix)},getNodeShape:function(t){var e=this.nodeCache(t);return void 0===e.geometryShape&&(e.geometryShape=$(t).toGeometryShape()),e.geometryShape.clone()},isNodeConnection:function(t){return this.model.isLink()&&(!t||t===this.el)},findNodesAttributes:function(t,e,i,n){var r,s,a,o,l={},h=[];for(var c in t)if(t.hasOwnProperty(c)&&(a=t[c],Ut(a))){var u=i[c]=this.findBySelector(c,e,n);for(r=0,s=u.length;r<s;r++){var d=u[r];o=$.ensureId(d);var f=n&&n[c]===d,p=l[o];if(p){p.array||(h.push(o),p.array=!0,p.attributes=[p.attributes],p.selectedLength=[p.selectedLength]);var m=p.attributes,g=p.selectedLength;if(f)m.unshift(a),g.unshift(-1);else{var v=Lt(g,s);m.splice(v,0,a),g.splice(v,0,s)}}else l[o]={attributes:a,selectedLength:f?-1:s,node:d,array:!1}}}for(r=0,s=h.length;r<s;r++)(a=l[o=h[r]]).attributes=ae.apply(void 0,[{}].concat(a.attributes.reverse()));return l},getEventTarget:function(t,e){void 0===e&&(e={});var i=t.target,n=t.type,r=t.clientX;void 0===r&&(r=0);var s=t.clientY;return void 0===s&&(s=0),e.fromPoint||"touchmove"===n||"touchend"===n?document.elementFromPoint(r,s):i},updateDOMSubtreeAttributes:function(t,e,i){i||(i={}),i.rootBBox||(i.rootBBox=T()),i.selectors||(i.selectors=this.selectors);var n,r,s,a,o,l,h={},c={},u=[],d=i.roAttributes,f=this.findNodesAttributes(d||e,t,h,i.selectors),p=d?this.findNodesAttributes(e,t,h,i.selectors):f;for(var m in f)if(s=(a=f[m]).attributes,r=a.node,(o=this.processNodeAttributes(r,s)).set||o.position||o.offset){var g,v=p[m]&&p[m].attributes,_=v&&void 0===s.ref?v.ref:s.ref;if(_){if(!(g=(h[_]||this.findBySelector(_,t,i.selectors))[0]))throw new Error('dia.ElementView: "'+_+'" reference does not exist.')}else g=null;n={node:r,refNode:g,processedAttributes:o,allAttributes:v};var y=u.findIndex((function(t){return t.refNode===r}));-1<y?u.splice(y,0,n):u.push(n)}else this.setNodeAttributes(r,o.normal);for(var b=0,x=u.length;b<x;b++){n=u[b],r=n.node,g=n.refNode;var w=$(i.rotatableNode),A=g?$.ensureId(g):"",C=!!w&&!!g&&w.contains(g),I=c[A];if(!I){var S=C?w:t;I=c[A]=g?$(g).getBBox({target:S}):i.rootBBox}d?(o=this.processNodeAttributes(r,n.allAttributes),this.mergeProcessedAttributes(o,n.processedAttributes)):o=n.processedAttributes;var M=I;C&&!w.contains(r)&&(l||(l=$.transformStringToMatrix(w.attr("transform"))),M=$.transformRect(I,l)),this.updateRelativeAttributes(r,o,M,i)}},mergeProcessedAttributes:function(t,e){t.set||(t.set={}),t.position||(t.position={}),t.offset||(t.offset={}),kt(t.set,e.set),kt(t.position,e.position),kt(t.offset,e.offset);var i=t.normal&&t.normal.transform;void 0!==i&&e.normal&&(e.normal.transform=i),t.normal=e.normal},onRemove:function(){this.removeTools()},_toolsView:null,hasTools:function(t){var e=this._toolsView;return!(!e||t&&e.getName()!==t)},addTools:function(t){return this.removeTools(),t&&((this._toolsView=t).configure({relatedView:this}),t.listenTo(this.paper,"tools:event",this.onToolEvent.bind(this)),t.mount()),this},updateTools:function(t){var e=this._toolsView;return e&&e.update(t),this},removeTools:function(){var t=this._toolsView;return t&&(t.remove(),this._toolsView=null),this},hideTools:function(){var t=this._toolsView;return t&&t.hide(),this},showTools:function(){var t=this._toolsView;return t&&t.show(),this},onToolEvent:function(t){switch(t){case"remove":this.removeTools();break;case"hide":this.hideTools();break;case"show":this.showTools()}},pointerdblclick:function(t,e,i){this.notify("cell:pointerdblclick",t,e,i)},pointerclick:function(t,e,i){this.notify("cell:pointerclick",t,e,i)},contextmenu:function(t,e,i){this.notify("cell:contextmenu",t,e,i)},pointerdown:function(t,e,i){var n=this.model,r=n.graph;r&&(n.startBatch("pointer"),this.eventData(t,{graph:r})),this.notify("cell:pointerdown",t,e,i)},pointermove:function(t,e,i){this.notify("cell:pointermove",t,e,i)},pointerup:function(t,e,i){var n=this.eventData(t).graph;this.notify("cell:pointerup",t,e,i),n&&n.stopBatch("pointer",{cell:this.model})},mouseover:function(t){this.notify("cell:mouseover",t)},mouseout:function(t){this.notify("cell:mouseout",t)},mouseenter:function(t){this.notify("cell:mouseenter",t)},mouseleave:function(t){this.notify("cell:mouseleave",t)},mousewheel:function(t,e,i,n){this.notify("cell:mousewheel",t,e,i,n)},onevent:function(t,e,i,n){this.notify(e,t,i,n)},onmagnet:function(){},magnetpointerdblclick:function(){},magnetcontextmenu:function(){},checkMouseleave:function(t){var e=this.paper;e.isAsync()&&e.dumpView(this);var i=this.getEventTarget(t,{fromPoint:!0}),n=e.findView(i);n!==this&&(this.mouseleave(t),n&&n.mouseenter(t))},setInteractivity:function(t){this.options.interactive=t}},{addPresentationAttributes:function(t){return ae({},this.prototype.presentationAttributes,t,(function(t,e){if(t&&e)return"string"==typeof t&&(t=[t]),"string"==typeof e&&(e=[e]),Array.isArray(t)&&Array.isArray(e)?Nt(t.concat(e)):void 0}))}}),$e=Qe.extend({_removePorts:function(){},_renderPorts:function(){},className:function(){var t=Qe.prototype.className.apply(this).split(" ");return t.push("element"),t.join(" ")},initialize:function(){Qe.prototype.initialize.apply(this,arguments),this._initializePorts()},presentationAttributes:{attrs:["UPDATE"],position:["TRANSLATE","TOOLS"],size:["RESIZE","PORTS","TOOLS"],angle:["ROTATE","TOOLS"],markup:["RENDER"],ports:["PORTS"]},initFlag:["RENDER"],UPDATE_PRIORITY:0,confirmUpdate:function(t,e){var i=tt.useCSSSelectors;return this.hasFlag(t,"PORTS")&&(this._removePorts(),this._cleanPortsCache()),this.hasFlag(t,"RENDER")?(this.render(),this.updateTools(e),t=this.removeFlag(t,["RENDER","UPDATE","RESIZE","TRANSLATE","ROTATE","PORTS"])):(this.hasFlag(t,"RESIZE")&&(this.resize(e),t=this.removeFlag(t,["RESIZE","UPDATE"])),this.hasFlag(t,"UPDATE")&&(this.update(this.model,null,e),t=this.removeFlag(t,"UPDATE"),i&&(t=this.removeFlag(t,"PORTS"))),this.hasFlag(t,"TRANSLATE")&&(this.translate(),t=this.removeFlag(t,"TRANSLATE")),this.hasFlag(t,"ROTATE")&&(this.rotate(),t=this.removeFlag(t,"ROTATE")),this.hasFlag(t,"PORTS")&&(this._renderPorts(),t=this.removeFlag(t,"PORTS"))),this.hasFlag(t,"TOOLS")&&(this.updateTools(e),t=this.removeFlag(t,"TOOLS")),t},_initializePorts:function(){},update:function(t,e){this.cleanNodesCache();var i=tt.useCSSSelectors;i&&this._removePorts();var n=this.model,r=n.attr();this.updateDOMSubtreeAttributes(this.el,r,{rootBBox:new T(n.size()),selectors:this.selectors,scalableNode:this.scalableNode,rotatableNode:this.rotatableNode,roAttributes:e===r?null:e}),i&&this._renderPorts()},rotatableSelector:"rotatable",scalableSelector:"scalable",scalableNode:null,rotatableNode:null,renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.ElementView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if("string"==typeof e)return this.renderStringMarkup(e);throw new Error("dia.ElementView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el),i=this.selectors=e.selectors;this.rotatableNode=$(i[this.rotatableSelector])||null,this.scalableNode=$(i[this.scalableSelector])||null,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=this.vel;e.append($(t)),this.rotatableNode=e.findOne(".rotatable"),this.scalableNode=e.findOne(".scalable"),(this.selectors={})[this.selector]=this.el},render:function(){return this.vel.empty(),this.renderMarkup(),this.scalableNode&&this.update(),this.resize(),this.rotatableNode?(this.rotate(),this.translate()):this.updateTransformation(),tt.useCSSSelectors||this._renderPorts(),this},resize:function(t){if(this.scalableNode)return this.sgResize(t);this.model.attributes.angle&&this.rotate(),this.update()},translate:function(){if(this.rotatableNode)return this.rgTranslate();this.updateTransformation()},rotate:function(){if(this.rotatableNode)return this.rgRotate(),void this.update();this.updateTransformation()},updateTransformation:function(){var t=this.getTranslateString(),e=this.getRotateString();e&&(t+=" "+e),this.vel.attr("transform",t)},getTranslateString:function(){var t=this.model.attributes.position;return"translate("+t.x+","+t.y+")"},getRotateString:function(){var t=this.model.attributes,e=t.angle;if(!e)return null;var i=t.size;return"rotate("+e+","+i.width/2+","+i.height/2+")"},rgRotate:function(){this.rotatableNode.attr("transform",this.getRotateString())},rgTranslate:function(){this.vel.attr("transform",this.getTranslateString())},sgResize:function(t){var e=this.model,i=e.angle(),n=e.size(),r=this.scalableNode,s=!1;0<r.node.getElementsByTagName("path").length&&(s=!0);var a=r.getBBox({recursive:s}),o=n.width/(a.width||1),l=n.height/(a.height||1);r.attr("transform","scale("+o+","+l+")");var h=this.rotatableNode,c=h&&h.attr("transform");if(c){h.attr("transform",c+" rotate("+-i+","+n.width/2+","+n.height/2+")");var u=r.getBBox({target:this.paper.cells});e.set("position",{x:u.x,y:u.y},kt({updateHandled:!0},t)),this.translate(),this.rotate()}this.update()},prepareEmbedding:function(t){t||(t={});var e=t.model||this.model,i=(t.paper||this.paper).model;e.startBatch("to-front"),e.toFront({deep:!0,ui:!0});var n=i.getElements().reduce((function(t,e){return Math.max(t,e.attributes.z||0)}),0);i.getConnectedLinks(e,{deep:!0,includeEnclosed:!0}).forEach((function(t){t.attributes.z<=n&&t.set("z",n+1,{ui:!0})})),e.stopBatch("to-front");var r=e.parent();r&&i.getCell(r).unembed(e,{ui:!0})},processEmbedding:function(t){t||(t={});var e=t.model||this.model,i=t.paper||this.paper,n=i.options,r=[];r=Vt(n.findParentBy)?Gt(n.findParentBy.call(i.model,this)).filter(function(t){return t instanceof Me&&this.model.id!==t.id&&!t.isEmbeddedIn(this.model)}.bind(this)):i.model.findModelsUnderElement(e,{searchBy:n.findParentBy}),n.frontParentOnly&&(r=r.slice(-1));for(var s=null,a=t.candidateEmbedView,o=r.length-1;0<=o;o--){var l=r[o];if(a&&a.model.id==l.id){s=a;break}var h=l.findView(i);if(n.validateEmbedding.call(i,this,h)){s=h;break}}s&&s!=a&&(this.clearEmbedding(t),t.candidateEmbedView=s.highlight(null,{embedding:!0})),!s&&a&&this.clearEmbedding(t)},clearEmbedding:function(t){t||(t={});var e=t.candidateEmbedView;e&&(e.unhighlight(null,{embedding:!0}),t.candidateEmbedView=null)},finalizeEmbedding:function(t){t||(t={});var e=t.candidateEmbedView,i=t.model||this.model,n=t.paper||this.paper;e&&(e.model.embed(i,{ui:!0}),e.unhighlight(null,{embedding:!0}),t.candidateEmbedView=null),Rt(n.model.getConnectedLinks(i,{deep:!0}),"reparent",{ui:!0})},getDelegatedView:function(){for(var t=this,e=t.model,i=t.paper;t&&!e.isLink();){if(!e.isEmbedded()||t.can("stopDelegation"))return t;e=e.getParentCell(),t=i.findViewByModel(e)}return null},notifyPointerdown:function(t,e,i){Qe.prototype.pointerdown.call(this,t,e,i),this.notify("element:pointerdown",t,e,i)},notifyPointermove:function(t,e,i){Qe.prototype.pointermove.call(this,t,e,i),this.notify("element:pointermove",t,e,i)},notifyPointerup:function(t,e,i){this.notify("element:pointerup",t,e,i),Qe.prototype.pointerup.call(this,t,e,i)},pointerdblclick:function(t,e,i){Qe.prototype.pointerdblclick.apply(this,arguments),this.notify("element:pointerdblclick",t,e,i)},pointerclick:function(t,e,i){Qe.prototype.pointerclick.apply(this,arguments),this.notify("element:pointerclick",t,e,i)},contextmenu:function(t,e,i){Qe.prototype.contextmenu.apply(this,arguments),this.notify("element:contextmenu",t,e,i)},pointerdown:function(t,e,i){this.isPropagationStopped(t)||(this.notifyPointerdown(t,e,i),this.dragStart(t,e,i))},pointermove:function(t,e,i){var n=this.eventData(t);switch(n.action){case"magnet":this.dragMagnet(t,e,i);break;case"move":(n.delegatedView||this).drag(t,e,i);default:this.notifyPointermove(t,e,i)}this.eventData(t,n)},pointerup:function(t,e,i){var n=this.eventData(t);switch(n.action){case"magnet":this.dragMagnetEnd(t,e,i);break;case"move":(n.delegatedView||this).dragEnd(t,e,i);default:this.notifyPointerup(t,e,i)}var r=n.targetMagnet;r&&this.magnetpointerclick(t,r,e,i),this.checkMouseleave(t)},mouseover:function(t){Qe.prototype.mouseover.apply(this,arguments),this.notify("element:mouseover",t)},mouseout:function(t){Qe.prototype.mouseout.apply(this,arguments),this.notify("element:mouseout",t)},mouseenter:function(t){Qe.prototype.mouseenter.apply(this,arguments),this.notify("element:mouseenter",t)},mouseleave:function(t){Qe.prototype.mouseleave.apply(this,arguments),this.notify("element:mouseleave",t)},mousewheel:function(t,e,i,n){Qe.prototype.mousewheel.apply(this,arguments),this.notify("element:mousewheel",t,e,i,n)},onmagnet:function(t,e,i){this.dragMagnetStart(t,e,i)},magnetpointerdblclick:function(t,e,i,n){this.notify("element:magnet:pointerdblclick",t,e,i,n)},magnetcontextmenu:function(t,e,i,n){this.notify("element:magnet:contextmenu",t,e,i,n)},dragStart:function(t,e,i){var n=this.getDelegatedView();n&&n.can("elementMove")&&(this.eventData(t,{action:"move",delegatedView:n}),n.eventData(t,{pointerOffset:n.model.position().difference(e,i),restrictedArea:this.paper.getRestrictedArea(n)}))},dragMagnetStart:function(t,e,i){if(this.can("addLinkFromMagnet")){var n=t.currentTarget,r=this.paper;this.eventData(t,{targetMagnet:n}),t.stopPropagation(),r.options.validateMagnet(this,n,t)?(r.options.magnetThreshold<=0&&this.dragLinkStart(t,n,e,i),this.eventData(t,{action:"magnet"}),this.stopPropagation(t)):this.pointerdown(t,e,i),r.delegateDragEvents(this,t.data)}},dragLinkStart:function(t,e,i,n){this.model.startBatch("add-link");var r=this.addLinkFromMagnet(e,i,n);r.notifyPointerdown(t,i,n),r.eventData(t,r.startArrowheadMove("target",{whenNotAllowed:"remove"})),this.eventData(t,{linkView:r})},addLinkFromMagnet:function(t,e,i){var n=this.paper,r=n.model,s=n.getDefaultLink(this,t);return s.set({source:this.getLinkEnd(t,e,i,s,"source"),target:{x:e,y:i}}).addTo(r,{async:!1,ui:!0}),s.findView(n)},drag:function(t,e,i){var n=this.paper,r=n.options.gridSize,s=this.model,a=this.eventData(t),o=a.pointerOffset,l=a.restrictedArea,h=a.embedding,c=E(e+o.x,r),u=E(i+o.y,r);s.position(c,u,{restrictedArea:l,deep:!0,ui:!0}),n.options.embeddingMode&&(h||(this.prepareEmbedding(a),h=!0),this.processEmbedding(a)),this.eventData(t,{embedding:h})},dragMagnet:function(t,e,i){var n=this.eventData(t),r=n.linkView;if(r)r.pointermove(t,e,i);else{var s=this.paper,a=s.options.magnetThreshold,o=this.getEventTarget(t),l=n.targetMagnet;if("onleave"===a){if(l===o||$(l).contains(o))return}else if(s.eventData(t).mousemoved<=a)return;this.dragLinkStart(t,l,e,i)}},dragEnd:function(t,e,i){var n=this.eventData(t);n.embedding&&this.finalizeEmbedding(n)},dragMagnetEnd:function(t,e,i){var n=this.eventData(t).linkView;n&&(n.pointerup(t,e,i),this.model.stopBatch("add-link"))},magnetpointerclick:function(t,e,i,n){var r=this.paper;r.eventData(t).mousemoved>r.options.clickThreshold||this.notify("element:magnet:pointerclick",t,e,i,n)}});kt($e.prototype,He);var ti={N:"S",S:"N",E:"W",W:"E"},ei={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function ii(t,e,i){var n=new S(t.x,e.y);return i.containsPoint(n)&&(n=new S(e.x,t.y)),n}function ni(t,e){return t["W"===e||"E"===e?"width":"height"]}function ri(t,e){return t.x===e.x?t.y>e.y?"N":"S":t.y===e.y?t.x>e.x?"W":"E":null}function si(t){return new T(t.x,t.y,0,0)}function ai(t){var e=xt(t.padding||t.elementPadding||20);return{x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}function oi(t,e){return t.sourceBBox.clone().moveAndExpand(ai(e))}function li(t,e){return t.targetBBox.clone().moveAndExpand(ai(e))}function hi(t,e,i){var n=new S(t.x,e.y),r=new S(e.x,t.y),s=ri(t,n),a=ri(t,r),o=ti[i],l=s===i||s!==o&&(a===o||a!==i)?n:r;return{points:[l],direction:ri(l,e)}}function ci(t,e,i){var n=ii(t,e,i);return{points:[n],direction:ri(n,e)}}function ui(t,e,i,n){var r,s={},a=[new S(t.x,e.y),new S(e.x,t.y)],o=a.filter((function(t){return!i.containsPoint(t)})),l=o.filter((function(e){return ri(e,t)!==n}));if(0<l.length)r=(r=l.filter((function(e){return ri(t,e)===n})).pop())||l[0],s.points=[r],s.direction=ri(r,e);else{r=qt(a,o)[0];var h=new S(e).move(r,-ni(i,n)/2),c=ii(h,t,i);s.points=[c,h],s.direction=ri(h,e)}return s}function di(t,e,i,n){var r=ci(e,t,n),s=r.points[0];if(i.containsPoint(s)){var a=(r=ci(t,e,i)).points[0];if(n.containsPoint(a)){var o=new S(t).move(a,-ni(i,ri(t,a))/2),l=new S(e).move(s,-ni(n,ri(e,s))/2),h=new C(o,l).midpoint(),c=ci(t,h,i),u=hi(h,e,c.direction);r.points=[c.points[0],u.points[0]],r.direction=u.direction}}return r}function fi(t,e,i,n,r){var s,a,o,l={},h=i.union(n).inflate(1),c=h.center().distance(e)>h.center().distance(t),u=c?e:t,d=c?t:e;return a=ii(s=r?(s=S.fromPolar(h.width+h.height,ei[r],u),h.pointNearestToPoint(s).move(s,-1)):h.pointNearestToPoint(u).move(u,1),d,h),s.round().equals(a.round())?(a=S.fromPolar(h.width+h.height,D(s.theta(u))+Math.PI/2,d),o=ii(s,a=h.pointNearestToPoint(a).move(d,1).round(),h),l.points=c?[a,o,s]:[s,o,a]):l.points=c?[a,s]:[s,a],l.direction=ri(c?s:a,e),l}function pi(t,e,i){var n,r,s,a,o,l=oi(i,e),h=li(i,e),c=(r=e,(n=i).sourceAnchor?n.sourceAnchor:oi(n,r).center()),u=(a=e,(s=i).targetAnchor?s.targetAnchor:li(s,a).center());l=l.union(si(c)),h=h.union(si(u)),(t=Gt(t).map(S)).unshift(c),t.push(u);for(var d=[],f=0,p=t.length-1;f<p;f++){var m=null,g=t[f],v=t[f+1],_=!!ri(g,v);if(0===f)f+1===p?l.intersect(h.clone().inflate(1))?m=fi(g,v,l,h):_||(m=di(g,v,l,h)):l.containsPoint(v)?m=fi(g,v,l,si(v).moveAndExpand(ai(e))):_||(m=ci(g,v,l));else if(f+1===p){var y=_&&ri(v,g)===o;h.containsPoint(g)||y?m=fi(g,v,si(g).moveAndExpand(ai(e)),h,o):_||(m=ui(g,v,h,o))}else _||(m=hi(g,v,o));o=m?(Array.prototype.push.apply(d,m.points),m.direction):ri(g,v),f+1<p&&d.push(v)}return d}var mi={step:10,maximumLoops:2e3,precision:1,maxAllowedDirectionChange:90,perpendicular:!0,excludeEnds:[],excludeTypes:["basic.Text"],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost:function(){return this.step},directions:function(){var t=this.step,e=this.cost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:0,offsetY:t,cost:e},{offsetX:-t,offsetY:0,cost:e},{offsetX:0,offsetY:-t,cost:e}]},penalties:function(){return{0:0,45:this.step/2,90:this.step/2}},paddingBox:function(){var t=this.step;return{x:-t,y:-t,width:2*t,height:2*t}},fallbackRouter:function(t,e,i){if(!Vt(pi))throw new Error("Manhattan requires the orthogonal router as default fallback.");return pi(t,kt({},mi,e),i)},fallbackRoute:function(t,e,i){return null},draggingRoute:null};function gi(t){this.map={},this.options=t,this.mapGridSize=100}function vi(){this.items=[],this.hash={},this.values={},this.OPEN=1,this.CLOSE=2}function _i(t,e){return e&&e.paddingBox?t.sourceBBox.clone().moveAndExpand(e.paddingBox):t.sourceBBox.clone()}function yi(t,e){return e&&e.paddingBox?t.targetBBox.clone().moveAndExpand(e.paddingBox):t.targetBBox.clone()}function bi(t,e){return t.sourceAnchor?t.sourceAnchor:_i(t,e).center()}function xi(t,e,i,n,r){var s,a,o,l,h,c,u,d,f=360/i,p=t.theta((s=t,a=e,o=n,l=r.step,h=a.x-s.x,c=a.y-s.y,u=h/o.x*l,d=c/o.y*l,new S(s.x+u,s.y+d))),m=P(p+f/2);return f*Math.floor(m/f)}function wi(t,e){var i=Math.abs(t-e);return 180<i?360-i:i}function Ai(t,e){if(!t)return e;var i=Math.abs(t),n=Math.round(i/e);return n?e+(i-n*e)/n:i}function Ci(t,e){return t.round(e)}function Ii(t,e,i){return Ci((n=t.clone(),s=(r=e).source,a=E(n.x-s.x,r.x)+s.x,o=E(n.y-s.y,r.y)+s.y,new S(a,o)),i);var n,r,s,a,o}function Si(t){return t.clone().toString()}function Mi(t){return new S(0===t.x?0:Math.abs(t.x)/t.x,0===t.y?0:Math.abs(t.y)/t.y)}function Ti(t,e,i,n,r,s,a){for(var o,l=[],h=Mi(r.difference(i)),c=Si(i),u=t[c];u;){var d=Mi((o=e[c]).difference(u));d.equals(h)||(l.unshift(o),h=d),u=t[c=Si(u)]}var f=e[c];return Mi(f.difference(n)).equals(h)||l.unshift(f),l}function Pi(t,e){for(var i=1/0,n=0,r=e.length;n<r;n++){var s=t.manhattanDistance(e[n]);s<i&&(i=s)}return i}function Ei(t,e,i,n,r){var s=r.precision,a=r.directionMap,o=t.difference(e.center()),l=le(a)?Object.keys(a):[],h=Gt(i),c=l.reduce((function(i,r){if(h.includes(r)){for(var l,c=a[r],u=new S(t.x+c.x*(Math.abs(o.x)+e.width),t.y+c.y*(Math.abs(o.y)+e.height)),d=new C(t,u).intersect(e)||[],f=d.length,p=null,m=0;m<f;m++){var g=d[m],v=t.squaredDistance(g);(void 0===l||l<v)&&(l=v,p=g)}if(p){var _=Ii(p,n,s);e.containsPoint(_)&&(_=Ii(_.offset(c.x*n.x,c.y*n.y),n,s)),i.push(_)}}return i}),[]);return e.containsPoint(t)||c.push(Ii(t,n,s)),c}function ki(t,e,i,n){var r,s,a,o,l=n.precision;r=Ci(t instanceof T?bi(this,n).clone():t.clone(),l),s=Ci(e instanceof T?(a=this,o=n,a.targetAnchor?a.targetAnchor:yi(a,o).center()).clone():e.clone(),l);var h,c,u,d,f,p,m,g,v,_,y=(h=n.step,u=s,{source:(c=r).clone(),x:Ai(u.x-c.x,h),y:Ai(u.y-c.y,h)});if(p=t instanceof T?Ei(d=r,t,n.startDirections,y,n):[d=r],m=e instanceof T?Ei(f=s,e,n.endDirections,y,n):[f=s],p=p.filter(i.isPointAccessible,i),m=m.filter(i.isPointAccessible,i),0<p.length&&0<m.length){for(var b=new vi,x={},w={},A={},C=0,I=p.length;C<I;C++){var S=p[C],M=Si(S);b.add(M,Pi(S,m)),x[M]=S,A[M]=0}var P,E,k=n.previousDirectionAngle,D=void 0===k,O=n.directions;g=y,_=(v=n).step,Gt(v.directions).forEach((function(t){t.gridOffsetX=t.offsetX/_*g.x,t.gridOffsetY=t.offsetY/_*g.y}));for(var R=O.length,L=Gt(m).reduce((function(t,e){var i=Si(e);return t.push(i),t}),[]),N=n.maximumLoops;!b.isEmpty()&&0<N;){var z,B=b.pop(),F=x[B],j=w[B],V=A[B],U=void 0===j,G=F.equals(d);z=U?D?G?null:xi(d,F,R,y,n):k:xi(j,F,R,y,n);var W=jt(p,m);if((!U||!W)&&0<=L.indexOf(B))return n.previousDirectionAngle=z,Ti(w,x,F,d,f);for(C=0;C<R;C++){var H=(P=O[C]).angle;if(E=wi(z,H),D&&G||!(E>n.maxAllowedDirectionChange)){var X=Ii(F.clone().offset(P.gridOffsetX,P.gridOffsetY),y,l),Z=Si(X);if(!b.isClose(Z)&&i.isPointAccessible(X)){if(0<=L.indexOf(Z)&&!X.equals(f)&&wi(H,xi(X,f,R,y,n))>n.maxAllowedDirectionChange)continue;var Y=V+P.cost+(G?0:n.penalties[E]);(!b.isOpen(Z)||Y<A[Z])&&(x[Z]=X,w[Z]=F,A[Z]=Y,b.add(Z,Y+Pi(X,m)))}}}N--}}return n.fallbackRoute.call(this,d,f,n)}gi.prototype.build=function(t,e){var i=this.options,n=Gt(i.excludeEnds).reduce((function(i,n){var r=e.get(n);if(r){var s=t.getCell(r.id);s&&i.push(s)}return i}),[]),r=[],s=t.getCell(e.get("source").id);s&&(r=Jt(r,s.getAncestors().map((function(t){return t.id}))));var a=t.getCell(e.get("target").id);a&&(r=Jt(r,a.getAncestors().map((function(t){return t.id}))));var o=this.mapGridSize;return t.getElements().reduce((function(t,e){var s=Gt(i.excludeTypes).includes(e.get("type")),a=n.find((function(t){return t.id===e.id})),l=r.includes(e.id);if(!(s||a||l))for(var h=e.getBBox().moveAndExpand(i.paddingBox),c=h.origin().snapToGrid(o),u=h.corner().snapToGrid(o),d=c.x;d<=u.x;d+=o)for(var f=c.y;f<=u.y;f+=o){var p=d+"@"+f;t[p]=t[p]||[],t[p].push(h)}return t}),this.map),this},gi.prototype.isPointAccessible=function(t){var e=t.clone().snapToGrid(this.mapGridSize).toString();return Gt(this.map[e]).every((function(e){return!e.containsPoint(t)}))},vi.prototype.add=function(t,e){this.hash[t]?this.items.splice(this.items.indexOf(t),1):this.hash[t]=this.OPEN,this.values[t]=e;var i=Lt(this.items,t,function(t){return this.values[t]}.bind(this));this.items.splice(i,0,t)},vi.prototype.remove=function(t){this.hash[t]=this.CLOSE},vi.prototype.isOpen=function(t){return this.hash[t]===this.OPEN},vi.prototype.isClose=function(t){return this.hash[t]===this.CLOSE},vi.prototype.isEmpty=function(){return 0===this.items.length},vi.prototype.pop=function(){var t=this.items.shift();return this.remove(t),t};var Di=function(t,e,i){return function(t,e,i){!function(t){if(t.directions=$t(t,"directions"),t.penalties=$t(t,"penalties"),t.paddingBox=$t(t,"paddingBox"),t.padding=$t(t,"padding"),t.padding){var e=xt(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}Gt(t.directions).forEach((function(t){var e=new S(0,0),i=new S(t.offsetX,t.offsetY);t.angle=P(e.theta(i))}))}(e),i.options.perpendicular=!!e.perpendicular;for(var n,r,s=_i(i,e),a=yi(i,e),o=bi(i,e),l=new gi(e).build(i.paper.model,i.model),h=Gt(t).map(S),c=[],u=o,d=0,f=h.length;d<=f;d++){var p=null;if(r=n||s,!(n=h[d])&&(n=a,(!i.model.get("source").id||!i.model.get("target").id)&&Vt(e.draggingRoute))){var m=r===s?o:r,g=n.origin();p=e.draggingRoute.call(i,m,g,e)}if(null===(p=p||ki.call(i,r,n,l,e)))return e.fallbackRouter(t,e,i);var v=p[0];v&&v.equals(u)&&p.shift(),u=p[p.length-1]||u,Array.prototype.push.apply(c,p)}return c}(t,kt({},mi,e),i)},Oi={maxAllowedDirectionChange:45,diagonalCost:function(){var t=this.step;return Math.ceil(Math.sqrt(t*t<<1))},directions:function(){var t=this.step,e=this.cost(),i=this.diagonalCost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:t,offsetY:t,cost:i},{offsetX:0,offsetY:t,cost:e},{offsetX:-t,offsetY:t,cost:i},{offsetX:-t,offsetY:0,cost:e},{offsetX:-t,offsetY:-t,cost:i},{offsetX:0,offsetY:-t,cost:e},{offsetX:t,offsetY:-t,cost:i}]},fallbackRoute:function(t,e,i){var n=t.theta(e),r=[],s={x:e.x,y:t.y},a={x:t.x,y:e.y};if(90<n%180){var o=s;s=a,a=o}var l=n%90<45?s:a,h=new C(t,l),c=90*Math.ceil(n/90),u=S.fromPolar(h.squaredLength(),D(c+135),l),d=new C(e,u),f=h.intersection(d),p=f||e,m=f?p:t,g=360/i.directions.length,v=m.theta(e),_=P(v+g/2),y=g*Math.floor(_/g);return i.previousDirectionAngle=y,p&&r.push(p.round()),r.push(e),r}},Ri={normal:function(t,e,i){return t},oneSide:function(t,e,i){var n,r,s,a=e.side||"bottom",o=xt(e.padding||40),l=i.sourceBBox,h=i.targetBBox,c=l.center(),u=h.center();switch(a){case"bottom":s=1,n="y",r="height";break;case"top":s=-1,n="y",r="height";break;case"left":s=-1,n="x",r="width";break;case"right":s=1,n="x",r="width";break;default:throw new Error("Router: invalid side")}return c[n]+=s*(l[r]/2+o[a]),u[n]+=s*(h[r]/2+o[a]),0<s*(c[n]-u[n])?u[n]=c[n]:c[n]=u[n],[c].concat(t,u)},orthogonal:pi,manhattan:Di,metro:function(t,e,i){if(!Vt(Di))throw new Error("Metro requires the manhattan router.");return Di(t,kt({},Oi,e),i)}},Li=["arc","gap","cubic"],Ni=["smooth"];function zi(t,e,i){var n=[].concat(t,i,e);return n.reduce((function(t,e,i){var r=n[i+1];return null!=r&&(t[i]=L(e,r)),t}),[])}function Bi(){for(var t=this._jumpOverUpdateList,e=0;e<t.length;e++)t[e].update()}function Fi(t,e){return L(t,e).squaredLength()}function ji(t,e,i,n){var r,s=new I;return r=I.createSegment("M",t[0].start),s.appendSegment(r),Gt(t).forEach((function(a,o){if(a.isJump){var l,h,c,u;if("arc"===i){l=-90,h=a.start.difference(a.end);var d=Number(h.x<0||0===h.x&&h.y<0);d&&(l+=180);var f,p=a.midpoint(),m=new C(p,a.end).rotate(p,l);c=(f=new C(a.start,p)).pointAt(2/3).rotate(a.start,l),u=m.pointAt(1/3).rotate(m.end,-l),r=I.createSegment("C",c,u,m.end),s.appendSegment(r),f=new C(p,a.end),c=m.pointAt(1/3).rotate(m.end,l),u=f.pointAt(1/3).rotate(a.end,-l),r=I.createSegment("C",c,u,a.end),s.appendSegment(r)}else if("gap"===i)r=I.createSegment("M",a.end),s.appendSegment(r);else if("cubic"===i){l=a.start.theta(a.end);var g=.6*e,v=1.35*e;h=a.start.difference(a.end),(d=Number(h.x<0||0===h.x&&h.y<0))&&(v*=-1),c=S(a.start.x+g,a.start.y+v).rotate(a.start,l),u=S(a.end.x-g,a.end.y+v).rotate(a.end,l),r=I.createSegment("C",c,u,a.end),s.appendSegment(r)}}else{var _=t[o+1];0==n||!_||_.isJump?(r=I.createSegment("L",a.end),s.appendSegment(r)):(y=n,b=s,x=a.end,w=a.start,A=_.end,T=x.distance(w)/2,P=x.distance(A)/2,E=-Math.min(y,T),k=-Math.min(y,P),D=x.clone().move(w,E).round(),O=x.clone().move(A,k).round(),R=new S(1/3*D.x+2/3*x.x,2/3*x.y+1/3*D.y),L=new S(1/3*O.x+2/3*x.x,2/3*x.y+1/3*O.y),M=I.createSegment("L",D),b.appendSegment(M),M=I.createSegment("C",R,L,O),b.appendSegment(M))}var y,b,x,w,A,M,T,P,E,k,D,O,R,L})),s}var Vi={jumpover:function(t,e,i,n){var r,s;null==(s=(r=this).paper._jumpOverUpdateList)&&(s=r.paper._jumpOverUpdateList=[],r.paper.on("cell:pointerup",Bi),r.paper.model.on("reset",(function(){s=r.paper._jumpOverUpdateList=[]}))),s.indexOf(r)<0&&(s.push(r),r.listenToOnce(r.model,"change:connector remove",(function(){s.splice(s.indexOf(r),1)})));var a=n.raw,o=n.size||5,l=n.jump&&(""+n.jump).toLowerCase(),h=n.radius||0,c=n.ignoreConnectors||Ni;-1===Li.indexOf(l)&&(l=Li[0]);var u=this.paper,d=u.model.getLinks();if(1===d.length)return ji(zi(t,e,i),o,l,h);var f=this.model,p=d.indexOf(f),m=u.options.defaultConnector||{},g=d.filter((function(t,e){var i=t.get("connector")||m;return!(Gt(c).includes(i.name)||p<e&&"jumpover"===i.name)})),v=g.map((function(t){return u.findViewByModel(t)})),_=zi(t,e,i),y=v.map((function(t){return null==t?[]:t===this?_:zi(t.sourcePoint,t.targetPoint,t.route)}),this),b=ji(_.reduce((function(t,e){var i,n,r,s=g.reduce((function(t,i,n){if(i!==f){var r=(s=e,a=y[n],Gt(a).reduce((function(t,e){var i=s.intersection(e);return i&&t.push(i),t}),[]));t.push.apply(t,r)}var s,a;return t}),[]).sort((function(t,i){return Fi(e.start,t)-Fi(e.start,i)}));return 0<s.length?t.push.apply(t,(i=e,r=o,(n=s).reduce((function(t,e,s){if(!0===e.skip)return t;var a=t.pop()||i,o=N(e).move(a.start,-r),l=N(e).move(a.start,+r),h=n[s+1];if(null!=h){var c=l.distance(h);c<=r&&(l=h.move(a.start,c),h.skip=!0)}else if(o.distance(a.end)<2*r+1)return t.push(a),t;if(l.distance(a.start)<2*r+1)return t.push(a),t;var u=L(o,l);return u.isJump=!0,t.push(L(a.start,o),u,L(l,a.end)),t}),[]))):t.push(e),t}),[]),o,l,h);return a?b:b.serialize()},normal:function(t,e,i,n){var r=n&&n.raw,s=[t].concat(i).concat([e]),a=new M(s),o=new I(a);return r?o:o.serialize()},rounded:function(t,e,i,n){n||(n={});var r,s=n.radius||10,a=n.raw,o=new I;r=I.createSegment("M",t),o.appendSegment(r);for(var l,h,c,u,d,f,p,m,g,v,_,y=0,b=i.length;y<b;y++)l=new S(i[y]),h=i[y-1]||t,c=i[y+1]||e,u=d||l.distance(h)/2,d=l.distance(c)/2,f=-Math.min(s,u),p=-Math.min(s,d),m=l.clone().move(h,f).round(),g=l.clone().move(c,p).round(),v=new S(1/3*m.x+2/3*l.x,2/3*l.y+1/3*m.y),_=new S(1/3*g.x+2/3*l.x,2/3*l.y+1/3*g.y),r=I.createSegment("L",m),o.appendSegment(r),r=I.createSegment("C",v,_,g),o.appendSegment(r);return r=I.createSegment("L",e),o.appendSegment(r),a?o:o.serialize()},smooth:function(t,e,i,n){var r,s=n&&n.raw;if(i&&0!==i.length){var a=[t].concat(i).concat([e]),o=w.throughPoints(a);r=new I(o)}else{var l;if(r=new I,l=I.createSegment("M",t),r.appendSegment(l),Math.abs(t.x-e.x)>=Math.abs(t.y-e.y)){var h=(t.x+e.x)/2;l=I.createSegment("C",h,t.y,h,e.y,e.x,e.y),r.appendSegment(l)}else{var c=(t.y+e.y)/2;l=I.createSegment("C",t.x,c,e.x,c,e.x,e.y),r.appendSegment(l)}}return s?r:r.serialize()}},Ui=Qe.extend({className:function(){var t=Qe.prototype.className.apply(this).split(" ");return t.push("link"),t.join(" ")},options:{shortLinkLength:105,doubleLinkTools:!1,longLinkLength:155,linkToolsOffset:40,doubleLinkToolsOffset:65,sampleInterval:50},_labelCache:null,_labelSelectors:null,_markerCache:null,_V:null,_dragData:null,metrics:null,decimalsRounding:2,initialize:function(){Qe.prototype.initialize.apply(this,arguments),this._labelCache={},this._labelSelectors={},this._markerCache={},this._V={},this.metrics={}},presentationAttributes:{markup:["RENDER"],attrs:["UPDATE"],router:["UPDATE"],connector:["UPDATE"],smooth:["UPDATE"],manhattan:["UPDATE"],toolMarkup:["TOOLS"],labels:["LABELS"],labelMarkup:["LABELS"],vertices:["VERTICES","UPDATE"],vertexMarkup:["VERTICES"],source:["SOURCE","UPDATE"],target:["TARGET","UPDATE"]},initFlag:["RENDER","SOURCE","TARGET"],UPDATE_PRIORITY:1,confirmUpdate:function(t,e){if(e||(e={}),this.hasFlag(t,"SOURCE")){if(!this.updateEndProperties("source"))return t;t=this.removeFlag(t,"SOURCE")}if(this.hasFlag(t,"TARGET")){if(!this.updateEndProperties("target"))return t;t=this.removeFlag(t,"TARGET")}var i=this.paper,n=this.sourceView,r=this.targetView;if(i&&(n&&!i.isViewMounted(n)||r&&!i.isViewMounted(r)))return t;if(this.hasFlag(t,"RENDER"))return this.render(),this.removeFlag(t,["RENDER","UPDATE","VERTICES","TOOLS","LABELS"]);this.hasFlag(t,"VERTICES")&&(this.renderVertexMarkers(),t=this.removeFlag(t,"VERTICES"));var s=this.model,a=s.attributes,o=this.hasFlag(t,"LABELS"),l=this.hasFlag(t,"TOOLS");return o&&(this.onLabelsChange(s,a.labels,e),t=this.removeFlag(t,"LABELS")),l&&(this.renderTools(),t=this.removeFlag(t,"TOOLS")),this.hasFlag(t,"UPDATE")&&(this.update(s,null,e),t=this.removeFlag(t,"UPDATE"),l=o=!1),o&&this.updateLabelPositions(),l&&this.updateToolsPosition(),t},requestConnectionUpdate:function(t){var e=this.paper,i=this.UPDATE_PRIORITY;e&&e.requestViewUpdate(this,this.getFlag("UPDATE"),i,t)},isLabelsRenderRequired:function(t){void 0===t&&(t={});var e=this.model.previous("labels");if(!e)return!0;if("propertyPathArray"in t&&"propertyValue"in t){var i=t.propertyPathArray||[],n=i.length;if(1<n&&e[i[1]]){if(2===n)return"markup"in Object(t.propertyValue);if("markup"!==i[2])return!1}}return!0},onLabelsChange:function(t,e,i){this.isLabelsRenderRequired(i)?this.renderLabels():this.updateLabels()},render:function(){return this.vel.empty(),this._V={},this.renderMarkup(),this.renderLabels(),this.update(),this},renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.LinkView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if("string"==typeof e)return this.renderStringMarkup(e);throw new Error("dia.LinkView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el);this.selectors=e.selectors,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=$(t);Array.isArray(e)||(e=[e]);for(var i=this._V,r=0,s=e.length;r<s;r++){var a=e[r],o=a.attr("class");o&&(o=it(o),i[n.camelCase(o)]=a)}this.renderTools(),this.renderVertexMarkers(),this.renderArrowheadMarkers(),this.vel.append(e)},_getLabelMarkup:function(t){if(t){if(Array.isArray(t))return this.parseDOMJSON(t,null);if("string"==typeof t)return this._getLabelStringMarkup(t);throw new Error("dia.linkView: invalid label markup")}},_getLabelStringMarkup:function(t){var e=$(t),i=document.createDocumentFragment();if(Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var s=e[n].node;i.appendChild(s)}else i.appendChild(e.node);return{fragment:i,selectors:{}}},_normalizeLabelMarkup:function(t){if(t){var e,i=t.fragment;if(!(t.fragment instanceof DocumentFragment&&t.fragment.hasChildNodes()))throw new Error("dia.LinkView: invalid label markup.");var n=i.childNodes;return(e=1<n.length||"G"!==n[0].nodeName.toUpperCase()?$("g").append(i):$(n[0])).addClass("label"),{node:e.node,selectors:t.selectors}}},renderLabels:function(){var t=this._V,e=t.labels,i=this._labelCache={},n=this._labelSelectors={},r=this.model,s=r.attributes.labels||[],a=s.length;if(0===a)return e&&e.remove(),this;e?e.empty():e=t.labels=$("g").addClass("labels");for(var o=e.node,l=0;l<a;l++){var h,c,u=s[l],d=this._normalizeLabelMarkup(this._getLabelMarkup(u.markup));if(d)h=d.node,c=d.selectors;else{var f=r._builtins.defaultLabel,p=this._normalizeLabelMarkup(this._getLabelMarkup(f.markup)),m=r._getDefaultLabel(),g=this._normalizeLabelMarkup(this._getLabelMarkup(m.markup))||p;h=g.node,c=g.selectors}h.setAttribute("label-idx",l),o.appendChild(h),i[l]=h;var v=this.selector;if(c[v])throw new Error("dia.LinkView: ambiguous label root selector.");c[v]=h,n[l]=c}return o.parentNode||this.el.appendChild(o),this.updateLabels(),this},_mergeLabelAttrs:function(t,e,i,n){return null===e?null:void 0!==e?t?ae({},i,e):ae({},n,i,e):null===i?null:void 0!==i?t?i:ae({},n,i):t?void 0:n},updateLabels:function(){if(!this._V.labels)return this;for(var t=this.model,e=t.get("labels")||[],i=this.can("labelMove"),n=t._builtins.defaultLabel.attrs,r=t._getDefaultLabel(),s=r.markup,a=r.attrs,o=0,l=e.length;o<l;o++){var h=this._labelCache[o];h.setAttribute("cursor",i?"move":"default");var c=this._labelSelectors[o],u=e[o],d=u.markup,f=u.attrs,p=this._mergeLabelAttrs(d||s,f,a,n);this.updateDOMSubtreeAttributes(h,p,{rootBBox:new T(u.size),selectors:c})}return this},renderTools:function(){if(!this._V.linkTools)return this;var t,e=n(this._V.linkTools.node).empty(),i=St(this.model.get("toolMarkup")||this.model.toolMarkup),r=$(i());return e.append(r.node),this._toolCache=r,this.options.doubleLinkTools&&(t=this.model.get("doubleToolMarkup")||this.model.doubleToolMarkup?(i=St(this.model.get("doubleToolMarkup")||this.model.doubleToolMarkup),$(i())):r.clone(),e.append(t.node),this._tool2Cache=t),this},renderVertexMarkers:function(){if(!this._V.markerVertices)return this;var t=n(this._V.markerVertices.node).empty(),e=St(this.model.get("vertexMarkup")||this.model.vertexMarkup);return this.model.vertices().forEach((function(i,n){t.append($(e(kt({idx:n},i))).node)})),this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;var t=n(this._V.markerArrowheads.node);t.empty();var e=St(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);return this._V.sourceArrowhead=$(e({end:"source"})),this._V.targetArrowhead=$(e({end:"target"})),t.append(this._V.sourceArrowhead.node,this._V.targetArrowhead.node),this},update:function(t,e,i){return i||(i={}),this.cleanNodesCache(),this.updateConnection(i),this.updateDOMSubtreeAttributes(this.el,this.model.attr(),{selectors:this.selectors}),this.updateDefaultConnectionPath(),this.updateLabelPositions(),this.updateToolsPosition(),this.updateArrowheadMarkers(),this.updateTools(i),this.options.perpendicular=null,this},removeRedundantLinearVertices:function(t){var e=this.model,i=e.vertices(),n=[this.sourceAnchor].concat(i,[this.targetAnchor]),r=n.length,s=new M(n);s.simplify({threshold:.001});var a=s.points.map((function(t){return t.toJSON()})),o=a.length;return r===o?0:(e.vertices(a.slice(1,o-1),t),r-o)},updateDefaultConnectionPath:function(){var t=this._V;t.connection&&t.connection.attr("d",this.getSerializedConnection()),t.connectionWrap&&t.connectionWrap.attr("d",this.getSerializedConnection()),t.markerSource&&t.markerTarget&&this._translateAndAutoOrientArrows(t.markerSource,t.markerTarget)},getEndView:function(t){switch(t){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw new Error("dia.LinkView: type parameter required.")}},getEndAnchor:function(t){switch(t){case"source":return new S(this.sourceAnchor);case"target":return new S(this.targetAnchor);default:throw new Error("dia.LinkView: type parameter required.")}},getEndConnectionPoint:function(t){switch(t){case"source":return new S(this.sourcePoint);case"target":return new S(this.targetPoint);default:throw new Error("dia.LinkView: type parameter required.")}},getEndMagnet:function(t){switch(t){case"source":var e=this.sourceView;if(!e)break;return this.sourceMagnet||e.el;case"target":var i=this.targetView;if(!i)break;return this.targetMagnet||i.el;default:throw new Error("dia.LinkView: type parameter required.")}return null},updateConnection:function(t){t=t||{};var e,i,n=this.model;if(t.translateBy&&n.isRelationshipEmbeddedIn(t.translateBy)){var r=t.tx||0,s=t.ty||0;e=new M(this.route).translate(r,s).points,this._translateConnectionPoints(r,s),(i=this.path).translate(r,s)}else{var a=n.vertices(),o=this.findAnchors(a),l=this.sourceAnchor=o.source,h=this.targetAnchor=o.target;e=this.findRoute(a,t);var c=this.findConnectionPoints(e,l,h),u=this.sourcePoint=c.source,d=this.targetPoint=c.target,f=this.findMarkerPoints(e,u,d);i=this.findPath(e,f.source||u,f.target||d)}this.route=e,this.path=i,this.metrics={}},findMarkerPoints:function(t,e,i){var n,r,s=t[0],a=t[t.length-1],o=this._markerCache;return this._V.markerSource&&(o.sourceBBox=o.sourceBBox||this._V.markerSource.getBBox(),n=S(e).move(s||i,o.sourceBBox.width*this._V.markerSource.scale().sx*-1).round()),this._V.markerTarget&&(o.targetBBox=o.targetBBox||this._V.markerTarget.getBBox(),r=S(i).move(a||e,o.targetBBox.width*this._V.markerTarget.scale().sx*-1).round()),o.sourcePoint=n||e.clone(),o.targetPoint=r||i.clone(),{source:n,target:r}},findAnchorsOrdered:function(t,e,i,n){var r,s,a,o,l=this.model,h=l.get(t),c=l.get(i),u=this.getEndView(t),d=this.getEndView(i),f=this.getEndMagnet(t),p=this.getEndMagnet(i);r=u?(a=e?new S(e):d?p:new S(c),this.getAnchor(h.anchor,u,f,a,t)):new S(h),s=d?(o=new S(n||r),this.getAnchor(c.anchor,d,p,o,i)):new S(c);var m={};return m[t]=r,m[i]=s,m},findAnchors:function(t){var e=this.model,i=t[0],n=t[t.length-1];return e.target().priority&&!e.source().priority?this.findAnchorsOrdered("target",n,"source",i):this.findAnchorsOrdered("source",i,"target",n)},findConnectionPoints:function(t,e,i){var n,r,s,a,o=t[0],l=t[t.length-1],h=this.model,c=h.get("source"),u=h.get("target"),d=this.sourceView,f=this.targetView,p=this.paper.options;if(d&&!d.isNodeConnection(this.sourceMagnet)){n=this.sourceMagnet||d.el;var m=c.connectionPoint||p.defaultConnectionPoint,g=new C(o||i,e);s=this.getConnectionPoint(m,d,n,g,"source")}else s=e;if(f&&!f.isNodeConnection(this.targetMagnet)){r=this.targetMagnet||f.el;var v=u.connectionPoint||p.defaultConnectionPoint,_=new C(l||e,i);a=this.getConnectionPoint(v,f,r,_,"target")}else a=i;return{source:s,target:a}},getAnchor:function(t,e,i,n,r){var s,a=e.isNodeConnection(i),o=this.paper.options;if(t||(t=a?o.defaultLinkAnchor:o.perpendicularLinks||this.options.perpendicular?{name:"perpendicular"}:o.defaultAnchor),!t)throw new Error("Anchor required.");if("function"==typeof t)s=t;else{var l=t.name;if("function"!=typeof(s=o[a?"linkAnchorNamespace":"anchorNamespace"][l]))throw new Error("Unknown anchor: "+l)}var h=s.call(this,e,i,n,t.args||{},r,this);return h?h.round(this.decimalsRounding):new S},getConnectionPoint:function(t,e,i,n,r){var s,a,o=n.end,l=this.paper.options;if("function"==typeof l.linkConnectionPoint){var h=i===e.el?void 0:i;if(s=l.linkConnectionPoint(this,e,h,n.start,r))return s}if(!t)return o;if("function"==typeof t)a=t;else{var c=t.name;if("function"!=typeof(a=l.connectionPointNamespace[c]))throw new Error("Unknown connection point: "+c)}return(s=a.call(this,n,e,i,t.args||{},r,this))?s.round(this.decimalsRounding):o},_translateConnectionPoints:function(t,e){var i=this._markerCache;i.sourcePoint.offset(t,e),i.targetPoint.offset(t,e),this.sourcePoint.offset(t,e),this.targetPoint.offset(t,e),this.sourceAnchor.offset(t,e),this.targetAnchor.offset(t,e)},_normalizeLabelPosition:function(t){return"number"==typeof t?{distance:t,offset:null,angle:0,args:null}:t},updateLabelPositions:function(){if(!this._V.labels)return this;if(!this.path)return this;var t=this.model,e=t.get("labels")||[];if(!e.length)return this;for(var i=t._builtins.defaultLabel.position,n=t._getDefaultLabel(),r=this._normalizeLabelPosition(n.position),s=ae({},i,r),a=0,o=e.length;a<o;a++){var l=this._labelCache[a];if(l){var h=e[a],c=this._normalizeLabelPosition(h.position),u=ae({},s,c),d=this._getLabelTransformationMatrix(u);l.setAttribute("transform",$.matrixToTransformString(d))}}return this},updateToolsPosition:function(){if(!this._V.linkTools)return this;var t="",e=this.options.linkToolsOffset,i=this.getConnectionLength();if(!Number.isNaN(i)){i<this.options.shortLinkLength&&(t="scale(.5)",e/=2);var n=this.getPointAtLength(e);if(this._toolCache.attr("transform","translate("+n.x+", "+n.y+") "+t),this.options.doubleLinkTools&&i>=this.options.longLinkLength){var r=this.options.doubleLinkToolsOffset||e;n=this.getPointAtLength(i-r),this._tool2Cache.attr("transform","translate("+n.x+", "+n.y+") "+t),this._tool2Cache.attr("visibility","visible")}else this.options.doubleLinkTools&&this._tool2Cache.attr("visibility","hidden")}return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;if("none"===n.css(this._V.markerArrowheads.node,"display"))return this;var t=this.getConnectionLength()<this.options.shortLinkLength?.5:1;return this._V.sourceArrowhead.scale(t),this._V.targetArrowhead.scale(t),this._translateAndAutoOrientArrows(this._V.sourceArrowhead,this._V.targetArrowhead),this},updateEndProperties:function(t){var e=this.model,i=this.paper,n=t+"View",r=e.get(t),s=r&&r.id;if(!s)return this[n]=null,this.updateEndMagnet(t),!0;var a=i.getModelById(s);if(!a)throw new Error("LinkView: invalid "+t+" cell.");var o=a.findView(i);return!!o&&(this[n]=o,this.updateEndMagnet(t),!0)},updateEndMagnet:function(t){var e=t+"Magnet",i=this.getEndView(t);if(i){var n=i.getMagnetFromLinkEnd(this.model.get(t));n===i.el&&(n=null),this[e]=n}else this[e]=null},_translateAndAutoOrientArrows:function(t,e){var i=Gt(this.route);t&&t.translateAndAutoOrient(this.sourcePoint,i[0]||this.targetPoint,this.paper.cells),e&&e.translateAndAutoOrient(this.targetPoint,i[i.length-1]||this.sourcePoint,this.paper.cells)},_getLabelPositionAngle:function(t){return(this.model.label(t).position||{}).angle||0},_getLabelPositionArgs:function(t){return(this.model.label(t).position||{}).args},_getDefaultLabelPositionArgs:function(){return(this.model._getDefaultLabel().position||{}).args},_mergeLabelPositionArgs:function(t,e){return null===t?null:void 0===t?null===e?null:e:ae({},e,t)},addLabel:function(t,e,i,n){var r,s,a,o=0;a="number"!=typeof t?(r=t.x,s=t.y,"number"==typeof e?(o=e,i):e):(r=t,s=e,"number"==typeof i?(o=i,n):i);var l=this._getDefaultLabelPositionArgs(),h=a,c=this._mergeLabelPositionArgs(h,l),u={position:this.getLabelPosition(r,s,o,c)};return this.model.insertLabel(-1,u,a),-1},addVertex:function(t,e,i){var n="number"!=typeof t,r=n?t.x:t,s=n?t.y:e,a=n?e:i,o={x:r,y:s},l=this.getVertexIndex(r,s);return this.model.insertVertex(l,o,a),l},sendToken:function(t,e,i){var n,r,s;s=le(e)?(n=e.duration,r="reverse"===e.direction,e.connection):(n=e,r=!1,null);var a={dur:(n=n||1e3)+"ms",repeatCount:1,calcMode:"linear",fill:"freeze"};r&&(a.keyPoints="1;0",a.keyTimes="0;1");var o,l,h,c=$(t);if("string"==typeof s)o=this.findBySelector(s,this.el,this.selectors)[0];else{var u=this._V;o=u.connection?u.connection.node:this.el.querySelector("path")}if(!(o instanceof SVGPathElement))throw new Error("dia.LinkView: token animation requires a valid connection path.");c.appendTo(this.paper.cells).animateAlongPath(a,o),setTimeout((l=c,h=i,function(){l.remove(),"function"==typeof h&&h()}),n)},findRoute:function(t){t||(t=[]);var e=Ri,i=this.model.router(),n=this.paper.options.defaultRouter;if(!i){if(!n)return t.map(S);i=n}var r=Vt(i)?i:e[i.name];if(!Vt(r))throw new Error('dia.LinkView: unknown router: "'+i.name+'".');var s=i.args||{};return r.call(this,t,s,this)||t.map(S)},findPath:function(t,e,i){var n=Vi,r=this.model.connector(),s=this.paper.options.defaultConnector;r||(r=s||{});var a=Vt(r)?r:n[r.name];if(!Vt(a))throw new Error('dia.LinkView: unknown connector: "'+r.name+'".');var o=zt(r.args||{});o.raw=!0;var l=a.call(this,e,i,t,o,this);return"string"==typeof l&&(l=new I($.normalizePathData(l))),l},getConnection:function(){var t=this.path;return t?t.clone():null},getSerializedConnection:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("data"))return e.data;var i=t.serialize();return e.data=i},getConnectionSubdivisions:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("segmentSubdivisions"))return e.segmentSubdivisions;var i=t.getSegmentSubdivisions();return e.segmentSubdivisions=i},getConnectionLength:function(){var t=this.path;if(!t)return 0;var e=this.metrics;if(e.hasOwnProperty("length"))return e.length;var i=t.length({segmentSubdivisions:this.getConnectionSubdivisions()});return e.length=i},getPointAtLength:function(t){var e=this.path;return e?e.pointAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getPointAtRatio:function(t){var e=this.path;return e?(pt(t)&&(t=parseFloat(t)/100),e.pointAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()})):null},getTangentAtLength:function(t){var e=this.path;return e?e.tangentAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getTangentAtRatio:function(t){var e=this.path;return e?e.tangentAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPoint:function(t){var e=this.path;return e?e.closestPoint(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointLength:function(t){var e=this.path;return e?e.closestPointLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointRatio:function(t){var e=this.path;return e?e.closestPointNormalizedLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getLabelPosition:function(t,e,i,n){var r,s={},a=0;(r="number"==typeof i?(a=i,n):i)&&(s.args=r);var o,l,h=!(r&&r.absoluteDistance),c=r&&r.absoluteDistance&&r.reverseDistance,u=r&&r.absoluteOffset,d=this.path,f={segmentSubdivisions:this.getConnectionSubdivisions()},p=new S(t,e),m=d.closestPointT(p,f),g=d.lengthAtT(m,f);if(h&&(g=g/this.getConnectionLength()||0),c&&(g=-1*(this.getConnectionLength()-g)||1),s.distance=g,u||(o=d.tangentAtT(m)),o)l=o.pointOffset(p);else{var v=d.pointAtT(m),_=p.difference(v);l={x:_.x,y:_.y}}return s.offset=l,s.angle=a,s},_getLabelTransformationMatrix:function(t){var e,i=0,n={};if("number"==typeof t)e=t;else{if("number"!=typeof t.distance)throw new Error("dia.LinkView: invalid label position distance.");n=t.args||{},e=t.distance,i=t.angle||0}var r=0<e&&e<=1,s=0,a={x:0,y:0};if(t.offset){var o=t.offset;"number"==typeof o&&(s=o),o.x&&(a.x=o.x),o.y&&(a.y=o.y)}var l,h=0!==a.x||0!==a.y||0===s,c=n.keepGradient,u=n.ensureLegibility,d=this.path,f={segmentSubdivisions:this.getConnectionSubdivisions()},p=r?e*this.getConnectionLength():e,m=d.tangentAtLength(p,f),g=i;if(m){if(h)(l=m.start).offset(a);else{var v=m.clone();v.rotate(m.start,-90),v.setLength(s),l=v.end}c&&(g=m.angle()+i,u&&(g=P((g+90)%180-90)))}else l=d.start,h&&l.offset(a);return $.createSVGMatrix().translate(l.x,l.y).rotate(g)},getLabelCoordinates:function(t){var e=this._getLabelTransformationMatrix(t);return new S(e.e,e.f)},getVertexIndex:function(t,e){for(var i=this.model.vertices(),n=this.getClosestPointLength(new S(t,e)),r=0,s=i.length;r<s;r++){var a=i[r];if(n<this.getClosestPointLength(a))break}return r},notifyPointerdown:function(t,e,i){Qe.prototype.pointerdown.call(this,t,e,i),this.notify("link:pointerdown",t,e,i)},notifyPointermove:function(t,e,i){Qe.prototype.pointermove.call(this,t,e,i),this.notify("link:pointermove",t,e,i)},notifyPointerup:function(t,e,i){this.notify("link:pointerup",t,e,i),Qe.prototype.pointerup.call(this,t,e,i)},pointerdblclick:function(t,e,i){Qe.prototype.pointerdblclick.apply(this,arguments),this.notify("link:pointerdblclick",t,e,i)},pointerclick:function(t,e,i){Qe.prototype.pointerclick.apply(this,arguments),this.notify("link:pointerclick",t,e,i)},contextmenu:function(t,e,i){Qe.prototype.contextmenu.apply(this,arguments),this.notify("link:contextmenu",t,e,i)},pointerdown:function(t,e,i){switch(this.notifyPointerdown(t,e,i),t.target.getAttribute("class")){case"marker-vertex":return void this.dragVertexStart(t,e,i);case"marker-vertex-remove":case"marker-vertex-remove-area":return void this.dragVertexRemoveStart(t,e,i);case"marker-arrowhead":return void this.dragArrowheadStart(t,e,i);case"connection":case"connection-wrap":return void this.dragConnectionStart(t,e,i);case"marker-source":case"marker-target":return}this.dragStart(t,e,i)},pointermove:function(t,e,i){var n=this._dragData;switch(n&&this.eventData(t,n),this.eventData(t).action){case"vertex-move":this.dragVertex(t,e,i);break;case"label-move":this.dragLabel(t,e,i);break;case"arrowhead-move":this.dragArrowhead(t,e,i);break;case"move":this.drag(t,e,i)}n&&kt(n,this.eventData(t)),this.notifyPointermove(t,e,i)},pointerup:function(t,e,i){var n=this._dragData;switch(n&&(this.eventData(t,n),this._dragData=null),this.eventData(t).action){case"vertex-move":this.dragVertexEnd(t,e,i);break;case"label-move":this.dragLabelEnd(t,e,i);break;case"arrowhead-move":this.dragArrowheadEnd(t,e,i);break;case"move":this.dragEnd(t,e,i)}this.notifyPointerup(t,e,i),this.checkMouseleave(t)},mouseover:function(t){Qe.prototype.mouseover.apply(this,arguments),this.notify("link:mouseover",t)},mouseout:function(t){Qe.prototype.mouseout.apply(this,arguments),this.notify("link:mouseout",t)},mouseenter:function(t){Qe.prototype.mouseenter.apply(this,arguments),this.notify("link:mouseenter",t)},mouseleave:function(t){Qe.prototype.mouseleave.apply(this,arguments),this.notify("link:mouseleave",t)},mousewheel:function(t,e,i,n){Qe.prototype.mousewheel.apply(this,arguments),this.notify("link:mousewheel",t,e,i,n)},onevent:function(t,e,i,n){if($(t.target).findParentByClass("link-tool",this.el)){if(t.stopPropagation(),this.can("useLinkTools")){if("remove"===e)return void this.model.remove({ui:!0});this.notify(e,t,i,n)}this.notifyPointerdown(t,i,n),this.paper.delegateDragEvents(this,t.data)}else Qe.prototype.onevent.apply(this,arguments)},onlabel:function(t,e,i){this.notifyPointerdown(t,e,i),this.dragLabelStart(t,e,i),this.eventData(t).stopPropagation&&t.stopPropagation()},dragConnectionStart:function(t,e,i){if(this.can("vertexAdd")){var n=this.addVertex({x:e,y:i},{ui:!0});this.eventData(t,{action:"vertex-move",vertexIdx:n})}},dragLabelStart:function(t,e,i){if(this.can("labelMove")){var n=t.currentTarget,r=parseInt(n.getAttribute("label-idx"),10),s=this._getLabelPositionAngle(r),a=this._getLabelPositionArgs(r),o=this._getDefaultLabelPositionArgs(),l=this._mergeLabelPositionArgs(a,o);this.eventData(t,{action:"label-move",labelIdx:r,positionAngle:s,positionArgs:l,stopPropagation:!0})}else this.eventData(t,{stopPropagation:!0});this.paper.delegateDragEvents(this,t.data)},dragVertexStart:function(t,e,i){if(this.can("vertexMove")){var n=t.target,r=parseInt(n.getAttribute("idx"),10);this.eventData(t,{action:"vertex-move",vertexIdx:r})}},dragVertexRemoveStart:function(t,e,i){if(this.can("vertexRemove")){var n=t.target,r=parseInt(n.getAttribute("idx"),10);this.model.removeVertex(r)}},dragArrowheadStart:function(t,e,i){if(this.can("arrowheadMove")){var n=t.target.getAttribute("end"),r=this.startArrowheadMove(n,{ignoreBackwardsCompatibility:!0});this.eventData(t,r)}},dragStart:function(t,e,i){this.can("linkMove")&&this.eventData(t,{action:"move",dx:e,dy:i})},dragLabel:function(t,e,i){var n=this.eventData(t),r={position:this.getLabelPosition(e,i,n.positionAngle,n.positionArgs)};this.model.label(n.labelIdx,r)},dragVertex:function(t,e,i){var n=this.eventData(t);this.model.vertex(n.vertexIdx,{x:e,y:i},{ui:!0})},dragArrowhead:function(t,e,i){this.paper.options.snapLinks?this._snapArrowhead(t,e,i):this._connectArrowhead(this.getEventTarget(t),e,i,this.eventData(t))},drag:function(t,e,i){var n=this.eventData(t);this.model.translate(e-n.dx,i-n.dy,{ui:!0}),this.eventData(t,{dx:e,dy:i})},dragLabelEnd:function(){},dragVertexEnd:function(){},dragArrowheadEnd:function(t,e,i){var n=this.eventData(t),r=this.paper;r.options.snapLinks?this._snapArrowheadEnd(n):this._connectArrowheadEnd(n,e,i),r.linkAllowed(this)?(this._finishEmbedding(n),this._notifyConnectEvent(n,t)):this._disallow(n),this._afterArrowheadMove(n)},dragEnd:function(){},_disallow:function(t){switch(t.whenNotAllowed){case"remove":this.model.remove({ui:!0});break;case"revert":default:this.model.set(t.arrowhead,t.initialEnd,{ui:!0})}},_finishEmbedding:function(t){this.paper.options.embeddingMode&&this.model.reparent()&&(t.z=null)},_notifyConnectEvent:function(t,e){var i=t.arrowhead,n=t.initialEnd,r=this.model.prop(i);if(r&&!Ue.endsEqual(n,r)){var s=this.paper;n.id&&this.notify("link:disconnect",e,s.findViewByModel(n.id),t.initialMagnet,i),r.id&&this.notify("link:connect",e,s.findViewByModel(r.id),t.magnetUnderPointer,i)}},_snapArrowhead:function(t,e,i){var n=this.eventData(t),r=this.paper.options.snapLinks.radius||50,s=this.paper.findViewsInArea({x:e-r,y:i-r,width:2*r,height:2*r}),a=n.closestView||null,o=n.closestMagnet||null;n.closestView=n.closestMagnet=null;var l,h=Number.MAX_VALUE,c=new S(e,i),u=this.paper;s.forEach((function(t){var e=[];"false"!==t.el.getAttribute("magnet")&&e.push({bbox:t.model.getBBox(),magnet:t.el}),t.$("[magnet]").toArray().forEach((function(i){e.push({bbox:t.getNodeBBox(i),magnet:i})})),e.forEach((function(e){var i=e.magnet,r=e.bbox.center().squaredDistance(c);r<h&&(o===t.el||u.options.validateConnection.apply(u,n.validateConnectionArgs(t,t.el===i?null:i)))&&(h=r,n.closestView=t,n.closestMagnet=i)}))}),this);var d=n.closestView,f=n.closestMagnet,p=n.arrowhead,m=o!==f;if(a&&m&&a.unhighlight(o,{connecting:!0,snapping:!0}),d){if(!m)return;d.highlight(f,{connecting:!0,snapping:!0}),l=d.getLinkEnd(f,e,i,this.model,p)}else l={x:e,y:i};this.model.set(p,l||{x:e,y:i},{ui:!0}),a&&this.notify("link:snap:disconnect",t,a,o,p),d&&this.notify("link:snap:connect",t,d,f,p)},_snapArrowheadEnd:function(t){var e=t.closestView,i=t.closestMagnet;e&&i&&(e.unhighlight(i,{connecting:!0,snapping:!0}),t.magnetUnderPointer=e.findMagnet(i)),t.closestView=t.closestMagnet=null},_connectArrowhead:function(t,e,i,n){n.eventTarget!==t&&(n.magnetUnderPointer&&n.viewUnderPointer.unhighlight(n.magnetUnderPointer,{connecting:!0}),n.viewUnderPointer=this.paper.findView(t),n.viewUnderPointer?(n.magnetUnderPointer=n.viewUnderPointer.findMagnet(t),n.magnetUnderPointer&&this.paper.options.validateConnection.apply(this.paper,n.validateConnectionArgs(n.viewUnderPointer,n.magnetUnderPointer))?n.magnetUnderPointer&&n.viewUnderPointer.highlight(n.magnetUnderPointer,{connecting:!0}):n.magnetUnderPointer=null):n.magnetUnderPointer=null),n.eventTarget=t,this.model.set(n.arrowhead,{x:e,y:i},{ui:!0})},_connectArrowheadEnd:function(t,e,i){var n=t.viewUnderPointer,r=t.magnetUnderPointer;if(r&&n){n.unhighlight(r,{connecting:!0});var s=t.arrowhead,a=n.getLinkEnd(r,e,i,this.model,s);this.model.set(s,a,{ui:!0})}},_beforeArrowheadMove:function(t){t.z=this.model.get("z"),this.model.toFront();var e=this.el.style;t.pointerEvents=e.pointerEvents,e.pointerEvents="none",this.paper.options.markAvailable&&this._markAvailableMagnets(t)},_afterArrowheadMove:function(t){null!==t.z&&(this.model.set("z",t.z,{ui:!0}),t.z=null),this.el.style.pointerEvents=t.pointerEvents,this.paper.options.markAvailable&&this._unmarkAvailableMagnets(t)},_createValidateConnectionArgs:function(t){var e,i=[];i[4]=t,i[5]=this;var n=0,r=0;e="source"===t?(n=2,"target"):(r=2,"source");var s=this.model.get(e);if(s.id){var a=i[n]=this.paper.findViewByModel(s.id),o=a.getMagnetFromLinkEnd(s);o===a.el&&(o=void 0),i[n+1]=o}return function(t,e){return i[r]=t,i[r+1]=t.el===e?void 0:e,i}},_markAvailableMagnets:function(t){function e(t,e){var i=t.paper;return i.options.validateConnection.apply(i,this.validateConnectionArgs(t,e))}var i=this.paper,n=i.model.getCells();t.marked={};for(var r=0,s=n.length;r<s;r++){var a=n[r].findView(i);if(a){var o=Array.prototype.slice.call(a.el.querySelectorAll("[magnet]"));"false"!==a.el.getAttribute("magnet")&&o.push(a.el);var l=o.filter(e.bind(t,a));if(0<l.length){for(var h=0,c=l.length;h<c;h++)a.highlight(l[h],{magnetAvailability:!0});a.highlight(null,{elementAvailability:!0}),t.marked[a.model.id]=l}}}},_unmarkAvailableMagnets:function(t){for(var e,i,n=Object.keys(t.marked),r=0,s=n.length;r<s;r++){e=n[r],i=t.marked[e];var a=this.paper.findViewByModel(e);if(a){for(var o=0,l=i.length;o<l;o++)a.unhighlight(i[o],{magnetAvailability:!0});a.unhighlight(null,{elementAvailability:!0})}}t.marked=null},startArrowheadMove:function(t,e){e||(e={});var i={action:"arrowhead-move",arrowhead:t,whenNotAllowed:e.whenNotAllowed||"revert",initialMagnet:this[t+"Magnet"]||(this[t+"View"]?this[t+"View"].el:null),initialEnd:zt(this.model.get(t)),validateConnectionArgs:this._createValidateConnectionArgs(t)};return this._beforeArrowheadMove(i),!0!==e.ignoreBackwardsCompatibility&&(this._dragData=i),i}});Object.defineProperty(Ui.prototype,"sourceBBox",{enumerable:!0,get:function(){var t=this.sourceView;if(!t){var e=this.model.source();return new T(e.x,e.y)}var i=this.sourceMagnet;return t.isNodeConnection(i)?new T(this.sourceAnchor):t.getNodeBBox(i||t.el)}}),Object.defineProperty(Ui.prototype,"targetBBox",{enumerable:!0,get:function(){var t=this.targetView;if(!t){var e=this.model.target();return new T(e.x,e.y)}var i=this.targetMagnet;return t.isNodeConnection(i)?new T(this.targetAnchor):t.getNodeBBox(i||t.el)}});var Gi={stroke:{defaultOptions:{padding:3,rx:0,ry:0,attrs:{"stroke-width":3,stroke:"#FEB663"}},_views:{},getHighlighterId:function(t,e){return t.id+JSON.stringify(e)},removeHighlighter:function(t){this._views[t]&&(this._views[t].remove(),this._views[t]=null)},highlight:function(t,e,i){var n=this.getHighlighterId(e,i);if(!this._views[n]){var r,s=Dt(i||{},this.defaultOptions),a=$(e);try{var o=a.convertToPathData()}catch(t){r=a.bbox(!0),o=$.rectToPath(kt({},s,r))}var l=$("path").attr({d:o,"pointer-events":"none","vector-effect":"non-scaling-stroke",fill:"none"}).attr(s.attrs);if(t.isNodeConnection(e))l.attr("d",t.getSerializedConnection());else{var h=a.getTransformToElement(t.el),c=s.padding;if(c){r||(r=a.bbox(!0));var u=r.x+r.width/2,d=r.y+r.height/2;r=$.transformRect(r,h);var f=Math.max(r.width,1),p=Math.max(r.height,1),m=(f+c)/f,g=(p+c)/p,v=$.createSVGMatrix({a:m,b:0,c:0,d:g,e:u-m*u,f:d-g*d});h=h.multiply(v)}l.transform(h)}var _=this._views[n]=new Ke({svgElement:!0,className:"highlight-stroke",el:l.node}),y=this.removeHighlighter.bind(this,n),b=t.model;_.listenTo(b,"remove",y),_.listenTo(b.graph,"reset",y),t.vel.append(l)}},unhighlight:function(t,e,i){this.removeHighlighter(this.getHighlighterId(e,i))}},opacity:{highlight:function(t,e){$(e).addClass(et("highlight-opacity"))},unhighlight:function(t,e){$(e).removeClass(et("highlight-opacity"))}},addClass:{className:et("highlighted"),highlight:function(t,e,i){var n=(i||{}).className||this.className;$(e).addClass(n)},unhighlight:function(t,e,i){var n=(i||{}).className||this.className;$(e).removeClass(n)}}};function Wi(t){return function(e,i,n,r){if(n instanceof Element){var s,a=this.paper.findView(n);return s=a?a.isNodeConnection(n)?Hi(a,"fixedAt"in r?r.fixedAt:"50%"):a.getNodeBBox(n).center():new S,t.call(this,e,i,s,r)}return t.apply(this,arguments)}}function Hi(t,e){var i=parseFloat(e);return pt(e)?t.getPointAtRatio(i/100):t.getPointAtLength(i)}var Xi=Wi((function(t,e,i,n){var r=t.getConnection(),s=t.getConnectionSubdivisions(),a=new C(i.clone().offset(0,1e6),i.clone().offset(0,-1e6)),o=new C(i.clone().offset(1e6,0),i.clone().offset(-1e6,0)),l=a.intersect(r,{segmentSubdivisions:s}),h=o.intersect(r,{segmentSubdivisions:s}),c=[];return l&&Array.prototype.push.apply(c,l),h&&Array.prototype.push.apply(c,h),0<c.length?i.chooseClosest(c):"fallbackAt"in n?Hi(t,n.fallbackAt):Zi(t,e,i,n)})),Zi=Wi((function(t,e,i,n){return t.getClosestPoint(i)||new S})),Yi={resolveRef:Wi,connectionRatio:function(t,e,i,n){var r="ratio"in n?n.ratio:.5;return t.getPointAtRatio(r)},connectionLength:function(t,e,i,n){var r="length"in n?n.length:20;return t.getPointAtLength(r)},connectionPerpendicular:Xi,connectionClosest:Zi};function qi(t,e,i){if(Ut(i)){var n=i.x,r=i.y;if(isFinite(r)){var s=new C(e,t).parallel(r);e=s.start,t=s.end}i=n}if(!isFinite(i))return t;var a=t.distance(e);return 0===i&&0<a?t:t.move(e,-Math.min(i,a-1))}function Ki(t){var e=t.getAttribute("stroke-width");return null===e?0:parseFloat(e)||0}function Ji(t,e,i,n){var r=e.getNodeBBox(i);n.stroke&&r.inflate(Ki(i)/2);var s=t.intersect(r);return qi(s?t.start.chooseClosest(s):t.end,t.start,n.offset)}var Qi="segmentSubdivisons",$i="shapeBBox",tn={anchor:function(t,e,i,n){var r=n.offset,s=n.alignOffset,a=n.align;return a&&function(t,e,i){var n,r,s,a;void 0===i&&(i=0);var o=t.start,l=t.end;switch(e){case"left":n="x",r=l,s=o,a=-1;break;case"right":n="x",r=o,s=l,a=1;break;case"top":n="y",r=l,s=o,a=-1;break;case"bottom":n="y",r=o,s=l,a=1;break;default:return}o[n]<l[n]?r[n]=s[n]:s[n]=r[n],isFinite(i)&&(r[n]+=a*i,s[n]+=a*i)}(t,a,s),qi(t.end,t.start,r)},bbox:Ji,rectangle:function(t,e,i,n){var r=e.model.angle();if(0===r)return Ji(t,e,i,n);var s=e.getNodeUnrotatedBBox(i);n.stroke&&s.inflate(Ki(i)/2);var a=s.center(),o=t.clone().rotate(a,r),l=o.setLength(1e6).intersect(s);return qi(l?o.start.chooseClosest(l).rotate(a,-r):t.end,t.start,n.offset)},boundary:function(t,e,i,n){var r,s,a=n.selector,o=t.end;if(r="string"==typeof a?e.findBySelector(a)[0]:Array.isArray(a)?st(i,a):function(t){if(!t)return null;var e=t;do{var i=e.tagName;if("string"!=typeof i)return null;if("G"===(i=i.toUpperCase()))e=e.firstElementChild;else{if("TITLE"!==i)break;e=e.nextElementSibling}}while(e);return e}(i),!$.isSVGGraphicsElement(r)){if(r===i||!$.isSVGGraphicsElement(i))return o;r=i}var l,h=e.getNodeShape(r),c=e.getNodeMatrix(r),u=e.getRootTranslateMatrix(),d=e.getRootRotateMatrix(),f=u.multiply(d).multiply(c),p=f.inverse(),m=$.transformLine(t,p),g=m.start.clone(),v=e.getNodeData(r);if(!1===n.insideout&&(v[$i]||(v[$i]=h.bbox()),v[$i].containsPoint(g)))return o;if(h instanceof I){var _=n.precision||2;v[Qi]||(v[Qi]=h.getSegmentSubdivisions({precision:_})),l={precision:_,segmentSubdivisions:v[Qi]}}!0===n.extrapolate&&m.setLength(1e6),(s=m.intersect(h,l))?$.isArray(s)&&(s=g.chooseClosest(s)):!0===n.sticky&&(s=h instanceof T?h.pointNearestToPoint(g):h instanceof A?h.intersectionWithLineFromCenterToPoint(g):h.closestPoint(g,l));var y=s?$.transformPoint(s,f):o,b=n.offset||0;return n.stroke&&(b+=Ki(r)/2),qi(y,t.start,b)}};function en(t){return function(e,i,n,r){var s=!!r.rotate,a=s?e.getNodeUnrotatedBBox(i):e.getNodeBBox(i),o=a[t](),l=r.dx;if(l){var h=pt(l);l=parseFloat(l),isFinite(l)&&(h&&(l/=100,l*=a.width),o.x+=l)}var c=r.dy;if(c){var u=pt(c);c=parseFloat(c),isFinite(c)&&(u&&(c/=100,c*=a.height),o.y+=c)}return s?o.rotate(e.model.getBBox().center(),-e.model.angle()):o}}var nn={center:en("center"),top:en("topMiddle"),bottom:en("bottomMiddle"),left:en("leftMiddle"),right:en("rightMiddle"),topLeft:en("origin"),topRight:en("topRight"),bottomLeft:en("bottomLeft"),bottomRight:en("corner"),perpendicular:Wi((function(t,e,i,n){var r=t.model.angle(),s=t.getNodeBBox(e),a=s.center(),o=s.origin(),l=s.corner(),h=n.padding;if(isFinite(h)||(h=0),o.y+h<=i.y&&i.y<=l.y-h){var c=i.y-a.y;a.x+=0===r||180===r?0:1*c/Math.tan(D(r)),a.y+=c}else if(o.x+h<=i.x&&i.x<=l.x-h){var u=i.x-a.x;a.y+=90===r||270===r?0:u*Math.tan(D(r)),a.x+=u}return a})),midSide:Wi((function(t,e,i,n){var r,s,a,o=!!n.rotate;o?(r=t.getNodeUnrotatedBBox(e),a=t.model.getBBox().center(),s=t.model.angle()):r=t.getNodeBBox(e);var l,h=n.padding;switch(isFinite(h)&&r.inflate(h),o&&i.rotate(a,s),r.sideNearestToPoint(i)){case"left":l=r.leftMiddle();break;case"right":l=r.rightMiddle();break;case"top":l=r.topMiddle();break;case"bottom":l=r.bottomMiddle()}return o?l.rotate(a,-s):l})),modelCenter:function(t,e,i,n,r){return t.model.getPointFromConnectedLink(this.model,r).offset(n.dx,n.dy)}},rn={NONE:"sorting-none",APPROX:"sorting-approximate",EXACT:"sorting-exact"},sn=9007199254740991,an={default:{name:"stroke",options:{padding:3}},magnetAvailability:{name:"addClass",options:{className:"available-magnet"}},elementAvailability:{name:"addClass",options:{className:"available-cell"}}},on=Ke.extend({className:"paper",options:{width:800,height:600,origin:{x:0,y:0},gridSize:1,drawGrid:!1,background:!1,perpendicularLinks:!1,elementView:$e,linkView:Ui,snapLinks:!1,multiLinks:!0,guard:function(t,e){return!1},highlighting:an,preventContextMenu:!0,preventDefaultBlankAction:!0,restrictTranslate:!1,markAvailable:!1,defaultLink:new Ue,defaultConnector:{name:"normal"},defaultRouter:{name:"normal"},defaultAnchor:{name:"center"},defaultLinkAnchor:{name:"connectionRatio"},defaultConnectionPoint:{name:"bbox"},connectionStrategy:null,validateMagnet:function(t,e,i){return"passive"!==e.getAttribute("magnet")},validateConnection:function(t,e,i,n,r,s){return("target"===r?i:t)instanceof $e},embeddingMode:!1,validateEmbedding:function(t,e){return!0},findParentBy:"bbox",frontParentOnly:!0,interactive:{labelMove:!1},linkPinning:!0,allowLink:null,clickThreshold:0,moveThreshold:0,magnetThreshold:0,sorting:rn.EXACT,frozen:!1,onViewUpdate:function(t,e,i,n,r){e&t.FLAG_INSERT||n.mounting||r.requestConnectedLinksUpdate(t,i,n)},onViewPostponed:function(t,e,i){return i.forcePostponedViewUpdate(t,e)},beforeRender:null,afterRender:null,viewport:null,cellViewNamespace:null,highlighterNamespace:Gi,anchorNamespace:nn,linkAnchorNamespace:Yi,connectionPointNamespace:tn},events:{dblclick:"pointerdblclick",contextmenu:"contextmenu",mousedown:"pointerdown",touchstart:"pointerdown",mouseover:"mouseover",mouseout:"mouseout",mouseenter:"mouseenter",mouseleave:"mouseleave",mousewheel:"mousewheel",DOMMouseScroll:"mousewheel","mouseenter .joint-cell":"mouseenter","mouseleave .joint-cell":"mouseleave","mouseenter .joint-tools":"mouseenter","mouseleave .joint-tools":"mouseleave","mousedown .joint-cell [event]":"onevent","touchstart .joint-cell [event]":"onevent","mousedown .joint-cell [magnet]":"onmagnet","touchstart .joint-cell [magnet]":"onmagnet","dblclick .joint-cell [magnet]":"magnetpointerdblclick","contextmenu .joint-cell [magnet]":"magnetcontextmenu","mousedown .joint-link .label":"onlabel","touchstart .joint-link .label":"onlabel","dragstart .joint-cell image":"onImageDragStart"},documentEvents:{mousemove:"pointermove",touchmove:"pointermove",mouseup:"pointerup",touchend:"pointerup",touchcancel:"pointerup"},svg:null,viewport:null,defs:null,tools:null,$background:null,layers:null,$grid:null,$document:null,_highlights:null,_zPivots:null,_viewportMatrix:null,_viewportTransformString:null,_updates:null,SORT_DELAYING_BATCHES:["add","to-front","to-back"],UPDATE_DELAYING_BATCHES:["translate"],MIN_SCALE:1e-6,init:function(){var t=this.options,e=this.el;t.cellViewNamespace||(t.cellViewNamespace="undefined"!=typeof joint&&Qt(joint,"shapes")?joint.shapes:null);var i=this.model=t.model||new Ye;this.setGrid(t.drawGrid),this.cloneOptions(),this.render(),this.setDimensions(),this.startListening(),this._views={},this._zPivots={},this.$document=n(e.ownerDocument),this._highlights={},this.resetViews(i.attributes.cells.models),!this.isFrozen()&&this.isAsync()&&this.updateViewsAsync()},_resetUpdates:function(){return this._updates={id:null,priorities:[{},{},{}],unmountedCids:[],mountedCids:[],unmounted:{},mounted:{},count:0,keyFrozen:!1,freezeKey:null,sort:!1}},startListening:function(){var t=this.model;this.listenTo(t,"add",this.onCellAdded).listenTo(t,"remove",this.onCellRemoved).listenTo(t,"change",this.onCellChange).listenTo(t,"reset",this.onGraphReset).listenTo(t,"sort",this.onGraphSort).listenTo(t,"batch:stop",this.onGraphBatchStop),this.on("cell:highlight",this.onCellHighlight).on("cell:unhighlight",this.onCellUnhighlight).on("scale translate",this.update)},onCellAdded:function(t,e,i){var n=i.position;this.isAsync()||!he(n)?this.renderView(t,i):(i.maxPosition===n&&this.freeze({key:"addCells"}),this.renderView(t,i),0===n&&this.unfreeze({key:"addCells"}))},onCellRemoved:function(t,e,i){var n=this.findViewByModel(t);n&&this.requestViewUpdate(n,n.FLAG_REMOVE,n.UPDATE_PRIORITY,i)},onCellChange:function(t,e){if(t!==this.model.attributes.cells&&t.hasChanged("z")&&this.options.sorting===rn.APPROX){var i=this.findViewByModel(t);i&&this.requestViewUpdate(i,i.FLAG_INSERT,i.UPDATE_PRIORITY,e)}},onGraphReset:function(t,e){this.removeZPivots(),this.resetViews(t.models,e)},onGraphSort:function(){this.model.hasActiveBatch(this.SORT_DELAYING_BATCHES)||this.sortViews()},onGraphBatchStop:function(t){if(!this.isFrozen()){var e=t&&t.batchName,i=this.model;if(!this.isAsync()){var n=this.UPDATE_DELAYING_BATCHES;n.includes(e)&&!i.hasActiveBatch(n)&&this.updateViews(t)}var r=this.SORT_DELAYING_BATCHES;r.includes(e)&&!i.hasActiveBatch(r)&&this.sortViews()}},cloneOptions:function(){var t=this.options,e=t.defaultConnector,i=t.defaultRouter,n=t.defaultConnectionPoint,r=t.defaultAnchor,s=t.defaultLinkAnchor,a=t.origin,o=t.highlighting,l=t.cellViewNamespace,h=t.interactive;!l&&"undefined"!=typeof joint&&Qt(joint,"shapes")&&(t.cellViewNamespace=joint.shapes),Vt(e)||(t.defaultConnector=Bt(e)),Vt(i)||(t.defaultRouter=Bt(i)),Vt(n)||(t.defaultConnectionPoint=Bt(n)),Vt(r)||(t.defaultAnchor=Bt(r)),Vt(s)||(t.defaultLinkAnchor=Bt(s)),Ut(h)&&(t.interactive=kt({},h)),t.origin=kt({},a),t.highlighting=Ot({},o,an)},children:function(){var t=$.namespace;return[{namespaceURI:t.xhtml,tagName:"div",className:et("paper-background"),selector:"background"},{namespaceURI:t.xhtml,tagName:"div",className:et("paper-grid"),selector:"grid"},{namespaceURI:t.svg,tagName:"svg",attributes:{width:"100%",height:"100%","xmlns:xlink":t.xlink},selector:"svg",children:[{tagName:"defs",selector:"defs"},{tagName:"g",className:et("layers"),selector:"layers",children:[{tagName:"g",className:et("cells-layer viewport"),selector:"cells"},{tagName:"g",className:et("tools-layer"),selector:"tools"}]}]}]},render:function(){this.renderChildren();var t=this.childNodes,e=this.options,i=t.svg,r=t.cells,s=t.defs,a=t.tools,o=t.layers,l=t.background,h=t.grid;return this.svg=i,this.defs=s,this.tools=a,this.cells=r,this.layers=o,this.$background=n(l),this.$grid=n(h),$.ensureId(i),this.viewport=r,e.background&&this.drawBackground(e.background),e.drawGrid&&this.drawGrid(),this},update:function(){return this.options.drawGrid&&this.drawGrid(),this._background&&this.updateBackgroundImage(this._background),this},matrix:function(t){var e=this.layers;if(void 0===t){var i=e.getAttribute("transform");return(this._viewportTransformString||null)===i?t=this._viewportMatrix:(t=e.getCTM(),this._viewportMatrix=t,this._viewportTransformString=i),$.createSVGMatrix(t)}t=$.createSVGMatrix(t);var n=$.matrixToTransformString(t);return e.setAttribute("transform",n),this._viewportMatrix=t,this._viewportTransformString=e.getAttribute("transform"),this},clientMatrix:function(){return $.createSVGMatrix(this.cells.getScreenCTM())},requestConnectedLinksUpdate:function(t,e,i){if(t instanceof Qe)for(var n=t.model,r=this.model.getConnectedLinks(n),s=0,a=r.length;s<a;s++){var o=r[s],l=this.findViewByModel(o);if(l){var h=["UPDATE"];o.getTargetCell()===n&&h.push("TARGET"),o.getSourceCell()===n&&h.push("SOURCE");var c=Math.max(e+1,l.UPDATE_PRIORITY);this.scheduleViewUpdate(l,l.getFlag(h),c,i)}}},forcePostponedViewUpdate:function(t,e){if(!(t&&t instanceof Qe))return!1;var i=t.model;if(i.isElement())return!1;if(0==(e&t.getFlag(["SOURCE","TARGET"]))){var n=0,r=this.findViewByModel(i.getSourceCell());r&&!this.isViewMounted(r)&&(n=this.dumpView(r),t.updateEndMagnet("source"));var s=0,a=this.findViewByModel(i.getTargetCell());if(a&&!this.isViewMounted(a)&&(s=this.dumpView(a),t.updateEndMagnet("target")),0===n&&0===s)return!this.dumpView(t)}return!1},requestViewUpdate:function(t,e,i,n){n||(n={}),this.scheduleViewUpdate(t,e,i,n);var r=this.isAsync();if(!(this.isFrozen()||r&&!1!==n.async||this.model.hasActiveBatch(this.UPDATE_DELAYING_BATCHES))){var s=this.updateViews(n);r&&this.notifyAfterRender(s,n)}},scheduleViewUpdate:function(t,e,i,n){var r=this._updates,s=this.options,a=t.FLAG_REMOVE,o=t.FLAG_INSERT,l=t.UPDATE_PRIORITY,h=t.cid,c=r.priorities[i];if(c||(c=r.priorities[i]={}),l<i)for(var u=i-1;l<=u;u--){var d=r.priorities[u];d&&h in d&&(c[h]|=d[h],delete d[h])}var f=c[h]||0;if((f&e)!==e){f||r.count++,e&a&&f&o?c[h]^=o:e&o&&f&a&&(c[h]^=a),c[h]|=e;var p=s.onViewUpdate;"function"==typeof p&&p.call(this,t,e,i,n||{},this)}},dumpViewUpdate:function(t){if(!t)return 0;var e=this._updates,i=t.cid,n=e.priorities[t.UPDATE_PRIORITY],r=this.registerMountedView(t)|n[i];return delete n[i],r},dumpView:function(t,e){var i=this.dumpViewUpdate(t);return i?this.updateView(t,i,e):0},updateView:function(t,e,i){if(!t)return 0;var n=t.FLAG_REMOVE,r=t.FLAG_INSERT,s=t.model;if(t instanceof Qe){if(e&n)return this.removeView(s),0;e&r&&(this.insertView(t),e^=r)}return e?t.confirmUpdate(e,i||{}):0},requireView:function(t,e){var i=this.findViewByModel(t);return i?(this.dumpView(i,e),i):null},registerUnmountedView:function(t){var e=t.cid,i=this._updates;if(e in i.unmounted)return 0;var n=i.unmounted[e]|=t.FLAG_INSERT;return i.unmountedCids.push(e),delete i.mounted[e],n},registerMountedView:function(t){var e=t.cid,i=this._updates;if(e in i.mounted)return 0;i.mounted[e]=!0,i.mountedCids.push(e);var n=i.unmounted[e]||0;return delete i.unmounted[e],n},isViewMounted:function(t){return!!t&&t.cid in this._updates.mounted},dumpViews:function(t){var e=Dt({},t,{viewport:null});this.checkViewport(e),this.updateViews(e)},updateViews:function(t){var e;this.notifyBeforeRender(t);for(var i=0,n=0,r=sn;n++,i+=(e=this.updateViewsBatch(t)).updated,r=Math.min(e.priority,r),!e.empty;);var s={updated:i,batches:n,priority:r};return this.notifyAfterRender(s,t),s},hasScheduledUpdates:function(){for(var t=this._updates.priorities,e=Object.keys(t),i=e.length;0<i&&i--;)for(var n in t[e[i]])return!0;return!1},updateViewsAsync:function(t,e){t||(t={}),e||(e={processed:0,priority:sn});var i=this._updates,n=i.id;if(n){ft(n),0===e.processed&&this.hasScheduledUpdates()&&this.notifyBeforeRender(t);var r=this.updateViewsBatch(t),s=Dt({},t,{mountBatchSize:1e3-r.mounted,unmountBatchSize:1e3-r.unmounted}),a=this.checkViewport(s),o=a.unmounted,l=a.mounted,h=e.processed,c=i.count;0<r.updated&&(h+=r.updated+r.unmounted,r.processed=h,e.priority=Math.min(r.priority,e.priority),r.empty&&0===l?(r.unmounted+=o,r.mounted+=l,r.priority=e.priority,this.notifyAfterRender(r,t),e.processed=0,i.count=0):e.processed=h);var u=t.progress;if(c&&"function"==typeof u&&u.call(this,r.empty,h,c,r,this),i.id!==n)return}i.id=dt(this.updateViewsAsync,this,t,e)},notifyBeforeRender:function(t){void 0===t&&(t={});var e=t.beforeRender;"function"!=typeof e&&"function"!=typeof(e=this.options.beforeRender)||e.call(this,t,this)},notifyAfterRender:function(t,e){void 0===e&&(e={});var i=e.afterRender;"function"!=typeof i&&(i=this.options.afterRender),"function"==typeof i&&i.call(this,t,e,this),this.trigger("render:done",t,e)},updateViewsBatch:function(t){t||(t={});var e=t.batchSize||1/0,i=this._updates,n=0,r=0,s=0,a=0,o=sn,l=!0,h=this.options,c=i.priorities,u="viewport"in t?t.viewport:h.viewport;"function"!=typeof u&&(u=null);var d=h.onViewPostponed;"function"!=typeof d&&(d=null);var f=Object.keys(c);t:for(var p=0,m=f.length;p<m;p++){var g=f[p],v=c[g];for(var _ in v){if(e<=n){l=!1;break t}var y=qe[_];if(y){var b=v[_];if(0==(b&y.FLAG_REMOVE)){var x=_ in i.unmounted;if(y.DETACHABLE&&u&&!u.call(this,y,!x,this)){x||(this.registerUnmountedView(y),y.unmount()),i.unmounted[_]|=b,delete v[_],s++;continue}x&&(b|=y.FLAG_INSERT,a++),b|=this.registerMountedView(y)}var w=this.updateView(y,b,t);0<w&&(v[_]=w,!d||!d.call(this,y,w,this)||v[_])?(r++,l=!1):(g<o&&(o=g),n++,delete v[_])}else delete v[_]}}return{priority:o,updated:n,postponed:r,unmounted:s,mounted:a,empty:l}},getUnmountedViews:function(){for(var t=this._updates,e=Object.keys(t.unmounted),i=e.length,n=new Array(i),r=0;r<i;r++)n[r]=qe[e[r]];return n},getMountedViews:function(){for(var t=this._updates,e=Object.keys(t.mounted),i=e.length,n=new Array(i),r=0;r<i;r++)n[r]=qe[e[r]];return n},checkUnmountedViews:function(t,e){e||(e={});var i=0;"function"!=typeof t&&(t=null);for(var n=("mountBatchSize"in e?e.mountBatchSize:1/0),r=this._updates,s=r.unmountedCids,a=r.unmounted,o=0,l=Math.min(s.length,n);o<l;o++){var h=s[o];if(h in a){var c=qe[h];if(c)if(c.DETACHABLE&&t&&!t.call(this,c,!1,this))s.push(h);else{i++;var u=this.registerMountedView(c);u&&this.scheduleViewUpdate(c,u,c.UPDATE_PRIORITY,{mounting:!0})}}}return s.splice(0,o),i},checkMountedViews:function(t,e){e||(e={});var i=0;if("function"!=typeof t)return i;for(var n=("unmountBatchSize"in e?e.unmountBatchSize:1/0),r=this._updates,s=r.mountedCids,a=r.mounted,o=0,l=Math.min(s.length,n);o<l;o++){var h=s[o];if(h in a){var c=qe[h];c&&(c.DETACHABLE&&!t.call(this,c,!0,this)?(i++,this.registerUnmountedView(c)&&c.unmount()):s.push(h))}}return s.splice(0,o),i},checkViewport:function(t){var e=Dt({},t,{mountBatchSize:1/0,unmountBatchSize:1/0}),i="viewport"in e?e.viewport:this.options.viewport,n=this.checkMountedViews(i,e);if(0<n){var r=this._updates.unmountedCids;e.mountBatchSize=Math.min(r.length-n,e.mountBatchSize)}return{mounted:this.checkUnmountedViews(i,e),unmounted:n}},freeze:function(t){t||(t={});var e=this._updates,i=t.key,n=this.options.frozen,r=e.freezeKey;if(i&&i!==r){if(n&&r)return;e.freezeKey=i,e.keyFrozen=n}this.options.frozen=!0;var s=e.id;e.id=null,this.isAsync()&&s&&ft(s)},unfreeze:function(t){t||(t={});var e=this._updates,i=t.key,n=e.freezeKey;i&&n&&i!==n||(e.freezeKey=null,i&&i===n&&e.keyFrozen||(this.isAsync()?(this.freeze(),this.updateViewsAsync(t)):this.updateViews(t),this.options.frozen=e.keyFrozen=!1,e.sort&&(this.sortViews(),e.sort=!1)))},isAsync:function(){return!!this.options.async},isFrozen:function(){return!!this.options.frozen},isExactSorting:function(){return this.options.sorting===rn.EXACT},onRemove:function(){this.freeze(),this.removeViews()},getComputedSize:function(){var t=this.options,e=t.width,i=t.height;return he(e)||(e=this.el.clientWidth),he(i)||(i=this.el.clientHeight),{width:e,height:i}},setDimensions:function(t,e){var i=this.options,n=void 0===t?i.width:t,r=void 0===e?i.height:e;this.options.width=n,this.options.height=r,he(n)&&(n=Math.round(n)),he(r)&&(r=Math.round(r)),this.$el.css({width:null===n?"":n,height:null===r?"":r});var s=this.getComputedSize();this.trigger("resize",s.width,s.height)},setOrigin:function(t,e){return this.translate(t||0,e||0,{absolute:!0})},fitToContent:function(t,e,i,n){i=le(t)?(t=(n=t).gridWidth||1,e=n.gridHeight||1,n.padding||0):(n||(n={}),t=t||1,e=e||1,i||0),i=xt(i);var r="contentArea"in n?new T(n.contentArea):this.getContentArea(n),s=this.scale(),a=this.translate(),o=s.sx,l=s.sy;r.x*=o,r.y*=l,r.width*=o,r.height*=l;var h=Math.max(Math.ceil((r.width+r.x)/t),1)*t,c=Math.max(Math.ceil((r.height+r.y)/e),1)*e,u=0,d=0;("negative"==n.allowNewOrigin&&r.x<0||"positive"==n.allowNewOrigin&&0<=r.x||"any"==n.allowNewOrigin)&&(u=Math.ceil(-r.x/t)*t,h+=u+=i.left),("negative"==n.allowNewOrigin&&r.y<0||"positive"==n.allowNewOrigin&&0<=r.y||"any"==n.allowNewOrigin)&&(d=Math.ceil(-r.y/e)*e,c+=d+=i.top),h+=i.right,c+=i.bottom,h=Math.max(h,n.minWidth||0),c=Math.max(c,n.minHeight||0),h=Math.min(h,n.maxWidth||Number.MAX_VALUE),c=Math.min(c,n.maxHeight||Number.MAX_VALUE);var f=this.getComputedSize(),p=h!=f.width||c!=f.height;return(u!=a.tx||d!=a.ty)&&this.translate(u,d),p&&this.setDimensions(h,c),new T(-u/o,-d/l,h/o,c/l)},scaleContentToFit:function(t){var e,i;if(t||(t={}),"contentArea"in t){var n=t.contentArea;e=this.localToPaperRect(n),i=new S(n)}else e=this.getContentBBox(t),i=this.paperToLocalPoint(e);if(e.width&&e.height){Dt(t,{padding:0,preserveAspectRatio:!0,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE});var r,s=xt(t.padding),a=t.minScaleX||t.minScale,o=t.maxScaleX||t.maxScale,l=t.minScaleY||t.minScale,h=t.maxScaleY||t.maxScale;if(t.fittingBBox)r=t.fittingBBox;else{var c=this.translate(),u=this.getComputedSize();r={x:c.tx,y:c.ty,width:u.width,height:u.height}}r=new T(r).moveAndExpand({x:s.left,y:s.top,width:-s.left-s.right,height:-s.top-s.bottom});var d=this.scale(),f=r.width/e.width*d.sx,p=r.height/e.height*d.sy;if(t.preserveAspectRatio&&(f=p=Math.min(f,p)),t.scaleGrid){var m=t.scaleGrid;f=m*Math.floor(f/m),p=m*Math.floor(p/m)}f=Math.min(o,Math.max(a,f)),p=Math.min(h,Math.max(l,p));var g=this.options.origin,v=r.x-i.x*f-g.x,_=r.y-i.y*p-g.y;this.scale(f,p),this.translate(v,_)}},getContentArea:function(t){return t&&t.useModelGeometry?this.model.getBBox()||new T:$(this.cells).getBBox()},getContentBBox:function(t){return this.localToPaperRect(this.getContentArea(t))},getArea:function(){return this.paperToLocalRect(this.getComputedSize())},getRestrictedArea:function(){return Vt(this.options.restrictTranslate)?this.options.restrictTranslate.apply(this,arguments):!0===this.options.restrictTranslate?this.getArea():this.options.restrictTranslate||null},createViewForModel:function(t){var i,n,r=this.options.cellViewNamespace,s=t.get("type")+"View",a=st(r,s,".");return n=t.isLink()?(i=this.options.linkView,Ui):(i=this.options.elementView,$e),new(i.prototype instanceof e.View?a||i:i.call(this,t)||a||n)({model:t,interactive:this.options.interactive})},removeView:function(t){var e=t.id,i=this._views,n=this._updates,r=i[e];if(r){var s=r.cid,a=n.mounted,o=n.unmounted;r.remove(),delete i[e],delete a[s],delete o[s]}return r},renderView:function(t,e){var i,n,r=t.id,s=this._views;return n=r in s?(i=s[r]).FLAG_INSERT:((i=s[t.id]=this.createViewForModel(t)).paper=this).registerUnmountedView(i)|i.getFlag(i.initFlag),this.requestViewUpdate(i,n,i.UPDATE_PRIORITY,e),i},onImageDragStart:function(){return!1},resetViews:function(t,e){e||(e={}),t||(t=[]),this._resetUpdates(),this.removeViews(),this.freeze({key:"reset"});for(var i=0,n=t.length;i<n;i++)this.renderView(t[i],e);this.unfreeze({key:"reset"}),this.sortViews()},removeViews:function(){Rt(this._views,"remove"),this._views={}},sortViews:function(){this.isExactSorting()&&(this.isFrozen()?this._updates.sort=!0:this.sortViewsExact())},sortViewsExact:function(){var t=n(this.cells).children("[model-id]"),e=this.model.get("cells");bt(t,(function(t,i){var n=e.get(t.getAttribute("model-id")),r=e.get(i.getAttribute("model-id")),s=n.attributes.z||0,a=r.attributes.z||0;return s===a?0:s<a?-1:1}))},insertView:function(t){var e=this.cells;switch(this.options.sorting){case rn.APPROX:var i=t.model.get("z"),n=this.addZPivot(i);e.insertBefore(t.el,n);break;case rn.EXACT:default:e.appendChild(t.el)}},addZPivot:function(t){(t=+t)||(t=0);var e=this._zPivots,i=e[t];if(i)return i;i=e[t]=document.createComment("z-index:"+(t+1));var n=-1/0;for(var r in e)(r=+r)<t&&n<r&&(n=r);var s=this.cells;if(n!==-1/0){var a=e[n];s.insertBefore(i,a.nextSibling)}else s.insertBefore(i,s.firstChild);return i},removeZPivots:function(){var t=this._zPivots,e=this.viewport;for(var i in t)e.removeChild(t[i]);this._zPivots={}},scale:function(t,e,i,n){if(void 0===t)return $.matrixToScale(this.matrix());void 0===e&&(e=t),void 0===i&&(n=i=0);var r=this.translate();if(i||n||r.tx||r.ty){var s=r.tx-i*(t-1),a=r.ty-n*(e-1);this.translate(s,a)}t=Math.max(t||0,this.MIN_SCALE),e=Math.max(e||0,this.MIN_SCALE);var o=this.matrix();return o.a=t,o.d=e,this.matrix(o),this.trigger("scale",t,e,i,n),this},rotate:function(t,e,i){if(void 0===t)return $.matrixToRotate(this.matrix());if(void 0===e){var n=this.cells.getBBox();e=n.width/2,i=n.height/2}var r=this.matrix().translate(e,i).rotate(t).translate(-e,-i);return this.matrix(r),this},translate:function(t,e){if(void 0===t)return $.matrixToTranslate(this.matrix());var i=this.matrix();i.e=t||0,i.f=e||0,this.matrix(i);var n=this.translate(),r=this.options.origin;return r.x=n.tx,r.y=n.ty,this.trigger("translate",n.tx,n.ty),this.options.drawGrid&&this.drawGrid(),this},findView:function(t){var e=ce(t)?this.cells.querySelector(t):t instanceof n?t[0]:t,i=this.findAttribute("model-id",e);if(i)return this._views[i]},findViewByModel:function(t){var e=ce(t)||he(t)?t:t&&t.id;return this._views[e]},findViewsFromPoint:function(t){return t=new S(t),this.model.getElements().map(this.findViewByModel,this).filter((function(e){return e&&e.vel.getBBox({target:this.cells}).containsPoint(t)}),this)},findViewsInArea:function(t,e){e=Dt(e||{},{strict:!1}),t=new T(t);var i=this.model.getElements().map(this.findViewByModel,this),n=e.strict?"containsRect":"intersect";return i.filter((function(e){return e&&t[n](e.vel.getBBox({target:this.cells}))}),this)},removeTools:function(){return this.dispatchToolsEvent("remove"),this},hideTools:function(){return this.dispatchToolsEvent("hide"),this},showTools:function(){return this.dispatchToolsEvent("show"),this},dispatchToolsEvent:function(t){for(var e,i=[],n=arguments.length-1;0<n--;)i[n]=arguments[n+1];"string"==typeof t&&(e=this).trigger.apply(e,["tools:event",t].concat(i))},getModelById:function(t){return this.model.getCell(t)},snapToGrid:function(t,e){return this.clientToLocalPoint(t,e).snapToGrid(this.options.gridSize)},localToPaperPoint:function(t,e){var i=new S(t,e);return $.transformPoint(i,this.matrix())},localToPaperRect:function(t,e,i,n){var r=new T(t,e,i,n);return $.transformRect(r,this.matrix())},paperToLocalPoint:function(t,e){var i=new S(t,e);return $.transformPoint(i,this.matrix().inverse())},paperToLocalRect:function(t,e,i,n){var r=new T(t,e,i,n);return $.transformRect(r,this.matrix().inverse())},localToClientPoint:function(t,e){var i=new S(t,e);return $.transformPoint(i,this.clientMatrix())},localToClientRect:function(t,e,i,n){var r=new T(t,e,i,n);return $.transformRect(r,this.clientMatrix())},clientToLocalPoint:function(t,e){var i=new S(t,e);return $.transformPoint(i,this.clientMatrix().inverse())},clientToLocalRect:function(t,e,i,n){var r=new T(t,e,i,n);return $.transformRect(r,this.clientMatrix().inverse())},localToPagePoint:function(t,e){return this.localToPaperPoint(t,e).offset(this.pageOffset())},localToPageRect:function(t,e,i,n){return this.localToPaperRect(t,e,i,n).offset(this.pageOffset())},pageToLocalPoint:function(t,e){var i=new S(t,e).difference(this.pageOffset());return this.paperToLocalPoint(i)},pageToLocalRect:function(t,e,i,n){var r=this.pageOffset(),s=new T(t,e,i,n);return s.x-=r.x,s.y-=r.y,this.paperToLocalRect(s)},clientOffset:function(){var t=this.svg.getBoundingClientRect();return new S(t.left,t.top)},pageOffset:function(){return this.clientOffset().offset(window.scrollX,window.scrollY)},linkAllowed:function(t){if(!(t instanceof Ui))throw new Error("Must provide a linkView.");var e=t.model,i=this.options,n=this.model,r=n.constructor.validations;return!(!i.multiLinks&&!r.multiLinks.call(this,n,e)||!i.linkPinning&&!r.linkPinning.call(this,n,e)||"function"==typeof i.allowLink&&!i.allowLink.call(this,t,this))},getDefaultLink:function(t,e){return Vt(this.options.defaultLink)?this.options.defaultLink.call(this,t,e):this.options.defaultLink.clone()},resolveHighlighter:function(t){var e=(t=t||{}).highlighter,i=this.options;if(void 0===e){var n=["embedding","connecting","magnetAvailability","elementAvailability"].find((function(e){return!!t[e]}));e=n&&i.highlighting[n]||i.highlighting.default}if(!e)return!1;ce(e)&&(e={name:e});var r=e.name,s=i.highlighterNamespace[r];if(!s)throw new Error('Unknown highlighter ("'+r+'")');if("function"!=typeof s.highlight)throw new Error('Highlighter ("'+r+'") is missing required highlight() method');if("function"!=typeof s.unhighlight)throw new Error('Highlighter ("'+r+'") is missing required unhighlight() method');return{highlighter:s,options:e.options||{},name:r}},onCellHighlight:function(t,e,i){if(i=this.resolveHighlighter(i)){e.id||(e.id=$.uniqueId());var n=i.name+e.id+JSON.stringify(i.options);if(!this._highlights[n]){var r=i.highlighter;r.highlight(t,e,kt({},i.options)),this._highlights[n]={cellView:t,magnetEl:e,opt:i.options,highlighter:r}}}},onCellUnhighlight:function(t,e,i){if(i=this.resolveHighlighter(i)){var n=i.name+e.id+JSON.stringify(i.options),r=this._highlights[n];r&&(r.highlighter.unhighlight(r.cellView,r.magnetEl,r.opt),this._highlights[n]=null)}},pointerdblclick:function(t){t.preventDefault(),t=ut(t);var e=this.findView(t.target);if(!this.guard(t,e)){var i=this.snapToGrid(t.clientX,t.clientY);e?e.pointerdblclick(t,i.x,i.y):this.trigger("blank:pointerdblclick",t,i.x,i.y)}},pointerclick:function(t){if(this.eventData(t).mousemoved<=this.options.clickThreshold){t=ut(t);var e=this.findView(t.target);if(this.guard(t,e))return;var i=this.snapToGrid(t.clientX,t.clientY);e?e.pointerclick(t,i.x,i.y):this.trigger("blank:pointerclick",t,i.x,i.y)}},contextmenu:function(t){this.options.preventContextMenu&&t.preventDefault(),t=ut(t);var e=this.findView(t.target);if(!this.guard(t,e)){var i=this.snapToGrid(t.clientX,t.clientY);e?e.contextmenu(t,i.x,i.y):this.trigger("blank:contextmenu",t,i.x,i.y)}},pointerdown:function(t){t=ut(t);var e=this.findView(t.target);if(!this.guard(t,e)){var i=this.snapToGrid(t.clientX,t.clientY);e?(t.preventDefault(),e.pointerdown(t,i.x,i.y)):(this.options.preventDefaultBlankAction&&t.preventDefault(),this.trigger("blank:pointerdown",t,i.x,i.y)),this.delegateDragEvents(e,t.data)}},pointermove:function(t){var e=this.eventData(t);if(e.mousemoved||(e.mousemoved=0),!(++e.mousemoved<=this.options.moveThreshold)){t=ut(t);var i=this.snapToGrid(t.clientX,t.clientY),n=e.sourceView;n?n.pointermove(t,i.x,i.y):this.trigger("blank:pointermove",t,i.x,i.y),this.eventData(t,e)}},pointerup:function(t){this.undelegateDocumentEvents();var e=ut(t),i=this.snapToGrid(e.clientX,e.clientY),r=this.eventData(t).sourceView;r?r.pointerup(e,i.x,i.y):this.trigger("blank:pointerup",e,i.x,i.y),e.isPropagationStopped()||this.pointerclick(n.Event(t,{type:"click",data:t.data})),t.stopImmediatePropagation(),this.delegateEvents()},mouseover:function(t){t=ut(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseover(t);else{if(this.el===t.target)return;this.trigger("blank:mouseover",t)}},mouseout:function(t){t=ut(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseout(t);else{if(this.el===t.target)return;this.trigger("blank:mouseout",t)}},mouseenter:function(t){t=ut(t);var e=this.findView(t.target);if(!this.guard(t,e)){var i=this.findView(t.relatedTarget);if(e){if(i===e)return;e.mouseenter(t)}else{if(i)return;this.trigger("paper:mouseenter",t)}}},mouseleave:function(t){t=ut(t);var e=this.findView(t.target);if(!this.guard(t,e)){var i=this.findView(t.relatedTarget);if(e){if(i===e)return;e.mouseleave(t)}else{if(i)return;this.trigger("paper:mouseleave",t)}}},mousewheel:function(t){t=ut(t);var e=this.findView(t.target);if(!this.guard(t,e)){var i=t.originalEvent,n=this.snapToGrid(i.clientX,i.clientY),r=Math.max(-1,Math.min(1,i.wheelDelta||-i.detail));e?e.mousewheel(t,n.x,n.y,r):this.trigger("blank:mousewheel",t,n.x,n.y,r)}},onevent:function(t){var e=t.currentTarget,i=e.getAttribute("event");if(i){var n=this.findView(e);if(n){if(t=ut(t),this.guard(t,n))return;var r=this.snapToGrid(t.clientX,t.clientY);n.onevent(t,i,r.x,r.y)}}},magnetEvent:function(t,e){var i=t.currentTarget;if(i.getAttribute("magnet")){var n=this.findView(i);if(n){if(t=ut(t),this.guard(t,n))return;var r=this.snapToGrid(t.clientX,t.clientY);e.call(this,n,t,i,r.x,r.y)}}},onmagnet:function(t){this.magnetEvent(t,(function(t,e,i,n,r){t.onmagnet(e,n,r)}))},magnetpointerdblclick:function(t){this.magnetEvent(t,(function(t,e,i,n,r){t.magnetpointerdblclick(e,i,n,r)}))},magnetcontextmenu:function(t){this.options.preventContextMenu&&t.preventDefault(),this.magnetEvent(t,(function(t,e,i,n,r){t.magnetcontextmenu(e,i,n,r)}))},onlabel:function(t){var e=t.currentTarget,i=this.findView(e);if(i){if(t=ut(t),this.guard(t,i))return;var n=this.snapToGrid(t.clientX,t.clientY);i.onlabel(t,n.x,n.y)}},getPointerArgs:function(t){var e=ut(t),i=this.snapToGrid(e.clientX,e.clientY);return[e,i.x,i.y]},delegateDragEvents:function(t,e){e||(e={}),this.eventData({data:e},{sourceView:t||null,mousemoved:0}),this.delegateDocumentEvents(null,e),this.undelegateEvents()},guard:function(t,e){return"mousedown"===t.type&&2===t.button||!(!this.options.guard||!this.options.guard(t,e))||(t.data&&void 0!==t.data.guarded?t.data.guarded:!(e&&e.model&&e.model instanceof Me||this.svg===t.target||this.el===t.target||n.contains(this.svg,t.target)))},setGridSize:function(t){return this.options.gridSize=t,this.options.drawGrid&&this.drawGrid(),this},clearGrid:function(){return this.$grid&&this.$grid.css("backgroundImage","none"),this},_getGridRefs:function(){return this._gridCache||(this._gridCache={root:$("svg",{width:"100%",height:"100%"},$("defs")),patterns:{},add:function(t,e){$(this.root.node.childNodes[0]).append(e),this.patterns[t]=e,this.root.append($("rect",{width:"100%",height:"100%",fill:"url(#"+t+")"}))},get:function(t){return this.patterns[t]},exist:function(t){return void 0!==this.patterns[t]}}),this._gridCache},setGrid:function(t){return this.clearGrid(),this._gridCache=null,this._gridSettings=[],(Array.isArray(t)?t:[t||{}]).forEach((function(t){this._gridSettings.push.apply(this._gridSettings,this._resolveDrawGridOption(t))}),this),this},_resolveDrawGridOption:function(t){var e=this.constructor.gridPatterns;if(ce(t)&&Array.isArray(e[t]))return e[t].map((function(t){return kt({},t)}));var i=t||{args:[{}]},n=Array.isArray(i),r=i.name;if(n||r||i.markup||(r="dot"),r&&Array.isArray(e[r])){var s=e[r].map((function(t){return kt({},t)})),a=Array.isArray(i.args)?i.args:[i.args||{}];Dt(a[0],te(t,"args"));for(var o=0;o<a.length;o++)s[o]&&kt(s[o],a[o]);return s}return n?i:[i]},drawGrid:function(t){var e=this.options.gridSize;if(e<=1)return this.clearGrid();var i=Array.isArray(t)?t:[t],n=this.matrix(),r=this._getGridRefs();this._gridSettings.forEach((function(t,s){var a="pattern_"+s,o=ae(t,i[s],{sx:n.a||1,sy:n.d||1,ox:n.e||0,oy:n.f||0});o.width=e*(n.a||1)*(o.scaleFactor||1),o.height=e*(n.d||1)*(o.scaleFactor||1),r.exist(a)||r.add(a,$("pattern",{id:a,patternUnits:"userSpaceOnUse"},$(o.markup)));var l=r.get(a);Vt(o.update)&&o.update(l.node.childNodes[0],o);var h=o.ox%o.width;h<0&&(h+=o.width);var c=o.oy%o.height;c<0&&(c+=o.height),l.attr({x:h,y:c,width:o.width,height:o.height})}));var s=(new XMLSerializer).serializeToString(r.root.node);return s="url(data:image/svg+xml;base64,"+btoa(s)+")",this.$grid.css("backgroundImage",s),this},updateBackgroundImage:function(t){var e=(t=t||{}).position||"center",i=t.size||"auto auto",n=this.scale(),r=this.translate();le(e)&&(e=r.tx+n.sx*(e.x||0)+"px "+(r.ty+n.sy*(e.y||0))+"px"),le(i)&&(i=(i=new T(i).scale(n.sx,n.sy)).width+"px "+i.height+"px"),this.$background.css({backgroundSize:i,backgroundPosition:e})},drawBackgroundImage:function(t,e){if(t instanceof HTMLImageElement){var i,n=(e=e||{}).size,r=e.repeat||"no-repeat",s=e.opacity||1,a=Math.abs(e.quality)||1,o=this.constructor.backgroundPatterns[re(r)];if(Vt(o)){t.width*=a,t.height*=a;var l=o(t,e);if(!(l instanceof HTMLCanvasElement))throw new Error("dia.Paper: background pattern must return an HTML Canvas instance");i=l.toDataURL("image/png"),r="repeat",le(n)?(n.width*=l.width/t.width,n.height*=l.height/t.height):void 0===n&&(e.size={width:l.width/a,height:l.height/a})}else i=t.src,void 0===n&&(e.size={width:t.width,height:t.height});this.$background.css({opacity:s,backgroundRepeat:r,backgroundImage:"url("+i+")"}),this.updateBackgroundImage(e)}else this.$background.css("backgroundImage","")},updateBackgroundColor:function(t){this.$el.css("backgroundColor",t||"")},drawBackground:function(t){if(t=t||{},this.updateBackgroundColor(t.color),t.image){t=this._background=Bt(t);var e=document.createElement("img");e.onload=this.drawBackgroundImage.bind(this,e,t),e.src=t.image}else this.drawBackgroundImage(null),this._background=null;return this},setInteractivity:function(t){this.options.interactive=t,Rt(this._views,"setInteractivity",t)},isDefined:function(t){return!!this.svg.getElementById(t)},defineFilter:function(t){if(!le(t))throw new TypeError("dia.Paper: defineFilter() requires 1. argument to be an object.");var e=t.id,i=t.name;if(e||(e=i+this.svg.id+rt(JSON.stringify(t))),!this.isDefined(e)){var n=Ct,r=n[i]&&n[i](t.args||{});if(!r)throw new Error("Non-existing filter "+i);var s=kt({filterUnits:"objectBoundingBox",x:-1,y:-1,width:3,height:3},t.attrs,{id:e});$(r,s).appendTo(this.defs)}return e},defineGradient:function(t){if(!le(t))throw new TypeError("dia.Paper: defineGradient() requires 1. argument to be an object.");var e=t.id,i=t.type,n=t.stops;if(e||(e=i+this.svg.id+rt(JSON.stringify(t))),!this.isDefined(e)){var r=St('<stop offset="${offset}" stop-color="${color}" stop-opacity="${opacity}"/>'),s=["<"+i+">",Gt(n).map((function(t){return r({offset:t.offset,color:t.color,opacity:Number.isFinite(t.opacity)?t.opacity:1})})).join(""),"</"+i+">"].join(""),a=kt({id:e},t.attrs);$(s,a).appendTo(this.defs)}return e},defineMarker:function(t){if(!le(t))throw new TypeError("dia.Paper: defineMarker() requires 1. argument to be an object.");var e=t.id;if(e||(e=this.svg.id+rt(JSON.stringify(t))),!this.isDefined(e)){var i=te(t,"type","userSpaceOnUse");$("marker",{id:e,orient:"auto",overflow:"visible",markerUnits:t.markerUnits||"userSpaceOnUse"},[$(t.type||"path",i)]).appendTo(this.defs)}return e}},{sorting:rn,backgroundPatterns:{flipXy:function(t){var e=document.createElement("canvas"),i=t.width,n=t.height;e.width=2*i,e.height=2*n;var r=e.getContext("2d");return r.drawImage(t,0,0,i,n),r.setTransform(-1,0,0,-1,e.width,e.height),r.drawImage(t,0,0,i,n),r.setTransform(-1,0,0,1,e.width,0),r.drawImage(t,0,0,i,n),r.setTransform(1,0,0,-1,0,e.height),r.drawImage(t,0,0,i,n),e},flipX:function(t){var e=document.createElement("canvas"),i=t.width,n=t.height;e.width=2*i,e.height=n;var r=e.getContext("2d");return r.drawImage(t,0,0,i,n),r.translate(2*i,0),r.scale(-1,1),r.drawImage(t,0,0,i,n),e},flipY:function(t){var e=document.createElement("canvas"),i=t.width,n=t.height;e.width=i,e.height=2*n;var r=e.getContext("2d");return r.drawImage(t,0,0,i,n),r.translate(0,2*n),r.scale(1,-1),r.drawImage(t,0,0,i,n),e},watermark:function(t,e){e=e||{};var i=t.width,n=t.height,r=document.createElement("canvas");r.width=3*i,r.height=3*n;for(var s=r.getContext("2d"),a=he(e.watermarkAngle)?-e.watermarkAngle:-20,o=D(a),l=r.width/4,h=r.height/4,c=0;c<4;c++)for(var u=0;u<4;u++)0<(c+u)%2&&(s.setTransform(1,0,0,1,(2*c-1)*l,(2*u-1)*h),s.rotate(o),s.drawImage(t,-i/2,-n/2,i,n));return r}},gridPatterns:{dot:[{color:"#AAAAAA",thickness:1,markup:"rect",update:function(t,e){$(t).attr({width:e.thickness*e.sx,height:e.thickness*e.sy,fill:e.color})}}],fixedDot:[{color:"#AAAAAA",thickness:1,markup:"rect",update:function(t,e){var i=e.sx<=1?e.thickness*e.sx:e.thickness;$(t).attr({width:i,height:i,fill:e.color})}}],mesh:[{color:"#AAAAAA",thickness:1,markup:"path",update:function(t,e){var i,n=e.width,r=e.height,s=e.thickness;i=0<=n-s&&0<=r-s?["M",n,0,"H0 M0 0 V0",r].join(" "):"M 0 0 0 0",$(t).attr({d:i,stroke:e.color,"stroke-width":e.thickness})}}],doubleMesh:[{color:"#AAAAAA",thickness:1,markup:"path",update:function(t,e){var i,n=e.width,r=e.height,s=e.thickness;i=0<=n-s&&0<=r-s?["M",n,0,"H0 M0 0 V0",r].join(" "):"M 0 0 0 0",$(t).attr({d:i,stroke:e.color,"stroke-width":e.thickness})}},{color:"#000000",thickness:3,scaleFactor:4,markup:"path",update:function(t,e){var i,n=e.width,r=e.height,s=e.thickness;i=0<=n-s&&0<=r-s?["M",n,0,"H0 M0 0 V0",r].join(" "):"M 0 0 0 0",$(t).attr({d:i,stroke:e.color,"stroke-width":e.thickness})}}]}}),ln=Ke.extend({name:null,tagName:"g",className:"tool",svgElement:!0,_visible:!0,init:function(){var t=this.name;t&&this.vel.attr("data-tool-name",t)},configure:function(t,e){return this.relatedView=t,this.paper=t.paper,this.parentView=e,this.simulateRelatedView(this.el),this.delegateEvents(),this},simulateRelatedView:function(t){t&&t.setAttribute("model-id",this.relatedView.model.id)},getName:function(){return this.name},show:function(){this.el.style.display="",this._visible=!0},hide:function(){this.el.style.display="none",this._visible=!1},isVisible:function(){return!!this._visible},focus:function(){var t=this.options.focusOpacity;isFinite(t)&&(this.el.style.opacity=t),this.parentView.focusTool(this)},blur:function(){this.el.style.opacity="",this.parentView.blurTool(this)},update:function(){},guard:function(t){var e=this.paper,i=this.relatedView;return!e||!i||e.guard(t,i)}}),hn=Ke.extend({tagName:"g",className:"tools",svgElement:!0,tools:null,options:{tools:null,relatedView:null,name:null,component:!1},configure:function(t){var e=(t=kt(this.options,t)).tools;if(!Array.isArray(e))return this;var i=t.relatedView;if(!(i instanceof Qe))return this;for(var n=this.tools=[],r=0,s=e.length;r<s;r++){var a=e[r];a instanceof ln&&(a.configure(i,this),a.render(),this.vel.append(a.el),n.push(a))}return this},getName:function(){return this.options.name},update:function(t){t||(t={});var e=this.tools;if(e){for(var i=0,n=e.length;i<n;i++){var r=e[i];t.tool!==r.cid&&r.isVisible()&&r.update()}return this}},focusTool:function(t){var e=this.tools;if(!e)return this;for(var i=0,n=e.length;i<n;i++){var r=e[i];t===r?r.show():r.hide()}return this},blurTool:function(t){var e=this.tools;if(!e)return this;for(var i=0,n=e.length;i<n;i++){var r=e[i];r===t||r.isVisible()||(r.show(),r.update())}return this},hide:function(){return this.focusTool(null)},show:function(){return this.blurTool(null)},onRemove:function(){var t=this.tools;if(!t)return this;for(var e=0,i=t.length;e<i;e++)t[e].remove();this.tools=null},mount:function(){var t=this.options,e=t.relatedView;return e&&(t.component?e.el:e.paper.tools).appendChild(this.el),this}}),cn={Graph:Ye,attributes:Se,Cell:Me,CellView:Qe,Element:Xe,ElementView:$e,Link:Ue,LinkView:Ui,Paper:on,ToolView:ln,ToolsView:hn},un={exportElement:function(t){return t.size()},exportLink:function(t){var e=t.get("labelSize")||{};return{minLen:t.get("minLen")||1,weight:t.get("weight")||1,labelpos:t.get("labelPosition")||"c",labeloffset:t.get("labelOffset")||0,width:e.width||0,height:e.height||0}},importElement:function(t,e,i){var n=this.getCell(e),r=i.node(e);t.setPosition?t.setPosition(n,r):n.set("position",{x:r.x-r.width/2,y:r.y-r.height/2})},importLink:function(t,e,i){var n=this.getCell(e.name),r=i.edge(e),s=r.points||[],a=new M(s);if(t.setVertices||t.setLinkVertices)if(Vt(t.setVertices))t.setVertices(n,s);else{a.simplify({threshold:.001});var o=a.points.map((function(t){return t.toJSON()})),l=o.length;n.set("vertices",o.slice(1,l-1))}if(t.setLabels&&"x"in r&&"y"in r){var h={x:r.x,y:r.y};if(Vt(t.setLabels))t.setLabels(n,h,s);else{var c=a.closestPointLength(h),u=a.pointAtLength(c),d=c/a.length(),f=new S(h).difference(u).toJSON();n.label(0,{position:{distance:d,offset:f}})}}},layout:function(t,e){var i;i=t instanceof Ye?t:(new Ye).resetCells(t,{dry:!0,sort:!1});var n=(e=Dt(e||{},{resizeClusters:!(t=null),clusterPadding:10,exportElement:this.exportElement,exportLink:this.exportLink})).dagre||("undefined"!=typeof dagre?dagre:void 0);if(void 0===n)throw new Error('The the "dagre" utility is a mandatory dependency.');var r=un.toGraphLib(i,{graphlib:e.graphlib,directed:!0,multigraph:!0,compound:!0,setNodeLabel:e.exportElement,setEdgeLabel:e.exportLink,setEdgeName:function(t){return t.id}}),s={},a=e.marginX||0,o=e.marginY||0;if(e.rankDir&&(s.rankdir=e.rankDir),e.align&&(s.align=e.align),e.nodeSep&&(s.nodesep=e.nodeSep),e.edgeSep&&(s.edgesep=e.edgeSep),e.rankSep&&(s.ranksep=e.rankSep),e.ranker&&(s.ranker=e.ranker),a&&(s.marginx=a),o&&(s.marginy=o),r.setGraph(s),n.layout(r,{debugTiming:!!e.debugTiming}),i.startBatch("layout"),un.fromGraphLib(r,{importNode:this.importElement.bind(i,e),importEdge:this.importLink.bind(i,e)}),e.resizeClusters){var l=r.nodes().filter((function(t){return 0<r.children(t).length})).map(i.getCell.bind(i)).sort((function(t,e){return e.getAncestors().length-t.getAncestors().length}));Rt(l,"fitEmbeds",{padding:e.clusterPadding})}i.stopBatch("layout");var h=r.graph();return new T(a,o,Math.abs(h.width-2*a),Math.abs(h.height-2*o))},fromGraphLib:function(t,e){var i=(e=e||{}).importNode||ue,n=e.importEdge||ue,r=this instanceof Ye?this:new Ye;return t.nodes().forEach((function(n){i.call(r,n,t,r,e)})),t.edges().forEach((function(i){n.call(r,i,t,r,e)})),r},toGraphLib:function(t,e){var i=(e=e||{}).graphlib||("undefined"!=typeof graphlib?graphlib:void 0);if(void 0===i)throw new Error('The the "graphlib" utility is a mandatory dependency.');for(var n=ee(e,"directed","compound","multigraph"),r=new i.Graph(n),s=e.setNodeLabel||ue,a=e.setEdgeLabel||ue,o=e.setEdgeName||ue,l=t.get("cells"),h=0,c=l.length;h<c;h++){var u=l.at(h);if(u.isLink()){var d=u.get("source"),f=u.get("target");if(!d.id||!f.id)break;r.setEdge(d.id,f.id,a(u),o(u))}else if(r.setNode(u.id,s(u)),r.isCompound()&&u.has("parent")){var p=u.get("parent");l.has(p)&&r.setParent(u.id,p)}}return r}};Ye.prototype.toGraphLib=function(t){return un.toGraphLib(this,t)},Ye.prototype.fromGraphLib=function(t,e){return un.fromGraphLib.call(this,t,e)};var dn={_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))}},addTest:function(t,e){return this._tests[t]=e},test:function(t){var e=this._tests[t];if(!e)throw new Error('Test not defined ("'+t+'"). Use `joint.env.addTest(name, fn) to add a new test.`');var i=this._results[t];if(void 0!==i)return i;try{i=e()}catch(t){i=!1}return this._results[t]=i}},fn=Xe.define("basic.Generic",{attrs:{".":{fill:"#ffffff",stroke:"none"}}}),pn=fn.define("basic.Rect",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:100,height:60},text:{fill:"#000000",text:"","font-size":14,"ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>'}),mn=$e.extend({presentationAttributes:$e.addPresentationAttributes({attrs:["SCALE"]}),confirmUpdate:function(){var t=$e.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"SCALE")&&(this.resize(),t=this.removeFlag(t,"SCALE")),t}}),gn=fn.define("basic.Text",{attrs:{text:{"font-size":18,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><text/></g></g>'}),vn=fn.define("basic.Circle",{size:{width:60,height:60},attrs:{circle:{fill:"#ffffff",stroke:"#000000",r:30,cx:30,cy:30},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>'}),_n=fn.define("basic.Ellipse",{size:{width:60,height:40},attrs:{ellipse:{fill:"#ffffff",stroke:"#000000",rx:30,ry:20,cx:30,cy:20},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse/></g><text/></g>'}),yn=fn.define("basic.Polygon",{size:{width:60,height:40},attrs:{polygon:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'}),bn=fn.define("basic.Polyline",{size:{width:60,height:40},attrs:{polyline:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polyline/></g><text/></g>'}),xn=fn.define("basic.Image",{attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>'}),wn=fn.define("basic.Path",{size:{width:60,height:60},attrs:{path:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle",ref:"path","ref-x":.5,"ref-dy":10,fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>'}),An=wn.define("basic.Rhombus",{attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":.5,"ref-dy":null,"y-alignment":"middle"}}}),Cn=dn.test("svgforeignobject"),In=fn.define("basic.TextBlock",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},{markup:['<g class="rotatable">','<g class="scalable"><rect/></g>',Cn?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>',"</g>"].join(""),initialize:function(){this.listenTo(this,"change:size",this.updateSize),this.listenTo(this,"change:content",this.updateContent),this.updateSize(this,this.get("size")),this.updateContent(this,this.get("content")),fn.prototype.initialize.apply(this,arguments)},updateSize:function(t,e){this.attr({".fobj":kt({},e),div:{style:kt({},e)}})},updateContent:function(t,e){Cn?this.attr({".content":{html:vt(e)}}):this.attr({".content":{text:e}})},setForeignObjectSize:function(){this.updateSize.apply(this,arguments)},setDivContent:function(){this.updateContent.apply(this,arguments)}}),Sn=$e.extend({presentationAttributes:Cn?$e.prototype.presentationAttributes:$e.addPresentationAttributes({content:["CONTENT"],size:["CONTENT"]}),initFlag:["RENDER","CONTENT"],confirmUpdate:function(){var t=$e.prototype.confirmUpdate.apply(this,arguments);return this.hasFlag(t,"CONTENT")&&(this.updateContent(this.model),t=this.removeFlag(t,"CONTENT")),t},update:function(t,e){var i=this.model;if(Cn)$e.prototype.update.call(this,i,e);else{var n=te(e||i.get("attrs"),".content");$e.prototype.update.call(this,i,n),e&&!Qt(e,".content")||this.updateContent(i,e)}},updateContent:function(t,e){var i=ae({},(e||t.get("attrs"))[".content"]);i=te(i,"text");var n=gt(t.get("content"),t.get("size"),i,{svgDocument:this.paper.svg}),r=at({},".content",i,"/");r[".content"].text=n,$e.prototype.update.call(this,t,r)}}),Mn={Generic:fn,Rect:pn,TextView:mn,Text:gn,Circle:vn,Ellipse:_n,Polygon:yn,Polyline:bn,Image:xn,Path:wn,Rhombus:An,TextBlock:In,TextBlockView:Sn},Tn=Xe.define("standard.Rectangle",{attrs:{body:{refWidth:"100%",refHeight:"100%",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}]}),Pn=Xe.define("standard.Circle",{attrs:{body:{refCx:"50%",refCy:"50%",refR:"50%",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}]}),En=Xe.define("standard.Ellipse",{attrs:{body:{refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"body"},{tagName:"text",selector:"label"}]}),kn=Xe.define("standard.Path",{attrs:{body:{refD:"M 0 0 L 10 0 10 10 0 10 Z",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}]}),Dn=Xe.define("standard.Polygon",{attrs:{body:{refPoints:"0 0 10 0 10 10 0 10",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"}]}),On=Xe.define("standard.Polyline",{attrs:{body:{refPoints:"0 0 10 0 10 10 0 10 0 0",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polyline",selector:"body"},{tagName:"text",selector:"label"}]}),Rn=Xe.define("standard.Image",{attrs:{image:{refWidth:"100%",refHeight:"100%"},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}),Ln=Xe.define("standard.BorderedImage",{attrs:{border:{refWidth:"100%",refHeight:"100%",stroke:"#333333",strokeWidth:2},background:{refWidth:-1,refHeight:-1,x:.5,y:.5,fill:"#FFFFFF"},image:{refWidth:-1,refHeight:-1,x:.5,y:.5},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"background",attributes:{stroke:"none"}},{tagName:"image",selector:"image"},{tagName:"rect",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]}),Nn=Xe.define("standard.EmbeddedImage",{attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#333333",fill:"#FFFFFF",strokeWidth:2},image:{refWidth:"30%",refHeight:-20,x:10,y:10,preserveAspectRatio:"xMidYMin"},label:{textVerticalAnchor:"top",textAnchor:"left",refX:"30%",refX2:20,refY:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}),zn=Xe.define("standard.InscribedImage",{attrs:{border:{refRx:"50%",refRy:"50%",refCx:"50%",refCy:"50%",stroke:"#333333",strokeWidth:2},background:{refRx:"50%",refRy:"50%",refCx:"50%",refCy:"50%",fill:"#FFFFFF"},image:{refWidth:"68%",refHeight:"68%",refX:"16%",refY:"16%",preserveAspectRatio:"xMidYMid"},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"background"},{tagName:"image",selector:"image"},{tagName:"ellipse",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]}),Bn=Xe.define("standard.HeaderedRectangle",{attrs:{body:{refWidth:"100%",refHeight:"100%",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},header:{refWidth:"100%",height:30,strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},headerText:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:15,fontSize:16,fill:"#333333"},bodyText:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",refY2:15,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerText"},{tagName:"text",selector:"bodyText"}]}),Fn=Xe.define("standard.Cylinder",{attrs:{body:{lateralArea:10,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},top:{refCx:"50%",cy:10,refRx:"50%",ry:10,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"100%",refY2:15,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"ellipse",selector:"top"},{tagName:"text",selector:"label"}],topRy:function(t,e){if(void 0===t)return this.attr("body/lateralArea");var i={lateralArea:t},n=pt(t)?{refCy:t,refRy:t,cy:null,ry:null}:{refCy:null,refRy:null,cy:t,ry:t};return this.attr({body:i,top:n},e)}},{attributes:{lateralArea:{set:function(t,e){var i=pt(t);i&&(t=parseFloat(t)/100);var n=e.x,r=e.y,s=e.width,a=e.height,o=s/2,l=i?a*t:t,h=$.KAPPA,c=h*o,u=h*(i?a*t:t),d=n+s/2,f=n+s,p=r+l,m=p-l,g=r+a-l,v=r+a;return{d:["M",n,p,"L",n,g,"C",n,g+u,d-c,v,d,v,"C",d+c,v,f,g+u,f,g,"L",f,p,"C",f,p-u,d+c,m,d,m,"C",d-c,m,n,p-u,n,p,"Z"].join(" ")}}}}}),jn=dn.test("svgforeignobject")?{tagName:"foreignObject",selector:"foreignObject",attributes:{overflow:"hidden"},children:[{tagName:"div",namespaceURI:"http://www.w3.org/1999/xhtml",selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]}:{tagName:"text",selector:"label",attributes:{"text-anchor":"middle"}},Vn={Rectangle:Tn,Circle:Pn,Ellipse:En,Path:kn,Polygon:Dn,Polyline:On,Image:Rn,BorderedImage:Ln,EmbeddedImage:Nn,InscribedImage:zn,HeaderedRectangle:Bn,Cylinder:Fn,TextBlock:Xe.define("standard.TextBlock",{attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#333333",fill:"#ffffff",strokeWidth:2},foreignObject:{refWidth:"100%",refHeight:"100%"},label:{style:{fontSize:14}}}},{markup:[{tagName:"rect",selector:"body"},jn]},{attributes:{text:{set:function(t,e,i,n){if(!(i instanceof HTMLElement)){var r=n.style||{},s={text:t,width:-5,height:"100%"},a=kt({textVerticalAnchor:"middle"},r);return Se.textWrap.set.call(this,s,e,i,a),{fill:r.color||null}}i.textContent=t},position:function(t,e,i){if(i instanceof SVGElement)return e.center()}}}}),Link:Ue.define("standard.Link",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 10 -5 0 0 10 5 z"}},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),DoubleLink:Ue.define("standard.DoubleLink",{attrs:{line:{connection:!0,stroke:"#DDDDDD",strokeWidth:4,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"#000000",d:"M 10 -3 10 -10 -2 0 10 10 10 3"}},outline:{connection:!0,stroke:"#000000",strokeWidth:6,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"outline",attributes:{fill:"none"}},{tagName:"path",selector:"line",attributes:{fill:"none"}}]}),ShadowLink:Ue.define("standard.ShadowLink",{attrs:{line:{connection:!0,stroke:"#FF0000",strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"none",d:"M 0 -10 -10 0 0 10 z"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}},shadow:{connection:!0,refX:3,refY:6,stroke:"#000000",strokeOpacity:.2,strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 0 -10 -10 0 0 10 z",stroke:"none"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}}}},{markup:[{tagName:"path",selector:"shadow",attributes:{fill:"none"}},{tagName:"path",selector:"line",attributes:{fill:"none"}}]})},Un=fn.define("devs.Model",{inPorts:[],outPorts:[],size:{width:80,height:80},attrs:{".":{magnet:!1},".label":{text:"Model","ref-x":.5,"ref-y":10,"font-size":18,"text-anchor":"middle",fill:"#000"},".body":{"ref-width":"100%","ref-height":"100%",stroke:"#000"}},ports:{groups:{in:{position:{name:"left"},attrs:{".port-label":{fill:"#000"},".port-body":{fill:"#fff",stroke:"#000",r:10,magnet:!0}},label:{position:{name:"left",args:{y:10}}}},out:{position:{name:"right"},attrs:{".port-label":{fill:"#000"},".port-body":{fill:"#fff",stroke:"#000",r:10,magnet:!0}},label:{position:{name:"right",args:{y:10}}}}}}},{markup:'<g class="rotatable"><rect class="body"/><text class="label"/></g>',portMarkup:'<circle class="port-body"/>',portLabelMarkup:'<text class="port-label"/>',initialize:function(){fn.prototype.initialize.apply(this,arguments),this.on("change:inPorts change:outPorts",this.updatePortItems,this),this.updatePortItems()},updatePortItems:function(t,e,i){var n=Nt(this.get("inPorts")),r=qt(Nt(this.get("outPorts")),n),s=this.createPortItems("in",n),a=this.createPortItems("out",r);this.prop("ports/items",s.concat(a),kt({rewrite:!0},i))},createPortItem:function(t,e){return{id:e,group:t,attrs:{".port-label":{text:e}}}},createPortItems:function(t,e){return Gt(e).map(this.createPortItem.bind(this,t))},_addGroupPort:function(t,e,i){var n=this.get(e);return this.set(e,Array.isArray(n)?n.concat(t):[t],i)},addOutPort:function(t,e){return this._addGroupPort(t,"outPorts",e)},addInPort:function(t,e){return this._addGroupPort(t,"inPorts",e)},_removeGroupPort:function(t,e,i){return this.set(e,Yt(this.get(e),t),i)},removeOutPort:function(t,e){return this._removeGroupPort(t,"outPorts",e)},removeInPort:function(t,e){return this._removeGroupPort(t,"inPorts",e)},_changeGroup:function(t,e,i){return this.prop("ports/groups/"+t,le(e)?e:{},i)},changeInGroup:function(t,e){return this._changeGroup("in",t,e)},changeOutGroup:function(t,e){return this._changeGroup("out",t,e)}}),Gn=Un.define("devs.Atomic",{size:{width:80,height:80},attrs:{".label":{text:"Atomic"}}}),Wn=Un.define("devs.Coupled",{size:{width:200,height:300},attrs:{".label":{text:"Coupled"}}}),Hn={Model:Un,Atomic:Gn,Coupled:Wn,Link:Ue.define("devs.Link",{attrs:{".connection":{"stroke-width":2}}})},Xn=fn.define("logic.Gate",{size:{width:80,height:40},attrs:{".":{magnet:!1},".body":{width:100,height:50},circle:{r:7,stroke:"black",fill:"transparent","stroke-width":2}}},{operation:function(){return!0}}),Zn=Xn.define("logic.IO",{size:{width:60,height:30},attrs:{".body":{fill:"white",stroke:"black","stroke-width":2},".wire":{ref:".body","ref-y":.5,stroke:"black"},text:{fill:"black",ref:".body","ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle","font-weight":"bold","font-variant":"small-caps","text-transform":"capitalize","font-size":"14px"}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><path class="wire"/><circle/><text/></g>'}),Yn=Zn.define("logic.Input",{attrs:{".wire":{"ref-dx":0,d:"M 0 0 L 23 0"},circle:{ref:".body","ref-dx":30,"ref-y":.5,magnet:!0,class:"output",port:"out"},text:{text:"input"}}}),qn=Zn.define("logic.Output",{attrs:{".wire":{"ref-x":0,d:"M 0 0 L -23 0"},circle:{ref:".body","ref-x":-30,"ref-y":.5,magnet:"passive",class:"input",port:"in"},text:{text:"output"}}}),Kn=Xn.define("logic.Gate11",{attrs:{".input":{ref:".body","ref-x":-2,"ref-y":.5,magnet:"passive",port:"in"},".output":{ref:".body","ref-dx":2,"ref-y":.5,magnet:!0,port:"out"}}},{markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input"/><circle class="output"/></g>'}),Jn=Xn.define("logic.Gate21",{attrs:{".input1":{ref:".body","ref-x":-2,"ref-y":.3,magnet:"passive",port:"in1"},".input2":{ref:".body","ref-x":-2,"ref-y":.7,magnet:"passive",port:"in2"},".output":{ref:".body","ref-dx":2,"ref-y":.5,magnet:!0,port:"out"}}},{markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input input1"/><circle  class="input input2"/><circle class="output"/></g>'}),Qn=Kn.define("logic.Repeater",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzIuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICA8L2c+Cjwvc3ZnPgo="}}},{operation:function(t){return t}}),$n=Kn.define("logic.Not",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzkuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDI2NzEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzYiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA4MCwyNSBBIDQsNCAwIDEgMSA3MiwyNSBBIDQsNCAwIDEgMSA4MCwyNSB6IgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEsMCkiIC8+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(t){return!t}}),tr=Jn.define("logic.Or",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik9SIEFOU0kuc3ZnIgogICBpbmtzY2FwZTpvdXRwdXRfZXh0ZW5zaW9uPSJvcmcuaW5rc2NhcGUub3V0cHV0LnN2Zy5pbmtzY2FwZSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTAgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjcxNCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iMSA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMC41IDogMC4zMzMzMzMzMyA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODA2IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODE5IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjM3Mi4wNDcyNCA6IDM1MC43ODczOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI3NDQuMDk0NDggOiA1MjYuMTgxMDkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzc3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49Ijc1IDogNDAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTUwIDogNjAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDYwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTMyNzUiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNTAgOiAzMy4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTAwIDogNTAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTU1MzMiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzIgOiAyMS4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNjQgOiAzMiA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMzIgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjU1NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDE2LjY2NjY2NyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDI1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAyNSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iNCIKICAgICBpbmtzY2FwZTpjeD0iMTEzLjAwMDM5IgogICAgIGlua3NjYXBlOmN5PSIxMi44OTM3MzEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImcyNTYwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpncmlkLWJib3g9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1wb2ludHM9InRydWUiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAwMDAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMzk5IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijg3NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMzciCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii00IgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNzAsMjUgYyAyMCwwIDI1LDAgMjUsMCIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMSwxNSA1LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzIsMzUgNSwzNSIKICAgICAgIGlkPSJwYXRoMzk0NCIgLz4KICAgIDxnCiAgICAgICBpZD0iZzI1NjAiCiAgICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2LjUsLTM5LjUpIj4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo="}}},{operation:function(t,e){return t||e}}),er=Jn.define("logic.And",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IkFORCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI4IgogICAgIGlua3NjYXBlOmN4PSI1Ni42OTgzNDgiCiAgICAgaW5rc2NhcGU6Y3k9IjI1LjMyNjg5OSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTptZWRpdW07Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7bGluZS1oZWlnaHQ6bm9ybWFsO2xldHRlci1zcGFjaW5nOm5vcm1hbDt3b3JkLXNwYWNpbmc6bm9ybWFsO3RleHQtdHJhbnNmb3JtOm5vbmU7ZGlyZWN0aW9uOmx0cjtibG9jay1wcm9ncmVzc2lvbjp0Yjt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6c3RhcnQ7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDozO21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGU7Zm9udC1mYW1pbHk6Qml0c3RyZWFtIFZlcmEgU2FuczstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkJpdHN0cmVhbSBWZXJhIFNhbnMiCiAgICAgICBkPSJNIDMwLDUgTCAzMCw2LjQyODU3MTQgTCAzMCw0My41NzE0MjkgTCAzMCw0NSBMIDMxLjQyODU3MSw0NSBMIDUwLjQ3NjE5LDQ1IEMgNjEuNzQ0MDk4LDQ1IDcwLjQ3NjE5LDM1Ljk5OTk1NSA3MC40NzYxOSwyNSBDIDcwLjQ3NjE5LDE0LjAwMDA0NSA2MS43NDQwOTksNS4wMDAwMDAyIDUwLjQ3NjE5LDUgQyA1MC40NzYxOSw1IDUwLjQ3NjE5LDUgMzEuNDI4NTcxLDUgTCAzMCw1IHogTSAzMi44NTcxNDMsNy44NTcxNDI5IEMgNDAuODM0MjY0LDcuODU3MTQyOSA0NS45MTgzNjgsNy44NTcxNDI5IDQ4LjA5NTIzOCw3Ljg1NzE0MjkgQyA0OS4yODU3MTQsNy44NTcxNDI5IDQ5Ljg4MDk1Miw3Ljg1NzE0MjkgNTAuMTc4NTcxLDcuODU3MTQyOSBDIDUwLjMyNzM4MSw3Ljg1NzE0MjkgNTAuNDA5MjI3LDcuODU3MTQyOSA1MC40NDY0MjksNy44NTcxNDI5IEMgNTAuNDY1MDI5LDcuODU3MTQyOSA1MC40NzE1NDMsNy44NTcxNDI5IDUwLjQ3NjE5LDcuODU3MTQyOSBDIDYwLjIzNjg1Myw3Ljg1NzE0MyA2Ny4xNDI4NTcsMTUuNDk3MDk4IDY3LjE0Mjg1NywyNSBDIDY3LjE0Mjg1NywzNC41MDI5MDIgNTkuNzYwNjYyLDQyLjE0Mjg1NyA1MCw0Mi4xNDI4NTcgTCAzMi44NTcxNDMsNDIuMTQyODU3IEwgMzIuODU3MTQzLDcuODU3MTQyOSB6IgogICAgICAgaWQ9InBhdGgyODg0IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NzY2NjY3Nzc3NzY2NjIiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(t,e){return t&&e}}),ir=Jn.define("logic.Nor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjEiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjY3NzY0NCIKICAgICBpbmtzY2FwZTpjeT0iMjIuMTAyMzQ0IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjM3IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItNCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc5LDI1IEMgOTksMjUgOTUsMjUgOTUsMjUiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgICBpZD0icGF0aDI2MDQiCiAgICAgICAgIHNvZGlwb2RpOmN4PSI3NSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjI1IgogICAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgICAgc29kaXBvZGk6cnk9IjQiCiAgICAgICAgIGQ9Ik0gNzksMjUgQSA0LDQgMCAxIDEgNzEsMjUgQSA0LDQgMCAxIDEgNzksMjUgeiIKICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI2LjUsMzkuNSkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(t,e){return!(t||e)}}),nr=Jn.define("logic.Nand",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5BTkQgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMTYiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjI4MzMwNyIKICAgICBpbmtzY2FwZTpjeT0iMTYuNDQyODQzIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzksMjUgQyA5MS44LDI1IDk1LDI1IDk1LDI1IgogICAgICAgaWQ9InBhdGgzMDU5IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMxLDE1IDUsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMiwzNSA1LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmb250LXNpemU6bWVkaXVtO2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1pbmRlbnQ6MDt0ZXh0LWFsaWduOnN0YXJ0O3RleHQtZGVjb3JhdGlvbjpub25lO2xpbmUtaGVpZ2h0Om5vcm1hbDtsZXR0ZXItc3BhY2luZzpub3JtYWw7d29yZC1zcGFjaW5nOm5vcm1hbDt0ZXh0LXRyYW5zZm9ybTpub25lO2RpcmVjdGlvbjpsdHI7YmxvY2stcHJvZ3Jlc3Npb246dGI7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOnN0YXJ0O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MzttYXJrZXI6bm9uZTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlO2ZvbnQtZmFtaWx5OkJpdHN0cmVhbSBWZXJhIFNhbnM7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpCaXRzdHJlYW0gVmVyYSBTYW5zIgogICAgICAgZD0iTSAzMCw1IEwgMzAsNi40Mjg1NzE0IEwgMzAsNDMuNTcxNDI5IEwgMzAsNDUgTCAzMS40Mjg1NzEsNDUgTCA1MC40NzYxOSw0NSBDIDYxLjc0NDA5OCw0NSA3MC40NzYxOSwzNS45OTk5NTUgNzAuNDc2MTksMjUgQyA3MC40NzYxOSwxNC4wMDAwNDUgNjEuNzQ0MDk5LDUuMDAwMDAwMiA1MC40NzYxOSw1IEMgNTAuNDc2MTksNSA1MC40NzYxOSw1IDMxLjQyODU3MSw1IEwgMzAsNSB6IE0gMzIuODU3MTQzLDcuODU3MTQyOSBDIDQwLjgzNDI2NCw3Ljg1NzE0MjkgNDUuOTE4MzY4LDcuODU3MTQyOSA0OC4wOTUyMzgsNy44NTcxNDI5IEMgNDkuMjg1NzE0LDcuODU3MTQyOSA0OS44ODA5NTIsNy44NTcxNDI5IDUwLjE3ODU3MSw3Ljg1NzE0MjkgQyA1MC4zMjczODEsNy44NTcxNDI5IDUwLjQwOTIyNyw3Ljg1NzE0MjkgNTAuNDQ2NDI5LDcuODU3MTQyOSBDIDUwLjQ2NTAyOSw3Ljg1NzE0MjkgNTAuNDcxNTQzLDcuODU3MTQyOSA1MC40NzYxOSw3Ljg1NzE0MjkgQyA2MC4yMzY4NTMsNy44NTcxNDMgNjcuMTQyODU3LDE1LjQ5NzA5OCA2Ny4xNDI4NTcsMjUgQyA2Ny4xNDI4NTcsMzQuNTAyOTAyIDU5Ljc2MDY2Miw0Mi4xNDI4NTcgNTAsNDIuMTQyODU3IEwgMzIuODU3MTQzLDQyLjE0Mjg1NyBMIDMyLjg1NzE0Myw3Ljg1NzE0MjkgeiIKICAgICAgIGlkPSJwYXRoMjg4NCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2Njc2NjY2Nzc3Nzc2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDQwMDgiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(t,e){return!(t&&e)}}),rr=Jn.define("logic.Xor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhPUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjUuNjU2ODU0MiIKICAgICBpbmtzY2FwZTpjeD0iMjUuOTM4MTE2IgogICAgIGlua3NjYXBlOmN5PSIxNy4yMzAwNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzAuMzg1NzE3LDE1IEwgNC45OTk5OTk4LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5NzY7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEuMzYyMDkxLDM1IEwgNC45OTk5OTk4LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPGcKICAgICAgIGlkPSJnMjU2MCIKICAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjYuNSwtMzkuNSkiPgogICAgICA8cGF0aAogICAgICAgICBpZD0icGF0aDM1MTYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi4yNSw4MS41MDAwMDUgQyAtMy44NDczNzQsODQuMTQ0NDA1IC00LjUsODQuNTAwMDA1IC00LjUsODQuNTAwMDA1IEwgLTguMTU2MjUsODQuNTAwMDA1IEwgLTYuMTU2MjUsODIuMDYyNTA1IEMgLTYuMTU2MjUsODIuMDYyNTA1IC0wLjUsNzUuMDYyNDUxIC0wLjUsNjQuNSBDIC0wLjUsNTMuOTM3NTQ5IC02LjE1NjI1LDQ2LjkzNzUgLTYuMTU2MjUsNDYuOTM3NSBMIC04LjE1NjI1LDQ0LjUgTCAtNC41LDQ0LjUgQyAtMy43MTg3NSw0NS40Mzc1IC0zLjA3ODEyNSw0Ni4xNTYyNSAtMi4yODEyNSw0Ny41IEMgLTAuNDA4NTMxLDUwLjU5OTgxNSAyLjUsNTYuNTI2NjQ2IDIuNSw2NC41IEMgMi41LDcyLjQ1MDY1IC0wLjM5NjY5Nyw3OC4zNzk0MjUgLTIuMjUsODEuNTAwMDA1IHoiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(t,e){return(!t||e)&&(t||!e)}}),sr=Jn.define("logic.Xnor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhOT1IgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNTU3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTYuNjY2NjY3IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDI1IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI0IgogICAgIGlua3NjYXBlOmN4PSI5NS43MjM2NiIKICAgICBpbmtzY2FwZTpjeT0iLTI2Ljc3NTAyMyIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjAwMDAwMDI0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc4LjMzMzMzMiwyNSBDIDkxLjY2NjY2NiwyNSA5NSwyNSA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMC4zODU3MTcsMTUgTCA0Ljk5OTk5OTgsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk3NjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMS4zNjIwOTEsMzUgTCA0Ljk5OTk5OTgsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGlkPSJwYXRoMzUxNiIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjI1LDgxLjUwMDAwNSBDIC0zLjg0NzM3NCw4NC4xNDQ0MDUgLTQuNSw4NC41MDAwMDUgLTQuNSw4NC41MDAwMDUgTCAtOC4xNTYyNSw4NC41MDAwMDUgTCAtNi4xNTYyNSw4Mi4wNjI1MDUgQyAtNi4xNTYyNSw4Mi4wNjI1MDUgLTAuNSw3NS4wNjI0NTEgLTAuNSw2NC41IEMgLTAuNSw1My45Mzc1NDkgLTYuMTU2MjUsNDYuOTM3NSAtNi4xNTYyNSw0Ni45Mzc1IEwgLTguMTU2MjUsNDQuNSBMIC00LjUsNDQuNSBDIC0zLjcxODc1LDQ1LjQzNzUgLTMuMDc4MTI1LDQ2LjE1NjI1IC0yLjI4MTI1LDQ3LjUgQyAtMC40MDg1MzEsNTAuNTk5ODE1IDIuNSw1Ni41MjY2NDYgMi41LDY0LjUgQyAyLjUsNzIuNDUwNjUgLTAuMzk2Njk3LDc4LjM3OTQyNSAtMi4yNSw4MS41MDAwMDUgeiIKICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY2NzYyIgLz4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDM1NTEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(t,e){return(!t||!e)&&(t||e)}}),ar={Gate:Xn,IO:Zn,Input:Yn,Output:qn,Gate11:Kn,Gate21:Jn,Repeater:Qn,Not:$n,Or:tr,And:er,Nor:ir,Nand:nr,Xor:rr,Xnor:sr,Wire:Ue.define("logic.Wire",{attrs:{".connection":{"stroke-width":2},".marker-vertex":{r:7}},router:{name:"orthogonal"},connector:{name:"rounded",args:{radius:10}}},{arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<circle class="marker-arrowhead" end="<%= end %>" r="7"/>',"</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<g class="marker-vertex-remove-group">','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>","</g>"].join("")})},or={KingWhite:fn.define("chess.KingWhite",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;"><path      d="M 22.5,11.63 L 22.5,6"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 20,8 L 25,8"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"      style="fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 11.5,30 C 17,27 27,27 32.5,30"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,37 C 17,34 27,34 32.5,37"      style="fill:none; stroke:#000000;" />  </g></g></g>'}),KingBlack:fn.define("chess.KingBlack",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path       d="M 22.5,11.63 L 22.5,6"       style="fill:none; stroke:#000000; stroke-linejoin:miter;"       id="path6570" />    <path       d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"       style="fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;" />    <path       d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "       style="fill:#000000; stroke:#000000;" />    <path       d="M 20,8 L 25,8"       style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path       d="M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37"       style="fill:none; stroke:#ffffff;" />  </g></g></g>'}),QueenWhite:fn.define("chess.QueenWhite",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(-1,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(15.5,-5.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(32,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(7,-4.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(24,-4)" />    <path      d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 11.5,30 C 15,29 30,29 33.5,30"      style="fill:none;" />    <path      d="M 12,33.5 C 18,32.5 27,32.5 33,33.5"      style="fill:none;" />  </g></g></g>'}),QueenBlack:fn.define("chess.QueenBlack",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:none;">      <circle cx="6"    cy="12" r="2.75" />      <circle cx="14"   cy="9"  r="2.75" />      <circle cx="22.5" cy="8"  r="2.75" />      <circle cx="31"   cy="9"  r="2.75" />      <circle cx="39"   cy="12" r="2.75" />    </g>    <path       d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z"       style="stroke-linecap:butt; stroke:#000000;" />    <path       d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z"       style="stroke-linecap:butt;" />    <path       d="M 11,38.5 A 35,35 1 0 0 34,38.5"       style="fill:none; stroke:#000000; stroke-linecap:butt;" />    <path       d="M 11,29 A 35,35 1 0 1 34,29"       style="fill:none; stroke:#ffffff;" />    <path       d="M 12.5,31.5 L 32.5,31.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,34.5 A 35,35 1 0 0 33.5,34.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 10.5,37.5 A 35,35 1 0 0 34.5,37.5"       style="fill:none; stroke:#ffffff;" />  </g></g></g>'}),RookWhite:fn.define("chess.RookWhite",{size:{width:32,height:34}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14"      style="stroke-linecap:butt;" />    <path      d="M 34,14 L 31,17 L 14,17 L 11,14" />    <path      d="M 31,17 L 31,29.5 L 14,29.5 L 14,17"      style="stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>'}),RookBlack:fn.define("chess.RookBlack",{size:{width:32,height:34}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z "      style="stroke-linecap:butt;stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z "      style="stroke-linecap:butt;" />    <path      d="M 12,35.5 L 33,35.5 L 33,35.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 13,31.5 L 32,31.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,29.5 L 31,29.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 31,16.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />  </g></g></g>'}),BishopWhite:fn.define("chess.BishopWhite",{size:{width:38,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#ffffff; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path      d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>'}),BishopBlack:fn.define("chess.BishopBlack",{size:{width:38,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path       d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"       style="fill:none; stroke:#ffffff; stroke-linejoin:miter;" />  </g></g></g>'}),KnightWhite:fn.define("chess.KnightWhite",{size:{width:38,height:37}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#000000; stroke:#000000;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#000000; stroke:#000000;" />  </g></g></g>'}),KnightBlack:fn.define("chess.KnightBlack",{size:{width:38,height:37}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#000000; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#000000; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z "      style="fill:#ffffff; stroke:none;" />  </g></g></g>'}),PawnWhite:fn.define("chess.PawnWhite",{size:{width:28,height:33}},{markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>'}),PawnBlack:fn.define("chess.PawnBlack",{size:{width:28,height:33}},{markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>'})},lr=Xe.define("erd.Entity",{size:{width:150,height:60},attrs:{".outer":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"100,0 100,60 0,60 0,0"},".inner":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"95,5 95,55 5,55 5,5",display:"none"},text:{text:"Entity","font-family":"Arial","font-size":14,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>'}),hr=lr.define("erd.WeakEntity",{attrs:{".inner":{display:"auto"},text:{text:"Weak Entity"}}}),cr=Xe.define("erd.Relationship",{size:{width:80,height:80},attrs:{".outer":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,0 80,40 40,80 0,40"},".inner":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,5 75,40 40,75 5,40",display:"none"},text:{text:"Relationship","font-family":"Arial","font-size":12,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>'}),ur=cr.define("erd.IdentifyingRelationship",{attrs:{".inner":{display:"auto"},text:{text:"Identifying"}}}),dr=Xe.define("erd.Attribute",{size:{width:100,height:50},attrs:{ellipse:{transform:"translate(50, 25)"},".outer":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:50,ry:25,fill:"#E67E22"},".inner":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:45,ry:20,fill:"#E67E22",display:"none"},text:{"font-family":"Arial","font-size":14,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse class="outer"/><ellipse class="inner"/></g><text/></g>'}),fr=dr.define("erd.Multivalued",{attrs:{".inner":{display:"block"},text:{text:"multivalued"}}}),pr=dr.define("erd.Derived",{attrs:{".outer":{"stroke-dasharray":"3,5"},text:{text:"derived"}}}),mr=dr.define("erd.Key",{attrs:{ellipse:{"stroke-width":4},text:{text:"key","font-weight":"800","text-decoration":"underline"}}}),gr=dr.define("erd.Normal",{attrs:{text:{text:"Normal"}}}),vr={Entity:lr,WeakEntity:hr,Relationship:cr,IdentifyingRelationship:ur,Attribute:dr,Multivalued:fr,Derived:pr,Key:mr,Normal:gr,ISA:Xe.define("erd.ISA",{type:"erd.ISA",size:{width:100,height:50},attrs:{polygon:{points:"0,0 50,50 100,0",fill:"#F1C40F",stroke:"#F39C12","stroke-width":2},text:{text:"ISA","font-size":18,"ref-x":.5,"ref-y":.3,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'}),Line:Ue.define("erd.Line",{},{cardinality:function(t){this.set("labels",[{position:-20,attrs:{text:{dy:-8,text:t}}}])}})},_r={State:vn.define("fsa.State",{attrs:{circle:{"stroke-width":3},text:{"font-weight":"800"}}}),StartState:Xe.define("fsa.StartState",{size:{width:20,height:20},attrs:{circle:{transform:"translate(10, 10)",r:10,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle/></g></g>'}),EndState:Xe.define("fsa.EndState",{size:{width:20,height:20},attrs:{".outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#000000"},".inner":{transform:"translate(10, 10)",r:6,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>'}),Arrow:Ue.define("fsa.Arrow",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}},smooth:!0})},yr={Member:Xe.define("org.Member",{size:{width:180,height:70},attrs:{rect:{width:170,height:60},".card":{fill:"#FFFFFF",stroke:"#000000","stroke-width":2,"pointer-events":"visiblePainted",rx:10,ry:10},image:{width:48,height:48,ref:".card","ref-x":10,"ref-y":5},".rank":{"text-decoration":"underline",ref:".card","ref-x":.9,"ref-y":.2,"font-family":"Courier New","font-size":14,"text-anchor":"end"},".name":{"font-weight":"800",ref:".card","ref-x":.9,"ref-y":.6,"font-family":"Courier New","font-size":14,"text-anchor":"end"}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="card"/><image/></g><text class="rank"/><text class="name"/></g>'}),Arrow:Ue.define("org.Arrow",{source:{selector:".card"},target:{selector:".card"},attrs:{".connection":{stroke:"#585858","stroke-width":3}},z:-1})},br={Place:fn.define("pn.Place",{size:{width:50,height:50},attrs:{".root":{r:25,fill:"#ffffff",stroke:"#000000",transform:"translate(25, 25)"},".label":{"text-anchor":"middle","ref-x":.5,"ref-y":-20,ref:".root",fill:"#000000","font-size":12},".tokens > circle":{fill:"#000000",r:5},".tokens.one > circle":{transform:"translate(25, 25)"},".tokens.two > circle:nth-child(1)":{transform:"translate(19, 25)"},".tokens.two > circle:nth-child(2)":{transform:"translate(31, 25)"},".tokens.three > circle:nth-child(1)":{transform:"translate(18, 29)"},".tokens.three > circle:nth-child(2)":{transform:"translate(25, 19)"},".tokens.three > circle:nth-child(3)":{transform:"translate(32, 29)"},".tokens.alot > text":{transform:"translate(25, 18)","text-anchor":"middle",fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="root"/><g class="tokens" /></g><text class="label"/></g>'}),PlaceView:$e.extend({presentationAttributes:$e.addPresentationAttributes({tokens:["TOKENS"]}),initFlag:$e.prototype.initFlag.concat(["TOKENS"]),confirmUpdate:function(){for(var t,e=[],i=arguments.length;i--;)e[i]=arguments[i];var n=(t=$e.prototype.confirmUpdate).call.apply(t,[this].concat(e));return this.hasFlag(n,"TOKENS")&&(this.renderTokens(),this.update(),n=this.removeFlag(n,"TOKENS")),n},renderTokens:function(){var t=this.vel.findOne(".tokens").empty();["one","two","three","alot"].forEach((function(e){t.removeClass(e)}));var e=this.model.get("tokens");if(e)switch(e){case 1:t.addClass("one"),t.append($("circle"));break;case 2:t.addClass("two"),t.append([$("circle"),$("circle")]);break;case 3:t.addClass("three"),t.append([$("circle"),$("circle"),$("circle")]);break;default:t.addClass("alot"),t.append($("text").text(e+""))}}}),Transition:fn.define("pn.Transition",{size:{width:12,height:50},attrs:{rect:{width:12,height:50,fill:"#000000",stroke:"#000000"},".label":{"text-anchor":"middle","ref-x":.5,"ref-y":-20,ref:"rect",fill:"#000000","font-size":12}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="root"/></g></g><text class="label"/>'}),Link:Ue.define("pn.Link",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}}})},xr=fn.define("uml.Class",{attrs:{rect:{width:200},".uml-class-name-rect":{stroke:"black","stroke-width":2,fill:"#3498db"},".uml-class-attrs-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-methods-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-name-text":{ref:".uml-class-name-rect","ref-y":.5,"ref-x":.5,"text-anchor":"middle","y-alignment":"middle","font-weight":"bold",fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-attrs-text":{ref:".uml-class-attrs-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-methods-text":{ref:".uml-class-methods-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"}},name:[],attributes:[],methods:[]},{markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-class-name-rect"/><rect class="uml-class-attrs-rect"/><rect class="uml-class-methods-rect"/>',"</g>",'<text class="uml-class-name-text"/><text class="uml-class-attrs-text"/><text class="uml-class-methods-text"/>',"</g>"].join(""),initialize:function(){this.on("change:name change:attributes change:methods",(function(){this.updateRectangles(),this.trigger("uml-update")}),this),this.updateRectangles(),fn.prototype.initialize.apply(this,arguments)},getClassName:function(){return this.get("name")},updateRectangles:function(){var t=this.get("attrs"),e=[{type:"name",text:this.getClassName()},{type:"attrs",text:this.get("attributes")},{type:"methods",text:this.get("methods")}],i=0;e.forEach((function(e){var n=Array.isArray(e.text)?e.text:[e.text],r=20*n.length+20;t[".uml-class-"+e.type+"-text"].text=n.join("\n"),t[".uml-class-"+e.type+"-rect"].height=r,t[".uml-class-"+e.type+"-rect"].transform="translate(0,"+i+")",i+=r}))}}),wr=$e.extend({initialize:function(){$e.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"uml-update",(function(){this.update(),this.resize()}))}}),Ar=xr.define("uml.Abstract",{attrs:{".uml-class-name-rect":{fill:"#e74c3c"},".uml-class-attrs-rect":{fill:"#c0392b"},".uml-class-methods-rect":{fill:"#c0392b"}}},{getClassName:function(){return["<<Abstract>>",this.get("name")]}}),Cr=wr,Ir=xr.define("uml.Interface",{attrs:{".uml-class-name-rect":{fill:"#f1c40f"},".uml-class-attrs-rect":{fill:"#f39c12"},".uml-class-methods-rect":{fill:"#f39c12"}}},{getClassName:function(){return["<<Interface>>",this.get("name")]}}),Sr={basic:Mn,standard:Vn,devs:Hn,logic:ar,chess:or,erd:vr,fsa:_r,org:yr,pn:br,uml:{Class:xr,ClassView:wr,Abstract:Ar,AbstractView:Cr,Interface:Ir,InterfaceView:wr,Generalization:Ue.define("uml.Generalization",{attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"}}}),Implementation:Ue.define("uml.Implementation",{attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"},".connection":{"stroke-dasharray":"3,3"}}}),Aggregation:Ue.define("uml.Aggregation",{attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"white"}}}),Composition:Ue.define("uml.Composition",{attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"black"}}}),Association:Ue.define("uml.Association"),State:fn.define("uml.State",{attrs:{".uml-state-body":{width:200,height:200,rx:10,ry:10,fill:"#ecf0f1",stroke:"#bdc3c7","stroke-width":3},".uml-state-separator":{stroke:"#bdc3c7","stroke-width":2},".uml-state-name":{ref:".uml-state-body","ref-x":.5,"ref-y":5,"text-anchor":"middle",fill:"#000000","font-family":"Courier New","font-size":14},".uml-state-events":{ref:".uml-state-separator","ref-x":5,"ref-y":5,fill:"#000000","font-family":"Courier New","font-size":14}},name:"State",events:[]},{markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-state-body"/>',"</g>",'<path class="uml-state-separator"/>','<text class="uml-state-name"/>','<text class="uml-state-events"/>',"</g>"].join(""),initialize:function(){this.on({"change:name":this.updateName,"change:events":this.updateEvents,"change:size":this.updatePath},this),this.updateName(),this.updateEvents(),this.updatePath(),fn.prototype.initialize.apply(this,arguments)},updateName:function(){this.attr(".uml-state-name/text",this.get("name"))},updateEvents:function(){this.attr(".uml-state-events/text",this.get("events").join("\n"))},updatePath:function(){var t="M 0 20 L "+this.get("size").width+" 20";this.attr(".uml-state-separator/d",t,{silent:!0})}}),StartState:vn.define("uml.StartState",{type:"uml.StartState",attrs:{circle:{fill:"#34495e",stroke:"#2c3e50","stroke-width":2,rx:1}}}),EndState:fn.define("uml.EndState",{size:{width:20,height:20},attrs:{"circle.outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#2c3e50"},"circle.inner":{transform:"translate(10, 10)",r:6,fill:"#34495e"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>'}),Transition:Ue.define("uml.Transition",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#34495e",stroke:"#2c3e50"},".connection":{stroke:"#2c3e50"}}})}};function Mr(t,e){return 0===e?"0%":Math.round(t/e*100)+"%"}function Tr(t){return function(e,i,n,r){return(i.isNodeConnection(n)?Er:Pr)(t,e,i,n,r)}}function Pr(t,e,i,n,r){var s=i.model.angle(),a=i.getNodeUnrotatedBBox(n),o=i.model.getBBox().center();r.rotate(o,s);var l=r.x-a.x,h=r.y-a.y;return t&&(l=Mr(l,a.width),h=Mr(h,a.height)),e.anchor={name:"topLeft",args:{dx:l,dy:h,rotate:!0}},e}function Er(t,e,i,n,r){var s=i.getConnection();if(!s)return e;var a=s.closestPointLength(r);if(t){var o=s.length();e.anchor={name:"connectionRatio",args:{ratio:a/o}}}else e.anchor={name:"connectionLength",args:{length:a}};return e}var kr=ue,Dr=Tr(!1),Or=Tr(!0),Rr={useDefaults:kr,pinAbsolute:Dr,pinRelative:Or};function Lr(t,e,i){return Or.call(this.paper,{},e,i,t,this.model).anchor}function Nr(t,e){var i=t.model;return e?i.getBBox():i.isLink()?t.getConnection().bbox():t.getNodeUnrotatedBBox(t.el)}var zr=Ke.extend({tagName:"circle",svgElement:!0,className:"marker-vertex",events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onDoubleClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},attributes:{r:6,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move"},position:function(t,e){this.vel.attr({cx:t,cy:e})},onPointerDown:function(t){this.options.guard(t)||(t.stopPropagation(),t.preventDefault(),this.options.paper.undelegateEvents(),this.delegateDocumentEvents(null,t.data),this.trigger("will-change",this,t))},onPointerMove:function(t){this.trigger("changing",this,t)},onDoubleClick:function(t){this.trigger("remove",this,t)},onPointerUp:function(t){this.trigger("changed",this,t),this.undelegateDocumentEvents(),this.options.paper.delegateEvents()}}),Br=ln.extend({name:"vertices",options:{handleClass:zr,snapRadius:20,redundancyRemoval:!0,vertexAdding:!0,stopPropagation:!0},children:[{tagName:"path",selector:"connection",className:"joint-vertices-path",attributes:{fill:"none",stroke:"transparent","stroke-width":10,cursor:"cell"}}],handles:null,events:{"mousedown .joint-vertices-path":"onPathPointerDown","touchstart .joint-vertices-path":"onPathPointerDown"},onRender:function(){return this.options.vertexAdding&&(this.renderChildren(),this.updatePath()),this.resetHandles(),this.renderHandles(),this},update:function(){return this.relatedView.model.vertices().length===this.handles.length?this.updateHandles():(this.resetHandles(),this.renderHandles()),this.options.vertexAdding&&this.updatePath(),this},resetHandles:function(){var t=this.handles;if(this.handles=[],this.stopListening(),Array.isArray(t))for(var e=0,i=t.length;e<i;e++)t[e].remove()},renderHandles:function(){for(var t=this,e=this.relatedView.model.vertices(),i=0,n=e.length;i<n;i++){var r=e[i],s=new this.options.handleClass({index:i,paper:this.paper,guard:function(e){return t.guard(e)}});s.render(),s.position(r.x,r.y),this.simulateRelatedView(s.el),s.vel.appendTo(this.el),this.handles.push(s),this.startHandleListening(s)}},updateHandles:function(){for(var t=this.relatedView.model.vertices(),e=0,i=t.length;e<i;e++){var n=t[e],r=this.handles[e];if(!r)return;r.position(n.x,n.y)}},updatePath:function(){var t=this.childNodes.connection;t&&t.setAttribute("d",this.relatedView.getSerializedConnection())},startHandleListening:function(t){var e=this.relatedView;e.can("vertexMove")&&(this.listenTo(t,"will-change",this.onHandleWillChange),this.listenTo(t,"changing",this.onHandleChanging),this.listenTo(t,"changed",this.onHandleChanged)),e.can("vertexRemove")&&this.listenTo(t,"remove",this.onHandleRemove)},getNeighborPoints:function(t){var e=this.relatedView,i=e.model.vertices(),n=0<t?i[t-1]:e.sourceAnchor,r=t<i.length-1?i[t+1]:e.targetAnchor;return{prev:new S(n),next:new S(r)}},onHandleWillChange:function(t,e){this.focus();var i=this.relatedView,n=this.options;i.model.startBatch("vertex-move",{ui:!0,tool:this.cid}),n.stopPropagation||i.notifyPointerdown.apply(i,i.paper.getPointerArgs(e))},onHandleChanging:function(t,e){var i=this.options,n=this.relatedView,r=t.options.index,s=n.paper.getPointerArgs(e),a=s[0],o=s[1],l=s[2],h={x:o,y:l};this.snapVertex(h,r),n.model.vertex(r,h,{ui:!0,tool:this.cid}),t.position(h.x,h.y),i.stopPropagation||n.notifyPointermove(a,o,l)},onHandleChanged:function(t,e){var i=this.options,n=this.relatedView;if(i.vertexAdding&&this.updatePath(),i.redundancyRemoval){n.removeRedundantLinearVertices({ui:!0,tool:this.cid})&&this.render(),this.blur(),n.model.stopBatch("vertex-move",{ui:!0,tool:this.cid}),this.eventData(e).vertexAdded&&n.model.stopBatch("vertex-add",{ui:!0,tool:this.cid});var r=n.paper.getPointerArgs(e),s=r[0],a=r[1],o=r[2];i.stopPropagation||n.notifyPointerup(s,a,o),n.checkMouseleave(s)}},snapVertex:function(t,e){var i=this.options.snapRadius;if(0<i){var n=this.getNeighborPoints(e),r=n.prev,s=n.next;Math.abs(t.x-r.x)<i?t.x=r.x:Math.abs(t.x-s.x)<i&&(t.x=s.x),Math.abs(t.y-r.y)<i?t.y=n.prev.y:Math.abs(t.y-s.y)<i&&(t.y=s.y)}},onHandleRemove:function(t,e){var i=t.options.index,n=this.relatedView;n.model.removeVertex(i,{ui:!0}),this.options.vertexAdding&&this.updatePath(),n.checkMouseleave(ut(e))},onPathPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=ut(t),i=this.paper.snapToGrid(e.clientX,e.clientY).toJSON(),n=this.relatedView;n.model.startBatch("vertex-add",{ui:!0,tool:this.cid});var r=n.getVertexIndex(i.x,i.y);this.snapVertex(i,r),n.model.insertVertex(r,i,{ui:!0,tool:this.cid}),this.render();var s=this.handles[r];this.eventData(e,{vertexAdded:!0}),s.onPointerDown(e)}},onRemove:function(){this.resetHandles()}},{VertexHandle:zr}),Fr=Ke.extend({tagName:"g",svgElement:!0,className:"marker-segment",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},children:[{tagName:"line",selector:"line",attributes:{stroke:"#33334F","stroke-width":2,fill:"none","pointer-events":"none"}},{tagName:"rect",selector:"handle",attributes:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2}}],onRender:function(){this.renderChildren()},position:function(t,e,i,n){var r=$.createSVGMatrix().translate(t,e).rotate(i),s=this.childNodes.handle;s.setAttribute("transform",$.matrixToTransformString(r)),s.setAttribute("cursor",i%180==0?"row-resize":"col-resize");var a=n.getClosestPoint(new S(t,e)),o=this.childNodes.line;o.setAttribute("x1",t),o.setAttribute("y1",e),o.setAttribute("x2",a.x),o.setAttribute("y2",a.y)},onPointerDown:function(t){this.options.guard(t)||(this.trigger("change:start",this,t),t.stopPropagation(),t.preventDefault(),this.options.paper.undelegateEvents(),this.delegateDocumentEvents(null,t.data))},onPointerMove:function(t){this.trigger("changing",this,t)},onPointerUp:function(t){this.undelegateDocumentEvents(),this.options.paper.delegateEvents(),this.trigger("change:end",this,t)},show:function(){this.el.style.display=""},hide:function(){this.el.style.display="none"}}),jr=ln.extend({name:"segments",precision:.5,options:{handleClass:Fr,segmentLengthThreshold:40,redundancyRemoval:!0,anchor:Lr,snapRadius:10,snapHandle:!0,stopPropagation:!0},handles:null,onRender:function(){this.resetHandles();var t=this.relatedView,e=t.model.vertices();e.unshift(t.sourcePoint),e.push(t.targetPoint);for(var i=0,n=e.length;i<n-1;i++){var r=e[i],s=e[i+1],a=this.renderHandle(r,s);this.simulateRelatedView(a.el),this.handles.push(a),a.options.index=i}return this},renderHandle:function(t,e){var i=this,n=new this.options.handleClass({paper:this.paper,guard:function(t){return i.guard(t)}});return n.render(),this.updateHandle(n,t,e),n.vel.appendTo(this.el),this.startHandleListening(n),n},update:function(){return this.render(),this},startHandleListening:function(t){this.listenTo(t,"change:start",this.onHandleChangeStart),this.listenTo(t,"changing",this.onHandleChanging),this.listenTo(t,"change:end",this.onHandleChangeEnd)},resetHandles:function(){var t=this.handles;if(this.handles=[],this.stopListening(),Array.isArray(t))for(var e=0,i=t.length;e<i;e++)t[e].remove()},shiftHandleIndexes:function(t){for(var e=this.handles,i=0,n=e.length;i<n;i++)e[i].options.index+=t},resetAnchor:function(t,e){var i=this.relatedView.model;e?i.prop([t,"anchor"],e,{rewrite:!0,ui:!0,tool:this.cid}):i.removeProp([t,"anchor"],{ui:!0,tool:this.cid})},snapHandle:function(t,e,i){var n=t.options.index,r=this.relatedView.model.vertices(),s=t.options.axis,a=r[n-2]||i.sourceAnchor,o=r[n+1]||i.targetAnchor,l=this.options.snapRadius;return Math.abs(e[s]-a[s])<l?e[s]=a[s]:Math.abs(e[s]-o[s])<l&&(e[s]=o[s]),e},onHandleChanging:function(t,e){var i=this.options,n=this.eventData(e),r=this.relatedView,s=r.paper,a=t.options.index-1,o=ut(e),l=s.snapToGrid(o.clientX,o.clientY),h=this.snapHandle(t,l.clone(),n),c=t.options.axis,u=this.options.snapHandle?0:l[c]-h[c],d=r.model,f=Bt(d.vertices()),p=f[a],m=f[a+1],g=this.options.anchor;"function"!=typeof g&&(g=null);var v=r.sourceView,_=r.sourceBBox,y=!1,b=!1;if(p?0===a?_.containsPoint(p)?(f.shift(),this.shiftHandleIndexes(-1),y=!0):(p[c]=h[c],b=!0):p[c]=h[c]:((p=r.sourceAnchor.toJSON())[c]=h[c],_.containsPoint(p)?(p[c]=h[c],y=!0):(f.unshift(p),this.shiftHandleIndexes(1),b=!0)),g&&v){if(y){var x=n.sourceAnchor.clone();x[c]=h[c];var w=g.call(r,x,v,r.sourceMagnet||v.el,"source",r);this.resetAnchor("source",w)}b&&this.resetAnchor("source",n.sourceAnchorDef)}var A=r.targetView,C=r.targetBBox,I=!1,S=!1;if(m?a===f.length-2?C.containsPoint(m)?(f.pop(),I=!0):(m[c]=h[c],S=!0):m[c]=h[c]:((m=r.targetAnchor.toJSON())[c]=h[c],C.containsPoint(m)?I=!0:(f.push(m),S=!0)),g&&A){if(I){var M=n.targetAnchor.clone();M[c]=h[c];var T=g.call(r,M,A,r.targetMagnet||A.el,"target",r);this.resetAnchor("target",T)}S&&this.resetAnchor("target",n.targetAnchorDef)}d.vertices(f,{ui:!0,tool:this.cid}),this.updateHandle(t,p,m,u),i.stopPropagation||r.notifyPointermove(o,l.x,l.y)},onHandleChangeStart:function(t,e){var i=this.options,n=this.handles,r=this.relatedView,s=r.model,a=r.paper,o=t.options.index;if(Array.isArray(n)){for(var l=0,h=n.length;l<h;l++)l!==o&&n[l].hide();this.focus(),this.eventData(e,{sourceAnchor:r.sourceAnchor.clone(),targetAnchor:r.targetAnchor.clone(),sourceAnchorDef:zt(s.prop(["source","anchor"])),targetAnchorDef:zt(s.prop(["target","anchor"]))}),s.startBatch("segment-move",{ui:!0,tool:this.cid}),i.stopPropagation||r.notifyPointerdown.apply(r,a.getPointerArgs(e))}},onHandleChangeEnd:function(t,e){var i=this.options,n=this.relatedView,r=n.paper,s=n.model;i.redundancyRemoval&&n.removeRedundantLinearVertices({ui:!0,tool:this.cid});var a=ut(e),o=r.snapToGrid(a.clientX,a.clientY);this.render(),this.blur(),s.stopBatch("segment-move",{ui:!0,tool:this.cid}),i.stopPropagation||n.notifyPointerup(a,o.x,o.y),n.checkMouseleave(a)},updateHandle:function(t,e,i,n){var r=Math.abs(e.x-i.x)<this.precision,s=Math.abs(e.y-i.y)<this.precision;if(r||s){var a=new C(e,i);if(a.length()<this.options.segmentLengthThreshold)t.hide();else{var o=a.midpoint(),l=r?"x":"y";o[l]+=n||0;var h=a.vector().vectorAngle(new S(1,0));t.position(o.x,o.y,h,this.relatedView),t.show(),t.options.axis=l}}else t.hide()},onRemove:function(){this.resetHandles()}},{SegmentHandle:Fr}),Vr=ln.extend({tagName:"path",xAxisVector:new S(1,0),events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},onRender:function(){this.update()},update:function(){var t,e,i=this.ratio,n=this.relatedView,r=n.getTangentAtRatio(i);if(e=r?(t=r.start,r.vector().vectorAngle(this.xAxisVector)||0):(t=n.getPointAtRatio(i),0),!t)return this;var s=$.createSVGMatrix().translate(t.x,t.y).rotate(e);return this.vel.transform(s,{absolute:!0}),this},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=this.relatedView;e.model.startBatch("arrowhead-move",{ui:!0,tool:this.cid}),e.can("arrowheadMove")&&(e.startArrowheadMove(this.arrowheadType),this.delegateDocumentEvents(),e.paper.undelegateEvents()),this.focus(),this.el.style.pointerEvents="none"}},onPointerMove:function(t){var e=ut(t),i=this.paper.snapToGrid(e.clientX,e.clientY);this.relatedView.pointermove(e,i.x,i.y)},onPointerUp:function(t){this.undelegateDocumentEvents();var e=this.relatedView,i=e.paper,n=ut(t),r=i.snapToGrid(n.clientX,n.clientY);e.pointerup(n,r.x,r.y),i.delegateEvents(),this.blur(),this.el.style.pointerEvents="",e.model.stopBatch("arrowhead-move",{ui:!0,tool:this.cid})}}),Ur=Vr.extend({name:"target-arrowhead",ratio:1,arrowheadType:"target",attributes:{d:"M -10 -8 10 0 -10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"target-arrowhead"}}),Gr=Vr.extend({name:"source-arrowhead",ratio:0,arrowheadType:"source",attributes:{d:"M 10 -8 -10 0 10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"source-arrowhead"}}),Wr=ln.extend({name:"button",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},options:{distance:0,offset:0,rotate:!1},onRender:function(){this.renderChildren(this.options.markup),this.update()},update:function(){return this.position(),this},position:function(){var t=this.relatedView,e=this.vel,i=t.model.isLink()?this.getLinkMatrix():this.getElementMatrix();e.transform(i,{absolute:!0})},getElementMatrix:function(){var t=this.relatedView,e=this.options,i=e.x;void 0===i&&(i=0);var n=e.y;void 0===n&&(n=0);var r=e.offset;void 0===r&&(r={});var s=e.useModelGeometry,a=e.rotate,o=Nr(t,s),l=t.model.angle();a||(o=o.bbox(l));var h=r.x;void 0===h&&(h=0);var c=r.y;void 0===c&&(c=0),pt(i)&&(i=parseFloat(i)/100*o.width),pt(n)&&(n=parseFloat(n)/100*o.height);var u=$.createSVGMatrix().translate(o.x+o.width/2,o.y+o.height/2);return a&&(u=u.rotate(l)),u.translate(i+h-o.width/2,n+c-o.height/2)},getLinkMatrix:function(){var t=this.relatedView,e=this.options,i=e.offset;void 0===i&&(i=0);var n=e.distance;void 0===n&&(n=0);var r,s,a,o=e.rotate;a=(r=pt(n)?t.getTangentAtRatio(parseFloat(n)/100):t.getTangentAtLength(n))?(s=r.start,r.vector().vectorAngle(new S(1,0))||0):(s=t.getConnection().start,0);var l=$.createSVGMatrix().translate(s.x,s.y).rotate(a).translate(0,i);return o||(l=l.rotate(-a)),l},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=this.options.action;"function"==typeof e&&e.call(this.relatedView,t,this.relatedView,this)}}}),Hr=Wr.extend({children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],options:{distance:60,offset:0,action:function(t,e,i){e.model.remove({ui:!0,tool:i.cid})}}}),Xr=ln.extend({name:"boundary",tagName:"rect",options:{padding:10,useModelGeometry:!1},attributes:{fill:"none",stroke:"#33334F","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"},onRender:function(){this.update()},update:function(){var t=this.relatedView,e=this.options,i=this.vel,n=e.useModelGeometry,r=e.rotate,s=xt(e.padding),a=Nr(t,n).moveAndExpand({x:-s.left,y:-s.top,width:s.left+s.right,height:s.top+s.bottom}),o=t.model;if(o.isElement()){var l=o.angle();if(l)if(r){var h=o.getBBox().center();i.rotate(l,h.x,h.y,{absolute:!0})}else a=a.bbox(l)}return i.attr(a.toJSON()),this}}),Zr=ln.extend({tagName:"g",type:null,children:[{tagName:"circle",selector:"anchor",attributes:{cursor:"pointer"}},{tagName:"rect",selector:"area",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{snap:function(t,e,i,n,r,s){var a=s.options.snapRadius,o="source"===n,l=o?0:-1,h=this.model.vertex(l)||this.getEndAnchor(o?"target":"source");return h&&(Math.abs(h.x-t.x)<a&&(t.x=h.x),Math.abs(h.y-t.y)<a&&(t.y=h.y)),t},anchor:Lr,resetAnchor:!0,customAnchorAttributes:{"stroke-width":4,stroke:"#33334F",fill:"#FFFFFF",r:5},defaultAnchorAttributes:{"stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6},areaPadding:6,snapRadius:10,restrictArea:!0,redundancyRemoval:!0},onRender:function(){this.renderChildren(),this.toggleArea(!1),this.update()},update:function(){var t=this.type,e=this.relatedView.getEndView(t);return this.el.style.display=e?(this.updateAnchor(),this.updateArea(),""):"none",this},updateAnchor:function(){var t=this.childNodes;if(t){var e=t.anchor;if(e){var i=this.relatedView,n=this.type,r=i.getEndAnchor(n),s=this.options,a=i.model.prop([n,"anchor"]);e.setAttribute("transform","translate("+r.x+","+r.y+")");var o=a?s.customAnchorAttributes:s.defaultAnchorAttributes;for(var l in o)e.setAttribute(l,o[l])}}},updateArea:function(){var t=this.childNodes;if(t){var e=t.area;if(e){var i,n,r,s=this.relatedView,a=this.type,o=s.getEndView(a),l=o.model,h=s.getEndMagnet(a),c=this.options.areaPadding;isFinite(c)||(c=0),o.isNodeConnection(h)?(n=0,r=(i=o.getBBox()).center()):(i=o.getNodeUnrotatedBBox(h),n=l.angle(),r=i.center(),n&&r.rotate(l.getBBox().center(),-n)),i.inflate(c),e.setAttribute("x",-i.width/2),e.setAttribute("y",-i.height/2),e.setAttribute("width",i.width),e.setAttribute("height",i.height),e.setAttribute("transform","translate("+r.x+","+r.y+") rotate("+n+")")}}},toggleArea:function(t){this.childNodes.area.style.display=t?"":"none"},onPointerDown:function(t){this.guard(t)||(t.stopPropagation(),t.preventDefault(),this.paper.undelegateEvents(),this.delegateDocumentEvents(),this.focus(),this.toggleArea(this.options.restrictArea),this.relatedView.model.startBatch("anchor-move",{ui:!0,tool:this.cid}))},resetAnchor:function(t){var e=this.type,i=this.relatedView.model;t?i.prop([e,"anchor"],t,{rewrite:!0,ui:!0,tool:this.cid}):i.removeProp([e,"anchor"],{ui:!0,tool:this.cid})},onPointerMove:function(t){var e,i=this.relatedView,n=this.type,r=i.getEndView(n),s=r.model,a=i.getEndMagnet(n),o=ut(t),l=this.paper.clientToLocalPoint(o.clientX,o.clientY),h=this.options.snap;if("function"==typeof h&&(l=h.call(i,l,r,a,n,i,this),l=new S(l)),this.options.restrictArea)if(r.isNodeConnection(a)){var c=r.getClosestPoint(l);c&&(l=c)}else{var u=r.getNodeUnrotatedBBox(a),d=s.angle(),f=s.getBBox().center(),p=l.clone().rotate(f,d);u.containsPoint(p)||(l=u.pointNearestToPoint(p).rotate(f,-d))}var m=this.options.anchor;"function"==typeof m&&(e=m.call(i,l,r,a,n,i)),this.resetAnchor(e),this.update()},onPointerUp:function(t){this.paper.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleArea(!1);var e=this.relatedView;this.options.redundancyRemoval&&e.removeRedundantLinearVertices({ui:!0,tool:this.cid}),e.model.stopBatch("anchor-move",{ui:!0,tool:this.cid})},onPointerDblClick:function(){var t=this.options.resetAnchor;!1!==t&&(!0===t&&(t=null),this.resetAnchor(Bt(t)),this.update())}}),Yr={Vertices:Br,Segments:jr,SourceArrowhead:Gr,TargetArrowhead:Ur,SourceAnchor:Zr.extend({name:"source-anchor",type:"source"}),TargetAnchor:Zr.extend({name:"target-anchor",type:"target"}),Button:Wr,Remove:Hr,Boundary:Xr},qr={Button:Wr,Remove:Hr,Boundary:Xr},Kr=$,Jr={DirectedGraph:un,PortLabel:Ve,Port:Le};t.V=$,t.Vectorizer=Kr,t.anchors=nn,t.config=tt,t.connectionPoints=tn,t.connectionStrategies=Rr,t.connectors=Vi,t.dia=cn,t.elementTools=qr,t.env=dn,t.format={},t.g=Q,t.highlighters=Gi,t.layout=Jr,t.linkAnchors=Yi,t.linkTools=Yr,t.mvc=Je,t.routers=Ri,t.setTheme=function(t,e){Rt(qe,"setTheme",t,e=e||{}),Ke.prototype.defaultTheme=t},t.shapes=Sr,t.ui={},t.util=Ee,t.version="3.2.0",Object.defineProperty(t,"__esModule",{value:!0})})),"undefined"!=typeof joint)joint.g,joint.V,joint.V},function(t,e,i){(function(t){var i,n,r,s;function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}window,s=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===a(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=36)}([function(t,e,i){"use strict";i.d(e,"g",(function(){return n})),i.d(e,"k",(function(){return r})),i.d(e,"l",(function(){return s})),i.d(e,"q",(function(){return a})),i.d(e,"p",(function(){return o})),i.d(e,"o",(function(){return l})),i.d(e,"d",(function(){return h})),i.d(e,"b",(function(){return c})),i.d(e,"a",(function(){return u})),i.d(e,"h",(function(){return d})),i.d(e,"m",(function(){return f})),i.d(e,"e",(function(){return p})),i.d(e,"f",(function(){return m})),i.d(e,"n",(function(){return g})),i.d(e,"c",(function(){return v})),i.d(e,"j",(function(){return _})),i.d(e,"i",(function(){return y}));var n="pcui-flex",r="pcui-grid",s="pcui-hidden",a="pcui-scrollable",o="pcui-resizable",l="pcui-readonly",h="pcui-disabled",c="pcui-collapsible",u="pcui-collapsed",d="pcui-focus",f="pcui-multiple-values",p="pcui-error",m="flash",g="pcui-not-flexible",v="pcui-default-mousedown",_="font-regular",y="font-bold"},function(t,e,i){"use strict";var n=i(0),r=i(4);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=u(t);if(e){var r=u(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return h(this,i)}}function h(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?c(t):e}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=["flexDirection","flexGrow","flexBasis","flexShrink","flexWrap","alignItems","alignSelf","justifyContent","justifySelf"],f={},p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(h,t);var e,i,r,s=l(h);function h(t,e){var i;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),e||(e={}),(i=s.call(this))._destroyed=!1,i._parent=null,i._domEventClick=i._onClick.bind(c(i)),i._domEventMouseOver=i._onMouseOver.bind(c(i)),i._domEventMouseOut=i._onMouseOut.bind(c(i)),i._eventsParent=[],i._dom=t||e.dom||document.createElement("div"),void 0!==e.id&&(i._dom.id=e.id),i._dom.ui=c(i),i._dom.addEventListener("click",i._domEventClick),i._dom.addEventListener("mouseover",i._domEventMouseOver),i._dom.addEventListener("mouseout",i._domEventMouseOut),i._dom.classList.add("pcui-element"),i._dom.classList.add(n.j),e.class)if(Array.isArray(e.class))for(var r=0;r<e.class.length;r++)i._dom.classList.add(e.class[r]);else i._dom.classList.add(e.class);for(var a in i.enabled=void 0===e.enabled||e.enabled,i._hiddenParents=!e.isRoot,i.hidden=e.hidden||!1,i.readOnly=e.readOnly||!1,i.ignoreParent=e.ignoreParent||!1,void 0!==e.width&&(i.width=e.width),void 0!==e.height&&(i.height=e.height),void 0!==e.tabIndex&&(i.tabIndex=e.tabIndex),e)void 0!==e[a]&&-1!==d.indexOf(a)&&(i[a]=e[a]);return e.binding&&(i.binding=e.binding),i._flashTimeout=null,i}return e=h,r=[{key:"register",value:function(t,e,i){f[t]={cls:e,defaultArguments:i}}},{key:"unregister",value:function(t){delete f[t]}},{key:"create",value:function(t,e){var i=f[t];if(i){var n=i.cls,r={};return i.defaultArguments&&Object.assign(r,i.defaultArguments),e&&Object.assign(r,e),new n(r)}console.error("Invalid type passed to pcui.Element#create",t)}}],(i=[{key:"link",value:function(t,e){this._binding&&this._binding.link(t,e)}},{key:"unlink",value:function(){this._binding&&this._binding.unlink()}},{key:"flash",value:function(){this._flashTimeout||(this.classAdd(n.f),this._flashTimeout=setTimeout(function(){this._flashTimeout=null,this.classRemove(n.f)}.bind(this),200))}},{key:"_onClick",value:function(t){this.enabled&&this.emit("click",t)}},{key:"_onMouseOver",value:function(t){this.emit("hover",t)}},{key:"_onMouseOut",value:function(t){this.emit("hoverend",t)}},{key:"_onHiddenToRootChange",value:function(t){t?this.emit("hideToRoot"):this.emit("showToRoot")}},{key:"_onEnabledChange",value:function(t){t?this.classRemove(n.d):this.classAdd(n.d),this.emit(t?"enable":"disable")}},{key:"_onParentDestroy",value:function(){this.destroy()}},{key:"_onParentDisable",value:function(){this._ignoreParent||this._enabled&&this._onEnabledChange(!1)}},{key:"_onParentEnable",value:function(){this._ignoreParent||this._enabled&&this._onEnabledChange(!0)}},{key:"_onParentShowToRoot",value:function(){var t=this.hiddenToRoot;this._hiddenParents=!1,t!==this.hiddenToRoot&&this._onHiddenToRootChange(this.hiddenToRoot)}},{key:"_onParentHideToRoot",value:function(){var t=this.hiddenToRoot;this._hiddenParents=!0,t!==this.hiddenToRoot&&this._onHiddenToRootChange(this.hiddenToRoot)}},{key:"_onReadOnlyChange",value:function(t){t?this.classAdd(n.o):this.classRemove(n.o),this.emit("readOnly",t)}},{key:"_onParentReadOnlyChange",value:function(t){this._ignoreParent||(t?this._readOnly||this._onReadOnlyChange(!0):this._readOnly||this._onReadOnlyChange(!1))}},{key:"classAdd",value:function(t){var e=this._dom.classList;e.contains(t)||e.add(t)}},{key:"classRemove",value:function(t){var e=this._dom.classList;e.contains(t)&&e.remove(t)}},{key:"destroy",value:function(){if(!this._destroyed){if(this._destroyed=!0,this.binding?this.binding=null:this.unlink(),this.parent){for(var t=this.parent,e=0;e<this._eventsParent.length;e++)this._eventsParent[e].unbind();this._eventsParent.length=0,t.remove&&!t._destroyed&&t.remove(this),this._parent=null,!t._destroyed&&this._dom&&this._dom.parentElement&&this._dom.parentElement.removeChild(this._dom)}var i=this._dom;i&&(i.removeEventListener("click",this._domEventClick),i.removeEventListener("mouseover",this._domEventMouseOver),i.removeEventListener("mouseout",this._domEventMouseOut),delete i.ui,this._dom=null),this._domEventClick=null,this._domEventMouseOver=null,this._domEventMouseOut=null,this._flashTimeout&&clearTimeout(this._flashTimeout),this.emit("destroy",i,this),this.unbind()}}},{key:"enabled",get:function(){return this._ignoreParent?this._enabled:this._enabled&&(!this._parent||this._parent.enabled)},set:function(t){if(this._enabled!==t){var e=this.enabled;this._enabled=t,e!==t&&this._onEnabledChange(t)}}},{key:"ignoreParent",get:function(){return this._ignoreParent},set:function(t){this._ignoreParent=t,this._onEnabledChange(this.enabled),this._onReadOnlyChange(this.readOnly)}},{key:"dom",get:function(){return this._dom}},{key:"parent",get:function(){return this._parent},set:function(t){if(t!==this._parent){var e=this.enabled,i=this.readOnly,n=this.hiddenToRoot;if(this._parent){for(var r=0;r<this._eventsParent.length;r++)this._eventsParent[r].unbind();this._eventsParent.length=0}this._parent=t,this._parent?(this._eventsParent.push(this._parent.once("destroy",this._onParentDestroy.bind(this))),this._eventsParent.push(this._parent.on("disable",this._onParentDisable.bind(this))),this._eventsParent.push(this._parent.on("enable",this._onParentEnable.bind(this))),this._eventsParent.push(this._parent.on("readOnly",this._onParentReadOnlyChange.bind(this))),this._eventsParent.push(this._parent.on("showToRoot",this._onParentShowToRoot.bind(this))),this._eventsParent.push(this._parent.on("hideToRoot",this._onParentHideToRoot.bind(this))),this._hiddenParents=this._parent.hiddenToRoot):this._hiddenParents=!0,this.emit("parent",this._parent);var s=this.enabled;s!==e&&this._onEnabledChange(s);var a=this.readOnly;a!==i&&this._onReadOnlyChange(a);var o=this.hiddenToRoot;o!==n&&this._onHiddenToRootChange(o)}}},{key:"hidden",get:function(){return this._hidden},set:function(t){if(t!==this._hidden){var e=this.hiddenToRoot;this._hidden=t,t?this.classAdd(n.l):this.classRemove(n.l),this.emit(t?"hide":"show"),this.hiddenToRoot!==e&&this._onHiddenToRootChange(this.hiddenToRoot)}}},{key:"hiddenToRoot",get:function(){return this._hidden||this._hiddenParents}},{key:"readOnly",get:function(){return this._ignoreParent?this._readOnly:this._readOnly||!(!this._parent||!this._parent.readOnly)},set:function(t){this._readOnly!==t&&(this._readOnly=t,this._onReadOnlyChange(t))}},{key:"error",get:function(){return this._hasError},set:function(t){this._hasError!==t&&(this._hasError=t,t?this.classAdd(n.e):this.classRemove(n.e))}},{key:"style",get:function(){return this._dom.style}},{key:"class",get:function(){return this._dom.classList}},{key:"width",get:function(){return this._dom.clientWidth},set:function(t){"number"==typeof t&&(t+="px"),this.style.width=t}},{key:"height",get:function(){return this._dom.clientHeight},set:function(t){"number"==typeof t&&(t+="px"),this.style.height=t}},{key:"tabIndex",get:function(){return this._dom.tabIndex},set:function(t){this._dom.tabIndex=t}},{key:"binding",get:function(){return this._binding},set:function(t){var e,i;this._binding!==t&&(this._binding&&(e=this._binding.observers,i=this._binding.paths,this.unlink(),this._binding.element=null,this._binding=null),this._binding=t,this._binding&&(this._binding.element=this,e&&i&&this.link(e,i)))}},{key:"destroyed",get:function(){return this._destroyed}},{key:"disabled",get:function(){return!this.enabled},set:function(t){this.enabled=!t}},{key:"element",get:function(){return this.dom},set:function(t){this.dom=t}},{key:"innerElement",get:function(){return this.domContent},set:function(t){this.domContent=t}}])&&a(e.prototype,i),r&&a(e,r),h}(r.a);d.forEach((function(t){Object.defineProperty(p.prototype,t,{get:function(){return this.style[t]},set:function(e){this.style[t]=e}})})),e.a=p},function(t,e,i){"use strict";var n=i(1),r=i(0);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=d(t);if(e){var r=d(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}function c(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=[null,"top","right","bottom","left"],p=r.p+"-resizing",m="pcui-container-dragged",g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(c,t);var e,i,n,s=h(c);function c(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),t||(t={});var i=t.dom||document.createElement("div");(e=s.call(this,i,t)).class.add("pcui-container"),e._domEventScroll=e._onScroll.bind(u(e)),e.domContent=e._dom,e._scrollable=!1,t.scrollable&&(e.scrollable=!0),e._flex=!1,e.flex=!!t.flex,e._grid=!1;var n=!!t.grid;return n&&e.flex&&(console.error('Invalid pcui.Container arguments: "grid" and "flex" cannot both be true.'),n=!1),e.grid=n,e._domResizeHandle=null,e._domEventResizeStart=e._onResizeStart.bind(u(e)),e._domEventResizeMove=e._onResizeMove.bind(u(e)),e._domEventResizeEnd=e._onResizeEnd.bind(u(e)),e._domEventResizeTouchStart=e._onResizeTouchStart.bind(u(e)),e._domEventResizeTouchMove=e._onResizeTouchMove.bind(u(e)),e._domEventResizeTouchEnd=e._onResizeTouchEnd.bind(u(e)),e._resizeTouchId=null,e._resizeData=null,e._resizeHorizontally=!0,e.resizable=t.resizable||null,e._resizeMin=100,e._resizeMax=300,void 0!==t.resizeMin&&(e.resizeMin=t.resizeMin),void 0!==t.resizeMax&&(e.resizeMax=t.resizeMax),e._draggedStartIndex=-1,e}return e=c,(i=[{key:"append",value:function(t){var e=this._getDomFromElement(t);this._domContent.appendChild(e),this._onAppendChild(t)}},{key:"appendBefore",value:function(t,e){var i=this._getDomFromElement(t);this._domContent.appendChild(i);var n=e&&this._getDomFromElement(e);this._domContent.insertBefore(i,n),this._onAppendChild(t)}},{key:"appendAfter",value:function(t,e){var i=this._getDomFromElement(t),n=e&&this._getDomFromElement(e),r=n?n.nextSibling:null;r?this._domContent.insertBefore(i,r):this._domContent.appendChild(i),this._onAppendChild(t)}},{key:"prepend",value:function(t){var e=this._getDomFromElement(t),i=this._domContent.firstChild;i?this._domContent.insertBefore(e,i):this._domContent.appendChild(e),this._onAppendChild(t)}},{key:"remove",value:function(t){if(t.parent===this){var e=this._getDomFromElement(t);this._domContent.removeChild(e),this._onRemoveChild(t)}}},{key:"move",value:function(t,e){for(var i=-1,n=0;n<this.dom.childNodes.length;n++)if(this.dom.childNodes[n].ui===t){i=n;break}-1===i?this.appendBefore(t,this.dom.childNodes[e]):e!==i&&(this.remove(t),e<i?this.appendBefore(t,this.dom.childNodes[e]):this.appendAfter(t,this.dom.childNodes[e-1]))}},{key:"clear",value:function(){for(var t=this._domContent.childNodes.length;t--;){var e=this._domContent.childNodes[t];e.ui&&e.ui!==this&&e.ui.destroy()}this._domResizeHandle&&(this._domResizeHandle.removeEventListener("mousedown",this._domEventResizeStart),this._domResizeHandle.removeEventListener("touchstart",this._domEventResizeTouchStart,{passive:!1}),this._domResizeHandle=null),this._domContent.innerHTML="",this.resizable&&(this._createResizeHandle(),this._dom.appendChild(this._domResizeHandle))}},{key:"_getDomFromElement",value:function(t){return t.dom?t.dom:t.element?t.element:t}},{key:"_onAppendChild",value:function(t){t.parent=this,this.emit("append",t)}},{key:"_onRemoveChild",value:function(t){t.parent=null,this.emit("remove",t)}},{key:"_onScroll",value:function(t){this.emit("scroll",t)}},{key:"_createResizeHandle",value:function(){var t=document.createElement("div");t.classList.add("pcui-resizable-handle"),t.ui=this,t.addEventListener("mousedown",this._domEventResizeStart),t.addEventListener("touchstart",this._domEventResizeTouchStart,{passive:!1}),this._domResizeHandle=t}},{key:"_onResizeStart",value:function(t){t.preventDefault(),t.stopPropagation(),window.addEventListener("mousemove",this._domEventResizeMove),window.addEventListener("mouseup",this._domEventResizeEnd),this._resizeStart()}},{key:"_onResizeMove",value:function(t){t.preventDefault(),t.stopPropagation(),this._resizeMove(t.clientX,t.clientY)}},{key:"_onResizeEnd",value:function(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("mousemove",this._domEventResizeMove),window.removeEventListener("mouseup",this._domEventResizeEnd),this._resizeEnd()}},{key:"_onResizeTouchStart",value:function(t){t.preventDefault(),t.stopPropagation();for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];i.target===this._domResizeHandle&&(this._resizeTouchId=i.identifier)}window.addEventListener("touchmove",this._domEventResizeTouchMove),window.addEventListener("touchend",this._domEventResizeTouchEnd),this._resizeStart()}},{key:"_onResizeTouchMove",value:function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];if(i.identifier===this._resizeTouchId){t.stopPropagation(),t.preventDefault(),this._resizeMove(i.clientX,i.clientY);break}}}},{key:"_onResizeTouchEnd",value:function(t){for(var e=0;e<t.changedTouches.length;e++)if(t.changedTouches[e].identifier!==this._resizeTouchId){this._resizeTouchId=null,t.preventDefault(),t.stopPropagation(),window.removeEventListener("touchmove",this._domEventResizeTouchMove),window.removeEventListener("touchend",this._domEventResizeTouchEnd),this._resizeEnd();break}}},{key:"_resizeStart",value:function(){this.class.add(p)}},{key:"_resizeMove",value:function(t,e){if(this._resizeData){if(this._resizeHorizontally){var i=this._resizeData.x-t;"right"===this._resizable&&(i=-i),this.width=4+Math.max(this._resizeMin,Math.min(this._resizeMax,this._resizeData.width+i))}else{var n=this._resizeData.y-e;"bottom"===this._resizable&&(n=-n),this.height=Math.max(this._resizeMin,Math.min(this._resizeMax,this._resizeData.height+n))}this.emit("resize")}else this._resizeData={x:t,y:e,width:this.dom.clientWidth,height:this.dom.clientHeight}}},{key:"_resizeEnd",value:function(){this._resizeData=null,this.class.remove(p)}},{key:"resize",value:function(t,e){t=t||0,e=e||0,this._resizeStart(),this._resizeMove(0,0),this._resizeMove(4-t,-e),this._resizeEnd()}},{key:"_getDraggedChildIndex",value:function(t){for(var e=0;e<this.dom.childNodes.length;e++)if(this.dom.childNodes[e].ui===t)return e;return-1}},{key:"_onChildDragStart",value:function(t,e){this.class.add("pcui-container-dragged-child"),this._draggedStartIndex=this._getDraggedChildIndex(e),e.class.add(m),this._draggedHeight=e.height,this.emit("child:dragstart",e,this._draggedStartIndex)}},{key:"_onChildDragMove",value:function(t,e){var i=this.dom.getBoundingClientRect(),n=t.clientX<i.left||t.clientX>i.right||t.clientY<i.top||t.clientY>i.bottom,r=this._getDraggedChildIndex(e);if(n)return e.class.remove(m),void(this._draggedStartIndex!==r&&(this.remove(e),this._draggedStartIndex<r?this.appendBefore(e,this.dom.childNodes[this._draggedStartIndex]):this.appendAfter(e,this.dom.childNodes[this._draggedStartIndex-1])));e.class.add(m);for(var s=t.clientY-i.top,a=null,o=0;o<this.dom.childNodes.length;o++){var l=this.dom.childNodes[o].ui,h=l.dom.offsetTop;if(o<r){if(s<=h+l.header.height){a=o;break}}else if(o>r&&s+e.height>=h+l.height){a=o;break}}null!==a&&r!==a&&(this.remove(e),a<r?this.appendBefore(e,this.dom.childNodes[a]):this.appendAfter(e,this.dom.childNodes[a-1]))}},{key:"_onChildDragEnd",value:function(t,e){this.class.remove("pcui-container-dragged-child"),e.class.remove(m);var i=this._getDraggedChildIndex(e);this.emit("child:dragend",e,i,this._draggedStartIndex),this._draggedStartIndex=-1}},{key:"forEachChild",value:function(t){for(var e=0;e<this.dom.childNodes.length;e++){var i=this.dom.childNodes[e].ui;if(i&&!1===t(i,e))break}}},{key:"_buildDomNode",value:function(t){var e,i=this,n=Object.keys(t);return n.includes("root")?(e=this._buildDomNode(t.root),t.children.forEach((function(t){var n=i._buildDomNode(t);null!==n&&e.append(n)}))):(e=t[n[0]],this["_".concat(n[0])]=e),e}},{key:"buildDom",value:function(t){var e=this;t.forEach((function(t){var i=e._buildDomNode(t);e.append(i)}))}},{key:"destroy",value:function(){this._destroyed||(this.domContent=null,this._domResizeHandle&&(this._domResizeHandle.removeEventListener("mousedown",this._domEventResizeStart),window.removeEventListener("mousemove",this._domEventResizeMove),window.removeEventListener("mouseup",this._domEventResizeEnd),this._domResizeHandle.removeEventListener("touchstart",this._domEventResizeTouchStart),window.removeEventListener("touchmove",this._domEventResizeTouchMove),window.removeEventListener("touchend",this._domEventResizeTouchEnd)),this._domResizeHandle=null,this._domEventResizeStart=null,this._domEventResizeMove=null,this._domEventResizeEnd=null,this._domEventResizeTouchStart=null,this._domEventResizeTouchMove=null,this._domEventResizeTouchEnd=null,this._domEventScroll=null,o(d(c.prototype),"destroy",this).call(this))}},{key:"flex",get:function(){return this._flex},set:function(t){t!==this._flex&&(this._flex=t,t?this.classAdd(r.g):this.classRemove(r.g))}},{key:"grid",get:function(){return this._grid},set:function(t){t!==this._grid&&(this._grid=t,t?this.classAdd(r.k):this.classRemove(r.k))}},{key:"scrollable",get:function(){return this._scrollable},set:function(t){this._scrollable!==t&&(this._scrollable=t,t?this.classAdd(r.q):this.classRemove(r.q))}},{key:"resizable",get:function(){return this._resizable},set:function(t){t!==this._resizable&&(-1!==f.indexOf(t)?(this._resizable&&this.classRemove("".concat(r.p,"-").concat(this._resizable)),this._resizable=t,this._resizeHorizontally="right"===t||"left"===t,t?(this.classAdd(r.p),this.classAdd("".concat(r.p,"-").concat(t)),this._domResizeHandle||this._createResizeHandle(),this._dom.appendChild(this._domResizeHandle)):(this.classRemove(r.p),this._domResizeHandle&&this._dom.removeChild(this._domResizeHandle))):console.error("Invalid resizable value: must be one of "+f.join(",")))}},{key:"resizeMin",get:function(){return this._resizeMin},set:function(t){this._resizeMin=Math.max(0,Math.min(t,this._resizeMax))}},{key:"resizeMax",get:function(){return this._resizeMax},set:function(t){this._resizeMax=Math.max(this._resizeMin,t)}},{key:"domContent",get:function(){return this._domContent},set:function(t){this._domContent!==t&&(this._domContent&&this._domContent.removeEventListener("scroll",this._domEventScroll),this._domContent=t,this._domContent&&this._domContent.addEventListener("scroll",this._domEventScroll))}}])&&a(e.prototype,i),n&&a(e,n),c}(n.a);n.a.register("container",g),e.a=g},function(t,e,i){"use strict";var n=i(0),r=i(1);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=c(t);if(e){var r=c(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return h(this,i)}}function h(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(h,t);var e,i,r,s=l(h);function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),t||(t={}),(e=s.call(this,t.dom?t.dom:document.createElement("span"),t)).class.add("pcui-label"),e._unsafe=t.unsafe||!1,e.text=t.text||t.value||"",t.allowTextSelection&&e.class.add(n.c),t.nativeTooltip&&(e.dom.title=e.text),e.placeholder=t.placeholder||null,e.renderChanges=t.renderChanges||!1,e.on("change",(function(){e.renderChanges&&e.flash()})),e}return e=h,(i=[{key:"_updateText",value:function(t){return this.class.remove(n.m),this._text!==t&&(this._text=t,this._unsafe?this._dom.innerHTML=t:this._dom.textContent=t,this.emit("change",t),!0)}},{key:"text",get:function(){return this._text},set:function(t){null==t&&(t=""),this._updateText(t)&&this._binding&&this._binding.setValue(t)}},{key:"value",get:function(){return this.text},set:function(t){this.text=t}},{key:"values",set:function(t){for(var e=!1,i=t[0],r=1;r<t.length;r++)if(t[r]!==i){e=!0;break}e?(this._updateText(""),this.class.add(n.m)):this._updateText(t[0])}},{key:"placeholder",get:function(){return this.dom.getAttribute("placeholder")},set:function(t){t?this.dom.setAttribute("placeholder",t):this.dom.removeAttribute("placeholder")}}])&&a(e.prototype,i),r&&a(e,r),h}(r.a);r.a.register("label",u),e.a=u},function(t,e,i){"use strict";function n(){Object.defineProperty(this,"_events",{enumerable:!1,configurable:!1,writable:!0,value:{}}),this._suspendEvents=!1,Object.defineProperty(this,"suspendEvents",{get:function(){return this._suspendEvents},set:function(t){this._suspendEvents=!!t}})}function r(t,e,i){this.owner=t,this.name=e,this.fn=i}n.prototype.on=function(t,e){var i=this._events[t];return void 0===i?this._events[t]=[e]:-1===i.indexOf(e)&&i.push(e),new r(this,t,e)},n.prototype.once=function(t,e){var i=this,n=this.on(t,(function(t,r,s,a,o,l,h,c){e.call(i,t,r,s,a,o,l,h,c),n.unbind()}));return n},n.prototype.emit=function(t,e,i,n,r,s,a,o,l){if(!this._suspendEvents){var h=this._events[t];if(!h)return this;h=h.slice(0);for(var c=0;c<h.length;c++)if(h[c])try{h[c].call(this,e,i,n,r,s,a,o,l)}catch(e){console.info("%c%s %c(event error)","color: #06f",t,"color: #f00"),console.log(e.stack)}return this}},n.prototype.unbind=function(t,e){if(t){var i=this._events[t];if(!i)return this;if(e){var n=i.indexOf(e);-1!==n&&(1===i.length?delete this._events[t]:i.splice(n,1))}else delete this._events[t]}else this._events={};return this},r.prototype.unbind=function(){this.owner&&(this.owner.unbind(this.name,this.fn),this.owner=null,this.name=null,this.fn=null)},r.prototype.call=function(){this.fn&&this.fn.call(this.owner,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])},r.prototype.on=function(t,e){return this.owner.on(t,e)},e.a=n},function(t,e,i){"use strict";t.exports=i(28)},function(t,e,i){"use strict";var n=i(3),r=i(2),s=i(8),a=i(0);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=p(t);if(e){var r=p(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return d(this,i)}}function d(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?f(t):e}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m="pcui-treeview-item",g=m+"-open",v=m+"-empty",_=m+"-rename",y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(y,t);var e,i,o,d=u(y);function y(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,y),t||(t={}),t.flex=!0,(e=d.call(this,t)).class.add(m,v),e._containerContents=new r.a({class:"pcui-treeview-item-contents",flex:!0,flexDirection:"row",tabIndex:0}),e.append(e._containerContents),e._containerContents.dom.draggable=!0,e._labelIcon=new n.a({class:"pcui-treeview-item-icon"}),e._containerContents.append(e._labelIcon),e._labelText=new n.a({class:"pcui-treeview-item-text"}),e._containerContents.append(e._labelText),e.allowSelect=void 0===t.allowSelect||t.allowSelect,e.allowDrop=void 0===t.allowDrop||t.allowDrop,e.allowDrag=void 0===t.allowDrag||t.allowDrag,t.text&&(e.text=t.text),e._numChildren=0,e._treeOrder=-1,e._domEvtFocus=e._onContentFocus.bind(f(e)),e._domEvtBlur=e._onContentBlur.bind(f(e)),e._domEvtKeyDown=e._onContentKeyDown.bind(f(e)),e._domEvtDragStart=e._onContentDragStart.bind(f(e)),e._domEvtMouseDown=e._onContentMouseDown.bind(f(e)),e._domEvtMouseUp=e._onContentMouseUp.bind(f(e)),e._domEvtMouseOver=e._onContentMouseOver.bind(f(e)),e._domEvtClick=e._onContentClick.bind(f(e)),e._domEvtDblClick=e._onContentDblClick.bind(f(e)),e._domEvtContextMenu=e._onContentContextMenu.bind(f(e)),e._containerContents.dom.addEventListener("focus",e._domEvtFocus),e._containerContents.dom.addEventListener("blur",e._domEvtBlur),e._containerContents.dom.addEventListener("keydown",e._domEvtKeyDown),e._containerContents.dom.addEventListener("dragstart",e._domEvtDragStart),e._containerContents.dom.addEventListener("mousedown",e._domEvtMouseDown),e._containerContents.dom.addEventListener("mouseover",e._domEvtMouseOver),e._containerContents.dom.addEventListener("click",e._domEvtClick),e._containerContents.dom.addEventListener("dblclick",e._domEvtDblClick),e._containerContents.dom.addEventListener("contextmenu",e._domEvtContextMenu),e}return e=y,(i=[{key:"_onAppendChild",value:function(t){h(p(y.prototype),"_onAppendChild",this).call(this,t),t instanceof y&&(this._numChildren++,this._parent!==this._treeView&&this.classRemove(v),this._treeView&&this._treeView._onAppendTreeViewItem(t))}},{key:"_onRemoveChild",value:function(t){t instanceof y&&(this._numChildren--,0===this._numChildren&&this.classAdd(v),this._treeView&&this._treeView._onRemoveTreeViewItem(t)),h(p(y.prototype),"_onRemoveChild",this).call(this,t)}},{key:"_onContentKeyDown",value:function(t){"input"!==t.target.tagName.toLowerCase()&&this.allowSelect&&this._treeView&&this._treeView._onChildKeyDown(t,this)}},{key:"_onContentMouseDown",value:function(t){this._treeView&&this._treeView.allowDrag&&this._allowDrag&&(this._treeView._updateModifierKeys(t),t.stopPropagation())}},{key:"_onContentMouseUp",value:function(t){t.stopPropagation(),t.preventDefault(),window.removeEventListener("mouseup",this._domEvtMouseUp),this._treeView&&this._treeView._onChildDragEnd(t,this)}},{key:"_onContentMouseOver",value:function(t){t.stopPropagation(),this._treeView&&this._treeView._onChildDragOver(t,this),h(p(y.prototype),"_onMouseOver",this).call(this,t)}},{key:"_onContentDragStart",value:function(t){t.stopPropagation(),t.preventDefault(),this._treeView&&this._treeView.allowDrag&&(this.class.contains(_)||(this._treeView._onChildDragStart(t,this),window.addEventListener("mouseup",this._domEvtMouseUp)))}},{key:"_onContentClick",value:function(t){if(this.allowSelect&&0===t.button&&"input"!==t.target.tagName.toLowerCase()){t.stopPropagation();var e=this._containerContents.dom.getBoundingClientRect();this._numChildren>0&&t.clientX-e.left<0?(this.open=!this.open,this.focus()):this._treeView&&this._treeView._onChildClick(t,this)}}},{key:"_onContentDblClick",value:function(t){if(this._treeView&&this._treeView.allowRenaming&&0===t.button&&"input"!==t.target.tagName.toLowerCase()){t.stopPropagation();var e=this._containerContents.dom.getBoundingClientRect();this.numChildren&&t.clientX-e.left<0||(this.allowSelect&&(this._treeView.deselect(),this._treeView._onChildClick(t,this)),this.rename())}}},{key:"_onContentContextMenu",value:function(t){this._treeView&&this._treeView._onContextMenu&&this._treeView._onContextMenu(t,this)}},{key:"_onContentFocus",value:function(t){this.emit("focus")}},{key:"_onContentBlur",value:function(t){this.emit("blur")}},{key:"rename",value:function(){var t=this;this.classAdd(_);var e=new s.a({renderChanges:!1,value:this.text,class:a.j});e.on("blur",(function(){e.destroy()})),e.on("destroy",(function(){t.classRemove(_),t.focus()})),e.on("change",(function(i){(i=i.trim())&&(t.text=i,e.destroy())})),e.on("disable",(function(){e.input.removeAttribute("readonly")})),this._containerContents.append(e),e.focus(!0)}},{key:"focus",value:function(){this._containerContents.dom.focus()}},{key:"blur",value:function(){this._containerContents.dom.blur()}},{key:"destroy",value:function(){this._destroyed||(this._containerContents.dom.removeEventListener("focus",this._domEvtFocus),this._containerContents.dom.removeEventListener("blur",this._domEvtBlur),this._containerContents.dom.removeEventListener("keydown",this._domEvtKeyDown),this._containerContents.dom.removeEventListener("mousedown",this._domEvtMouseDown),this._containerContents.dom.removeEventListener("dragstart",this._domEvtDragStart),this._containerContents.dom.removeEventListener("mouseover",this._domEvtMouseOver),this._containerContents.dom.removeEventListener("click",this._domEvtClick),this._containerContents.dom.removeEventListener("dblclick",this._domEvtDblClick),this._containerContents.dom.removeEventListener("contextmenu",this._domEvtContextMenu),window.removeEventListener("mouseup",this._domEvtMouseUp),h(p(y.prototype),"destroy",this).call(this))}},{key:"selected",get:function(){return this._containerContents.class.contains("pcui-treeview-item-selected")},set:function(t){t&&this.focus(),t!==this.selected&&(t?(this._containerContents.classAdd("pcui-treeview-item-selected"),this.emit("select",this),this._treeView&&this._treeView._onChildSelected(this)):(this._containerContents.classRemove("pcui-treeview-item-selected"),this.blur(),this.emit("deselect",this),this._treeView&&this._treeView._onChildDeselected(this)))}},{key:"text",get:function(){return this._labelText.value},set:function(t){this._labelText.value!==t&&(this._labelText.value=t,this._treeView&&this._treeView._onChildRename(this,t))}},{key:"textLabel",get:function(){return this._labelText}},{key:"iconLabel",get:function(){return this._labelIcon}},{key:"open",get:function(){return this.class.contains(g)||this.parent===this._treeView},set:function(t){if(this.open!==t)if(t){if(!this.numChildren)return;this.classAdd(g),this.emit("open",this)}else this.classRemove(g),this.emit("close",this)}},{key:"parentsOpen",get:function(){for(var t=this.parent;t&&t instanceof y;){if(!t.open)return!1;t=t.parent}return!0},set:function(t){for(var e=this.parent;e&&e instanceof y;)e.open=t,e=e.parent}},{key:"allowDrop",get:function(){return this._allowDrop},set:function(t){this._allowDrop=t}},{key:"allowDrag",get:function(){return this._allowDrag},set:function(t){this._allowDrag=t}},{key:"allowSelect",get:function(){return this._allowSelect},set:function(t){this._allowSelect=t}},{key:"treeView",get:function(){return this._treeView},set:function(t){this._treeView=t}},{key:"numChildren",get:function(){return this._numChildren}},{key:"firstChild",get:function(){if(this._numChildren)for(var t=0;t<this.dom.childNodes.length;t++)if(this.dom.childNodes[t].ui instanceof y)return this.dom.childNodes[t].ui;return null}},{key:"lastChild",get:function(){if(this._numChildren)for(var t=this.dom.childNodes.length-1;t>=0;t--)if(this.dom.childNodes[t].ui instanceof y)return this.dom.childNodes[t].ui;return null}},{key:"nextSibling",get:function(){for(var t=this.dom.nextSibling;t&&!(t.ui instanceof y);)t=t.nextSibling;return t&&t.ui}},{key:"previousSibling",get:function(){for(var t=this.dom.previousSibling;t&&!(t.ui instanceof y);)t=t.previousSibling;return t&&t.ui}}])&&l(e.prototype,i),o&&l(e,o),y}(r.a);e.a=y},function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r,s,a,o,l={deepCopy:function t(e){if(null==e||"object"!==n(e))return e;if(e instanceof Array){for(var i=[],r=0;r<e.length;r++)i[r]=t(e[r]);return i}var s={};for(var a in e)e.hasOwnProperty(a)&&(s[a]=t(e[a]));return s},isMobile:function(){return/Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},implements:function(t,e){var i=Object.getOwnPropertyDescriptors(e.prototype);for(var n in i)t.prototype.hasOwnProperty(n)&&delete i[n];Object.defineProperties(t.prototype,i)},proxy:function(t,e,i){i.forEach((function(i){Object.defineProperty(t.prototype,i,{get:function(){return this[e][i]},set:function(t){this[e][i]=t}})}))}};String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(t){for(var e=t.length,i=0;i<e;i++)if(this[i]!==t[i])return!1;return!0}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(t){for(var e=0,i=t.length;e<i;e++)if(this[e+this.length-i]!==t[e])return!1;return!0}}),String.prototype.appendQuery||Object.defineProperty(String.prototype,"appendQuery",{enumerable:!1,configurable:!1,writable:!1,value:function(t){return this+(-1!==this.indexOf("?")?"&":"?")+t}}),l.arrayEquals=function(t,e){if(!t)return!1;if(!e)return!1;if(t.length!==e.length)return!1;for(var i=0,n=t.length;i<n;i++)if(this[i]instanceof Array&&e[i]instanceof Array){if(!this[i].equals(e[i]))return!1}else if(this[i]!==e[i])return!1;return!0},r=document.createElement("div"),s=DOMTokenList.prototype,a=s.add,o=s.remove,r.classList.add("class1","class2"),r.classList.contains("class2")||(s.add=function(){Array.prototype.forEach.call(arguments,a.bind(this))},s.remove=function(){Array.prototype.forEach.call(arguments,o.bind(this))}),e.a=l},function(t,e,i){"use strict";var n=i(1),r=i(0);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=d(t);if(e){var r=d(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}function c(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(f,t);var e,i,n,c=h(f);function f(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),t||(t={}),(e=c.call(this,t.dom?t.dom:document.createElement("div"),t)).class.add("pcui-text-input");var i=t.input;return i||((i=document.createElement("input")).ui=u(e),i.type="text",i.tabIndex=0),e._domInput=i,e._domEvtChange=e._onInputChange.bind(u(e)),e._domEvtFocus=e._onInputFocus.bind(u(e)),e._domEvtBlur=e._onInputBlur.bind(u(e)),e._domEvtKeyDown=e._onInputKeyDown.bind(u(e)),e._domEvtKeyUp=e._onInputKeyUp.bind(u(e)),e._domEvtCtxMenu=e._onInputCtxMenu.bind(u(e)),e._domInput.addEventListener("change",e._domEvtChange),e._domInput.addEventListener("focus",e._domEvtFocus),e._domInput.addEventListener("blur",e._domEvtBlur),e._domInput.addEventListener("keydown",e._domEvtKeyDown),e._domInput.addEventListener("contextmenu",e._domEvtCtxMenu,!1),e.dom.appendChild(e._domInput),e._suspendInputChangeEvt=!1,void 0!==t.value&&(e.value=t.value),e.placeholder=t.placeholder||null,e.renderChanges=t.renderChanges||!1,e.blurOnEnter=void 0===t.blurOnEnter||t.blurOnEnter,e.blurOnEscape=void 0===t.blurOnEscape||t.blurOnEscape,e.keyChange=t.keyChange||!1,t.onValidate&&(e.onValidate=t.onValidate),e.on("change",(function(){e.renderChanges&&e.flash()})),e.on("disable",e._updateInputReadOnly.bind(u(e))),e.on("enable",e._updateInputReadOnly.bind(u(e))),e.on("readOnly",e._updateInputReadOnly.bind(u(e))),e._updateInputReadOnly(),e}return e=f,(i=[{key:"_onInputChange",value:function(t){if(!this._suspendInputChangeEvt){if(this._onValidate){var e=!this._onValidate(this.value);if(this.error=e,e)return}else this.error=!1;this.emit("change",this.value),this._binding&&this._binding.setValue(this.value)}}},{key:"_onInputFocus",value:function(t){this.class.add(r.h),this.emit("focus",t)}},{key:"_onInputBlur",value:function(t){this.class.remove(r.h),this.emit("blur",t)}},{key:"_onInputKeyDown",value:function(t){(27===t.keyCode&&this.blurOnEscape||13===t.keyCode&&this.blurOnEnter)&&this._domInput.blur(),this.emit("keydown",t)}},{key:"_onInputKeyUp",value:function(t){this._onInputChange(t),this.emit("keyup",t)}},{key:"_onInputCtxMenu",value:function(t){this._domInput.select()}},{key:"_updateInputReadOnly",value:function(){!this.enabled||this.readOnly?this._domInput.setAttribute("readonly",!0):this._domInput.removeAttribute("readonly")}},{key:"_updateValue",value:function(t){if(this.class.remove(r.m),t&&"object"===s(t))if(Array.isArray(t)){for(var e=!1,i=0;i<t.length;i++)if(t[i]&&"object"===s(t[i])){e=!0;break}t=e?"[Not available]":t.map((function(t){return null===t?"null":t})).join(",")}else t="[Not available]";return t!==this.value&&(this._suspendInputChangeEvt=!0,this._domInput.value=null==t?"":t,this._suspendInputChangeEvt=!1,this.emit("change",t),!0)}},{key:"focus",value:function(t){this._domInput.focus(),t&&this._domInput.select()}},{key:"blur",value:function(){this._domInput.blur()}},{key:"destroy",value:function(){this._destroyed||(this._domInput.removeEventListener("change",this._domEvtChange),this._domInput.removeEventListener("focus",this._domEvtFocus),this._domInput.removeEventListener("blur",this._domEvtBlur),this._domInput.removeEventListener("keydown",this._domEvtKeyDown),this._domInput.removeEventListener("keyup",this._domEvtKeyUp),this._domInput.removeEventListener("contextmenu",this._domEvtCtxMenu),this._domInput=null,o(d(f.prototype),"destroy",this).call(this))}},{key:"value",get:function(){return this._domInput.value},set:function(t){var e=this._updateValue(t);e&&(this.error=!1),e&&this._binding&&this._binding.setValue(t)}},{key:"values",set:function(t){for(var e=!1,i=t[0],n=1;n<t.length;n++)if(t[n]!==i){e=!0;break}e?(this._updateValue(null),this.class.add(r.m)):this._updateValue(t[0])}},{key:"placeholder",get:function(){return this.dom.getAttribute("placeholder")},set:function(t){t?this.dom.setAttribute("placeholder",t):this.dom.removeAttribute("placeholder")}},{key:"keyChange",get:function(){return this._keyChange},set:function(t){this._keyChange!==t&&(this._keyChange=t,t?this._domInput.addEventListener("keyup",this._domEvtKeyUp):this._domInput.removeEventListener("keyup",this._domEvtKeyUp))}},{key:"input",get:function(){return this._domInput}},{key:"onValidate",get:function(){return this._onValidate},set:function(t){this._onValidate=t}}])&&a(e.prototype,i),n&&a(e,n),f}(n.a);n.a.register("string",f,{renderChanges:!0}),e.a=f},function(t,e,i){"use strict";var n=i(1);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,i){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=u(t);if(e){var r=u(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return h(this,i)}}function h(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?c(t):e}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(h,t);var e,i,n,r=l(h);function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),t||(t={}),(e=r.call(this,t.dom?t.dom:document.createElement("button"),t)).class.add("pcui-button"),e._unsafe=t.unsafe||!1,e.text=t.text||"",e.size=t.size||null,e.icon=t.icon||"",e._domEventKeyDown=e._onKeyDown.bind(c(e)),e.dom.addEventListener("keydown",e._onKeyDown.bind(c(e))),e}return e=h,(i=[{key:"_onKeyDown",value:function(t){27===t.keyCode?this.blur():13===t.keyCode&&this._onClick(t)}},{key:"_onClick",value:function(t){this.blur(),this.readOnly||a(u(h.prototype),"_onClick",this).call(this,t)}},{key:"focus",value:function(){this.dom.focus()}},{key:"blur",value:function(){this.dom.blur()}},{key:"destroy",value:function(){this._destroyed||(this.dom.removeEventListener("keydown",this._domEventKeyDown),a(u(h.prototype),"destroy",this).call(this))}},{key:"text",get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._unsafe?this.dom.innerHTML=t:this.dom.textContent=t)}},{key:"icon",get:function(){return this._icon},set:function(t){this._icon===t|!t.match(/^E[0-9]{0,4}$/)||(this._icon=t,t?this.dom.setAttribute("data-icon",String.fromCodePoint(parseInt(t,16))):this.dom.removeAttribute("data-icon"))}},{key:"size",get:function(){return this._size},set:function(t){this._size!==t&&(this._size&&(this.class.remove("pcui-"+this._size),this._size=null),this._size=t,this._size&&this.class.add("pcui-"+this._size))}}])&&s(e.prototype,i),n&&s(e,n),h}(n.a);n.a.register("button",d),e.a=d},function(t,e,i){"use strict";var n=i(1),r=i(8),s=i(0);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,i){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=f(t);if(e){var r=f(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return u(this,i)}}function u(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?d(t):e}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var p=/,/g,m=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(u,t);var e,i,r,a=c(u);function u(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u);var i=(t=Object.assign({},t)).value;delete t.value;var r=t.renderChanges||!1;if(delete t.renderChanges,(e=a.call(this,t)).class.add("pcui-numeric-input"),e._min=void 0!==t.min?t.min:null,e._max=void 0!==t.max?t.max:null,e._allowNull=t.allowNull||!1,e._precision=Number.isFinite(t.precision)?t.precision:7,Number.isFinite(t.step)?e._step=t.step:Number.isFinite(t.precision)?e._step=1/Math.pow(10,t.precision):e._step=1,e._oldValue=void 0,e.value=i,e._historyCombine=!1,e._historyPostfix=null,e._sliderPrevValue=0,e.renderChanges=r,e._domEvtPointerLock=null,e._domEvtSliderMouseDown=null,e._domEvtSliderMouseUp=null,e._domEvtMouseWheel=null,!t.hideSlider){e._sliderControl=new n.a,e._sliderControl.class.add("pcui-numeric-input-slider-control"),e.dom.append(e._sliderControl.dom);var s=!1;e._domEvtSliderMouseDown=function(){e._sliderControl.dom.requestPointerLock(),e._sliderMovement=0,e._sliderPrevValue=e.value,s=!0,e.binding&&(e._historyCombine=e.binding.historyCombine,e._historyPostfix=e.binding.historyPostfix,e.binding.historyCombine=!0,e.binding.historyPostfix="(".concat(Date.now(),")"))},e._domEvtSliderMouseUp=function(){document.exitPointerLock(),s&&(s=!1,e.value=e._sliderPrevValue+e._sliderMovement,e.binding&&(e.binding.historyCombine=e._historyCombine,e.binding.historyPostfix=e._historyPostfix,e._historyCombine=!1,e._historyPostfix=null))},e._domEvtPointerLock=e._pointerLockChangeAlert.bind(d(e)),e._domEvtMouseWheel=e._updatePosition.bind(d(e)),e._sliderControl.dom.addEventListener("mousedown",e._domEvtSliderMouseDown),e._sliderControl.dom.addEventListener("mouseup",e._domEvtSliderMouseUp),document.addEventListener("pointerlockchange",e._domEvtPointerLock,!1),document.addEventListener("mozpointerlockchange",e._domEvtPointerLock,!1)}return e}return e=u,(i=[{key:"_updatePosition",value:function(t){var e=0;t.constructor===WheelEvent?e=t.deltaY:t.constructor===MouseEvent&&(e=t.movementX),this._sliderMovement+=e/100*this._step,this.value=this._sliderPrevValue+this._sliderMovement}},{key:"_onInputChange",value:function(t){this.value=this._domInput.value}},{key:"_onInputKeyDown",value:function(t){if(!this.enabled||this.readOnly)return l(f(u.prototype),"_onInputKeyDown",this).call(this,t);if(38!==t.keyCode&&40!==t.keyCode)l(f(u.prototype),"_onInputKeyDown",this).call(this,t);else{var e=(t.shiftKey?10:1)*(40===t.keyCode?-1:1);this.value+=this.step*e}}},{key:"_isScrolling",value:function(){return!!this._sliderControl&&(document.pointerLockElement===this._sliderControl.dom||document.mozPointerLockElement===this._sliderControl.dom)}},{key:"_pointerLockChangeAlert",value:function(){this._isScrolling()?(this._sliderControl.dom.addEventListener("mousemove",this._domEvtMouseWheel,!1),this._sliderControl.dom.addEventListener("wheel",this._domEvtMouseWheel,!1),this._sliderControl.class.add("pcui-numeric-input-slider-control-active")):(this._sliderControl.dom.removeEventListener("mousemove",this._domEvtMouseWheel,!1),this._sliderControl.dom.removeEventListener("wheel",this._domEvtMouseWheel,!1),this._sliderControl.class.remove("pcui-numeric-input-slider-control-active"))}},{key:"_normalizeValue",value:function(t){try{if("string"==typeof t&&null!==(t=(t=(t=t.replace(p,".")).replace(/\s/g,"")).match(/^[*/+\-0-9().]+$/))&&t[0].length<20){var e=t[0];["+","-","/","*"].forEach((function(t){var i=e.split(t);i.forEach((function(t,e){i[e]=i[e].replace(/^0+/,"")})),e=i.join(t)})),t=Function('"use strict";return ('+e+")")()}}catch(e){t=null}if(null===t||isNaN(t)){if(this._allowNull)return null;t=0}return null!==this.min&&t<this.min&&(t=this.min),null!==this.max&&t>this.max&&(t=this.max),null!==this.precision&&(t=parseFloat(Number(t).toFixed(this.precision),10)),t}},{key:"_updateValue",value:function(t,e){var i=t!==this._oldValue||e;return this._oldValue=t,this._domInput.value=t,this.class.remove(s.m),i&&this.emit("change",t),i}},{key:"value",get:function(){var t=l(f(u.prototype),"value",this);return""!==t?parseFloat(t,10):null},set:function(t){t=this._normalizeValue(t);var e=this.class.contains(s.m)&&null===t&&this._allowNull;this._updateValue(t,e)&&this.binding&&this.binding.setValue(t),this._sliderControl&&this._sliderControl.class.remove("pcui-numeric-input-slider-control-hidden")}},{key:"values",set:function(t){for(var e=!1,i=this._normalizeValue(t[0]),n=1;n<t.length;n++)if(i!==this._normalizeValue(t[n])){e=!0;break}e?(this._updateValue(null),this.class.add(s.m),this._sliderControl&&this._sliderControl.class.add("pcui-numeric-input-slider-control-hidden")):(this._updateValue(i),this._sliderControl&&this._sliderControl.class.remove("pcui-numeric-input-slider-control-hidden"))}},{key:"min",get:function(){return this._min},set:function(t){this._min!==t&&(this._min=t,null!==this._min&&(this.value=this.value))}},{key:"max",get:function(){return this._max},set:function(t){this._max!==t&&(this._max=t,null!==this._max&&(this.value=this.value))}},{key:"precision",get:function(){return this._precision},set:function(t){this._precision!==t&&(this._precision=t,null!==this._precision&&(this.value=this.value))}},{key:"step",get:function(){return this._step},set:function(t){this._step=t}},{key:"destroy",value:function(){this.destroyed||(this._domEvtSliderMouseDown&&(this._sliderControl.dom.removeEventListener("mousedown",this._domEvtSliderMouseDown),this._sliderControl.dom.removeEventListener("mouseup",this._domEvtSliderMouseUp)),this._domEvtMouseWheel&&(this._sliderControl.dom.removeEventListener("mousemove",this._domEvtMouseWheel,!1),this._sliderControl.dom.removeEventListener("wheel",this._domEvtMouseWheel,!1)),this._domEvtPointerLock&&(document.removeEventListener("pointerlockchange",this._domEvtPointerLock,!1),document.removeEventListener("mozpointerlockchange",this._domEvtPointerLock,!1)),l(f(u.prototype),"destroy",this).call(this))}}])&&o(e.prototype,i),r&&o(e,r),u}(r.a);n.a.register("number",m,{renderChanges:!0}),e.a=m},function(t,e,i){"use strict";var n=i(0),r=i(1),s=i(2),a=i(3),o=i(9);function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=m(t);if(e){var r=m(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return f(this,i)}}function f(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?p(t):e}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(f,t);var e,i,r,l=d(f);function f(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),t||(t={});var i=Object.assign({},t);return i.flex=!0,delete i.grid,delete i.flexDirection,delete i.scrollable,(e=l.call(this,i)).class.add("pcui-panel"),t.panelType&&e.class.add("pcui-panel-"+t.panelType),e._suspendReflow=!0,e._initializeHeader(t),e._initializeContent(t),e.headerSize=void 0!==t.headerSize?t.headerSize:32,e._domEvtDragStart=e._onDragStart.bind(p(e)),e._domEvtDragMove=e._onDragMove.bind(p(e)),e._domEvtDragEnd=e._onDragEnd.bind(p(e)),e._reflowTimeout=null,e._widthBeforeCollapse=null,e._heightBeforeCollapse=null,e.collapsible=t.collapsible||!1,e.collapsed=t.collapsed||!1,e.collapseHorizontally=t.collapseHorizontally||!1,e._iconSort=null,e.sortable=t.sortable||!1,e._btnRemove=null,e.removable=t.removable||!1,e.domContent=e._containerContent.dom,e._suspendReflow=!1,e._reflow(),e}return e=f,(i=[{key:"_initializeHeader",value:function(t){this._containerHeader=new s.a({flex:!0,flexDirection:"row",class:["pcui-panel-header",n.i]}),this._labelTitle=new a.a({text:t.headerText,class:["pcui-panel-header-title",n.i]}),this._containerHeader.append(this._labelTitle),this._containerHeader.dom.addEventListener("click",this._onHeaderClick.bind(this)),this.append(this._containerHeader)}},{key:"_onHeaderClick",value:function(t){this._collapsible&&(t.target!==this.header.dom&&t.target!==this._labelTitle.dom||(this.collapsed=!this.collapsed))}},{key:"_onClickRemove",value:function(t){t.preventDefault(),t.stopPropagation(),this.emit("click:remove")}},{key:"_initializeContent",value:function(t){this._containerContent=new s.a({class:"pcui-panel-content",grid:t.grid,flex:t.flex,flexDirection:t.flexDirection,scrollable:t.scrollable,dom:t.container}),this.append(this._containerContent)}},{key:"_reflow",value:function(){var t=this;this._suspendReflow||(this._reflowTimeout&&(cancelAnimationFrame(this._reflowTimeout),this._reflowTimeout=null),!this.hidden&&this.collapsible&&(this.collapsed&&this.collapseHorizontally?this._containerHeader.style.top=-this.headerSize+"px":this._containerHeader.style.top="",this._reflowTimeout=requestAnimationFrame((function(){t._reflowTimeout=null,t.collapsed?(t._widthBeforeCollapse||(t._widthBeforeCollapse=t.style.width),t._heightBeforeCollapse||(t._heightBeforeCollapse=t.style.height),t._collapseHorizontally?(t.height="",t.width=t.headerSize):t.height=t.headerSize,t.class.add(n.a)):(t.class.remove(n.a),t._collapseHorizontally?(t.height="",null!==t._widthBeforeCollapse&&(t.width=t._widthBeforeCollapse)):null!==t._heightBeforeCollapse&&(t.height=t._heightBeforeCollapse),t._widthBeforeCollapse=null,t._heightBeforeCollapse=null)}))))}},{key:"_onDragStart",value:function(t){this.disabled||this.readOnly||(t.stopPropagation(),t.preventDefault(),window.addEventListener("mouseup",this._domEvtDragEnd),window.addEventListener("mouseleave",this._domEvtDragEnd),window.addEventListener("mousemove",this._domEvtDragMove),this.emit("dragstart"),this.parent&&this.parent._onChildDragStart&&this.parent._onChildDragStart(t,this))}},{key:"_onDragMove",value:function(t){this.emit("dragmove"),this.parent&&this.parent._onChildDragStart&&this.parent._onChildDragMove(t,this)}},{key:"_onDragEnd",value:function(t){window.removeEventListener("mouseup",this._domEvtDragEnd),window.removeEventListener("mouseleave",this._domEvtDragEnd),window.removeEventListener("mousemove",this._domEvtDragMove),this._draggedChild===this&&(this._draggedChild=null),this.emit("dragend"),this.parent&&this.parent._onChildDragStart&&this.parent._onChildDragEnd(t,this)}},{key:"destroy",value:function(){this._destroyed||(this._reflowTimeout&&(cancelAnimationFrame(this._reflowTimeout),this._reflowTimeout=null),window.removeEventListener("mouseup",this._domEvtDragEnd),window.removeEventListener("mouseleave",this._domEvtDragEnd),window.removeEventListener("mousemove",this._domEvtDragMove),c(m(f.prototype),"destroy",this).call(this))}},{key:"collapsible",get:function(){return this._collapsible},set:function(t){t!==this._collapsible&&(this._collapsible=t,t?this.classAdd(n.b):this.classRemove(n.b),this._reflow(),this.collapsed&&this.emit(t?"collapse":"expand"))}},{key:"collapsed",get:function(){return this._collapsed},set:function(t){this._collapsed!==t&&(this._collapsed=t,this._reflow(),this.collapsible&&this.emit(t?"collapse":"expand"))}},{key:"sortable",get:function(){return this._sortable},set:function(t){this._sortable!==t&&(this._sortable=t,t?(this._iconSort=new a.a({class:"pcui-panel-sortable-icon"}),this._iconSort.dom.addEventListener("mousedown",this._domEvtDragStart),this.header.prepend(this._iconSort)):this._iconSort&&(this._iconSort.destroy(),this._iconSort=null))}},{key:"removable",get:function(){return!!this._btnRemove},set:function(t){this.removable!==t&&(t?(this._btnRemove=new o.a({icon:"E289",class:"pcui-panel-remove"}),this._btnRemove.on("click",this._onClickRemove.bind(this)),this.header.append(this._btnRemove)):(this._btnRemove.destroy(),this._btnRemove=null))}},{key:"collapseHorizontally",get:function(){return this._collapseHorizontally},set:function(t){this._collapseHorizontally!==t&&(this._collapseHorizontally=t,t?this.classAdd("pcui-panel-horizontal"):this.classRemove("pcui-panel-horizontal"),this._reflow())}},{key:"content",get:function(){return this._containerContent}},{key:"header",get:function(){return this._containerHeader}},{key:"headerText",get:function(){return this._labelTitle.text},set:function(t){this._labelTitle.text=t}},{key:"headerSize",get:function(){return this._headerSize},set:function(t){this._headerSize=t;var e=this._containerHeader.dom.style;e.height=Math.max(0,t)+"px",e.lineHeight=e.height,this._reflow()}}])&&h(e.prototype,i),r&&h(e,r),f}(s.a);r.a.register("panel",g),e.a=g},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=function(t,e){if(0===t.length)return e.length;if(0===e.length)return t.length;if(t===e)return 0;var i,n,r=[];for(i=0;i<=e.length;i++)r[i]=[i];for(n=0;n<=t.length;n++)r[0][n]=n;for(i=1;i<=e.length;i++)for(n=1;n<=t.length;n++)e.charAt(i-1)===t.charAt(n-1)?r[i][n]=r[i-1][n-1]:r[i][n]=Math.min(r[i-1][n-1]+1,Math.min(r[i][n-1]+1,r[i-1][n]+1));return r[e.length][t.length]},r=function(t,e){if(t===e)return t.length;var i,n=0,r={};for(i=0;i<e.length;i++)r[e.charAt(i)]=!0;for(i=0;i<t.length;i++)r[t.charAt(i)]&&n++;return n},s=function(t){for(var e=[],i=t.replace(/([^A-Z])([A-Z][^A-Z])/g,"$1 $2").replace(/([A-Z0-9]{2,})/g," $1").split(/(\s|\-|_)/g),n=0;n<i.length;n++)i[n]=i[n].toLowerCase().trim(),i[n]&&"-"!==i[n]&&"_"!==i[n]&&e.push(i[n]);return e},a=function(t,e,i){for(var s=[],a=0;a<t.length;a++){var o=t[a];if(o.subFull===1/0)if(o.name!==e&&0!==o.name.indexOf(e)){if(!(r(e,o.name)/e.length<i.containsCharsTolerance)){for(var l=1/0,h=1/0,c=0;c<o.tokens.length;c++){if(o.tokens[c]===e){l=0,h=c;break}var u=n(e,o.tokens[c]);(h===1/0||u<l)&&-1!==o.tokens[c].indexOf(e)?(h=c,l=u):h===1/0&&u<l&&u/Math.max(e.length,o.tokens[c].length)<=i.editsDistanceTolerance&&(l=u)}l!==1/0&&(s.push(o),o.edits=o.edits===1/0?l:o.edits+l,o.sub=o.sub===1/0?h:o.sub+h)}}else s.push(o),o.edits===1/0&&(o.edits=0),o.sub===1/0&&(o.sub=0);else s.push(o),o.edits===1/0&&(o.edits=0),o.sub===1/0&&(o.sub=o.subFull)}return s},o=function(t,e,i){var n;if(!(e=(e||"").toLowerCase().trim()))return[];var r=s(e);if(!r.length)return[];(i=i||{}).containsCharsTolerance=i.containsCharsTolerance||.5,i.editsDistanceTolerance=i.editsDistanceTolerance||.5;var o=[];for(n=0;n<t.length;n++){var l=t[n][0].toLowerCase().trim().indexOf(e);o.push({name:t[n][0],item:t[n][1],tokens:s(t[n][0]),edits:1/0,subFull:-1!==l?l:1/0,sub:1/0})}for(n=0;n<r.length;n++)o=a(o,r[n],i);for(o.sort((function(t,e){return t.subFull!==e.subFull?t.subFull-e.subFull:t.sub!==e.sub?t.sub-e.sub:t.edits!==e.edits?t.edits-e.edits:t.name.length-e.name.length})),n=0;n<o.length;n++)o[n]=o[n].item;return i.hasOwnProperty("limitResults")&&o.length>i.limitResults&&(o=o.slice(0,i.limitResults)),o}},function(t,e,i){"use strict";var n=i(1),r=i(3),s=i(2),a=function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e||(e={}),this._menu=new s.a({dom:e.dom}),this._menu.contextMenu=this,this.args=e,this._menu.class.add("pcui-contextmenu");var n,a=this._menu,o=function t(){i._menu.class.remove("pcui-contextmenu-active"),document.removeEventListener("click",t)},l=e.triggerElement||e.dom.parentElement;l&&(this._contextMenuEvent=l.addEventListener("contextmenu",(function(t){t.preventDefault(),t.stopPropagation(),a.class.add("pcui-contextmenu-active");var i=27*e.items.length,n=t.clientX,r=t.clientY;i+r>window.innerHeight&&(r-=i+r-window.innerHeight),150+n>window.innerWidth&&(n-=150+n-window.innerWidth),a.dom.setAttribute("style","left: ".concat(n,"px; top: ").concat(r,"px")),document.addEventListener("click",o)})),a.dom.addEventListener("mouseleave",(function(){n=setTimeout((function(){o()}),500)})),a.dom.addEventListener("mouseenter",(function(){n&&clearTimeout(n)}))),e.items&&e.items.forEach((function(t,e){var n=new s.a;n.dom.setAttribute("style","top: ".concat(27*e,"px")),t.onClick&&n.on("click",(function(e){e.stopPropagation(),o(),t.onClick(e)}));var a=new r.a({text:t.text});n.append(a),i._menu.dom.append(n.dom),t.items&&(t.items.forEach((function(t,e){var i=new s.a({class:"pcui-contextmenu-child"});i.dom.setAttribute("style","top: ".concat(27*e,"px; left: 150px;")),i.on("click",(function(e){e.stopPropagation(),o(),t.onClick()}));var a=new r.a({text:t.text});i.append(a),n.append(i)})),n.class.add("pcui-contextmenu-parent")),n.dom.addEventListener("mouseover",(function(e){i._menu.forEachChild((function(t){return t.class.remove("pcui-contextmenu-parent-active")})),n.class.add("pcui-contextmenu-parent-active");var r=t.items?27*t.items.length:0,s=e.clientX+150>window.innerWidth?-148:150,a=0;e.clientY+r>window.innerHeight&&(a=27-r),n.forEachChild((function(t,e){0!==e&&t.dom.setAttribute("style","top: ".concat(a+27*(e-1),"px; left: ").concat(s,"px;"))}))}))}))};n.a.register("contextmenu",a),e.a=a},function(t,e,i){"use strict";var n=i(2),r=i(1),s=i(6),a=i(12);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=p(t);if(e){var r=p(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return d(this,i)}}function d(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?f(t):e}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(d,t);var e,i,n,o=u(d);function d(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,d),t||(t={}),(e=o.call(this,t)).class.add("pcui-treeview"),e._selectedItems=[],e._dragItems=[],e._allowDrag=void 0===t.allowDrag||t.allowDrag,e._allowReordering=void 0===t.allowReordering||t.allowReordering,e._allowRenaming=void 0!==t.allowRenaming&&t.allowRenaming,e._dragging=!1,e._dragOverItem=null,e._dragArea="inside",e._dragScroll=0,e._dragScrollInterval=null,e._dragHandle=new r.a(document.createElement("div"),{class:"pcui-treeview-drag-handle"}),e.append(e._dragHandle),e._onContextMenu=t.onContextMenu,e._onReparentFn=t.onReparent,e._pressedCtrl=!1,e._pressedShift=!1,e._filter=null,e._filterResults=[],e._wasDraggingAllowedBeforeFiltering=e._allowDrag,e._domEvtModifierKeys=e._updateModifierKeys.bind(f(e)),e._domEvtMouseLeave=e._onMouseLeave.bind(f(e)),e._domEvtDragMove=e._onDragMove.bind(f(e)),e._domEvtMouseMove=e._onMouseMove.bind(f(e)),window.addEventListener("keydown",e._domEvtModifierKeys),window.addEventListener("keyup",e._domEvtModifierKeys),window.addEventListener("mousedown",e._domEvtModifierKeys),e.dom.addEventListener("mouseleave",e._domEvtMouseLeave),e._dragHandle.dom.addEventListener("mousemove",e._domEvtDragMove),e._dragHandle.on("destroy",(function(t){t.removeEventListener("mousemove",e._domEvtDragMove)})),e}return e=d,(i=[{key:"_updateModifierKeys",value:function(t){this._pressedCtrl=t.ctrlKey||t.metaKey,this._pressedShift=t.shiftKey}},{key:"_findNextVisibleTreeItem",value:function(t){if(t.numChildren>0&&t.open)return t.firstChild;var e=t.nextSibling;if(e)return e;var i=t.parent;if(!(i instanceof s.a))return null;for(var n=i.nextSibling;!n&&(i=i.parent)instanceof s.a;)n=i.nextSibling;return n}},{key:"_findLastVisibleChildTreeItem",value:function(t){if(!t.numChildren||!t.open)return null;for(var e=t.lastChild;e&&e.numChildren&&e.open;)e=e.lastChild;return e}},{key:"_findPreviousVisibleTreeItem",value:function(t){var e=t.previousSibling;if(e)return e.numChildren>0&&e.open?this._findLastVisibleChildTreeItem(e):e;var i=t.parent;return i instanceof s.a?i:null}},{key:"_getChildrenRange",value:function(t,e){var i=[];if(this._filterResults.length)for(var n=this.dom.querySelectorAll(".".concat("pcui-treeview","-item.").concat("pcui-treeview-filtering-result")),r=-1,s=-1,a=0;a<n.length;a++){var o=n[a].ui;if(o===t?r=a:o===e&&(s=a),-1!==r&&-1!==s){for(var l=r<s?s:r,h=r<s?r:s;h<=l;h++)i.push(n[h].ui);break}}else{var c=t,u=t.dom.getBoundingClientRect(),d=e.dom.getBoundingClientRect();if(u.top<d.top)for(;c&&c!==e;)(c=this._findNextVisibleTreeItem(c))&&c!==e&&i.push(c);else for(;c&&c!==e;)(c=this._findPreviousVisibleTreeItem(c))&&c!==e&&i.push(c);i.push(e)}return i}},{key:"_onAppendChild",value:function(t){h(p(d.prototype),"_onAppendChild",this).call(this,t),t instanceof s.a&&this._onAppendTreeViewItem(t)}},{key:"_onRemoveChild",value:function(t){t instanceof s.a&&this._onRemoveTreeViewItem(t),h(p(d.prototype),"_onRemoveChild",this).call(this,t)}},{key:"_onAppendTreeViewItem",value:function(t){var e=this;t.treeView=this,this._filter&&this._searchItems([[t.text,t]],this._filter),t.forEachChild((function(t){t instanceof s.a&&e._onAppendTreeViewItem(t)}))}},{key:"_onRemoveTreeViewItem",value:function(t){var e=this;t.selected=!1,t.forEachChild((function(t){t instanceof s.a&&e._onRemoveTreeViewItem(t)}))}},{key:"_onChildKeyDown",value:function(t,e){if(-1!==[9,37,38,39,40].indexOf(t.keyCode))if(t.preventDefault(),t.stopPropagation(),40===t.keyCode){if(this._selectedItems.length){var i=this._findNextVisibleTreeItem(e);i&&(this._pressedShift||this._pressedCtrl?i.selected=!0:this._selectSingleItem(i))}}else if(38===t.keyCode){if(this._selectedItems.length){var n=this._findPreviousVisibleTreeItem(e);n&&(this._pressedShift||this._pressedCtrl?n.selected=!0:this._selectSingleItem(n))}}else 37===t.keyCode?e.parent!==this&&(e.open=!1):39===t.keyCode?e.open=!0:t.keyCode}},{key:"_onChildClick",value:function(t,e){if(0===t.button&&e.allowSelect)if(this._pressedCtrl)e.selected=!e.selected;else if(this._pressedShift){if(!this._selectedItems.length||1===this._selectedItems.length&&this._selectedItems[0]===e)return void(e.selected=!0);var i=this._selectedItems[this._selectedItems.length-1];this._openHierarchy(i),this._getChildrenRange(i,e).forEach((function(t){t.allowSelect&&(t.selected=!0)}))}else this._selectSingleItem(e)}},{key:"_traverseDepthFirst",value:function(t){function e(i){if(i&&i instanceof s.a&&(t(i),i.numChildren))for(var n=0;n<i.dom.childNodes.length;n++)e(i.dom.childNodes[n].ui)}for(var i=0;i<this.dom.childNodes.length;i++)e(this.dom.childNodes[i].ui)}},{key:"_updateTreeOrder",value:function(){var t=0;this._traverseDepthFirst((function(e){e._treeOrder=t++}))}},{key:"_getChildIndex",value:function(t,e){return Array.prototype.indexOf.call(e.dom.childNodes,t.dom)-1}},{key:"_onChildDragStart",value:function(t,e){if(this.allowDrag&&!this._dragging&&(this._dragItems=[],e.parent!==this)){if(-1!==this._selectedItems.indexOf(e)){for(var i=[],n=-1,r=0;r<this._selectedItems.length;r++){for(var a=this._selectedItems[r].parent,o=0,l=!1;a&&a instanceof s.a;){if(-1!==this._selectedItems.indexOf(a)){l=!0;break}o++,a=a.parent}if(!l){if(-1===n)n=o;else if(n!==o)return;i.push(this._selectedItems[r])}}this._dragItems=i}else e.class.add("pcui-treeview-item-dragged"),this._dragItems.push(e);this._dragItems.length&&(this._dragItems.forEach((function(t){t.class.add("pcui-treeview-item-dragged")})),this.isDragging=!0,this.emit("dragstart",this._dragItems.slice()))}}},{key:"_onChildDragEnd",value:function(t,e){var i=this;if(this.allowDrag&&this._dragging){if(this._dragItems.forEach((function(t){return t.class.remove("pcui-treeview-item-dragged")})),this._dragOverItem&&(this._dragItems.length>1&&this._dragItems.length>1&&(this._updateTreeOrder(),this._dragItems.sort((function(t,e){return t._treeOrder-e._treeOrder}))),this._dragItems.length)){var n=[],r=this._dragOverItem;this._dragItems.forEach((function(t){if(t.parent!==i._dragOverItem||"inside"!==i._dragArea){var e=t.parent,s=null,a=i._getChildIndex(t,e),o=0;i._onReparentFn||t.parent.remove(t),"before"===i._dragArea?(s=i._dragOverItem.parent,i._onReparentFn?(o=i._getChildIndex(i._dragOverItem,s),s===e&&a<o&&o--):(i._dragOverItem.parent.appendBefore(t,i._dragOverItem),o=i._getChildIndex(t,s))):"inside"===i._dragArea?(s=i._dragOverItem,i._onReparentFn?o=s.dom.childNodes.length-1:(i._dragOverItem.append(t),i._dragOverItem.open=!0,o=i._getChildIndex(t,s))):"after"===i._dragArea&&(s=i._dragOverItem.parent,i._onReparentFn?(o=i._getChildIndex(r,s),(s!==e||a>o)&&o++):(i._dragOverItem.parent.appendAfter(t,r),o=i._getChildIndex(t,s)),r=t),n.push({item:t,newParent:s,newChildIndex:o,oldParent:e})}})),n.length&&(this._onReparentFn&&this._onReparentFn(n),this.emit("reparent",n))}this._dragItems=[],this.isDragging=!1,this.emit("dragend")}}},{key:"_onChildDragOver",value:function(t,e){this._allowDrag&&this._dragging&&(e.allowDrop&&-1===this._dragItems.indexOf(e)?this._dragOverItem=e:this._dragOverItem=null,this._updateDragHandle(),this._onDragMove(t))}},{key:"_onMouseLeave",value:function(t){this._allowDrag&&this._dragging&&(this._dragOverItem=null,this._updateDragHandle())}},{key:"_onMouseMove",value:function(t){if(this._dragging){var e=this.dom.getBoundingClientRect();this._dragScroll=0,t.clientY-e.top<32&&this.dom.scrollTop>0?this._dragScroll=-1:e.bottom-t.clientY<32&&this.dom.scrollHeight-(e.height+this.dom.scrollTop)>0&&(this._dragScroll=1)}}},{key:"_scrollWhileDragging",value:function(){this._dragging&&0!==this._dragScroll&&(this.dom.scrollTop+=8*this._dragScroll,this._dragOverItem=null,this._updateDragHandle())}},{key:"_onDragMove",value:function(t){if(t.preventDefault(),t.stopPropagation(),this._allowDrag&&this._dragOverItem){var e=this._dragHandle.dom.getBoundingClientRect(),i=Math.floor((t.clientY-e.top)/e.height*5),n=this._dragArea,r=this._dragOverItem;if(this._dragOverItem.parent===this){for(var s=!1,a=0;a<this._dragItems.length;a++)if(this._dragItems[a].parent===this._dragOverItem){s=!0,this._dragOverItem=null;break}s||(this._dragArea="inside")}else{for(var o=!1,l=0;l<this._dragItems.length;l++)if(this._dragItems[l].dom.contains(this._dragOverItem.dom)){o=!0;break}if(o)this._dragOverItem=null;else if(this._allowReordering&&i<=1&&-1===this._dragItems.indexOf(this._dragOverItem.previousSibling))this._dragArea="before";else if(this._allowReordering&&i>=4&&-1===this._dragItems.indexOf(this._dragOverItem.nextSibling)&&(0===this._dragOverItem.numChildren||!this._dragOverItem.open))this._dragArea="after";else{var h=!1;if(this._allowReordering&&this._dragOverItem.open)for(var c=0;c<this._dragItems.length;c++)if(this._dragItems[c].parent===this._dragOverItem){h=!0,this._dragArea="before";break}h||(this._dragArea="inside")}}n===this._dragArea&&r===this._dragOverItem||this._updateDragHandle()}}},{key:"_updateDragHandle",value:function(t,e){if(e||this._allowDrag&&this._dragging)if(t||(t=this._dragOverItem),t&&!t.hidden&&t.parentsOpen){var i=t._containerContents.dom.getBoundingClientRect();this._dragHandle.hidden=!1,this._dragHandle.class.remove("after","before","inside"),this._dragHandle.class.add(this._dragArea);var n=i.top,r=i.left,s=i.width;if(this.dom.parentElement){var a=this.dom.parentElement.getBoundingClientRect();r=Math.max(r,a.left),s=Math.min(s,this.dom.parentElement.clientWidth-r+a.left)}this._dragHandle.style.top=n+"px",this._dragHandle.style.left=r+"px",this._dragHandle.style.width=s-7+"px"}else this._dragHandle.hidden=!0}},{key:"_openHierarchy",value:function(t){t.parentsOpen=!0}},{key:"_selectSingleItem",value:function(t){for(var e=this._selectedItems.length,i=!1;e--;)this._selectedItems[e]&&this._selectedItems[e]!==t&&(this._selectedItems[e].selected=!1,i=!0);t.selected=!!i||!t.selected}},{key:"_onChildSelected",value:function(t){this._selectedItems.push(t),this._openHierarchy(t),this.emit("select",t)}},{key:"_onChildDeselected",value:function(t){var e=this._selectedItems.indexOf(t);-1!==e&&(this._selectedItems.splice(e,1),this.emit("deselect",t))}},{key:"_onChildRename",value:function(t,e){if(this._filter){t.class.remove("pcui-treeview-filtering-result");var i=this._filterResults.indexOf(t);-1!==i&&this._filterResults.splice(i,1),this._searchItems([[t.text,t]],this._filter)}this.emit("rename",t,e)}},{key:"_searchItems",value:function(t,e){var i=this,n=Object(a.a)(t,e);n.length&&n.forEach((function(t){i._filterResults.push(t),t.class.add("pcui-treeview-filtering-result")}))}},{key:"_applyFilter",value:function(t){this._clearFilter(),this._wasDraggingAllowedBeforeFiltering=this._allowDrag,this._allowDrag=!1,this.class.add("pcui-treeview-filtering");var e=[];this._traverseDepthFirst((function(t){e.push([t.text,t])})),this._searchItems(e,t)}},{key:"_clearFilter",value:function(){this._filterResults.forEach((function(t){t.destroyed||t.class.remove("pcui-treeview-filtering-result")})),this._filterResults.length=0,this.class.remove("pcui-treeview-filtering"),this._allowDrag=this._wasDraggingAllowedBeforeFiltering}},{key:"showDragHandle",value:function(t){this._updateDragHandle(t,!0)}},{key:"deselect",value:function(){for(var t=this._selectedItems.length;t--;)this._selectedItems[t]&&(this._selectedItems[t].selected=!1)}},{key:"clearTreeItems",value:function(){for(var t=this.dom.childNodes.length;t--;){var e=this.dom.childNodes[t];if(e){var i=e.ui;i instanceof s.a&&i.destroy()}}this._selectedItems=[],this._dragItems=[],this._allowDrag=this._wasDraggingAllowedBeforeFiltering}},{key:"destroy",value:function(){this._destroyed||(window.removeEventListener("keydown",this._domEvtModifierKeys),window.removeEventListener("keyup",this._domEvtModifierKeys),window.removeEventListener("mousedown",this._domEvtModifierKeys),window.removeEventListener("mousemove",this._domEvtMouseMove),this.dom.removeEventListener("mouseleave",this._domEvtMouseLeave),this._dragScrollInterval&&(clearInterval(this._dragScrollInterval),this._dragScrollInterval=null),h(p(d.prototype),"destroy",this).call(this))}},{key:"allowDrag",get:function(){return this._allowDrag},set:function(t){this._allowDrag=t,this._filter&&(this._wasDraggingAllowedBeforeFiltering=t)}},{key:"allowReordering",get:function(){return this._allowReordering},set:function(t){this._allowReordering=t}},{key:"allowRenaming",get:function(){return this._allowRenaming},set:function(t){this._allowRenaming=t}},{key:"isDragging",get:function(){return this._dragging},set:function(t){this._dragging!==t&&(t?(this._dragging=!0,this._updateDragHandle(),this.scrollable&&(window.removeEventListener("mousemove",this._domEvtMouseMove),window.addEventListener("mousemove",this._domEvtMouseMove),this._dragScrollInterval||(this._dragScrollInterval=setInterval(this._scrollWhileDragging.bind(this),1e3/60)))):(this._dragOverItem=null,this._updateDragHandle(),this._dragging=!1,window.removeEventListener("mousemove",this._domEvtMouseMove),this._dragScrollInterval&&(clearInterval(this._dragScrollInterval),this._dragScrollInterval=null)))}},{key:"selected",get:function(){return this._selectedItems.slice()}},{key:"filter",get:function(){return this._filter},set:function(t){this._filter!==t&&(this._filter=t,t?this._applyFilter(t):this._clearFilter())}},{key:"pressedCtrl",get:function(){return this._pressedCtrl}},{key:"pressedShift",get:function(){return this._pressedShift}}])&&l(e.prototype,i),n&&l(e,n),d}(n.a);e.a=m},function(t,e,i){"use strict";var n=i(1),r=i(0);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=d(t);if(e){var r=d(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}function c(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(c,t);var e,i,n,s=h(c);function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),t=Object.assign({tabIndex:0},t),e=s.call(this,t.dom?t.dom:document.createElement("div"),t),"toggle"===t.type?e.class.add("pcui-boolean-input-toggle"):e.class.add("pcui-boolean-input"),e.class.add(r.n),e._domEventKeyDown=e._onKeyDown.bind(u(e)),e._domEventFocus=e._onFocus.bind(u(e)),e._domEventBlur=e._onBlur.bind(u(e)),e.dom.addEventListener("keydown",e._domEventKeyDown),e.dom.addEventListener("focus",e._domEventFocus),e.dom.addEventListener("blur",e._domEventBlur),e._value=null,void 0!==t.value&&(e.value=t.value),e.renderChanges=t.renderChanges,e}return e=c,(i=[{key:"_onClick",value:function(t){return this.enabled&&this.focus(),this.enabled&&!this.readOnly&&(this.value=!this.value),o(d(c.prototype),"_onClick",this).call(this,t)}},{key:"_onKeyDown",value:function(t){27!==t.keyCode?this.enabled&&!this.readOnly&&32===t.keyCode&&(t.stopPropagation(),t.preventDefault(),this.value=!this.value):this.blur()}},{key:"_onFocus",value:function(){this.emit("focus")}},{key:"_onBlur",value:function(){this.emit("blur")}},{key:"_updateValue",value:function(t){return this.class.remove(r.m),t!==this.value&&(this._value=t,t?this.class.add("pcui-boolean-input-ticked"):this.class.remove("pcui-boolean-input-ticked"),this.renderChanges&&this.flash(),this.emit("change",t),!0)}},{key:"focus",value:function(){this.dom.focus()}},{key:"blur",value:function(){this.dom.blur()}},{key:"destroy",value:function(){this._destroyed||(this.dom.removeEventListener("keydown",this._domEventKeyDown),this.dom.removeEventListener("focus",this._domEventFocus),this.dom.removeEventListener("blur",this._domEventBlur),o(d(c.prototype),"destroy",this).call(this))}},{key:"value",get:function(){return this._value},set:function(t){this._updateValue(t)&&this._binding&&this._binding.setValue(t)}},{key:"values",set:function(t){for(var e=!1,i=t[0],n=1;n<t.length;n++)if(t[n]!==i){e=!0;break}e?(this._updateValue(null),this.class.add(r.m)):this._updateValue(t[0])}}])&&a(e.prototype,i),n&&a(e,n),c}(n.a);n.a.register("boolean",f,{renderChanges:!0}),e.a=f},function(t,e,i){"use strict";var n=i(1),r=i(10),s=i(0);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,i,n){return(l="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,n){var r,s=u(t,e);if(s){if((r=Object.getOwnPropertyDescriptor(s,e)).set)return r.set.call(n,i),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(n,e)){if(!r.writable)return!1;r.value=i,Object.defineProperty(n,e,r)}else!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(n,e,i);return!0})(t,e,i,n)}function h(t,e,i,n,r){if(!l(t,e,i,n||t)&&r)throw new Error("failed to set property");return i}function c(t,e,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=u(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function u(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=g(t);if(e){var r=g(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return p(this,i)}}function p(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?m(t):e}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var v=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(l,t);var e,i,n,a=f(l);function l(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l);var i=(t=Object.assign({},t)).binding;delete t.binding,(e=a.call(this,t.dom?t.dom:document.createElement("div"),t)).class.add("pcui-vector-input");var n=Math.max(2,Math.min(4,t.dimensions||3)),s=e._onInputChange.bind(m(e));e._inputs=new Array(n);for(var o=0;o<e._inputs.length;o++)e._inputs[o]=new r.a({min:t.min,max:t.max,precision:t.precision,step:t.step,renderChanges:t.renderChanges,placeholder:t.placeholder?Array.isArray(t.placeholder)?t.placeholder[o]:t.placeholder:null}),e._inputs[o].on("change",s),e._inputs[o].on("focus",(function(){e.emit("focus")})),e._inputs[o].on("blur",(function(){e.emit("blur")})),e.dom.appendChild(e._inputs[o].dom),e._inputs[o].parent=m(e);return i&&(e.binding=i),e._applyingChange=!1,void 0!==t.value&&(e.value=t.value),e}return e=l,(i=[{key:"_onInputChange",value:function(){if(!this._applyingChange){for(var t=!1,e=0;e<this._inputs.length;e++)if(this._inputs[e].class.contains(s.m)){t=!0;break}t?this.class.add(s.m):this.class.remove(s.m),this.emit("change",this.value)}}},{key:"_updateValue",value:function(t){if(this.class.remove(s.m),JSON.stringify(this.value)===JSON.stringify(t))return!1;this._applyingChange=!0;for(var e=0;e<this._inputs.length;e++){var i=this._inputs[e].binding,n=!1;i&&(n=i.applyingChange,i.applyingChange=!0),this._inputs[e].value=t&&void 0!==t[e]?t[e]:null,i&&(i.applyingChange=n)}return this.emit("change",this.value),this._applyingChange=!1,!0}},{key:"link",value:function(t,e){var i=this;if(c(g(l.prototype),"link",this).call(this,t,e),t=Array.isArray(t)?t:[t],1===(e=Array.isArray(e)?e:[e]).length||t.length!==e.length)for(var n=0;n<this._inputs.length;n++)this._inputs[n].link(t,e[0]+".".concat(n));else for(var r=function(n){i._inputs[n].link(t,e.map((function(t){return"".concat(t,".").concat(n)})))},s=0;s<this._inputs.length;s++)r(s)}},{key:"unlink",value:function(){c(g(l.prototype),"unlink",this).call(this);for(var t=0;t<this._inputs.length;t++)this._inputs[t].unlink()}},{key:"focus",value:function(){this._inputs[0].focus()}},{key:"blur",value:function(){for(var t=0;t<this._inputs.length;t++)this._inputs[t].blur()}},{key:"value",get:function(){for(var t=new Array(this._inputs.length),e=0;e<this._inputs.length;e++)t[e]=this._inputs[e].value;return t},set:function(t){if("string"==typeof t)try{if(t=JSON.parse(t),Array.isArray(t)&&t.some((function(t){return!Number.isFinite(t)})))throw new Error("VectorInput value set to string which doesn't contain an array of numbers")}catch(e){console.error(e),t=[]}Array.isArray(t)||(t=[]),this._updateValue(t)&&this._binding&&this._binding.setValue(t)}},{key:"values",set:function(t){t=this._inputs.map((function(e,i){return t.map((function(t){return t[i]}))})),this._inputs.forEach((function(e,i){e.values=t[i]}))}},{key:"binding",get:function(){return c(g(l.prototype),"binding",this)},set:function(t){h(g(l.prototype),"binding",t,this,!0);for(var e=0;e<this._inputs.length;e++)this._inputs[e].binding=t?t.clone():null}},{key:"placeholder",get:function(){return this._inputs.map((function(t){return t.placeholder}))},set:function(t){for(var e=0;e<this._inputs.length;e++)this._inputs[e].placeholder=t[e]||t||null}},{key:"inputs",get:function(){return this._inputs.slice()}}])&&o(e.prototype,i),n&&o(e,n),l}(n.a);["min","max","precision","step","renderChanges"].forEach((function(t){Object.defineProperty(v.prototype,t,{get:function(){return this._inputs[0][t]},set:function(e){for(var i=0;i<this._inputs.length;i++)this._inputs[i][t]=e}})})),n.a.register("vec2",v,{dimensions:2,renderChanges:!0}),n.a.register("vec3",v,{dimensions:3,renderChanges:!0}),n.a.register("vec4",v,{dimensions:4,renderChanges:!0}),e.a=v},function(t,e,i){"use strict";var n=i(7),r=i(1),s=i(2),a=i(11),o=i(10),l=i(9);function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,i,n){return(u="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,n){var r,s=f(t,e);if(s){if((r=Object.getOwnPropertyDescriptor(s,e)).set)return r.set.call(n,i),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(n,e)){if(!r.writable)return!1;r.value=i,Object.defineProperty(n,e,r)}else!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(n,e,i);return!0})(t,e,i,n)}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=f(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function f(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_(t)););return t}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=_(t);if(e){var r=_(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return g(this,i)}}function g(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?v(t):e}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(g,t);var e,i,h,f=m(g);function g(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,g);var i=(t=Object.assign({},t)).binding;delete t.binding;var n=new s.a({dom:t.dom,flex:!0});(e=f.call(this,n.dom,t))._container=n,e._container.parent=v(e),e.class.add("pcui-array-input","pcui-array-empty"),e._usePanels=t.usePanels||!1,e._fixedSize=!!t.fixedSize,e._inputSize=new o.a({class:["pcui-array-input-size"],placeholder:"Array Size",value:0,hideSlider:!0,step:1,precision:0,min:0,readOnly:e._fixedSize}),e._inputSize.on("change",e._onSizeChange.bind(v(e))),e._inputSize.on("focus",e._onFocus.bind(v(e))),e._inputSize.on("blur",e._onBlur.bind(v(e))),e._suspendSizeChangeEvt=!1,e._container.append(e._inputSize),e._containerArray=new s.a({class:"pcui-array-input-items",hidden:!0}),e._containerArray.on("append",(function(){e._containerArray.hidden=!1})),e._containerArray.on("remove",(function(){e._containerArray.hidden=0==e._arrayElements.length})),e._container.append(e._containerArray),e._suspendArrayElementEvts=!1,e._arrayElementChangeTimeout=null,e._getDefaultFn=t.getDefaultFn||null;var r=t.elementArgs&&t.elementArgs.type||t.type;return g.DEFAULTS.hasOwnProperty(r)||(r="string"),delete t.dom,e._valueType=r,e._elementType=t.type,e._elementArgs=t.elementArgs||t,e._arrayElements=[],e.binding=i,e._values=[],t.value&&(e.value=t.value),e.renderChanges=t.renderChanges||!1,e}return e=g,(i=[{key:"_onSizeChange",value:function(t){var e=this;if(0===t?this.class.add("pcui-array-empty"):this.class.remove("pcui-array-empty"),null!==t&&!this._suspendSizeChangeEvt){var i,r=function(){if(e._getDefaultFn)i=e._getDefaultFn();else if(i=g.DEFAULTS[e._valueType],"curveset"===e._valueType){if(i=n.a.deepCopy(i),Array.isArray(e._elementArgs.curves))for(var t=0;t<e._elementArgs.curves.length;t++)i.keys.push([0,0])}else if("gradient"===e._valueType&&(i=n.a.deepCopy(i),e._elementArgs.channels))for(var r=0;r<e._elementArgs.channels;r++)i.keys.push([0,1])},s=this._values.map((function(s){if(s)if(s.length<t){for(var a=new Array(t-s.length),o=0;o<a.length;o++)a[o]=n.a.deepCopy(g.DEFAULTS[e._valueType]),void 0===i&&r(),a[o]=n.a.deepCopy(i);s=s.concat(a)}else{for(var l=new Array(t),h=0;h<t;h++)l[h]=n.a.deepCopy(s[h]);s=l}else{s=new Array(t);for(var c=0;c<t;c++)s[c]=n.a.deepCopy(g.DEFAULTS[e._valueType]),void 0===i&&r(),s[c]=n.a.deepCopy(i)}return s}));if(!s.length){for(var a=new Array(t),o=0;o<t;o++)a[o]=n.a.deepCopy(g.DEFAULTS[this._valueType]),void 0===i&&r(),a[o]=n.a.deepCopy(i);s.push(a)}this._updateValues(s,!0)}}},{key:"_onFocus",value:function(){this.emit("focus")}},{key:"_onBlur",value:function(){this.emit("blur")}},{key:"_createArrayElement",value:function(){var t,e=this,i=Object.assign({},this._elementArgs);i.binding?i.binding=i.binding.clone():this._binding&&(i.binding=this._binding.clone()),i.renderChanges=!1,t=this._usePanels?new a.a({headerText:"[".concat(this._arrayElements.length,"]"),removable:!this._fixedSize,collapsible:!0,class:["pcui-array-input-item","pcui-array-input-item-"+this._elementType]}):new s.a({flex:!0,flexDirection:"row",alignItems:"center",class:["pcui-array-input-item","pcui-array-input-item-"+this._elementType]}),"json"===this._elementType&&i.attributes&&(i.attributes=i.attributes.map((function(t){if(!t.path)return t;var i=(t=Object.assign({},t)).path.split(".");return i.splice(i.length-1,0,e._arrayElements.length),t.path=i.join("."),t})));var n=r.a.create(this._elementType,i);t.append(n),n.renderChanges=this.renderChanges;var o={container:t,element:n};if(this._arrayElements.push(o),this._usePanels)t.on("click:remove",(function(){e._removeArrayElement(o)}));else if(!this._fixedSize){var h=new l.a({icon:"E289",size:"small",class:"pcui-array-input-item-delete",tabIndex:-1});h.on("click",(function(){e._removeArrayElement(o)})),t.append(h)}return n.on("change",(function(t){e._onArrayElementChange(o,t)})),this._containerArray.append(t),o}},{key:"_removeArrayElement",value:function(t){var e=this._arrayElements.indexOf(t);if(-1!==e){var i=this._values.map((function(t){return t?(t.splice(e,1),t):null}));this._updateValues(i,!0)}}},{key:"_onArrayElementChange",value:function(t,e){var i=this;if(!this._suspendArrayElementEvts){var n=this._arrayElements.indexOf(t);-1!==n&&(this._values.forEach((function(t){t&&t.length>n&&(t[n]=e)})),this._arrayElementChangeTimeout=setTimeout((function(){i._arrayElementChangeTimeout=null,i.emit("change",i.value)})))}}},{key:"_linkArrayElement",value:function(t,e){var i=this._binding.observers,n=this._binding.paths,r=1===n.length||i.length!==n.length;t.unlink(),t.value=null,this.emit("unlinkElement",t,e);var s=r?n[0]+".".concat(e):n.map((function(t){return"".concat(t,".").concat(e)}));t.link(i,s),this.emit("linkElement",t,e,s)}},{key:"_updateValues",value:function(t,e){this._values=t||[],this._suspendArrayElementEvts=!0,this._suspendSizeChangeEvt=!0,e&&this._binding&&this._binding.setValues(t);var i=[],n=[];t.forEach((function(t){t&&(n.push(t.length),t.forEach((function(t,e){i[e]||(i[e]=[]),i[e].push(t)})))}));for(var r=-1,s=0;s<i.length&&i[s].length===t.length;s++)this._arrayElements[s]||this._createArrayElement(),this._binding&&this._binding.observers?this._linkArrayElement(this._arrayElements[s].element,s):i[s].length>1?this._arrayElements[s].element.values=i[s]:this._arrayElements[s].element.value=i[s][0],r=s;for(var a=this._arrayElements.length-1;a>r;a--)this._arrayElements[a].container.destroy(),this._arrayElements.splice(a,1);this._inputSize.values=n,this._suspendSizeChangeEvt=!1,this._suspendArrayElementEvts=!1,this._arrayElementChangeTimeout&&(clearTimeout(this._arrayElementChangeTimeout),this._arrayElementChangeTimeout=null),this.emit("change",this.value)}},{key:"focus",value:function(){this._inputSize.focus()}},{key:"blur",value:function(){this._inputSize.blur()}},{key:"forEachArrayElement",value:function(t){this._containerArray.forEachChild((function(e,i){return t(e.dom.firstChild.ui,i)}))}},{key:"destroy",value:function(){this._destroyed||(this._arrayElements.length=0,d(_(g.prototype),"destroy",this).call(this))}},{key:"binding",get:function(){return d(_(g.prototype),"binding",this)},set:function(t){!function(t,e,i,n,r){if(!u(t,e,i,n||t)&&r)throw new Error("failed to set property")}(_(g.prototype),"binding",t,this,!0),this._arrayElements.forEach((function(e){e.element.binding=t?t.clone():null}))}},{key:"value",get:function(){return this._arrayElements.map((function(t){return t.element.value}))},set:function(t){Array.isArray(t)||(t=[null]);var e=this.value||[];n.a.arrayEquals(e,t)||this._updateValues(new Array(this._values.length||1).fill(t),!0)}},{key:"values",set:function(t){n.a.arrayEquals(this._values,t)||this._updateValues(t,!1)}},{key:"renderChanges",get:function(){return this._renderChanges},set:function(t){this._renderChanges=t,this._arrayElements.forEach((function(e){e.element.renderChanges=t}))}}])&&c(e.prototype,i),h&&c(e,h),g}(r.a);for(var b in y.DEFAULTS={boolean:!1,number:0,string:"",vec2:[0,0],vec3:[0,0,0],vec4:[0,0,0,0]},y.DEFAULTS)r.a.register("array:".concat(b),y,{type:b,renderChanges:!0});r.a.register("array:select",y,{type:"select",renderChanges:!0}),e.a=y},function(t,e,i){"use strict";var n=i(1);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=l(t);if(e){var r=l(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return o(this,i)}}function o(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(i,t);var e=a(i);function i(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t||(t={}),(n=e.call(this,t.dom?t.dom:document.createElement("div"),t)).class.add("pcui-divider"),n}return i}(n.a);n.a.register("divider",h),e.a=h},function(t,e,i){"use strict";var n=i(2),r=i(1);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=c(t);if(e){var r=c(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return h(this,i)}}function h(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(h,t);var e,i,n,s=l(h);function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),t||(t={}),(e=s.call(this,t)).class.add("pcui-infobox"),e._titleElement=new r.a,e._textElement=new r.a,e.append(e._titleElement),e.append(e._textElement),e._unsafe=t.unsafe||!1,e.icon=t.icon||"",e.title=t.title||"",e.text=t.text||"",e}return e=h,(i=[{key:"icon",get:function(){return this._icon},set:function(t){this._icon!==t&&(this._icon=t,t?this.dom.setAttribute("data-icon",String.fromCodePoint(parseInt(t,16))):this.dom.removeAttribute("data-icon"))}},{key:"title",get:function(){return this._title},set:function(t){this._title!==t&&(this._title=t,this._unsafe?this._titleElement.dom.innerHTML=t:this._titleElement.dom.textContent=t)}},{key:"text",get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._unsafe?this._textElement.dom.innerHTML=t:this._textElement.dom.textContent=t)}}])&&a(e.prototype,i),n&&a(e,n),h}(n.a);r.a.register("infobox",u),e.a=u},function(t,e,i){"use strict";var n=i(1),r=i(2);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=d(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=d(t);if(e){var r=d(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}function c(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(s,t);var e,i,n,r=h(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t||(t={}),(e=r.call(this,t)).class.add("pcui-overlay"),e._domClickableOverlay=document.createElement("div"),e._domClickableOverlay.ui=u(e),e._domClickableOverlay.classList="pcui-overlay-inner",e.dom.appendChild(e._domClickableOverlay),e._domEventMouseDown=e._onMouseDown.bind(u(e)),e._domClickableOverlay.addEventListener("mousedown",e._domEventMouseDown),e.domContent=document.createElement("div"),e.domContent.ui=u(e),e.domContent.classList.add("pcui-overlay-content"),e.dom.appendChild(e.domContent),e.clickable=t.clickable||!1,e.transparent=t.transparent||!1,e}return e=s,(i=[{key:"_onMouseDown",value:function(t){var e=this;this.clickable&&(document.body.blur(),requestAnimationFrame((function(){e.hidden=!0})),t.preventDefault())}},{key:"position",value:function(t,e){var i=this._domClickableOverlay.getBoundingClientRect(),n=this.domContent.getBoundingClientRect();t=Math.max(0,Math.min(i.width-n.width,t)),e=Math.max(0,Math.min(i.height-n.height,e)),this.domContent.style.position="absolute",this.domContent.style.left="".concat(t,"px"),this.domContent.style.top="".concat(e,"px")}},{key:"destroy",value:function(){this._destroyed||(this._domClickableOverlay.removeEventListener("mousedown",this._domEventMouseDown),o(d(s.prototype),"destroy",this).call(this))}},{key:"clickable",get:function(){return this.class.contains("pcui-overlay-clickable")},set:function(t){t?this.class.add("pcui-overlay-clickable"):this.class.remove("pcui-overlay-clickable")}},{key:"transparent",get:function(){return this.class.contains("pcui-overlay-transparent")},set:function(t){t?this.class.add("pcui-overlay-transparent"):this.class.remove("pcui-overlay-transparent")}}])&&a(e.prototype,i),n&&a(e,n),s}(r.a);n.a.register("overlay",f),e.a=f},function(t,e,i){"use strict";var n=i(1),r=i(2);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=c(t);if(e){var r=c(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return h(this,i)}}function h(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(h,t);var e,i,r,s=l(h);function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),t||(t={}),(e=s.call(this,t)).class.add("pcui-progress"),e._inner=new n.a,e.append(e._inner),e._inner.class.add("pcui-progress-inner"),void 0!==t.value&&(e.value=t.value),e}return e=h,(i=[{key:"value",get:function(){return this._value},set:function(t){this._value!==t&&(this._value=t,this._inner.width="".concat(this._value,"%"),this.emit("change",t))}}])&&a(e.prototype,i),r&&a(e,r),h}(r.a);n.a.register("progress",u),e.a=u},function(t,e,i){"use strict";var n=i(1),r=i(2),s=i(8),a=i(9),o=i(3),l=i(0),h=i(12);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=v(t);if(e){var r=v(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return m(this,i)}}function m(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?g(t):e}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(m,t);var e,i,n,c=p(m);function m(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,m),t||(t={});var i=new r.a({dom:t.dom});return(e=c.call(this,i.dom,t))._container=i,e._container.parent=g(e),e.class.add("pcui-select-input"),e._containerValue=new r.a({class:"pcui-select-input-container-value"}),e._container.append(e._containerValue),e._domShadow=document.createElement("div"),e._domShadow.classList.add("pcui-select-input-shadow"),e._containerValue.append(e._domShadow),e._allowInput=t.allowInput||!1,e._allowInput&&e.class.add("pcui-select-input-allow-input"),e._allowCreate=t.allowCreate||!1,e._createFn=t.createFn,e._createLabelText=t.createLabelText||null,e._labelValue=new o.a({class:"pcui-select-input-value",tabIndex:0}),e._labelValue.on("click",e._onValueClick.bind(g(e))),e._containerValue.append(e._labelValue),e._timeoutLabelValueTabIndex=null,e._labelIcon=new o.a({class:"pcui-select-input-icon",hidden:t.allowInput&&t.multiSelect}),e._containerValue.append(e._labelIcon),e._input=new s.a({class:"pcui-select-input-textinput",blurOnEnter:!1,keyChange:!0}),e._containerValue.append(e._input),e._lastInputValue="",e._suspendInputChange=!1,e._input.on("change",e._onInputChange.bind(g(e))),e._input.on("keydown",e._onInputKeyDown.bind(g(e))),e._input.on("focus",e._onFocus.bind(g(e))),e._input.on("blur",e._onBlur.bind(g(e))),t.placeholder&&(e.placeholder=t.placeholder),e._containerOptions=new r.a({class:"pcui-select-input-list",hidden:!0}),e._containerValue.append(e._containerOptions),e._containerTags=new r.a({class:"pcui-select-input-tags",flex:!0,flexDirection:"row",hidden:!0}),e._container.append(e._containerTags),t.multiSelect&&(e.class.add("pcui-select-input-multi"),e._containerTags.hidden=!1),e._domEvtKeyDown=e._onKeyDown.bind(g(e)),e._domEvtFocus=e._onFocus.bind(g(e)),e._domEvtBlur=e._onBlur.bind(g(e)),e._domEvtMouseDown=e._onMouseDown.bind(g(e)),e._domEvtWindowMouseDown=e._onWindowMouseDown.bind(g(e)),e._domEvtWheel=e._onWheel.bind(g(e)),e._labelValue.dom.addEventListener("keydown",e._domEvtKeyDown),e._labelValue.dom.addEventListener("focus",e._domEvtFocus),e._labelValue.dom.addEventListener("blur",e._domEvtBlur),e._labelValue.dom.addEventListener("mousedown",e._domEvtMouseDown),e._containerOptions.dom.addEventListener("wheel",e._domEvtWheel,{passive:!0}),e.on("hide",e.close.bind(g(e))),e._type=t.type||"string",e._optionsIndex={},e._labelsIndex={},e._labelHighlighted=null,e.invalidOptions=t.invalidOptions,e.options=t.options||[],e._optionsFn=t.optionsFn,e._allowNull=t.allowNull||!1,e._values=null,void 0!==t.value?e.value=t.value:t.defaultValue?e.value=t.defaultValue:e.value=null,e.renderChanges=t.renderChanges||!1,e.on("change",(function(){e._updateInputFieldsVisibility(),e.renderChanges&&!e.multiSelect&&e._labelValue.flash()})),e._updateInputFieldsVisibility(!1),e}return e=m,(i=[{key:"_initializeCreateLabel",value:function(){var t=this,e=new r.a({class:"pcui-select-input-create-new",flex:!0,flexDirection:"row"}),i=new o.a({text:this._input.value,tabIndex:-1});e.append(i);var n=this._input.on("change",(function(n){i.destroyed||(i.text=n,t.invalidOptions&&-1!==t.invalidOptions.indexOf(n)?e.hidden||(e.hidden=!0,t._resizeShadow()):e.hidden&&(e.hidden=!1,t._resizeShadow()))}));e.on("click",(function(e){e.stopPropagation();var n=i.text;t.focus(),t.close(),t._createFn?t._createFn(n):n&&t._onSelectValue(n)})),i.on("destroy",(function(){n.unbind(),n=null}));var s=new o.a({text:this._createLabelText});return e.append(s),this._containerOptions.append(e),e}},{key:"_convertSingleValue",value:function(t){if(null===t&&this._allowNull)return t;if("string"===this._type)t=t?t.toString():"";else if("number"===this._type)t=t?parseInt(t,10):0;else if("boolean"===this._type)return!!t;return t}},{key:"_convertValue",value:function(t){var e=this;return null===t&&this._allowNull?t:this.multiSelect?Array.isArray(t)?t.map((function(t){return e._convertSingleValue(t)})):t:this._convertSingleValue(t)}},{key:"_onValueClick",value:function(){this.enabled&&!this.readOnly&&this.toggle()}},{key:"_onSelectValue",value:function(t){if(t=this._convertSingleValue(t),this.multiSelect)if(this._values){var e=!1;this._values.forEach((function(i){i?-1===i.indexOf(t)&&(i.push(t),e=!0):(i=[t],e=!0)})),e&&(this._onMultipleValuesChange(this._values),this.emit("change",this.value),this._binding&&this._binding.addValues([t]))}else this._value&&Array.isArray(this._value)?-1===this._value.indexOf(t)&&(this._value.push(t),this._addTag(t),this.emit("change",this.value),this._binding&&this._binding.addValues([t])):this.value=[t];else this.value=t}},{key:"_highlightLabel",value:function(t){if(this._labelHighlighted!==t&&(this._labelHighlighted&&this._labelHighlighted.class.remove("pcui-select-input-label-highlighted"),this._labelHighlighted=t,this._labelHighlighted)){this._labelHighlighted.class.add("pcui-select-input-label-highlighted");var e=this._labelHighlighted.dom.offsetTop,i=this._containerOptions.dom.scrollTop;e<i?this._containerOptions.dom.scrollTop=e:e+this._labelHighlighted.height>this._containerOptions.height+i&&(this._containerOptions.dom.scrollTop=e+this._labelHighlighted.height-this._containerOptions.height)}}},{key:"_onValueChange",value:function(t){var e=this;if(this.multiSelect){if(this._labelValue.value="",this._containerTags.clear(),this._containerTags.class.add("pcui-select-input-tags-empty"),t&&Array.isArray(t))for(var i in t.forEach((function(t){e._addTag(t),e._labelsIndex[t]&&e._labelsIndex[t].class.add("pcui-selected")})),this._labelsIndex)-1!==t.indexOf(this._convertSingleValue(i))?this._labelsIndex[i].class.add("pcui-selected"):this._labelsIndex[i].class.remove("pcui-selected")}else for(var n in this._labelValue.value=this._optionsIndex[t]||"",t=""+t,this._labelsIndex)n===t?this._labelsIndex[n].class.add("pcui-selected"):this._labelsIndex[n].class.remove("pcui-selected")}},{key:"_onMultipleValuesChange",value:function(t){var e=this;this._labelValue.value="",this._containerTags.clear(),this._containerTags.class.add("pcui-select-input-tags-empty");var i={},n={};for(var r in t.forEach((function(t){t&&t.forEach((function(t){i[t]?n[t]++:(i[t]=e._addTag(t),n[t]=1)}))})),n)n[r]!==t.length&&(i[r].class.add("pcui-select-input-tag-not-everywhere"),this._labelsIndex[r]&&this._labelsIndex[r].class.remove("pcui-selected"))}},{key:"_addTag",value:function(t){var e=this,i=new r.a({flex:!0,flexDirection:"row",class:"pcui-select-input-tag"});i.append(new o.a({text:this._optionsIndex[t]||t}));var n=new a.a({size:"small",icon:"E132",tabIndex:-1});return i.append(n),n.on("click",(function(){return e._removeTag(i,t)})),this._containerTags.append(i),this._containerTags.class.remove("pcui-select-input-tags-empty"),this._labelsIndex[t]&&this._labelsIndex[t].class.add("pcui-selected"),i.value=t,i}},{key:"_removeTag",value:function(t,e){if(t.destroy(),this._labelsIndex[e]&&this._labelsIndex[e].class.remove("pcui-selected"),this._values)this._values.forEach((function(t){if(t){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}}));else if(this._value&&Array.isArray(this._value)){var i=this._value.indexOf(e);-1!==i&&this._value.splice(i,1)}this.emit("change",this.value),this._binding&&this._binding.removeValues([e])}},{key:"_onInputChange",value:function(t){this._suspendInputChange||this._lastInputValue!==t&&(this.open(),this._lastInputValue=t,this._filterOptions(t))}},{key:"_filterOptions",value:function(t){for(var e=this,i=this._containerOptions.dom;i.firstChild;)i.removeChild(i.lastChild);if(t){var n=this.options.map((function(t){return[t.t,t.v]}));Object(h.a)(n,t).forEach((function(t){i.appendChild(e._labelsIndex[t].dom)}))}else this.options.forEach((function(t){i.appendChild(e._labelsIndex[t.v].dom)}));this._createLabelContainer&&i.appendChild(this._createLabelContainer.dom),i.firstChild&&this._highlightLabel(i.firstChild.ui),this._resizeShadow()}},{key:"_onInputKeyDown",value:function(t){var e;if(13===t.keyCode&&this.enabled&&!this.readOnly&&(t.stopPropagation(),t.preventDefault(),void 0!==(e=this._labelHighlighted&&void 0!==this._labelHighlighted._optionValue?this._labelHighlighted._optionValue:this._input.value)))return this.focus(),this.close(),void(this._optionsIndex[e]?this._onSelectValue(e):this._allowCreate&&(this._createFn?this._createFn(e):this._onSelectValue(e)));this._onKeyDown(t)}},{key:"_onWindowMouseDown",value:function(t){this.dom.contains(t.target)||this.close()}},{key:"_onKeyDown",value:function(t){if(27!==t.keyCode)if(9!==t.keyCode){if(this.enabled&&!this.readOnly)if(13!==t.keyCode||this._allowInput){if(-1!==[38,40].indexOf(t.keyCode))if(t.stopPropagation(),t.preventDefault(),(this._allowInput||this.multiSelect)&&this._containerOptions.hidden)this.open();else if(this._containerOptions.hidden){if(!this._options.length)return;for(var e=-1,i=0;i<this._options.length;i++)if(this._options[i].v===this.value){e=i;break}38===t.keyCode?e--:40===t.keyCode&&e++,e>=0&&e<this._options.length&&this._onSelectValue(this._options[e].v)}else{if(!this._containerOptions.dom.childNodes.length)return;if(this._labelHighlighted){var n=this._labelHighlighted.dom;do{38===t.keyCode?n=n.previousSibling:40===t.keyCode&&(n=n.nextSibling)}while(n&&n.ui.hidden);n&&this._highlightLabel(n.ui)}else this._highlightLabel(this._containerOptions.dom.childNodes[0].ui)}}else this._labelHighlighted&&void 0!==this._labelHighlighted._optionValue&&(this._onSelectValue(this._labelHighlighted._optionValue),this.close())}else this.close();else this.close()}},{key:"_resizeShadow",value:function(){this._domShadow.style.height=this._containerValue.height+this._containerOptions.height+"px"}},{key:"_onMouseDown",value:function(){this._allowInput||this.focus()}},{key:"_onFocus",value:function(){this.class.add(l.h),this.emit("focus"),this._input.hidden||this.open()}},{key:"_onBlur",value:function(){this.class.remove(l.h),this.emit("blur")}},{key:"_onWheel",value:function(t){t.stopPropagation()}},{key:"_updateInputFieldsVisibility",value:function(t){var e=this,i=!1,n=!1;this._allowInput&&(t?(i=!0,n=!0):i=this.multiSelect||!this._labelsIndex[this.value]),this._labelValue.hidden=i,this._labelIcon.hidden=i,this._input.hidden=!i,n&&this._input.focus(),this._labelValue.hidden||(this._labelValue.tabIndex=-1,this._timeoutLabelValueTabIndex||(this._timeoutLabelValueTabIndex=requestAnimationFrame((function(){e._timeoutLabelValueTabIndex=null,e._labelValue.tabIndex=0}))))}},{key:"focus",value:function(){this._input.hidden?this._labelValue.dom.focus():this._input.focus()}},{key:"blur",value:function(){this._allowInput?this._input.blur():this._labelValue.dom.blur()}},{key:"open",value:function(){var t=this;if(this._containerOptions.hidden&&this.enabled&&!this.readOnly&&(this._updateInputFieldsVisibility(!0),this._optionsFn&&(this.options=this._optionsFn()),0!==this._containerOptions.dom.childNodes.length)){this._containerOptions.forEachChild((function(e){e.hidden=!1,e._optionValue===t.value&&t._highlightLabel(e)})),this._labelHighlighted||this._highlightLabel(this._containerOptions.dom.childNodes[0].ui),this._containerOptions.hidden=!1,this.class.add("pcui-open"),window.addEventListener("keydown",this._domEvtKeyDown),window.addEventListener("mousedown",this._domEvtWindowMouseDown);var e=(this._allowInput?this._input.dom:this._labelValue.dom).getBoundingClientRect(),i=e.bottom+this._containerOptions.height+25>=window.innerHeight;i&&e.top-this._containerOptions.height<0&&(i=!1,this._containerOptions.style.maxHeight=window.innerHeight-e.bottom-25+"px"),i?this.class.add("pcui-select-input-fit-height"):this.class.remove("pcui-select-input-fit-height"),this._resizeShadow()}}},{key:"close",value:function(){this._containerOptions.style.maxHeight="",this._highlightLabel(null),this._updateInputFieldsVisibility(!1),this._suspendInputChange=!0,this._input.value="",this._lastInputValue&&(this._lastInputValue="",this._filterOptions(null)),this._suspendInputChange=!1,this._containerOptions.hidden||(this._containerOptions.hidden=!0,this._domShadow.style.height="",this.class.remove("pcui-open"),window.removeEventListener("keydown",this._domEvtKeyDown),window.removeEventListener("mousedown",this._domEvtWindowMouseDown))}},{key:"toggle",value:function(){this._containerOptions.hidden?this.open():this.close()}},{key:"unlink",value:function(){d(v(m.prototype),"unlink",this).call(this),this._containerOptions.hidden||this.close()}},{key:"destroy",value:function(){this._destroyed||(this._labelValue.dom.removeEventListener("keydown",this._domEvtKeyDown),this._labelValue.dom.removeEventListener("mousedown",this._domEvtMouseDown),this._labelValue.dom.removeEventListener("focus",this._domEvtFocus),this._labelValue.dom.removeEventListener("blur",this._domEvtBlur),this._containerOptions.dom.removeEventListener("wheel",this._domEvtWheel),window.removeEventListener("keydown",this._domEvtKeyDown),window.removeEventListener("mousedown",this._domEvtWindowMouseDown),this._timeoutLabelValueTabIndex&&(cancelAnimationFrame(this._timeoutLabelValueTabIndex),this._timeoutLabelValueTabIndex=null),d(v(m.prototype),"destroy",this).call(this))}},{key:"options",get:function(){return this._options.slice()},set:function(t){var e=this;this._options&&this._options===t||(this._containerOptions.clear(),this._labelHighlighted=null,this._optionsIndex={},this._labelsIndex={},this._options=t,this._options.forEach((function(t){if(e._optionsIndex[t.v]=t.t,""!==t.v){var i=new o.a({text:t.t,tabIndex:-1});i._optionValue=t.v,e._labelsIndex[t.v]=i,i.on("click",(function(i){i.stopPropagation(),e._onSelectValue(t.v),e.close()})),e._containerOptions.append(i)}})),this._createLabelContainer=null,this._createLabelText&&(this._createLabelContainer=this._initializeCreateLabel()),this.multiSelect&&this._values?this._onMultipleValuesChange(this._values):this._onValueChange(this.value),this._lastInputValue&&this._filterOptions(this._lastInputValue))}},{key:"invalidOptions",get:function(){return this._invalidOptions},set:function(t){this._invalidOptions=t||null}},{key:"multiSelect",get:function(){return this.class.contains("pcui-select-input-multi")}},{key:"value",get:function(){if(!this.multiSelect)return this._value;var t=[];return this._containerTags.dom.childNodes.forEach((function(e){t.push(e.ui.value)})),t},set:function(t){this._values=null,this._suspendInputChange=!0,this._input.value="",this._lastInputValue&&(this._lastInputValue="",this._filterOptions(null)),this._suspendInputChange=!1,this.class.remove(l.m),t=this._convertValue(t),(!(this._value===t||this.multiSelect&&this._value&&this._value.equals(t))||null===t&&this._allowNull&&this.class.contains(l.m))&&(this._value=t,this._onValueChange(t),this.emit("change",t),this._binding&&this._binding.setValue(t))}},{key:"values",set:function(t){var e=!1,i=(t=t.map(this._convertValue.bind(this)))[0],n=this.multiSelect;this._values=null;for(var r=1;r<t.length;r++)if(!(t[r]===i||n&&t[r]&&t[r].equals(i))){e=!0;break}e?(this._labelValue.values=t,n?(this._values=t,this._value=null,this._onMultipleValuesChange(this._values),this.emit("change",this.value)):null!==this._value&&(this._value=null,this.emit("change",null)),this.class.add(l.m)):this.value=t[0]}},{key:"placeholder",get:function(){return this._input.placeholder},set:function(t){this._input.placeholder=t}}])&&u(e.prototype,i),n&&u(e,n),m}(n.a);n.a.register("select",_,{renderChanges:!0}),n.a.register("multiselect",_,{multiSelect:!0,renderChanges:!0}),n.a.register("tags",_,{allowInput:!0,allowCreate:!0,multiSelect:!0,renderChanges:!0}),e.a=_},function(t,e,i){"use strict";var n=i(1),r=i(10),s=i(0),a=i(7);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){c(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=v(t);if(e){var r=v(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return m(this,i)}}function m(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?g(t):e}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _=/Chrome\//.test(navigator.userAgent),y=["allowNull","max","min","keyChange","placeholder","precision","renderChanges","step"],b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(o,t);var e,i,n,a=p(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),t=Object.assign({},t);var i={};return y.forEach((function(e){i[e]=t[e]})),void 0===i.precision&&(i.precision=2),delete i.binding,e=a.call(this,t.dom?t.dom:document.createElement("div"),t),t.pre&&(e.precision=t.pre),e.class.add("pcui-slider"),e._historyCombine=!1,e._historyPostfix=null,e._numericInput=new r.a(h(h({},i),{},{hideSlider:!0})),e._numericInput.on("change",e._onValueChange.bind(g(e))),e._numericInput.on("focus",(function(){e.emit("focus")})),e._numericInput.on("blur",(function(){e.emit("blur")})),e._sliderMin=void 0!==t.sliderMin?t.sliderMin:e.min||0,e._sliderMax=void 0!==t.sliderMax?t.sliderMax:e.max||1,e.dom.appendChild(e._numericInput.dom),e._numericInput.parent=g(e),e._domSlider=document.createElement("div"),e._domSlider.classList.add("pcui-slider-container"),e.dom.appendChild(e._domSlider),e._domBar=document.createElement("div"),e._domBar.classList.add("pcui-slider-bar"),e._domBar.ui=g(e),e._domSlider.appendChild(e._domBar),e._domHandle=document.createElement("div"),e._domHandle.ui=g(e),e._domHandle.tabIndex=0,e._domHandle.classList.add("pcui-slider-handle"),e._domBar.appendChild(e._domHandle),e._cursorHandleOffset=0,e._domMouseDown=e._onMouseDown.bind(g(e)),e._domMouseMove=e._onMouseMove.bind(g(e)),e._domMouseUp=e._onMouseUp.bind(g(e)),e._domTouchStart=e._onTouchStart.bind(g(e)),e._domTouchMove=e._onTouchMove.bind(g(e)),e._domTouchEnd=e._onTouchEnd.bind(g(e)),e._domKeyDown=e._onKeyDown.bind(g(e)),e._touchId=null,e._domSlider.addEventListener("mousedown",e._domMouseDown),e._domSlider.addEventListener("touchstart",e._domTouchStart,{passive:!0}),e._domHandle.addEventListener("keydown",e._domKeyDown),void 0!==t.value&&(e.value=t.value),0===e.value&&e._updateHandle(0),e}return e=o,(i=[{key:"_onMouseDown",value:function(t){0===t.button&&this.enabled&&!this.readOnly&&this._onSlideStart(t.pageX)}},{key:"_onMouseMove",value:function(t){t.stopPropagation(),t.preventDefault(),this._onSlideMove(t.pageX)}},{key:"_onMouseUp",value:function(t){t.stopPropagation(),t.preventDefault(),this._onSlideEnd(t.pageX)}},{key:"_onTouchStart",value:function(t){if(this.enabled&&!this.readOnly)for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];if(i.target.ui&&i.target.ui===this){this._touchId=i.identifier,this._onSlideStart(i.pageX);break}}}},{key:"_onTouchMove",value:function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];if(i.identifier===this._touchId){t.stopPropagation(),t.preventDefault(),this._onSlideMove(i.pageX);break}}}},{key:"_onTouchEnd",value:function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];if(i.identifier===this._touchId){t.stopPropagation(),t.preventDefault(),this._onSlideEnd(i.pageX),this._touchId=null;break}}}},{key:"_onKeyDown",value:function(t){if(27!==t.keyCode){if(this.enabled&&!this.readOnly&&(37===t.keyCode||39===t.keyCode)){t.stopPropagation(),t.preventDefault();var e=37===t.keyCode?-1:1;t.shiftKey&&(e*=10),this.value+=e*this.step}}else this.blur()}},{key:"_updateHandle",value:function(t){var e=100*Math.max(0,Math.min(1,((t||0)-this._sliderMin)/(this._sliderMax-this._sliderMin))),i=this._domHandle.getBoundingClientRect().width;this._domHandle.style.left="calc(".concat(e,"% + ").concat(i/2,"px)")}},{key:"_onValueChange",value:function(t){this._updateHandle(t),this.emit("change",t),this._binding&&this._binding.setValue(t)}},{key:"_calculateCursorHandleOffset",value:function(t){var e=_?2:0,i=this._domHandle.getBoundingClientRect(),n=i.left-e,r=i.right;return this._cursorHandleOffset=t>=n&&t<=r?t-(n+(r-n)/2):0,this._cursorHandleOffset}},{key:"_onSlideStart",value:function(t){this._domHandle.focus(),null===this._touchId?(window.addEventListener("mousemove",this._domMouseMove),window.addEventListener("mouseup",this._domMouseUp)):(window.addEventListener("touchmove",this._domTouchMove),window.addEventListener("touchend",this._domTouchEnd)),this.class.add("pcui-slider-active"),this._calculateCursorHandleOffset(t)||this._onSlideMove(t),this.binding&&(this._historyCombine=this.binding.historyCombine,this._historyPostfix=this.binding.historyPostfix,this.binding.historyCombine=!0,this.binding.historyPostfix="(".concat(Date.now(),")"))}},{key:"_onSlideMove",value:function(t){var e=this._domBar.getBoundingClientRect();t-=this._cursorHandleOffset;var i=Math.max(0,Math.min(1,(t-e.left)/e.width))*(this._sliderMax-this._sliderMin)+this._sliderMin;i=parseFloat(i.toFixed(this.precision),10),this.value=i}},{key:"_onSlideEnd",value:function(t){this._calculateCursorHandleOffset(t)||this._onSlideMove(t),this.class.remove("pcui-slider-active"),null===this._touchId?(window.removeEventListener("mousemove",this._domMouseMove),window.removeEventListener("mouseup",this._domMouseUp)):(window.removeEventListener("touchmove",this._domTouchMove),window.removeEventListener("touchend",this._domTouchEnd)),this.binding&&(this.binding.historyCombine=this._historyCombine,this.binding.historyPostfix=this._historyPostfix,this._historyCombine=!1,this._historyPostfix=null)}},{key:"focus",value:function(){this._numericInput.focus()}},{key:"blur",value:function(){this._domHandle.blur(),this._numericInput.blur()}},{key:"destroy",value:function(){this._destroyed||(this._domSlider.removeEventListener("mousedown",this._domMouseDown),this._domSlider.removeEventListener("touchstart",this._domTouchStart),this._domHandle.removeEventListener("keydown",this._domKeyDown),this.dom.removeEventListener("mouseup",this._domMouseUp),this.dom.removeEventListener("mousemove",this._domMouseMove),this.dom.removeEventListener("touchmove",this._domTouchMove),this.dom.removeEventListener("touchend",this._domTouchEnd),d(v(o.prototype),"destroy",this).call(this))}},{key:"sliderMin",get:function(){return this._sliderMin},set:function(t){this._sliderMin!==t&&(this._sliderMin=t,this._updateHandle(this.value))}},{key:"sliderMax",get:function(){return this._sliderMax},set:function(t){this._sliderMax!==t&&(this._sliderMax=t,this._updateHandle(this.value))}},{key:"value",get:function(){return this._numericInput.value},set:function(t){this._numericInput.value=t,this._numericInput.class.contains(s.m)?this.class.add(s.m):this.class.remove(s.m)}},{key:"values",set:function(t){this._numericInput.values=t,this._numericInput.class.contains(s.m)?this.class.add(s.m):this.class.remove(s.m)}}])&&u(e.prototype,i),n&&u(e,n),o}(n.a);a.a.proxy(b,"_numericInput",y),n.a.register("slider",b,{renderChanges:!0}),e.a=b},function(t,e,i){"use strict";var n=i(1);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=l(t);if(e){var r=l(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return o(this,i)}}function o(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(i,t);var e=a(i);function i(t){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var r=null;return(t=Object.assign({type:i.TYPE_SMALL_THICK},t)).type===i.TYPE_SMALL_THICK&&(r=function(t,e){var i=e||document.createElementNS("http://www.w3.org/2000/svg","svg");return i.classList.add("spin"),i.setAttribute("width",t),i.setAttribute("height",t),i.setAttribute("viewBox","0 0 14 14"),i.setAttribute("fill","none"),i.innerHTML='<path d="M7 14C3.13871 14 0 10.8613 0 7C0 3.13871 3.13871 0 7 0C10.8613 0 14 3.13871 14 7C14 10.8613 10.8613 14 7 14ZM7 2.25806C4.38064 2.25806 2.25806 4.38064 2.25806 7C2.25806 9.61935 4.38064 11.7419 7 11.7419C9.61935 11.7419 11.7419 9.61935 11.7419 7C11.7419 4.38064 9.61935 2.25806 7 2.25806Z" fill="#773417"/><path class="pcui-spinner-highlight" d="M7 14V11.7419C9.61935 11.7419 11.7419 9.61935 11.7419 7H14C14 10.8613 10.8613 14 7 14Z" fill="#FF6600"/>',i}(t.size||12,t.dom)),(n=e.call(this,r,t)).class.add("pcui-spinner"),n}return i}(n.a);h.TYPE_SMALL_THICK="small-thick",e.a=h},function(t,e,i){"use strict";var n=i(1),r=i(8);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=c(t);if(e){var r=c(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return h(this,i)}}function h(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}(s,t);var e,i,n,r=l(s);function s(t){var e;switch(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t=Object.assign({input:document.createElement("textarea")},t),(e=r.call(this,t)).class.add("pcui-text-area-input"),t.resizable){case"both":e.class.add("pcui-text-area-input-resizable-both");break;case"horizontal":e.class.add("pcui-text-area-input-resizable-horizontal");break;case"vertical":e.class.add("pcui-text-area-input-resizable-vertical");break;case"none":default:e.class.add("pcui-text-area-input-resizable-none")}return e}return e=s,(i=[{key:"_onInputKeyDown",value:function(t){(27===t.keyCode&&this.blurOnEscape||13===t.keyCode&&this.blurOnEnter&&!t.shiftKey)&&this._domInput.blur(),this.emit("keydown",t)}}])&&a(e.prototype,i),n&&a(e,n),s}(r.a);n.a.register("text",u,{renderChanges:!0}),e.a=u},function(t,e,i){"use strict";var n=i(1),r=i(2),s=i(3);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=u(t);if(e){var r=u(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}function c(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(a,t);var e,i,n,r=h(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),t||(t={}),(e=r.call(this,t)).class.add("pcui-code"),e._inner=new s.a,e.append(e._inner),e._inner.class.add("pcui-code-inner"),t.text&&(e.text=t.text),e}return e=a,(i=[{key:"text",get:function(){return this._text},set:function(t){this._text=t,this._inner.text=t}}])&&o(e.prototype,i),n&&o(e,n),a}(r.a);n.a.register("code",d),e.a=d},function(t,e,i){"use strict";e.a=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},function(t,e,i){"use strict";
/** @license React v16.14.0
       * react.production.min.js
       *
       * Copyright (c) Facebook, Inc. and its affiliates.
       *
       * This source code is licensed under the MIT license found in the
       * LICENSE file in the root directory of this source tree.
       */function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r=i(29),s="function"==typeof Symbol&&Symbol.for,a=s?Symbol.for("react.element"):60103,o=s?Symbol.for("react.portal"):60106,l=s?Symbol.for("react.fragment"):60107,h=s?Symbol.for("react.strict_mode"):60108,c=s?Symbol.for("react.profiler"):60114,u=s?Symbol.for("react.provider"):60109,d=s?Symbol.for("react.context"):60110,f=s?Symbol.for("react.forward_ref"):60112,p=s?Symbol.for("react.suspense"):60113,m=s?Symbol.for("react.memo"):60115,g=s?Symbol.for("react.lazy"):60116,v="function"==typeof Symbol&&Symbol.iterator;function _(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function x(t,e,i){this.props=t,this.context=e,this.refs=b,this.updater=i||y}function w(){}function A(t,e,i){this.props=t,this.context=e,this.refs=b,this.updater=i||y}x.prototype.isReactComponent={},x.prototype.setState=function(t,e){if("object"!==n(t)&&"function"!=typeof t&&null!=t)throw Error(_(85));this.updater.enqueueSetState(this,t,e,"setState")},x.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},w.prototype=x.prototype;var C=A.prototype=new w;C.constructor=A,r(C,x.prototype),C.isPureReactComponent=!0;var I={current:null},S=Object.prototype.hasOwnProperty,M={key:!0,ref:!0,__self:!0,__source:!0};function T(t,e,i){var n,r={},s=null,o=null;if(null!=e)for(n in void 0!==e.ref&&(o=e.ref),void 0!==e.key&&(s=""+e.key),e)S.call(e,n)&&!M.hasOwnProperty(n)&&(r[n]=e[n]);var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){for(var h=Array(l),c=0;c<l;c++)h[c]=arguments[c+2];r.children=h}if(t&&t.defaultProps)for(n in l=t.defaultProps)void 0===r[n]&&(r[n]=l[n]);return{$$typeof:a,type:t,key:s,ref:o,props:r,_owner:I.current}}function P(t){return"object"===n(t)&&null!==t&&t.$$typeof===a}var E=/\/+/g,k=[];function D(t,e,i,n){if(k.length){var r=k.pop();return r.result=t,r.keyPrefix=e,r.func=i,r.context=n,r.count=0,r}return{result:t,keyPrefix:e,func:i,context:n,count:0}}function O(t){t.result=null,t.keyPrefix=null,t.func=null,t.context=null,t.count=0,10>k.length&&k.push(t)}function R(t,e,i){return null==t?0:function t(e,i,r,s){var l=n(e);"undefined"!==l&&"boolean"!==l||(e=null);var h=!1;if(null===e)h=!0;else switch(l){case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case a:case o:h=!0}}if(h)return r(s,e,""===i?"."+L(e,0):i),1;if(h=0,i=""===i?".":i+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=i+L(l=e[c],c);h+=t(l,u,r,s)}else if("function"==typeof(u=null===e||"object"!==n(e)?null:"function"==typeof(u=v&&e[v]||e["@@iterator"])?u:null))for(e=u.call(e),c=0;!(l=e.next()).done;)h+=t(l=l.value,u=i+L(l,c++),r,s);else if("object"===l)throw r=""+e,Error(_(31,"[object Object]"===r?"object with keys {"+Object.keys(e).join(", ")+"}":r,""));return h}(t,"",e,i)}function L(t,e){return"object"===n(t)&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+(""+t).replace(/[=:]/g,(function(t){return e[t]}))}(t.key):e.toString(36)}function N(t,e){t.func.call(t.context,e,t.count++)}function z(t,e,i){var n=t.result,r=t.keyPrefix;t=t.func.call(t.context,e,t.count++),Array.isArray(t)?B(t,n,i,(function(t){return t})):null!=t&&(P(t)&&(t=function(t,e){return{$$typeof:a,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(t,r+(!t.key||e&&e.key===t.key?"":(""+t.key).replace(E,"$&/")+"/")+i)),n.push(t))}function B(t,e,i,n,r){var s="";null!=i&&(s=(""+i).replace(E,"$&/")+"/"),R(t,z,e=D(e,s,n,r)),O(e)}var F={current:null};function j(){var t=F.current;if(null===t)throw Error(_(321));return t}var V={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:I,IsSomeRendererActing:{current:!1},assign:r};e.Children={map:function(t,e,i){if(null==t)return t;var n=[];return B(t,n,null,e,i),n},forEach:function(t,e,i){if(null==t)return t;R(t,N,e=D(null,null,e,i)),O(e)},count:function(t){return R(t,(function(){return null}),null)},toArray:function(t){var e=[];return B(t,e,null,(function(t){return t})),e},only:function(t){if(!P(t))throw Error(_(143));return t}},e.Component=x,e.Fragment=l,e.Profiler=c,e.PureComponent=A,e.StrictMode=h,e.Suspense=p,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,e.cloneElement=function(t,e,i){if(null==t)throw Error(_(267,t));var n=r({},t.props),s=t.key,o=t.ref,l=t._owner;if(null!=e){if(void 0!==e.ref&&(o=e.ref,l=I.current),void 0!==e.key&&(s=""+e.key),t.type&&t.type.defaultProps)var h=t.type.defaultProps;for(c in e)S.call(e,c)&&!M.hasOwnProperty(c)&&(n[c]=void 0===e[c]&&void 0!==h?h[c]:e[c])}var c=arguments.length-2;if(1===c)n.children=i;else if(1<c){h=Array(c);for(var u=0;u<c;u++)h[u]=arguments[u+2];n.children=h}return{$$typeof:a,type:t.type,key:s,ref:o,props:n,_owner:l}},e.createContext=function(t,e){return void 0===e&&(e=null),(t={$$typeof:d,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:u,_context:t},t.Consumer=t},e.createElement=T,e.createFactory=function(t){var e=T.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:f,render:t}},e.isValidElement=P,e.lazy=function(t){return{$$typeof:g,_ctor:t,_status:-1,_result:null}},e.memo=function(t,e){return{$$typeof:m,type:t,compare:void 0===e?null:e}},e.useCallback=function(t,e){return j().useCallback(t,e)},e.useContext=function(t,e){return j().useContext(t,e)},e.useDebugValue=function(){},e.useEffect=function(t,e){return j().useEffect(t,e)},e.useImperativeHandle=function(t,e,i){return j().useImperativeHandle(t,e,i)},e.useLayoutEffect=function(t,e){return j().useLayoutEffect(t,e)},e.useMemo=function(t,e){return j().useMemo(t,e)},e.useReducer=function(t,e,i){return j().useReducer(t,e,i)},e.useRef=function(t){return j().useRef(t)},e.useState=function(t){return j().useState(t)},e.version="16.14.0"},function(t,e,i){"use strict";
/*
      object-assign
      (c) Sindre Sorhus
      @license MIT
      */var n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,o,l=a(t),h=1;h<arguments.length;h++){for(var c in i=Object(arguments[h]))r.call(i,c)&&(l[c]=i[c]);if(n){o=n(i);for(var u=0;u<o.length;u++)s.call(i,o[u])&&(l[o[u]]=i[o[u]])}}return l}},function(t,e,i){"use strict";i.r(e),i.d(e,"BindingBase",(function(){return f})),i.d(e,"BindingElementToObservers",(function(){return x})),i.d(e,"BindingObserversToElement",(function(){return D})),i.d(e,"BindingTwoWay",(function(){return G})),i.d(e,"Events",(function(){return n.a})),i.d(e,"History",(function(){return K})),i.d(e,"Observer",(function(){return a})),i.d(e,"ObserverHistory",(function(){return Q})),i.d(e,"ObserverList",(function(){return tt}));var n=i(4);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(n.a.call(this),e=e||{},this._destroyed=!1,this._path="",this._keys=[],this._data={},this._pathsWithDuplicates=null,e.pathsWithDuplicates){this._pathsWithDuplicates={};for(var i=0;i<e.pathsWithDuplicates.length;i++)this._pathsWithDuplicates[e.pathsWithDuplicates[i]]=!0}this.patch(t),this._parent=e.parent||null,this._parentPath=e.parentPath||"",this._parentField=e.parentField||null,this._parentKey=e.parentKey||null,this._latestFn=e.latestFn||null,this._silent=!1;var r=function(t){return function(e,i,n,r){if(this._parent){var s,a=this._parentKey;!a&&this._parentField instanceof Array&&-1===(a=this._parentField.indexOf(this))||(e=this._parentPath+"."+a+"."+e,this._silent&&(s=this._parent.silence()),this._parent.emit(e+":"+t,i,n,r),this._parent.emit("*:"+t,e,i,n,r),this._silent&&this._parent.silenceRestore(s))}}};this.on("*:set",r("set")),this.on("*:unset",r("unset")),this.on("*:insert",r("insert")),this.on("*:remove",r("remove")),this.on("*:move",r("move"))}i(5),s._splitPathsCache={},s._splitPath=function(t){var e=s._splitPathsCache,i=e[t];return i?i=i.slice():(i=t.split("."),e[t]=i),i},s.prototype=Object.create(n.a.prototype),s.prototype.silence=function(){this._silent=!0;var t=this.history&&this.history.enabled;t&&(this.history.enabled=!1);var e=this.sync&&this.sync.enabled;return e&&(this.sync.enabled=!1),[t,e]},s.prototype.silenceRestore=function(t){this._silent=!1,t[0]&&(this.history.enabled=!0),t[1]&&(this.sync.enabled=!0)},s.prototype._prepare=function(t,e,i,n,a){var o,l,h=(t._path?t._path+".":"")+e,c=r(i);if(t._keys.push(e),"object"===c&&i instanceof Array){for(t._data[e]=i.slice(0),o=0;o<t._data[e].length;o++)"object"===r(t._data[e][o])&&null!==t._data[e][o]?t._data[e][o]instanceof Array?t._data[e][o].slice(0):t._data[e][o]=new s(t._data[e][o],{parent:this,parentPath:h,parentField:t._data[e],parentKey:null}):(l=this.silence(),this.emit(h+"."+o+":set",t._data[e][o],null,a),this.emit("*:set",h+"."+o,t._data[e][o],null,a),this.silenceRestore(l));n&&(l=this.silence()),this.emit(h+":set",t._data[e],null,a),this.emit("*:set",h,t._data[e],null,a),n&&this.silenceRestore(l)}else if("object"===c&&i instanceof Object){for(o in"object"!==r(t._data[e])&&(t._data[e]={_path:h,_keys:[],_data:{}}),i)"object"===r(i[o])?this._prepare(t._data[e],o,i[o],!0,a):(l=this.silence(),t._data[e]._data[o]=i[o],t._data[e]._keys.push(o),this.emit(h+"."+o+":set",i[o],null,a),this.emit("*:set",h+"."+o,i[o],null,a),this.silenceRestore(l));n&&(l=this.silence()),this.emit(h+":set",i,void 0,a),this.emit("*:set",h,i,void 0,a),n&&this.silenceRestore(l)}else n&&(l=this.silence()),t._data[e]=i,this.emit(h+":set",i,void 0,a),this.emit("*:set",h,i,void 0,a),n&&this.silenceRestore(l);return!0},s.prototype.set=function(t,e,i,n,a){var o,l,h,c,u=this,d=s._splitPath(t),f=d.length,p=d[f-1],m=this,g="",v=this;for(o=0;o<f-1;o++)m instanceof Array?(m=m[d[o]])instanceof s&&(t=d.slice(o+1).join("."),v=m):(o<f&&"object"!==r(m._data[d[o]])&&(m._data[d[o]]&&v.unset((m.__path?m.__path+".":"")+d[o]),m._data[d[o]]={_path:t,_keys:[],_data:{}},m._keys.push(d[o])),o===f-1&&m.__path&&(g=m.__path+"."+d[o]),m=m._data[d[o]]);if(m instanceof Array){var _=parseInt(p,10);if(m[_]===e&&!a)return;return l=(l=m[_])instanceof s?l.json():v.json(l),m[_]=e,e instanceof s&&(e._parent=v,e._parentPath=g,e._parentField=m,e._parentKey=null),i&&(h=v.silence()),v.emit(t+":set",e,l,n),v.emit("*:set",t,e,l,n),i&&v.silenceRestore(h),!0}if(m._data&&!m._data.hasOwnProperty(p))return"object"===r(e)?v._prepare(m,p,e,!1,n):(m._data[p]=e,m._keys.push(p),i&&(h=v.silence()),v.emit(t+":set",e,null,n),v.emit("*:set",t,e,null,n),i&&v.silenceRestore(h),!0);if("object"===r(e)&&e instanceof Array){if(e.equals(m._data[p])&&!a)return!1;if((l=m._data[p])instanceof s||(l=v.json(l)),m._data[p]&&m._data[p].length===e.length){for(h=v.silence(),0===e.length&&(m._data[p]=e),o=0;o<m._data[p].length;o++)m._data[p][o]instanceof s?m._data[p][o].patch(e[o],!0):m._data[p][o]!==e[o]&&(m._data[p][o]=e[o],v.emit(t+"."+o+":set",m._data[p][o],l&&l[o]||null,n),v.emit("*:set",t+"."+o,m._data[p][o],l&&l[o]||null,n));v.silenceRestore(h)}else{for(m._data[p]=[],e.forEach((function(t){u._doInsert(m,p,t)})),h=v.silence(),o=0;o<m._data[p].length;o++)v.emit(t+"."+o+":set",m._data[p][o],l&&l[o]||null,n),v.emit("*:set",t+"."+o,m._data[p][o],l&&l[o]||null,n);v.silenceRestore(h)}return i&&(h=v.silence()),v.emit(t+":set",e,l,n),v.emit("*:set",t,e,l,n),i&&v.silenceRestore(h),!0}if("object"===r(e)&&e instanceof Object){var y=!1;for(var b in(l=m._data[p])instanceof s||(l=v.json(l)),d=Object.keys(e),m._data[p]&&m._data[p]._data||(m._data[p]?v.unset((m.__path?m.__path+".":"")+p):y=!0,m._data[p]={_path:t,_keys:[],_data:{}}),m._data[p]._data)e.hasOwnProperty(b)?m._data[p]._data.hasOwnProperty(b)?v._equals(m._data[p]._data[b],e[b])||v.set(t+"."+b,e[b],!0)&&(y=!0):v._prepare(m._data[p],b,e[b],!0,n)&&(y=!0):v.unset(t+"."+b,!0)&&(y=!0);for(o=0;o<d.length;o++)void 0===e[d[o]]&&m._data[p]._data.hasOwnProperty(d[o])?v.unset(t+"."+d[o],!0)&&(y=!0):"object"===r(e[d[o]])?m._data[p]._data.hasOwnProperty(d[o])?v.set(t+"."+d[o],e[d[o]],!0)&&(y=!0):v._prepare(m._data[p],d[o],e[d[o]],!0,n)&&(y=!0):v._equals(m._data[p]._data[d[o]],e[d[o]])||("object"===r(e[d[o]])?v.set(m._data[p]._path+"."+d[o],e[d[o]],!0)&&(y=!0):m._data[p]._data[d[o]]!==e[d[o]]&&(y=!0,-1===m._data[p]._keys.indexOf(d[o])&&m._data[p]._keys.push(d[o]),m._data[p]._data[d[o]]=e[d[o]],h=v.silence(),v.emit(m._data[p]._path+"."+d[o]+":set",m._data[p]._data[d[o]],null,n),v.emit("*:set",m._data[p]._path+"."+d[o],m._data[p]._data[d[o]],null,n),v.silenceRestore(h)));if(y){i&&(h=v.silence());var x=v.json(m._data[p]);return v.emit(m._data[p]._path+":set",x,l,n),v.emit("*:set",m._data[p]._path,x,l,n),i&&v.silenceRestore(h),!0}return!1}return!((c=!m.hasOwnProperty("_data")&&m.hasOwnProperty(p)?m:m._data)[p]===e&&!a||(i&&(h=v.silence()),(l=c[p])instanceof s||(l=v.json(l)),c[p]=e,v.emit(t+":set",e,l,n),v.emit("*:set",t,e,l,n),i&&v.silenceRestore(h),0))},s.prototype.has=function(t){for(var e=s._splitPath(t),i=this,n=0,r=e.length;n<r;n++){if(null==i)return;i=i._data?i._data[e[n]]:i[e[n]]}return void 0!==i},s.prototype.get=function(t,e){for(var i=s._splitPath(t),n=this,r=0;r<i.length;r++){if(null==n)return;n=n._data?n._data[i[r]]:n[i[r]]}return e?n:null==n?null:this.json(n)},s.prototype.getRaw=function(t){return this.get(t,!0)},s.prototype._equals=function(t,e){return t===e||!!(t instanceof Array&&e instanceof Array&&t.equals(e))},s.prototype.unset=function(t,e,i){var n,r=s._splitPath(t),a=r[r.length-1],o=this,l=this;for(n=0;n<r.length-1;n++)o instanceof Array?(o=o[r[n]])instanceof s&&(t=r.slice(n+1).join("."),l=o):o=o._data[r[n]];if(!o._data||!o._data.hasOwnProperty(a))return!1;var h,c=o._data[a];if(c instanceof s||(c=l.json(c)),o._data[a]&&o._data[a]._data)for(n=o._data[a]._keys.length-1;n>=0;n--)l.unset(t+"."+o._data[a]._keys[n],!0);return o._keys.splice(o._keys.indexOf(a),1),delete o._data[a],e&&(h=l.silence()),l.emit(t+":unset",c,i),l.emit("*:unset",t,c,i),e&&l.silenceRestore(h),!0},s.prototype.remove=function(t,e,i,n){for(var r=s._splitPath(t),a=r[r.length-1],o=this,l=this,h=0;h<r.length-1;h++)if(o instanceof Array)(o=o[parseInt(r[h],10)])instanceof s&&(t=r.slice(h+1).join("."),l=o);else{if(!o._data||!o._data.hasOwnProperty(r[h]))return;o=o._data[r[h]]}if(o._data&&o._data.hasOwnProperty(a)&&o._data[a]instanceof Array){var c=o._data[a];if(!(c.length<e)){var u,d=c[e];return d instanceof s?d._parent=null:d=l.json(d),c.splice(e,1),i&&(u=l.silence()),l.emit(t+":remove",d,e,n),l.emit("*:remove",t,d,e,n),i&&l.silenceRestore(u),!0}}},s.prototype.removeValue=function(t,e,i,n){for(var r=s._splitPath(t),a=r[r.length-1],o=this,l=this,h=0;h<r.length-1;h++)if(o instanceof Array)(o=o[parseInt(r[h],10)])instanceof s&&(t=r.slice(h+1).join("."),l=o);else{if(!o._data||!o._data.hasOwnProperty(r[h]))return;o=o._data[r[h]]}if(o._data&&o._data.hasOwnProperty(a)&&o._data[a]instanceof Array){var c,u=o._data[a],d=u.indexOf(e);if(-1!==d&&!(u.length<d))return(e=u[d])instanceof s?e._parent=null:e=l.json(e),u.splice(d,1),i&&(c=l.silence()),l.emit(t+":remove",e,d,n),l.emit("*:remove",t,e,d,n),i&&l.silenceRestore(c),!0}},s.prototype.insert=function(t,e,i,n,r){for(var a=s._splitPath(t),o=a[a.length-1],l=this,h=this,c=0;c<a.length-1;c++)if(l instanceof Array)(l=l[parseInt(a[c],10)])instanceof s&&(t=a.slice(c+1).join("."),h=l);else{if(!l._data||!l._data.hasOwnProperty(a[c]))return;l=l._data[a[c]]}if(l._data&&l._data.hasOwnProperty(o)&&l._data[o]instanceof Array){var u,d=l._data[o];return e=h._doInsert(l,o,e,i),void 0===i&&(i=d.length-1),n&&(u=h.silence()),h.emit(t+":insert",e,i,r),h.emit("*:insert",t,e,i,r),n&&h.silenceRestore(u),!0}},s.prototype._doInsert=function(t,e,i,n){var a=t._data[e];"object"!==r(i)||i instanceof s||null===i||(i=i instanceof Array?i.slice(0):new s(i));var o=t._path?"".concat(t._path,".").concat(e):e;if(null===i||this._pathsWithDuplicates&&this._pathsWithDuplicates[o]||-1===a.indexOf(i))return void 0===n?a.push(i):a.splice(n,0,i),i instanceof s?(i._parent=this,i._parentPath=o,i._parentField=a,i._parentKey=null):i=this.json(i),i},s.prototype.move=function(t,e,i,n,r){for(var a=s._splitPath(t),o=a[a.length-1],l=this,h=this,c=0;c<a.length-1;c++)if(l instanceof Array)(l=l[parseInt(a[c],10)])instanceof s&&(t=a.slice(c+1).join("."),h=l);else{if(!l._data||!l._data.hasOwnProperty(a[c]))return;l=l._data[a[c]]}if(l._data&&l._data.hasOwnProperty(o)&&l._data[o]instanceof Array){var u=l._data[o];if(!(u.length<e||u.length<i||e===i)){var d,f=u[e];return u.splice(e,1),-1===i&&(i=u.length),u.splice(i,0,f),f instanceof s||(f=h.json(f)),n&&(d=h.silence()),h.emit(t+":move",f,i,e,r),h.emit("*:move",t,f,i,e,r),n&&h.silenceRestore(d),!0}}},s.prototype.patch=function(t,e){var i;if("object"===r(t)){for(i in t)"object"!==r(t[i])||this._data.hasOwnProperty(i)?this._data[i]!==t[i]&&this.set(i,t[i]):this._prepare(this,i,t[i]);if(e)for(i in this._data)t.hasOwnProperty(i)||this.unset(i)}},s.prototype.json=function(t){var e,i,n,s,a={},o=void 0===t?this:t;if(o instanceof Object&&o._keys){n=o._keys.length;for(var l=0;l<n;l++){e=o._keys[l];var h=o._data[e],c=r(h);if("object"===c&&h instanceof Array)for(a[e]=h.slice(0),s=a[e].length,i=0;i<s;i++)"object"===r(a[e][i])&&(a[e][i]=this.json(a[e][i]));else a[e]="object"===c&&h instanceof Object?this.json(h):h}}else{if(null===o)return null;if("object"===r(o)&&o instanceof Array)for(n=(a=o.slice(0)).length,i=0;i<n;i++)a[i]=this.json(a[i]);else if("object"===r(o))for(e in o)o.hasOwnProperty(e)&&(a[e]=o[e]);else a=o}return a},s.prototype.forEach=function(t,e,i){var n=e||this;i=i||"";for(var s=0;s<n._keys.length;s++){var a=n._keys[s],o=n._data[a],l=this.schema&&this.schema.has(i+a)&&this.schema.get(i+a).type.name.toLowerCase()||r(o);"object"===l&&o instanceof Array?t(i+a,"array",o,a):"object"===l&&o instanceof Object?(t(i+a,"object",o,a),this.forEach(t,o,i+a+".")):t(i+a,l,o,a)}},s.prototype.latest=function(){return this._latestFn?this._latestFn():this},s.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.emit("destroy"),this.unbind())},Object.defineProperty(s.prototype,"latestFn",{get:function(){return this._latestFn},set:function(t){this._latestFn=t}});var a=s;function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=d(t);if(e){var r=d(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return u(this,i)}}function u(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i(27);var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(s,t);var e,i,n,r=c(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t||(t={}),(e=r.call(this))._observers=null,e._paths=null,e._applyingChange=!1,e._element=t.element||null,e._history=t.history||null,e._historyPrefix=t.historyPrefix||null,e._historyPostfix=t.historyPostfix||null,e._historyName=t.historyName||null,e._historyCombine=t.historyCombine||!1,e._linked=!1,e}return e=s,(i=[{key:"_pathAt",value:function(t,e){return t[e]||t[0]}},{key:"link",value:function(t,e){this._observers&&this.unlink(),this._observers=Array.isArray(t)?t:[t],this._paths=Array.isArray(e)?e:[e],this._linked=!0}},{key:"unlink",value:function(){this._observers=null,this._paths=null,this._linked=!1}},{key:"clone",value:function(){throw new Error("pcui.BindingBase#clone: Not implemented")}},{key:"setValue",value:function(t){}},{key:"setValues",value:function(t){}},{key:"addValue",value:function(t){}},{key:"addValues",value:function(t){}},{key:"removeValue",value:function(t){}},{key:"removeValues",value:function(t){}},{key:"element",get:function(){return this._element},set:function(t){this._element=t}},{key:"applyingChange",get:function(){return this._applyingChange},set:function(t){this._applyingChange!==t&&(this._applyingChange=t,this.emit("applyingChange",t))}},{key:"linked",get:function(){return this._linked}},{key:"historyCombine",get:function(){return this._historyCombine},set:function(t){this._historyCombine=t}},{key:"historyName",get:function(){return this._historyName},set:function(t){this._historyName=t}},{key:"historyPrefix",get:function(){return this._historyPrefix},set:function(t){this._historyPrefix=t}},{key:"historyPostfix",get:function(){return this._historyPostfix},set:function(t){this._historyPostfix=t}},{key:"observers",get:function(){return this._observers}},{key:"paths",get:function(){return this._paths}}])&&l(e.prototype,i),n&&l(e,n),s}(n.a);function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=b(t);if(e){var r=b(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return y(this,i)}}function y(t,e){return!e||"object"!==p(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var x=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(s,t);var e,i,n,r=_(s);function s(){return m(this,s),r.apply(this,arguments)}return e=s,(i=[{key:"clone",value:function(){return new s({history:this._history,historyPrefix:this._historyPrefix,historyPostfix:this._historyPostfix,historyName:this._historyName,historyCombine:this._historyCombine})}},{key:"_getHistoryActionName",value:function(t){return"".concat(this._historyPrefix||"").concat(this._historyName||t[0]).concat(this._historyPostfix||"")}},{key:"_setValue",value:function(t,e){var i=this;if(!this.applyingChange&&this._observers){this.applyingChange=!0;var n=this._observers.slice(),r=this._paths.slice(),s=function(){i._setValueToObservers(n,r,t,e)};if(this._history){var a=[];a=1===n.length&&r.length>1?r.map((function(t){return n[0].has(t)?n[0].get(t):void 0})):n.map((function(t,e){var n=i._pathAt(r,e);return t.has(n)?t.get(n):void 0})),this._history.add({name:this._getHistoryActionName(r),redo:s,combine:this._historyCombine,undo:function(){i._setValueToObservers(n,r,a,!0)}})}s(),this.applyingChange=!1}}},{key:"_setValueToObservers",value:function(t,e,i,n){if(1===t.length&&e.length>1)for(var r=0;r<e.length;r++){var s=t[0].latest();if(s){var a=!1;s.history&&(a=s.history.enabled,s.history.enabled=!1);var o=e[r],l=i[r];void 0!==i?s.set(o,l):s.unset(o),a&&(s.history.enabled=!0)}}else for(var h=0;h<t.length;h++){var c=t[h].latest();if(c){var u=!1;c.history&&(u=c.history.enabled,c.history.enabled=!1);var d=this._pathAt(e,h),f=n?i[h]:i;void 0!==i?c.set(d,f):c.unset(d),u&&(c.history.enabled=!0)}}}},{key:"_addValues",value:function(t){var e=this;if(!this.applyingChange&&this._observers){this.applyingChange=!0;for(var i=this._observers.slice(),n=this._paths.slice(),r=[],s=function(s){var a=e._pathAt(n,s),o=i[s];t.forEach((function(t){-1===o.get(a).indexOf(t)&&r.push({observer:o,path:a,value:t})}))},a=0;a<i.length;a++)s(a);var o=function(){for(var t=0;t<r.length;t++){var e=r[t].observer.latest();if(e){var i=r[t].path,n=!1;e.history&&(n=e.history.enabled,e.history.enabled=!1),e.insert(i,r[t].value),n&&(e.history.enabled=!0)}}};this._history&&r.length&&this._history.add({name:this._getHistoryActionName(n),redo:o,combine:this._historyCombine,undo:function(){for(var t=0;t<r.length;t++){var e=r[t].observer.latest();if(e){var i=r[t].path,n=!1;e.history&&(n=e.history.enabled,e.history.enabled=!1),e.removeValue(i,r[t].value),n&&(e.history.enabled=!0)}}}}),o(),this.applyingChange=!1}}},{key:"_removeValues",value:function(t){var e=this;if(!this.applyingChange&&this._observers){this.applyingChange=!0;for(var i=this._observers.slice(),n=this._paths.slice(),r=[],s=function(s){var a=e._pathAt(n,s),o=i[s];t.forEach((function(t){var e=o.get(a).indexOf(t);-1!==e&&r.push({observer:o,path:a,value:t,index:e})}))},a=0;a<i.length;a++)s(a);var o=function(){for(var t=0;t<r.length;t++){var e=r[t].observer.latest();if(e){var i=r[t].path,n=!1;e.history&&(n=e.history.enabled,e.history.enabled=!1),e.removeValue(i,r[t].value),n&&(e.history.enabled=!0)}}};this._history&&r.length&&this._history.add({name:this._getHistoryActionName(n),redo:o,combine:this._historyCombine,undo:function(){for(var t=0;t<r.length;t++){var e=r[t].observer.latest();if(e){var i=r[t].path,n=!1;e.history&&(n=e.history.enabled,e.history.enabled=!1),-1===e.get(i).indexOf(r[t].value)&&e.insert(i,r[t].value,r[t].index),n&&(e.history.enabled=!0)}}}}),o(),this.applyingChange=!1}}},{key:"setValue",value:function(t){this._setValue(t,!1)}},{key:"setValues",value:function(t){t=t.slice().map((function(t){return Array.isArray(t)?t.slice():t})),this._setValue(t,!0)}},{key:"addValue",value:function(t){this._addValues([t])}},{key:"addValues",value:function(t){this._addValues(t)}},{key:"removeValue",value:function(t){this._removeValues([t])}},{key:"removeValues",value:function(t){this._removeValues(t)}}])&&g(e.prototype,i),n&&g(e,n),s}(f);function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t,e){if(null==t)return{};var i,n,r=function(t,e){if(null==t)return{};var i,n,r={},s=Object.keys(t);for(n=0;n<s.length;n++)i=s[n],e.indexOf(i)>=0||(r[i]=t[i]);return r}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function S(t,e,i){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=k(t);if(e){var r=k(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return P(this,i)}}function P(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?E(t):e}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(s,t);var e,i,n,r=T(s);function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.customUpdate,n=A(e,["customUpdate"]);return C(this,s),(t=r.call(this,n))._customUpdate=i,t._events=[],t._updateElementHandler=t._updateElement.bind(E(t)),t._updateTimeout=null,t}return e=s,(i=[{key:"_linkObserver",value:function(t,e){this._events.push(t.on(e+":set",this._deferUpdateElement.bind(this))),this._events.push(t.on(e+":unset",this._deferUpdateElement.bind(this))),this._events.push(t.on(e+":insert",this._deferUpdateElement.bind(this))),this._events.push(t.on(e+":remove",this._deferUpdateElement.bind(this)))}},{key:"_deferUpdateElement",value:function(){this.applyingChange||(this.applyingChange=!0,this._updateTimeout=setTimeout(this._updateElementHandler))}},{key:"_updateElement",value:function(){var t=this;this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=null),this._updateTimeout=null,this.applyingChange=!0,"function"==typeof this._customUpdate?this._customUpdate(this._element,this._observers,this._paths):1===this._observers.length?this._paths.length>1?this._element.value=this._paths.map((function(e){return t._observers[0].has(e)?t._observers[0].get(e):void 0})):this._element.value=this._observers[0].has(this._paths[0])?this._observers[0].get(this._paths[0]):void 0:this._element.values=this._observers.map((function(e,i){var n=t._pathAt(t._paths,i);return e.has(n)?e.get(n):void 0})),this.applyingChange=!1}},{key:"link",value:function(t,e){S(k(s.prototype),"link",this).call(this,t,e);var i=this._element.renderChanges;if(i&&(this._element.renderChanges=!1),this._updateElement(),i&&(this._element.renderChanges=i),1===this._observers.length&&this._paths.length>1)for(var n=0;n<this._paths.length;n++)this._linkObserver(this._observers[0],this._paths[n]);else for(var r=0;r<this._observers.length;r++)this._linkObserver(this._observers[r],this._pathAt(this._paths,r))}},{key:"unlink",value:function(){for(var t=0;t<this._events.length;t++)this._events[t].unbind();this._events.length=0,this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=null),S(k(s.prototype),"unlink",this).call(this)}},{key:"clone",value:function(){return new s}}])&&I(e.prototype,i),n&&I(e,n),s}(f);function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function L(t,e,i,n){return(L="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,n){var r,s=B(t,e);if(s){if((r=Object.getOwnPropertyDescriptor(s,e)).set)return r.set.call(n,i),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(n,e)){if(!r.writable)return!1;r.value=i,Object.defineProperty(n,e,r)}else!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(n,e,i);return!0})(t,e,i,n)}function N(t,e,i,n,r){if(!L(t,e,i,n||t)&&r)throw new Error("failed to set property");return i}function z(t,e,i){return(z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=B(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function B(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=U(t)););return t}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=U(t);if(e){var r=U(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return V(this,i)}}function V(t,e){return!e||"object"!==O(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function U(t){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var G=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(s,t);var e,i,n,r=j(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t||(t={}),(e=r.call(this,t))._bindingElementToObservers=t.bindingElementToObservers||new x(t),e._bindingObserversToElement=t.bindingObserversToElement||new D(t),e._applyingChange=!1,e._bindingElementToObservers.on("applyingChange",(function(t){e.applyingChange=t})),e._bindingObserversToElement.on("applyingChange",(function(t){e.applyingChange=t})),e}return e=s,(i=[{key:"link",value:function(t,e){z(U(s.prototype),"link",this).call(this,t,e),this._bindingElementToObservers.link(t,e),this._bindingObserversToElement.link(t,e)}},{key:"unlink",value:function(){this._bindingElementToObservers.unlink(),this._bindingObserversToElement.unlink(),z(U(s.prototype),"unlink",this).call(this)}},{key:"clone",value:function(){return new s({bindingElementToObservers:this._bindingElementToObservers.clone(),bindingObserversToElement:this._bindingObserversToElement.clone()})}},{key:"setValue",value:function(t){this._bindingElementToObservers.setValue(t)}},{key:"setValues",value:function(t){this._bindingElementToObservers.setValues(t)}},{key:"addValue",value:function(t){this._bindingElementToObservers.addValue(t)}},{key:"addValues",value:function(t){this._bindingElementToObservers.addValues(t)}},{key:"removeValue",value:function(t){this._bindingElementToObservers.removeValue(t)}},{key:"removeValues",value:function(t){this._bindingElementToObservers.removeValues(t)}},{key:"element",get:function(){return this._element},set:function(t){this._element=t,this._bindingElementToObservers.element=t,this._bindingObserversToElement.element=t}},{key:"applyingChange",get:function(){return z(U(s.prototype),"applyingChange",this)},set:function(t){z(U(s.prototype),"applyingChange",this)!==t&&(this._bindingElementToObservers.applyingChange=t,this._bindingObserversToElement.applyingChange=t,N(U(s.prototype),"applyingChange",t,this,!0))}},{key:"historyCombine",get:function(){return this._bindingElementToObservers.historyCombine},set:function(t){this._bindingElementToObservers.historyCombine=t}},{key:"historyPrefix",get:function(){return this._bindingElementToObservers.historyPrefix},set:function(t){this._bindingElementToObservers.historyPrefix=t}},{key:"historyPostfix",get:function(){return this._bindingElementToObservers.historyPostfix},set:function(t){this._bindingElementToObservers.historyPostfix=t}}])&&R(e.prototype,i),n&&R(e,n),s}(f);function W(t){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function H(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function X(t,e){return(X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=q(t);if(e){var r=q(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Y(this,i)}}function Y(t,e){return!e||"object"!==W(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var K=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(s,t);var e,i,n,r=Z(s);function s(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(t=r.call(this))._actions=[],t._currentActionIndex=-1,t._canUndo=!1,t._canRedo=!1,t}return e=s,(i=[{key:"add",value:function(t){if(t.name)if(t.undo)if(t.redo){if(this._currentActionIndex!==this._actions.length-1&&(this._actions=this._actions.slice(0,this._currentActionIndex+1)),t.combine&&this.currentAction&&this.currentAction.name===t.name)this.currentAction.redo=t.redo;else{var e=this._actions.push(t);this._currentActionIndex=e-1}this.emit("add",t.name),this.canUndo=!0,this.canRedo=!1}else console.error("Trying to add history action without redo method",t.name);else console.error("Trying to add history action without undo method",t.name);else console.error("Trying to add history action without name")}},{key:"undo",value:function(){if(this.canUndo){var t=this.currentAction.name;try{this.currentAction.undo()}catch(t){return console.info("%c(pcui.History#undo)","color: #f00"),void console.log(t.stack)}this._currentActionIndex--,this.emit("undo",t),this._currentActionIndex<0&&(this.canUndo=!1),this.canRedo=!0}}},{key:"redo",value:function(){if(this.canRedo){this._currentActionIndex++;try{this.currentAction.redo()}catch(t){return console.info("%c(pcui.History#redo)","color: #f00"),void console.log(t.stack)}this.emit("redo",this.currentAction.name),this.canUndo=!0,this._currentActionIndex===this._actions.length-1&&(this.canRedo=!1)}}},{key:"clear",value:function(){this._actions.length&&(this._actions.length=0,this._currentActionIndex=-1,this.canUndo=!1,this.canRedo=!1)}},{key:"currentAction",get:function(){return this._actions[this._currentActionIndex]||null}},{key:"lastAction",get:function(){return this._actions[this._actions.length-1]||null}},{key:"canUndo",get:function(){return this._canUndo},set:function(t){this._canUndo!==t&&(this._canUndo=t,this.emit("canUndo",t))}},{key:"canRedo",get:function(){return this._canRedo},set:function(t){this._canRedo!==t&&(this._canRedo=t,this.emit("canRedo",t))}}])&&H(e.prototype,i),n&&H(e,n),s}(n.a);function J(t){n.a.call(this),t=t||{},this.item=t.item,this._history=t.history,this._enabled=t.enabled||!0,this._prefix=t.prefix||"",this._combine=t.combine||!1,this._events=[],this._initialize()}J.prototype=Object.create(n.a.prototype),J.prototype._initialize=function(){var t=this;this._events.push(this.item.on("*:set",(function(e,i,n){if(t._enabled&&t._history){i instanceof a&&(i=i.json());var r={name:t._prefix+e,combine:t._combine,undo:function(){var i=t.item.latest();i&&(i.history.enabled=!1,void 0===n?i.unset(e):i.set(e,n),i.history.enabled=!0)},redo:function(){var n=t.item.latest();n&&(n.history.enabled=!1,void 0===i?n.unset(e):n.set(e,i),n.history.enabled=!0)}};t._history.add(r)}}))),this._events.push(this.item.on("*:unset",(function(e,i){if(t._enabled&&t._history){var n={name:t._prefix+e,combine:t._combine,undo:function(){var n=t.item.latest();n&&(n.history.enabled=!1,n.set(e,i),n.history.enabled=!0)},redo:function(){var i=t.item.latest();i&&(i.history.enabled=!1,i.unset(e),i.history.enabled=!0)}};t._history.add(n)}}))),this._events.push(this.item.on("*:insert",(function(e,i,n){if(t._enabled&&t._history){var r={name:t._prefix+e,combine:t._combine,undo:function(){var n=t.item.latest();n&&(n.history.enabled=!1,n.removeValue(e,i),n.history.enabled=!0)},redo:function(){var r=t.item.latest();r&&(r.history.enabled=!1,r.insert(e,i,n),r.history.enabled=!0)}};t._history.add(r)}}))),this._events.push(this.item.on("*:remove",(function(e,i,n){if(t._enabled&&t._history){var r={name:t._prefix+e,combine:t._combine,undo:function(){var r=t.item.latest();r&&(r.history.enabled=!1,r.insert(e,i,n),r.history.enabled=!0)},redo:function(){var n=t.item.latest();n&&(n.history.enabled=!1,n.removeValue(e,i),n.history.enabled=!0)}};t._history.add(r)}}))),this._events.push(this.item.on("*:move",(function(e,i,n,r){if(t._enabled&&t._history){var s={name:t._prefix+e,combine:t._combine,undo:function(){var i=t.item.latest();i&&(i.history.enabled=!1,i.move(e,n,r),i.history.enabled=!0)},redo:function(){var i=t.item.latest();i&&(i.history.enabled=!1,i.move(e,r,n),i.history.enabled=!0)}};t._history.add(s)}})))},J.prototype.destroy=function(){this._events.forEach((function(t){t.unbind()})),this._events.length=0,this.item=null},Object.defineProperty(J.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=!!t}}),Object.defineProperty(J.prototype,"prefix",{get:function(){return this._prefix},set:function(t){this._prefix=t||""}}),Object.defineProperty(J.prototype,"combine",{get:function(){return this._combine},set:function(t){this._combine=!!t}});var Q=J;function $(t){n.a.call(this),t=t||{},this.data=[],this._indexed={},this.sorted=t.sorted||null,this.index=t.index||null}$.prototype=Object.create(n.a.prototype),Object.defineProperty($.prototype,"length",{get:function(){return this.data.length}}),$.prototype.get=function(t){return this.index?this._indexed[t]||null:this.data[t]||null},$.prototype.set=function(t,e){this.index?this._indexed[t]=e:this.data[t]=e},$.prototype.indexOf=function(t){if(this.index){var e=t instanceof a&&t.get(this.index)||t[this.index];return this._indexed[e]&&e||null}var i=this.data.indexOf(t);return-1!==i?i:null},$.prototype.position=function(t,e){var i,n,r=this.data,s=0,a=r.length-1;for(e=e||this.sorted;s<=a;)if(1===(n=e(r[i=Math.floor((s+a)/2)],t)))a=i-1;else{if(-1!==n)return i;s=i+1}return-1},$.prototype.positionNextClosest=function(t,e){var i,n,r,s=this.data,a=0,o=s.length-1;if(e=e||this.sorted,0===s.length)return-1;if(0===e(s[0],t))return 0;for(;a<=o;)if(1===(r=e(n=s[i=Math.floor((a+o)/2)],t)))o=i-1;else{if(-1!==r)return i;a=i+1}return 1===e(n,t)?i:i+1===s.length?-1:i+1},$.prototype.has=function(t){if(this.index){var e=t instanceof a&&t.get(this.index)||t[this.index];return!!this._indexed[e]}return-1!==this.data.indexOf(t)},$.prototype.add=function(t){if(this.has(t))return null;var e=this.data.length;this.index&&(e=t instanceof a&&t.get(this.index)||t[this.index],this._indexed[e]=t);var i=0;return this.sorted?-1!==(i=this.positionNextClosest(t))?this.data.splice(i,0,t):this.data.push(t):(this.data.push(t),i=this.data.length-1),this.emit("add",t,e,i),i},$.prototype.move=function(t,e){var i=this.data.indexOf(t);this.data.splice(i,1),-1===e?this.data.push(t):this.data.splice(e,0,t),this.emit("move",t,e)},$.prototype.remove=function(t){if(this.has(t)){var e=this.data.indexOf(t),i=e;this.index&&(i=t instanceof a&&t.get(this.index)||t[this.index],delete this._indexed[i]),this.data.splice(e,1),this.emit("remove",t,i)}},$.prototype.removeByKey=function(t){var e;if(this.index){if(!(e=this._indexed[t]))return;var i=this.data.indexOf(e);this.data.splice(i,1),delete this._indexed[t],this.emit("remove",e,i)}else{if(this.data.length<t)return;e=this.data[t],this.data.splice(t,1),this.emit("remove",e,t)}},$.prototype.removeBy=function(t){for(var e=this.data.length;e--;)t(this.data[e])&&(this.index&&delete this._indexed[this.data[e][this.index]],this.data.splice(e,1),this.emit("remove",this.data[e],e))},$.prototype.clear=function(){var t=this.data.slice(0);this.data=[],this._indexed={};for(var e=t.length;e--;)this.emit("remove",t[e],e)},$.prototype.forEach=function(t){for(var e=0;e<this.data.length;e++)t(this.data[e],this.index&&this.data[e][this.index]||e)},$.prototype.find=function(t){for(var e=[],i=0;i<this.data.length;i++)if(t(this.data[i])){var n=i;this.index&&(n=this.data[i][this.index]),e.push([n,this.data[i]])}return e},$.prototype.findOne=function(t){for(var e=0;e<this.data.length;e++)if(t(this.data[e])){var i=e;return this.index&&(i=this.data[e][this.index]),[i,this.data[e]]}return null},$.prototype.map=function(t){return this.data.map(t)},$.prototype.sort=function(t){this.data.sort(t)},$.prototype.array=function(){return this.data.slice(0)},$.prototype.json=function(){for(var t=this.array(),e=0;e<t.length;e++)t[e]instanceof a&&(t[e]=t[e].json());return t};var tt=$},function(t,e,i){},,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"IBindable",(function(){return n.a})),i.d(e,"IFocusable",(function(){return s})),i.d(e,"ICollapsible",(function(){return a})),i.d(e,"IScrollable",(function(){return l})),i.d(e,"IResizable",(function(){return h})),i.d(e,"IFlex",(function(){return s})),i.d(e,"IGrid",(function(){return o})),i.d(e,"ArrayInput",(function(){return c.a})),i.d(e,"BooleanInput",(function(){return u.a})),i.d(e,"Button",(function(){return d.a})),i.d(e,"Code",(function(){return f.a})),i.d(e,"Container",(function(){return p.a})),i.d(e,"ContextMenu",(function(){return m.a})),i.d(e,"Divider",(function(){return g.a})),i.d(e,"Element",(function(){return v.a})),i.d(e,"InfoBox",(function(){return _.a})),i.d(e,"Label",(function(){return y.a})),i.d(e,"LabelGroup",(function(){return M})),i.d(e,"NumericInput",(function(){return T.a})),i.d(e,"Overlay",(function(){return P.a})),i.d(e,"Panel",(function(){return E.a})),i.d(e,"Progress",(function(){return k.a})),i.d(e,"SelectInput",(function(){return D.a})),i.d(e,"SliderInput",(function(){return O.a})),i.d(e,"Spinner",(function(){return R.a})),i.d(e,"TextAreaInput",(function(){return L.a})),i.d(e,"TextInput",(function(){return N.a})),i.d(e,"TreeView",(function(){return z.a})),i.d(e,"TreeViewItem",(function(){return B.a})),i.d(e,"GridView",(function(){return nt})),i.d(e,"GridViewItem",(function(){return Y})),i.d(e,"VectorInput",(function(){return rt.a}));var n=i(27);function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,n;return e=t,(i=[{key:"focus",value:function(){throw new Error("Not implemented")}},{key:"blur",value:function(){throw new Error("Not implemented")}}])&&r(e.prototype,i),n&&r(e,n),t}(),a=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},o=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},l=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},h=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},c=i(17),u=i(15),d=i(9),f=i(26),p=i(2),m=i(13),g=i(18),v=i(1),_=i(19),y=i(3);function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function A(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=I(t);if(e){var r=I(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return C(this,i)}}function C(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(s,t);var e,i,n,r=A(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t||(t={}),(e=r.call(this,t)).class.add("pcui-label-group"),e._label=new y.a({text:t.text||"Label",nativeTooltip:t.nativeTooltip}),e.append(e._label),e._field=t.field,e._field&&e.append(e._field),e.labelAlignTop=t.labelAlignTop||!1,e}return e=s,(i=[{key:"label",get:function(){return this._label}},{key:"field",get:function(){return this._field}},{key:"text",get:function(){return this._label.text},set:function(t){this._label.text=t}},{key:"labelAlignTop",get:function(){return this.class.contains("pcui-label-group-align-top")},set:function(t){t?this.class.add("pcui-label-group-align-top"):this.class.remove("pcui-label-group-align-top")}}])&&x(e.prototype,i),n&&x(e,n),s}(p.a);v.a.register("labelgroup",S);var M=S,T=i(10),P=i(20),E=i(11),k=i(21),D=i(22),O=i(23),R=i(24),L=i(25),N=i(8),z=i(14),B=i(6),F=i(30);function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function V(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function U(t,e,i){return(U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Z(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function W(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Z(t);if(e){var r=Z(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return H(this,i)}}function H(t,e){return!e||"object"!==j(e)&&"function"!=typeof e?X(t):e}function X(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Z(t){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(s,t);var e,i,n,r=W(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t=Object.assign({tabIndex:0},t),(e=r.call(this,t)).class.add("pcui-gridview-item"),e.allowSelect=void 0===t.allowSelect||t.allowSelect,e._selected=!1,e._labelText=new y.a({class:"pcui-gridview-item-text",binding:new F.BindingObserversToElement}),e.append(e._labelText),e.text=t.text,e._domEvtFocus=e._onFocus.bind(X(e)),e._domEvtBlur=e._onBlur.bind(X(e)),e.dom.addEventListener("focus",e._domEvtFocus),e.dom.addEventListener("blur",e._domEvtBlur),e}return e=s,(i=[{key:"_onFocus",value:function(){this.emit("focus")}},{key:"_onBlur",value:function(){this.emit("blur")}},{key:"focus",value:function(){this.dom.focus()}},{key:"blur",value:function(){this.dom.blur()}},{key:"link",value:function(t,e){this._labelText.link(t,e)}},{key:"unlink",value:function(){this._labelText.unlink()}},{key:"destroy",value:function(){this._destroyed||(this.dom.removeEventListener("focus",this._domEvtFocus),this.dom.removeEventListener("blur",this._domEvtBlur),U(Z(s.prototype),"destroy",this).call(this))}},{key:"allowSelect",get:function(){return this._allowSelect},set:function(t){this._allowSelect=t}},{key:"selected",get:function(){return this._selected},set:function(t){t&&this.focus(),this._selected!==t&&(this._selected=t,t?(this.classAdd("pcui-gridview-item-selected"),this.emit("select",this)):(this.classRemove("pcui-gridview-item-selected"),this.emit("deselect",this)))}},{key:"text",get:function(){return this._labelText.text},set:function(t){this._labelText.text=t}},{key:"nextSibling",get:function(){for(var t=this.dom.nextSibling;t;){if(t.ui instanceof s&&!t.ui.hidden)return t.ui;t=t.nextSibling}return null}},{key:"previousSibling",get:function(){for(var t=this.dom.previousSibling;t;){if(t.ui instanceof s&&!t.ui.hidden)return t.ui;t=t.previousSibling}return null}}])&&V(e.prototype,i),n&&V(e,n),s}(p.a);function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function J(t,e,i){return(J="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=it(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return tt(this,i)}}function tt(t,e){return!e||"object"!==q(e)&&"function"!=typeof e?et(t):e}function et(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function it(t){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(s,t);var e,i,n,r=$(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t||(t={}),(e=r.call(this,t)).class.add("pcui-gridview"),e.on("append",e._onAppendGridViewItem.bind(et(e))),e.on("remove",e._onRemoveGridViewItem.bind(et(e))),e._filterFn=t.filterFn,e._filterAnimationFrame=null,e._filterCanceled=!1,e._selected=[],e}return e=s,(i=[{key:"_onAppendGridViewItem",value:function(t){var e=this;if(t instanceof Y){var i=t.on("click",(function(i){return e._onClickItem(i,t)})),n=t.on("select",(function(){return e._onSelectItem(t)})),r=t.on("deselect",(function(){return e._onDeselectItem(t)}));this._filterFn&&!this._filterFn(t)&&(t.hidden=!0),t.once("griditem:remove",(function(){i.unbind(),i=null,n.unbind(),n=null,r.unbind(),r=null}))}}},{key:"_onRemoveGridViewItem",value:function(t){t instanceof Y&&(t.selected=!1,t.emit("griditem:remove"),t.unbind("griditem:remove"))}},{key:"_onClickItem",value:function(t,e){if(t.ctrlKey||t.metaKey)e.selected=!e.selected;else if(t.shiftKey){var i=this._selected[this._selected.length-1];if(i)if(i.dom.compareDocumentPosition(e.dom)&Node.DOCUMENT_POSITION_FOLLOWING)for(var n=i.nextSibling;n&&(n.selected=!0,n!==e);)n=n.nextSibling;else for(var r=i.previousSibling;r&&(r.selected=!0,r!==e);)r=r.previousSibling;else e.selected=!0}else{for(var s=!1,a=this._selected.length;a--;)this._selected[a]&&this._selected[a]!==e&&(this._selected[a].selected=!1,s=!0);e.selected=!!s||!e.selected}}},{key:"_onSelectItem",value:function(t){this._selected.push(t),this.emit("select",t)}},{key:"_onDeselectItem",value:function(t){var e=this._selected.indexOf(t);-1!==e&&(this._selected.splice(e,1),this.emit("deselect",t))}},{key:"deselect",value:function(){for(var t=this._selected.length;t--;)this._selected[t]&&(this._selected[t].selected=!1)}},{key:"filter",value:function(){var t=this;this.forEachChild((function(e){e instanceof Y&&(e.hidden=t._filterFn&&!t._filterFn(e))}))}},{key:"filterAsync",value:function(t){var e=this,i=0;t=t||100;var n=this.dom.childNodes,r=n.length;this.emit("filter:start"),this._filterCanceled=!1,function s(){e._filterAnimationFrame=null;for(var a=0;i<r&&a<t;i++){if(e._filterCanceled)return e._filterCanceled=!1,void e.emit("filter:cancel");var o=n[i].ui;o instanceof Y&&(e._filterFn&&!e._filterFn(o)?o.hidden=!0:(o.hidden=!1,a++))}i<r?(e.emit("filter:delay"),e._filterAnimationFrame=requestAnimationFrame(s)):e.emit("filter:end")}()}},{key:"filterAsyncCancel",value:function(){this._filterAnimationFrame?(cancelAnimationFrame(this._filterAnimationFrame),this._filterAnimationFrame=null):this._filterCanceled=!0}},{key:"destroy",value:function(){this._destroyed||(this._filterAnimationFrame&&(cancelAnimationFrame(this._filterAnimationFrame),this._filterAnimationFrame=null),J(it(s.prototype),"destroy",this).call(this))}},{key:"selected",get:function(){return this._selected.slice()}}])&&K(e.prototype,i),n&&K(e,n),s}(p.a),rt=i(16);i(31)}])},"object"===a(e)&&"object"===a(t)?t.exports=s():(n=[],void 0===(r="function"==typeof(i=s)?i.apply(e,n):i)||(t.exports=r))}).call(this,i(4)(t))},function(t,e,i){(function(t){var i;function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/*!
 * jQuery JavaScript Library v3.5.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2020-05-04T22:49Z
 */!function(e,i){"use strict";"object"===n(t)&&"object"===n(t.exports)?t.exports=e.document?i(e,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}:i(e)}("undefined"!=typeof window?window:this,(function(r,s){"use strict";var a=[],o=Object.getPrototypeOf,l=a.slice,h=a.flat?function(t){return a.flat.call(t)}:function(t){return a.concat.apply([],t)},c=a.push,u=a.indexOf,d={},f=d.toString,p=d.hasOwnProperty,m=p.toString,g=m.call(Object),v={},_=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},y=function(t){return null!=t&&t===t.window},b=r.document,x={type:!0,src:!0,nonce:!0,noModule:!0};function w(t,e,i){var n,r,s=(i=i||b).createElement("script");if(s.text=t,e)for(n in x)(r=e[n]||e.getAttribute&&e.getAttribute(n))&&s.setAttribute(n,r);i.head.appendChild(s).parentNode.removeChild(s)}function A(t){return null==t?t+"":"object"===n(t)||"function"==typeof t?d[f.call(t)]||"object":n(t)}var C=function t(e,i){return new t.fn.init(e,i)};function I(t){var e=!!t&&"length"in t&&t.length,i=A(t);return!_(t)&&!y(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}C.fn=C.prototype={jquery:"3.5.1",constructor:C,length:0,toArray:function(){return l.call(this)},get:function(t){return null==t?l.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=C.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return C.each(this,t)},map:function(t){return this.pushStack(C.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(l.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(C.grep(this,(function(t,e){return(e+1)%2})))},odd:function(){return this.pushStack(C.grep(this,(function(t,e){return e%2})))},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:a.sort,splice:a.splice},C.extend=C.fn.extend=function(){var t,e,i,r,s,a,o=arguments[0]||{},l=1,h=arguments.length,c=!1;for("boolean"==typeof o&&(c=o,o=arguments[l]||{},l++),"object"===n(o)||_(o)||(o={}),l===h&&(o=this,l--);l<h;l++)if(null!=(t=arguments[l]))for(e in t)r=t[e],"__proto__"!==e&&o!==r&&(c&&r&&(C.isPlainObject(r)||(s=Array.isArray(r)))?(i=o[e],a=s&&!Array.isArray(i)?[]:s||C.isPlainObject(i)?i:{},s=!1,o[e]=C.extend(c,a,r)):void 0!==r&&(o[e]=r));return o},C.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==f.call(t))&&(!(e=o(t))||"function"==typeof(i=p.call(e,"constructor")&&e.constructor)&&m.call(i)===g)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e,i){w(t,{nonce:e&&e.nonce},i)},each:function(t,e){var i,n=0;if(I(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},makeArray:function(t,e){var i=e||[];return null!=t&&(I(Object(t))?C.merge(i,"string"==typeof t?[t]:t):c.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:u.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;n<i;n++)t[r++]=e[n];return t.length=r,t},grep:function(t,e,i){for(var n=[],r=0,s=t.length,a=!i;r<s;r++)!e(t[r],r)!==a&&n.push(t[r]);return n},map:function(t,e,i){var n,r,s=0,a=[];if(I(t))for(n=t.length;s<n;s++)null!=(r=e(t[s],s,i))&&a.push(r);else for(s in t)null!=(r=e(t[s],s,i))&&a.push(r);return h(a)},guid:1,support:v}),"function"==typeof Symbol&&(C.fn[Symbol.iterator]=a[Symbol.iterator]),C.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){d["[object "+e+"]"]=e.toLowerCase()}));var S=
/*!
   * Sizzle CSS Selector Engine v2.3.5
   * https://sizzlejs.com/
   *
   * Copyright JS Foundation and other contributors
   * Released under the MIT license
   * https://js.foundation/
   *
   * Date: 2020-03-14
   */
function(t){var e,i,n,r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b="sizzle"+1*new Date,x=t.document,w=0,A=0,C=lt(),I=lt(),S=lt(),M=lt(),T=function(t,e){return t===e&&(u=!0),0},P={}.hasOwnProperty,E=[],k=E.pop,D=E.push,O=E.push,R=E.slice,L=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},N="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",z="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}"+z+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",F="\\["+z+"*("+B+")(?:"+z+"*([*^$|!~]?=)"+z+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+z+"*\\]",j=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",V=new RegExp(z+"+","g"),U=new RegExp("^"+z+"+|((?:^|[^\\\\])(?:\\\\.)*)"+z+"+$","g"),G=new RegExp("^"+z+"*,"+z+"*"),W=new RegExp("^"+z+"*([>+~]|"+z+")"+z+"*"),H=new RegExp(z+"|>"),X=new RegExp(j),Z=new RegExp("^"+B+"$"),Y={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+j),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+z+"*(even|odd|(([+-]|)(\\d*)n|)"+z+"*(?:([+-]|)"+z+"*(\\d+)|))"+z+"*\\)|)","i"),bool:new RegExp("^(?:"+N+")$","i"),needsContext:new RegExp("^"+z+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+z+"*((?:-\\d)?\\d*)"+z+"*\\)|)(?=[^-]|$)","i")},q=/HTML$/i,K=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=new RegExp("\\\\[\\da-fA-F]{1,6}"+z+"?|\\\\([^\\r\\n\\f])","g"),it=function(t,e){var i="0x"+t.slice(1)-65536;return e||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},nt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,rt=function(t,e){return e?"\0"===t?"":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},st=function(){d()},at=bt((function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{O.apply(E=R.call(x.childNodes),x.childNodes),E[x.childNodes.length].nodeType}catch(t){O={apply:E.length?function(t,e){D.apply(t,R.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}function ot(t,e,n,r){var s,o,h,c,u,p,v,_=e&&e.ownerDocument,x=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==x&&9!==x&&11!==x)return n;if(!r&&(d(e),e=e||f,m)){if(11!==x&&(u=$.exec(t)))if(s=u[1]){if(9===x){if(!(h=e.getElementById(s)))return n;if(h.id===s)return n.push(h),n}else if(_&&(h=_.getElementById(s))&&y(e,h)&&h.id===s)return n.push(h),n}else{if(u[2])return O.apply(n,e.getElementsByTagName(t)),n;if((s=u[3])&&i.getElementsByClassName&&e.getElementsByClassName)return O.apply(n,e.getElementsByClassName(s)),n}if(i.qsa&&!M[t+" "]&&(!g||!g.test(t))&&(1!==x||"object"!==e.nodeName.toLowerCase())){if(v=t,_=e,1===x&&(H.test(t)||W.test(t))){for((_=tt.test(t)&&vt(e.parentNode)||e)===e&&i.scope||((c=e.getAttribute("id"))?c=c.replace(nt,rt):e.setAttribute("id",c=b)),o=(p=a(t)).length;o--;)p[o]=(c?"#"+c:":scope")+" "+yt(p[o]);v=p.join(",")}try{return O.apply(n,_.querySelectorAll(v)),n}catch(e){M(t,!0)}finally{c===b&&e.removeAttribute("id")}}}return l(t.replace(U,"$1"),e,n,r)}function lt(){var t=[];return function e(i,r){return t.push(i+" ")>n.cacheLength&&delete e[t.shift()],e[i+" "]=r}}function ht(t){return t[b]=!0,t}function ct(t){var e=f.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ut(t,e){for(var i=t.split("|"),r=i.length;r--;)n.attrHandle[i[r]]=e}function dt(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function ft(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function pt(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function mt(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&at(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function gt(t){return ht((function(e){return e=+e,ht((function(i,n){for(var r,s=t([],i.length,e),a=s.length;a--;)i[r=s[a]]&&(i[r]=!(n[r]=i[r]))}))}))}function vt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in i=ot.support={},s=ot.isXML=function(t){var e=t.namespaceURI,i=(t.ownerDocument||t).documentElement;return!q.test(e||i&&i.nodeName||"HTML")},d=ot.setDocument=function(t){var e,r,a=t?t.ownerDocument||t:x;return a!=f&&9===a.nodeType&&a.documentElement?(p=(f=a).documentElement,m=!s(f),x!=f&&(r=f.defaultView)&&r.top!==r&&(r.addEventListener?r.addEventListener("unload",st,!1):r.attachEvent&&r.attachEvent("onunload",st)),i.scope=ct((function(t){return p.appendChild(t).appendChild(f.createElement("div")),void 0!==t.querySelectorAll&&!t.querySelectorAll(":scope fieldset div").length})),i.attributes=ct((function(t){return t.className="i",!t.getAttribute("className")})),i.getElementsByTagName=ct((function(t){return t.appendChild(f.createComment("")),!t.getElementsByTagName("*").length})),i.getElementsByClassName=Q.test(f.getElementsByClassName),i.getById=ct((function(t){return p.appendChild(t).id=b,!f.getElementsByName||!f.getElementsByName(b).length})),i.getById?(n.filter.ID=function(t){var e=t.replace(et,it);return function(t){return t.getAttribute("id")===e}},n.find.ID=function(t,e){if(void 0!==e.getElementById&&m){var i=e.getElementById(t);return i?[i]:[]}}):(n.filter.ID=function(t){var e=t.replace(et,it);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},n.find.ID=function(t,e){if(void 0!==e.getElementById&&m){var i,n,r,s=e.getElementById(t);if(s){if((i=s.getAttributeNode("id"))&&i.value===t)return[s];for(r=e.getElementsByName(t),n=0;s=r[n++];)if((i=s.getAttributeNode("id"))&&i.value===t)return[s]}return[]}}),n.find.TAG=i.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):i.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],r=0,s=e.getElementsByTagName(t);if("*"===t){for(;i=s[r++];)1===i.nodeType&&n.push(i);return n}return s},n.find.CLASS=i.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&m)return e.getElementsByClassName(t)},v=[],g=[],(i.qsa=Q.test(f.querySelectorAll))&&(ct((function(t){var e;p.appendChild(t).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&g.push("[*^$]="+z+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||g.push("\\["+z+"*(?:value|"+N+")"),t.querySelectorAll("[id~="+b+"-]").length||g.push("~="),(e=f.createElement("input")).setAttribute("name",""),t.appendChild(e),t.querySelectorAll("[name='']").length||g.push("\\["+z+"*name"+z+"*="+z+"*(?:''|\"\")"),t.querySelectorAll(":checked").length||g.push(":checked"),t.querySelectorAll("a#"+b+"+*").length||g.push(".#.+[+~]"),t.querySelectorAll("\\\f"),g.push("[\\r\\n\\f]")})),ct((function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=f.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&g.push("name"+z+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&g.push(":enabled",":disabled"),p.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),g.push(",.*:")}))),(i.matchesSelector=Q.test(_=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&ct((function(t){i.disconnectedMatch=_.call(t,"*"),_.call(t,"[s!='']:x"),v.push("!=",j)})),g=g.length&&new RegExp(g.join("|")),v=v.length&&new RegExp(v.join("|")),e=Q.test(p.compareDocumentPosition),y=e||Q.test(p.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},T=e?function(t,e){if(t===e)return u=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n||(1&(n=(t.ownerDocument||t)==(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!i.sortDetached&&e.compareDocumentPosition(t)===n?t==f||t.ownerDocument==x&&y(x,t)?-1:e==f||e.ownerDocument==x&&y(x,e)?1:c?L(c,t)-L(c,e):0:4&n?-1:1)}:function(t,e){if(t===e)return u=!0,0;var i,n=0,r=t.parentNode,s=e.parentNode,a=[t],o=[e];if(!r||!s)return t==f?-1:e==f?1:r?-1:s?1:c?L(c,t)-L(c,e):0;if(r===s)return dt(t,e);for(i=t;i=i.parentNode;)a.unshift(i);for(i=e;i=i.parentNode;)o.unshift(i);for(;a[n]===o[n];)n++;return n?dt(a[n],o[n]):a[n]==x?-1:o[n]==x?1:0},f):f},ot.matches=function(t,e){return ot(t,null,null,e)},ot.matchesSelector=function(t,e){if(d(t),i.matchesSelector&&m&&!M[e+" "]&&(!v||!v.test(e))&&(!g||!g.test(e)))try{var n=_.call(t,e);if(n||i.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){M(e,!0)}return ot(e,f,null,[t]).length>0},ot.contains=function(t,e){return(t.ownerDocument||t)!=f&&d(t),y(t,e)},ot.attr=function(t,e){(t.ownerDocument||t)!=f&&d(t);var r=n.attrHandle[e.toLowerCase()],s=r&&P.call(n.attrHandle,e.toLowerCase())?r(t,e,!m):void 0;return void 0!==s?s:i.attributes||!m?t.getAttribute(e):(s=t.getAttributeNode(e))&&s.specified?s.value:null},ot.escape=function(t){return(t+"").replace(nt,rt)},ot.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},ot.uniqueSort=function(t){var e,n=[],r=0,s=0;if(u=!i.detectDuplicates,c=!i.sortStable&&t.slice(0),t.sort(T),u){for(;e=t[s++];)e===t[s]&&(r=n.push(s));for(;r--;)t.splice(n[r],1)}return c=null,t},r=ot.getText=function(t){var e,i="",n=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=r(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[n++];)i+=r(e);return i},(n=ot.selectors={cacheLength:50,createPseudo:ht,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(et,it),t[3]=(t[3]||t[4]||t[5]||"").replace(et,it),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||ot.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&ot.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return Y.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&X.test(i)&&(e=a(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(et,it).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=C[t+" "];return e||(e=new RegExp("(^|"+z+")"+t+"("+z+"|$)"))&&C(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(n){var r=ot.attr(n,t);return null==r?"!="===e:!e||(r+="","="===e?r===i:"!="===e?r!==i:"^="===e?i&&0===r.indexOf(i):"*="===e?i&&r.indexOf(i)>-1:"$="===e?i&&r.slice(-i.length)===i:"~="===e?(" "+r.replace(V," ")+" ").indexOf(i)>-1:"|="===e&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,n,r){var s="nth"!==t.slice(0,3),a="last"!==t.slice(-4),o="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,l){var h,c,u,d,f,p,m=s!==a?"nextSibling":"previousSibling",g=e.parentNode,v=o&&e.nodeName.toLowerCase(),_=!l&&!o,y=!1;if(g){if(s){for(;m;){for(d=e;d=d[m];)if(o?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;p=m="only"===t&&!p&&"nextSibling"}return!0}if(p=[a?g.firstChild:g.lastChild],a&&_){for(y=(f=(h=(c=(u=(d=g)[b]||(d[b]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]||[])[0]===w&&h[1])&&h[2],d=f&&g.childNodes[f];d=++f&&d&&d[m]||(y=f=0)||p.pop();)if(1===d.nodeType&&++y&&d===e){c[t]=[w,f,y];break}}else if(_&&(y=f=(h=(c=(u=(d=e)[b]||(d[b]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]||[])[0]===w&&h[1]),!1===y)for(;(d=++f&&d&&d[m]||(y=f=0)||p.pop())&&((o?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++y||(_&&((c=(u=d[b]||(d[b]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]=[w,y]),d!==e)););return(y-=r)===n||y%n==0&&y/n>=0}}},PSEUDO:function(t,e){var i,r=n.pseudos[t]||n.setFilters[t.toLowerCase()]||ot.error("unsupported pseudo: "+t);return r[b]?r(e):r.length>1?(i=[t,t,"",e],n.setFilters.hasOwnProperty(t.toLowerCase())?ht((function(t,i){for(var n,s=r(t,e),a=s.length;a--;)t[n=L(t,s[a])]=!(i[n]=s[a])})):function(t){return r(t,0,i)}):r}},pseudos:{not:ht((function(t){var e=[],i=[],n=o(t.replace(U,"$1"));return n[b]?ht((function(t,e,i,r){for(var s,a=n(t,null,r,[]),o=t.length;o--;)(s=a[o])&&(t[o]=!(e[o]=s))})):function(t,r,s){return e[0]=t,n(e,null,s,i),e[0]=null,!i.pop()}})),has:ht((function(t){return function(e){return ot(t,e).length>0}})),contains:ht((function(t){return t=t.replace(et,it),function(e){return(e.textContent||r(e)).indexOf(t)>-1}})),lang:ht((function(t){return Z.test(t||"")||ot.error("unsupported lang: "+t),t=t.replace(et,it).toLowerCase(),function(e){var i;do{if(i=m?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===p},focus:function(t){return t===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:mt(!1),disabled:mt(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!n.pseudos.empty(t)},header:function(t){return J.test(t.nodeName)},input:function(t){return K.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:gt((function(){return[0]})),last:gt((function(t,e){return[e-1]})),eq:gt((function(t,e,i){return[i<0?i+e:i]})),even:gt((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:gt((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:gt((function(t,e,i){for(var n=i<0?i+e:i>e?e:i;--n>=0;)t.push(n);return t})),gt:gt((function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t}))}}).pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[e]=ft(e);for(e in{submit:!0,reset:!0})n.pseudos[e]=pt(e);function _t(){}function yt(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function bt(t,e,i){var n=e.dir,r=e.next,s=r||n,a=i&&"parentNode"===s,o=A++;return e.first?function(e,i,r){for(;e=e[n];)if(1===e.nodeType||a)return t(e,i,r);return!1}:function(e,i,l){var h,c,u,d=[w,o];if(l){for(;e=e[n];)if((1===e.nodeType||a)&&t(e,i,l))return!0}else for(;e=e[n];)if(1===e.nodeType||a)if(c=(u=e[b]||(e[b]={}))[e.uniqueID]||(u[e.uniqueID]={}),r&&r===e.nodeName.toLowerCase())e=e[n]||e;else{if((h=c[s])&&h[0]===w&&h[1]===o)return d[2]=h[2];if(c[s]=d,d[2]=t(e,i,l))return!0}return!1}}function xt(t){return t.length>1?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function wt(t,e,i,n,r){for(var s,a=[],o=0,l=t.length,h=null!=e;o<l;o++)(s=t[o])&&(i&&!i(s,n,r)||(a.push(s),h&&e.push(o)));return a}function At(t,e,i,n,r,s){return n&&!n[b]&&(n=At(n)),r&&!r[b]&&(r=At(r,s)),ht((function(s,a,o,l){var h,c,u,d=[],f=[],p=a.length,m=s||function(t,e,i){for(var n=0,r=e.length;n<r;n++)ot(t,e[n],i);return i}(e||"*",o.nodeType?[o]:o,[]),g=!t||!s&&e?m:wt(m,d,t,o,l),v=i?r||(s?t:p||n)?[]:a:g;if(i&&i(g,v,o,l),n)for(h=wt(v,f),n(h,[],o,l),c=h.length;c--;)(u=h[c])&&(v[f[c]]=!(g[f[c]]=u));if(s){if(r||t){if(r){for(h=[],c=v.length;c--;)(u=v[c])&&h.push(g[c]=u);r(null,v=[],h,l)}for(c=v.length;c--;)(u=v[c])&&(h=r?L(s,u):d[c])>-1&&(s[h]=!(a[h]=u))}}else v=wt(v===a?v.splice(p,v.length):v),r?r(null,a,v,l):O.apply(a,v)}))}function Ct(t){for(var e,i,r,s=t.length,a=n.relative[t[0].type],o=a||n.relative[" "],l=a?1:0,c=bt((function(t){return t===e}),o,!0),u=bt((function(t){return L(e,t)>-1}),o,!0),d=[function(t,i,n){var r=!a&&(n||i!==h)||((e=i).nodeType?c(t,i,n):u(t,i,n));return e=null,r}];l<s;l++)if(i=n.relative[t[l].type])d=[bt(xt(d),i)];else{if((i=n.filter[t[l].type].apply(null,t[l].matches))[b]){for(r=++l;r<s&&!n.relative[t[r].type];r++);return At(l>1&&xt(d),l>1&&yt(t.slice(0,l-1).concat({value:" "===t[l-2].type?"*":""})).replace(U,"$1"),i,l<r&&Ct(t.slice(l,r)),r<s&&Ct(t=t.slice(r)),r<s&&yt(t))}d.push(i)}return xt(d)}return _t.prototype=n.filters=n.pseudos,n.setFilters=new _t,a=ot.tokenize=function(t,e){var i,r,s,a,o,l,h,c=I[t+" "];if(c)return e?0:c.slice(0);for(o=t,l=[],h=n.preFilter;o;){for(a in i&&!(r=G.exec(o))||(r&&(o=o.slice(r[0].length)||o),l.push(s=[])),i=!1,(r=W.exec(o))&&(i=r.shift(),s.push({value:i,type:r[0].replace(U," ")}),o=o.slice(i.length)),n.filter)!(r=Y[a].exec(o))||h[a]&&!(r=h[a](r))||(i=r.shift(),s.push({value:i,type:a,matches:r}),o=o.slice(i.length));if(!i)break}return e?o.length:o?ot.error(t):I(t,l).slice(0)},o=ot.compile=function(t,e){var i,r=[],s=[],o=S[t+" "];if(!o){for(e||(e=a(t)),i=e.length;i--;)(o=Ct(e[i]))[b]?r.push(o):s.push(o);(o=S(t,function(t,e){var i=e.length>0,r=t.length>0,s=function(s,a,o,l,c){var u,p,g,v=0,_="0",y=s&&[],b=[],x=h,A=s||r&&n.find.TAG("*",c),C=w+=null==x?1:Math.random()||.1,I=A.length;for(c&&(h=a==f||a||c);_!==I&&null!=(u=A[_]);_++){if(r&&u){for(p=0,a||u.ownerDocument==f||(d(u),o=!m);g=t[p++];)if(g(u,a||f,o)){l.push(u);break}c&&(w=C)}i&&((u=!g&&u)&&v--,s&&y.push(u))}if(v+=_,i&&_!==v){for(p=0;g=e[p++];)g(y,b,a,o);if(s){if(v>0)for(;_--;)y[_]||b[_]||(b[_]=k.call(l));b=wt(b)}O.apply(l,b),c&&!s&&b.length>0&&v+e.length>1&&ot.uniqueSort(l)}return c&&(w=C,h=x),y};return i?ht(s):s}(s,r))).selector=t}return o},l=ot.select=function(t,e,i,r){var s,l,h,c,u,d="function"==typeof t&&t,f=!r&&a(t=d.selector||t);if(i=i||[],1===f.length){if((l=f[0]=f[0].slice(0)).length>2&&"ID"===(h=l[0]).type&&9===e.nodeType&&m&&n.relative[l[1].type]){if(!(e=(n.find.ID(h.matches[0].replace(et,it),e)||[])[0]))return i;d&&(e=e.parentNode),t=t.slice(l.shift().value.length)}for(s=Y.needsContext.test(t)?0:l.length;s--&&(h=l[s],!n.relative[c=h.type]);)if((u=n.find[c])&&(r=u(h.matches[0].replace(et,it),tt.test(l[0].type)&&vt(e.parentNode)||e))){if(l.splice(s,1),!(t=r.length&&yt(l)))return O.apply(i,r),i;break}}return(d||o(t,f))(r,e,!m,i,!e||tt.test(t)&&vt(e.parentNode)||e),i},i.sortStable=b.split("").sort(T).join("")===b,i.detectDuplicates=!!u,d(),i.sortDetached=ct((function(t){return 1&t.compareDocumentPosition(f.createElement("fieldset"))})),ct((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ut("type|href|height|width",(function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),i.attributes&&ct((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ut("value",(function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),ct((function(t){return null==t.getAttribute("disabled")}))||ut(N,(function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null})),ot}(r);C.find=S,(C.expr=S.selectors)[":"]=C.expr.pseudos,C.uniqueSort=C.unique=S.uniqueSort,C.text=S.getText,C.isXMLDoc=S.isXML,C.contains=S.contains,C.escapeSelector=S.escape;var M=function(t,e,i){for(var n=[],r=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&C(t).is(i))break;n.push(t)}return n},T=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},P=C.expr.match.needsContext;function E(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}var k=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function D(t,e,i){return _(e)?C.grep(t,(function(t,n){return!!e.call(t,n,t)!==i})):e.nodeType?C.grep(t,(function(t){return t===e!==i})):"string"!=typeof e?C.grep(t,(function(t){return u.call(e,t)>-1!==i})):C.filter(e,t,i)}C.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?C.find.matchesSelector(n,t)?[n]:[]:C.find.matches(t,C.grep(e,(function(t){return 1===t.nodeType})))},C.fn.extend({find:function(t){var e,i,n=this.length,r=this;if("string"!=typeof t)return this.pushStack(C(t).filter((function(){for(e=0;e<n;e++)if(C.contains(r[e],this))return!0})));for(i=this.pushStack([]),e=0;e<n;e++)C.find(t,r[e],i);return n>1?C.uniqueSort(i):i},filter:function(t){return this.pushStack(D(this,t||[],!1))},not:function(t){return this.pushStack(D(this,t||[],!0))},is:function(t){return!!D(this,"string"==typeof t&&P.test(t)?C(t):t||[],!1).length}});var O,R=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(C.fn.init=function(t,e,i){var n,r;if(!t)return this;if(i=i||O,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:R.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof C?e[0]:e,C.merge(this,C.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:b,!0)),k.test(n[1])&&C.isPlainObject(e))for(n in e)_(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return(r=b.getElementById(n[2]))&&(this[0]=r,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):_(t)?void 0!==i.ready?i.ready(t):t(C):C.makeArray(t,this)}).prototype=C.fn,O=C(b);var L=/^(?:parents|prev(?:Until|All))/,N={children:!0,contents:!0,next:!0,prev:!0};function z(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}C.fn.extend({has:function(t){var e=C(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(C.contains(this,e[t]))return!0}))},closest:function(t,e){var i,n=0,r=this.length,s=[],a="string"!=typeof t&&C(t);if(!P.test(t))for(;n<r;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&C.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(s.length>1?C.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?u.call(C(t),this[0]):u.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(C.uniqueSort(C.merge(this.get(),C(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),C.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return M(t,"parentNode")},parentsUntil:function(t,e,i){return M(t,"parentNode",i)},next:function(t){return z(t,"nextSibling")},prev:function(t){return z(t,"previousSibling")},nextAll:function(t){return M(t,"nextSibling")},prevAll:function(t){return M(t,"previousSibling")},nextUntil:function(t,e,i){return M(t,"nextSibling",i)},prevUntil:function(t,e,i){return M(t,"previousSibling",i)},siblings:function(t){return T((t.parentNode||{}).firstChild,t)},children:function(t){return T(t.firstChild)},contents:function(t){return null!=t.contentDocument&&o(t.contentDocument)?t.contentDocument:(E(t,"template")&&(t=t.content||t),C.merge([],t.childNodes))}},(function(t,e){C.fn[t]=function(i,n){var r=C.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=C.filter(n,r)),this.length>1&&(N[t]||C.uniqueSort(r),L.test(t)&&r.reverse()),this.pushStack(r)}}));var B=/[^\x20\t\r\n\f]+/g;function F(t){return t}function j(t){throw t}function V(t,e,i,n){var r;try{t&&_(r=t.promise)?r.call(t).done(e).fail(i):t&&_(r=t.then)?r.call(t,e,i):e.apply(void 0,[t].slice(n))}catch(t){i.apply(void 0,[t])}}C.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return C.each(t.match(B)||[],(function(t,i){e[i]=!0})),e}(t):C.extend({},t);var e,i,n,r,s=[],a=[],o=-1,l=function(){for(r=r||t.once,n=e=!0;a.length;o=-1)for(i=a.shift();++o<s.length;)!1===s[o].apply(i[0],i[1])&&t.stopOnFalse&&(o=s.length,i=!1);t.memory||(i=!1),e=!1,r&&(s=i?[]:"")},h={add:function(){return s&&(i&&!e&&(o=s.length-1,a.push(i)),function e(i){C.each(i,(function(i,n){_(n)?t.unique&&h.has(n)||s.push(n):n&&n.length&&"string"!==A(n)&&e(n)}))}(arguments),i&&!e&&l()),this},remove:function(){return C.each(arguments,(function(t,e){for(var i;(i=C.inArray(e,s,i))>-1;)s.splice(i,1),i<=o&&o--})),this},has:function(t){return t?C.inArray(t,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=a=[],s=i="",this},disabled:function(){return!s},lock:function(){return r=a=[],i||e||(s=i=""),this},locked:function(){return!!r},fireWith:function(t,i){return r||(i=[t,(i=i||[]).slice?i.slice():i],a.push(i),e||l()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!n}};return h},C.extend({Deferred:function(t){var e=[["notify","progress",C.Callbacks("memory"),C.Callbacks("memory"),2],["resolve","done",C.Callbacks("once memory"),C.Callbacks("once memory"),0,"resolved"],["reject","fail",C.Callbacks("once memory"),C.Callbacks("once memory"),1,"rejected"]],i="pending",s={state:function(){return i},always:function(){return a.done(arguments).fail(arguments),this},catch:function(t){return s.then(null,t)},pipe:function(){var t=arguments;return C.Deferred((function(i){C.each(e,(function(e,n){var r=_(t[n[4]])&&t[n[4]];a[n[1]]((function(){var t=r&&r.apply(this,arguments);t&&_(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[n[0]+"With"](this,r?[t]:arguments)}))})),t=null})).promise()},then:function(t,i,s){var a=0;function o(t,e,i,s){return function(){var l=this,h=arguments,c=function(){var r,c;if(!(t<a)){if((r=i.apply(l,h))===e.promise())throw new TypeError("Thenable self-resolution");c=r&&("object"===n(r)||"function"==typeof r)&&r.then,_(c)?s?c.call(r,o(a,e,F,s),o(a,e,j,s)):(a++,c.call(r,o(a,e,F,s),o(a,e,j,s),o(a,e,F,e.notifyWith))):(i!==F&&(l=void 0,h=[r]),(s||e.resolveWith)(l,h))}},u=s?c:function(){try{c()}catch(n){C.Deferred.exceptionHook&&C.Deferred.exceptionHook(n,u.stackTrace),t+1>=a&&(i!==j&&(l=void 0,h=[n]),e.rejectWith(l,h))}};t?u():(C.Deferred.getStackHook&&(u.stackTrace=C.Deferred.getStackHook()),r.setTimeout(u))}}return C.Deferred((function(n){e[0][3].add(o(0,n,_(s)?s:F,n.notifyWith)),e[1][3].add(o(0,n,_(t)?t:F)),e[2][3].add(o(0,n,_(i)?i:j))})).promise()},promise:function(t){return null!=t?C.extend(t,s):s}},a={};return C.each(e,(function(t,n){var r=n[2],o=n[5];s[n[1]]=r.add,o&&r.add((function(){i=o}),e[3-t][2].disable,e[3-t][3].disable,e[0][2].lock,e[0][3].lock),r.add(n[3].fire),a[n[0]]=function(){return a[n[0]+"With"](this===a?void 0:this,arguments),this},a[n[0]+"With"]=r.fireWith})),s.promise(a),t&&t.call(a,a),a},when:function(t){var e=arguments.length,i=e,n=Array(i),r=l.call(arguments),s=C.Deferred(),a=function(t){return function(i){n[t]=this,r[t]=arguments.length>1?l.call(arguments):i,--e||s.resolveWith(n,r)}};if(e<=1&&(V(t,s.done(a(i)).resolve,s.reject,!e),"pending"===s.state()||_(r[i]&&r[i].then)))return s.then();for(;i--;)V(r[i],a(i),s.reject);return s.promise()}});var U=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;C.Deferred.exceptionHook=function(t,e){r.console&&r.console.warn&&t&&U.test(t.name)&&r.console.warn("jQuery.Deferred exception: "+t.message,t.stack,e)},C.readyException=function(t){r.setTimeout((function(){throw t}))};var G=C.Deferred();function W(){b.removeEventListener("DOMContentLoaded",W),r.removeEventListener("load",W),C.ready()}C.fn.ready=function(t){return G.then(t).catch((function(t){C.readyException(t)})),this},C.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--C.readyWait:C.isReady)||(C.isReady=!0,!0!==t&&--C.readyWait>0||G.resolveWith(b,[C]))}}),C.ready.then=G.then,"complete"===b.readyState||"loading"!==b.readyState&&!b.documentElement.doScroll?r.setTimeout(C.ready):(b.addEventListener("DOMContentLoaded",W),r.addEventListener("load",W));var H=function t(e,i,n,r,s,a,o){var l=0,h=e.length,c=null==n;if("object"===A(n))for(l in s=!0,n)t(e,i,l,n[l],!0,a,o);else if(void 0!==r&&(s=!0,_(r)||(o=!0),c&&(o?(i.call(e,r),i=null):(c=i,i=function(t,e,i){return c.call(C(t),i)})),i))for(;l<h;l++)i(e[l],n,o?r:r.call(e[l],l,i(e[l],n)));return s?e:c?i.call(e):h?i(e[0],n):a},X=/^-ms-/,Z=/-([a-z])/g;function Y(t,e){return e.toUpperCase()}function q(t){return t.replace(X,"ms-").replace(Z,Y)}var K=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function J(){this.expando=C.expando+J.uid++}J.uid=1,J.prototype={cache:function(t){var e=t[this.expando];return e||(e={},K(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,r=this.cache(t);if("string"==typeof e)r[q(e)]=i;else for(n in e)r[q(n)]=e[n];return r},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][q(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n=t[this.expando];if(void 0!==n){if(void 0!==e){i=(e=Array.isArray(e)?e.map(q):(e=q(e))in n?[e]:e.match(B)||[]).length;for(;i--;)delete n[e[i]]}(void 0===e||C.isEmptyObject(n))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!C.isEmptyObject(e)}};var Q=new J,$=new J,tt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,et=/[A-Z]/g;function it(t,e,i){var n;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace(et,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i=function(t){return"true"===t||"false"!==t&&("null"===t?null:t===+t+""?+t:tt.test(t)?JSON.parse(t):t)}(i)}catch(t){}$.set(t,e,i)}else i=void 0;return i}C.extend({hasData:function(t){return $.hasData(t)||Q.hasData(t)},data:function(t,e,i){return $.access(t,e,i)},removeData:function(t,e){$.remove(t,e)},_data:function(t,e,i){return Q.access(t,e,i)},_removeData:function(t,e){Q.remove(t,e)}}),C.fn.extend({data:function(t,e){var i,r,s,a=this[0],o=a&&a.attributes;if(void 0===t){if(this.length&&(s=$.get(a),1===a.nodeType&&!Q.get(a,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(r=o[i].name).indexOf("data-")&&(r=q(r.slice(5)),it(a,r,s[r]));Q.set(a,"hasDataAttrs",!0)}return s}return"object"===n(t)?this.each((function(){$.set(this,t)})):H(this,(function(e){var i;if(a&&void 0===e)return void 0!==(i=$.get(a,t))||void 0!==(i=it(a,t))?i:void 0;this.each((function(){$.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){$.remove(this,t)}))}}),C.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=Q.get(t,e),i&&(!n||Array.isArray(i)?n=Q.access(t,e,C.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){var i=C.queue(t,e=e||"fx"),n=i.length,r=i.shift(),s=C._queueHooks(t,e);"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete s.stop,r.call(t,(function(){C.dequeue(t,e)}),s)),!n&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Q.get(t,i)||Q.access(t,i,{empty:C.Callbacks("once memory").add((function(){Q.remove(t,[e+"queue",i])}))})}}),C.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?C.queue(this[0],t):void 0===e?this:this.each((function(){var i=C.queue(this,t,e);C._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&C.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){C.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,r=C.Deferred(),s=this,a=this.length,o=function(){--n||r.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";a--;)(i=Q.get(s[a],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(o));return o(),r.promise(e)}});var nt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rt=new RegExp("^(?:([+-])=|)("+nt+")([a-z%]*)$","i"),st=["Top","Right","Bottom","Left"],at=b.documentElement,ot=function(t){return C.contains(t.ownerDocument,t)},lt={composed:!0};at.getRootNode&&(ot=function(t){return C.contains(t.ownerDocument,t)||t.getRootNode(lt)===t.ownerDocument});var ht=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&ot(t)&&"none"===C.css(t,"display")};function ct(t,e,i,n){var r,s,a=20,o=n?function(){return n.cur()}:function(){return C.css(t,e,"")},l=o(),h=i&&i[3]||(C.cssNumber[e]?"":"px"),c=t.nodeType&&(C.cssNumber[e]||"px"!==h&&+l)&&rt.exec(C.css(t,e));if(c&&c[3]!==h){for(l/=2,h=h||c[3],c=+l||1;a--;)C.style(t,e,c+h),(1-s)*(1-(s=o()/l||.5))<=0&&(a=0),c/=s;C.style(t,e,(c*=2)+h),i=i||[]}return i&&(c=+c||+l||0,r=i[1]?c+(i[1]+1)*i[2]:+i[2],n&&(n.unit=h,n.start=c,n.end=r)),r}var ut={};function dt(t){var e,i=t.ownerDocument,n=t.nodeName,r=ut[n];return r||(e=i.body.appendChild(i.createElement(n)),r=C.css(e,"display"),e.parentNode.removeChild(e),"none"===r&&(r="block"),ut[n]=r,r)}function ft(t,e){for(var i,n,r=[],s=0,a=t.length;s<a;s++)(n=t[s]).style&&(i=n.style.display,e?("none"===i&&(r[s]=Q.get(n,"display")||null,r[s]||(n.style.display="")),""===n.style.display&&ht(n)&&(r[s]=dt(n))):"none"!==i&&(r[s]="none",Q.set(n,"display",i)));for(s=0;s<a;s++)null!=r[s]&&(t[s].style.display=r[s]);return t}C.fn.extend({show:function(){return ft(this,!0)},hide:function(){return ft(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){ht(this)?C(this).show():C(this).hide()}))}});var pt,mt,gt=/^(?:checkbox|radio)$/i,vt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,_t=/^$|^module$|\/(?:java|ecma)script/i;pt=b.createDocumentFragment().appendChild(b.createElement("div")),(mt=b.createElement("input")).setAttribute("type","radio"),mt.setAttribute("checked","checked"),mt.setAttribute("name","t"),pt.appendChild(mt),v.checkClone=pt.cloneNode(!0).cloneNode(!0).lastChild.checked,pt.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!pt.cloneNode(!0).lastChild.defaultValue,pt.innerHTML="<option></option>",v.option=!!pt.lastChild;var yt={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function bt(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&E(t,e)?C.merge([t],i):i}function xt(t,e){for(var i=0,n=t.length;i<n;i++)Q.set(t[i],"globalEval",!e||Q.get(e[i],"globalEval"))}yt.tbody=yt.tfoot=yt.colgroup=yt.caption=yt.thead,yt.th=yt.td,v.option||(yt.optgroup=yt.option=[1,"<select multiple='multiple'>","</select>"]);var wt=/<|&#?\w+;/;function At(t,e,i,n,r){for(var s,a,o,l,h,c,u=e.createDocumentFragment(),d=[],f=0,p=t.length;f<p;f++)if((s=t[f])||0===s)if("object"===A(s))C.merge(d,s.nodeType?[s]:s);else if(wt.test(s)){for(a=a||u.appendChild(e.createElement("div")),o=(vt.exec(s)||["",""])[1].toLowerCase(),l=yt[o]||yt._default,a.innerHTML=l[1]+C.htmlPrefilter(s)+l[2],c=l[0];c--;)a=a.lastChild;C.merge(d,a.childNodes),(a=u.firstChild).textContent=""}else d.push(e.createTextNode(s));for(u.textContent="",f=0;s=d[f++];)if(n&&C.inArray(s,n)>-1)r&&r.push(s);else if(h=ot(s),a=bt(u.appendChild(s),"script"),h&&xt(a),i)for(c=0;s=a[c++];)_t.test(s.type||"")&&i.push(s);return u}var Ct=/^key/,It=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,St=/^([^.]*)(?:\.(.+)|)/;function Mt(){return!0}function Tt(){return!1}function Pt(t,e){return t===function(){try{return b.activeElement}catch(t){}}()==("focus"===e)}function Et(t,e,i,r,s,a){var o,l;if("object"===n(e)){for(l in"string"!=typeof i&&(r=r||i,i=void 0),e)Et(t,l,i,r,e[l],a);return t}if(null==r&&null==s?(s=i,r=i=void 0):null==s&&("string"==typeof i?(s=r,r=void 0):(s=r,r=i,i=void 0)),!1===s)s=Tt;else if(!s)return t;return 1===a&&(o=s,(s=function(t){return C().off(t),o.apply(this,arguments)}).guid=o.guid||(o.guid=C.guid++)),t.each((function(){C.event.add(this,e,s,r,i)}))}function kt(t,e,i){i?(Q.set(t,e,!1),C.event.add(t,e,{namespace:!1,handler:function(t){var n,r,s=Q.get(this,e);if(1&t.isTrigger&&this[e]){if(s.length)(C.event.special[e]||{}).delegateType&&t.stopPropagation();else if(s=l.call(arguments),Q.set(this,e,s),n=i(this,e),this[e](),s!==(r=Q.get(this,e))||n?Q.set(this,e,!1):r={},s!==r)return t.stopImmediatePropagation(),t.preventDefault(),r.value}else s.length&&(Q.set(this,e,{value:C.event.trigger(C.extend(s[0],C.Event.prototype),s.slice(1),this)}),t.stopImmediatePropagation())}})):void 0===Q.get(t,e)&&C.event.add(t,e,Mt)}C.event={global:{},add:function(t,e,i,n,r){var s,a,o,l,h,c,u,d,f,p,m,g=Q.get(t);if(K(t))for(i.handler&&(i=(s=i).handler,r=s.selector),r&&C.find.matchesSelector(at,r),i.guid||(i.guid=C.guid++),(l=g.events)||(l=g.events=Object.create(null)),(a=g.handle)||(a=g.handle=function(e){return void 0!==C&&C.event.triggered!==e.type?C.event.dispatch.apply(t,arguments):void 0}),h=(e=(e||"").match(B)||[""]).length;h--;)f=m=(o=St.exec(e[h])||[])[1],p=(o[2]||"").split(".").sort(),f&&(u=C.event.special[f]||{},f=(r?u.delegateType:u.bindType)||f,u=C.event.special[f]||{},c=C.extend({type:f,origType:m,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&C.expr.match.needsContext.test(r),namespace:p.join(".")},s),(d=l[f])||((d=l[f]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(t,n,p,a)||t.addEventListener&&t.addEventListener(f,a)),u.add&&(u.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),r?d.splice(d.delegateCount++,0,c):d.push(c),C.event.global[f]=!0)},remove:function(t,e,i,n,r){var s,a,o,l,h,c,u,d,f,p,m,g=Q.hasData(t)&&Q.get(t);if(g&&(l=g.events)){for(h=(e=(e||"").match(B)||[""]).length;h--;)if(f=m=(o=St.exec(e[h])||[])[1],p=(o[2]||"").split(".").sort(),f){for(u=C.event.special[f]||{},d=l[f=(n?u.delegateType:u.bindType)||f]||[],o=o[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=d.length;s--;)c=d[s],!r&&m!==c.origType||i&&i.guid!==c.guid||o&&!o.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(d.splice(s,1),c.selector&&d.delegateCount--,u.remove&&u.remove.call(t,c));a&&!d.length&&(u.teardown&&!1!==u.teardown.call(t,p,g.handle)||C.removeEvent(t,f,g.handle),delete l[f])}else for(f in l)C.event.remove(t,f+e[h],i,n,!0);C.isEmptyObject(l)&&Q.remove(t,"handle events")}},dispatch:function(t){var e,i,n,r,s,a,o=new Array(arguments.length),l=C.event.fix(t),h=(Q.get(this,"events")||Object.create(null))[l.type]||[],c=C.event.special[l.type]||{};for(o[0]=l,e=1;e<arguments.length;e++)o[e]=arguments[e];if(l.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,l)){for(a=C.event.handlers.call(this,l,h),e=0;(r=a[e++])&&!l.isPropagationStopped();)for(l.currentTarget=r.elem,i=0;(s=r.handlers[i++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==s.namespace&&!l.rnamespace.test(s.namespace)||(l.handleObj=s,l.data=s.data,void 0!==(n=((C.event.special[s.origType]||{}).handle||s.handler).apply(r.elem,o))&&!1===(l.result=n)&&(l.preventDefault(),l.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,l),l.result}},handlers:function(t,e){var i,n,r,s,a,o=[],l=e.delegateCount,h=t.target;if(l&&h.nodeType&&!("click"===t.type&&t.button>=1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==t.type||!0!==h.disabled)){for(s=[],a={},i=0;i<l;i++)void 0===a[r=(n=e[i]).selector+" "]&&(a[r]=n.needsContext?C(r,this).index(h)>-1:C.find(r,this,null,[h]).length),a[r]&&s.push(n);s.length&&o.push({elem:h,handlers:s})}return h=this,l<e.length&&o.push({elem:h,handlers:e.slice(l)}),o},addProp:function(t,e){Object.defineProperty(C.Event.prototype,t,{enumerable:!0,configurable:!0,get:_(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[C.expando]?t:new C.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return gt.test(e.type)&&e.click&&E(e,"input")&&kt(e,"click",Mt),!1},trigger:function(t){var e=this||t;return gt.test(e.type)&&e.click&&E(e,"input")&&kt(e,"click"),!0},_default:function(t){var e=t.target;return gt.test(e.type)&&e.click&&E(e,"input")&&Q.get(e,"click")||E(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},C.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},(C.Event=function(t,e){if(!(this instanceof C.Event))return new C.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?Mt:Tt,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&C.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[C.expando]=!0}).prototype={constructor:C.Event,isDefaultPrevented:Tt,isPropagationStopped:Tt,isImmediatePropagationStopped:Tt,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=Mt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=Mt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=Mt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},C.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&Ct.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&It.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},C.event.addProp),C.each({focus:"focusin",blur:"focusout"},(function(t,e){C.event.special[t]={setup:function(){return kt(this,t,Pt),!1},trigger:function(){return kt(this,t),!0},delegateType:e}})),C.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){C.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,r=t.relatedTarget,s=t.handleObj;return r&&(r===n||C.contains(n,r))||(t.type=s.origType,i=s.handler.apply(this,arguments),t.type=e),i}}})),C.fn.extend({on:function(t,e,i,n){return Et(this,t,e,i,n)},one:function(t,e,i,n){return Et(this,t,e,i,n,1)},off:function(t,e,i){var r,s;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,C(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"===n(t)){for(s in t)this.off(s,e,t[s]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=Tt),this.each((function(){C.event.remove(this,t,i,e)}))}});var Dt=/<script|<style|<link/i,Ot=/checked\s*(?:[^=]|=\s*.checked.)/i,Rt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Lt(t,e){return E(t,"table")&&E(11!==e.nodeType?e:e.firstChild,"tr")&&C(t).children("tbody")[0]||t}function Nt(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function zt(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function Bt(t,e){var i,n,r,s,a,o;if(1===e.nodeType){if(Q.hasData(t)&&(o=Q.get(t).events))for(r in Q.remove(e,"handle events"),o)for(i=0,n=o[r].length;i<n;i++)C.event.add(e,r,o[r][i]);$.hasData(t)&&(s=$.access(t),a=C.extend({},s),$.set(e,a))}}function Ft(t,e){var i=e.nodeName.toLowerCase();"input"===i&&gt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function jt(t,e,i,n){e=h(e);var r,s,a,o,l,c,u=0,d=t.length,f=d-1,p=e[0],m=_(p);if(m||d>1&&"string"==typeof p&&!v.checkClone&&Ot.test(p))return t.each((function(r){var s=t.eq(r);m&&(e[0]=p.call(this,r,s.html())),jt(s,e,i,n)}));if(d&&(s=(r=At(e,t[0].ownerDocument,!1,t,n)).firstChild,1===r.childNodes.length&&(r=s),s||n)){for(o=(a=C.map(bt(r,"script"),Nt)).length;u<d;u++)l=r,u!==f&&(l=C.clone(l,!0,!0),o&&C.merge(a,bt(l,"script"))),i.call(t[u],l,u);if(o)for(c=a[a.length-1].ownerDocument,C.map(a,zt),u=0;u<o;u++)l=a[u],_t.test(l.type||"")&&!Q.access(l,"globalEval")&&C.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?C._evalUrl&&!l.noModule&&C._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},c):w(l.textContent.replace(Rt,""),l,c))}return t}function Vt(t,e,i){for(var n,r=e?C.filter(e,t):t,s=0;null!=(n=r[s]);s++)i||1!==n.nodeType||C.cleanData(bt(n)),n.parentNode&&(i&&ot(n)&&xt(bt(n,"script")),n.parentNode.removeChild(n));return t}C.extend({htmlPrefilter:function(t){return t},clone:function(t,e,i){var n,r,s,a,o=t.cloneNode(!0),l=ot(t);if(!(v.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||C.isXMLDoc(t)))for(a=bt(o),n=0,r=(s=bt(t)).length;n<r;n++)Ft(s[n],a[n]);if(e)if(i)for(s=s||bt(t),a=a||bt(o),n=0,r=s.length;n<r;n++)Bt(s[n],a[n]);else Bt(t,o);return(a=bt(o,"script")).length>0&&xt(a,!l&&bt(t,"script")),o},cleanData:function(t){for(var e,i,n,r=C.event.special,s=0;void 0!==(i=t[s]);s++)if(K(i)){if(e=i[Q.expando]){if(e.events)for(n in e.events)r[n]?C.event.remove(i,n):C.removeEvent(i,n,e.handle);i[Q.expando]=void 0}i[$.expando]&&(i[$.expando]=void 0)}}}),C.fn.extend({detach:function(t){return Vt(this,t,!0)},remove:function(t){return Vt(this,t)},text:function(t){return H(this,(function(t){return void 0===t?C.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return jt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Lt(this,t).appendChild(t)}))},prepend:function(){return jt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Lt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return jt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return jt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(C.cleanData(bt(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return C.clone(this,t,e)}))},html:function(t){return H(this,(function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Dt.test(t)&&!yt[(vt.exec(t)||["",""])[1].toLowerCase()]){t=C.htmlPrefilter(t);try{for(;i<n;i++)1===(e=this[i]||{}).nodeType&&(C.cleanData(bt(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return jt(this,arguments,(function(e){var i=this.parentNode;C.inArray(this,t)<0&&(C.cleanData(bt(this)),i&&i.replaceChild(e,this))}),t)}}),C.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){C.fn[t]=function(t){for(var i,n=[],r=C(t),s=r.length-1,a=0;a<=s;a++)i=a===s?this:this.clone(!0),C(r[a])[e](i),c.apply(n,i.get());return this.pushStack(n)}}));var Ut=new RegExp("^("+nt+")(?!px)[a-z%]+$","i"),Gt=function(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=r),e.getComputedStyle(t)},Wt=function(t,e,i){var n,r,s={};for(r in e)s[r]=t.style[r],t.style[r]=e[r];for(r in n=i.call(t),e)t.style[r]=s[r];return n},Ht=new RegExp(st.join("|"),"i");function Xt(t,e,i){var n,r,s,a,o=t.style;return(i=i||Gt(t))&&(""!==(a=i.getPropertyValue(e)||i[e])||ot(t)||(a=C.style(t,e)),!v.pixelBoxStyles()&&Ut.test(a)&&Ht.test(e)&&(n=o.width,r=o.minWidth,s=o.maxWidth,o.minWidth=o.maxWidth=o.width=a,a=i.width,o.width=n,o.minWidth=r,o.maxWidth=s)),void 0!==a?a+"":a}function Zt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){function t(){if(c){h.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",at.appendChild(h).appendChild(c);var t=r.getComputedStyle(c);i="1%"!==t.top,l=12===e(t.marginLeft),c.style.right="60%",a=36===e(t.right),n=36===e(t.width),c.style.position="absolute",s=12===e(c.offsetWidth/3),at.removeChild(h),c=null}}function e(t){return Math.round(parseFloat(t))}var i,n,s,a,o,l,h=b.createElement("div"),c=b.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle="content-box"===c.style.backgroundClip,C.extend(v,{boxSizingReliable:function(){return t(),n},pixelBoxStyles:function(){return t(),a},pixelPosition:function(){return t(),i},reliableMarginLeft:function(){return t(),l},scrollboxSize:function(){return t(),s},reliableTrDimensions:function(){var t,e,i,n;return null==o&&(t=b.createElement("table"),e=b.createElement("tr"),i=b.createElement("div"),t.style.cssText="position:absolute;left:-11111px",e.style.height="1px",i.style.height="9px",at.appendChild(t).appendChild(e).appendChild(i),n=r.getComputedStyle(e),o=parseInt(n.height)>3,at.removeChild(t)),o}}))}();var Yt=["Webkit","Moz","ms"],qt=b.createElement("div").style,Kt={};function Jt(t){var e=C.cssProps[t]||Kt[t];return e||(t in qt?t:Kt[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),i=Yt.length;i--;)if((t=Yt[i]+e)in qt)return t}(t)||t)}var Qt=/^(none|table(?!-c[ea]).+)/,$t=/^--/,te={position:"absolute",visibility:"hidden",display:"block"},ee={letterSpacing:"0",fontWeight:"400"};function ie(t,e,i){var n=rt.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function ne(t,e,i,n,r,s){var a="width"===e?1:0,o=0,l=0;if(i===(n?"border":"content"))return 0;for(;a<4;a+=2)"margin"===i&&(l+=C.css(t,i+st[a],!0,r)),n?("content"===i&&(l-=C.css(t,"padding"+st[a],!0,r)),"margin"!==i&&(l-=C.css(t,"border"+st[a]+"Width",!0,r))):(l+=C.css(t,"padding"+st[a],!0,r),"padding"!==i?l+=C.css(t,"border"+st[a]+"Width",!0,r):o+=C.css(t,"border"+st[a]+"Width",!0,r));return!n&&s>=0&&(l+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-s-l-o-.5))||0),l}function re(t,e,i){var n=Gt(t),r=(!v.boxSizingReliable()||i)&&"border-box"===C.css(t,"boxSizing",!1,n),s=r,a=Xt(t,e,n),o="offset"+e[0].toUpperCase()+e.slice(1);if(Ut.test(a)){if(!i)return a;a="auto"}return(!v.boxSizingReliable()&&r||!v.reliableTrDimensions()&&E(t,"tr")||"auto"===a||!parseFloat(a)&&"inline"===C.css(t,"display",!1,n))&&t.getClientRects().length&&(r="border-box"===C.css(t,"boxSizing",!1,n),(s=o in t)&&(a=t[o])),(a=parseFloat(a)||0)+ne(t,e,i||(r?"border":"content"),s,n,a)+"px"}function se(t,e,i,n,r){return new se.prototype.init(t,e,i,n,r)}C.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Xt(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,i,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,a,o,l=q(e),h=$t.test(e),c=t.style;if(h||(e=Jt(l)),o=C.cssHooks[e]||C.cssHooks[l],void 0===i)return o&&"get"in o&&void 0!==(s=o.get(t,!1,r))?s:c[e];"string"===(a=n(i))&&(s=rt.exec(i))&&s[1]&&(i=ct(t,e,s),a="number"),null!=i&&i==i&&("number"!==a||h||(i+=s&&s[3]||(C.cssNumber[l]?"":"px")),v.clearCloneStyle||""!==i||0!==e.indexOf("background")||(c[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,r))||(h?c.setProperty(e,i):c[e]=i))}},css:function(t,e,i,n){var r,s,a,o=q(e);return $t.test(e)||(e=Jt(o)),(a=C.cssHooks[e]||C.cssHooks[o])&&"get"in a&&(r=a.get(t,!0,i)),void 0===r&&(r=Xt(t,e,n)),"normal"===r&&e in ee&&(r=ee[e]),""===i||i?(s=parseFloat(r),!0===i||isFinite(s)?s||0:r):r}}),C.each(["height","width"],(function(t,e){C.cssHooks[e]={get:function(t,i,n){if(i)return!Qt.test(C.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?re(t,e,n):Wt(t,te,(function(){return re(t,e,n)}))},set:function(t,i,n){var r,s=Gt(t),a=!v.scrollboxSize()&&"absolute"===s.position,o=(a||n)&&"border-box"===C.css(t,"boxSizing",!1,s),l=n?ne(t,e,n,o,s):0;return o&&a&&(l-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(s[e])-ne(t,e,"border",!1,s)-.5)),l&&(r=rt.exec(i))&&"px"!==(r[3]||"px")&&(t.style[e]=i,i=C.css(t,e)),ie(0,i,l)}}})),C.cssHooks.marginLeft=Zt(v.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Xt(t,"marginLeft"))||t.getBoundingClientRect().left-Wt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),C.each({margin:"",padding:"",border:"Width"},(function(t,e){C.cssHooks[t+e]={expand:function(i){for(var n=0,r={},s="string"==typeof i?i.split(" "):[i];n<4;n++)r[t+st[n]+e]=s[n]||s[n-2]||s[0];return r}},"margin"!==t&&(C.cssHooks[t+e].set=ie)})),C.fn.extend({css:function(t,e){return H(this,(function(t,e,i){var n,r,s={},a=0;if(Array.isArray(e)){for(n=Gt(t),r=e.length;a<r;a++)s[e[a]]=C.css(t,e[a],!1,n);return s}return void 0!==i?C.style(t,e,i):C.css(t,e)}),t,e,arguments.length>1)}}),C.Tween=se,se.prototype={constructor:se,init:function(t,e,i,n,r,s){this.elem=t,this.prop=i,this.easing=r||C.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=s||(C.cssNumber[i]?"":"px")},cur:function(){var t=se.propHooks[this.prop];return t&&t.get?t.get(this):se.propHooks._default.get(this)},run:function(t){var e,i=se.propHooks[this.prop];return this.options.duration?this.pos=e=C.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):se.propHooks._default.set(this),this}},se.prototype.init.prototype=se.prototype,se.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=C.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){C.fx.step[t.prop]?C.fx.step[t.prop](t):1!==t.elem.nodeType||!C.cssHooks[t.prop]&&null==t.elem.style[Jt(t.prop)]?t.elem[t.prop]=t.now:C.style(t.elem,t.prop,t.now+t.unit)}}},se.propHooks.scrollTop=se.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},C.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},(C.fx=se.prototype.init).step={};var ae,oe,le=/^(?:toggle|show|hide)$/,he=/queueHooks$/;function ce(){oe&&(!1===b.hidden&&r.requestAnimationFrame?r.requestAnimationFrame(ce):r.setTimeout(ce,C.fx.interval),C.fx.tick())}function ue(){return r.setTimeout((function(){ae=void 0})),ae=Date.now()}function de(t,e){var i,n=0,r={height:t};for(e=e?1:0;n<4;n+=2-e)r["margin"+(i=st[n])]=r["padding"+i]=t;return e&&(r.opacity=r.width=t),r}function fe(t,e,i){for(var n,r=(pe.tweeners[e]||[]).concat(pe.tweeners["*"]),s=0,a=r.length;s<a;s++)if(n=r[s].call(i,e,t))return n}function pe(t,e,i){var n,r,s=0,a=pe.prefilters.length,o=C.Deferred().always((function(){delete l.elem})),l=function(){if(r)return!1;for(var e=ae||ue(),i=Math.max(0,h.startTime+h.duration-e),n=1-(i/h.duration||0),s=0,a=h.tweens.length;s<a;s++)h.tweens[s].run(n);return o.notifyWith(t,[h,n,i]),n<1&&a?i:(a||o.notifyWith(t,[h,1,0]),o.resolveWith(t,[h]),!1)},h=o.promise({elem:t,props:C.extend({},e),opts:C.extend(!0,{specialEasing:{},easing:C.easing._default},i),originalProperties:e,originalOptions:i,startTime:ae||ue(),duration:i.duration,tweens:[],createTween:function(e,i){var n=C.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(n),n},stop:function(e){var i=0,n=e?h.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)h.tweens[i].run(1);return e?(o.notifyWith(t,[h,1,0]),o.resolveWith(t,[h,e])):o.rejectWith(t,[h,e]),this}}),c=h.props;for(!function(t,e){var i,n,r,s,a;for(i in t)if(r=e[n=q(i)],s=t[i],Array.isArray(s)&&(r=s[1],s=t[i]=s[0]),i!==n&&(t[n]=s,delete t[i]),(a=C.cssHooks[n])&&"expand"in a)for(i in s=a.expand(s),delete t[n],s)i in t||(t[i]=s[i],e[i]=r);else e[n]=r}(c,h.opts.specialEasing);s<a;s++)if(n=pe.prefilters[s].call(h,t,c,h.opts))return _(n.stop)&&(C._queueHooks(h.elem,h.opts.queue).stop=n.stop.bind(n)),n;return C.map(c,fe,h),_(h.opts.start)&&h.opts.start.call(t,h),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always),C.fx.timer(C.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h}C.Animation=C.extend(pe,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return ct(i.elem,t,rt.exec(e),i),i}]},tweener:function(t,e){_(t)?(e=t,t=["*"]):t=t.match(B);for(var i,n=0,r=t.length;n<r;n++)i=t[n],pe.tweeners[i]=pe.tweeners[i]||[],pe.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var n,r,s,a,o,l,h,c,u="width"in e||"height"in e,d=this,f={},p=t.style,m=t.nodeType&&ht(t),g=Q.get(t,"fxshow");for(n in i.queue||(null==(a=C._queueHooks(t,"fx")).unqueued&&(a.unqueued=0,o=a.empty.fire,a.empty.fire=function(){a.unqueued||o()}),a.unqueued++,d.always((function(){d.always((function(){a.unqueued--,C.queue(t,"fx").length||a.empty.fire()}))}))),e)if(r=e[n],le.test(r)){if(delete e[n],s=s||"toggle"===r,r===(m?"hide":"show")){if("show"!==r||!g||void 0===g[n])continue;m=!0}f[n]=g&&g[n]||C.style(t,n)}if((l=!C.isEmptyObject(e))||!C.isEmptyObject(f))for(n in u&&1===t.nodeType&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],null==(h=g&&g.display)&&(h=Q.get(t,"display")),"none"===(c=C.css(t,"display"))&&(h?c=h:(ft([t],!0),h=t.style.display||h,c=C.css(t,"display"),ft([t]))),("inline"===c||"inline-block"===c&&null!=h)&&"none"===C.css(t,"float")&&(l||(d.done((function(){p.display=h})),null==h&&(c=p.display,h="none"===c?"":c)),p.display="inline-block")),i.overflow&&(p.overflow="hidden",d.always((function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}))),l=!1,f)l||(g?"hidden"in g&&(m=g.hidden):g=Q.access(t,"fxshow",{display:h}),s&&(g.hidden=!m),m&&ft([t],!0),d.done((function(){for(n in m||ft([t]),Q.remove(t,"fxshow"),f)C.style(t,n,f[n])}))),l=fe(m?g[n]:0,n,d),n in g||(g[n]=l.start,m&&(l.end=l.start,l.start=0))}],prefilter:function(t,e){e?pe.prefilters.unshift(t):pe.prefilters.push(t)}}),C.speed=function(t,e,i){var r=t&&"object"===n(t)?C.extend({},t):{complete:i||!i&&e||_(t)&&t,duration:t,easing:i&&e||e&&!_(e)&&e};return C.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in C.fx.speeds?r.duration=C.fx.speeds[r.duration]:r.duration=C.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){_(r.old)&&r.old.call(this),r.queue&&C.dequeue(this,r.queue)},r},C.fn.extend({fadeTo:function(t,e,i,n){return this.filter(ht).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=C.isEmptyObject(t),s=C.speed(e,i,n),a=function(){var e=pe(this,C.extend({},t),s);(r||Q.get(this,"finish"))&&e.stop(!0)};return a.finish=a,r||!1===s.queue?this.each(a):this.queue(s.queue,a)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&this.queue(t||"fx",[]),this.each((function(){var e=!0,r=null!=t&&t+"queueHooks",s=C.timers,a=Q.get(this);if(r)a[r]&&a[r].stop&&n(a[r]);else for(r in a)a[r]&&a[r].stop&&he.test(r)&&n(a[r]);for(r=s.length;r--;)s[r].elem!==this||null!=t&&s[r].queue!==t||(s[r].anim.stop(i),e=!1,s.splice(r,1));!e&&i||C.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=Q.get(this),n=i[t+"queue"],r=i[t+"queueHooks"],s=C.timers,a=n?n.length:0;for(i.finish=!0,C.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;e<a;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish}))}}),C.each(["toggle","show","hide"],(function(t,e){var i=C.fn[e];C.fn[e]=function(t,n,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(de(e,!0),t,n,r)}})),C.each({slideDown:de("show"),slideUp:de("hide"),slideToggle:de("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){C.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}})),C.timers=[],C.fx.tick=function(){var t,e=0,i=C.timers;for(ae=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||C.fx.stop(),ae=void 0},C.fx.timer=function(t){C.timers.push(t),C.fx.start()},C.fx.interval=13,C.fx.start=function(){oe||(oe=!0,ce())},C.fx.stop=function(){oe=null},C.fx.speeds={slow:600,fast:200,_default:400},C.fn.delay=function(t,e){return t=C.fx&&C.fx.speeds[t]||t,e=e||"fx",this.queue(e,(function(e,i){var n=r.setTimeout(e,t);i.stop=function(){r.clearTimeout(n)}}))},function(){var t=b.createElement("input"),e=b.createElement("select").appendChild(b.createElement("option"));t.type="checkbox",v.checkOn=""!==t.value,v.optSelected=e.selected,(t=b.createElement("input")).value="t",t.type="radio",v.radioValue="t"===t.value}();var me,ge=C.expr.attrHandle;C.fn.extend({attr:function(t,e){return H(this,C.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){C.removeAttr(this,t)}))}}),C.extend({attr:function(t,e,i){var n,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?C.prop(t,e,i):(1===s&&C.isXMLDoc(t)||(r=C.attrHooks[e.toLowerCase()]||(C.expr.match.bool.test(e)?me:void 0)),void 0!==i?null===i?void C.removeAttr(t,e):r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:(t.setAttribute(e,i+""),i):r&&"get"in r&&null!==(n=r.get(t,e))?n:null==(n=C.find.attr(t,e))?void 0:n)},attrHooks:{type:{set:function(t,e){if(!v.radioValue&&"radio"===e&&E(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n=0,r=e&&e.match(B);if(r&&1===t.nodeType)for(;i=r[n++];)t.removeAttribute(i)}}),me={set:function(t,e,i){return!1===e?C.removeAttr(t,i):t.setAttribute(i,i),i}},C.each(C.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=ge[e]||C.find.attr;ge[e]=function(t,e,n){var r,s,a=e.toLowerCase();return n||(s=ge[a],ge[a]=r,r=null!=i(t,e,n)?a:null,ge[a]=s),r}}));var ve=/^(?:input|select|textarea|button)$/i,_e=/^(?:a|area)$/i;function ye(t){return(t.match(B)||[]).join(" ")}function be(t){return t.getAttribute&&t.getAttribute("class")||""}function xe(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(B)||[]}C.fn.extend({prop:function(t,e){return H(this,C.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[C.propFix[t]||t]}))}}),C.extend({prop:function(t,e,i){var n,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&C.isXMLDoc(t)||(e=C.propFix[e]||e,r=C.propHooks[e]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=C.find.attr(t,"tabindex");return e?parseInt(e,10):ve.test(t.nodeName)||_e.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),v.optSelected||(C.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),C.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){C.propFix[this.toLowerCase()]=this})),C.fn.extend({addClass:function(t){var e,i,n,r,s,a,o,l=0;if(_(t))return this.each((function(e){C(this).addClass(t.call(this,e,be(this)))}));if((e=xe(t)).length)for(;i=this[l++];)if(r=be(i),n=1===i.nodeType&&" "+ye(r)+" "){for(a=0;s=e[a++];)n.indexOf(" "+s+" ")<0&&(n+=s+" ");r!==(o=ye(n))&&i.setAttribute("class",o)}return this},removeClass:function(t){var e,i,n,r,s,a,o,l=0;if(_(t))return this.each((function(e){C(this).removeClass(t.call(this,e,be(this)))}));if(!arguments.length)return this.attr("class","");if((e=xe(t)).length)for(;i=this[l++];)if(r=be(i),n=1===i.nodeType&&" "+ye(r)+" "){for(a=0;s=e[a++];)for(;n.indexOf(" "+s+" ")>-1;)n=n.replace(" "+s+" "," ");r!==(o=ye(n))&&i.setAttribute("class",o)}return this},toggleClass:function(t,e){var i=n(t),r="string"===i||Array.isArray(t);return"boolean"==typeof e&&r?e?this.addClass(t):this.removeClass(t):_(t)?this.each((function(i){C(this).toggleClass(t.call(this,i,be(this),e),e)})):this.each((function(){var e,n,s,a;if(r)for(n=0,s=C(this),a=xe(t);e=a[n++];)s.hasClass(e)?s.removeClass(e):s.addClass(e);else void 0!==t&&"boolean"!==i||((e=be(this))&&Q.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":Q.get(this,"__className__")||""))}))},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+ye(be(i))+" ").indexOf(e)>-1)return!0;return!1}});var we=/\r/g;C.fn.extend({val:function(t){var e,i,n,r=this[0];return arguments.length?(n=_(t),this.each((function(i){var r;1===this.nodeType&&(null==(r=n?t.call(this,i,C(this).val()):t)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=C.map(r,(function(t){return null==t?"":t+""}))),(e=C.valHooks[this.type]||C.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))}))):r?(e=C.valHooks[r.type]||C.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(r,"value"))?i:"string"==typeof(i=r.value)?i.replace(we,""):null==i?"":i:void 0}}),C.extend({valHooks:{option:{get:function(t){var e=C.find.attr(t,"value");return null!=e?e:ye(C.text(t))}},select:{get:function(t){var e,i,n,r=t.options,s=t.selectedIndex,a="select-one"===t.type,o=a?null:[],l=a?s+1:r.length;for(n=s<0?l:a?s:0;n<l;n++)if(((i=r[n]).selected||n===s)&&!i.disabled&&(!i.parentNode.disabled||!E(i.parentNode,"optgroup"))){if(e=C(i).val(),a)return e;o.push(e)}return o},set:function(t,e){for(var i,n,r=t.options,s=C.makeArray(e),a=r.length;a--;)((n=r[a]).selected=C.inArray(C.valHooks.option.get(n),s)>-1)&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),C.each(["radio","checkbox"],(function(){C.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=C.inArray(C(t).val(),e)>-1}},v.checkOn||(C.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})})),v.focusin="onfocusin"in r;var Ae=/^(?:focusinfocus|focusoutblur)$/,Ce=function(t){t.stopPropagation()};C.extend(C.event,{trigger:function(t,e,i,s){var a,o,l,h,c,u,d,f,m=[i||b],g=p.call(t,"type")?t.type:t,v=p.call(t,"namespace")?t.namespace.split("."):[];if(o=f=l=i=i||b,3!==i.nodeType&&8!==i.nodeType&&!Ae.test(g+C.event.triggered)&&(g.indexOf(".")>-1&&(v=g.split("."),g=v.shift(),v.sort()),c=g.indexOf(":")<0&&"on"+g,(t=t[C.expando]?t:new C.Event(g,"object"===n(t)&&t)).isTrigger=s?2:3,t.namespace=v.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),e=null==e?[t]:C.makeArray(e,[t]),d=C.event.special[g]||{},s||!d.trigger||!1!==d.trigger.apply(i,e))){if(!s&&!d.noBubble&&!y(i)){for(h=d.delegateType||g,Ae.test(h+g)||(o=o.parentNode);o;o=o.parentNode)m.push(o),l=o;l===(i.ownerDocument||b)&&m.push(l.defaultView||l.parentWindow||r)}for(a=0;(o=m[a++])&&!t.isPropagationStopped();)f=o,t.type=a>1?h:d.bindType||g,(u=(Q.get(o,"events")||Object.create(null))[t.type]&&Q.get(o,"handle"))&&u.apply(o,e),(u=c&&o[c])&&u.apply&&K(o)&&(t.result=u.apply(o,e),!1===t.result&&t.preventDefault());return t.type=g,s||t.isDefaultPrevented()||d._default&&!1!==d._default.apply(m.pop(),e)||!K(i)||c&&_(i[g])&&!y(i)&&((l=i[c])&&(i[c]=null),C.event.triggered=g,t.isPropagationStopped()&&f.addEventListener(g,Ce),i[g](),t.isPropagationStopped()&&f.removeEventListener(g,Ce),C.event.triggered=void 0,l&&(i[c]=l)),t.result}},simulate:function(t,e,i){var n=C.extend(new C.Event,i,{type:t,isSimulated:!0});C.event.trigger(n,null,e)}}),C.fn.extend({trigger:function(t,e){return this.each((function(){C.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return C.event.trigger(t,e,i,!0)}}),v.focusin||C.each({focus:"focusin",blur:"focusout"},(function(t,e){var i=function(t){C.event.simulate(e,t.target,C.event.fix(t))};C.event.special[e]={setup:function(){var n=this.ownerDocument||this.document||this,r=Q.access(n,e);r||n.addEventListener(t,i,!0),Q.access(n,e,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,r=Q.access(n,e)-1;r?Q.access(n,e,r):(n.removeEventListener(t,i,!0),Q.remove(n,e))}}}));var Ie=r.location,Se={guid:Date.now()},Me=/\?/;C.parseXML=function(t){var e;if(!t||"string"!=typeof t)return null;try{e=(new r.DOMParser).parseFromString(t,"text/xml")}catch(t){e=void 0}return e&&!e.getElementsByTagName("parsererror").length||C.error("Invalid XML: "+t),e};var Te=/\[\]$/,Pe=/\r?\n/g,Ee=/^(?:submit|button|image|reset|file)$/i,ke=/^(?:input|select|textarea|keygen)/i;function De(t,e,i,r){var s;if(Array.isArray(e))C.each(e,(function(e,s){i||Te.test(t)?r(t,s):De(t+"["+("object"===n(s)&&null!=s?e:"")+"]",s,i,r)}));else if(i||"object"!==A(e))r(t,e);else for(s in e)De(t+"["+s+"]",e[s],i,r)}C.param=function(t,e){var i,n=[],r=function(t,e){var i=_(e)?e():e;n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!C.isPlainObject(t))C.each(t,(function(){r(this.name,this.value)}));else for(i in t)De(i,t[i],e,r);return n.join("&")},C.fn.extend({serialize:function(){return C.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=C.prop(this,"elements");return t?C.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!C(this).is(":disabled")&&ke.test(this.nodeName)&&!Ee.test(t)&&(this.checked||!gt.test(t))})).map((function(t,e){var i=C(this).val();return null==i?null:Array.isArray(i)?C.map(i,(function(t){return{name:e.name,value:t.replace(Pe,"\r\n")}})):{name:e.name,value:i.replace(Pe,"\r\n")}})).get()}});var Oe=/%20/g,Re=/#.*$/,Le=/([?&])_=[^&]*/,Ne=/^(.*?):[ \t]*([^\r\n]*)$/gm,ze=/^(?:GET|HEAD)$/,Be=/^\/\//,Fe={},je={},Ve="*/".concat("*"),Ue=b.createElement("a");function Ge(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r=0,s=e.toLowerCase().match(B)||[];if(_(i))for(;n=s[r++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function We(t,e,i,n){var r={},s=t===je;function a(o){var l;return r[o]=!0,C.each(t[o]||[],(function(t,o){var h=o(e,i,n);return"string"!=typeof h||s||r[h]?s?!(l=h):void 0:(e.dataTypes.unshift(h),a(h),!1)})),l}return a(e.dataTypes[0])||!r["*"]&&a("*")}function He(t,e){var i,n,r=C.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((r[i]?t:n||(n={}))[i]=e[i]);return n&&C.extend(!0,t,n),t}Ue.href=Ie.href,C.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ie.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ie.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ve,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":C.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?He(He(t,C.ajaxSettings),e):He(C.ajaxSettings,t)},ajaxPrefilter:Ge(Fe),ajaxTransport:Ge(je),ajax:function(t,e){"object"===n(t)&&(e=t,t=void 0);var i,s,a,o,l,h,c,u,d,f,p=C.ajaxSetup({},e=e||{}),m=p.context||p,g=p.context&&(m.nodeType||m.jquery)?C(m):C.event,v=C.Deferred(),_=C.Callbacks("once memory"),y=p.statusCode||{},x={},w={},A="canceled",I={readyState:0,getResponseHeader:function(t){var e;if(c){if(!o)for(o={};e=Ne.exec(a);)o[e[1].toLowerCase()+" "]=(o[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=o[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return c?a:null},setRequestHeader:function(t,e){return null==c&&(t=w[t.toLowerCase()]=w[t.toLowerCase()]||t,x[t]=e),this},overrideMimeType:function(t){return null==c&&(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(c)I.always(t[I.status]);else for(e in t)y[e]=[y[e],t[e]];return this},abort:function(t){var e=t||A;return i&&i.abort(e),S(0,e),this}};if(v.promise(I),p.url=((t||p.url||Ie.href)+"").replace(Be,Ie.protocol+"//"),p.type=e.method||e.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(B)||[""],null==p.crossDomain){h=b.createElement("a");try{h.href=p.url,h.href=h.href,p.crossDomain=Ue.protocol+"//"+Ue.host!=h.protocol+"//"+h.host}catch(t){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=C.param(p.data,p.traditional)),We(Fe,p,e,I),c)return I;for(d in(u=C.event&&p.global)&&0==C.active++&&C.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!ze.test(p.type),s=p.url.replace(Re,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Oe,"+")):(f=p.url.slice(s.length),p.data&&(p.processData||"string"==typeof p.data)&&(s+=(Me.test(s)?"&":"?")+p.data,delete p.data),!1===p.cache&&(s=s.replace(Le,"$1"),f=(Me.test(s)?"&":"?")+"_="+Se.guid+++f),p.url=s+f),p.ifModified&&(C.lastModified[s]&&I.setRequestHeader("If-Modified-Since",C.lastModified[s]),C.etag[s]&&I.setRequestHeader("If-None-Match",C.etag[s])),(p.data&&p.hasContent&&!1!==p.contentType||e.contentType)&&I.setRequestHeader("Content-Type",p.contentType),I.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ve+"; q=0.01":""):p.accepts["*"]),p.headers)I.setRequestHeader(d,p.headers[d]);if(p.beforeSend&&(!1===p.beforeSend.call(m,I,p)||c))return I.abort();if(A="abort",_.add(p.complete),I.done(p.success),I.fail(p.error),i=We(je,p,e,I)){if(I.readyState=1,u&&g.trigger("ajaxSend",[I,p]),c)return I;p.async&&p.timeout>0&&(l=r.setTimeout((function(){I.abort("timeout")}),p.timeout));try{c=!1,i.send(x,S)}catch(t){if(c)throw t;S(-1,t)}}else S(-1,"No Transport");function S(t,e,n,o){var h,d,f,b,x,w=e;c||(c=!0,l&&r.clearTimeout(l),i=void 0,a=o||"",I.readyState=t>0?4:0,h=t>=200&&t<300||304===t,n&&(b=function(t,e,i){for(var n,r,s,a,o=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(r in o)if(o[r]&&o[r].test(n)){l.unshift(r);break}if(l[0]in i)s=l[0];else{for(r in i){if(!l[0]||t.converters[r+" "+l[0]]){s=r;break}a||(a=r)}s=s||a}if(s)return s!==l[0]&&l.unshift(s),i[s]}(p,I,n)),!h&&C.inArray("script",p.dataTypes)>-1&&(p.converters["text script"]=function(){}),b=function(t,e,i,n){var r,s,a,o,l,h={},c=t.dataTypes.slice();if(c[1])for(a in t.converters)h[a.toLowerCase()]=t.converters[a];for(s=c.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=s,s=c.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(a=h[l+" "+s]||h["* "+s]))for(r in h)if((o=r.split(" "))[1]===s&&(a=h[l+" "+o[0]]||h["* "+o[0]])){!0===a?a=h[r]:!0!==h[r]&&(s=o[0],c.unshift(o[1]));break}if(!0!==a)if(a&&t.throws)e=a(e);else try{e=a(e)}catch(t){return{state:"parsererror",error:a?t:"No conversion from "+l+" to "+s}}}return{state:"success",data:e}}(p,b,I,h),h?(p.ifModified&&((x=I.getResponseHeader("Last-Modified"))&&(C.lastModified[s]=x),(x=I.getResponseHeader("etag"))&&(C.etag[s]=x)),204===t||"HEAD"===p.type?w="nocontent":304===t?w="notmodified":(w=b.state,d=b.data,h=!(f=b.error))):(f=w,!t&&w||(w="error",t<0&&(t=0))),I.status=t,I.statusText=(e||w)+"",h?v.resolveWith(m,[d,w,I]):v.rejectWith(m,[I,w,f]),I.statusCode(y),y=void 0,u&&g.trigger(h?"ajaxSuccess":"ajaxError",[I,p,h?d:f]),_.fireWith(m,[I,w]),u&&(g.trigger("ajaxComplete",[I,p]),--C.active||C.event.trigger("ajaxStop")))}return I},getJSON:function(t,e,i){return C.get(t,e,i,"json")},getScript:function(t,e){return C.get(t,void 0,e,"script")}}),C.each(["get","post"],(function(t,e){C[e]=function(t,i,n,r){return _(i)&&(r=r||n,n=i,i=void 0),C.ajax(C.extend({url:t,type:e,dataType:r,data:i,success:n},C.isPlainObject(t)&&t))}})),C.ajaxPrefilter((function(t){var e;for(e in t.headers)"content-type"===e.toLowerCase()&&(t.contentType=t.headers[e]||"")})),C._evalUrl=function(t,e,i){return C.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){C.globalEval(t,e,i)}})},C.fn.extend({wrapAll:function(t){var e;return this[0]&&(_(t)&&(t=t.call(this[0])),e=C(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this},wrapInner:function(t){return _(t)?this.each((function(e){C(this).wrapInner(t.call(this,e))})):this.each((function(){var e=C(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=_(t);return this.each((function(i){C(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(t){return this.parent(t).not("body").each((function(){C(this).replaceWith(this.childNodes)})),this}}),C.expr.pseudos.hidden=function(t){return!C.expr.pseudos.visible(t)},C.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},C.ajaxSettings.xhr=function(){try{return new r.XMLHttpRequest}catch(t){}};var Xe={0:200,1223:204},Ze=C.ajaxSettings.xhr();v.cors=!!Ze&&"withCredentials"in Ze,v.ajax=Ze=!!Ze,C.ajaxTransport((function(t){var e,i;if(v.cors||Ze&&!t.crossDomain)return{send:function(n,s){var a,o=t.xhr();if(o.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)o[a]=t.xhrFields[a];for(a in t.mimeType&&o.overrideMimeType&&o.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)o.setRequestHeader(a,n[a]);e=function(t){return function(){e&&(e=i=o.onload=o.onerror=o.onabort=o.ontimeout=o.onreadystatechange=null,"abort"===t?o.abort():"error"===t?"number"!=typeof o.status?s(0,"error"):s(o.status,o.statusText):s(Xe[o.status]||o.status,o.statusText,"text"!==(o.responseType||"text")||"string"!=typeof o.responseText?{binary:o.response}:{text:o.responseText},o.getAllResponseHeaders()))}},o.onload=e(),i=o.onerror=o.ontimeout=e("error"),void 0!==o.onabort?o.onabort=i:o.onreadystatechange=function(){4===o.readyState&&r.setTimeout((function(){e&&i()}))},e=e("abort");try{o.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}})),C.ajaxPrefilter((function(t){t.crossDomain&&(t.contents.script=!1)})),C.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return C.globalEval(t),t}}}),C.ajaxPrefilter("script",(function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),C.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain||t.scriptAttrs)return{send:function(n,r){e=C("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&r("error"===t.type?404:200,t.type)}),b.head.appendChild(e[0])},abort:function(){i&&i()}}}));var Ye,qe=[],Ke=/(=)\?(?=&|$)|\?\?/;C.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=qe.pop()||C.expando+"_"+Se.guid++;return this[t]=!0,t}}),C.ajaxPrefilter("json jsonp",(function(t,e,i){var n,s,a,o=!1!==t.jsonp&&(Ke.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ke.test(t.data)&&"data");if(o||"jsonp"===t.dataTypes[0])return n=t.jsonpCallback=_(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(Ke,"$1"+n):!1!==t.jsonp&&(t.url+=(Me.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return a||C.error(n+" was not called"),a[0]},t.dataTypes[0]="json",s=r[n],r[n]=function(){a=arguments},i.always((function(){void 0===s?C(r).removeProp(n):r[n]=s,t[n]&&(t.jsonpCallback=e.jsonpCallback,qe.push(n)),a&&_(s)&&s(a[0]),a=s=void 0})),"script"})),v.createHTMLDocument=((Ye=b.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Ye.childNodes.length),C.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(v.createHTMLDocument?((n=(e=b.implementation.createHTMLDocument("")).createElement("base")).href=b.location.href,e.head.appendChild(n)):e=b),s=!i&&[],(r=k.exec(t))?[e.createElement(r[1])]:(r=At([t],e,s),s&&s.length&&C(s).remove(),C.merge([],r.childNodes)));var n,r,s},C.fn.load=function(t,e,i){var r,s,a,o=this,l=t.indexOf(" ");return l>-1&&(r=ye(t.slice(l)),t=t.slice(0,l)),_(e)?(i=e,e=void 0):e&&"object"===n(e)&&(s="POST"),o.length>0&&C.ajax({url:t,type:s||"GET",dataType:"html",data:e}).done((function(t){a=arguments,o.html(r?C("<div>").append(C.parseHTML(t)).find(r):t)})).always(i&&function(t,e){o.each((function(){i.apply(this,a||[t.responseText,e,t])}))}),this},C.expr.pseudos.animated=function(t){return C.grep(C.timers,(function(e){return t===e.elem})).length},C.offset={setOffset:function(t,e,i){var n,r,s,a,o,l,h=C.css(t,"position"),c=C(t),u={};"static"===h&&(t.style.position="relative"),o=c.offset(),s=C.css(t,"top"),l=C.css(t,"left"),("absolute"===h||"fixed"===h)&&(s+l).indexOf("auto")>-1?(a=(n=c.position()).top,r=n.left):(a=parseFloat(s)||0,r=parseFloat(l)||0),_(e)&&(e=e.call(t,i,C.extend({},o))),null!=e.top&&(u.top=e.top-o.top+a),null!=e.left&&(u.left=e.left-o.left+r),"using"in e?e.using.call(t,u):("number"==typeof u.top&&(u.top+="px"),"number"==typeof u.left&&(u.left+="px"),c.css(u))}},C.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each((function(e){C.offset.setOffset(this,t,e)}));var e,i,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,n=this[0],r={top:0,left:0};if("fixed"===C.css(n,"position"))e=n.getBoundingClientRect();else{for(e=this.offset(),i=n.ownerDocument,t=n.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===C.css(t,"position");)t=t.parentNode;t&&t!==n&&1===t.nodeType&&((r=C(t).offset()).top+=C.css(t,"borderTopWidth",!0),r.left+=C.css(t,"borderLeftWidth",!0))}return{top:e.top-r.top-C.css(n,"marginTop",!0),left:e.left-r.left-C.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===C.css(t,"position");)t=t.offsetParent;return t||at}))}}),C.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;C.fn[t]=function(n){return H(this,(function(t,n,r){var s;if(y(t)?s=t:9===t.nodeType&&(s=t.defaultView),void 0===r)return s?s[e]:t[n];s?s.scrollTo(i?s.pageXOffset:r,i?r:s.pageYOffset):t[n]=r}),t,n,arguments.length)}})),C.each(["top","left"],(function(t,e){C.cssHooks[e]=Zt(v.pixelPosition,(function(t,i){if(i)return i=Xt(t,e),Ut.test(i)?C(t).position()[e]+"px":i}))})),C.each({Height:"height",Width:"width"},(function(t,e){C.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,n){C.fn[n]=function(r,s){var a=arguments.length&&(i||"boolean"!=typeof r),o=i||(!0===r||!0===s?"margin":"border");return H(this,(function(e,i,r){var s;return y(e)?0===n.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===r?C.css(e,i,o):C.style(e,i,r,o)}),e,a?r:void 0,a)}}))})),C.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){C.fn[e]=function(t){return this.on(e,t)}})),C.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),C.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(t,e){C.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}));var Je=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;C.proxy=function(t,e){var i,n,r;if("string"==typeof e&&(i=t[e],e=t,t=i),_(t))return n=l.call(arguments,2),(r=function(){return t.apply(e||this,n.concat(l.call(arguments)))}).guid=t.guid=t.guid||C.guid++,r},C.holdReady=function(t){t?C.readyWait++:C.ready(!0)},C.isArray=Array.isArray,C.parseJSON=JSON.parse,C.nodeName=E,C.isFunction=_,C.isWindow=y,C.camelCase=q,C.type=A,C.now=Date.now,C.isNumeric=function(t){var e=C.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},C.trim=function(t){return null==t?"":(t+"").replace(Je,"")},void 0===(i=function(){return C}.apply(e,[]))||(t.exports=i);var Qe=r.jQuery,$e=r.$;return C.noConflict=function(t){return r.$===C&&(r.$=$e),t&&r.jQuery===C&&(r.jQuery=Qe),C},void 0===s&&(r.jQuery=r.$=C),C}))}).call(this,i(4)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"===("undefined"==typeof window?"undefined":i(window))&&(n=window)}t.exports=n},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var r=(a=n,o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(l," */")),s=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[i].concat(s).concat([r]).join("\n")}var a,o,l;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,n){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(n)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(r[a]=!0)}for(var o=0;o<t.length;o++){var l=[].concat(t[o]);n&&r[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),e.push(l))}},e}},function(t,e,i){var n,r,s={},a=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=n.apply(this,arguments)),r}),o=function(t,e){return e?e.querySelector(t):document.querySelector(t)},l=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=o.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),h=null,c=0,u=[],d=i(35);function f(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=s[n.id];if(r){r.refs++;for(var a=0;a<r.parts.length;a++)r.parts[a](n.parts[a]);for(;a<n.parts.length;a++)r.parts.push(y(n.parts[a],e))}else{var o=[];for(a=0;a<n.parts.length;a++)o.push(y(n.parts[a],e));s[n.id]={id:n.id,refs:1,parts:o}}}}function p(t,e){for(var i=[],n={},r=0;r<t.length;r++){var s=t[r],a=e.base?s[0]+e.base:s[0],o={css:s[1],media:s[2],sourceMap:s[3]};n[a]?n[a].parts.push(o):i.push(n[a]={id:a,parts:[o]})}return i}function m(t,e){var i=l(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=u[u.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),u.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=l(t.insertAt.before,i);i.insertBefore(e,r)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=u.indexOf(t);e>=0&&u.splice(e,1)}function v(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return _(e,t.attrs),m(t,e),e}function _(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}function y(t,e){var i,n,r,s;if(e.transform&&t.css){if(!(s="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=s}if(e.singleton){var a=c++;i=h||(h=v(e)),n=w.bind(null,i,a,!1),r=w.bind(null,i,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",_(e,t.attrs),m(t,e),e}(e),n=C.bind(null,i,e),r=function(){g(i),i.href&&URL.revokeObjectURL(i.href)}):(i=v(e),n=A.bind(null,i),r=function(){g(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else r()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=a()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=p(t,e);return f(i,e),function(t){for(var n=[],r=0;r<i.length;r++){var a=i[r];(o=s[a.id]).refs--,n.push(o)}t&&f(p(t,e),e);for(r=0;r<n.length;r++){var o;if(0===(o=n[r]).refs){for(var l=0;l<o.parts.length;l++)o.parts[l]();delete s[o.id]}}}};var b,x=(b=[],function(t,e){return b[t]=e,b.filter(Boolean).join("\n")});function w(t,e,i,n){var r=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=x(e,r);else{var s=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(s,a[e]):t.appendChild(s)}}function A(t,e){var i=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function C(t,e,i){var n=i.css,r=i.sourceMap,s=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||s)&&(n=d(n)),r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var a=new Blob([n],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(a),o&&URL.revokeObjectURL(o)}},function(t,e,i){(function(t,n){var r;function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var a="Expected a function",o="__lodash_placeholder__",l=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],h="[object Arguments]",c="[object Array]",u="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",m="[object GeneratorFunction]",g="[object Map]",v="[object Number]",_="[object Object]",y="[object RegExp]",b="[object Set]",x="[object String]",w="[object Symbol]",A="[object WeakMap]",C="[object ArrayBuffer]",I="[object DataView]",S="[object Float32Array]",M="[object Float64Array]",T="[object Int8Array]",P="[object Int16Array]",E="[object Int32Array]",k="[object Uint8Array]",D="[object Uint16Array]",O="[object Uint32Array]",R=/\b__p \+= '';/g,L=/\b(__p \+=) '' \+/g,N=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z=/&(?:amp|lt|gt|quot|#39);/g,B=/[&<>"']/g,F=RegExp(z.source),j=RegExp(B.source),V=/<%-([\s\S]+?)%>/g,U=/<%([\s\S]+?)%>/g,G=/<%=([\s\S]+?)%>/g,W=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,H=/^\w*$/,X=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Z=/[\\^$.*+?()[\]{}|]/g,Y=RegExp(Z.source),q=/^\s+|\s+$/g,K=/^\s+/,J=/\s+$/,Q=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,$=/\{\n\/\* \[wrapped with (.+)\] \*/,tt=/,? & /,et=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,it=/\\(\\)?/g,nt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,rt=/\w*$/,st=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,ot=/^\[object .+?Constructor\]$/,lt=/^0o[0-7]+$/i,ht=/^(?:0|[1-9]\d*)$/,ct=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ut=/($^)/,dt=/['\n\r\u2028\u2029\\]/g,ft="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",pt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",mt="[\\ud800-\\udfff]",gt="["+pt+"]",vt="["+ft+"]",_t="\\d+",yt="[\\u2700-\\u27bf]",bt="[a-z\\xdf-\\xf6\\xf8-\\xff]",xt="[^\\ud800-\\udfff"+pt+_t+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",wt="\\ud83c[\\udffb-\\udfff]",At="[^\\ud800-\\udfff]",Ct="(?:\\ud83c[\\udde6-\\uddff]){2}",It="[\\ud800-\\udbff][\\udc00-\\udfff]",St="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Mt="(?:"+bt+"|"+xt+")",Tt="(?:"+St+"|"+xt+")",Pt="(?:"+vt+"|"+wt+")"+"?",Et="[\\ufe0e\\ufe0f]?"+Pt+("(?:\\u200d(?:"+[At,Ct,It].join("|")+")[\\ufe0e\\ufe0f]?"+Pt+")*"),kt="(?:"+[yt,Ct,It].join("|")+")"+Et,Dt="(?:"+[At+vt+"?",vt,Ct,It,mt].join("|")+")",Ot=RegExp("[']","g"),Rt=RegExp(vt,"g"),Lt=RegExp(wt+"(?="+wt+")|"+Dt+Et,"g"),Nt=RegExp([St+"?"+bt+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[gt,St,"$"].join("|")+")",Tt+"+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[gt,St+Mt,"$"].join("|")+")",St+"?"+Mt+"+(?:['](?:d|ll|m|re|s|t|ve))?",St+"+(?:['](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_t,kt].join("|"),"g"),zt=RegExp("[\\u200d\\ud800-\\udfff"+ft+"\\ufe0e\\ufe0f]"),Bt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ft=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],jt=-1,Vt={};Vt[S]=Vt[M]=Vt[T]=Vt[P]=Vt[E]=Vt[k]=Vt["[object Uint8ClampedArray]"]=Vt[D]=Vt[O]=!0,Vt[h]=Vt[c]=Vt[C]=Vt[u]=Vt[I]=Vt[d]=Vt[f]=Vt[p]=Vt[g]=Vt[v]=Vt[_]=Vt[y]=Vt[b]=Vt[x]=Vt[A]=!1;var Ut={};Ut[h]=Ut[c]=Ut[C]=Ut[I]=Ut[u]=Ut[d]=Ut[S]=Ut[M]=Ut[T]=Ut[P]=Ut[E]=Ut[g]=Ut[v]=Ut[_]=Ut[y]=Ut[b]=Ut[x]=Ut[w]=Ut[k]=Ut["[object Uint8ClampedArray]"]=Ut[D]=Ut[O]=!0,Ut[f]=Ut[p]=Ut[A]=!1;var Gt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Wt=parseFloat,Ht=parseInt,Xt="object"==(void 0===t?"undefined":s(t))&&t&&t.Object===Object&&t,Zt="object"==("undefined"==typeof self?"undefined":s(self))&&self&&self.Object===Object&&self,Yt=Xt||Zt||Function("return this")(),qt="object"==s(e)&&e&&!e.nodeType&&e,Kt=qt&&"object"==s(n)&&n&&!n.nodeType&&n,Jt=Kt&&Kt.exports===qt,Qt=Jt&&Xt.process,$t=function(){try{var t=Kt&&Kt.require&&Kt.require("util").types;return t||Qt&&Qt.binding&&Qt.binding("util")}catch(t){}}(),te=$t&&$t.isArrayBuffer,ee=$t&&$t.isDate,ie=$t&&$t.isMap,ne=$t&&$t.isRegExp,re=$t&&$t.isSet,se=$t&&$t.isTypedArray;function ae(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function oe(t,e,i,n){for(var r=-1,s=null==t?0:t.length;++r<s;){var a=t[r];e(n,a,i(a),t)}return n}function le(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}function he(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}function ce(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function ue(t,e){for(var i=-1,n=null==t?0:t.length,r=0,s=[];++i<n;){var a=t[i];e(a,i,t)&&(s[r++]=a)}return s}function de(t,e){return!!(null==t?0:t.length)&&we(t,e,0)>-1}function fe(t,e,i){for(var n=-1,r=null==t?0:t.length;++n<r;)if(i(e,t[n]))return!0;return!1}function pe(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}function me(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}function ge(t,e,i,n){var r=-1,s=null==t?0:t.length;for(n&&s&&(i=t[++r]);++r<s;)i=e(i,t[r],r,t);return i}function ve(t,e,i,n){var r=null==t?0:t.length;for(n&&r&&(i=t[--r]);r--;)i=e(i,t[r],r,t);return i}function _e(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}var ye=Se("length");function be(t,e,i){var n;return i(t,(function(t,i,r){if(e(t,i,r))return n=i,!1})),n}function xe(t,e,i,n){for(var r=t.length,s=i+(n?1:-1);n?s--:++s<r;)if(e(t[s],s,t))return s;return-1}function we(t,e,i){return e==e?function(t,e,i){var n=i-1,r=t.length;for(;++n<r;)if(t[n]===e)return n;return-1}(t,e,i):xe(t,Ce,i)}function Ae(t,e,i,n){for(var r=i-1,s=t.length;++r<s;)if(n(t[r],e))return r;return-1}function Ce(t){return t!=t}function Ie(t,e){var i=null==t?0:t.length;return i?Pe(t,e)/i:NaN}function Se(t){return function(e){return null==e?void 0:e[t]}}function Me(t){return function(e){return null==t?void 0:t[e]}}function Te(t,e,i,n,r){return r(t,(function(t,r,s){i=n?(n=!1,t):e(i,t,r,s)})),i}function Pe(t,e){for(var i,n=-1,r=t.length;++n<r;){var s=e(t[n]);void 0!==s&&(i=void 0===i?s:i+s)}return i}function Ee(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}function ke(t){return function(e){return t(e)}}function De(t,e){return pe(e,(function(e){return t[e]}))}function Oe(t,e){return t.has(e)}function Re(t,e){for(var i=-1,n=t.length;++i<n&&we(e,t[i],0)>-1;);return i}function Le(t,e){for(var i=t.length;i--&&we(e,t[i],0)>-1;);return i}function Ne(t,e){for(var i=t.length,n=0;i--;)t[i]===e&&++n;return n}var ze=Me({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),Be=Me({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Fe(t){return"\\"+Gt[t]}function je(t){return zt.test(t)}function Ve(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function Ue(t,e){return function(i){return t(e(i))}}function Ge(t,e){for(var i=-1,n=t.length,r=0,s=[];++i<n;){var a=t[i];a!==e&&a!==o||(t[i]=o,s[r++]=i)}return s}function We(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}function He(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=[t,t]})),i}function Xe(t){return je(t)?function(t){var e=Lt.lastIndex=0;for(;Lt.test(t);)++e;return e}(t):ye(t)}function Ze(t){return je(t)?function(t){return t.match(Lt)||[]}(t):function(t){return t.split("")}(t)}var Ye=Me({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var qe=function t(e){var i,n=(e=null==e?Yt:qe.defaults(Yt.Object(),e,qe.pick(Yt,Ft))).Array,r=e.Date,ft=e.Error,pt=e.Function,mt=e.Math,gt=e.Object,vt=e.RegExp,_t=e.String,yt=e.TypeError,bt=n.prototype,xt=pt.prototype,wt=gt.prototype,At=e["__core-js_shared__"],Ct=xt.toString,It=wt.hasOwnProperty,St=0,Mt=(i=/[^.]+$/.exec(At&&At.keys&&At.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",Tt=wt.toString,Pt=Ct.call(gt),Et=Yt._,kt=vt("^"+Ct.call(It).replace(Z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Dt=Jt?e.Buffer:void 0,Lt=e.Symbol,zt=e.Uint8Array,Gt=Dt?Dt.allocUnsafe:void 0,Xt=Ue(gt.getPrototypeOf,gt),Zt=gt.create,qt=wt.propertyIsEnumerable,Kt=bt.splice,Qt=Lt?Lt.isConcatSpreadable:void 0,$t=Lt?Lt.iterator:void 0,ye=Lt?Lt.toStringTag:void 0,Me=function(){try{var t=ts(gt,"defineProperty");return t({},"",{}),t}catch(t){}}(),Ke=e.clearTimeout!==Yt.clearTimeout&&e.clearTimeout,Je=r&&r.now!==Yt.Date.now&&r.now,Qe=e.setTimeout!==Yt.setTimeout&&e.setTimeout,$e=mt.ceil,ti=mt.floor,ei=gt.getOwnPropertySymbols,ii=Dt?Dt.isBuffer:void 0,ni=e.isFinite,ri=bt.join,si=Ue(gt.keys,gt),ai=mt.max,oi=mt.min,li=r.now,hi=e.parseInt,ci=mt.random,ui=bt.reverse,di=ts(e,"DataView"),fi=ts(e,"Map"),pi=ts(e,"Promise"),mi=ts(e,"Set"),gi=ts(e,"WeakMap"),vi=ts(gt,"create"),_i=gi&&new gi,yi={},bi=Ms(di),xi=Ms(fi),wi=Ms(pi),Ai=Ms(mi),Ci=Ms(gi),Ii=Lt?Lt.prototype:void 0,Si=Ii?Ii.valueOf:void 0,Mi=Ii?Ii.toString:void 0;function Ti(t){if(Wa(t)&&!Oa(t)&&!(t instanceof Di)){if(t instanceof ki)return t;if(It.call(t,"__wrapped__"))return Ts(t)}return new ki(t)}var Pi=function(){function t(){}return function(e){if(!Ga(e))return{};if(Zt)return Zt(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}();function Ei(){}function ki(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}function Di(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Oi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ri(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Li(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Ni(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Li;++e<i;)this.add(t[e])}function zi(t){var e=this.__data__=new Ri(t);this.size=e.size}function Bi(t,e){var i=Oa(t),n=!i&&Da(t),r=!i&&!n&&za(t),s=!i&&!n&&!r&&Qa(t),a=i||n||r||s,o=a?Ee(t.length,_t):[],l=o.length;for(var h in t)!e&&!It.call(t,h)||a&&("length"==h||r&&("offset"==h||"parent"==h)||s&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||os(h,l))||o.push(h);return o}function Fi(t){var e=t.length;return e?t[zn(0,e-1)]:void 0}function ji(t,e){return Cs(_r(t),qi(e,0,t.length))}function Vi(t){return Cs(_r(t))}function Ui(t,e,i){(void 0!==i&&!Pa(t[e],i)||void 0===i&&!(e in t))&&Zi(t,e,i)}function Gi(t,e,i){var n=t[e];It.call(t,e)&&Pa(n,i)&&(void 0!==i||e in t)||Zi(t,e,i)}function Wi(t,e){for(var i=t.length;i--;)if(Pa(t[i][0],e))return i;return-1}function Hi(t,e,i,n){return tn(t,(function(t,r,s){e(n,t,i(t),s)})),n}function Xi(t,e){return t&&yr(e,xo(e),t)}function Zi(t,e,i){"__proto__"==e&&Me?Me(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function Yi(t,e){for(var i=-1,r=e.length,s=n(r),a=null==t;++i<r;)s[i]=a?void 0:go(t,e[i]);return s}function qi(t,e,i){return t==t&&(void 0!==i&&(t=t<=i?t:i),void 0!==e&&(t=t>=e?t:e)),t}function Ki(t,e,i,n,r,s){var a,o=1&e,l=2&e,c=4&e;if(i&&(a=r?i(t,n,r,s):i(t)),void 0!==a)return a;if(!Ga(t))return t;var f=Oa(t);if(f){if(a=function(t){var e=t.length,i=new t.constructor(e);e&&"string"==typeof t[0]&&It.call(t,"index")&&(i.index=t.index,i.input=t.input);return i}(t),!o)return _r(t,a)}else{var A=ns(t),R=A==p||A==m;if(za(t))return dr(t,o);if(A==_||A==h||R&&!r){if(a=l||R?{}:ss(t),!o)return l?function(t,e){return yr(t,is(t),e)}(t,function(t,e){return t&&yr(e,wo(e),t)}(a,t)):function(t,e){return yr(t,es(t),e)}(t,Xi(a,t))}else{if(!Ut[A])return r?t:{};a=function(t,e,i){var n=t.constructor;switch(e){case C:return fr(t);case u:case d:return new n(+t);case I:return function(t,e){var i=e?fr(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case S:case M:case T:case P:case E:case k:case"[object Uint8ClampedArray]":case D:case O:return pr(t,i);case g:return new n;case v:case x:return new n(t);case y:return function(t){var e=new t.constructor(t.source,rt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case b:return new n;case w:return r=t,Si?gt(Si.call(r)):{}}var r}(t,A,o)}}s||(s=new zi);var L=s.get(t);if(L)return L;s.set(t,a),qa(t)?t.forEach((function(n){a.add(Ki(n,e,i,n,t,s))})):Ha(t)&&t.forEach((function(n,r){a.set(r,Ki(n,e,i,r,t,s))}));var N=f?void 0:(c?l?Zr:Xr:l?wo:xo)(t);return le(N||t,(function(n,r){N&&(n=t[r=n]),Gi(a,r,Ki(n,e,i,r,t,s))})),a}function Ji(t,e,i){var n=i.length;if(null==t)return!n;for(t=gt(t);n--;){var r=i[n],s=e[r],a=t[r];if(void 0===a&&!(r in t)||!s(a))return!1}return!0}function Qi(t,e,i){if("function"!=typeof t)throw new yt(a);return bs((function(){t.apply(void 0,i)}),e)}function $i(t,e,i,n){var r=-1,s=de,a=!0,o=t.length,l=[],h=e.length;if(!o)return l;i&&(e=pe(e,ke(i))),n?(s=fe,a=!1):e.length>=200&&(s=Oe,a=!1,e=new Ni(e));t:for(;++r<o;){var c=t[r],u=null==i?c:i(c);if(c=n||0!==c?c:0,a&&u==u){for(var d=h;d--;)if(e[d]===u)continue t;l.push(c)}else s(e,u,n)||l.push(c)}return l}Ti.templateSettings={escape:V,evaluate:U,interpolate:G,variable:"",imports:{_:Ti}},Ti.prototype=Ei.prototype,Ti.prototype.constructor=Ti,ki.prototype=Pi(Ei.prototype),ki.prototype.constructor=ki,Di.prototype=Pi(Ei.prototype),Di.prototype.constructor=Di,Oi.prototype.clear=function(){this.__data__=vi?vi(null):{},this.size=0},Oi.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Oi.prototype.get=function(t){var e=this.__data__;if(vi){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return It.call(e,t)?e[t]:void 0},Oi.prototype.has=function(t){var e=this.__data__;return vi?void 0!==e[t]:It.call(e,t)},Oi.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=vi&&void 0===e?"__lodash_hash_undefined__":e,this},Ri.prototype.clear=function(){this.__data__=[],this.size=0},Ri.prototype.delete=function(t){var e=this.__data__,i=Wi(e,t);return!(i<0)&&(i==e.length-1?e.pop():Kt.call(e,i,1),--this.size,!0)},Ri.prototype.get=function(t){var e=this.__data__,i=Wi(e,t);return i<0?void 0:e[i][1]},Ri.prototype.has=function(t){return Wi(this.__data__,t)>-1},Ri.prototype.set=function(t,e){var i=this.__data__,n=Wi(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this},Li.prototype.clear=function(){this.size=0,this.__data__={hash:new Oi,map:new(fi||Ri),string:new Oi}},Li.prototype.delete=function(t){var e=Qr(this,t).delete(t);return this.size-=e?1:0,e},Li.prototype.get=function(t){return Qr(this,t).get(t)},Li.prototype.has=function(t){return Qr(this,t).has(t)},Li.prototype.set=function(t,e){var i=Qr(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},Ni.prototype.add=Ni.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ni.prototype.has=function(t){return this.__data__.has(t)},zi.prototype.clear=function(){this.__data__=new Ri,this.size=0},zi.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},zi.prototype.get=function(t){return this.__data__.get(t)},zi.prototype.has=function(t){return this.__data__.has(t)},zi.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Ri){var n=i.__data__;if(!fi||n.length<199)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new Li(n)}return i.set(t,e),this.size=i.size,this};var tn=wr(hn),en=wr(cn,!0);function nn(t,e){var i=!0;return tn(t,(function(t,n,r){return i=!!e(t,n,r)})),i}function rn(t,e,i){for(var n=-1,r=t.length;++n<r;){var s=t[n],a=e(s);if(null!=a&&(void 0===o?a==a&&!Ja(a):i(a,o)))var o=a,l=s}return l}function sn(t,e){var i=[];return tn(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i}function an(t,e,i,n,r){var s=-1,a=t.length;for(i||(i=as),r||(r=[]);++s<a;){var o=t[s];e>0&&i(o)?e>1?an(o,e-1,i,n,r):me(r,o):n||(r[r.length]=o)}return r}var on=Ar(),ln=Ar(!0);function hn(t,e){return t&&on(t,e,xo)}function cn(t,e){return t&&ln(t,e,xo)}function un(t,e){return ue(e,(function(e){return ja(t[e])}))}function dn(t,e){for(var i=0,n=(e=lr(e,t)).length;null!=t&&i<n;)t=t[Ss(e[i++])];return i&&i==n?t:void 0}function fn(t,e,i){var n=e(t);return Oa(t)?n:me(n,i(t))}function pn(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":ye&&ye in gt(t)?function(t){var e=It.call(t,ye),i=t[ye];try{t[ye]=void 0;var n=!0}catch(t){}var r=Tt.call(t);n&&(e?t[ye]=i:delete t[ye]);return r}(t):function(t){return Tt.call(t)}(t)}function mn(t,e){return t>e}function gn(t,e){return null!=t&&It.call(t,e)}function vn(t,e){return null!=t&&e in gt(t)}function _n(t,e,i){for(var r=i?fe:de,s=t[0].length,a=t.length,o=a,l=n(a),h=1/0,c=[];o--;){var u=t[o];o&&e&&(u=pe(u,ke(e))),h=oi(u.length,h),l[o]=!i&&(e||s>=120&&u.length>=120)?new Ni(o&&u):void 0}u=t[0];var d=-1,f=l[0];t:for(;++d<s&&c.length<h;){var p=u[d],m=e?e(p):p;if(p=i||0!==p?p:0,!(f?Oe(f,m):r(c,m,i))){for(o=a;--o;){var g=l[o];if(!(g?Oe(g,m):r(t[o],m,i)))continue t}f&&f.push(m),c.push(p)}}return c}function yn(t,e,i){var n=null==(t=gs(t,e=lr(e,t)))?t:t[Ss(Fs(e))];return null==n?void 0:ae(n,t,i)}function bn(t){return Wa(t)&&pn(t)==h}function xn(t,e,i,n,r){return t===e||(null==t||null==e||!Wa(t)&&!Wa(e)?t!=t&&e!=e:function(t,e,i,n,r,s){var a=Oa(t),o=Oa(e),l=a?c:ns(t),p=o?c:ns(e),m=(l=l==h?_:l)==_,A=(p=p==h?_:p)==_,S=l==p;if(S&&za(t)){if(!za(e))return!1;a=!0,m=!1}if(S&&!m)return s||(s=new zi),a||Qa(t)?Wr(t,e,i,n,r,s):function(t,e,i,n,r,s,a){switch(i){case I:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case C:return!(t.byteLength!=e.byteLength||!s(new zt(t),new zt(e)));case u:case d:case v:return Pa(+t,+e);case f:return t.name==e.name&&t.message==e.message;case y:case x:return t==e+"";case g:var o=Ve;case b:var l=1&n;if(o||(o=We),t.size!=e.size&&!l)return!1;var h=a.get(t);if(h)return h==e;n|=2,a.set(t,e);var c=Wr(o(t),o(e),n,r,s,a);return a.delete(t),c;case w:if(Si)return Si.call(t)==Si.call(e)}return!1}(t,e,l,i,n,r,s);if(!(1&i)){var M=m&&It.call(t,"__wrapped__"),T=A&&It.call(e,"__wrapped__");if(M||T){var P=M?t.value():t,E=T?e.value():e;return s||(s=new zi),r(P,E,i,n,s)}}if(!S)return!1;return s||(s=new zi),function(t,e,i,n,r,s){var a=1&i,o=Xr(t),l=o.length,h=Xr(e).length;if(l!=h&&!a)return!1;var c=l;for(;c--;){var u=o[c];if(!(a?u in e:It.call(e,u)))return!1}var d=s.get(t),f=s.get(e);if(d&&f)return d==e&&f==t;var p=!0;s.set(t,e),s.set(e,t);var m=a;for(;++c<l;){u=o[c];var g=t[u],v=e[u];if(n)var _=a?n(v,g,u,e,t,s):n(g,v,u,t,e,s);if(!(void 0===_?g===v||r(g,v,i,n,s):_)){p=!1;break}m||(m="constructor"==u)}if(p&&!m){var y=t.constructor,b=e.constructor;y==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(p=!1)}return s.delete(t),s.delete(e),p}(t,e,i,n,r,s)}(t,e,i,n,xn,r))}function wn(t,e,i,n){var r=i.length,s=r,a=!n;if(null==t)return!s;for(t=gt(t);r--;){var o=i[r];if(a&&o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++r<s;){var l=(o=i[r])[0],h=t[l],c=o[1];if(a&&o[2]){if(void 0===h&&!(l in t))return!1}else{var u=new zi;if(n)var d=n(h,c,l,t,e,u);if(!(void 0===d?xn(c,h,3,n,u):d))return!1}}return!0}function An(t){return!(!Ga(t)||(e=t,Mt&&Mt in e))&&(ja(t)?kt:ot).test(Ms(t));var e}function Cn(t){return"function"==typeof t?t:null==t?Zo:"object"==s(t)?Oa(t)?En(t[0],t[1]):Pn(t):il(t)}function In(t){if(!ds(t))return si(t);var e=[];for(var i in gt(t))It.call(t,i)&&"constructor"!=i&&e.push(i);return e}function Sn(t){if(!Ga(t))return function(t){var e=[];if(null!=t)for(var i in gt(t))e.push(i);return e}(t);var e=ds(t),i=[];for(var n in t)("constructor"!=n||!e&&It.call(t,n))&&i.push(n);return i}function Mn(t,e){return t<e}function Tn(t,e){var i=-1,r=La(t)?n(t.length):[];return tn(t,(function(t,n,s){r[++i]=e(t,n,s)})),r}function Pn(t){var e=$r(t);return 1==e.length&&e[0][2]?ps(e[0][0],e[0][1]):function(i){return i===t||wn(i,t,e)}}function En(t,e){return hs(t)&&fs(e)?ps(Ss(t),e):function(i){var n=go(i,t);return void 0===n&&n===e?vo(i,t):xn(e,n,3)}}function kn(t,e,i,n,r){t!==e&&on(e,(function(s,a){if(r||(r=new zi),Ga(s))!function(t,e,i,n,r,s,a){var o=_s(t,i),l=_s(e,i),h=a.get(l);if(h)return void Ui(t,i,h);var c=s?s(o,l,i+"",t,e,a):void 0,u=void 0===c;if(u){var d=Oa(l),f=!d&&za(l),p=!d&&!f&&Qa(l);c=l,d||f||p?Oa(o)?c=o:Na(o)?c=_r(o):f?(u=!1,c=dr(l,!0)):p?(u=!1,c=pr(l,!0)):c=[]:Za(l)||Da(l)?(c=o,Da(o)?c=ao(o):Ga(o)&&!ja(o)||(c=ss(l))):u=!1}u&&(a.set(l,c),r(c,l,n,s,a),a.delete(l));Ui(t,i,c)}(t,e,a,i,kn,n,r);else{var o=n?n(_s(t,a),s,a+"",t,e,r):void 0;void 0===o&&(o=s),Ui(t,a,o)}}),wo)}function Dn(t,e){var i=t.length;if(i)return os(e+=e<0?i:0,i)?t[e]:void 0}function On(t,e,i){e=e.length?pe(e,(function(t){return Oa(t)?function(e){return dn(e,1===t.length?t[0]:t)}:t})):[Zo];var n=-1;return e=pe(e,ke(Jr())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(Tn(t,(function(t,i,r){return{criteria:pe(e,(function(e){return e(t)})),index:++n,value:t}})),(function(t,e){return function(t,e,i){var n=-1,r=t.criteria,s=e.criteria,a=r.length,o=i.length;for(;++n<a;){var l=mr(r[n],s[n]);if(l){if(n>=o)return l;var h=i[n];return l*("desc"==h?-1:1)}}return t.index-e.index}(t,e,i)}))}function Rn(t,e,i){for(var n=-1,r=e.length,s={};++n<r;){var a=e[n],o=dn(t,a);i(o,a)&&Un(s,lr(a,t),o)}return s}function Ln(t,e,i,n){var r=n?Ae:we,s=-1,a=e.length,o=t;for(t===e&&(e=_r(e)),i&&(o=pe(t,ke(i)));++s<a;)for(var l=0,h=e[s],c=i?i(h):h;(l=r(o,c,l,n))>-1;)o!==t&&Kt.call(o,l,1),Kt.call(t,l,1);return t}function Nn(t,e){for(var i=t?e.length:0,n=i-1;i--;){var r=e[i];if(i==n||r!==s){var s=r;os(r)?Kt.call(t,r,1):tr(t,r)}}return t}function zn(t,e){return t+ti(ci()*(e-t+1))}function Bn(t,e){var i="";if(!t||e<1||e>9007199254740991)return i;do{e%2&&(i+=t),(e=ti(e/2))&&(t+=t)}while(e);return i}function Fn(t,e){return xs(ms(t,e,Zo),t+"")}function jn(t){return Fi(Eo(t))}function Vn(t,e){var i=Eo(t);return Cs(i,qi(e,0,i.length))}function Un(t,e,i,n){if(!Ga(t))return t;for(var r=-1,s=(e=lr(e,t)).length,a=s-1,o=t;null!=o&&++r<s;){var l=Ss(e[r]),h=i;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(r!=a){var c=o[l];void 0===(h=n?n(c,l,o):void 0)&&(h=Ga(c)?c:os(e[r+1])?[]:{})}Gi(o,l,h),o=o[l]}return t}var Gn=_i?function(t,e){return _i.set(t,e),t}:Zo,Wn=Me?function(t,e){return Me(t,"toString",{configurable:!0,enumerable:!1,value:Wo(e),writable:!0})}:Zo;function Hn(t){return Cs(Eo(t))}function Xn(t,e,i){var r=-1,s=t.length;e<0&&(e=-e>s?0:s+e),(i=i>s?s:i)<0&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0;for(var a=n(s);++r<s;)a[r]=t[r+e];return a}function Zn(t,e){var i;return tn(t,(function(t,n,r){return!(i=e(t,n,r))})),!!i}function Yn(t,e,i){var n=0,r=null==t?n:t.length;if("number"==typeof e&&e==e&&r<=2147483647){for(;n<r;){var s=n+r>>>1,a=t[s];null!==a&&!Ja(a)&&(i?a<=e:a<e)?n=s+1:r=s}return r}return qn(t,e,Zo,i)}function qn(t,e,i,n){var r=0,s=null==t?0:t.length;if(0===s)return 0;for(var a=(e=i(e))!=e,o=null===e,l=Ja(e),h=void 0===e;r<s;){var c=ti((r+s)/2),u=i(t[c]),d=void 0!==u,f=null===u,p=u==u,m=Ja(u);if(a)var g=n||p;else g=h?p&&(n||d):o?p&&d&&(n||!f):l?p&&d&&!f&&(n||!m):!f&&!m&&(n?u<=e:u<e);g?r=c+1:s=c}return oi(s,4294967294)}function Kn(t,e){for(var i=-1,n=t.length,r=0,s=[];++i<n;){var a=t[i],o=e?e(a):a;if(!i||!Pa(o,l)){var l=o;s[r++]=0===a?0:a}}return s}function Jn(t){return"number"==typeof t?t:Ja(t)?NaN:+t}function Qn(t){if("string"==typeof t)return t;if(Oa(t))return pe(t,Qn)+"";if(Ja(t))return Mi?Mi.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function $n(t,e,i){var n=-1,r=de,s=t.length,a=!0,o=[],l=o;if(i)a=!1,r=fe;else if(s>=200){var h=e?null:Br(t);if(h)return We(h);a=!1,r=Oe,l=new Ni}else l=e?[]:o;t:for(;++n<s;){var c=t[n],u=e?e(c):c;if(c=i||0!==c?c:0,a&&u==u){for(var d=l.length;d--;)if(l[d]===u)continue t;e&&l.push(u),o.push(c)}else r(l,u,i)||(l!==o&&l.push(u),o.push(c))}return o}function tr(t,e){return null==(t=gs(t,e=lr(e,t)))||delete t[Ss(Fs(e))]}function er(t,e,i,n){return Un(t,e,i(dn(t,e)),n)}function ir(t,e,i,n){for(var r=t.length,s=n?r:-1;(n?s--:++s<r)&&e(t[s],s,t););return i?Xn(t,n?0:s,n?s+1:r):Xn(t,n?s+1:0,n?r:s)}function nr(t,e){var i=t;return i instanceof Di&&(i=i.value()),ge(e,(function(t,e){return e.func.apply(e.thisArg,me([t],e.args))}),i)}function rr(t,e,i){var r=t.length;if(r<2)return r?$n(t[0]):[];for(var s=-1,a=n(r);++s<r;)for(var o=t[s],l=-1;++l<r;)l!=s&&(a[s]=$i(a[s]||o,t[l],e,i));return $n(an(a,1),e,i)}function sr(t,e,i){for(var n=-1,r=t.length,s=e.length,a={};++n<r;){var o=n<s?e[n]:void 0;i(a,t[n],o)}return a}function ar(t){return Na(t)?t:[]}function or(t){return"function"==typeof t?t:Zo}function lr(t,e){return Oa(t)?t:hs(t,e)?[t]:Is(oo(t))}var hr=Fn;function cr(t,e,i){var n=t.length;return i=void 0===i?n:i,!e&&i>=n?t:Xn(t,e,i)}var ur=Ke||function(t){return Yt.clearTimeout(t)};function dr(t,e){if(e)return t.slice();var i=t.length,n=Gt?Gt(i):new t.constructor(i);return t.copy(n),n}function fr(t){var e=new t.constructor(t.byteLength);return new zt(e).set(new zt(t)),e}function pr(t,e){var i=e?fr(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function mr(t,e){if(t!==e){var i=void 0!==t,n=null===t,r=t==t,s=Ja(t),a=void 0!==e,o=null===e,l=e==e,h=Ja(e);if(!o&&!h&&!s&&t>e||s&&a&&l&&!o&&!h||n&&a&&l||!i&&l||!r)return 1;if(!n&&!s&&!h&&t<e||h&&i&&r&&!n&&!s||o&&i&&r||!a&&r||!l)return-1}return 0}function gr(t,e,i,r){for(var s=-1,a=t.length,o=i.length,l=-1,h=e.length,c=ai(a-o,0),u=n(h+c),d=!r;++l<h;)u[l]=e[l];for(;++s<o;)(d||s<a)&&(u[i[s]]=t[s]);for(;c--;)u[l++]=t[s++];return u}function vr(t,e,i,r){for(var s=-1,a=t.length,o=-1,l=i.length,h=-1,c=e.length,u=ai(a-l,0),d=n(u+c),f=!r;++s<u;)d[s]=t[s];for(var p=s;++h<c;)d[p+h]=e[h];for(;++o<l;)(f||s<a)&&(d[p+i[o]]=t[s++]);return d}function _r(t,e){var i=-1,r=t.length;for(e||(e=n(r));++i<r;)e[i]=t[i];return e}function yr(t,e,i,n){var r=!i;i||(i={});for(var s=-1,a=e.length;++s<a;){var o=e[s],l=n?n(i[o],t[o],o,i,t):void 0;void 0===l&&(l=t[o]),r?Zi(i,o,l):Gi(i,o,l)}return i}function br(t,e){return function(i,n){var r=Oa(i)?oe:Hi,s=e?e():{};return r(i,t,Jr(n,2),s)}}function xr(t){return Fn((function(e,i){var n=-1,r=i.length,s=r>1?i[r-1]:void 0,a=r>2?i[2]:void 0;for(s=t.length>3&&"function"==typeof s?(r--,s):void 0,a&&ls(i[0],i[1],a)&&(s=r<3?void 0:s,r=1),e=gt(e);++n<r;){var o=i[n];o&&t(e,o,n,s)}return e}))}function wr(t,e){return function(i,n){if(null==i)return i;if(!La(i))return t(i,n);for(var r=i.length,s=e?r:-1,a=gt(i);(e?s--:++s<r)&&!1!==n(a[s],s,a););return i}}function Ar(t){return function(e,i,n){for(var r=-1,s=gt(e),a=n(e),o=a.length;o--;){var l=a[t?o:++r];if(!1===i(s[l],l,s))break}return e}}function Cr(t){return function(e){var i=je(e=oo(e))?Ze(e):void 0,n=i?i[0]:e.charAt(0),r=i?cr(i,1).join(""):e.slice(1);return n[t]()+r}}function Ir(t){return function(e){return ge(Vo(Oo(e).replace(Ot,"")),t,"")}}function Sr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=Pi(t.prototype),n=t.apply(i,e);return Ga(n)?n:i}}function Mr(t){return function(e,i,n){var r=gt(e);if(!La(e)){var s=Jr(i,3);e=xo(e),i=function(t){return s(r[t],t,r)}}var a=t(e,i,n);return a>-1?r[s?e[a]:a]:void 0}}function Tr(t){return Hr((function(e){var i=e.length,n=i,r=ki.prototype.thru;for(t&&e.reverse();n--;){var s=e[n];if("function"!=typeof s)throw new yt(a);if(r&&!o&&"wrapper"==qr(s))var o=new ki([],!0)}for(n=o?n:i;++n<i;){var l=qr(s=e[n]),h="wrapper"==l?Yr(s):void 0;o=h&&cs(h[0])&&424==h[1]&&!h[4].length&&1==h[9]?o[qr(h[0])].apply(o,h[3]):1==s.length&&cs(s)?o[l]():o.thru(s)}return function(){var t=arguments,n=t[0];if(o&&1==t.length&&Oa(n))return o.plant(n).value();for(var r=0,s=i?e[r].apply(this,t):n;++r<i;)s=e[r].call(this,s);return s}}))}function Pr(t,e,i,r,s,a,o,l,h,c){var u=128&e,d=1&e,f=2&e,p=24&e,m=512&e,g=f?void 0:Sr(t);return function v(){for(var _=arguments.length,y=n(_),b=_;b--;)y[b]=arguments[b];if(p)var x=Kr(v),w=Ne(y,x);if(r&&(y=gr(y,r,s,p)),a&&(y=vr(y,a,o,p)),_-=w,p&&_<c){var A=Ge(y,x);return Nr(t,e,Pr,v.placeholder,i,y,A,l,h,c-_)}var C=d?i:this,I=f?C[t]:t;return _=y.length,l?y=vs(y,l):m&&_>1&&y.reverse(),u&&h<_&&(y.length=h),this&&this!==Yt&&this instanceof v&&(I=g||Sr(I)),I.apply(C,y)}}function Er(t,e){return function(i,n){return function(t,e,i,n){return hn(t,(function(t,r,s){e(n,i(t),r,s)})),n}(i,t,e(n),{})}}function kr(t,e){return function(i,n){var r;if(void 0===i&&void 0===n)return e;if(void 0!==i&&(r=i),void 0!==n){if(void 0===r)return n;"string"==typeof i||"string"==typeof n?(i=Qn(i),n=Qn(n)):(i=Jn(i),n=Jn(n)),r=t(i,n)}return r}}function Dr(t){return Hr((function(e){return e=pe(e,ke(Jr())),Fn((function(i){var n=this;return t(e,(function(t){return ae(t,n,i)}))}))}))}function Or(t,e){var i=(e=void 0===e?" ":Qn(e)).length;if(i<2)return i?Bn(e,t):e;var n=Bn(e,$e(t/Xe(e)));return je(e)?cr(Ze(n),0,t).join(""):n.slice(0,t)}function Rr(t){return function(e,i,r){return r&&"number"!=typeof r&&ls(e,i,r)&&(i=r=void 0),e=io(e),void 0===i?(i=e,e=0):i=io(i),function(t,e,i,r){for(var s=-1,a=ai($e((e-t)/(i||1)),0),o=n(a);a--;)o[r?a:++s]=t,t+=i;return o}(e,i,r=void 0===r?e<i?1:-1:io(r),t)}}function Lr(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=so(e),i=so(i)),t(e,i)}}function Nr(t,e,i,n,r,s,a,o,l,h){var c=8&e;e|=c?32:64,4&(e&=~(c?64:32))||(e&=-4);var u=[t,e,r,c?s:void 0,c?a:void 0,c?void 0:s,c?void 0:a,o,l,h],d=i.apply(void 0,u);return cs(t)&&ys(d,u),d.placeholder=n,ws(d,t,e)}function zr(t){var e=mt[t];return function(t,i){if(t=so(t),(i=null==i?0:oi(no(i),292))&&ni(t)){var n=(oo(t)+"e").split("e");return+((n=(oo(e(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return e(t)}}var Br=mi&&1/We(new mi([,-0]))[1]==1/0?function(t){return new mi(t)}:Qo;function Fr(t){return function(e){var i=ns(e);return i==g?Ve(e):i==b?He(e):function(t,e){return pe(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function jr(t,e,i,r,s,l,h,c){var u=2&e;if(!u&&"function"!=typeof t)throw new yt(a);var d=r?r.length:0;if(d||(e&=-97,r=s=void 0),h=void 0===h?h:ai(no(h),0),c=void 0===c?c:no(c),d-=s?s.length:0,64&e){var f=r,p=s;r=s=void 0}var m=u?void 0:Yr(t),g=[t,e,i,r,s,f,p,l,h,c];if(m&&function(t,e){var i=t[1],n=e[1],r=i|n,s=r<131,a=128==n&&8==i||128==n&&256==i&&t[7].length<=e[8]||384==n&&e[7].length<=e[8]&&8==i;if(!s&&!a)return t;1&n&&(t[2]=e[2],r|=1&i?0:4);var l=e[3];if(l){var h=t[3];t[3]=h?gr(h,l,e[4]):l,t[4]=h?Ge(t[3],o):e[4]}(l=e[5])&&(h=t[5],t[5]=h?vr(h,l,e[6]):l,t[6]=h?Ge(t[5],o):e[6]);(l=e[7])&&(t[7]=l);128&n&&(t[8]=null==t[8]?e[8]:oi(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=r}(g,m),t=g[0],e=g[1],i=g[2],r=g[3],s=g[4],!(c=g[9]=void 0===g[9]?u?0:t.length:ai(g[9]-d,0))&&24&e&&(e&=-25),e&&1!=e)v=8==e||16==e?function(t,e,i){var r=Sr(t);return function s(){for(var a=arguments.length,o=n(a),l=a,h=Kr(s);l--;)o[l]=arguments[l];var c=a<3&&o[0]!==h&&o[a-1]!==h?[]:Ge(o,h);if((a-=c.length)<i)return Nr(t,e,Pr,s.placeholder,void 0,o,c,void 0,void 0,i-a);var u=this&&this!==Yt&&this instanceof s?r:t;return ae(u,this,o)}}(t,e,c):32!=e&&33!=e||s.length?Pr.apply(void 0,g):function(t,e,i,r){var s=1&e,a=Sr(t);return function e(){for(var o=-1,l=arguments.length,h=-1,c=r.length,u=n(c+l),d=this&&this!==Yt&&this instanceof e?a:t;++h<c;)u[h]=r[h];for(;l--;)u[h++]=arguments[++o];return ae(d,s?i:this,u)}}(t,e,i,r);else var v=function(t,e,i){var n=1&e,r=Sr(t);return function e(){var s=this&&this!==Yt&&this instanceof e?r:t;return s.apply(n?i:this,arguments)}}(t,e,i);return ws((m?Gn:ys)(v,g),t,e)}function Vr(t,e,i,n){return void 0===t||Pa(t,wt[i])&&!It.call(n,i)?e:t}function Ur(t,e,i,n,r,s){return Ga(t)&&Ga(e)&&(s.set(e,t),kn(t,e,void 0,Ur,s),s.delete(e)),t}function Gr(t){return Za(t)?void 0:t}function Wr(t,e,i,n,r,s){var a=1&i,o=t.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var h=s.get(t),c=s.get(e);if(h&&c)return h==e&&c==t;var u=-1,d=!0,f=2&i?new Ni:void 0;for(s.set(t,e),s.set(e,t);++u<o;){var p=t[u],m=e[u];if(n)var g=a?n(m,p,u,e,t,s):n(p,m,u,t,e,s);if(void 0!==g){if(g)continue;d=!1;break}if(f){if(!_e(e,(function(t,e){if(!Oe(f,e)&&(p===t||r(p,t,i,n,s)))return f.push(e)}))){d=!1;break}}else if(p!==m&&!r(p,m,i,n,s)){d=!1;break}}return s.delete(t),s.delete(e),d}function Hr(t){return xs(ms(t,void 0,Rs),t+"")}function Xr(t){return fn(t,xo,es)}function Zr(t){return fn(t,wo,is)}var Yr=_i?function(t){return _i.get(t)}:Qo;function qr(t){for(var e=t.name+"",i=yi[e],n=It.call(yi,e)?i.length:0;n--;){var r=i[n],s=r.func;if(null==s||s==t)return r.name}return e}function Kr(t){return(It.call(Ti,"placeholder")?Ti:t).placeholder}function Jr(){var t=Ti.iteratee||Yo;return t=t===Yo?Cn:t,arguments.length?t(arguments[0],arguments[1]):t}function Qr(t,e){var i,n,r=t.__data__;return("string"==(n=s(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof e?"string":"hash"]:r.map}function $r(t){for(var e=xo(t),i=e.length;i--;){var n=e[i],r=t[n];e[i]=[n,r,fs(r)]}return e}function ts(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return An(i)?i:void 0}var es=ei?function(t){return null==t?[]:(t=gt(t),ue(ei(t),(function(e){return qt.call(t,e)})))}:sl,is=ei?function(t){for(var e=[];t;)me(e,es(t)),t=Xt(t);return e}:sl,ns=pn;function rs(t,e,i){for(var n=-1,r=(e=lr(e,t)).length,s=!1;++n<r;){var a=Ss(e[n]);if(!(s=null!=t&&i(t,a)))break;t=t[a]}return s||++n!=r?s:!!(r=null==t?0:t.length)&&Ua(r)&&os(a,r)&&(Oa(t)||Da(t))}function ss(t){return"function"!=typeof t.constructor||ds(t)?{}:Pi(Xt(t))}function as(t){return Oa(t)||Da(t)||!!(Qt&&t&&t[Qt])}function os(t,e){var i=s(t);return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&ht.test(t))&&t>-1&&t%1==0&&t<e}function ls(t,e,i){if(!Ga(i))return!1;var n=s(e);return!!("number"==n?La(i)&&os(e,i.length):"string"==n&&e in i)&&Pa(i[e],t)}function hs(t,e){if(Oa(t))return!1;var i=s(t);return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Ja(t))||(H.test(t)||!W.test(t)||null!=e&&t in gt(e))}function cs(t){var e=qr(t),i=Ti[e];if("function"!=typeof i||!(e in Di.prototype))return!1;if(t===i)return!0;var n=Yr(i);return!!n&&t===n[0]}(di&&ns(new di(new ArrayBuffer(1)))!=I||fi&&ns(new fi)!=g||pi&&"[object Promise]"!=ns(pi.resolve())||mi&&ns(new mi)!=b||gi&&ns(new gi)!=A)&&(ns=function(t){var e=pn(t),i=e==_?t.constructor:void 0,n=i?Ms(i):"";if(n)switch(n){case bi:return I;case xi:return g;case wi:return"[object Promise]";case Ai:return b;case Ci:return A}return e});var us=At?ja:al;function ds(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||wt)}function fs(t){return t==t&&!Ga(t)}function ps(t,e){return function(i){return null!=i&&(i[t]===e&&(void 0!==e||t in gt(i)))}}function ms(t,e,i){return e=ai(void 0===e?t.length-1:e,0),function(){for(var r=arguments,s=-1,a=ai(r.length-e,0),o=n(a);++s<a;)o[s]=r[e+s];s=-1;for(var l=n(e+1);++s<e;)l[s]=r[s];return l[e]=i(o),ae(t,this,l)}}function gs(t,e){return e.length<2?t:dn(t,Xn(e,0,-1))}function vs(t,e){for(var i=t.length,n=oi(e.length,i),r=_r(t);n--;){var s=e[n];t[n]=os(s,i)?r[s]:void 0}return t}function _s(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var ys=As(Gn),bs=Qe||function(t,e){return Yt.setTimeout(t,e)},xs=As(Wn);function ws(t,e,i){var n=e+"";return xs(t,function(t,e){var i=e.length;if(!i)return t;var n=i-1;return e[n]=(i>1?"& ":"")+e[n],e=e.join(i>2?", ":" "),t.replace(Q,"{\n/* [wrapped with "+e+"] */\n")}(n,function(t,e){return le(l,(function(i){var n="_."+i[0];e&i[1]&&!de(t,n)&&t.push(n)})),t.sort()}(function(t){var e=t.match($);return e?e[1].split(tt):[]}(n),i)))}function As(t){var e=0,i=0;return function(){var n=li(),r=16-(n-i);if(i=n,r>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Cs(t,e){var i=-1,n=t.length,r=n-1;for(e=void 0===e?n:e;++i<e;){var s=zn(i,r),a=t[s];t[s]=t[i],t[i]=a}return t.length=e,t}var Is=function(t){var e=Aa(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(X,(function(t,i,n,r){e.push(n?r.replace(it,"$1"):i||t)})),e}));function Ss(t){if("string"==typeof t||Ja(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Ms(t){if(null!=t){try{return Ct.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ts(t){if(t instanceof Di)return t.clone();var e=new ki(t.__wrapped__,t.__chain__);return e.__actions__=_r(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Ps=Fn((function(t,e){return Na(t)?$i(t,an(e,1,Na,!0)):[]})),Es=Fn((function(t,e){var i=Fs(e);return Na(i)&&(i=void 0),Na(t)?$i(t,an(e,1,Na,!0),Jr(i,2)):[]})),ks=Fn((function(t,e){var i=Fs(e);return Na(i)&&(i=void 0),Na(t)?$i(t,an(e,1,Na,!0),void 0,i):[]}));function Ds(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:no(i);return r<0&&(r=ai(n+r,0)),xe(t,Jr(e,3),r)}function Os(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=n-1;return void 0!==i&&(r=no(i),r=i<0?ai(n+r,0):oi(r,n-1)),xe(t,Jr(e,3),r,!0)}function Rs(t){return(null==t?0:t.length)?an(t,1):[]}function Ls(t){return t&&t.length?t[0]:void 0}var Ns=Fn((function(t){var e=pe(t,ar);return e.length&&e[0]===t[0]?_n(e):[]})),zs=Fn((function(t){var e=Fs(t),i=pe(t,ar);return e===Fs(i)?e=void 0:i.pop(),i.length&&i[0]===t[0]?_n(i,Jr(e,2)):[]})),Bs=Fn((function(t){var e=Fs(t),i=pe(t,ar);return(e="function"==typeof e?e:void 0)&&i.pop(),i.length&&i[0]===t[0]?_n(i,void 0,e):[]}));function Fs(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}var js=Fn(Vs);function Vs(t,e){return t&&t.length&&e&&e.length?Ln(t,e):t}var Us=Hr((function(t,e){var i=null==t?0:t.length,n=Yi(t,e);return Nn(t,pe(e,(function(t){return os(t,i)?+t:t})).sort(mr)),n}));function Gs(t){return null==t?t:ui.call(t)}var Ws=Fn((function(t){return $n(an(t,1,Na,!0))})),Hs=Fn((function(t){var e=Fs(t);return Na(e)&&(e=void 0),$n(an(t,1,Na,!0),Jr(e,2))})),Xs=Fn((function(t){var e=Fs(t);return e="function"==typeof e?e:void 0,$n(an(t,1,Na,!0),void 0,e)}));function Zs(t){if(!t||!t.length)return[];var e=0;return t=ue(t,(function(t){if(Na(t))return e=ai(t.length,e),!0})),Ee(e,(function(e){return pe(t,Se(e))}))}function Ys(t,e){if(!t||!t.length)return[];var i=Zs(t);return null==e?i:pe(i,(function(t){return ae(e,void 0,t)}))}var qs=Fn((function(t,e){return Na(t)?$i(t,e):[]})),Ks=Fn((function(t){return rr(ue(t,Na))})),Js=Fn((function(t){var e=Fs(t);return Na(e)&&(e=void 0),rr(ue(t,Na),Jr(e,2))})),Qs=Fn((function(t){var e=Fs(t);return e="function"==typeof e?e:void 0,rr(ue(t,Na),void 0,e)})),$s=Fn(Zs);var ta=Fn((function(t){var e=t.length,i=e>1?t[e-1]:void 0;return i="function"==typeof i?(t.pop(),i):void 0,Ys(t,i)}));function ea(t){var e=Ti(t);return e.__chain__=!0,e}function ia(t,e){return e(t)}var na=Hr((function(t){var e=t.length,i=e?t[0]:0,n=this.__wrapped__,r=function(e){return Yi(e,t)};return!(e>1||this.__actions__.length)&&n instanceof Di&&os(i)?((n=n.slice(i,+i+(e?1:0))).__actions__.push({func:ia,args:[r],thisArg:void 0}),new ki(n,this.__chain__).thru((function(t){return e&&!t.length&&t.push(void 0),t}))):this.thru(r)}));var ra=br((function(t,e,i){It.call(t,i)?++t[i]:Zi(t,i,1)}));var sa=Mr(Ds),aa=Mr(Os);function oa(t,e){return(Oa(t)?le:tn)(t,Jr(e,3))}function la(t,e){return(Oa(t)?he:en)(t,Jr(e,3))}var ha=br((function(t,e,i){It.call(t,i)?t[i].push(e):Zi(t,i,[e])}));var ca=Fn((function(t,e,i){var r=-1,s="function"==typeof e,a=La(t)?n(t.length):[];return tn(t,(function(t){a[++r]=s?ae(e,t,i):yn(t,e,i)})),a})),ua=br((function(t,e,i){Zi(t,i,e)}));function da(t,e){return(Oa(t)?pe:Tn)(t,Jr(e,3))}var fa=br((function(t,e,i){t[i?0:1].push(e)}),(function(){return[[],[]]}));var pa=Fn((function(t,e){if(null==t)return[];var i=e.length;return i>1&&ls(t,e[0],e[1])?e=[]:i>2&&ls(e[0],e[1],e[2])&&(e=[e[0]]),On(t,an(e,1),[])})),ma=Je||function(){return Yt.Date.now()};function ga(t,e,i){return e=i?void 0:e,jr(t,128,void 0,void 0,void 0,void 0,e=t&&null==e?t.length:e)}function va(t,e){var i;if("function"!=typeof e)throw new yt(a);return t=no(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=void 0),i}}var _a=Fn((function(t,e,i){var n=1;if(i.length){var r=Ge(i,Kr(_a));n|=32}return jr(t,n,e,i,r)})),ya=Fn((function(t,e,i){var n=3;if(i.length){var r=Ge(i,Kr(ya));n|=32}return jr(e,n,t,i,r)}));function ba(t,e,i){var n,r,s,o,l,h,c=0,u=!1,d=!1,f=!0;if("function"!=typeof t)throw new yt(a);function p(e){var i=n,s=r;return n=r=void 0,c=e,o=t.apply(s,i)}function m(t){return c=t,l=bs(v,e),u?p(t):o}function g(t){var i=t-h;return void 0===h||i>=e||i<0||d&&t-c>=s}function v(){var t=ma();if(g(t))return _(t);l=bs(v,function(t){var i=e-(t-h);return d?oi(i,s-(t-c)):i}(t))}function _(t){return l=void 0,f&&n?p(t):(n=r=void 0,o)}function y(){var t=ma(),i=g(t);if(n=arguments,r=this,h=t,i){if(void 0===l)return m(h);if(d)return ur(l),l=bs(v,e),p(h)}return void 0===l&&(l=bs(v,e)),o}return e=so(e)||0,Ga(i)&&(u=!!i.leading,s=(d="maxWait"in i)?ai(so(i.maxWait)||0,e):s,f="trailing"in i?!!i.trailing:f),y.cancel=function(){void 0!==l&&ur(l),c=0,n=h=r=l=void 0},y.flush=function(){return void 0===l?o:_(ma())},y}var xa=Fn((function(t,e){return Qi(t,1,e)})),wa=Fn((function(t,e,i){return Qi(t,so(e)||0,i)}));function Aa(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new yt(a);var i=function i(){var n=arguments,r=e?e.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var a=t.apply(this,n);return i.cache=s.set(r,a)||s,a};return i.cache=new(Aa.Cache||Li),i}function Ca(t){if("function"!=typeof t)throw new yt(a);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Aa.Cache=Li;var Ia=hr((function(t,e){var i=(e=1==e.length&&Oa(e[0])?pe(e[0],ke(Jr())):pe(an(e,1),ke(Jr()))).length;return Fn((function(n){for(var r=-1,s=oi(n.length,i);++r<s;)n[r]=e[r].call(this,n[r]);return ae(t,this,n)}))})),Sa=Fn((function(t,e){return jr(t,32,void 0,e,Ge(e,Kr(Sa)))})),Ma=Fn((function(t,e){return jr(t,64,void 0,e,Ge(e,Kr(Ma)))})),Ta=Hr((function(t,e){return jr(t,256,void 0,void 0,void 0,e)}));function Pa(t,e){return t===e||t!=t&&e!=e}var Ea=Lr(mn),ka=Lr((function(t,e){return t>=e})),Da=bn(function(){return arguments}())?bn:function(t){return Wa(t)&&It.call(t,"callee")&&!qt.call(t,"callee")},Oa=n.isArray,Ra=te?ke(te):function(t){return Wa(t)&&pn(t)==C};function La(t){return null!=t&&Ua(t.length)&&!ja(t)}function Na(t){return Wa(t)&&La(t)}var za=ii||al,Ba=ee?ke(ee):function(t){return Wa(t)&&pn(t)==d};function Fa(t){if(!Wa(t))return!1;var e=pn(t);return e==f||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!Za(t)}function ja(t){if(!Ga(t))return!1;var e=pn(t);return e==p||e==m||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Va(t){return"number"==typeof t&&t==no(t)}function Ua(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function Ga(t){var e=s(t);return null!=t&&("object"==e||"function"==e)}function Wa(t){return null!=t&&"object"==s(t)}var Ha=ie?ke(ie):function(t){return Wa(t)&&ns(t)==g};function Xa(t){return"number"==typeof t||Wa(t)&&pn(t)==v}function Za(t){if(!Wa(t)||pn(t)!=_)return!1;var e=Xt(t);if(null===e)return!0;var i=It.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&Ct.call(i)==Pt}var Ya=ne?ke(ne):function(t){return Wa(t)&&pn(t)==y};var qa=re?ke(re):function(t){return Wa(t)&&ns(t)==b};function Ka(t){return"string"==typeof t||!Oa(t)&&Wa(t)&&pn(t)==x}function Ja(t){return"symbol"==s(t)||Wa(t)&&pn(t)==w}var Qa=se?ke(se):function(t){return Wa(t)&&Ua(t.length)&&!!Vt[pn(t)]};var $a=Lr(Mn),to=Lr((function(t,e){return t<=e}));function eo(t){if(!t)return[];if(La(t))return Ka(t)?Ze(t):_r(t);if($t&&t[$t])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[$t]());var e=ns(t);return(e==g?Ve:e==b?We:Eo)(t)}function io(t){return t?(t=so(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function no(t){var e=io(t),i=e%1;return e==e?i?e-i:e:0}function ro(t){return t?qi(no(t),0,4294967295):0}function so(t){if("number"==typeof t)return t;if(Ja(t))return NaN;if(Ga(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ga(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(q,"");var i=at.test(t);return i||lt.test(t)?Ht(t.slice(2),i?2:8):st.test(t)?NaN:+t}function ao(t){return yr(t,wo(t))}function oo(t){return null==t?"":Qn(t)}var lo=xr((function(t,e){if(ds(e)||La(e))yr(e,xo(e),t);else for(var i in e)It.call(e,i)&&Gi(t,i,e[i])})),ho=xr((function(t,e){yr(e,wo(e),t)})),co=xr((function(t,e,i,n){yr(e,wo(e),t,n)})),uo=xr((function(t,e,i,n){yr(e,xo(e),t,n)})),fo=Hr(Yi);var po=Fn((function(t,e){t=gt(t);var i=-1,n=e.length,r=n>2?e[2]:void 0;for(r&&ls(e[0],e[1],r)&&(n=1);++i<n;)for(var s=e[i],a=wo(s),o=-1,l=a.length;++o<l;){var h=a[o],c=t[h];(void 0===c||Pa(c,wt[h])&&!It.call(t,h))&&(t[h]=s[h])}return t})),mo=Fn((function(t){return t.push(void 0,Ur),ae(Co,void 0,t)}));function go(t,e,i){var n=null==t?void 0:dn(t,e);return void 0===n?i:n}function vo(t,e){return null!=t&&rs(t,e,vn)}var _o=Er((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Tt.call(e)),t[e]=i}),Wo(Zo)),yo=Er((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Tt.call(e)),It.call(t,e)?t[e].push(i):t[e]=[i]}),Jr),bo=Fn(yn);function xo(t){return La(t)?Bi(t):In(t)}function wo(t){return La(t)?Bi(t,!0):Sn(t)}var Ao=xr((function(t,e,i){kn(t,e,i)})),Co=xr((function(t,e,i,n){kn(t,e,i,n)})),Io=Hr((function(t,e){var i={};if(null==t)return i;var n=!1;e=pe(e,(function(e){return e=lr(e,t),n||(n=e.length>1),e})),yr(t,Zr(t),i),n&&(i=Ki(i,7,Gr));for(var r=e.length;r--;)tr(i,e[r]);return i}));var So=Hr((function(t,e){return null==t?{}:function(t,e){return Rn(t,e,(function(e,i){return vo(t,i)}))}(t,e)}));function Mo(t,e){if(null==t)return{};var i=pe(Zr(t),(function(t){return[t]}));return e=Jr(e),Rn(t,i,(function(t,i){return e(t,i[0])}))}var To=Fr(xo),Po=Fr(wo);function Eo(t){return null==t?[]:De(t,xo(t))}var ko=Ir((function(t,e,i){return e=e.toLowerCase(),t+(i?Do(e):e)}));function Do(t){return jo(oo(t).toLowerCase())}function Oo(t){return(t=oo(t))&&t.replace(ct,ze).replace(Rt,"")}var Ro=Ir((function(t,e,i){return t+(i?"-":"")+e.toLowerCase()})),Lo=Ir((function(t,e,i){return t+(i?" ":"")+e.toLowerCase()})),No=Cr("toLowerCase");var zo=Ir((function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}));var Bo=Ir((function(t,e,i){return t+(i?" ":"")+jo(e)}));var Fo=Ir((function(t,e,i){return t+(i?" ":"")+e.toUpperCase()})),jo=Cr("toUpperCase");function Vo(t,e,i){return t=oo(t),void 0===(e=i?void 0:e)?function(t){return Bt.test(t)}(t)?function(t){return t.match(Nt)||[]}(t):function(t){return t.match(et)||[]}(t):t.match(e)||[]}var Uo=Fn((function(t,e){try{return ae(t,void 0,e)}catch(t){return Fa(t)?t:new ft(t)}})),Go=Hr((function(t,e){return le(e,(function(e){e=Ss(e),Zi(t,e,_a(t[e],t))})),t}));function Wo(t){return function(){return t}}var Ho=Tr(),Xo=Tr(!0);function Zo(t){return t}function Yo(t){return Cn("function"==typeof t?t:Ki(t,1))}var qo=Fn((function(t,e){return function(i){return yn(i,t,e)}})),Ko=Fn((function(t,e){return function(i){return yn(t,i,e)}}));function Jo(t,e,i){var n=xo(e),r=un(e,n);null!=i||Ga(e)&&(r.length||!n.length)||(i=e,e=t,t=this,r=un(e,xo(e)));var s=!(Ga(i)&&"chain"in i&&!i.chain),a=ja(t);return le(r,(function(i){var n=e[i];t[i]=n,a&&(t.prototype[i]=function(){var e=this.__chain__;if(s||e){var i=t(this.__wrapped__),r=i.__actions__=_r(this.__actions__);return r.push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,me([this.value()],arguments))})})),t}function Qo(){}var $o=Dr(pe),tl=Dr(ce),el=Dr(_e);function il(t){return hs(t)?Se(Ss(t)):function(t){return function(e){return dn(e,t)}}(t)}var nl=Rr(),rl=Rr(!0);function sl(){return[]}function al(){return!1}var ol=kr((function(t,e){return t+e}),0),ll=zr("ceil"),hl=kr((function(t,e){return t/e}),1),cl=zr("floor");var ul,dl=kr((function(t,e){return t*e}),1),fl=zr("round"),pl=kr((function(t,e){return t-e}),0);return Ti.after=function(t,e){if("function"!=typeof e)throw new yt(a);return t=no(t),function(){if(--t<1)return e.apply(this,arguments)}},Ti.ary=ga,Ti.assign=lo,Ti.assignIn=ho,Ti.assignInWith=co,Ti.assignWith=uo,Ti.at=fo,Ti.before=va,Ti.bind=_a,Ti.bindAll=Go,Ti.bindKey=ya,Ti.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Oa(t)?t:[t]},Ti.chain=ea,Ti.chunk=function(t,e,i){e=(i?ls(t,e,i):void 0===e)?1:ai(no(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var s=0,a=0,o=n($e(r/e));s<r;)o[a++]=Xn(t,s,s+=e);return o},Ti.compact=function(t){for(var e=-1,i=null==t?0:t.length,n=0,r=[];++e<i;){var s=t[e];s&&(r[n++]=s)}return r},Ti.concat=function(){var t=arguments.length;if(!t)return[];for(var e=n(t-1),i=arguments[0],r=t;r--;)e[r-1]=arguments[r];return me(Oa(i)?_r(i):[i],an(e,1))},Ti.cond=function(t){var e=null==t?0:t.length,i=Jr();return t=e?pe(t,(function(t){if("function"!=typeof t[1])throw new yt(a);return[i(t[0]),t[1]]})):[],Fn((function(i){for(var n=-1;++n<e;){var r=t[n];if(ae(r[0],this,i))return ae(r[1],this,i)}}))},Ti.conforms=function(t){return function(t){var e=xo(t);return function(i){return Ji(i,t,e)}}(Ki(t,1))},Ti.constant=Wo,Ti.countBy=ra,Ti.create=function(t,e){var i=Pi(t);return null==e?i:Xi(i,e)},Ti.curry=function t(e,i,n){var r=jr(e,8,void 0,void 0,void 0,void 0,void 0,i=n?void 0:i);return r.placeholder=t.placeholder,r},Ti.curryRight=function t(e,i,n){var r=jr(e,16,void 0,void 0,void 0,void 0,void 0,i=n?void 0:i);return r.placeholder=t.placeholder,r},Ti.debounce=ba,Ti.defaults=po,Ti.defaultsDeep=mo,Ti.defer=xa,Ti.delay=wa,Ti.difference=Ps,Ti.differenceBy=Es,Ti.differenceWith=ks,Ti.drop=function(t,e,i){var n=null==t?0:t.length;return n?Xn(t,(e=i||void 0===e?1:no(e))<0?0:e,n):[]},Ti.dropRight=function(t,e,i){var n=null==t?0:t.length;return n?Xn(t,0,(e=n-(e=i||void 0===e?1:no(e)))<0?0:e):[]},Ti.dropRightWhile=function(t,e){return t&&t.length?ir(t,Jr(e,3),!0,!0):[]},Ti.dropWhile=function(t,e){return t&&t.length?ir(t,Jr(e,3),!0):[]},Ti.fill=function(t,e,i,n){var r=null==t?0:t.length;return r?(i&&"number"!=typeof i&&ls(t,e,i)&&(i=0,n=r),function(t,e,i,n){var r=t.length;for((i=no(i))<0&&(i=-i>r?0:r+i),(n=void 0===n||n>r?r:no(n))<0&&(n+=r),n=i>n?0:ro(n);i<n;)t[i++]=e;return t}(t,e,i,n)):[]},Ti.filter=function(t,e){return(Oa(t)?ue:sn)(t,Jr(e,3))},Ti.flatMap=function(t,e){return an(da(t,e),1)},Ti.flatMapDeep=function(t,e){return an(da(t,e),1/0)},Ti.flatMapDepth=function(t,e,i){return i=void 0===i?1:no(i),an(da(t,e),i)},Ti.flatten=Rs,Ti.flattenDeep=function(t){return(null==t?0:t.length)?an(t,1/0):[]},Ti.flattenDepth=function(t,e){return(null==t?0:t.length)?an(t,e=void 0===e?1:no(e)):[]},Ti.flip=function(t){return jr(t,512)},Ti.flow=Ho,Ti.flowRight=Xo,Ti.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,n={};++e<i;){var r=t[e];n[r[0]]=r[1]}return n},Ti.functions=function(t){return null==t?[]:un(t,xo(t))},Ti.functionsIn=function(t){return null==t?[]:un(t,wo(t))},Ti.groupBy=ha,Ti.initial=function(t){return(null==t?0:t.length)?Xn(t,0,-1):[]},Ti.intersection=Ns,Ti.intersectionBy=zs,Ti.intersectionWith=Bs,Ti.invert=_o,Ti.invertBy=yo,Ti.invokeMap=ca,Ti.iteratee=Yo,Ti.keyBy=ua,Ti.keys=xo,Ti.keysIn=wo,Ti.map=da,Ti.mapKeys=function(t,e){var i={};return e=Jr(e,3),hn(t,(function(t,n,r){Zi(i,e(t,n,r),t)})),i},Ti.mapValues=function(t,e){var i={};return e=Jr(e,3),hn(t,(function(t,n,r){Zi(i,n,e(t,n,r))})),i},Ti.matches=function(t){return Pn(Ki(t,1))},Ti.matchesProperty=function(t,e){return En(t,Ki(e,1))},Ti.memoize=Aa,Ti.merge=Ao,Ti.mergeWith=Co,Ti.method=qo,Ti.methodOf=Ko,Ti.mixin=Jo,Ti.negate=Ca,Ti.nthArg=function(t){return t=no(t),Fn((function(e){return Dn(e,t)}))},Ti.omit=Io,Ti.omitBy=function(t,e){return Mo(t,Ca(Jr(e)))},Ti.once=function(t){return va(2,t)},Ti.orderBy=function(t,e,i,n){return null==t?[]:(Oa(e)||(e=null==e?[]:[e]),Oa(i=n?void 0:i)||(i=null==i?[]:[i]),On(t,e,i))},Ti.over=$o,Ti.overArgs=Ia,Ti.overEvery=tl,Ti.overSome=el,Ti.partial=Sa,Ti.partialRight=Ma,Ti.partition=fa,Ti.pick=So,Ti.pickBy=Mo,Ti.property=il,Ti.propertyOf=function(t){return function(e){return null==t?void 0:dn(t,e)}},Ti.pull=js,Ti.pullAll=Vs,Ti.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?Ln(t,e,Jr(i,2)):t},Ti.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?Ln(t,e,void 0,i):t},Ti.pullAt=Us,Ti.range=nl,Ti.rangeRight=rl,Ti.rearg=Ta,Ti.reject=function(t,e){return(Oa(t)?ue:sn)(t,Ca(Jr(e,3)))},Ti.remove=function(t,e){var i=[];if(!t||!t.length)return i;var n=-1,r=[],s=t.length;for(e=Jr(e,3);++n<s;){var a=t[n];e(a,n,t)&&(i.push(a),r.push(n))}return Nn(t,r),i},Ti.rest=function(t,e){if("function"!=typeof t)throw new yt(a);return Fn(t,e=void 0===e?e:no(e))},Ti.reverse=Gs,Ti.sampleSize=function(t,e,i){return e=(i?ls(t,e,i):void 0===e)?1:no(e),(Oa(t)?ji:Vn)(t,e)},Ti.set=function(t,e,i){return null==t?t:Un(t,e,i)},Ti.setWith=function(t,e,i,n){return n="function"==typeof n?n:void 0,null==t?t:Un(t,e,i,n)},Ti.shuffle=function(t){return(Oa(t)?Vi:Hn)(t)},Ti.slice=function(t,e,i){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&ls(t,e,i)?(e=0,i=n):(e=null==e?0:no(e),i=void 0===i?n:no(i)),Xn(t,e,i)):[]},Ti.sortBy=pa,Ti.sortedUniq=function(t){return t&&t.length?Kn(t):[]},Ti.sortedUniqBy=function(t,e){return t&&t.length?Kn(t,Jr(e,2)):[]},Ti.split=function(t,e,i){return i&&"number"!=typeof i&&ls(t,e,i)&&(e=i=void 0),(i=void 0===i?4294967295:i>>>0)?(t=oo(t))&&("string"==typeof e||null!=e&&!Ya(e))&&!(e=Qn(e))&&je(t)?cr(Ze(t),0,i):t.split(e,i):[]},Ti.spread=function(t,e){if("function"!=typeof t)throw new yt(a);return e=null==e?0:ai(no(e),0),Fn((function(i){var n=i[e],r=cr(i,0,e);return n&&me(r,n),ae(t,this,r)}))},Ti.tail=function(t){var e=null==t?0:t.length;return e?Xn(t,1,e):[]},Ti.take=function(t,e,i){return t&&t.length?Xn(t,0,(e=i||void 0===e?1:no(e))<0?0:e):[]},Ti.takeRight=function(t,e,i){var n=null==t?0:t.length;return n?Xn(t,(e=n-(e=i||void 0===e?1:no(e)))<0?0:e,n):[]},Ti.takeRightWhile=function(t,e){return t&&t.length?ir(t,Jr(e,3),!1,!0):[]},Ti.takeWhile=function(t,e){return t&&t.length?ir(t,Jr(e,3)):[]},Ti.tap=function(t,e){return e(t),t},Ti.throttle=function(t,e,i){var n=!0,r=!0;if("function"!=typeof t)throw new yt(a);return Ga(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),ba(t,e,{leading:n,maxWait:e,trailing:r})},Ti.thru=ia,Ti.toArray=eo,Ti.toPairs=To,Ti.toPairsIn=Po,Ti.toPath=function(t){return Oa(t)?pe(t,Ss):Ja(t)?[t]:_r(Is(oo(t)))},Ti.toPlainObject=ao,Ti.transform=function(t,e,i){var n=Oa(t),r=n||za(t)||Qa(t);if(e=Jr(e,4),null==i){var s=t&&t.constructor;i=r?n?new s:[]:Ga(t)&&ja(s)?Pi(Xt(t)):{}}return(r?le:hn)(t,(function(t,n,r){return e(i,t,n,r)})),i},Ti.unary=function(t){return ga(t,1)},Ti.union=Ws,Ti.unionBy=Hs,Ti.unionWith=Xs,Ti.uniq=function(t){return t&&t.length?$n(t):[]},Ti.uniqBy=function(t,e){return t&&t.length?$n(t,Jr(e,2)):[]},Ti.uniqWith=function(t,e){return e="function"==typeof e?e:void 0,t&&t.length?$n(t,void 0,e):[]},Ti.unset=function(t,e){return null==t||tr(t,e)},Ti.unzip=Zs,Ti.unzipWith=Ys,Ti.update=function(t,e,i){return null==t?t:er(t,e,or(i))},Ti.updateWith=function(t,e,i,n){return n="function"==typeof n?n:void 0,null==t?t:er(t,e,or(i),n)},Ti.values=Eo,Ti.valuesIn=function(t){return null==t?[]:De(t,wo(t))},Ti.without=qs,Ti.words=Vo,Ti.wrap=function(t,e){return Sa(or(e),t)},Ti.xor=Ks,Ti.xorBy=Js,Ti.xorWith=Qs,Ti.zip=$s,Ti.zipObject=function(t,e){return sr(t||[],e||[],Gi)},Ti.zipObjectDeep=function(t,e){return sr(t||[],e||[],Un)},Ti.zipWith=ta,Ti.entries=To,Ti.entriesIn=Po,Ti.extend=ho,Ti.extendWith=co,Jo(Ti,Ti),Ti.add=ol,Ti.attempt=Uo,Ti.camelCase=ko,Ti.capitalize=Do,Ti.ceil=ll,Ti.clamp=function(t,e,i){return void 0===i&&(i=e,e=void 0),void 0!==i&&(i=(i=so(i))==i?i:0),void 0!==e&&(e=(e=so(e))==e?e:0),qi(so(t),e,i)},Ti.clone=function(t){return Ki(t,4)},Ti.cloneDeep=function(t){return Ki(t,5)},Ti.cloneDeepWith=function(t,e){return Ki(t,5,e="function"==typeof e?e:void 0)},Ti.cloneWith=function(t,e){return Ki(t,4,e="function"==typeof e?e:void 0)},Ti.conformsTo=function(t,e){return null==e||Ji(t,e,xo(e))},Ti.deburr=Oo,Ti.defaultTo=function(t,e){return null==t||t!=t?e:t},Ti.divide=hl,Ti.endsWith=function(t,e,i){t=oo(t),e=Qn(e);var n=t.length,r=i=void 0===i?n:qi(no(i),0,n);return(i-=e.length)>=0&&t.slice(i,r)==e},Ti.eq=Pa,Ti.escape=function(t){return(t=oo(t))&&j.test(t)?t.replace(B,Be):t},Ti.escapeRegExp=function(t){return(t=oo(t))&&Y.test(t)?t.replace(Z,"\\$&"):t},Ti.every=function(t,e,i){var n=Oa(t)?ce:nn;return i&&ls(t,e,i)&&(e=void 0),n(t,Jr(e,3))},Ti.find=sa,Ti.findIndex=Ds,Ti.findKey=function(t,e){return be(t,Jr(e,3),hn)},Ti.findLast=aa,Ti.findLastIndex=Os,Ti.findLastKey=function(t,e){return be(t,Jr(e,3),cn)},Ti.floor=cl,Ti.forEach=oa,Ti.forEachRight=la,Ti.forIn=function(t,e){return null==t?t:on(t,Jr(e,3),wo)},Ti.forInRight=function(t,e){return null==t?t:ln(t,Jr(e,3),wo)},Ti.forOwn=function(t,e){return t&&hn(t,Jr(e,3))},Ti.forOwnRight=function(t,e){return t&&cn(t,Jr(e,3))},Ti.get=go,Ti.gt=Ea,Ti.gte=ka,Ti.has=function(t,e){return null!=t&&rs(t,e,gn)},Ti.hasIn=vo,Ti.head=Ls,Ti.identity=Zo,Ti.includes=function(t,e,i,n){t=La(t)?t:Eo(t),i=i&&!n?no(i):0;var r=t.length;return i<0&&(i=ai(r+i,0)),Ka(t)?i<=r&&t.indexOf(e,i)>-1:!!r&&we(t,e,i)>-1},Ti.indexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:no(i);return r<0&&(r=ai(n+r,0)),we(t,e,r)},Ti.inRange=function(t,e,i){return e=io(e),void 0===i?(i=e,e=0):i=io(i),function(t,e,i){return t>=oi(e,i)&&t<ai(e,i)}(t=so(t),e,i)},Ti.invoke=bo,Ti.isArguments=Da,Ti.isArray=Oa,Ti.isArrayBuffer=Ra,Ti.isArrayLike=La,Ti.isArrayLikeObject=Na,Ti.isBoolean=function(t){return!0===t||!1===t||Wa(t)&&pn(t)==u},Ti.isBuffer=za,Ti.isDate=Ba,Ti.isElement=function(t){return Wa(t)&&1===t.nodeType&&!Za(t)},Ti.isEmpty=function(t){if(null==t)return!0;if(La(t)&&(Oa(t)||"string"==typeof t||"function"==typeof t.splice||za(t)||Qa(t)||Da(t)))return!t.length;var e=ns(t);if(e==g||e==b)return!t.size;if(ds(t))return!In(t).length;for(var i in t)if(It.call(t,i))return!1;return!0},Ti.isEqual=function(t,e){return xn(t,e)},Ti.isEqualWith=function(t,e,i){var n=(i="function"==typeof i?i:void 0)?i(t,e):void 0;return void 0===n?xn(t,e,void 0,i):!!n},Ti.isError=Fa,Ti.isFinite=function(t){return"number"==typeof t&&ni(t)},Ti.isFunction=ja,Ti.isInteger=Va,Ti.isLength=Ua,Ti.isMap=Ha,Ti.isMatch=function(t,e){return t===e||wn(t,e,$r(e))},Ti.isMatchWith=function(t,e,i){return i="function"==typeof i?i:void 0,wn(t,e,$r(e),i)},Ti.isNaN=function(t){return Xa(t)&&t!=+t},Ti.isNative=function(t){if(us(t))throw new ft("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return An(t)},Ti.isNil=function(t){return null==t},Ti.isNull=function(t){return null===t},Ti.isNumber=Xa,Ti.isObject=Ga,Ti.isObjectLike=Wa,Ti.isPlainObject=Za,Ti.isRegExp=Ya,Ti.isSafeInteger=function(t){return Va(t)&&t>=-9007199254740991&&t<=9007199254740991},Ti.isSet=qa,Ti.isString=Ka,Ti.isSymbol=Ja,Ti.isTypedArray=Qa,Ti.isUndefined=function(t){return void 0===t},Ti.isWeakMap=function(t){return Wa(t)&&ns(t)==A},Ti.isWeakSet=function(t){return Wa(t)&&"[object WeakSet]"==pn(t)},Ti.join=function(t,e){return null==t?"":ri.call(t,e)},Ti.kebabCase=Ro,Ti.last=Fs,Ti.lastIndexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=n;return void 0!==i&&(r=(r=no(i))<0?ai(n+r,0):oi(r,n-1)),e==e?function(t,e,i){for(var n=i+1;n--;)if(t[n]===e)return n;return n}(t,e,r):xe(t,Ce,r,!0)},Ti.lowerCase=Lo,Ti.lowerFirst=No,Ti.lt=$a,Ti.lte=to,Ti.max=function(t){return t&&t.length?rn(t,Zo,mn):void 0},Ti.maxBy=function(t,e){return t&&t.length?rn(t,Jr(e,2),mn):void 0},Ti.mean=function(t){return Ie(t,Zo)},Ti.meanBy=function(t,e){return Ie(t,Jr(e,2))},Ti.min=function(t){return t&&t.length?rn(t,Zo,Mn):void 0},Ti.minBy=function(t,e){return t&&t.length?rn(t,Jr(e,2),Mn):void 0},Ti.stubArray=sl,Ti.stubFalse=al,Ti.stubObject=function(){return{}},Ti.stubString=function(){return""},Ti.stubTrue=function(){return!0},Ti.multiply=dl,Ti.nth=function(t,e){return t&&t.length?Dn(t,no(e)):void 0},Ti.noConflict=function(){return Yt._===this&&(Yt._=Et),this},Ti.noop=Qo,Ti.now=ma,Ti.pad=function(t,e,i){t=oo(t);var n=(e=no(e))?Xe(t):0;if(!e||n>=e)return t;var r=(e-n)/2;return Or(ti(r),i)+t+Or($e(r),i)},Ti.padEnd=function(t,e,i){t=oo(t);var n=(e=no(e))?Xe(t):0;return e&&n<e?t+Or(e-n,i):t},Ti.padStart=function(t,e,i){t=oo(t);var n=(e=no(e))?Xe(t):0;return e&&n<e?Or(e-n,i)+t:t},Ti.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),hi(oo(t).replace(K,""),e||0)},Ti.random=function(t,e,i){if(i&&"boolean"!=typeof i&&ls(t,e,i)&&(e=i=void 0),void 0===i&&("boolean"==typeof e?(i=e,e=void 0):"boolean"==typeof t&&(i=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):(t=io(t),void 0===e?(e=t,t=0):e=io(e)),t>e){var n=t;t=e,e=n}if(i||t%1||e%1){var r=ci();return oi(t+r*(e-t+Wt("1e-"+((r+"").length-1))),e)}return zn(t,e)},Ti.reduce=function(t,e,i){var n=Oa(t)?ge:Te,r=arguments.length<3;return n(t,Jr(e,4),i,r,tn)},Ti.reduceRight=function(t,e,i){var n=Oa(t)?ve:Te,r=arguments.length<3;return n(t,Jr(e,4),i,r,en)},Ti.repeat=function(t,e,i){return e=(i?ls(t,e,i):void 0===e)?1:no(e),Bn(oo(t),e)},Ti.replace=function(){var t=arguments,e=oo(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Ti.result=function(t,e,i){var n=-1,r=(e=lr(e,t)).length;for(r||(r=1,t=void 0);++n<r;){var s=null==t?void 0:t[Ss(e[n])];void 0===s&&(n=r,s=i),t=ja(s)?s.call(t):s}return t},Ti.round=fl,Ti.runInContext=t,Ti.sample=function(t){return(Oa(t)?Fi:jn)(t)},Ti.size=function(t){if(null==t)return 0;if(La(t))return Ka(t)?Xe(t):t.length;var e=ns(t);return e==g||e==b?t.size:In(t).length},Ti.snakeCase=zo,Ti.some=function(t,e,i){var n=Oa(t)?_e:Zn;return i&&ls(t,e,i)&&(e=void 0),n(t,Jr(e,3))},Ti.sortedIndex=function(t,e){return Yn(t,e)},Ti.sortedIndexBy=function(t,e,i){return qn(t,e,Jr(i,2))},Ti.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var n=Yn(t,e);if(n<i&&Pa(t[n],e))return n}return-1},Ti.sortedLastIndex=function(t,e){return Yn(t,e,!0)},Ti.sortedLastIndexBy=function(t,e,i){return qn(t,e,Jr(i,2),!0)},Ti.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var i=Yn(t,e,!0)-1;if(Pa(t[i],e))return i}return-1},Ti.startCase=Bo,Ti.startsWith=function(t,e,i){return t=oo(t),i=null==i?0:qi(no(i),0,t.length),e=Qn(e),t.slice(i,i+e.length)==e},Ti.subtract=pl,Ti.sum=function(t){return t&&t.length?Pe(t,Zo):0},Ti.sumBy=function(t,e){return t&&t.length?Pe(t,Jr(e,2)):0},Ti.template=function(t,e,i){var n=Ti.templateSettings;i&&ls(t,e,i)&&(e=void 0),t=oo(t),e=co({},e,n,Vr);var r,s,a=co({},e.imports,n.imports,Vr),o=xo(a),l=De(a,o),h=0,c=e.interpolate||ut,u="__p += '",d=vt((e.escape||ut).source+"|"+c.source+"|"+(c===G?nt:ut).source+"|"+(e.evaluate||ut).source+"|$","g"),f="//# sourceURL="+(It.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++jt+"]")+"\n";t.replace(d,(function(e,i,n,a,o,l){return n||(n=a),u+=t.slice(h,l).replace(dt,Fe),i&&(r=!0,u+="' +\n__e("+i+") +\n'"),o&&(s=!0,u+="';\n"+o+";\n__p += '"),n&&(u+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),h=l+e.length,e})),u+="';\n";var p=It.call(e,"variable")&&e.variable;p||(u="with (obj) {\n"+u+"\n}\n"),u=(s?u.replace(R,""):u).replace(L,"$1").replace(N,"$1;"),u="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+u+"return __p\n}";var m=Uo((function(){return pt(o,f+"return "+u).apply(void 0,l)}));if(m.source=u,Fa(m))throw m;return m},Ti.times=function(t,e){if((t=no(t))<1||t>9007199254740991)return[];var i=4294967295,n=oi(t,4294967295);t-=4294967295;for(var r=Ee(n,e=Jr(e));++i<t;)e(i);return r},Ti.toFinite=io,Ti.toInteger=no,Ti.toLength=ro,Ti.toLower=function(t){return oo(t).toLowerCase()},Ti.toNumber=so,Ti.toSafeInteger=function(t){return t?qi(no(t),-9007199254740991,9007199254740991):0===t?t:0},Ti.toString=oo,Ti.toUpper=function(t){return oo(t).toUpperCase()},Ti.trim=function(t,e,i){if((t=oo(t))&&(i||void 0===e))return t.replace(q,"");if(!t||!(e=Qn(e)))return t;var n=Ze(t),r=Ze(e);return cr(n,Re(n,r),Le(n,r)+1).join("")},Ti.trimEnd=function(t,e,i){if((t=oo(t))&&(i||void 0===e))return t.replace(J,"");if(!t||!(e=Qn(e)))return t;var n=Ze(t);return cr(n,0,Le(n,Ze(e))+1).join("")},Ti.trimStart=function(t,e,i){if((t=oo(t))&&(i||void 0===e))return t.replace(K,"");if(!t||!(e=Qn(e)))return t;var n=Ze(t);return cr(n,Re(n,Ze(e))).join("")},Ti.truncate=function(t,e){var i=30,n="...";if(Ga(e)){var r="separator"in e?e.separator:r;i="length"in e?no(e.length):i,n="omission"in e?Qn(e.omission):n}var s=(t=oo(t)).length;if(je(t)){var a=Ze(t);s=a.length}if(i>=s)return t;var o=i-Xe(n);if(o<1)return n;var l=a?cr(a,0,o).join(""):t.slice(0,o);if(void 0===r)return l+n;if(a&&(o+=l.length-o),Ya(r)){if(t.slice(o).search(r)){var h,c=l;for(r.global||(r=vt(r.source,oo(rt.exec(r))+"g")),r.lastIndex=0;h=r.exec(c);)var u=h.index;l=l.slice(0,void 0===u?o:u)}}else if(t.indexOf(Qn(r),o)!=o){var d=l.lastIndexOf(r);d>-1&&(l=l.slice(0,d))}return l+n},Ti.unescape=function(t){return(t=oo(t))&&F.test(t)?t.replace(z,Ye):t},Ti.uniqueId=function(t){var e=++St;return oo(t)+e},Ti.upperCase=Fo,Ti.upperFirst=jo,Ti.each=oa,Ti.eachRight=la,Ti.first=Ls,Jo(Ti,(ul={},hn(Ti,(function(t,e){It.call(Ti.prototype,e)||(ul[e]=t)})),ul),{chain:!1}),Ti.VERSION="4.17.20",le(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Ti[t].placeholder=Ti})),le(["drop","take"],(function(t,e){Di.prototype[t]=function(i){i=void 0===i?1:ai(no(i),0);var n=this.__filtered__&&!e?new Di(this):this.clone();return n.__filtered__?n.__takeCount__=oi(i,n.__takeCount__):n.__views__.push({size:oi(i,4294967295),type:t+(n.__dir__<0?"Right":"")}),n},Di.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),le(["filter","map","takeWhile"],(function(t,e){var i=e+1,n=1==i||3==i;Di.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Jr(t,3),type:i}),e.__filtered__=e.__filtered__||n,e}})),le(["head","last"],(function(t,e){var i="take"+(e?"Right":"");Di.prototype[t]=function(){return this[i](1).value()[0]}})),le(["initial","tail"],(function(t,e){var i="drop"+(e?"":"Right");Di.prototype[t]=function(){return this.__filtered__?new Di(this):this[i](1)}})),Di.prototype.compact=function(){return this.filter(Zo)},Di.prototype.find=function(t){return this.filter(t).head()},Di.prototype.findLast=function(t){return this.reverse().find(t)},Di.prototype.invokeMap=Fn((function(t,e){return"function"==typeof t?new Di(this):this.map((function(i){return yn(i,t,e)}))})),Di.prototype.reject=function(t){return this.filter(Ca(Jr(t)))},Di.prototype.slice=function(t,e){t=no(t);var i=this;return i.__filtered__&&(t>0||e<0)?new Di(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),void 0!==e&&(i=(e=no(e))<0?i.dropRight(-e):i.take(e-t)),i)},Di.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Di.prototype.toArray=function(){return this.take(4294967295)},hn(Di.prototype,(function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),n=/^(?:head|last)$/.test(e),r=Ti[n?"take"+("last"==e?"Right":""):e],s=n||/^find/.test(e);r&&(Ti.prototype[e]=function(){var e=this.__wrapped__,a=n?[1]:arguments,o=e instanceof Di,l=a[0],h=o||Oa(e),c=function(t){var e=r.apply(Ti,me([t],a));return n&&u?e[0]:e};h&&i&&"function"==typeof l&&1!=l.length&&(o=h=!1);var u=this.__chain__,d=!!this.__actions__.length,f=s&&!u,p=o&&!d;if(!s&&h){e=p?e:new Di(this);var m=t.apply(e,a);return m.__actions__.push({func:ia,args:[c],thisArg:void 0}),new ki(m,u)}return f&&p?t.apply(this,a):(m=this.thru(c),f?n?m.value()[0]:m.value():m)})})),le(["pop","push","shift","sort","splice","unshift"],(function(t){var e=bt[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);Ti.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var r=this.value();return e.apply(Oa(r)?r:[],t)}return this[i]((function(i){return e.apply(Oa(i)?i:[],t)}))}})),hn(Di.prototype,(function(t,e){var i=Ti[e];if(i){var n=i.name+"";It.call(yi,n)||(yi[n]=[]),yi[n].push({name:e,func:i})}})),yi[Pr(void 0,2).name]=[{name:"wrapper",func:void 0}],Di.prototype.clone=function(){var t=new Di(this.__wrapped__);return t.__actions__=_r(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=_r(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=_r(this.__views__),t},Di.prototype.reverse=function(){if(this.__filtered__){var t=new Di(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Di.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=Oa(t),n=e<0,r=i?t.length:0,s=function(t,e,i){var n=-1,r=i.length;for(;++n<r;){var s=i[n],a=s.size;switch(s.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=oi(e,t+a);break;case"takeRight":t=ai(t,e-a)}}return{start:t,end:e}}(0,r,this.__views__),a=s.start,o=s.end,l=o-a,h=n?o:a-1,c=this.__iteratees__,u=c.length,d=0,f=oi(l,this.__takeCount__);if(!i||!n&&r==l&&f==l)return nr(t,this.__actions__);var p=[];t:for(;l--&&d<f;){for(var m=-1,g=t[h+=e];++m<u;){var v=c[m],_=v.iteratee,y=v.type,b=_(g);if(2==y)g=b;else if(!b){if(1==y)continue t;break t}}p[d++]=g}return p},Ti.prototype.at=na,Ti.prototype.chain=function(){return ea(this)},Ti.prototype.commit=function(){return new ki(this.value(),this.__chain__)},Ti.prototype.next=function(){void 0===this.__values__&&(this.__values__=eo(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?void 0:this.__values__[this.__index__++]}},Ti.prototype.plant=function(t){for(var e,i=this;i instanceof Ei;){var n=Ts(i);n.__index__=0,n.__values__=void 0,e?r.__wrapped__=n:e=n;var r=n;i=i.__wrapped__}return r.__wrapped__=t,e},Ti.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Di){var e=t;return this.__actions__.length&&(e=new Di(this)),(e=e.reverse()).__actions__.push({func:ia,args:[Gs],thisArg:void 0}),new ki(e,this.__chain__)}return this.thru(Gs)},Ti.prototype.toJSON=Ti.prototype.valueOf=Ti.prototype.value=function(){return nr(this.__wrapped__,this.__actions__)},Ti.prototype.first=Ti.prototype.head,$t&&(Ti.prototype[$t]=function(){return this}),Ti}();"object"==s(i(15))&&i(15)?(Yt._=qe,void 0===(r=function(){return qe}.call(e,i,e,n))||(n.exports=r)):Kt?((Kt.exports=qe)._=qe,qt._=qe):Yt._=qe}).call(this)}).call(this,i(5),i(4)(t))},function(t,e,i){(function(n){var r,s,a;function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}a="object"==("undefined"==typeof self?"undefined":o(self))&&self.self===self&&self||"object"==(void 0===n?"undefined":o(n))&&n.global===n&&n,r=[i(44),i(3),e],void 0===(s=function(t,e,i){a.Backbone=function(t,e,i,n){var r=t.Backbone,s=Array.prototype.slice;e.VERSION="1.4.0",e.$=n,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a,l=e.Events={},h=/\s+/,c=function t(e,n,r,s,a){var l,c=0;if(r&&"object"===o(r)){void 0!==s&&"context"in a&&void 0===a.context&&(a.context=s);for(l=i.keys(r);c<l.length;c++)n=t(e,n,l[c],r[l[c]],a)}else if(r&&h.test(r))for(l=r.split(h);c<l.length;c++)n=e(n,l[c],s,a);else n=e(n,r,s,a);return n};l.on=function(t,e,i){return this._events=c(u,this._events||{},t,e,{context:i,ctx:this,listening:a}),a&&((this._listeners||(this._listeners={}))[a.id]=a,a.interop=!1),this},l.listenTo=function(t,e,n){if(!t)return this;var r=t._listenId||(t._listenId=i.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),o=a=s[r];o||(this._listenId||(this._listenId=i.uniqueId("l")),o=a=s[r]=new v(this,t));var l=d(t,e,n,this);if(a=void 0,l)throw l;return o.interop&&o.on(e,n),this};var u=function(t,e,i,n){if(i){var r=t[e]||(t[e]=[]),s=n.context,a=n.ctx,o=n.listening;o&&o.count++,r.push({callback:i,context:s,ctx:s||a,listening:o})}return t},d=function(t,e,i,n){try{t.on(e,i,n)}catch(t){return t}};l.off=function(t,e,i){return this._events?(this._events=c(f,this._events,t,e,{context:i,listeners:this._listeners}),this):this},l.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var s=t?[t._listenId]:i.keys(r),a=0;a<s.length;a++){var o=r[s[a]];if(!o)break;o.obj.off(e,n,this),o.interop&&o.off(e,n)}return i.isEmpty(r)&&(this._listeningTo=void 0),this};var f=function(t,e,n,r){if(t){var s,a=r.context,o=r.listeners,l=0;if(e||a||n){for(s=e?[e]:i.keys(t);l<s.length;l++){var h=t[e=s[l]];if(!h)break;for(var c=[],u=0;u<h.length;u++){var d=h[u];if(n&&n!==d.callback&&n!==d.callback._callback||a&&a!==d.context)c.push(d);else{var f=d.listening;f&&f.off(e,n)}}c.length?t[e]=c:delete t[e]}return t}for(s=i.keys(o);l<s.length;l++)o[s[l]].cleanup()}};l.once=function(t,e,i){var n=c(p,{},t,e,this.off.bind(this));return"string"==typeof t&&null==i&&(e=void 0),this.on(n,e,i)},l.listenToOnce=function(t,e,i){var n=c(p,{},e,i,this.stopListening.bind(this,t));return this.listenTo(t,n)};var p=function(t,e,n,r){if(n){var s=t[e]=i.once((function(){r(e,s),n.apply(this,arguments)}));s._callback=n}return t};l.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return c(m,this._events,t,void 0,i),this};var m=function(t,e,i,n){if(t){var r=t[e],s=t.all;r&&s&&(s=s.slice()),r&&g(r,n),s&&g(s,[e].concat(n))}return t},g=function(t,e){var i,n=-1,r=t.length,s=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,a);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,a,o);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e);return}},v=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};v.prototype.on=l.on,v.prototype.off=function(t,e){var i;this.interop?(this._events=c(f,this._events,t,e,{context:void 0,listeners:void 0}),i=!this._events):(this.count--,i=0===this.count),i&&this.cleanup()},v.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},l.bind=l.on,l.unbind=l.off,i.extend(e,l);var _=e.Model=function(t,e){var n=t||{};e||(e={}),this.preinitialize.apply(this,arguments),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{});var r=i.result(this,"defaults");n=i.defaults(i.extend({},r,n),r),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(_.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,n){if(null==t)return this;var r;if("object"===o(t)?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;var s=n.unset,a=n.silent,l=[],h=this._changing;this._changing=!0,h||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,u=this.changed,d=this._previousAttributes;for(var f in r)e=r[f],i.isEqual(c[f],e)||l.push(f),i.isEqual(d[f],e)?delete u[f]:u[f]=e,s?delete c[f]:c[f]=e;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!a){l.length&&(this._pending=n);for(var p=0;p<l.length;p++)this.trigger("change:"+l[p],this,c[l[p]],n)}if(h)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone(this.changed);var e,n=this._changing?this._previousAttributes:this.attributes,r={};for(var s in t){var a=t[s];i.isEqual(n[s],a)||(r[s]=a,e=!0)}return!!e&&r},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=i.extend({parse:!0},t);var e=this,n=t.success;return t.success=function(i){var r=t.parse?e.parse(i,t):i;if(!e.set(r,t))return!1;n&&n.call(t.context,e,i,t),e.trigger("sync",e,i,t)},H(this,t),this.sync("read",this,t)},save:function(t,e,n){var r;null==t||"object"===o(t)?(r=t,n=e):(r={})[t]=e;var s=(n=i.extend({validate:!0,parse:!0},n)).wait;if(r&&!s){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;var a=this,l=n.success,h=this.attributes;n.success=function(t){a.attributes=h;var e=n.parse?a.parse(t,n):t;if(s&&(e=i.extend({},r,e)),e&&!a.set(e,n))return!1;l&&l.call(n.context,a,t,n),a.trigger("sync",a,t,n)},H(this,n),r&&s&&(this.attributes=i.extend({},h,r));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=r);var u=this.sync(c,this,n);return this.attributes=h,u},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,r=t.wait,s=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(i){r&&s(),n&&n.call(t.context,e,i,t),e.isNew()||e.trigger("sync",e,i,t)};var a=!1;return this.isNew()?i.defer(t.success):(H(this,t),a=this.sync("delete",this,t)),r||s(),a},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||W();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1)}});var y=e.Collection=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},b={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},w=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var n,r=Array(t.length-i),s=e.length;for(n=0;n<r.length;n++)r[n]=t[n+i];for(n=0;n<s;n++)t[n+i]=e[n];for(n=0;n<r.length;n++)t[n+s+i]=r[n]};i.extend(y.prototype,l,{model:_,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,x))},remove:function(t,e){e=i.extend({},e);var n=!i.isArray(t);t=n?[t]:t.slice();var r=this._removeModels(t,e);return!e.silent&&r.length&&(e.changes={added:[],merged:[],removed:r},this.trigger("update",this,e)),n?r[0]:r},set:function(t,e){if(null!=t){(e=i.extend({},b,e)).parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var n=!i.isArray(t);t=n?[t]:t.slice();var r=e.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);var s,a,o=[],l=[],h=[],c=[],u={},d=e.add,f=e.merge,p=e.remove,m=!1,g=this.comparator&&null==r&&!1!==e.sort,v=i.isString(this.comparator)?this.comparator:null;for(a=0;a<t.length;a++){s=t[a];var _=this.get(s);if(_){if(f&&s!==_){var y=this._isModel(s)?s.attributes:s;e.parse&&(y=_.parse(y,e)),_.set(y,e),h.push(_),g&&!m&&(m=_.hasChanged(v))}u[_.cid]||(u[_.cid]=!0,o.push(_)),t[a]=_}else d&&(s=t[a]=this._prepareModel(s,e))&&(l.push(s),this._addReference(s,e),u[s.cid]=!0,o.push(s))}if(p){for(a=0;a<this.length;a++)u[(s=this.models[a]).cid]||c.push(s);c.length&&this._removeModels(c,e)}var x=!1,A=!g&&d&&p;if(o.length&&A?(x=this.length!==o.length||i.some(this.models,(function(t,e){return t!==o[e]})),this.models.length=0,w(this.models,o,0),this.length=this.models.length):l.length&&(g&&(m=!0),w(this.models,l,null==r?this.length:r),this.length=this.models.length),m&&this.sort({silent:!0}),!e.silent){for(a=0;a<l.length;a++)null!=r&&(e.index=r+a),(s=l[a]).trigger("add",s,this,e);(m||x)&&this.trigger("sort",this,e),(l.length||c.length||h.length)&&(e.changes={added:l,removed:c,merged:h},this.trigger("update",this,e))}return n?t[0]:t}},reset:function(t,e){e=e?i.clone(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return s.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var n=e.length;return i.isFunction(e)&&(e=e.bind(this)),1===n||i.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){var e=(t=i.extend({parse:!0},t)).success,n=this;return t.success=function(i){var r=t.reset?"reset":"set";n[r](i,t),e&&e.call(t.context,n,i,t),n.trigger("sync",n,i,t)},H(this,t),this.sync("read",this,t)},create:function(t,e){var n=(e=e?i.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;n||this.add(t,e);var r=this,s=e.success;return e.success=function(t,e,i){n&&r.add(t,i),s&&s.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},values:function(){return new C(this,I)},keys:function(){return new C(this,S)},entries:function(){return new C(this,M)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;(e=e?i.clone(e):{}).collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var i=[],n=0;n<t.length;n++){var r=this.get(t[n]);if(r){var s=this.indexOf(r);this.models.splice(s,1),this.length--,delete this._byId[r.cid];var a=this.modelId(r.attributes);null!=a&&delete this._byId[a],e.silent||(e.index=s,r.trigger("remove",r,this,e)),i.push(r),this._removeReference(r,e)}}return i},_isModel:function(t){return t instanceof _},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if(e){if(("add"===t||"remove"===t)&&i!==this)return;if("destroy"===t&&this.remove(e,n),"change"===t){var r=this.modelId(e.previousAttributes()),s=this.modelId(e.attributes);r!==s&&(null!=r&&delete this._byId[r],null!=s&&(this._byId[s]=e))}}this.trigger.apply(this,arguments)}});var A="function"==typeof Symbol&&Symbol.iterator;A&&(y.prototype[A]=y.prototype.values);var C=function(t,e){this._collection=t,this._kind=e,this._index=0},I=1,S=2,M=3;A&&(C.prototype[A]=function(){return this}),C.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t,e=this._collection.at(this._index);if(this._index++,this._kind===I)t=e;else{var i=this._collection.modelId(e.attributes);t=this._kind===S?i:[i,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var T=e.View=function(t){this.cid=i.uniqueId("view"),this.preinitialize.apply(this,arguments),i.extend(this,i.pick(t,E)),this._ensureElement(),this.initialize.apply(this,arguments)},P=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName","events"];i.extend(T.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=i.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var n=t[e];if(i.isFunction(n)||(n=this[n]),n){var r=e.match(P);this.delegate(r[1],r[2],n.bind(this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}});var k=function(t,e,n,r){i.each(n,(function(i,n){e[n]&&(t.prototype[n]=function(t,e,i,n){switch(e){case 1:return function(){return t[i](this[n])};case 2:return function(e){return t[i](this[n],e)};case 3:return function(e,r){return t[i](this[n],D(e,this),r)};case 4:return function(e,r,s){return t[i](this[n],D(e,this),r,s)};default:return function(){var e=s.call(arguments);return e.unshift(this[n]),t[i].apply(t,e)}}}(e,i,n,r))}))},D=function(t,e){return i.isFunction(t)?t:i.isObject(t)&&!e._isModel(t)?O(t):i.isString(t)?function(e){return e.get(t)}:t},O=function(t){var e=i.matches(t);return function(t){return e(t.attributes)}};i.each([[y,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models"],[_,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes"]],(function(t){var e=t[0],n=t[1],r=t[2];e.mixin=function(t){var n=i.reduce(i.functions(t),(function(t,e){return t[e]=0,t}),{});k(e,t,n,r)},k(e,i,n,r)})),e.sync=function(t,n,r){var s=R[t];i.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:s,dataType:"json"};if(r.url||(a.url=i.result(n,"url")||W()),null!=r.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(a.contentType="application/json",a.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),r.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){a.type="POST",r.emulateJSON&&(a.data._method=s);var o=r.beforeSend;r.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",s),o)return o.apply(this,arguments)}}"GET"===a.type||r.emulateJSON||(a.processData=!1);var l=r.error;r.error=function(t,e,i){r.textStatus=e,r.errorThrown=i,l&&l.call(r.context,t,e,i)};var h=r.xhr=e.ajax(i.extend(a,r));return n.trigger("request",n,h,r),h};var R={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var L=e.Router=function(t){t||(t={}),this.preinitialize.apply(this,arguments),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},N=/\((.*?)\)/g,z=/(\(\?)?:\w+/g,B=/\*\w+/g,F=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(L.prototype,l,{preinitialize:function(){},initialize:function(){},route:function(t,n,r){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var s=this;return e.history.route(t,(function(i){var a=s._extractParameters(t,i);!1!==s.execute(r,a,n)&&(s.trigger.apply(s,["route:"+n].concat(a)),s.trigger("route",n,a),e.history.trigger("route",s,n,a))})),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(F,"\\$&").replace(N,"(?:$1)?").replace(z,(function(t,e){return e?t:"([^/?]+)"})).replace(B,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,(function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null}))}});var j=e.History=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},V=/^[#\/]|\s+$/g,U=/^\/+|\/+$/g,G=/#.*$/;j.started=!1,i.extend(j.prototype,l,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(V,"")},start:function(t){if(j.started)throw new Error("Backbone.history has already been started");if(j.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(U,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,r=n.insertBefore(this.iframe,n.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var s=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),j.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),i.some(this.handlers,(function(e){if(e.route.test(t))return e.callback(t),!0})))},navigate:function(t,e){if(!j.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;t=t.replace(G,"");var r=this.decodeFragment(t);if(this.fragment!==r){if(this.fragment=r,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var s=this.iframe.contentWindow;e.replace||(s.document.open(),s.document.close()),this._updateHash(s.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new j,_.extend=y.extend=L.extend=T.extend=j.extend=function(t,e){var n,r=this;return n=t&&i.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,e),n.prototype=i.create(r.prototype,t),n.prototype.constructor=n,n.__super__=r.prototype,n};var W=function(){throw new Error('A "url" property or function must be specified')},H=function(t,e){var i=e.error;e.error=function(n){i&&i.call(e.context,t,n,e),t.trigger("error",t,n,e)}};return e}(a,i,t,e)}.apply(e,r))||(t.exports=s)}).call(this,i(5))},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}(function(){var e;e=function(t){var e;return e=i(t),null==t?"null":"object"===e&&t.constructor===Array?"array":e},t.exports={extendedTypeOf:e}}).call(this)},function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r=Array.prototype.forEach.bind([]);t.exports=function(t){var e;if(!t)return!1;if("function"===(e=n(t)))return!0;if("object"!==e)return!1;try{return r(t),!0}catch(t){if(t instanceof TypeError)return!1;throw t}}},function(t,e,i){var n=i(34);"string"==typeof n&&(n=[[t.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};i(7)(n,r);n.locals&&(t.exports=n.locals)},function(t,e,i){var n=i(36);"string"==typeof n&&(n=[[t.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};i(7)(n,r);n.locals&&(t.exports=n.locals)},function(t,e,i){var n=i(37);"string"==typeof n&&(n=[[t.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};i(7)(n,r);n.locals&&(t.exports=n.locals)},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e,i){(function(t){var i,n,r,s;function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}window,s=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===a(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=35)}({27:function(t,e,i){"use strict";e.a=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}},29:function(t,e,i){"use strict";
/** @license React v16.14.0
         * react.production.min.js
         *
         * Copyright (c) Facebook, Inc. and its affiliates.
         *
         * This source code is licensed under the MIT license found in the
         * LICENSE file in the root directory of this source tree.
         */function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r=i(30),s="function"==typeof Symbol&&Symbol.for,a=s?Symbol.for("react.element"):60103,o=s?Symbol.for("react.portal"):60106,l=s?Symbol.for("react.fragment"):60107,h=s?Symbol.for("react.strict_mode"):60108,c=s?Symbol.for("react.profiler"):60114,u=s?Symbol.for("react.provider"):60109,d=s?Symbol.for("react.context"):60110,f=s?Symbol.for("react.forward_ref"):60112,p=s?Symbol.for("react.suspense"):60113,m=s?Symbol.for("react.memo"):60115,g=s?Symbol.for("react.lazy"):60116,v="function"==typeof Symbol&&Symbol.iterator;function _(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function x(t,e,i){this.props=t,this.context=e,this.refs=b,this.updater=i||y}function w(){}function A(t,e,i){this.props=t,this.context=e,this.refs=b,this.updater=i||y}x.prototype.isReactComponent={},x.prototype.setState=function(t,e){if("object"!==n(t)&&"function"!=typeof t&&null!=t)throw Error(_(85));this.updater.enqueueSetState(this,t,e,"setState")},x.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},w.prototype=x.prototype;var C=A.prototype=new w;C.constructor=A,r(C,x.prototype),C.isPureReactComponent=!0;var I={current:null},S=Object.prototype.hasOwnProperty,M={key:!0,ref:!0,__self:!0,__source:!0};function T(t,e,i){var n,r={},s=null,o=null;if(null!=e)for(n in void 0!==e.ref&&(o=e.ref),void 0!==e.key&&(s=""+e.key),e)S.call(e,n)&&!M.hasOwnProperty(n)&&(r[n]=e[n]);var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){for(var h=Array(l),c=0;c<l;c++)h[c]=arguments[c+2];r.children=h}if(t&&t.defaultProps)for(n in l=t.defaultProps)void 0===r[n]&&(r[n]=l[n]);return{$$typeof:a,type:t,key:s,ref:o,props:r,_owner:I.current}}function P(t){return"object"===n(t)&&null!==t&&t.$$typeof===a}var E=/\/+/g,k=[];function D(t,e,i,n){if(k.length){var r=k.pop();return r.result=t,r.keyPrefix=e,r.func=i,r.context=n,r.count=0,r}return{result:t,keyPrefix:e,func:i,context:n,count:0}}function O(t){t.result=null,t.keyPrefix=null,t.func=null,t.context=null,t.count=0,10>k.length&&k.push(t)}function R(t,e,i){return null==t?0:function t(e,i,r,s){var l=n(e);"undefined"!==l&&"boolean"!==l||(e=null);var h=!1;if(null===e)h=!0;else switch(l){case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case a:case o:h=!0}}if(h)return r(s,e,""===i?"."+L(e,0):i),1;if(h=0,i=""===i?".":i+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=i+L(l=e[c],c);h+=t(l,u,r,s)}else if("function"==typeof(u=null===e||"object"!==n(e)?null:"function"==typeof(u=v&&e[v]||e["@@iterator"])?u:null))for(e=u.call(e),c=0;!(l=e.next()).done;)h+=t(l=l.value,u=i+L(l,c++),r,s);else if("object"===l)throw r=""+e,Error(_(31,"[object Object]"===r?"object with keys {"+Object.keys(e).join(", ")+"}":r,""));return h}(t,"",e,i)}function L(t,e){return"object"===n(t)&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+(""+t).replace(/[=:]/g,(function(t){return e[t]}))}(t.key):e.toString(36)}function N(t,e){t.func.call(t.context,e,t.count++)}function z(t,e,i){var n=t.result,r=t.keyPrefix;t=t.func.call(t.context,e,t.count++),Array.isArray(t)?B(t,n,i,(function(t){return t})):null!=t&&(P(t)&&(t=function(t,e){return{$$typeof:a,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(t,r+(!t.key||e&&e.key===t.key?"":(""+t.key).replace(E,"$&/")+"/")+i)),n.push(t))}function B(t,e,i,n,r){var s="";null!=i&&(s=(""+i).replace(E,"$&/")+"/"),R(t,z,e=D(e,s,n,r)),O(e)}var F={current:null};function j(){var t=F.current;if(null===t)throw Error(_(321));return t}var V={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:I,IsSomeRendererActing:{current:!1},assign:r};e.Children={map:function(t,e,i){if(null==t)return t;var n=[];return B(t,n,null,e,i),n},forEach:function(t,e,i){if(null==t)return t;R(t,N,e=D(null,null,e,i)),O(e)},count:function(t){return R(t,(function(){return null}),null)},toArray:function(t){var e=[];return B(t,e,null,(function(t){return t})),e},only:function(t){if(!P(t))throw Error(_(143));return t}},e.Component=x,e.Fragment=l,e.Profiler=c,e.PureComponent=A,e.StrictMode=h,e.Suspense=p,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,e.cloneElement=function(t,e,i){if(null==t)throw Error(_(267,t));var n=r({},t.props),s=t.key,o=t.ref,l=t._owner;if(null!=e){if(void 0!==e.ref&&(o=e.ref,l=I.current),void 0!==e.key&&(s=""+e.key),t.type&&t.type.defaultProps)var h=t.type.defaultProps;for(c in e)S.call(e,c)&&!M.hasOwnProperty(c)&&(n[c]=void 0===e[c]&&void 0!==h?h[c]:e[c])}var c=arguments.length-2;if(1===c)n.children=i;else if(1<c){h=Array(c);for(var u=0;u<c;u++)h[u]=arguments[u+2];n.children=h}return{$$typeof:a,type:t.type,key:s,ref:o,props:n,_owner:l}},e.createContext=function(t,e){return void 0===e&&(e=null),(t={$$typeof:d,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:u,_context:t},t.Consumer=t},e.createElement=T,e.createFactory=function(t){var e=T.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:f,render:t}},e.isValidElement=P,e.lazy=function(t){return{$$typeof:g,_ctor:t,_status:-1,_result:null}},e.memo=function(t,e){return{$$typeof:m,type:t,compare:void 0===e?null:e}},e.useCallback=function(t,e){return j().useCallback(t,e)},e.useContext=function(t,e){return j().useContext(t,e)},e.useDebugValue=function(){},e.useEffect=function(t,e){return j().useEffect(t,e)},e.useImperativeHandle=function(t,e,i){return j().useImperativeHandle(t,e,i)},e.useLayoutEffect=function(t,e){return j().useLayoutEffect(t,e)},e.useMemo=function(t,e){return j().useMemo(t,e)},e.useReducer=function(t,e,i){return j().useReducer(t,e,i)},e.useRef=function(t){return j().useRef(t)},e.useState=function(t){return j().useState(t)},e.version="16.14.0"},30:function(t,e,i){"use strict";
/*
        object-assign
        (c) Sindre Sorhus
        @license MIT
        */var n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,o,l=a(t),h=1;h<arguments.length;h++){for(var c in i=Object(arguments[h]))r.call(i,c)&&(l[c]=i[c]);if(n){o=n(i);for(var u=0;u<o.length;u++)s.call(i,o[u])&&(l[o[u]]=i[o[u]])}}return l}},35:function(t,e,i){"use strict";i.r(e),i.d(e,"BindingBase",(function(){return f})),i.d(e,"BindingElementToObservers",(function(){return x})),i.d(e,"BindingObserversToElement",(function(){return D})),i.d(e,"BindingTwoWay",(function(){return G})),i.d(e,"Events",(function(){return n.a})),i.d(e,"History",(function(){return K})),i.d(e,"Observer",(function(){return a})),i.d(e,"ObserverHistory",(function(){return Q})),i.d(e,"ObserverList",(function(){return tt}));var n=i(8);function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(n.a.call(this),e=e||{},this._destroyed=!1,this._path="",this._keys=[],this._data={},this._pathsWithDuplicates=null,e.pathsWithDuplicates){this._pathsWithDuplicates={};for(var i=0;i<e.pathsWithDuplicates.length;i++)this._pathsWithDuplicates[e.pathsWithDuplicates[i]]=!0}this.patch(t),this._parent=e.parent||null,this._parentPath=e.parentPath||"",this._parentField=e.parentField||null,this._parentKey=e.parentKey||null,this._latestFn=e.latestFn||null,this._silent=!1;var r=function(t){return function(e,i,n,r){if(this._parent){var s,a=this._parentKey;!a&&this._parentField instanceof Array&&-1===(a=this._parentField.indexOf(this))||(e=this._parentPath+"."+a+"."+e,this._silent&&(s=this._parent.silence()),this._parent.emit(e+":"+t,i,n,r),this._parent.emit("*:"+t,e,i,n,r),this._silent&&this._parent.silenceRestore(s))}}};this.on("*:set",r("set")),this.on("*:unset",r("unset")),this.on("*:insert",r("insert")),this.on("*:remove",r("remove")),this.on("*:move",r("move"))}i(6),s._splitPathsCache={},s._splitPath=function(t){var e=s._splitPathsCache,i=e[t];return i?i=i.slice():(i=t.split("."),e[t]=i),i},s.prototype=Object.create(n.a.prototype),s.prototype.silence=function(){this._silent=!0;var t=this.history&&this.history.enabled;t&&(this.history.enabled=!1);var e=this.sync&&this.sync.enabled;return e&&(this.sync.enabled=!1),[t,e]},s.prototype.silenceRestore=function(t){this._silent=!1,t[0]&&(this.history.enabled=!0),t[1]&&(this.sync.enabled=!0)},s.prototype._prepare=function(t,e,i,n,a){var o,l,h=(t._path?t._path+".":"")+e,c=r(i);if(t._keys.push(e),"object"===c&&i instanceof Array){for(t._data[e]=i.slice(0),o=0;o<t._data[e].length;o++)"object"===r(t._data[e][o])&&null!==t._data[e][o]?t._data[e][o]instanceof Array?t._data[e][o].slice(0):t._data[e][o]=new s(t._data[e][o],{parent:this,parentPath:h,parentField:t._data[e],parentKey:null}):(l=this.silence(),this.emit(h+"."+o+":set",t._data[e][o],null,a),this.emit("*:set",h+"."+o,t._data[e][o],null,a),this.silenceRestore(l));n&&(l=this.silence()),this.emit(h+":set",t._data[e],null,a),this.emit("*:set",h,t._data[e],null,a),n&&this.silenceRestore(l)}else if("object"===c&&i instanceof Object){for(o in"object"!==r(t._data[e])&&(t._data[e]={_path:h,_keys:[],_data:{}}),i)"object"===r(i[o])?this._prepare(t._data[e],o,i[o],!0,a):(l=this.silence(),t._data[e]._data[o]=i[o],t._data[e]._keys.push(o),this.emit(h+"."+o+":set",i[o],null,a),this.emit("*:set",h+"."+o,i[o],null,a),this.silenceRestore(l));n&&(l=this.silence()),this.emit(h+":set",i,void 0,a),this.emit("*:set",h,i,void 0,a),n&&this.silenceRestore(l)}else n&&(l=this.silence()),t._data[e]=i,this.emit(h+":set",i,void 0,a),this.emit("*:set",h,i,void 0,a),n&&this.silenceRestore(l);return!0},s.prototype.set=function(t,e,i,n,a){var o,l,h,c,u=this,d=s._splitPath(t),f=d.length,p=d[f-1],m=this,g="",v=this;for(o=0;o<f-1;o++)m instanceof Array?(m=m[d[o]])instanceof s&&(t=d.slice(o+1).join("."),v=m):(o<f&&"object"!==r(m._data[d[o]])&&(m._data[d[o]]&&v.unset((m.__path?m.__path+".":"")+d[o]),m._data[d[o]]={_path:t,_keys:[],_data:{}},m._keys.push(d[o])),o===f-1&&m.__path&&(g=m.__path+"."+d[o]),m=m._data[d[o]]);if(m instanceof Array){var _=parseInt(p,10);if(m[_]===e&&!a)return;return l=(l=m[_])instanceof s?l.json():v.json(l),m[_]=e,e instanceof s&&(e._parent=v,e._parentPath=g,e._parentField=m,e._parentKey=null),i&&(h=v.silence()),v.emit(t+":set",e,l,n),v.emit("*:set",t,e,l,n),i&&v.silenceRestore(h),!0}if(m._data&&!m._data.hasOwnProperty(p))return"object"===r(e)?v._prepare(m,p,e,!1,n):(m._data[p]=e,m._keys.push(p),i&&(h=v.silence()),v.emit(t+":set",e,null,n),v.emit("*:set",t,e,null,n),i&&v.silenceRestore(h),!0);if("object"===r(e)&&e instanceof Array){if(e.equals(m._data[p])&&!a)return!1;if((l=m._data[p])instanceof s||(l=v.json(l)),m._data[p]&&m._data[p].length===e.length){for(h=v.silence(),0===e.length&&(m._data[p]=e),o=0;o<m._data[p].length;o++)m._data[p][o]instanceof s?m._data[p][o].patch(e[o],!0):m._data[p][o]!==e[o]&&(m._data[p][o]=e[o],v.emit(t+"."+o+":set",m._data[p][o],l&&l[o]||null,n),v.emit("*:set",t+"."+o,m._data[p][o],l&&l[o]||null,n));v.silenceRestore(h)}else{for(m._data[p]=[],e.forEach((function(t){u._doInsert(m,p,t)})),h=v.silence(),o=0;o<m._data[p].length;o++)v.emit(t+"."+o+":set",m._data[p][o],l&&l[o]||null,n),v.emit("*:set",t+"."+o,m._data[p][o],l&&l[o]||null,n);v.silenceRestore(h)}return i&&(h=v.silence()),v.emit(t+":set",e,l,n),v.emit("*:set",t,e,l,n),i&&v.silenceRestore(h),!0}if("object"===r(e)&&e instanceof Object){var y=!1;for(var b in(l=m._data[p])instanceof s||(l=v.json(l)),d=Object.keys(e),m._data[p]&&m._data[p]._data||(m._data[p]?v.unset((m.__path?m.__path+".":"")+p):y=!0,m._data[p]={_path:t,_keys:[],_data:{}}),m._data[p]._data)e.hasOwnProperty(b)?m._data[p]._data.hasOwnProperty(b)?v._equals(m._data[p]._data[b],e[b])||v.set(t+"."+b,e[b],!0)&&(y=!0):v._prepare(m._data[p],b,e[b],!0,n)&&(y=!0):v.unset(t+"."+b,!0)&&(y=!0);for(o=0;o<d.length;o++)void 0===e[d[o]]&&m._data[p]._data.hasOwnProperty(d[o])?v.unset(t+"."+d[o],!0)&&(y=!0):"object"===r(e[d[o]])?m._data[p]._data.hasOwnProperty(d[o])?v.set(t+"."+d[o],e[d[o]],!0)&&(y=!0):v._prepare(m._data[p],d[o],e[d[o]],!0,n)&&(y=!0):v._equals(m._data[p]._data[d[o]],e[d[o]])||("object"===r(e[d[o]])?v.set(m._data[p]._path+"."+d[o],e[d[o]],!0)&&(y=!0):m._data[p]._data[d[o]]!==e[d[o]]&&(y=!0,-1===m._data[p]._keys.indexOf(d[o])&&m._data[p]._keys.push(d[o]),m._data[p]._data[d[o]]=e[d[o]],h=v.silence(),v.emit(m._data[p]._path+"."+d[o]+":set",m._data[p]._data[d[o]],null,n),v.emit("*:set",m._data[p]._path+"."+d[o],m._data[p]._data[d[o]],null,n),v.silenceRestore(h)));if(y){i&&(h=v.silence());var x=v.json(m._data[p]);return v.emit(m._data[p]._path+":set",x,l,n),v.emit("*:set",m._data[p]._path,x,l,n),i&&v.silenceRestore(h),!0}return!1}return!((c=!m.hasOwnProperty("_data")&&m.hasOwnProperty(p)?m:m._data)[p]===e&&!a||(i&&(h=v.silence()),(l=c[p])instanceof s||(l=v.json(l)),c[p]=e,v.emit(t+":set",e,l,n),v.emit("*:set",t,e,l,n),i&&v.silenceRestore(h),0))},s.prototype.has=function(t){for(var e=s._splitPath(t),i=this,n=0,r=e.length;n<r;n++){if(null==i)return;i=i._data?i._data[e[n]]:i[e[n]]}return void 0!==i},s.prototype.get=function(t,e){for(var i=s._splitPath(t),n=this,r=0;r<i.length;r++){if(null==n)return;n=n._data?n._data[i[r]]:n[i[r]]}return e?n:null==n?null:this.json(n)},s.prototype.getRaw=function(t){return this.get(t,!0)},s.prototype._equals=function(t,e){return t===e||!!(t instanceof Array&&e instanceof Array&&t.equals(e))},s.prototype.unset=function(t,e,i){var n,r=s._splitPath(t),a=r[r.length-1],o=this,l=this;for(n=0;n<r.length-1;n++)o instanceof Array?(o=o[r[n]])instanceof s&&(t=r.slice(n+1).join("."),l=o):o=o._data[r[n]];if(!o._data||!o._data.hasOwnProperty(a))return!1;var h,c=o._data[a];if(c instanceof s||(c=l.json(c)),o._data[a]&&o._data[a]._data)for(n=o._data[a]._keys.length-1;n>=0;n--)l.unset(t+"."+o._data[a]._keys[n],!0);return o._keys.splice(o._keys.indexOf(a),1),delete o._data[a],e&&(h=l.silence()),l.emit(t+":unset",c,i),l.emit("*:unset",t,c,i),e&&l.silenceRestore(h),!0},s.prototype.remove=function(t,e,i,n){for(var r=s._splitPath(t),a=r[r.length-1],o=this,l=this,h=0;h<r.length-1;h++)if(o instanceof Array)(o=o[parseInt(r[h],10)])instanceof s&&(t=r.slice(h+1).join("."),l=o);else{if(!o._data||!o._data.hasOwnProperty(r[h]))return;o=o._data[r[h]]}if(o._data&&o._data.hasOwnProperty(a)&&o._data[a]instanceof Array){var c=o._data[a];if(!(c.length<e)){var u,d=c[e];return d instanceof s?d._parent=null:d=l.json(d),c.splice(e,1),i&&(u=l.silence()),l.emit(t+":remove",d,e,n),l.emit("*:remove",t,d,e,n),i&&l.silenceRestore(u),!0}}},s.prototype.removeValue=function(t,e,i,n){for(var r=s._splitPath(t),a=r[r.length-1],o=this,l=this,h=0;h<r.length-1;h++)if(o instanceof Array)(o=o[parseInt(r[h],10)])instanceof s&&(t=r.slice(h+1).join("."),l=o);else{if(!o._data||!o._data.hasOwnProperty(r[h]))return;o=o._data[r[h]]}if(o._data&&o._data.hasOwnProperty(a)&&o._data[a]instanceof Array){var c,u=o._data[a],d=u.indexOf(e);if(-1!==d&&!(u.length<d))return(e=u[d])instanceof s?e._parent=null:e=l.json(e),u.splice(d,1),i&&(c=l.silence()),l.emit(t+":remove",e,d,n),l.emit("*:remove",t,e,d,n),i&&l.silenceRestore(c),!0}},s.prototype.insert=function(t,e,i,n,r){for(var a=s._splitPath(t),o=a[a.length-1],l=this,h=this,c=0;c<a.length-1;c++)if(l instanceof Array)(l=l[parseInt(a[c],10)])instanceof s&&(t=a.slice(c+1).join("."),h=l);else{if(!l._data||!l._data.hasOwnProperty(a[c]))return;l=l._data[a[c]]}if(l._data&&l._data.hasOwnProperty(o)&&l._data[o]instanceof Array){var u,d=l._data[o];return e=h._doInsert(l,o,e,i),void 0===i&&(i=d.length-1),n&&(u=h.silence()),h.emit(t+":insert",e,i,r),h.emit("*:insert",t,e,i,r),n&&h.silenceRestore(u),!0}},s.prototype._doInsert=function(t,e,i,n){var a=t._data[e];"object"!==r(i)||i instanceof s||null===i||(i=i instanceof Array?i.slice(0):new s(i));var o=t._path?"".concat(t._path,".").concat(e):e;if(null===i||this._pathsWithDuplicates&&this._pathsWithDuplicates[o]||-1===a.indexOf(i))return void 0===n?a.push(i):a.splice(n,0,i),i instanceof s?(i._parent=this,i._parentPath=o,i._parentField=a,i._parentKey=null):i=this.json(i),i},s.prototype.move=function(t,e,i,n,r){for(var a=s._splitPath(t),o=a[a.length-1],l=this,h=this,c=0;c<a.length-1;c++)if(l instanceof Array)(l=l[parseInt(a[c],10)])instanceof s&&(t=a.slice(c+1).join("."),h=l);else{if(!l._data||!l._data.hasOwnProperty(a[c]))return;l=l._data[a[c]]}if(l._data&&l._data.hasOwnProperty(o)&&l._data[o]instanceof Array){var u=l._data[o];if(!(u.length<e||u.length<i||e===i)){var d,f=u[e];return u.splice(e,1),-1===i&&(i=u.length),u.splice(i,0,f),f instanceof s||(f=h.json(f)),n&&(d=h.silence()),h.emit(t+":move",f,i,e,r),h.emit("*:move",t,f,i,e,r),n&&h.silenceRestore(d),!0}}},s.prototype.patch=function(t,e){var i;if("object"===r(t)){for(i in t)"object"!==r(t[i])||this._data.hasOwnProperty(i)?this._data[i]!==t[i]&&this.set(i,t[i]):this._prepare(this,i,t[i]);if(e)for(i in this._data)t.hasOwnProperty(i)||this.unset(i)}},s.prototype.json=function(t){var e,i,n,s,a={},o=void 0===t?this:t;if(o instanceof Object&&o._keys){n=o._keys.length;for(var l=0;l<n;l++){e=o._keys[l];var h=o._data[e],c=r(h);if("object"===c&&h instanceof Array)for(a[e]=h.slice(0),s=a[e].length,i=0;i<s;i++)"object"===r(a[e][i])&&(a[e][i]=this.json(a[e][i]));else a[e]="object"===c&&h instanceof Object?this.json(h):h}}else{if(null===o)return null;if("object"===r(o)&&o instanceof Array)for(n=(a=o.slice(0)).length,i=0;i<n;i++)a[i]=this.json(a[i]);else if("object"===r(o))for(e in o)o.hasOwnProperty(e)&&(a[e]=o[e]);else a=o}return a},s.prototype.forEach=function(t,e,i){var n=e||this;i=i||"";for(var s=0;s<n._keys.length;s++){var a=n._keys[s],o=n._data[a],l=this.schema&&this.schema.has(i+a)&&this.schema.get(i+a).type.name.toLowerCase()||r(o);"object"===l&&o instanceof Array?t(i+a,"array",o,a):"object"===l&&o instanceof Object?(t(i+a,"object",o,a),this.forEach(t,o,i+a+".")):t(i+a,l,o,a)}},s.prototype.latest=function(){return this._latestFn?this._latestFn():this},s.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.emit("destroy"),this.unbind())},Object.defineProperty(s.prototype,"latestFn",{get:function(){return this._latestFn},set:function(t){this._latestFn=t}});var a=s;function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=d(t);if(e){var r=d(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return u(this,i)}}function u(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}i(27);var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(s,t);var e,i,n,r=c(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t||(t={}),(e=r.call(this))._observers=null,e._paths=null,e._applyingChange=!1,e._element=t.element||null,e._history=t.history||null,e._historyPrefix=t.historyPrefix||null,e._historyPostfix=t.historyPostfix||null,e._historyName=t.historyName||null,e._historyCombine=t.historyCombine||!1,e._linked=!1,e}return e=s,(i=[{key:"_pathAt",value:function(t,e){return t[e]||t[0]}},{key:"link",value:function(t,e){this._observers&&this.unlink(),this._observers=Array.isArray(t)?t:[t],this._paths=Array.isArray(e)?e:[e],this._linked=!0}},{key:"unlink",value:function(){this._observers=null,this._paths=null,this._linked=!1}},{key:"clone",value:function(){throw new Error("pcui.BindingBase#clone: Not implemented")}},{key:"setValue",value:function(t){}},{key:"setValues",value:function(t){}},{key:"addValue",value:function(t){}},{key:"addValues",value:function(t){}},{key:"removeValue",value:function(t){}},{key:"removeValues",value:function(t){}},{key:"element",get:function(){return this._element},set:function(t){this._element=t}},{key:"applyingChange",get:function(){return this._applyingChange},set:function(t){this._applyingChange!==t&&(this._applyingChange=t,this.emit("applyingChange",t))}},{key:"linked",get:function(){return this._linked}},{key:"historyCombine",get:function(){return this._historyCombine},set:function(t){this._historyCombine=t}},{key:"historyName",get:function(){return this._historyName},set:function(t){this._historyName=t}},{key:"historyPrefix",get:function(){return this._historyPrefix},set:function(t){this._historyPrefix=t}},{key:"historyPostfix",get:function(){return this._historyPostfix},set:function(t){this._historyPostfix=t}},{key:"observers",get:function(){return this._observers}},{key:"paths",get:function(){return this._paths}}])&&l(e.prototype,i),n&&l(e,n),s}(n.a);function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=b(t);if(e){var r=b(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return y(this,i)}}function y(t,e){return!e||"object"!==p(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var x=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(s,t);var e,i,n,r=_(s);function s(){return m(this,s),r.apply(this,arguments)}return e=s,(i=[{key:"clone",value:function(){return new s({history:this._history,historyPrefix:this._historyPrefix,historyPostfix:this._historyPostfix,historyName:this._historyName,historyCombine:this._historyCombine})}},{key:"_getHistoryActionName",value:function(t){return"".concat(this._historyPrefix||"").concat(this._historyName||t[0]).concat(this._historyPostfix||"")}},{key:"_setValue",value:function(t,e){var i=this;if(!this.applyingChange&&this._observers){this.applyingChange=!0;var n=this._observers.slice(),r=this._paths.slice(),s=function(){i._setValueToObservers(n,r,t,e)};if(this._history){var a=[];a=1===n.length&&r.length>1?r.map((function(t){return n[0].has(t)?n[0].get(t):void 0})):n.map((function(t,e){var n=i._pathAt(r,e);return t.has(n)?t.get(n):void 0})),this._history.add({name:this._getHistoryActionName(r),redo:s,combine:this._historyCombine,undo:function(){i._setValueToObservers(n,r,a,!0)}})}s(),this.applyingChange=!1}}},{key:"_setValueToObservers",value:function(t,e,i,n){if(1===t.length&&e.length>1)for(var r=0;r<e.length;r++){var s=t[0].latest();if(s){var a=!1;s.history&&(a=s.history.enabled,s.history.enabled=!1);var o=e[r],l=i[r];void 0!==i?s.set(o,l):s.unset(o),a&&(s.history.enabled=!0)}}else for(var h=0;h<t.length;h++){var c=t[h].latest();if(c){var u=!1;c.history&&(u=c.history.enabled,c.history.enabled=!1);var d=this._pathAt(e,h),f=n?i[h]:i;void 0!==i?c.set(d,f):c.unset(d),u&&(c.history.enabled=!0)}}}},{key:"_addValues",value:function(t){var e=this;if(!this.applyingChange&&this._observers){this.applyingChange=!0;for(var i=this._observers.slice(),n=this._paths.slice(),r=[],s=function(s){var a=e._pathAt(n,s),o=i[s];t.forEach((function(t){-1===o.get(a).indexOf(t)&&r.push({observer:o,path:a,value:t})}))},a=0;a<i.length;a++)s(a);var o=function(){for(var t=0;t<r.length;t++){var e=r[t].observer.latest();if(e){var i=r[t].path,n=!1;e.history&&(n=e.history.enabled,e.history.enabled=!1),e.insert(i,r[t].value),n&&(e.history.enabled=!0)}}};this._history&&r.length&&this._history.add({name:this._getHistoryActionName(n),redo:o,combine:this._historyCombine,undo:function(){for(var t=0;t<r.length;t++){var e=r[t].observer.latest();if(e){var i=r[t].path,n=!1;e.history&&(n=e.history.enabled,e.history.enabled=!1),e.removeValue(i,r[t].value),n&&(e.history.enabled=!0)}}}}),o(),this.applyingChange=!1}}},{key:"_removeValues",value:function(t){var e=this;if(!this.applyingChange&&this._observers){this.applyingChange=!0;for(var i=this._observers.slice(),n=this._paths.slice(),r=[],s=function(s){var a=e._pathAt(n,s),o=i[s];t.forEach((function(t){var e=o.get(a).indexOf(t);-1!==e&&r.push({observer:o,path:a,value:t,index:e})}))},a=0;a<i.length;a++)s(a);var o=function(){for(var t=0;t<r.length;t++){var e=r[t].observer.latest();if(e){var i=r[t].path,n=!1;e.history&&(n=e.history.enabled,e.history.enabled=!1),e.removeValue(i,r[t].value),n&&(e.history.enabled=!0)}}};this._history&&r.length&&this._history.add({name:this._getHistoryActionName(n),redo:o,combine:this._historyCombine,undo:function(){for(var t=0;t<r.length;t++){var e=r[t].observer.latest();if(e){var i=r[t].path,n=!1;e.history&&(n=e.history.enabled,e.history.enabled=!1),-1===e.get(i).indexOf(r[t].value)&&e.insert(i,r[t].value,r[t].index),n&&(e.history.enabled=!0)}}}}),o(),this.applyingChange=!1}}},{key:"setValue",value:function(t){this._setValue(t,!1)}},{key:"setValues",value:function(t){t=t.slice().map((function(t){return Array.isArray(t)?t.slice():t})),this._setValue(t,!0)}},{key:"addValue",value:function(t){this._addValues([t])}},{key:"addValues",value:function(t){this._addValues(t)}},{key:"removeValue",value:function(t){this._removeValues([t])}},{key:"removeValues",value:function(t){this._removeValues(t)}}])&&g(e.prototype,i),n&&g(e,n),s}(f);function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t,e){if(null==t)return{};var i,n,r=function(t,e){if(null==t)return{};var i,n,r={},s=Object.keys(t);for(n=0;n<s.length;n++)i=s[n],e.indexOf(i)>=0||(r[i]=t[i]);return r}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function S(t,e,i){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=k(t);if(e){var r=k(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return P(this,i)}}function P(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?E(t):e}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(s,t);var e,i,n,r=T(s);function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.customUpdate,n=A(e,["customUpdate"]);return C(this,s),(t=r.call(this,n))._customUpdate=i,t._events=[],t._updateElementHandler=t._updateElement.bind(E(t)),t._updateTimeout=null,t}return e=s,(i=[{key:"_linkObserver",value:function(t,e){this._events.push(t.on(e+":set",this._deferUpdateElement.bind(this))),this._events.push(t.on(e+":unset",this._deferUpdateElement.bind(this))),this._events.push(t.on(e+":insert",this._deferUpdateElement.bind(this))),this._events.push(t.on(e+":remove",this._deferUpdateElement.bind(this)))}},{key:"_deferUpdateElement",value:function(){this.applyingChange||(this.applyingChange=!0,this._updateTimeout=setTimeout(this._updateElementHandler))}},{key:"_updateElement",value:function(){var t=this;this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=null),this._updateTimeout=null,this.applyingChange=!0,"function"==typeof this._customUpdate?this._customUpdate(this._element,this._observers,this._paths):1===this._observers.length?this._paths.length>1?this._element.value=this._paths.map((function(e){return t._observers[0].has(e)?t._observers[0].get(e):void 0})):this._element.value=this._observers[0].has(this._paths[0])?this._observers[0].get(this._paths[0]):void 0:this._element.values=this._observers.map((function(e,i){var n=t._pathAt(t._paths,i);return e.has(n)?e.get(n):void 0})),this.applyingChange=!1}},{key:"link",value:function(t,e){S(k(s.prototype),"link",this).call(this,t,e);var i=this._element.renderChanges;if(i&&(this._element.renderChanges=!1),this._updateElement(),i&&(this._element.renderChanges=i),1===this._observers.length&&this._paths.length>1)for(var n=0;n<this._paths.length;n++)this._linkObserver(this._observers[0],this._paths[n]);else for(var r=0;r<this._observers.length;r++)this._linkObserver(this._observers[r],this._pathAt(this._paths,r))}},{key:"unlink",value:function(){for(var t=0;t<this._events.length;t++)this._events[t].unbind();this._events.length=0,this._updateTimeout&&(clearTimeout(this._updateTimeout),this._updateTimeout=null),S(k(s.prototype),"unlink",this).call(this)}},{key:"clone",value:function(){return new s}}])&&I(e.prototype,i),n&&I(e,n),s}(f);function O(t){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function L(t,e,i,n){return(L="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,n){var r,s=B(t,e);if(s){if((r=Object.getOwnPropertyDescriptor(s,e)).set)return r.set.call(n,i),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(n,e)){if(!r.writable)return!1;r.value=i,Object.defineProperty(n,e,r)}else!function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(n,e,i);return!0})(t,e,i,n)}function N(t,e,i,n,r){if(!L(t,e,i,n||t)&&r)throw new Error("failed to set property");return i}function z(t,e,i){return(z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=B(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function B(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=U(t)););return t}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=U(t);if(e){var r=U(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return V(this,i)}}function V(t,e){return!e||"object"!==O(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function U(t){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var G=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(s,t);var e,i,n,r=j(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),t||(t={}),(e=r.call(this,t))._bindingElementToObservers=t.bindingElementToObservers||new x(t),e._bindingObserversToElement=t.bindingObserversToElement||new D(t),e._applyingChange=!1,e._bindingElementToObservers.on("applyingChange",(function(t){e.applyingChange=t})),e._bindingObserversToElement.on("applyingChange",(function(t){e.applyingChange=t})),e}return e=s,(i=[{key:"link",value:function(t,e){z(U(s.prototype),"link",this).call(this,t,e),this._bindingElementToObservers.link(t,e),this._bindingObserversToElement.link(t,e)}},{key:"unlink",value:function(){this._bindingElementToObservers.unlink(),this._bindingObserversToElement.unlink(),z(U(s.prototype),"unlink",this).call(this)}},{key:"clone",value:function(){return new s({bindingElementToObservers:this._bindingElementToObservers.clone(),bindingObserversToElement:this._bindingObserversToElement.clone()})}},{key:"setValue",value:function(t){this._bindingElementToObservers.setValue(t)}},{key:"setValues",value:function(t){this._bindingElementToObservers.setValues(t)}},{key:"addValue",value:function(t){this._bindingElementToObservers.addValue(t)}},{key:"addValues",value:function(t){this._bindingElementToObservers.addValues(t)}},{key:"removeValue",value:function(t){this._bindingElementToObservers.removeValue(t)}},{key:"removeValues",value:function(t){this._bindingElementToObservers.removeValues(t)}},{key:"element",get:function(){return this._element},set:function(t){this._element=t,this._bindingElementToObservers.element=t,this._bindingObserversToElement.element=t}},{key:"applyingChange",get:function(){return z(U(s.prototype),"applyingChange",this)},set:function(t){z(U(s.prototype),"applyingChange",this)!==t&&(this._bindingElementToObservers.applyingChange=t,this._bindingObserversToElement.applyingChange=t,N(U(s.prototype),"applyingChange",t,this,!0))}},{key:"historyCombine",get:function(){return this._bindingElementToObservers.historyCombine},set:function(t){this._bindingElementToObservers.historyCombine=t}},{key:"historyPrefix",get:function(){return this._bindingElementToObservers.historyPrefix},set:function(t){this._bindingElementToObservers.historyPrefix=t}},{key:"historyPostfix",get:function(){return this._bindingElementToObservers.historyPostfix},set:function(t){this._bindingElementToObservers.historyPostfix=t}}])&&R(e.prototype,i),n&&R(e,n),s}(f);function W(t){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function H(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function X(t,e){return(X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=q(t);if(e){var r=q(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Y(this,i)}}function Y(t,e){return!e||"object"!==W(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var K=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(s,t);var e,i,n,r=Z(s);function s(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(t=r.call(this))._actions=[],t._currentActionIndex=-1,t._canUndo=!1,t._canRedo=!1,t}return e=s,(i=[{key:"add",value:function(t){if(t.name)if(t.undo)if(t.redo){if(this._currentActionIndex!==this._actions.length-1&&(this._actions=this._actions.slice(0,this._currentActionIndex+1)),t.combine&&this.currentAction&&this.currentAction.name===t.name)this.currentAction.redo=t.redo;else{var e=this._actions.push(t);this._currentActionIndex=e-1}this.emit("add",t.name),this.canUndo=!0,this.canRedo=!1}else console.error("Trying to add history action without redo method",t.name);else console.error("Trying to add history action without undo method",t.name);else console.error("Trying to add history action without name")}},{key:"undo",value:function(){if(this.canUndo){var t=this.currentAction.name;try{this.currentAction.undo()}catch(t){return console.info("%c(pcui.History#undo)","color: #f00"),void console.log(t.stack)}this._currentActionIndex--,this.emit("undo",t),this._currentActionIndex<0&&(this.canUndo=!1),this.canRedo=!0}}},{key:"redo",value:function(){if(this.canRedo){this._currentActionIndex++;try{this.currentAction.redo()}catch(t){return console.info("%c(pcui.History#redo)","color: #f00"),void console.log(t.stack)}this.emit("redo",this.currentAction.name),this.canUndo=!0,this._currentActionIndex===this._actions.length-1&&(this.canRedo=!1)}}},{key:"clear",value:function(){this._actions.length&&(this._actions.length=0,this._currentActionIndex=-1,this.canUndo=!1,this.canRedo=!1)}},{key:"currentAction",get:function(){return this._actions[this._currentActionIndex]||null}},{key:"lastAction",get:function(){return this._actions[this._actions.length-1]||null}},{key:"canUndo",get:function(){return this._canUndo},set:function(t){this._canUndo!==t&&(this._canUndo=t,this.emit("canUndo",t))}},{key:"canRedo",get:function(){return this._canRedo},set:function(t){this._canRedo!==t&&(this._canRedo=t,this.emit("canRedo",t))}}])&&H(e.prototype,i),n&&H(e,n),s}(n.a);function J(t){n.a.call(this),t=t||{},this.item=t.item,this._history=t.history,this._enabled=t.enabled||!0,this._prefix=t.prefix||"",this._combine=t.combine||!1,this._events=[],this._initialize()}J.prototype=Object.create(n.a.prototype),J.prototype._initialize=function(){var t=this;this._events.push(this.item.on("*:set",(function(e,i,n){if(t._enabled&&t._history){i instanceof a&&(i=i.json());var r={name:t._prefix+e,combine:t._combine,undo:function(){var i=t.item.latest();i&&(i.history.enabled=!1,void 0===n?i.unset(e):i.set(e,n),i.history.enabled=!0)},redo:function(){var n=t.item.latest();n&&(n.history.enabled=!1,void 0===i?n.unset(e):n.set(e,i),n.history.enabled=!0)}};t._history.add(r)}}))),this._events.push(this.item.on("*:unset",(function(e,i){if(t._enabled&&t._history){var n={name:t._prefix+e,combine:t._combine,undo:function(){var n=t.item.latest();n&&(n.history.enabled=!1,n.set(e,i),n.history.enabled=!0)},redo:function(){var i=t.item.latest();i&&(i.history.enabled=!1,i.unset(e),i.history.enabled=!0)}};t._history.add(n)}}))),this._events.push(this.item.on("*:insert",(function(e,i,n){if(t._enabled&&t._history){var r={name:t._prefix+e,combine:t._combine,undo:function(){var n=t.item.latest();n&&(n.history.enabled=!1,n.removeValue(e,i),n.history.enabled=!0)},redo:function(){var r=t.item.latest();r&&(r.history.enabled=!1,r.insert(e,i,n),r.history.enabled=!0)}};t._history.add(r)}}))),this._events.push(this.item.on("*:remove",(function(e,i,n){if(t._enabled&&t._history){var r={name:t._prefix+e,combine:t._combine,undo:function(){var r=t.item.latest();r&&(r.history.enabled=!1,r.insert(e,i,n),r.history.enabled=!0)},redo:function(){var n=t.item.latest();n&&(n.history.enabled=!1,n.removeValue(e,i),n.history.enabled=!0)}};t._history.add(r)}}))),this._events.push(this.item.on("*:move",(function(e,i,n,r){if(t._enabled&&t._history){var s={name:t._prefix+e,combine:t._combine,undo:function(){var i=t.item.latest();i&&(i.history.enabled=!1,i.move(e,n,r),i.history.enabled=!0)},redo:function(){var i=t.item.latest();i&&(i.history.enabled=!1,i.move(e,r,n),i.history.enabled=!0)}};t._history.add(s)}})))},J.prototype.destroy=function(){this._events.forEach((function(t){t.unbind()})),this._events.length=0,this.item=null},Object.defineProperty(J.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=!!t}}),Object.defineProperty(J.prototype,"prefix",{get:function(){return this._prefix},set:function(t){this._prefix=t||""}}),Object.defineProperty(J.prototype,"combine",{get:function(){return this._combine},set:function(t){this._combine=!!t}});var Q=J;function $(t){n.a.call(this),t=t||{},this.data=[],this._indexed={},this.sorted=t.sorted||null,this.index=t.index||null}$.prototype=Object.create(n.a.prototype),Object.defineProperty($.prototype,"length",{get:function(){return this.data.length}}),$.prototype.get=function(t){return this.index?this._indexed[t]||null:this.data[t]||null},$.prototype.set=function(t,e){this.index?this._indexed[t]=e:this.data[t]=e},$.prototype.indexOf=function(t){if(this.index){var e=t instanceof a&&t.get(this.index)||t[this.index];return this._indexed[e]&&e||null}var i=this.data.indexOf(t);return-1!==i?i:null},$.prototype.position=function(t,e){var i,n,r=this.data,s=0,a=r.length-1;for(e=e||this.sorted;s<=a;)if(1===(n=e(r[i=Math.floor((s+a)/2)],t)))a=i-1;else{if(-1!==n)return i;s=i+1}return-1},$.prototype.positionNextClosest=function(t,e){var i,n,r,s=this.data,a=0,o=s.length-1;if(e=e||this.sorted,0===s.length)return-1;if(0===e(s[0],t))return 0;for(;a<=o;)if(1===(r=e(n=s[i=Math.floor((a+o)/2)],t)))o=i-1;else{if(-1!==r)return i;a=i+1}return 1===e(n,t)?i:i+1===s.length?-1:i+1},$.prototype.has=function(t){if(this.index){var e=t instanceof a&&t.get(this.index)||t[this.index];return!!this._indexed[e]}return-1!==this.data.indexOf(t)},$.prototype.add=function(t){if(this.has(t))return null;var e=this.data.length;this.index&&(e=t instanceof a&&t.get(this.index)||t[this.index],this._indexed[e]=t);var i=0;return this.sorted?-1!==(i=this.positionNextClosest(t))?this.data.splice(i,0,t):this.data.push(t):(this.data.push(t),i=this.data.length-1),this.emit("add",t,e,i),i},$.prototype.move=function(t,e){var i=this.data.indexOf(t);this.data.splice(i,1),-1===e?this.data.push(t):this.data.splice(e,0,t),this.emit("move",t,e)},$.prototype.remove=function(t){if(this.has(t)){var e=this.data.indexOf(t),i=e;this.index&&(i=t instanceof a&&t.get(this.index)||t[this.index],delete this._indexed[i]),this.data.splice(e,1),this.emit("remove",t,i)}},$.prototype.removeByKey=function(t){var e;if(this.index){if(!(e=this._indexed[t]))return;var i=this.data.indexOf(e);this.data.splice(i,1),delete this._indexed[t],this.emit("remove",e,i)}else{if(this.data.length<t)return;e=this.data[t],this.data.splice(t,1),this.emit("remove",e,t)}},$.prototype.removeBy=function(t){for(var e=this.data.length;e--;)t(this.data[e])&&(this.index&&delete this._indexed[this.data[e][this.index]],this.data.splice(e,1),this.emit("remove",this.data[e],e))},$.prototype.clear=function(){var t=this.data.slice(0);this.data=[],this._indexed={};for(var e=t.length;e--;)this.emit("remove",t[e],e)},$.prototype.forEach=function(t){for(var e=0;e<this.data.length;e++)t(this.data[e],this.index&&this.data[e][this.index]||e)},$.prototype.find=function(t){for(var e=[],i=0;i<this.data.length;i++)if(t(this.data[i])){var n=i;this.index&&(n=this.data[i][this.index]),e.push([n,this.data[i]])}return e},$.prototype.findOne=function(t){for(var e=0;e<this.data.length;e++)if(t(this.data[e])){var i=e;return this.index&&(i=this.data[e][this.index]),[i,this.data[e]]}return null},$.prototype.map=function(t){return this.data.map(t)},$.prototype.sort=function(t){this.data.sort(t)},$.prototype.array=function(){return this.data.slice(0)},$.prototype.json=function(){for(var t=this.array(),e=0;e<t.length;e++)t[e]instanceof a&&(t[e]=t[e].json());return t};var tt=$},6:function(t,e,i){"use strict";t.exports=i(29)},8:function(t,e,i){"use strict";function n(){Object.defineProperty(this,"_events",{enumerable:!1,configurable:!1,writable:!0,value:{}}),this._suspendEvents=!1,Object.defineProperty(this,"suspendEvents",{get:function(){return this._suspendEvents},set:function(t){this._suspendEvents=!!t}})}function r(t,e,i){this.owner=t,this.name=e,this.fn=i}n.prototype.on=function(t,e){var i=this._events[t];return void 0===i?this._events[t]=[e]:-1===i.indexOf(e)&&i.push(e),new r(this,t,e)},n.prototype.once=function(t,e){var i=this,n=this.on(t,(function(t,r,s,a,o,l,h,c){e.call(i,t,r,s,a,o,l,h,c),n.unbind()}));return n},n.prototype.emit=function(t,e,i,n,r,s,a,o,l){if(!this._suspendEvents){var h=this._events[t];if(!h)return this;h=h.slice(0);for(var c=0;c<h.length;c++)if(h[c])try{h[c].call(this,e,i,n,r,s,a,o,l)}catch(e){console.info("%c%s %c(event error)","color: #06f",t,"color: #f00"),console.log(e.stack)}return this}},n.prototype.unbind=function(t,e){if(t){var i=this._events[t];if(!i)return this;if(e){var n=i.indexOf(e);-1!==n&&(1===i.length?delete this._events[t]:i.splice(n,1))}else delete this._events[t]}else this._events={};return this},r.prototype.unbind=function(){this.owner&&(this.owner.unbind(this.name,this.fn),this.owner=null,this.name=null,this.fn=null)},r.prototype.call=function(){this.fn&&this.fn.call(this.owner,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7])},r.prototype.on=function(t,e){return this.owner.on(t,e)},e.a=n}})},"object"===a(e)&&"object"===a(t)?t.exports=s():(n=[],void 0===(r="function"==typeof(i=s)?i.apply(e,n):i)||(t.exports=r))}).call(this,i(4)(t))},function(t,e,i){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}(function(){var e,r,s,a,o,l,h,c,u,d,f,p,m,g,v={}.hasOwnProperty;e=i(18).SequenceMatcher,u=i(10).extendedTypeOf,s=i(27).colorize,f=function(t){return"object"!==n(t)||null===t},m=function(t,e,i){var n,r,s,a,o,l,h,u,d;for(r in null==i&&(i={}),o={},l=0,t)v.call(t,r)&&(u=t[r],r in e||(o[r+"__deleted"]=u,l-=30));for(r in e)v.call(e,r)&&(d=e[r],r in t||(o[r+"__added"]=d,l-=30));for(r in t)v.call(t,r)&&(u=t[r],r in e&&(l+=20,d=e[r],h=(s=c(u,d,i))[0],(n=s[1])&&(o[r]=n),l+=Math.min(20,Math.max(-10,h/5))));return 0===Object.keys(o).length?(l=(a=[100*Math.max(Object.keys(t).length,.5),void 0])[0],o=a[1]):l=Math.max(0,l),[l,o]},d=function(t,e,i){var n,r,s,a,o,h;for(a in n=null,o=0,i)v.call(i,a)&&(r=i[a],"__next"!==a&&(s=Math.abs(o-e),u(t)===u(r)&&(h=l(t,r),(!n||h>n.score||h===n.score&&s<n.indexDistance)&&(n={score:h,key:a,indexDistance:s})),o++));return n},g=function(t,e,i){var n,r,s,a,o,l,h;for(h=[],r=a=0,o=t.length;a<o;r=++a)s=t[r],f(s)?h.push(s):i&&(n=d(s,r,i))&&n.score>40&&null==e[n.key]?(e[n.key]=s,h.push(n.key)):(l="__$!SCALAR"+e.__next++,e[l]=s,h.push(l));return h},p=function(t,e){return"string"==typeof t&&t in e},a=function(t,e){return p(t,e)?e[t]:t},r=function(t,i,n){var r,s,l,h,c,u,d,f,m,v,_,y,b,x,w,A,C,I,S,M,T,P,E,k,D,O,R,L,N,z,B,F,j,V,U,G,W,H,X,Z;for(null==n&&(n={}),X=g(t,M={__next:1}),Z=g(i,T={__next:M.__next},M),W=[],H=0,r=!0,y=0,x=(S=new e(null,X,Z).getOpcodes()).length;y<x;y++)switch(I=(k=S[y])[0],h=k[1],c=k[2],v=k[3],_=k[4],"equal"===I||n.keysOnly&&"replace"===I||(r=!1),I){case"equal":for(l=b=D=h,N=c;D<=N?b<N:b>N;l=D<=N?++b:--b){if(u=X[l],p(u,M)){if(!p(u,T))throw new AssertionError("internal bug: isScalarized(item, originals1) != isScalarized(item, originals2) for item "+JSON.stringify(u));d=a(u,M),f=a(u,T),(s=o(d,f,n))?(W.push(["~",s]),r=!1):W.push([" "])}else W.push([" ",u]);H+=10}break;case"delete":for(l=w=z=h,B=c;z<=B?w<B:w>B;l=z<=B?++w:--w)W.push(["-",a(X[l],M)]),H-=5;break;case"insert":for(m=A=F=v,j=_;F<=j?A<j:A>j;m=F<=j?++A:--A)W.push(["+",a(Z[m],T)]),H-=5;break;case"replace":if(n.keysOnly)for(l=E=R=h,L=c;R<=L?E<L:E>L;l=R<=L?++E:--E)(s=o(a(X[l],M),a(Z[l-h+v],T),n))?(W.push(["~",s]),r=!1):W.push([" "]);else{for(l=C=V=h,U=c;V<=U?C<U:C>U;l=V<=U?++C:--C)W.push(["-",a(X[l],M)]),H-=5;for(m=P=G=v,O=_;G<=O?P<O:P>O;m=G<=O?++P:--P)W.push(["+",a(Z[m],T)]),H-=5}}return r||0===S.length?(W=void 0,H=100):H=Math.max(0,H),[H,W]},c=function(t,e,i){var n;if(null==i&&(i={}),(n=u(t))===u(e))switch(n){case"object":return m(t,e,i);case"array":return r(t,e,i)}return i.keysOnly?[100,void 0]:t!==e?[0,{__old:t,__new:e}]:[100,void 0]},o=function(t,e,i){var n;return null==i&&(i={}),(n=c(t,e,i))[0],n[1]},l=function(t,e,i){var n,r;return null==i&&(i={}),r=(n=c(t,e,i))[0],n[1],r},h=function(t,e,i,n){return null==n&&(n={}),s(o(t,e,n),i)},t.exports={diff:o,diffString:h}}).call(this)},function(t,e,i){t.exports=i(19)},function(t,e,i){(function(){var t,n,r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,A=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};h=Math.floor,u=Math.max,d=Math.min,n=i(20),o=i(22),_=function(t,e){return e?2*t/e:1},v=function(t,e){var i,n,r,s,a,o;for(a=[t.length,e.length],i=s=0,o=d(n=a[0],r=a[1]);0<=o?s<o:s>o;i=0<=o?++s:--s){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1}return n-r},w=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},g=function(t){var e,i;for(e=0,i=t.length;e<i;e++)if(t[e])return!0;return!1},a=function(){function t(t,e,i,n){this.isjunk=t,null==e&&(e=""),null==i&&(i=""),this.autojunk=null==n||n,this.a=this.b=null,this.setSeqs(e,i)}return t.name="SequenceMatcher",t.prototype.setSeqs=function(t,e){return this.setSeq1(t),this.setSeq2(e)},t.prototype.setSeq1=function(t){if(t!==this.a)return this.a=t,this.matchingBlocks=this.opcodes=null},t.prototype.setSeq2=function(t){if(t!==this.b)return this.b=t,this.matchingBlocks=this.opcodes=null,this.fullbcount=null,this._chainB()},t.prototype._chainB=function(){var t,e,i,n,r,s,a,o,l,c,u,d,f,p;for(t=this.b,this.b2j=e={},n=c=0,d=t.length;c<d;n=++c)i=t[n],(w(e,i)?e[i]:e[i]=[]).push(n);if(s={},r=this.isjunk)for(u=0,f=(p=Object.keys(e)).length;u<f;u++)r(i=p[u])&&(s[i]=!0,delete e[i]);if(l={},a=t.length,this.autojunk&&a>=200)for(i in o=h(a/100)+1,e)e[i].length>o&&(l[i]=!0,delete e[i]);return this.isbjunk=function(t){return w(s,t)},this.isbpopular=function(t){return w(l,t)}},t.prototype.findLongestMatch=function(t,e,i,n){var r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,A,C,I;for(r=(y=[this.a,this.b,this.b2j,this.isbjunk])[0],s=y[1],a=y[2],u=y[3],o=(b=[t,i,0])[0],l=b[1],h=b[2],f={},c=g=t;t<=e?g<e:g>e;c=t<=e?++g:--g){for(m={},v=0,_=(x=w(a,r[c])?a[r[c]]:[]).length;v<_;v++)if(!((d=x[v])<i)){if(d>=n)break;(p=m[d]=(f[d-1]||0)+1)>h&&(o=(A=[c-p+1,d-p+1,p])[0],l=A[1],h=A[2])}f=m}for(;o>t&&l>i&&!u(s[l-1])&&r[o-1]===s[l-1];)o=(C=[o-1,l-1,h+1])[0],l=C[1],h=C[2];for(;o+h<e&&l+h<n&&!u(s[l+h])&&r[o+h]===s[l+h];)h++;for(;o>t&&l>i&&u(s[l-1])&&r[o-1]===s[l-1];)o=(I=[o-1,l-1,h+1])[0],l=I[1],h=I[2];for(;o+h<e&&l+h<n&&u(s[l+h])&&r[o+h]===s[l+h];)h++;return[o,l,h]},t.prototype.getMatchingBlocks=function(){var t,e,i,n,r,s,a,o,l,h,c,u,d,f,p,m,g,_,y,b,x,w,A,C,I,S;if(this.matchingBlocks)return this.matchingBlocks;for(_=[[0,f=(w=[this.a.length,this.b.length])[0],0,p=w[1]]],m=[];_.length;)e=(A=_.pop())[0],t=A[1],n=A[2],i=A[3],r=(C=y=this.findLongestMatch(e,t,n,i))[0],o=C[1],(c=C[2])&&(m.push(y),e<r&&n<o&&_.push([e,r,n,o]),r+c<t&&o+c<i&&_.push([r+c,t,o+c,i]));for(m.sort(v),s=l=u=0,g=[],b=0,x=m.length;b<x;b++)a=(I=m[b])[0],h=I[1],d=I[2],s+u===a&&l+u===h?u+=d:(u&&g.push([s,l,u]),s=(S=[a,h,d])[0],l=S[1],u=S[2]);return u&&g.push([s,l,u]),g.push([f,p,0]),this.matchingBlocks=g},t.prototype.getOpcodes=function(){var t,e,i,n,r,s,a,o,l,h,c,u;if(this.opcodes)return this.opcodes;for(n=r=0,this.opcodes=e=[],o=0,l=(h=this.getMatchingBlocks()).length;o<l;o++)t=(c=h[o])[0],i=c[1],s=c[2],a="",n<t&&r<i?a="replace":n<t?a="delete":r<i&&(a="insert"),a&&e.push([a,n,t,r,i]),n=(u=[t+s,i+s])[0],r=u[1],s&&e.push(["equal",t,n,i,r]);return e},t.prototype.getGroupedOpcodes=function(t){var e,i,n,r,s,a,o,l,h,c,f,p,m,g,v;for(null==t&&(t=3),(e=this.getOpcodes()).length||(e=[["equal",0,1,0,1]]),"equal"===e[0][0]&&(h=(p=e[0])[0],r=p[1],s=p[2],a=p[3],o=p[4],e[0]=[h,u(r,s-t),s,u(a,o-t),o]),"equal"===e[e.length-1][0]&&(h=(m=e[e.length-1])[0],r=m[1],s=m[2],a=m[3],o=m[4],e[e.length-1]=[h,r,d(s,r+t),a,d(o,a+t)]),l=t+t,n=[],i=[],c=0,f=e.length;c<f;c++)h=(g=e[c])[0],r=g[1],s=g[2],a=g[3],o=g[4],"equal"===h&&s-r>l&&(i.push([h,r,d(s,r+t),a,d(o,a+t)]),n.push(i),i=[],r=(v=[u(r,s-t),u(a,o-t)])[0],a=v[1]),i.push([h,r,s,a,o]);return!i.length||1===i.length&&"equal"===i[0][0]||n.push(i),n},t.prototype.ratio=function(){var t,e,i,n;for(t=0,e=0,i=(n=this.getMatchingBlocks()).length;e<i;e++)t+=n[e][2];return _(t,this.a.length+this.b.length)},t.prototype.quickRatio=function(){var t,e,i,n,r,s,a,o,l,h,c;if(!this.fullbcount)for(this.fullbcount=i={},s=0,o=(h=this.b).length;s<o;s++)i[e=h[s]]=(i[e]||0)+1;for(i=this.fullbcount,t={},n=0,a=0,l=(c=this.a).length;a<l;a++)e=c[a],r=w(t,e)?t[e]:i[e]||0,t[e]=r-1,r>0&&n++;return _(n,this.a.length+this.b.length)},t.prototype.realQuickRatio=function(){var t,e,i;return i=[this.a.length,this.b.length],_(d(t=i[0],e=i[1]),t+e)},t}(),c=function(t,e,i,r){var s,o,l,h,c,u,d,f,p;if(null==i&&(i=3),null==r&&(r=.6),!(i>0))throw new Error("n must be > 0: ("+i+")");if(!(0<=r&&r<=1))throw new Error("cutoff must be in [0.0, 1.0]: ("+r+")");for(s=[],(o=new a).setSeq2(t),h=0,u=e.length;h<u;h++)l=e[h],o.setSeq1(l),o.realQuickRatio()>=r&&o.quickRatio()>=r&&o.ratio()>=r&&s.push([o.ratio(),l]);for(p=[],c=0,d=(s=n.nlargest(s,i,v)).length;c<d;c++)(f=s[c])[0],l=f[1],p.push(l);return p},y=function(t,e){var i,n,r;for(i=(r=[0,t.length])[0],n=r[1];i<n&&t[i]===e;)i++;return i},t=function(){function t(t,e){this.linejunk=t,this.charjunk=e}return t.name="Differ",t.prototype.compare=function(t,e){var i,n,r,s,o,l,h,c,u,d,f,p,m,g;for(h=[],u=0,f=(m=new a(this.linejunk,t,e).getOpcodes()).length;u<f;u++){switch(c=(g=m[u])[0],n=g[1],i=g[2],s=g[3],r=g[4],c){case"replace":o=this._fancyReplace(t,n,i,e,s,r);break;case"delete":o=this._dump("-",t,n,i);break;case"insert":o=this._dump("+",e,s,r);break;case"equal":o=this._dump(" ",t,n,i);break;default:throw new Error("unknow tag ("+c+")")}for(d=0,p=o.length;d<p;d++)l=o[d],h.push(l)}return h},t.prototype._dump=function(t,e,i,n){var r,s,a;for(a=[],r=s=i;i<=n?s<n:s>n;r=i<=n?++s:--s)a.push(t+" "+e[r]);return a},t.prototype._plainReplace=function(t,e,i,n,r,s){var a,l,h,c,u,d,f,p,m,g;for(o(e<i&&r<s),s-r<i-e?(a=this._dump("+",n,r,s),u=this._dump("-",t,e,i)):(a=this._dump("-",t,e,i),u=this._dump("+",n,r,s)),c=[],d=0,p=(g=[a,u]).length;d<p;d++)for(f=0,m=(l=g[d]).length;f<m;f++)h=l[f],c.push(h);return c},t.prototype._fancyReplace=function(t,e,i,n,r,s){var o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,A,C,I,S,M,T,P,E,k,D,O,R,L,N,z,B,F,j,V,U,G,W,H,X,Z,Y,q,K,J,Q,$,tt;for(f=(U=[.74,.75])[0],b=U[1],y=new a(this.charjunk),x=(G=[null,null])[0],w=G[1],T=[],C=E=r;r<=s?E<s:E>s;C=r<=s?++E:--E)for(g=n[C],y.setSeq2(g),A=k=e;e<=i?k<i:k>i;A=e<=i?++k:--k)(l=t[A])!==g?(y.setSeq1(l),y.realQuickRatio()>f&&y.quickRatio()>f&&y.ratio()>f&&(f=(Y=[y.ratio(),A,C])[0],p=Y[1],m=Y[2])):null===x&&(x=(Z=[A,C])[0],w=Z[1]);if(f<b){if(null===x){for(D=0,R=(q=this._plainReplace(t,e,i,n,r,s)).length;D<R;D++)M=q[D],T.push(M);return T}p=(K=[x,w,1])[0],m=K[1],f=K[2]}else x=null;for(O=0,L=(J=this._fancyHelper(t,e,p,n,r,m)).length;O<L;O++)M=J[O],T.push(M);if(o=(Q=[t[p],n[m]])[0],d=Q[1],null===x){for(u=_="",y.setSeqs(o,d),F=0,N=($=y.getOpcodes()).length;F<N;F++)switch(P=(tt=$[F])[0],h=tt[1],c=tt[2],v=tt[3],I=(W=[c-h,tt[4]-v])[0],S=W[1],P){case"replace":u+=Array(I+1).join("^"),_+=Array(S+1).join("^");break;case"delete":u+=Array(I+1).join("-");break;case"insert":_+=Array(S+1).join("+");break;case"equal":u+=Array(I+1).join(" "),_+=Array(S+1).join(" ");break;default:throw new Error("unknow tag ("+P+")")}for(j=0,z=(H=this._qformat(o,d,u,_)).length;j<z;j++)M=H[j],T.push(M)}else T.push("  "+o);for(V=0,B=(X=this._fancyHelper(t,p+1,i,n,m+1,s)).length;V<B;V++)M=X[V],T.push(M);return T},t.prototype._fancyHelper=function(t,e,i,n,r,s){var a;return a=[],e<i?a=r<s?this._fancyReplace(t,e,i,n,r,s):this._dump("-",t,e,i):r<s&&(a=this._dump("+",n,r,s)),a},t.prototype._qformat=function(t,e,i,n){var r,s;return s=[],r=d(y(t,"\t"),y(e,"\t")),r=d(r,y(i.slice(0,r)," ")),r=d(r,y(n.slice(0,r)," ")),i=i.slice(r).replace(/\s+$/,""),n=n.slice(r).replace(/\s+$/,""),s.push("- "+t),i.length&&s.push("? "+Array(r+1).join("\t")+i+"\n"),s.push("+ "+e),n.length&&s.push("? "+Array(r+1).join("\t")+n+"\n"),s},t}(),s=function(t,e){return null==e&&(e=/^\s*#?\s*$/),e.test(t)},r=function(t,e){return null==e&&(e=" \t"),A.call(e,t)>=0},x=function(t,e){var i,n;return i=t+1,1===(n=e-t)?""+i:(n||i--,i+","+n)},m=function(t,e,i){var n,r,s,o,l,h,c,u,d,f,p,m,g,v,_,y,b,w,A,C,I,S,M,T,P,E,k,D,O,R,L,N,z,B,F,j,V;for(null==(l=(L=null!=i?i:{}).fromfile)&&(l=""),null==(A=L.tofile)&&(A=""),null==(h=L.fromfiledate)&&(h=""),null==(C=L.tofiledate)&&(C=""),null==L.n&&3,null==(_=L.lineterm)&&(_="\n"),v=[],y=!1,I=0,P=(N=new a(null,t,e).getGroupedOpcodes()).length;I<P;I++)for(c=N[I],y||(y=!0,o=h?"\t"+h:"",w=C?"\t"+C:"",v.push("--- "+l+o+_),v.push("+++ "+A+w+_)),m=(z=[c[0],c[c.length-1]])[1],n=x((s=z[0])[1],m[2]),r=x(s[3],m[4]),v.push("@@ -"+n+" +"+r+" @@"+_),S=0,E=c.length;S<E;S++)if(b=(B=c[S])[0],u=B[1],d=B[2],f=B[3],p=B[4],"equal"!==b){if("replace"===b||"delete"===b)for(T=0,D=(j=t.slice(u,d)).length;T<D;T++)g=j[T],v.push("-"+g);if("replace"===b||"insert"===b)for(R=0,O=(V=e.slice(f,p)).length;R<O;R++)g=V[R],v.push("+"+g)}else for(M=0,k=(F=t.slice(u,d)).length;M<k;M++)g=F[M],v.push(" "+g);return v},b=function(t,e){var i,n;return i=t+1,(n=e-t)||i--,n<=1?""+i:i+","+(i+n-1)},l=function(t,e,i){var n,r,s,o,l,h,c,u,d,f,p,m,v,_,y,x,w,A,C,I,S,M,T,P,E,k,D,O,R,L,N,z,B,F,j,V,U,G;for(null==(l=(z=null!=i?i:{}).fromfile)&&(l=""),null==(I=z.tofile)&&(I=""),null==(h=z.fromfiledate)&&(h=""),null==(S=z.tofiledate)&&(S=""),null==z.n&&3,null==(y=z.lineterm)&&(y="\n"),x={insert:"+ ",delete:"- ",replace:"! ",equal:"  "},w=!1,_=[],M=0,k=(B=new a(null,t,e).getGroupedOpcodes()).length;M<k;M++)if(c=B[M],!w){if(w=!0,o=h?"\t"+h:"",C=S?"\t"+S:"",_.push("*** "+l+o+y),_.push("--- "+I+C+y),s=(F=[c[0],c[c.length-1]])[0],m=F[1],_.push("***************"+y),n=b(s[1],m[2]),_.push("*** "+n+" ****"+y),g(function(){var t,e,i,n;for(n=[],t=0,e=c.length;t<e;t++)i=c[t],A=i[0],i[1],i[2],i[3],i[4],n.push("replace"===A||"delete"===A);return n}()))for(T=0,D=c.length;T<D;T++)if(j=c[T],A=j[0],u=j[1],d=j[2],j[3],j[4],"insert"!==A)for(P=0,O=(V=t.slice(u,d)).length;P<O;P++)v=V[P],_.push(x[A]+v);if(r=b(s[3],m[4]),_.push("--- "+r+" ----"+y),g(function(){var t,e,i,n;for(n=[],t=0,e=c.length;t<e;t++)i=c[t],A=i[0],i[1],i[2],i[3],i[4],n.push("replace"===A||"insert"===A);return n}()))for(E=0,R=c.length;E<R;E++)if(U=c[E],A=U[0],U[1],U[2],f=U[3],p=U[4],"delete"!==A)for(N=0,L=(G=e.slice(f,p)).length;N<L;N++)v=G[N],_.push(x[A]+v)}return _},f=function(e,i,n,s){return null==s&&(s=r),new t(n,s).compare(e,i)},p=function(t,e){var i,n,r,s,a,o,l;if(!(s={1:"- ",2:"+ "}[e]))throw new Error("unknow delta choice (must be 1 or 2): "+e);for(r=["  ",s],n=[],a=0,o=t.length;a<o;a++)l=(i=t[a]).slice(0,2),A.call(r,l)>=0&&n.push(i.slice(2));return n},e._arrayCmp=v,e.SequenceMatcher=a,e.getCloseMatches=c,e._countLeading=y,e.Differ=t,e.IS_LINE_JUNK=s,e.IS_CHARACTER_JUNK=r,e._formatRangeUnified=x,e.unifiedDiff=m,e._formatRangeContext=b,e.contextDiff=l,e.ndiff=f,e.restore=p}).call(this)},function(t,e,i){t.exports=i(21)},function(t,e,i){var n,r,s;(function(){var i,a,o,l,h,c,u,d,f,p,m,g,v,_,y;o=Math.floor,p=Math.min,a=function(t,e){return t<e?-1:t>e?1:0},f=function(t,e,i,n,r){var s;if(null==i&&(i=0),null==r&&(r=a),i<0)throw new Error("lo must be non-negative");for(null==n&&(n=t.length);i<n;)r(e,t[s=o((i+n)/2)])<0?n=s:i=s+1;return[].splice.apply(t,[i,i-i].concat(e)),e},c=function(t,e,i){return null==i&&(i=a),t.push(e),_(t,0,t.length-1,i)},h=function(t,e){var i,n;return null==e&&(e=a),i=t.pop(),t.length?(n=t[0],t[0]=i,y(t,0,e)):n=i,n},d=function(t,e,i){var n;return null==i&&(i=a),n=t[0],t[0]=e,y(t,0,i),n},u=function(t,e,i){var n;return null==i&&(i=a),t.length&&i(t[0],e)<0&&(e=(n=[t[0],e])[0],t[0]=n[1],y(t,0,i)),e},l=function(t,e){var i,n,r,s,l,h;for(null==e&&(e=a),l=[],n=0,r=(s=function(){h=[];for(var e=0,i=o(t.length/2);0<=i?e<i:e>i;0<=i?e++:e--)h.push(e);return h}.apply(this).reverse()).length;n<r;n++)i=s[n],l.push(y(t,i,e));return l},v=function(t,e,i){var n;if(null==i&&(i=a),-1!==(n=t.indexOf(e)))return _(t,0,n,i),y(t,n,i)},m=function(t,e,i){var n,r,s,o,h;if(null==i&&(i=a),!(r=t.slice(0,e)).length)return r;for(l(r,i),s=0,o=(h=t.slice(e)).length;s<o;s++)n=h[s],u(r,n,i);return r.sort(i).reverse()},g=function(t,e,i){var n,r,s,o,c,u,d,m,g;if(null==i&&(i=a),10*e<=t.length){if(!(s=t.slice(0,e).sort(i)).length)return s;for(r=s[s.length-1],o=0,u=(d=t.slice(e)).length;o<u;o++)i(n=d[o],r)<0&&(f(s,n,0,null,i),s.pop(),r=s[s.length-1]);return s}for(l(t,i),g=[],c=0,m=p(e,t.length);0<=m?c<m:c>m;0<=m?++c:--c)g.push(h(t,i));return g},_=function(t,e,i,n){var r,s,o;for(null==n&&(n=a),r=t[i];i>e&&n(r,s=t[o=i-1>>1])<0;)t[i]=s,i=o;return t[i]=r},y=function(t,e,i){var n,r,s,o,l;for(null==i&&(i=a),r=t.length,l=e,s=t[e],n=2*e+1;n<r;)(o=n+1)<r&&!(i(t[n],t[o])<0)&&(n=o),t[e]=t[n],n=2*(e=n)+1;return t[e]=s,_(t,l,e,i)},i=function(){function t(t){this.cmp=null!=t?t:a,this.nodes=[]}return t.push=c,t.pop=h,t.replace=d,t.pushpop=u,t.heapify=l,t.updateItem=v,t.nlargest=m,t.nsmallest=g,t.prototype.push=function(t){return c(this.nodes,t,this.cmp)},t.prototype.pop=function(){return h(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return d(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return u(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return l(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return v(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return(e=new t).nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),r=[],void 0===(s="function"==typeof(n=function(){return i})?n.apply(e,r):n)||(t.exports=s)}).call(this)},function(t,e,i){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(t===e)return 0;for(var i=t.length,n=e.length,r=0,s=Math.min(i,n);r<s;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0}function s(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var a=i(23),o=Object.prototype.hasOwnProperty,l=Array.prototype.slice,h="foo"===function(){}.name;function c(t){return Object.prototype.toString.call(t)}function u(t){return!s(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var d=t.exports=_,f=/\s*function\s+([^\(\s]*)\s*/;function p(t){if(a.isFunction(t)){if(h)return t.name;var e=t.toString().match(f);return e&&e[1]}}function m(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function g(t){if(h||!a.isFunction(t))return a.inspect(t);var e=p(t);return"[Function"+(e?": "+e:"")+"]"}function v(t,e,i,n,r){throw new d.AssertionError({message:i,actual:t,expected:e,operator:n,stackStartFunction:r})}function _(t,e){t||v(t,!0,e,"==",d.ok)}function y(t,e,i,o){if(t===e)return!0;if(s(t)&&s(e))return 0===r(t,e);if(a.isDate(t)&&a.isDate(e))return t.getTime()===e.getTime();if(a.isRegExp(t)&&a.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"===n(t)||null!==e&&"object"===n(e)){if(u(t)&&u(e)&&c(t)===c(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===r(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(s(t)!==s(e))return!1;var h=(o=o||{actual:[],expected:[]}).actual.indexOf(t);return-1!==h&&h===o.expected.indexOf(e)||(o.actual.push(t),o.expected.push(e),function(t,e,i,n){if(null==t||null==e)return!1;if(a.isPrimitive(t)||a.isPrimitive(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var r=b(t),s=b(e);if(r&&!s||!r&&s)return!1;if(r)return t=l.call(t),e=l.call(e),y(t,e,i);var o,h,c=A(t),u=A(e);if(c.length!==u.length)return!1;for(c.sort(),u.sort(),h=c.length-1;h>=0;h--)if(c[h]!==u[h])return!1;for(h=c.length-1;h>=0;h--)if(o=c[h],!y(t[o],e[o],i,n))return!1;return!0}(t,e,i,o))}return i?t===e:t==e}function b(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function x(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function w(t,e,i,n){var r;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(n=i,i=null),r=function(t){var e;try{t()}catch(t){e=t}return e}(e),n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:"."),t&&!r&&v(r,i,"Missing expected exception"+n);var s="string"==typeof n,o=!t&&r&&!i;if((!t&&a.isError(r)&&s&&x(r,i)||o)&&v(r,i,"Got unwanted exception"+n),t&&r&&i&&!x(r,i)||!t&&r)throw r}d.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=function(t){return m(g(t.actual),128)+" "+t.operator+" "+m(g(t.expected),128)}(this),this.generatedMessage=!0);var e=t.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var i=new Error;if(i.stack){var n=i.stack,r=p(e),s=n.indexOf("\n"+r);if(s>=0){var a=n.indexOf("\n",s+1);n=n.substring(a+1)}this.stack=n}}},a.inherits(d.AssertionError,Error),d.fail=v,d.ok=_,d.equal=function(t,e,i){t!=e&&v(t,e,i,"==",d.equal)},d.notEqual=function(t,e,i){t==e&&v(t,e,i,"!=",d.notEqual)},d.deepEqual=function(t,e,i){y(t,e,!1)||v(t,e,i,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(t,e,i){y(t,e,!0)||v(t,e,i,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(t,e,i){y(t,e,!1)&&v(t,e,i,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function t(e,i,n){y(e,i,!0)&&v(e,i,n,"notDeepStrictEqual",t)},d.strictEqual=function(t,e,i){t!==e&&v(t,e,i,"===",d.strictEqual)},d.notStrictEqual=function(t,e,i){t===e&&v(t,e,i,"!==",d.notStrictEqual)},d.throws=function(t,e,i){w(!0,t,e,i)},d.doesNotThrow=function(t,e,i){w(!1,t,e,i)},d.ifError=function(t){if(t)throw t};var A=Object.keys||function(t){var e=[];for(var i in t)o.call(t,i)&&e.push(i);return e}}).call(this,i(5))},function(t,e,i){(function(t){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),i={},n=0;n<e.length;n++)i[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return i},s=/%[sdj%]/g;e.format=function(t){if(!_(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(l(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,r=n.length,a=String(t).replace(s,(function(t){if("%%"===t)return"%";if(i>=r)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}})),o=n[i];i<r;o=n[++i])g(o)||!x(o)?a+=" "+o:a+=" "+l(o);return a},e.deprecate=function(i,n){if(void 0!==t&&!0===t.noDeprecation)return i;if(void 0===t)return function(){return e.deprecate(i,n).apply(this,arguments)};var r=!1;return function(){if(!r){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),r=!0}return i.apply(this,arguments)}};var a,o={};function l(t,i){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),m(i)?n.showHidden=i:i&&e._extend(n,i),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=h),u(n,t,n.depth)}function h(t,e){var i=l.styles[e];return i?"["+l.colors[i][0]+"m"+t+"["+l.colors[i][1]+"m":t}function c(t,e){return t}function u(t,i,n){if(t.customInspect&&i&&C(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(n,t);return _(r)||(r=u(t,r,n)),r}var s=function(t,e){if(y(e))return t.stylize("undefined","undefined");if(_(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(v(e))return t.stylize(""+e,"number");if(m(e))return t.stylize(""+e,"boolean");if(g(e))return t.stylize("null","null")}(t,i);if(s)return s;var a=Object.keys(i),o=function(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(i)),A(i)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return d(i);if(0===a.length){if(C(i)){var l=i.name?": "+i.name:"";return t.stylize("[Function"+l+"]","special")}if(b(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(w(i))return t.stylize(Date.prototype.toString.call(i),"date");if(A(i))return d(i)}var h,c="",x=!1,I=["{","}"];(p(i)&&(x=!0,I=["[","]"]),C(i))&&(c=" [Function"+(i.name?": "+i.name:"")+"]");return b(i)&&(c=" "+RegExp.prototype.toString.call(i)),w(i)&&(c=" "+Date.prototype.toUTCString.call(i)),A(i)&&(c=" "+d(i)),0!==a.length||x&&0!=i.length?n<0?b(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),h=x?function(t,e,i,n,r){for(var s=[],a=0,o=e.length;a<o;++a)P(e,String(a))?s.push(f(t,e,i,n,String(a),!0)):s.push("");return r.forEach((function(r){r.match(/^\d+$/)||s.push(f(t,e,i,n,r,!0))})),s}(t,i,n,o,a):a.map((function(e){return f(t,i,n,o,e,x)})),t.seen.pop(),function(t,e,i){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(h,c,I)):I[0]+c+I[1]}function d(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,i,n,r,s){var a,o,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?o=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(o=t.stylize("[Setter]","special")),P(n,r)||(a="["+r+"]"),o||(t.seen.indexOf(l.value)<0?(o=g(i)?u(t,l.value,null):u(t,l.value,i-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+o.split("\n").map((function(t){return"   "+t})).join("\n")):o=t.stylize("[Circular]","special")),y(a)){if(s&&r.match(/^\d+$/))return o;(a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+o}function p(t){return Array.isArray(t)}function m(t){return"boolean"==typeof t}function g(t){return null===t}function v(t){return"number"==typeof t}function _(t){return"string"==typeof t}function y(t){return void 0===t}function b(t){return x(t)&&"[object RegExp]"===I(t)}function x(t){return"object"===n(t)&&null!==t}function w(t){return x(t)&&"[object Date]"===I(t)}function A(t){return x(t)&&("[object Error]"===I(t)||t instanceof Error)}function C(t){return"function"==typeof t}function I(t){return Object.prototype.toString.call(t)}function S(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(i){if(y(a)&&(a=t.env.NODE_DEBUG||""),i=i.toUpperCase(),!o[i])if(new RegExp("\\b"+i+"\\b","i").test(a)){var n=t.pid;o[i]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",i,n,t)}}else o[i]=function(){};return o[i]},e.inspect=l,l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=m,e.isNull=g,e.isNullOrUndefined=function(t){return null==t},e.isNumber=v,e.isString=_,e.isSymbol=function(t){return"symbol"===n(t)},e.isUndefined=y,e.isRegExp=b,e.isObject=x,e.isDate=w,e.isError=A,e.isFunction=C,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"===n(t)||void 0===t},e.isBuffer=i(25);var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var t=new Date,e=[S(t.getHours()),S(t.getMinutes()),S(t.getSeconds())].join(":");return[t.getDate(),M[t.getMonth()],e].join(" ")}function P(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",T(),e.format.apply(e,arguments))},e.inherits=i(26),e._extend=function(t,e){if(!e||!x(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t};var E="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function k(t,e){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(E&&t[E]){var e;if("function"!=typeof(e=t[E]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,i,n=new Promise((function(t,n){e=t,i=n})),r=[],s=0;s<arguments.length;s++)r.push(arguments[s]);r.push((function(t,n){t?i(t):e(n)}));try{t.apply(this,r)}catch(t){i(t)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),E&&Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,r(t))},e.promisify.custom=E,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function i(){for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n]);var r=i.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var s=this,a=function(){return r.apply(s,arguments)};e.apply(this,i).then((function(e){t.nextTick(a,null,e)}),(function(e){t.nextTick(k,e,a)}))}return Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.defineProperties(i,r(e)),i}}).call(this,i(24))},function(t,e){var i,n,r=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var l,h=[],c=!1,u=-1;function d(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&f())}function f(){if(!c){var t=o(d);c=!0;for(var e=h.length;e;){for(l=h,h=[];++u<e;)l&&l[u].run();u=-1,e=h.length}l=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new p(t,e)),1!==h.length||c||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t){return t&&"object"===i(t)&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){(function(){var e,n,r,s,a,o,l,h={}.hasOwnProperty;n=i(28),o=i(10).extendedTypeOf,e={" ":function(t){return t},"+":n.green,"-":n.red},l=function(t,e,i,n,r){var s,a,c,u,d,f,p,m,g,v,_,y,b,x,w,A;switch(_=t?t+": ":"",x=r+"  ",o(e)){case"object":if("__old"in e&&"__new"in e&&2===Object.keys(e).length)return l(t,e.__old,i,"-",r),l(t,e.__new,i,"+",r);for(w in i(n,""+r+_+"{"),e)h.call(e,w)&&(A=e[w],(g=w.match(/^(.*)__deleted$/))?l(g[1],A,i,"-",x):(g=w.match(/^(.*)__added$/))?l(g[1],A,i,"+",x):l(w,A,i,n,x));return i(n,r+"}");case"array":for(i(n,""+r+_+"["),m=!0,s=0,d=e.length;s<d;s++)a=e[s],("array"!==o(a)||2!==a.length&&(1!==a.length||" "!==a[0])||"string"!=typeof a[0]||1!==a[0].length||" "!==(y=a[0])&&"-"!==y&&"+"!==y&&"~"!==y)&&(m=!1);if(m)for(c=0,f=e.length;c<f;c++)if(v=(b=e[c])[0],A=b[1]," "===v&&null==A)i(" ",x+"...");else{if(" "!==v&&"~"!==v&&"+"!==v&&"-"!==v)throw new Error("Unexpected op '"+v+"' in "+JSON.stringify(e,null,2));"~"===v&&(v=" "),l("",A,i,v,x)}else for(u=0,p=e.length;u<p;u++)A=e[u],l("",A,i,n,x);return i(n,r+"]");default:if(0===e||null===e||!1===e||e)return i(n,r+_+JSON.stringify(e))}},a=function(t,e){return l("",t,e," ","")},s=function(t){var e;return e=[],a(t,(function(t,i){return e.push(""+t+i)})),e},r=function(t,i){var n;return null==i&&(i={}),n=[],a(t,(function(t,r){var s,a,o;return null==(s=i.color)||s?n.push((null!=(a=null!=(o=i.theme)?o[t]:void 0)?a:e[t])(""+t+r)+"\n"):n.push(""+t+r+"\n")})),n.join("")},t.exports={colorize:r,colorizeToArray:s,colorizeToCallback:a}}).call(this)},function(t,e,i){"use strict";var n,r,s,a,o=Object.defineProperties,l=i(29);n=function(t,e){return"["+t[0]+"m"+(e||"")+"["+t[1]+"m"},r={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],strike:[9,29]},["black","red","green","yellow","blue","magenta","cyan","white"].forEach((function(t,e){r[t]=[30+e,39],r["bg"+t[0].toUpperCase()+t.slice(1)]=[40+e,49]})),r.gray=[90,39],(s=l(r,(function(t){return{get:function(){return this.style.push(t),this},enumerable:!0}}))).bright={get:function(){return this._bright=!0,this},enumerable:!0},s.bgBright={get:function(){return this._bgBright=!0,this},enumerable:!0},a=function(){var t=o((function t(e){return t.style.reduce((function(e,i){return(t._bright&&i[0]>=30&&i[0]<38||t._bgBright&&i[0]>=40&&i[0]<48)&&(i=[i[0]+60,i[1]]),n(i,e)}),e)}),s);return t.style=[],t[this]},t.exports=o((function(t){return t}),l(s,(function(t,e){return{get:a.bind(e),enumerable:!0}})))},function(t,e,i){"use strict";var n=i(30);t.exports=function(t,e){var i={};return n(t,(function(n,r){i[r]=e.call(this,n,r,t)}),arguments[2]),i}},function(t,e,i){"use strict";t.exports=i(31)("forEach")},function(t,e,i){"use strict";var n=Function.prototype.call,r=Object.keys,s=i(11),a=i(32),o=i(33);t.exports=function(t){return function(e,i){var l,h=arguments[2],c=arguments[3];return o(e),a(i),l=r(e),c&&l.sort(s(c)?c:void 0),l[t]((function(t,r){return n.call(i,h,e[t],t,e,r)}))}}},function(t,e,i){"use strict";var n=i(11);t.exports=function(t){if(!n(t))throw new TypeError(t+" is not a function");return t}},function(t,e,i){"use strict";t.exports=function(t){if(null==t)throw new TypeError("Cannot use null or undefined");return t}},function(t,e,i){(e=i(6)(!1)).push([t.i,"/*! JointJS v3.2.0 (2020-06-04) - JavaScript diagramming library\n\n\nThis Source Code Form is subject to the terms of the Mozilla Public\nLicense, v. 2.0. If a copy of the MPL was not distributed with this\nfile, You can obtain one at http://mozilla.org/MPL/2.0/.\n*/\n/*\nA complete list of SVG properties that can be set through CSS is here:\nhttp://www.w3.org/TR/SVG/styling.html\n\nImportant note: Presentation attributes have a lower precedence over CSS style rules.\n*/\n\n\n/* .viewport is a <g> node wrapping all diagram elements in the paper */\n.joint-viewport {\n   -webkit-user-select: none;\n   -moz-user-select: none;\n   user-select: none;\n}\n\n.joint-paper > svg,\n.joint-paper-background,\n.joint-paper-grid {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n\n/*\n1. IE can't handle paths without the `d` attribute for bounding box calculation\n2. IE can't even handle 'd' attribute as a css selector (e.g path[d]) so the following rule will\n   break the links rendering.\n\npath:not([d]) {\n    display: none;\n}\n\n*/\n\n\n/* magnet is an element that can be either source or a target of a link */\n[magnet=true]:not(.joint-element) {\n   cursor: crosshair;\n}\n[magnet=true]:not(.joint-element):hover {\n   opacity: .7;\n}\n\n/*\n\nElements have CSS classes named by their types. E.g. type: basic.Rect has a CSS class \"element basic Rect\".\nThis makes it possible to easilly style elements in CSS and have generic CSS rules applying to\nthe whole group of elements. Each plugin can provide its own stylesheet.\n\n*/\n\n.joint-element {\n   /* Give the user a hint that he can drag&drop the element. */\n   cursor: move;\n}\n\n.joint-element * {\n   user-drag: none;\n}\n\n.joint-element .scalable * {\n   /* The default behavior when scaling an element is not to scale the stroke in order to prevent the ugly effect of stroke with different proportions. */\n   vector-effect: non-scaling-stroke;\n}\n/*\n\nconnection-wrap is a <path> element of the joint.dia.Link that follows the .connection <path> of that link.\nIn other words, the `d` attribute of the .connection-wrap contains the same data as the `d` attribute of the\n.connection <path>. The advantage of using .connection-wrap is to be able to catch pointer events\nin the neighborhood of the .connection <path>. This is especially handy if the .connection <path> is\nvery thin.\n\n*/\n\n.marker-source,\n.marker-target {\n   /* This makes the arrowheads point to the border of objects even though the transform: scale() is applied on them. */\n   vector-effect: non-scaling-stroke;\n}\n\n/* Paper */\n.joint-paper {\n    position: relative;\n}\n/* Paper */\n\n/*  Highlighting  */\n.joint-highlight-opacity {\n    opacity: 0.3;\n}\n/*  Highlighting  */\n\n/*\n\nVertex markers are `<circle>` elements that appear at connection vertex positions.\n\n*/\n\n.joint-link .connection-wrap,\n.joint-link .connection {\n   fill: none;\n}\n\n/* <g> element wrapping .marker-vertex-group. */\n.marker-vertices {\n   opacity: 0;\n   cursor: move;\n}\n.marker-arrowheads {\n   opacity: 0;\n   cursor: move;\n   cursor: -webkit-grab;\n   cursor: -moz-grab;\n/*   display: none;   */   /* setting `display: none` on .marker-arrowheads effectivelly switches of links reconnecting */\n}\n.link-tools {\n   opacity: 0;\n   cursor: pointer;\n}\n.link-tools .tool-options {\n   display: none;       /* by default, we don't display link options tool */\n}\n.joint-link:hover .marker-vertices,\n.joint-link:hover .marker-arrowheads,\n.joint-link:hover .link-tools {\n   opacity: 1;\n}\n\n/* <circle> element used to remove a vertex */\n.marker-vertex-remove {\n   cursor: pointer;\n   opacity: .1;\n}\n\n.marker-vertex-group:hover .marker-vertex-remove {\n   opacity: 1;\n}\n\n.marker-vertex-remove-area {\n   opacity: .1;\n   cursor: pointer;\n}\n.marker-vertex-group:hover .marker-vertex-remove-area {\n   opacity: 1;\n}\n\n/*\nExample of custom changes (in pure CSS only!):\n\nDo not show marker vertices at all:  .marker-vertices { display: none; }\nDo not allow adding new vertices: .connection-wrap { pointer-events: none; }\n*/\n\n/* foreignObject inside the elements (i.e joint.shapes.basic.TextBlock) */\n.joint-element .fobj {\n    overflow: hidden;\n}\n.joint-element .fobj body {\n    background-color: transparent;\n    margin: 0px;\n    position: static;\n}\n.joint-element .fobj div {\n    text-align: center;\n    vertical-align: middle;\n    display: table-cell;\n    padding: 0px 5px 0px 5px;\n}\n\n/* Paper */\n.joint-paper.joint-theme-dark {\n    background-color: #18191b;\n}\n/* Paper */\n\n/*  Links  */\n.joint-link.joint-theme-dark .connection-wrap {\n    stroke: #8F8FF3;\n    stroke-width: 15;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    opacity: 0;\n    cursor: move;\n}\n.joint-link.joint-theme-dark .connection-wrap:hover {\n    opacity: .4;\n    stroke-opacity: .4;\n}\n.joint-link.joint-theme-dark .connection {\n    stroke-linejoin: round;\n}\n.joint-link.joint-theme-dark .link-tools .tool-remove circle {\n    fill: #F33636;\n}\n.joint-link.joint-theme-dark .link-tools .tool-remove path {\n    fill: white;\n}\n.joint-link.joint-theme-dark .link-tools [event=\"link:options\"] circle {\n    fill: green;\n}\n/* <circle> element inside .marker-vertex-group <g> element */\n.joint-link.joint-theme-dark .marker-vertex {\n    fill: #5652DB;\n}\n.joint-link.joint-theme-dark .marker-vertex:hover {\n    fill: #8E8CE1;\n    stroke: none;\n}\n.joint-link.joint-theme-dark .marker-arrowhead {\n    fill: #5652DB;\n}\n.joint-link.joint-theme-dark .marker-arrowhead:hover {\n    fill: #8E8CE1;\n    stroke: none;\n}\n/* <circle> element used to remove a vertex */\n.joint-link.joint-theme-dark .marker-vertex-remove-area {\n    fill: green;\n    stroke: darkgreen;\n}\n.joint-link.joint-theme-dark .marker-vertex-remove {\n    fill: white;\n    stroke: white;\n}\n/*  Links  */\n/* Paper */\n.joint-paper.joint-theme-default {\n    background-color: #FFFFFF;\n}\n/* Paper */\n\n/*  Links  */\n.joint-link.joint-theme-default .connection-wrap {\n    stroke: #000000;\n    stroke-width: 15;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    opacity: 0;\n    cursor: move;\n}\n.joint-link.joint-theme-default .connection-wrap:hover {\n    opacity: .4;\n    stroke-opacity: .4;\n}\n.joint-link.joint-theme-default .connection {\n    stroke-linejoin: round;\n}\n.joint-link.joint-theme-default .link-tools .tool-remove circle {\n    fill: #FF0000;\n}\n.joint-link.joint-theme-default .link-tools .tool-remove path {\n    fill: #FFFFFF;\n}\n\n/* <circle> element inside .marker-vertex-group <g> element */\n.joint-link.joint-theme-default .marker-vertex {\n    fill: #1ABC9C;\n}\n.joint-link.joint-theme-default .marker-vertex:hover {\n    fill: #34495E;\n    stroke: none;\n}\n\n.joint-link.joint-theme-default .marker-arrowhead {\n    fill: #1ABC9C;\n}\n.joint-link.joint-theme-default .marker-arrowhead:hover {\n    fill: #F39C12;\n    stroke: none;\n}\n\n/* <circle> element used to remove a vertex */\n.joint-link.joint-theme-default .marker-vertex-remove {\n    fill: #FFFFFF;\n}\n/*  Links  */\n\n@font-face {\n    font-family: 'lato-light';\n    src: url(data:application/font-woff;charset=utf-8;base64,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) format('woff');\n    font-weight: normal;\n    font-style: normal;\n}\n\n/*  Links  */\n.joint-link.joint-theme-material .connection-wrap {\n    stroke: #000000;\n    stroke-width: 15;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    opacity: 0;\n    cursor: move;\n}\n.joint-link.joint-theme-material .connection-wrap:hover {\n    opacity: .4;\n    stroke-opacity: .4;\n}\n.joint-link.joint-theme-material .connection {\n    stroke-linejoin: round;\n}\n.joint-link.joint-theme-material .link-tools .tool-remove circle {\n    fill: #C64242;\n}\n.joint-link.joint-theme-material .link-tools .tool-remove path {\n    fill: #FFFFFF;\n}\n\n/* <circle> element inside .marker-vertex-group <g> element */\n.joint-link.joint-theme-material .marker-vertex {\n    fill: #d0d8e8;\n}\n.joint-link.joint-theme-material .marker-vertex:hover {\n    fill: #5fa9ee;\n    stroke: none;\n}\n\n.joint-link.joint-theme-material .marker-arrowhead {\n    fill: #d0d8e8;\n}\n.joint-link.joint-theme-material .marker-arrowhead:hover {\n    fill: #5fa9ee;\n    stroke: none;\n}\n\n/* <circle> element used to remove a vertex */\n.joint-link.joint-theme-material .marker-vertex-remove-area {\n    fill: #5fa9ee;\n}\n.joint-link.joint-theme-material .marker-vertex-remove {\n    fill: white;\n}\n/*  Links  */\n\n/*  Links  */\n.joint-link.joint-theme-modern .connection-wrap {\n    stroke: #000000;\n    stroke-width: 15;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    opacity: 0;\n    cursor: move;\n}\n.joint-link.joint-theme-modern .connection-wrap:hover {\n    opacity: .4;\n    stroke-opacity: .4;\n}\n.joint-link.joint-theme-modern .connection {\n    stroke-linejoin: round;\n}\n.joint-link.joint-theme-modern .link-tools .tool-remove circle {\n    fill: #FF0000;\n}\n.joint-link.joint-theme-modern .link-tools .tool-remove path {\n    fill: #FFFFFF;\n}\n\n/* <circle> element inside .marker-vertex-group <g> element */\n.joint-link.joint-theme-modern .marker-vertex {\n    fill: #1ABC9C;\n}\n.joint-link.joint-theme-modern .marker-vertex:hover {\n    fill: #34495E;\n    stroke: none;\n}\n\n.joint-link.joint-theme-modern .marker-arrowhead {\n    fill: #1ABC9C;\n}\n.joint-link.joint-theme-modern .marker-arrowhead:hover {\n    fill: #F39C12;\n    stroke: none;\n}\n\n/* <circle> element used to remove a vertex */\n.joint-link.joint-theme-modern .marker-vertex-remove {\n    fill: white;\n}\n/*  Links  */\n",""]),t.exports=e},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var r,s=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?t:(r=0===s.indexOf("//")?s:0===s.indexOf("/")?i+s:n+s.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")}))}},function(t,e,i){(e=i(6)(!1)).push([t.i,"/*\nA complete list of SVG properties that can be set through CSS is here:\nhttp://www.w3.org/TR/SVG/styling.html\n\nImportant note: Presentation attributes have a lower precedence over CSS style rules.\n*/\n\n\n/* .viewport is a <g> node wrapping all diagram elements in the paper */\n.joint-viewport {\n   -webkit-user-select: none;\n   -moz-user-select: none;\n   user-select: none;\n}\n\n.joint-paper > svg,\n.joint-paper-background,\n.joint-paper-grid {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n}\n\n/*\n1. IE can't handle paths without the `d` attribute for bounding box calculation\n2. IE can't even handle 'd' attribute as a css selector (e.g path[d]) so the following rule will\n   break the links rendering.\n\npath:not([d]) {\n    display: none;\n}\n\n*/\n\n\n/* magnet is an element that can be either source or a target of a link */\n[magnet=true]:not(.joint-element) {\n   cursor: crosshair;\n}\n[magnet=true]:not(.joint-element):hover {\n   opacity: .7;\n}\n\n/*\n\nElements have CSS classes named by their types. E.g. type: basic.Rect has a CSS class \"element basic Rect\".\nThis makes it possible to easilly style elements in CSS and have generic CSS rules applying to\nthe whole group of elements. Each plugin can provide its own stylesheet.\n\n*/\n\n.joint-element {\n   /* Give the user a hint that he can drag&drop the element. */\n   cursor: move;\n}\n\n.joint-element * {\n   user-drag: none;\n}\n\n.joint-element .scalable * {\n   /* The default behavior when scaling an element is not to scale the stroke in order to prevent the ugly effect of stroke with different proportions. */\n   vector-effect: non-scaling-stroke;\n}\n/*\n\nconnection-wrap is a <path> element of the joint.dia.Link that follows the .connection <path> of that link.\nIn other words, the `d` attribute of the .connection-wrap contains the same data as the `d` attribute of the\n.connection <path>. The advantage of using .connection-wrap is to be able to catch pointer events\nin the neighborhood of the .connection <path>. This is especially handy if the .connection <path> is\nvery thin.\n\n*/\n\n.marker-source,\n.marker-target {\n   /* This makes the arrowheads point to the border of objects even though the transform: scale() is applied on them. */\n   vector-effect: non-scaling-stroke;\n}\n\n/* Paper */\n.joint-paper {\n    position: relative;\n}\n/* Paper */\n\n/*  Highlighting  */\n.joint-highlight-opacity {\n    opacity: 0.3;\n}\n/*  Highlighting  */\n\n/*\n\nVertex markers are `<circle>` elements that appear at connection vertex positions.\n\n*/\n\n.joint-link .connection-wrap,\n.joint-link .connection {\n   fill: none;\n}\n\n/* <g> element wrapping .marker-vertex-group. */\n.marker-vertices {\n   opacity: 0;\n   cursor: move;\n}\n.marker-arrowheads {\n   opacity: 0;\n   cursor: move;\n   cursor: -webkit-grab;\n   cursor: -moz-grab;\n/*   display: none;   */   /* setting `display: none` on .marker-arrowheads effectivelly switches of links reconnecting */\n}\n.link-tools {\n   opacity: 0;\n   cursor: pointer;\n}\n.link-tools .tool-options {\n   display: none;       /* by default, we don't display link options tool */\n}\n.joint-link:hover .marker-vertices,\n.joint-link:hover .marker-arrowheads,\n.joint-link:hover .link-tools {\n   opacity: 1;\n}\n\n/* <circle> element used to remove a vertex */\n.marker-vertex-remove {\n   cursor: pointer;\n   opacity: .1;\n}\n\n.marker-vertex-group:hover .marker-vertex-remove {\n   opacity: 1;\n}\n\n.marker-vertex-remove-area {\n   opacity: .1;\n   cursor: pointer;\n}\n.marker-vertex-group:hover .marker-vertex-remove-area {\n   opacity: 1;\n}\n\n/*\nExample of custom changes (in pure CSS only!):\n\nDo not show marker vertices at all:  .marker-vertices { display: none; }\nDo not allow adding new vertices: .connection-wrap { pointer-events: none; }\n*/\n\n/* foreignObject inside the elements (i.e joint.shapes.basic.TextBlock) */\n.joint-element .fobj {\n    overflow: hidden;\n}\n.joint-element .fobj body {\n    background-color: transparent;\n    margin: 0px;\n    position: static;\n}\n.joint-element .fobj div {\n    text-align: center;\n    vertical-align: middle;\n    display: table-cell;\n    padding: 0px 5px 0px 5px;\n}\n",""]),t.exports=e},function(t,e,i){(e=i(6)(!1)).push([t.i,"@font-face {\n    font-family: 'lato-light';\n    src: url(data:application/font-woff;charset=utf-8;base64,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) format('woff');\n    font-weight: normal;\n    font-style: normal;\n}\n\n/*  Links  */\n.joint-link.joint-theme-material .connection-wrap {\n    stroke: #000000;\n    stroke-width: 15;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    opacity: 0;\n    cursor: move;\n}\n.joint-link.joint-theme-material .connection-wrap:hover {\n    opacity: .4;\n    stroke-opacity: .4;\n}\n.joint-link.joint-theme-material .connection {\n    stroke-linejoin: round;\n}\n.joint-link.joint-theme-material .link-tools .tool-remove circle {\n    fill: #C64242;\n}\n.joint-link.joint-theme-material .link-tools .tool-remove path {\n    fill: #FFFFFF;\n}\n\n/* <circle> element inside .marker-vertex-group <g> element */\n.joint-link.joint-theme-material .marker-vertex {\n    fill: #d0d8e8;\n}\n.joint-link.joint-theme-material .marker-vertex:hover {\n    fill: #5fa9ee;\n    stroke: none;\n}\n\n.joint-link.joint-theme-material .marker-arrowhead {\n    fill: #d0d8e8;\n}\n.joint-link.joint-theme-material .marker-arrowhead:hover {\n    fill: #5fa9ee;\n    stroke: none;\n}\n\n/* <circle> element used to remove a vertex */\n.joint-link.joint-theme-material .marker-vertex-remove-area {\n    fill: #5fa9ee;\n}\n.joint-link.joint-theme-material .marker-vertex-remove {\n    fill: white;\n}\n/*  Links  */\n",""]),t.exports=e},function(t,e,i){t.exports=i(39)()},function(t,e,i){"use strict";var n=i(40);function r(){}function s(){}s.resetWarningCache=r,t.exports=function(){function t(t,e,i,r,s,a){if(a!==n){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function e(){return t}t.isRequired=t;var i={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:s,resetWarningCache:r};return i.PropTypes=i,i}},function(t,e,i){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,e,i){var n=i(42);"string"==typeof n&&(n=[[t.i,n,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};i(7)(n,r);n.locals&&(t.exports=n.locals)},function(t,e,i){(e=i(6)(!1)).push([t.i,".pcui-graph{width:100%;height:100%}.available-magnet{fill:greenyellow}#paper-html-elements{position:relative;border:1px solid gray;display:inline-block;background:transparent;overflow:hidden}#paper-html-elements svg{background:transparent}#paper-html-elements svg .link{z-index:2}.html-element{position:absolute;background:#3498DB;pointer-events:none;-webkit-user-select:none;border-radius:4px;border:2px solid #2980B9;box-shadow:inset 0 0 5px black, 2px 2px 1px gray;padding:5px;box-sizing:border-box;z-index:2}.html-element select,.html-element input,.html-element button{pointer-events:auto}.html-element button.delete{color:white;border:none;background-color:#C0392B;border-radius:20px;width:15px;height:15px;line-height:15px;text-align:middle;position:absolute;top:-15px;left:-15px;padding:0;margin:0;font-weight:bold;cursor:pointer}.html-element button.delete:hover{width:20px;height:20px;line-height:20px}.html-element select{position:absolute;right:2px;bottom:28px}.html-element input{position:absolute;bottom:0;left:0;right:0;border:none;color:#333;padding:5px;height:16px}.html-element label{color:#333;text-shadow:1px 0 0 lightgray;font-weight:bold}.html-element span{position:absolute;top:2px;right:9px;color:white;font-size:10px}.graph-node-div{pointer-events:none}.graph-node-input{pointer-events:all}.graph-node-input-no-pointer-events{pointer-events:none}.graph-node-container{margin-top:5px;margin-bottom:5px;height:28px;display:flex;align-items:center;pointer-events:inherit}.graph-node-label{max-width:50px;min-width:50px;font-size:12px;margin-left:13px}.port-inner-body{pointer-events:none}.pcui-contextmenu-parent,.pcui-contextmenu-child{height:27px}\n",""]),t.exports=e},,function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return Ii})),i.d(e,"VERSION",(function(){return r.e})),i.d(e,"restArguments",(function(){return s})),i.d(e,"isObject",(function(){return o})),i.d(e,"isNull",(function(){return l})),i.d(e,"isUndefined",(function(){return h})),i.d(e,"isBoolean",(function(){return c})),i.d(e,"isElement",(function(){return u})),i.d(e,"isString",(function(){return f})),i.d(e,"isNumber",(function(){return p})),i.d(e,"isDate",(function(){return m})),i.d(e,"isRegExp",(function(){return g})),i.d(e,"isError",(function(){return v})),i.d(e,"isSymbol",(function(){return _})),i.d(e,"isArrayBuffer",(function(){return y})),i.d(e,"isDataView",(function(){return T})),i.d(e,"isArray",(function(){return P})),i.d(e,"isFunction",(function(){return A})),i.d(e,"isArguments",(function(){return D})),i.d(e,"isFinite",(function(){return O})),i.d(e,"isNaN",(function(){return R})),i.d(e,"isTypedArray",(function(){return V})),i.d(e,"isEmpty",(function(){return H})),i.d(e,"isMatch",(function(){return X})),i.d(e,"isEqual",(function(){return J})),i.d(e,"isMap",(function(){return at})),i.d(e,"isWeakMap",(function(){return ot})),i.d(e,"isSet",(function(){return lt})),i.d(e,"isWeakSet",(function(){return ht})),i.d(e,"keys",(function(){return W})),i.d(e,"allKeys",(function(){return Q})),i.d(e,"values",(function(){return ct})),i.d(e,"pairs",(function(){return ut})),i.d(e,"invert",(function(){return dt})),i.d(e,"functions",(function(){return ft})),i.d(e,"methods",(function(){return ft})),i.d(e,"extend",(function(){return mt})),i.d(e,"extendOwn",(function(){return gt})),i.d(e,"assign",(function(){return gt})),i.d(e,"defaults",(function(){return vt})),i.d(e,"create",(function(){return yt})),i.d(e,"clone",(function(){return bt})),i.d(e,"tap",(function(){return xt})),i.d(e,"get",(function(){return It})),i.d(e,"has",(function(){return St})),i.d(e,"mapObject",(function(){return Rt})),i.d(e,"identity",(function(){return Mt})),i.d(e,"constant",(function(){return L})),i.d(e,"noop",(function(){return Lt})),i.d(e,"toPath",(function(){return wt})),i.d(e,"property",(function(){return Pt})),i.d(e,"propertyOf",(function(){return Nt})),i.d(e,"matcher",(function(){return Tt})),i.d(e,"matches",(function(){return Tt})),i.d(e,"times",(function(){return zt})),i.d(e,"random",(function(){return Bt})),i.d(e,"now",(function(){return Ft})),i.d(e,"escape",(function(){return Ut})),i.d(e,"unescape",(function(){return Gt})),i.d(e,"templateSettings",(function(){return Wt})),i.d(e,"template",(function(){return qt})),i.d(e,"result",(function(){return Kt})),i.d(e,"uniqueId",(function(){return Qt})),i.d(e,"chain",(function(){return $t})),i.d(e,"iteratee",(function(){return Dt})),i.d(e,"partial",(function(){return ie})),i.d(e,"bind",(function(){return ne})),i.d(e,"bindAll",(function(){return ae})),i.d(e,"memoize",(function(){return oe})),i.d(e,"delay",(function(){return le})),i.d(e,"defer",(function(){return he})),i.d(e,"throttle",(function(){return ce})),i.d(e,"debounce",(function(){return ue})),i.d(e,"wrap",(function(){return de})),i.d(e,"negate",(function(){return fe})),i.d(e,"compose",(function(){return pe})),i.d(e,"after",(function(){return me})),i.d(e,"before",(function(){return ge})),i.d(e,"once",(function(){return ve})),i.d(e,"findKey",(function(){return _e})),i.d(e,"findIndex",(function(){return be})),i.d(e,"findLastIndex",(function(){return xe})),i.d(e,"sortedIndex",(function(){return we})),i.d(e,"indexOf",(function(){return Ce})),i.d(e,"lastIndexOf",(function(){return Ie})),i.d(e,"find",(function(){return Se})),i.d(e,"detect",(function(){return Se})),i.d(e,"findWhere",(function(){return Me})),i.d(e,"each",(function(){return Te})),i.d(e,"forEach",(function(){return Te})),i.d(e,"map",(function(){return Pe})),i.d(e,"collect",(function(){return Pe})),i.d(e,"reduce",(function(){return ke})),i.d(e,"foldl",(function(){return ke})),i.d(e,"inject",(function(){return ke})),i.d(e,"reduceRight",(function(){return De})),i.d(e,"foldr",(function(){return De})),i.d(e,"filter",(function(){return Oe})),i.d(e,"select",(function(){return Oe})),i.d(e,"reject",(function(){return Re})),i.d(e,"every",(function(){return Le})),i.d(e,"all",(function(){return Le})),i.d(e,"some",(function(){return Ne})),i.d(e,"any",(function(){return Ne})),i.d(e,"contains",(function(){return ze})),i.d(e,"includes",(function(){return ze})),i.d(e,"include",(function(){return ze})),i.d(e,"invoke",(function(){return Be})),i.d(e,"pluck",(function(){return Fe})),i.d(e,"where",(function(){return je})),i.d(e,"max",(function(){return Ue})),i.d(e,"min",(function(){return We})),i.d(e,"shuffle",(function(){return Xe})),i.d(e,"sample",(function(){return He})),i.d(e,"sortBy",(function(){return Ze})),i.d(e,"groupBy",(function(){return qe})),i.d(e,"indexBy",(function(){return Ke})),i.d(e,"countBy",(function(){return Je})),i.d(e,"partition",(function(){return Qe})),i.d(e,"toArray",(function(){return ti})),i.d(e,"size",(function(){return ei})),i.d(e,"pick",(function(){return ni})),i.d(e,"omit",(function(){return ri})),i.d(e,"first",(function(){return ai})),i.d(e,"head",(function(){return ai})),i.d(e,"take",(function(){return ai})),i.d(e,"initial",(function(){return si})),i.d(e,"last",(function(){return li})),i.d(e,"rest",(function(){return oi})),i.d(e,"tail",(function(){return oi})),i.d(e,"drop",(function(){return oi})),i.d(e,"compact",(function(){return hi})),i.d(e,"flatten",(function(){return ci})),i.d(e,"without",(function(){return di})),i.d(e,"uniq",(function(){return fi})),i.d(e,"unique",(function(){return fi})),i.d(e,"union",(function(){return pi})),i.d(e,"intersection",(function(){return mi})),i.d(e,"difference",(function(){return ui})),i.d(e,"unzip",(function(){return gi})),i.d(e,"transpose",(function(){return gi})),i.d(e,"zip",(function(){return vi})),i.d(e,"object",(function(){return _i})),i.d(e,"range",(function(){return yi})),i.d(e,"chunk",(function(){return bi})),i.d(e,"mixin",(function(){return wi}));var n={};i.r(n),i.d(n,"VERSION",(function(){return r.e})),i.d(n,"restArguments",(function(){return s})),i.d(n,"isObject",(function(){return o})),i.d(n,"isNull",(function(){return l})),i.d(n,"isUndefined",(function(){return h})),i.d(n,"isBoolean",(function(){return c})),i.d(n,"isElement",(function(){return u})),i.d(n,"isString",(function(){return f})),i.d(n,"isNumber",(function(){return p})),i.d(n,"isDate",(function(){return m})),i.d(n,"isRegExp",(function(){return g})),i.d(n,"isError",(function(){return v})),i.d(n,"isSymbol",(function(){return _})),i.d(n,"isArrayBuffer",(function(){return y})),i.d(n,"isDataView",(function(){return T})),i.d(n,"isArray",(function(){return P})),i.d(n,"isFunction",(function(){return A})),i.d(n,"isArguments",(function(){return D})),i.d(n,"isFinite",(function(){return O})),i.d(n,"isNaN",(function(){return R})),i.d(n,"isTypedArray",(function(){return V})),i.d(n,"isEmpty",(function(){return H})),i.d(n,"isMatch",(function(){return X})),i.d(n,"isEqual",(function(){return J})),i.d(n,"isMap",(function(){return at})),i.d(n,"isWeakMap",(function(){return ot})),i.d(n,"isSet",(function(){return lt})),i.d(n,"isWeakSet",(function(){return ht})),i.d(n,"keys",(function(){return W})),i.d(n,"allKeys",(function(){return Q})),i.d(n,"values",(function(){return ct})),i.d(n,"pairs",(function(){return ut})),i.d(n,"invert",(function(){return dt})),i.d(n,"functions",(function(){return ft})),i.d(n,"methods",(function(){return ft})),i.d(n,"extend",(function(){return mt})),i.d(n,"extendOwn",(function(){return gt})),i.d(n,"assign",(function(){return gt})),i.d(n,"defaults",(function(){return vt})),i.d(n,"create",(function(){return yt})),i.d(n,"clone",(function(){return bt})),i.d(n,"tap",(function(){return xt})),i.d(n,"get",(function(){return It})),i.d(n,"has",(function(){return St})),i.d(n,"mapObject",(function(){return Rt})),i.d(n,"identity",(function(){return Mt})),i.d(n,"constant",(function(){return L})),i.d(n,"noop",(function(){return Lt})),i.d(n,"toPath",(function(){return wt})),i.d(n,"property",(function(){return Pt})),i.d(n,"propertyOf",(function(){return Nt})),i.d(n,"matcher",(function(){return Tt})),i.d(n,"matches",(function(){return Tt})),i.d(n,"times",(function(){return zt})),i.d(n,"random",(function(){return Bt})),i.d(n,"now",(function(){return Ft})),i.d(n,"escape",(function(){return Ut})),i.d(n,"unescape",(function(){return Gt})),i.d(n,"templateSettings",(function(){return Wt})),i.d(n,"template",(function(){return qt})),i.d(n,"result",(function(){return Kt})),i.d(n,"uniqueId",(function(){return Qt})),i.d(n,"chain",(function(){return $t})),i.d(n,"iteratee",(function(){return Dt})),i.d(n,"partial",(function(){return ie})),i.d(n,"bind",(function(){return ne})),i.d(n,"bindAll",(function(){return ae})),i.d(n,"memoize",(function(){return oe})),i.d(n,"delay",(function(){return le})),i.d(n,"defer",(function(){return he})),i.d(n,"throttle",(function(){return ce})),i.d(n,"debounce",(function(){return ue})),i.d(n,"wrap",(function(){return de})),i.d(n,"negate",(function(){return fe})),i.d(n,"compose",(function(){return pe})),i.d(n,"after",(function(){return me})),i.d(n,"before",(function(){return ge})),i.d(n,"once",(function(){return ve})),i.d(n,"findKey",(function(){return _e})),i.d(n,"findIndex",(function(){return be})),i.d(n,"findLastIndex",(function(){return xe})),i.d(n,"sortedIndex",(function(){return we})),i.d(n,"indexOf",(function(){return Ce})),i.d(n,"lastIndexOf",(function(){return Ie})),i.d(n,"find",(function(){return Se})),i.d(n,"detect",(function(){return Se})),i.d(n,"findWhere",(function(){return Me})),i.d(n,"each",(function(){return Te})),i.d(n,"forEach",(function(){return Te})),i.d(n,"map",(function(){return Pe})),i.d(n,"collect",(function(){return Pe})),i.d(n,"reduce",(function(){return ke})),i.d(n,"foldl",(function(){return ke})),i.d(n,"inject",(function(){return ke})),i.d(n,"reduceRight",(function(){return De})),i.d(n,"foldr",(function(){return De})),i.d(n,"filter",(function(){return Oe})),i.d(n,"select",(function(){return Oe})),i.d(n,"reject",(function(){return Re})),i.d(n,"every",(function(){return Le})),i.d(n,"all",(function(){return Le})),i.d(n,"some",(function(){return Ne})),i.d(n,"any",(function(){return Ne})),i.d(n,"contains",(function(){return ze})),i.d(n,"includes",(function(){return ze})),i.d(n,"include",(function(){return ze})),i.d(n,"invoke",(function(){return Be})),i.d(n,"pluck",(function(){return Fe})),i.d(n,"where",(function(){return je})),i.d(n,"max",(function(){return Ue})),i.d(n,"min",(function(){return We})),i.d(n,"shuffle",(function(){return Xe})),i.d(n,"sample",(function(){return He})),i.d(n,"sortBy",(function(){return Ze})),i.d(n,"groupBy",(function(){return qe})),i.d(n,"indexBy",(function(){return Ke})),i.d(n,"countBy",(function(){return Je})),i.d(n,"partition",(function(){return Qe})),i.d(n,"toArray",(function(){return ti})),i.d(n,"size",(function(){return ei})),i.d(n,"pick",(function(){return ni})),i.d(n,"omit",(function(){return ri})),i.d(n,"first",(function(){return ai})),i.d(n,"head",(function(){return ai})),i.d(n,"take",(function(){return ai})),i.d(n,"initial",(function(){return si})),i.d(n,"last",(function(){return li})),i.d(n,"rest",(function(){return oi})),i.d(n,"tail",(function(){return oi})),i.d(n,"drop",(function(){return oi})),i.d(n,"compact",(function(){return hi})),i.d(n,"flatten",(function(){return ci})),i.d(n,"without",(function(){return di})),i.d(n,"uniq",(function(){return fi})),i.d(n,"unique",(function(){return fi})),i.d(n,"union",(function(){return pi})),i.d(n,"intersection",(function(){return mi})),i.d(n,"difference",(function(){return ui})),i.d(n,"unzip",(function(){return gi})),i.d(n,"transpose",(function(){return gi})),i.d(n,"zip",(function(){return vi})),i.d(n,"object",(function(){return _i})),i.d(n,"range",(function(){return yi})),i.d(n,"chunk",(function(){return bi})),i.d(n,"mixin",(function(){return wi})),i.d(n,"default",(function(){return Ai}));var r=i(0);function s(t,e){return e=null==e?t.length-1:+e,function(){for(var i=Math.max(arguments.length-e,0),n=Array(i),r=0;r<i;r++)n[r]=arguments[r+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n);case 2:return t.call(this,arguments[0],arguments[1],n)}var s=Array(e+1);for(r=0;r<e;r++)s[r]=arguments[r];return s[e]=n,t.apply(this,s)}}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){var e=a(t);return"function"===e||"object"===e&&!!t}function l(t){return null===t}function h(t){return void 0===t}function c(t){return!0===t||!1===t||"[object Boolean]"===r.t.call(t)}function u(t){return!(!t||1!==t.nodeType)}function d(t){var e="[object "+t+"]";return function(t){return r.t.call(t)===e}}var f=d("String"),p=d("Number"),m=d("Date"),g=d("RegExp"),v=d("Error"),_=d("Symbol"),y=d("ArrayBuffer");function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var x=d("Function"),w=r.p.document&&r.p.document.childNodes;"object"!=("undefined"==typeof Int8Array?"undefined":b(Int8Array))&&"function"!=typeof w&&(x=function(t){return"function"==typeof t||!1});var A=x,C=d("Object"),I=r.s&&C(new DataView(new ArrayBuffer(8))),S="undefined"!=typeof Map&&C(new Map),M=d("DataView");var T=I?function(t){return null!=t&&A(t.getInt8)&&y(t.buffer)}:M,P=r.k||d("Array");function E(t,e){return null!=t&&r.i.call(t,e)}var k=d("Arguments");!function(){k(arguments)||(k=function(t){return E(t,"callee")})}();var D=k;function O(t){return!_(t)&&Object(r.f)(t)&&!isNaN(parseFloat(t))}function R(t){return p(t)&&Object(r.g)(t)}function L(t){return function(){return t}}function N(t){return function(e){var i=t(e);return"number"==typeof i&&i>=0&&i<=r.b}}function z(t){return function(e){return null==e?void 0:e[t]}}var B=z("byteLength"),F=N(B),j=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var V=r.r?function(t){return r.l?Object(r.l)(t)&&!T(t):F(t)&&j.test(r.t.call(t))}:L(!1),U=z("length");function G(t,e){e=function(t){for(var e={},i=t.length,n=0;n<i;++n)e[t[n]]=!0;return{contains:function(t){return e[t]},push:function(i){return e[i]=!0,t.push(i)}}}(e);var i=r.n.length,n=t.constructor,s=A(n)&&n.prototype||r.c,a="constructor";for(E(t,a)&&!e.contains(a)&&e.push(a);i--;)(a=r.n[i])in t&&t[a]!==s[a]&&!e.contains(a)&&e.push(a)}function W(t){if(!o(t))return[];if(r.m)return Object(r.m)(t);var e=[];for(var i in t)E(t,i)&&e.push(i);return r.h&&G(t,e),e}function H(t){if(null==t)return!0;var e=U(t);return"number"==typeof e&&(P(t)||f(t)||D(t))?0===e:0===U(W(t))}function X(t,e){var i=W(e),n=i.length;if(null==t)return!n;for(var r=Object(t),s=0;s<n;s++){var a=i[s];if(e[a]!==r[a]||!(a in r))return!1}return!0}function Z(t){return t instanceof Z?t:this instanceof Z?void(this._wrapped=t):new Z(t)}function Y(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,B(t))}function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Z.VERSION=r.e,Z.prototype.value=function(){return this._wrapped},Z.prototype.valueOf=Z.prototype.toJSON=Z.prototype.value,Z.prototype.toString=function(){return String(this._wrapped)};function K(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var s=q(t);return("function"===s||"object"===s||"object"==q(e))&&function t(e,i,n,s){e instanceof Z&&(e=e._wrapped);i instanceof Z&&(i=i._wrapped);var a=r.t.call(e);if(a!==r.t.call(i))return!1;if(I&&"[object Object]"==a&&T(e)){if(!T(i))return!1;a="[object DataView]"}switch(a){case"[object RegExp]":case"[object String]":return""+e==""+i;case"[object Number]":return+e!=+e?+i!=+i:0==+e?1/+e==1/i:+e==+i;case"[object Date]":case"[object Boolean]":return+e==+i;case"[object Symbol]":return r.d.valueOf.call(e)===r.d.valueOf.call(i);case"[object ArrayBuffer]":case"[object DataView]":return t(Y(e),Y(i),n,s)}var o="[object Array]"===a;if(!o&&V(e)){if(B(e)!==B(i))return!1;if(e.buffer===i.buffer&&e.byteOffset===i.byteOffset)return!0;o=!0}if(!o){if("object"!=q(e)||"object"!=q(i))return!1;var l=e.constructor,h=i.constructor;if(l!==h&&!(A(l)&&l instanceof l&&A(h)&&h instanceof h)&&"constructor"in e&&"constructor"in i)return!1}s=s||[];var c=(n=n||[]).length;for(;c--;)if(n[c]===e)return s[c]===i;if(n.push(e),s.push(i),o){if((c=e.length)!==i.length)return!1;for(;c--;)if(!K(e[c],i[c],n,s))return!1}else{var u,d=W(e);if(c=d.length,W(i).length!==c)return!1;for(;c--;)if(u=d[c],!E(i,u)||!K(e[u],i[u],n,s))return!1}return n.pop(),s.pop(),!0}(t,e,i,n)}function J(t,e){return K(t,e)}function Q(t){if(!o(t))return[];var e=[];for(var i in t)e.push(i);return r.h&&G(t,e),e}function $(t){var e=U(t);return function(i){if(null==i)return!1;var n=Q(i);if(U(n))return!1;for(var r=0;r<e;r++)if(!A(i[t[r]]))return!1;return t!==rt||!A(i[tt])}}var tt="forEach",et=["clear","delete"],it=["get","has","set"],nt=et.concat(tt,it),rt=et.concat(it),st=["add"].concat(et,tt,"has"),at=S?$(nt):d("Map"),ot=S?$(rt):d("WeakMap"),lt=S?$(st):d("Set"),ht=d("WeakSet");function ct(t){for(var e=W(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=t[e[r]];return n}function ut(t){for(var e=W(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=[e[r],t[e[r]]];return n}function dt(t){for(var e={},i=W(t),n=0,r=i.length;n<r;n++)e[t[i[n]]]=i[n];return e}function ft(t){var e=[];for(var i in t)A(t[i])&&e.push(i);return e.sort()}function pt(t,e){return function(i){var n=arguments.length;if(e&&(i=Object(i)),n<2||null==i)return i;for(var r=1;r<n;r++)for(var s=arguments[r],a=t(s),o=a.length,l=0;l<o;l++){var h=a[l];e&&void 0!==i[h]||(i[h]=s[h])}return i}}var mt=pt(Q),gt=pt(W),vt=pt(Q,!0);function _t(t){if(!o(t))return{};if(r.j)return Object(r.j)(t);var e=function(){};e.prototype=t;var i=new e;return e.prototype=null,i}function yt(t,e){var i=_t(t);return e&&gt(i,e),i}function bt(t){return o(t)?P(t)?t.slice():mt({},t):t}function xt(t,e){return e(t),t}function wt(t){return P(t)?t:[t]}function At(t){return Z.toPath(t)}function Ct(t,e){for(var i=e.length,n=0;n<i;n++){if(null==t)return;t=t[e[n]]}return i?t:void 0}function It(t,e,i){var n=Ct(t,At(e));return h(n)?i:n}function St(t,e){for(var i=(e=At(e)).length,n=0;n<i;n++){var r=e[n];if(!E(t,r))return!1;t=t[r]}return!!i}function Mt(t){return t}function Tt(t){return t=gt({},t),function(e){return X(e,t)}}function Pt(t){return t=At(t),function(e){return Ct(e,t)}}function Et(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,s){return t.call(e,i,n,r,s)}}return function(){return t.apply(e,arguments)}}function kt(t,e,i){return null==t?Mt:A(t)?Et(t,e,i):o(t)&&!P(t)?Tt(t):Pt(t)}function Dt(t,e){return kt(t,e,1/0)}function Ot(t,e,i){return Z.iteratee!==Dt?Z.iteratee(t,e):kt(t,e,i)}function Rt(t,e,i){e=Ot(e,i);for(var n=W(t),r=n.length,s={},a=0;a<r;a++){var o=n[a];s[o]=e(t[o],o,t)}return s}function Lt(){}function Nt(t){return null==t?Lt:function(e){return It(t,e)}}function zt(t,e,i){var n=Array(Math.max(0,t));e=Et(e,i,1);for(var r=0;r<t;r++)n[r]=e(r);return n}function Bt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}Z.toPath=wt,Z.iteratee=Dt;var Ft=Date.now||function(){return(new Date).getTime()};function jt(t){var e=function(e){return t[e]},i="(?:"+W(t).join("|")+")",n=RegExp(i),r=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(r,e):t}}var Vt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ut=jt(Vt),Gt=jt(dt(Vt)),Wt=Z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Ht=/(.)^/,Xt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Zt=/\\|'|\r|\n|\u2028|\u2029/g;function Yt(t){return"\\"+Xt[t]}function qt(t,e,i){!e&&i&&(e=i),e=vt({},e,Z.templateSettings);var n,r=RegExp([(e.escape||Ht).source,(e.interpolate||Ht).source,(e.evaluate||Ht).source].join("|")+"|$","g"),s=0,a="__p+='";t.replace(r,(function(e,i,n,r,o){return a+=t.slice(s,o).replace(Zt,Yt),s=o+e.length,i?a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),e})),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(e.variable||"obj","_",a)}catch(t){throw t.source=a,t}var o=function(t){return n.call(this,t,Z)},l=e.variable||"obj";return o.source="function("+l+"){\n"+a+"}",o}function Kt(t,e,i){var n=(e=At(e)).length;if(!n)return A(i)?i.call(t):i;for(var r=0;r<n;r++){var s=null==t?void 0:t[e[r]];void 0===s&&(s=i,r=n),t=A(s)?s.call(t):s}return t}var Jt=0;function Qt(t){var e=++Jt+"";return t?t+e:e}function $t(t){var e=Z(t);return e._chain=!0,e}function te(t,e,i,n,r){if(!(n instanceof e))return t.apply(i,r);var s=_t(t.prototype),a=t.apply(s,r);return o(a)?a:s}var ee=s((function(t,e){var i=ee.placeholder;return function n(){for(var r=0,s=e.length,a=Array(s),o=0;o<s;o++)a[o]=e[o]===i?arguments[r++]:e[o];for(;r<arguments.length;)a.push(arguments[r++]);return te(t,n,this,this,a)}}));ee.placeholder=Z;var ie=ee,ne=s((function(t,e,i){if(!A(t))throw new TypeError("Bind must be called on a function");var n=s((function(r){return te(t,n,e,this,i.concat(r))}));return n})),re=N(U);function se(t,e,i,n){if(n=n||[],e||0===e){if(e<=0)return n.concat(t)}else e=1/0;for(var r=n.length,s=0,a=U(t);s<a;s++){var o=t[s];if(re(o)&&(P(o)||D(o)))if(e>1)se(o,e-1,i,n),r=n.length;else for(var l=0,h=o.length;l<h;)n[r++]=o[l++];else i||(n[r++]=o)}return n}var ae=s((function(t,e){var i=(e=se(e,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=e[i];t[n]=ne(t[n],t)}return t}));function oe(t,e){var i=function i(n){var r=i.cache,s=""+(e?e.apply(this,arguments):n);return E(r,s)||(r[s]=t.apply(this,arguments)),r[s]};return i.cache={},i}var le=s((function(t,e,i){return setTimeout((function(){return t.apply(null,i)}),e)})),he=ie(le,Z,1);function ce(t,e,i){var n,r,s,a,o=0;i||(i={});var l=function(){o=!1===i.leading?0:Ft(),n=null,a=t.apply(r,s),n||(r=s=null)},h=function(){var h=Ft();o||!1!==i.leading||(o=h);var c=e-(h-o);return r=this,s=arguments,c<=0||c>e?(n&&(clearTimeout(n),n=null),o=h,a=t.apply(r,s),n||(r=s=null)):n||!1===i.trailing||(n=setTimeout(l,c)),a};return h.cancel=function(){clearTimeout(n),o=0,n=r=s=null},h}function ue(t,e,i){var n,r,a=function(e,i){n=null,i&&(r=t.apply(e,i))},o=s((function(s){if(n&&clearTimeout(n),i){var o=!n;n=setTimeout(a,e),o&&(r=t.apply(this,s))}else n=le(a,e,this,s);return r}));return o.cancel=function(){clearTimeout(n),n=null},o}function de(t,e){return ie(e,t)}function fe(t){return function(){return!t.apply(this,arguments)}}function pe(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}}function me(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function ge(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=null),i}}var ve=ie(ge,2);function _e(t,e,i){e=Ot(e,i);for(var n,r=W(t),s=0,a=r.length;s<a;s++)if(e(t[n=r[s]],n,t))return n}function ye(t){return function(e,i,n){i=Ot(i,n);for(var r=U(e),s=t>0?0:r-1;s>=0&&s<r;s+=t)if(i(e[s],s,e))return s;return-1}}var be=ye(1),xe=ye(-1);function we(t,e,i,n){for(var r=(i=Ot(i,n,1))(e),s=0,a=U(t);s<a;){var o=Math.floor((s+a)/2);i(t[o])<r?s=o+1:a=o}return s}function Ae(t,e,i){return function(n,s,a){var o=0,l=U(n);if("number"==typeof a)t>0?o=a>=0?a:Math.max(a+l,o):l=a>=0?Math.min(a+1,l):a+l+1;else if(i&&a&&l)return n[a=i(n,s)]===s?a:-1;if(s!=s)return(a=e(r.q.call(n,o,l),R))>=0?a+o:-1;for(a=t>0?o:l-1;a>=0&&a<l;a+=t)if(n[a]===s)return a;return-1}}var Ce=Ae(1,be,we),Ie=Ae(-1,xe);function Se(t,e,i){var n=(re(t)?be:_e)(t,e,i);if(void 0!==n&&-1!==n)return t[n]}function Me(t,e){return Se(t,Tt(e))}function Te(t,e,i){var n,r;if(e=Et(e,i),re(t))for(n=0,r=t.length;n<r;n++)e(t[n],n,t);else{var s=W(t);for(n=0,r=s.length;n<r;n++)e(t[s[n]],s[n],t)}return t}function Pe(t,e,i){e=Ot(e,i);for(var n=!re(t)&&W(t),r=(n||t).length,s=Array(r),a=0;a<r;a++){var o=n?n[a]:a;s[a]=e(t[o],o,t)}return s}function Ee(t){var e=function(e,i,n,r){var s=!re(e)&&W(e),a=(s||e).length,o=t>0?0:a-1;for(r||(n=e[s?s[o]:o],o+=t);o>=0&&o<a;o+=t){var l=s?s[o]:o;n=i(n,e[l],l,e)}return n};return function(t,i,n,r){var s=arguments.length>=3;return e(t,Et(i,r,4),n,s)}}var ke=Ee(1),De=Ee(-1);function Oe(t,e,i){var n=[];return e=Ot(e,i),Te(t,(function(t,i,r){e(t,i,r)&&n.push(t)})),n}function Re(t,e,i){return Oe(t,fe(Ot(e)),i)}function Le(t,e,i){e=Ot(e,i);for(var n=!re(t)&&W(t),r=(n||t).length,s=0;s<r;s++){var a=n?n[s]:s;if(!e(t[a],a,t))return!1}return!0}function Ne(t,e,i){e=Ot(e,i);for(var n=!re(t)&&W(t),r=(n||t).length,s=0;s<r;s++){var a=n?n[s]:s;if(e(t[a],a,t))return!0}return!1}function ze(t,e,i,n){return re(t)||(t=ct(t)),("number"!=typeof i||n)&&(i=0),Ce(t,e,i)>=0}var Be=s((function(t,e,i){var n,r;return A(e)?r=e:(e=At(e),n=e.slice(0,-1),e=e[e.length-1]),Pe(t,(function(t){var s=r;if(!s){if(n&&n.length&&(t=Ct(t,n)),null==t)return;s=t[e]}return null==s?s:s.apply(t,i)}))}));function Fe(t,e){return Pe(t,Pt(e))}function je(t,e){return Oe(t,Tt(e))}function Ve(t){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ue(t,e,i){var n,r,s=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=Ve(t[0])&&null!=t)for(var o=0,l=(t=re(t)?t:ct(t)).length;o<l;o++)null!=(n=t[o])&&n>s&&(s=n);else e=Ot(e,i),Te(t,(function(t,i,n){((r=e(t,i,n))>a||r===-1/0&&s===-1/0)&&(s=t,a=r)}));return s}function Ge(t){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function We(t,e,i){var n,r,s=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=Ge(t[0])&&null!=t)for(var o=0,l=(t=re(t)?t:ct(t)).length;o<l;o++)null!=(n=t[o])&&n<s&&(s=n);else e=Ot(e,i),Te(t,(function(t,i,n){((r=e(t,i,n))<a||r===1/0&&s===1/0)&&(s=t,a=r)}));return s}function He(t,e,i){if(null==e||i)return re(t)||(t=ct(t)),t[Bt(t.length-1)];var n=re(t)?bt(t):ct(t),r=U(n);e=Math.max(Math.min(e,r),0);for(var s=r-1,a=0;a<e;a++){var o=Bt(a,s),l=n[a];n[a]=n[o],n[o]=l}return n.slice(0,e)}function Xe(t){return He(t,1/0)}function Ze(t,e,i){var n=0;return e=Ot(e,i),Fe(Pe(t,(function(t,i,r){return{value:t,index:n++,criteria:e(t,i,r)}})).sort((function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return t.index-e.index})),"value")}function Ye(t,e){return function(i,n,r){var s=e?[[],[]]:{};return n=Ot(n,r),Te(i,(function(e,r){var a=n(e,r,i);t(s,e,a)})),s}}var qe=Ye((function(t,e,i){E(t,i)?t[i].push(e):t[i]=[e]})),Ke=Ye((function(t,e,i){t[i]=e})),Je=Ye((function(t,e,i){E(t,i)?t[i]++:t[i]=1})),Qe=Ye((function(t,e,i){t[i?0:1].push(e)}),!0),$e=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ti(t){return t?P(t)?r.q.call(t):f(t)?t.match($e):re(t)?Pe(t,Mt):ct(t):[]}function ei(t){return null==t?0:re(t)?t.length:W(t).length}function ii(t,e,i){return e in i}var ni=s((function(t,e){var i={},n=e[0];if(null==t)return i;A(n)?(e.length>1&&(n=Et(n,e[1])),e=Q(t)):(n=ii,e=se(e,!1,!1),t=Object(t));for(var r=0,s=e.length;r<s;r++){var a=e[r],o=t[a];n(o,a,t)&&(i[a]=o)}return i})),ri=s((function(t,e){var i,n=e[0];return A(n)?(n=fe(n),e.length>1&&(i=e[1])):(e=Pe(se(e,!1,!1),String),n=function(t,i){return!ze(e,i)}),ni(t,n,i)}));function si(t,e,i){return r.q.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))}function ai(t,e,i){return null==t||t.length<1?null==e||i?void 0:[]:null==e||i?t[0]:si(t,t.length-e)}function oi(t,e,i){return r.q.call(t,null==e||i?1:e)}function li(t,e,i){return null==t||t.length<1?null==e||i?void 0:[]:null==e||i?t[t.length-1]:oi(t,Math.max(0,t.length-e))}function hi(t){return Oe(t,Boolean)}function ci(t,e){return se(t,e,!1)}var ui=s((function(t,e){return e=se(e,!0,!0),Oe(t,(function(t){return!ze(e,t)}))})),di=s((function(t,e){return ui(t,e)}));function fi(t,e,i,n){c(e)||(n=i,i=e,e=!1),null!=i&&(i=Ot(i,n));for(var r=[],s=[],a=0,o=U(t);a<o;a++){var l=t[a],h=i?i(l,a,t):l;e&&!i?(a&&s===h||r.push(l),s=h):i?ze(s,h)||(s.push(h),r.push(l)):ze(r,l)||r.push(l)}return r}var pi=s((function(t){return fi(se(t,!0,!0))}));function mi(t){for(var e=[],i=arguments.length,n=0,r=U(t);n<r;n++){var s=t[n];if(!ze(e,s)){var a;for(a=1;a<i&&ze(arguments[a],s);a++);a===i&&e.push(s)}}return e}function gi(t){for(var e=t&&Ue(t,U).length||0,i=Array(e),n=0;n<e;n++)i[n]=Fe(t,n);return i}var vi=s(gi);function _i(t,e){for(var i={},n=0,r=U(t);n<r;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i}function yi(t,e,i){null==e&&(e=t||0,t=0),i||(i=e<t?-1:1);for(var n=Math.max(Math.ceil((e-t)/i),0),r=Array(n),s=0;s<n;s++,t+=i)r[s]=t;return r}function bi(t,e){if(null==e||e<1)return[];for(var i=[],n=0,s=t.length;n<s;)i.push(r.q.call(t,n,n+=e));return i}function xi(t,e){return t._chain?Z(e).chain():e}function wi(t){return Te(ft(t),(function(e){var i=Z[e]=t[e];Z.prototype[e]=function(){var t=[this._wrapped];return r.o.apply(t,arguments),xi(this,i.apply(Z,t))}})),Z}Te(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=r.a[t];Z.prototype[t]=function(){var i=this._wrapped;return null!=i&&(e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0]),xi(this,i)}})),Te(["concat","join","slice"],(function(t){var e=r.a[t];Z.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),xi(this,t)}}));var Ai=Z,Ci=wi(n);Ci._=Ci;var Ii=Ci},function(t,e,i){"use strict";i.r(e),i.d(e,"Graph",(function(){return Xp}));var n=i(2),r=i(16),s=i(17);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=function t(e){var i,n,r;if("object"!==a(e)||null===e)return e;for(r in i=Array.isArray(e)?[]:{},e)n=e[r],i[r]=t(n);return i},l=(i(12),i(13),i(14),i(3),i(8),i(9),i(1));
/**
 * @license
 * PlayCanvas Engine v1.38.0 revision 98cb89ec5
 * Copyright 2011-2021 PlayCanvas Ltd. All rights reserved.
 */
Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw TypeError("predicate must be a function");for(var n=arguments[1],r=0;r<i;){var s=e[r];if(t.call(n,s,r,e))return s;r++}},configurable:!0,writable:!0}),Math.log2=Math.log2||function(t){return Math.log(t)*Math.LOG2E},Math.sign||(Math.sign=function(t){return(t>0)-(t<0)||+t}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])}return i},writable:!0,configurable:!0}),function(){if("undefined"!=typeof navigator&&"undefined"!=typeof document){navigator.pointer=navigator.pointer||navigator.webkitPointer||navigator.mozPointer;var t=function(){var t=document.createEvent("CustomEvent");t.initCustomEvent("pointerlockchange",!0,!1,null),document.dispatchEvent(t)},e=function(){var t=document.createEvent("CustomEvent");t.initCustomEvent("pointerlockerror",!0,!1,null),document.dispatchEvent(t)};document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("webkitpointerlocklost",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("mozpointerlocklost",t,!1),document.addEventListener("webkitpointerlockerror",e,!1),document.addEventListener("mozpointerlockerror",e,!1),Element.prototype.mozRequestPointerLock?Element.prototype.requestPointerLock=function(){this.mozRequestPointerLock()}:Element.prototype.requestPointerLock=Element.prototype.requestPointerLock||Element.prototype.webkitRequestPointerLock||Element.prototype.mozRequestPointerLock,!Element.prototype.requestPointerLock&&navigator.pointer&&(Element.prototype.requestPointerLock=function(){document.pointerLockElement=this,navigator.pointer.lock(this,t,e)}),document.exitPointerLock=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock,document.exitPointerLock||(document.exitPointerLock=function(){navigator.pointer&&(document.pointerLockElement=null,navigator.pointer.unlock())})}}(),function(){if("undefined"!=typeof window){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var n=(new Date).getTime(),r=Math.max(0,16-(n-t)),s=window.setTimeout((function(){e(n+r)}),r);return t=n+r,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}}(),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){return(void 0===e||e>this.length)&&(e=this.length),this.substring(e-t.length,e)===t}),String.prototype.includes||(String.prototype.includes=function(t,e){return"number"!=typeof e&&(e=0),!(e+t.length>this.length)&&-1!==this.indexOf(t,e)}),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(!e||e<0?0:+e,t.length)===t}),function(){var t={};function e(e,i){var n;t[e]=!0,void 0!==i&&(n=i,window.console&&window.console.error&&window.console.error(n))}var i=function t(e){var i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var r=new t.VertexAttrib(i);this.attribs[n]=r}this.maxAttrib=0};(i.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var n=function(e){var i=this;this.gl=e,function(e){var i=e.getError;e.getError=function(){do{(n=i.apply(e))!=e.NO_ERROR&&(t[n]=!0)}while(n!=e.NO_ERROR);for(var n in t)if(t[n])return delete t[n],parseInt(n);return e.NO_ERROR}}(e);var n=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(t){return t==i.VERTEX_ARRAY_BINDING_OES?i.currentVertexArrayObject==i.defaultVertexArrayObject?null:i.currentVertexArrayObject:n.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(t){var e=i.currentVertexArrayObject;e.maxAttrib=Math.max(e.maxAttrib,t);var r=e.attribs[t];return r.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(t){var e=i.currentVertexArrayObject;e.maxAttrib=Math.max(e.maxAttrib,t);var r=e.attribs[t];return r.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(t,r){switch(t){case e.ARRAY_BUFFER:i.currentArrayBuffer=r;break;case e.ELEMENT_ARRAY_BUFFER:i.currentVertexArrayObject.elementArrayBuffer=r}return n.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(t,r){var s=i.currentVertexArrayObject,a=s.attribs[t];switch(r){case e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return a.buffer;case e.VERTEX_ATTRIB_ARRAY_ENABLED:return a.enabled;case e.VERTEX_ATTRIB_ARRAY_SIZE:return a.size;case e.VERTEX_ATTRIB_ARRAY_STRIDE:return a.stride;case e.VERTEX_ATTRIB_ARRAY_TYPE:return a.type;case e.VERTEX_ATTRIB_ARRAY_NORMALIZED:return a.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(t,e,r,s,a,o){var l=i.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,t);var h=l.attribs[t];return h.buffer=i.currentArrayBuffer,h.size=e,h.type=r,h.normalized=s,h.stride=a,h.offset=o,h.recache(),n.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas.addEventListener("webglcontextrestored",(function(){var t;t="OESVertexArrayObject emulation library context restored",window.console&&window.console.log&&window.console.log(t),i.reset_()}),!0),this.reset_()};n.prototype.VERTEX_ARRAY_BINDING_OES=34229,n.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new i(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},n.prototype.createVertexArrayOES=function(){var t=new i(this);return this.vertexArrayObjects.push(t),t},n.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},n.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof i&&t.hasBeenBound&&t.ext==this)},n.prototype.bindVertexArrayOES=function(t){var i=this.gl;if(!t||t.isAlive){var n=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var s=this.currentVertexArrayObject;if(r!=s){r&&s.elementArrayBuffer==r.elementArrayBuffer||n.bindBuffer.call(i,i.ELEMENT_ARRAY_BUFFER,s.elementArrayBuffer);for(var a=this.currentArrayBuffer,o=Math.max(r?r.maxAttrib:0,s.maxAttrib),l=0;l<=o;l++){var h=s.attribs[l],c=r?r.attribs[l]:null;if(r&&h.enabled==c.enabled||(h.enabled?n.enableVertexAttribArray.call(i,l):n.disableVertexAttribArray.call(i,l)),h.enabled){var u=!1;r&&h.buffer==c.buffer||(a!=h.buffer&&(n.bindBuffer.call(i,i.ARRAY_BUFFER,h.buffer),a=h.buffer),u=!0),(u||h.cached!=c.cached)&&n.vertexAttribPointer.call(i,l,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!=a&&n.bindBuffer.call(i,i.ARRAY_BUFFER,this.currentArrayBuffer)}}else e(i.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},window.setupVertexArrayObject=function(t){if(t.getSupportedExtensions){if(-1!=t.getSupportedExtensions().indexOf("OES_vertex_array_object"))return}else if(t.getExtension){if(t.getExtension("OES_vertex_array_object"))return}if(t.getSupportedExtensions){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.push("OES_vertex_array_object"),t}}var i=t.getExtension;t.getExtension=function(e){return"OES_vertex_array_object"==e?(t.__OESVertexArrayObject||(t.__OESVertexArrayObject=new n(t)),t.__OESVertexArrayObject):i?i.call(this,e):null}}}();var h=function(){for(var t={},e=["Array","Object","Function","Date","RegExp","Float32Array"],i=0;i<e.length;i++)t["[object "+e[i]+"]"]=e[i].toLowerCase();return t}();function c(t){if(null===t)return"null";var e=typeof t;return"undefined"===e||"number"===e||"string"===e||"boolean"===e?e:h[Object.prototype.toString.call(t)]}function u(t,e){var i,n;for(i in e)"object"==c(n=e[i])?t[i]=u({},n):"array"==c(n)?t[i]=u([],n):t[i]=n;return t}function d(t){return void 0!==t}var f,p,m,g;f=null,p=null,m=null,g=null;class v{constructor(){this._callbacks={},this._callbackActive={}}_addCallback(t,e,i,n=!1){t&&"string"==typeof t&&e&&(this._callbacks[t]||(this._callbacks[t]=[]),this._callbackActive[t]&&this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),this._callbacks[t].push({callback:e,scope:i||this,once:n}))}on(t,e,i){return this._addCallback(t,e,i,!1),this}off(t,e,i){if(t)this._callbackActive[t]&&this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice());else for(var n in this._callbackActive)this._callbacks[n]&&this._callbacks[n]===this._callbackActive[n]&&(this._callbackActive[n]=this._callbackActive[n].slice());if(t)if(e){var r=this._callbacks[t];if(!r)return this;for(var s=r.length,a=0;a<s;a++)r[a].callback===e&&(i&&r[a].scope!==i||(r[a--]=r[--s]));r.length=s}else this._callbacks[t]&&(this._callbacks[t]=[]);else this._callbacks={};return this}fire(t,e,i,n,r,s,a,o,l){if(!t||!this._callbacks[t])return this;var h;this._callbackActive[t]?(this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),h=this._callbacks[t].slice()):this._callbackActive[t]=this._callbacks[t];for(var c=0;(h||this._callbackActive[t])&&c<(h||this._callbackActive[t]).length;c++){var u=(h||this._callbackActive[t])[c];if(u.callback.call(u.scope,e,i,n,r,s,a,o,l),u.once){var d=this._callbacks[t].indexOf(u);-1!==d&&(this._callbackActive[t]===this._callbacks[t]&&(this._callbackActive[t]=this._callbackActive[t].slice()),this._callbacks[t].splice(d,1))}}return h||(this._callbackActive[t]=null),this}once(t,e,i){return this._addCallback(t,e,i,!0),this}hasEvent(t){return this._callbacks[t]&&0!==this._callbacks[t].length||!1}}var y={attach:function(t){var e=y;return t._addCallback=e._addCallback,t.on=e.on,t.off=e.off,t.fire=e.fire,t.once=e.once,t.hasEvent=e.hasEvent,t._callbacks={},t._callbackActive={},t},_addCallback:v.prototype._addCallback,on:v.prototype.on,off:v.prototype.off,fire:v.prototype.fire,once:v.prototype.once,hasEvent:v.prototype.hasEvent},b=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},x={delimiter:"/",join:function(){var t,e=arguments.length,i=arguments[0];for(t=0;t<e-1;++t){var n=arguments[t],r=arguments[t+1];if(!d(n)||!d(r))throw new Error("undefined argument to pc.path.join");r[0]!==x.delimiter?n&&r&&n[n.length-1]!==x.delimiter&&r[0]!==x.delimiter?i+=x.delimiter+r:i+=r:i=r}return i},normalize:function(t){for(var e=t.startsWith(x.delimiter),i=t.endsWith(x.delimiter),n=t.split("/"),r="",s=[],a=0;a<n.length;a++)""!==n[a]&&"."!==n[a]&&(".."===n[a]&&s.length>0?s=s.slice(0,s.length-2):(a>0&&s.push(x.delimiter),s.push(n[a])));return r=s.join(""),e||r[0]!==x.delimiter||(r=r.slice(1)),i&&r[r.length-1]!==x.delimiter&&(r+=x.delimiter),r},split:function(t){var e=t.split(x.delimiter),i=e.slice(e.length-1)[0];return[e.slice(0,e.length-1).join(x.delimiter),i]},getBasename:function(t){return x.split(t)[1]},getDirectory:function(t){var e=t.split(x.delimiter);return e.slice(0,e.length-1).join(x.delimiter)},getExtension:function(t){var e=t.split("?")[0].split(".").pop();return e!==t?"."+e:""},isRelativePath:function(t){return"/"!==t.charAt(0)&&null===t.match(/:\/\//)},extractPath:function(t){var e="",i=t.split("/"),n=0;if(i.length>1)if(x.isRelativePath(t))if("."===i[0])for(n=0;n<i.length-1;++n)e+=0===n?i[n]:"/"+i[n];else if(".."===i[0])for(n=0;n<i.length-1;++n)e+=0===n?i[n]:"/"+i[n];else for(e=".",n=0;n<i.length-1;++n)e+="/"+i[n];else for(n=0;n<i.length-1;++n)e+=0===n?i[n]:"/"+i[n];return e}},w={desktop:!1,mobile:!1,ios:!1,android:!1,windows:!1,xbox:!1,gamepads:!1,touch:!1,workers:!1,passiveEvents:!1};if("undefined"!=typeof navigator){var A=navigator.userAgent;/(windows|mac os|linux|cros)/i.test(A)&&(w.desktop=!0),/xbox/i.test(A)&&(w.xbox=!0),/(windows phone|iemobile|wpdesktop)/i.test(A)?(w.desktop=!1,w.mobile=!0,w.windows=!0):/android/i.test(A)?(w.desktop=!1,w.mobile=!0,w.android=!0):/ip([ao]d|hone)/i.test(A)&&(w.desktop=!1,w.mobile=!0,w.ios=!0),"undefined"!=typeof window&&(w.touch="ontouchstart"in window||"maxTouchPoints"in navigator&&navigator.maxTouchPoints>0),w.gamepads="getGamepads"in navigator,w.workers="undefined"!=typeof Worker;try{var C=Object.defineProperty({},"passive",{get:function(){return w.passiveEvents=!0,!1}});window.addEventListener("testpassive",null,C),window.removeEventListener("testpassive",null,C)}catch(t){}}function I(t,e){var i=t.length;if((e=e||0)<0||e>=i)return null;var n,r=t.charCodeAt(e);return i>1&&r>=55296&&r<=56319&&(n=t.charCodeAt(e+1))>=56320&&n<=57343?{code:1024*(r-55296)+n-56320+65536,long:!0}:{code:r,long:!1}}function S(t,e,i){if(!t)return!1;var n=I(t);if(n){var r=n.code;return r>=e&&r<=i}return!1}function M(t,e){if(e===t.length-1)return 1;if(S(t[e],55296,56319)){var i=t.substring(e,e+2),n=t.substring(e+2,e+4);return S(n,127995,127999)||S(i,127462,127487)&&S(n,127462,127487)?4:S(n,65024,65039)?3:2}return S(t[e+1],65024,65039)?2:1}var T,P,E={ASCII_LOWERCASE:"abcdefghijklmnopqrstuvwxyz",ASCII_UPPERCASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",ASCII_LETTERS:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",format:function(t){for(var e=1;e<arguments.length;e++)t=t.replace("{"+(e-1)+"}",arguments[e]);return t},toBool:function(t,e){if("true"===t)return!0;if(e){if("false"===t)return!1;throw new TypeError("Not a boolean string")}return!1},getCodePoint:function(t,e){var i=I(t,e);return i&&i.code},getCodePoints:function(t){if("string"!=typeof t)throw new TypeError("Not a string");for(var e,i=0,n=[];e=I(t,i);)n.push(e.code),i+=e.long?2:1;return n},getSymbols:function(t){if("string"!=typeof t)throw new TypeError("Not a string");for(var e,i=0,n=t.length,r=[],s=0;i<n;)if(S(e=t[i+(s+=M(t,i+s))],8400,8447)&&(e=t[i+s++]),S(e,65024,65039)&&(e=t[i+s++]),e&&8205===e.charCodeAt(0))e=t[i+s++];else{var a=t.substring(i,i+s);r.push(a),i+=s,s=0}return r},fromCodePoint:function(){for(var t,e,i,n=[],r=0;r<arguments.length;++r)e=(t=Number(arguments[r]))-65536,i=t>65535?[55296+(e>>10),e%1024+56320]:[t],n.push(String.fromCharCode.apply(null,i));return n.join("")}},k={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,clamp:function(t,e,i){return t>=i?i:t<=e?e:t},intToBytes24:function(t){return[t>>16&255,t>>8&255,255&t]},intToBytes32:function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},bytesToInt24:function(t,e,i){return t.length&&(i=t[2],e=t[1],t=t[0]),t<<16|e<<8|i},bytesToInt32:function(t,e,i,n){return t.length&&(n=t[3],i=t[2],e=t[1],t=t[0]),(t<<24|e<<16|i<<8|n)>>>32},lerp:function(t,e,i){return t+(e-t)*k.clamp(i,0,1)},lerpAngle:function(t,e,i){return e-t>180&&(e-=360),e-t<-180&&(e+=360),k.lerp(t,e,k.clamp(i,0,1))},powerOfTwo:function(t){return 0!==t&&!(t&t-1)},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},random:function(t,e){var i=e-t;return Math.random()*i+t},smoothstep:function(t,e,i){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*(3-2*i)},smootherstep:function(t,e,i){return i<=t?0:i>=e?1:(i=(i-t)/(e-t))*i*i*(i*(6*i-15)+10)},roundUp:function(t,e){return 0===e?t:Math.ceil(t/e)*e},float2Half:(T=new Float32Array(1),P=new Int32Array(T.buffer),function(t){T[0]=t;var e=P[0],i=e>>16&32768,n=e>>12&2047,r=e>>23&255;return r<103?i:r>142?(i|=31744,i|=(255==r?0:1)&&8388607&e):r<113?i|=((n|=2048)>>114-r)+(n>>113-r&1):(i|=r-112<<10|n>>1,i+=1&n)})};class D{constructor(t=0,e=0,i=0,n=1){var r=t.length;3===r||4===r?(this.r=t[0],this.g=t[1],this.b=t[2],this.a=void 0!==t[3]?t[3]:1):(this.r=t,this.g=e,this.b=i,this.a=n)}clone(){return new D(this.r,this.g,this.b,this.a)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}set(t,e,i,n=1){return this.r=t,this.g=e,this.b=i,this.a=n,this}lerp(t,e,i){return this.r=t.r+i*(e.r-t.r),this.g=t.g+i*(e.g-t.g),this.b=t.b+i*(e.b-t.b),this.a=t.a+i*(e.a-t.a),this}fromString(t){var e,i=parseInt(t.replace("#","0x"),16);return t.length>7?e=k.intToBytes32(i):(e=k.intToBytes24(i))[3]=255,this.set(e[0]/255,e[1]/255,e[2]/255,e[3]/255),this}toString(t){var e="#"+((1<<24)+(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)).toString(16).slice(1);if(!0===t){var i=Math.round(255*this.a).toString(16);this.a<16/255?e+="0"+i:e+=i}return e}}D.BLACK=Object.freeze(new D(0,0,0,1)),D.BLUE=Object.freeze(new D(0,0,1,1)),D.CYAN=Object.freeze(new D(0,1,1,1)),D.GRAY=Object.freeze(new D(.5,.5,.5,1)),D.GREEN=Object.freeze(new D(0,1,0,1)),D.MAGENTA=Object.freeze(new D(1,0,1,1)),D.RED=Object.freeze(new D(1,0,0,1)),D.WHITE=Object.freeze(new D(1,1,1,1)),D.YELLOW=Object.freeze(new D(1,1,0,1));class O{constructor(){this._list=[],this._index={}}push(t,e){if(this._index[t])throw Error("Key already in index "+t);var i=this._list.push(e)-1;this._index[t]=i}has(t){return void 0!==this._index[t]}get(t){var e=this._index[t];return void 0!==e?this._list[e]:null}remove(t){var e=this._index[t];if(void 0!==e){for(t in this._list.splice(e,1),delete this._index[t],this._index){var i=this._index[t];i>e&&(this._index[t]=i-1)}return!0}return!1}list(){return this._list}clear(){for(var t in this._list.length=0,this._index)delete this._index[t]}}class R{constructor(t){this._sortBy=t.sortBy,this.items=[],this.length=0,this.loopIndex=-1,this._sortHandler=this._doSort.bind(this)}_binarySearch(t){for(var e,i,n=0,r=this.items.length-1,s=t[this._sortBy];n<=r;)e=Math.floor((n+r)/2),(i=this.items[e][this._sortBy])<=s?n=e+1:i>s&&(r=e-1);return n}_doSort(t,e){var i=this._sortBy;return t[i]-e[i]}insert(t){var e=this._binarySearch(t);this.items.splice(e,0,t),this.length++,this.loopIndex>=e&&this.loopIndex++}append(t){this.items.push(t),this.length++}remove(t){var e=this.items.indexOf(t);e<0||(this.items.splice(e,1),this.length--,this.loopIndex>=e&&this.loopIndex--)}sort(){var t=this.loopIndex>=0?this.items[this.loopIndex]:null;this.items.sort(this._sortHandler),null!==t&&(this.loopIndex=this.items.indexOf(t))}}class L extends v{constructor(t){super(),this._index={},this._list=[],this._parent=t}add(){var t=!1,e=this._processArguments(arguments,!0);if(!e.length)return t;for(var i=0;i<e.length;i++)this._index[e[i]]||(t=!0,this._index[e[i]]=!0,this._list.push(e[i]),this.fire("add",e[i],this._parent));return t&&this.fire("change",this._parent),t}remove(){var t=!1;if(!this._list.length)return t;var e=this._processArguments(arguments,!0);if(!e.length)return t;for(var i=0;i<e.length;i++)this._index[e[i]]&&(t=!0,delete this._index[e[i]],this._list.splice(this._list.indexOf(e[i]),1),this.fire("remove",e[i],this._parent));return t&&this.fire("change",this._parent),t}clear(){if(this._list.length){var t=this._list.slice(0);this._list=[],this._index={};for(var e=0;e<t.length;e++)this.fire("remove",t[e],this._parent);this.fire("change",this._parent)}}has(){return!!this._list.length&&this._has(this._processArguments(arguments))}_has(t){if(!this._list.length||!t.length)return!1;for(var e=0;e<t.length;e++)if(1===t[e].length){if(this._index[t[e][0]])return!0}else{for(var i=!0,n=0;n<t[e].length;n++)if(!this._index[t[e][n]]){i=!1;break}if(i)return!0}return!1}list(){return this._list.slice(0)}_processArguments(t,e){var i=[],n=[];if(!t||!t.length)return i;for(var r=0;r<t.length;r++)if(t[r]instanceof Array){e||(n=[]);for(var s=0;s<t[r].length;s++)"string"==typeof t[r][s]&&(e?i.push(t[r][s]):n.push(t[r][s]));!e&&n.length&&i.push(n)}else"string"==typeof t[r]&&(e?i.push(t[r]):i.push([t[r]]));return i}get size(){return this._list.length}}var N="undefined"!=typeof window&&window.performance&&window.performance.now&&window.performance.timing?function(){return window.performance.now()}:Date.now;function z(t){var e=t.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/);this.scheme=e[2],this.authority=e[4],this.path=e[5],this.query=e[7],this.fragment=e[9],this.toString=function(){var t="";return this.scheme&&(t+=this.scheme+":"),this.authority&&(t+="//"+this.authority),t+=this.path,this.query&&(t+="?"+this.query),this.fragment&&(t+="#"+this.fragment),t},this.getQuery=function(){var t,e={};return this.query&&decodeURIComponent(this.query).split("&").forEach((function(i,n,r){t=i.split("="),e[t[0]]=t[1]}),this),e},this.setQuery=function(t){var e="";for(var i in t)t.hasOwnProperty(i)&&(""!==e&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));this.query=e}}class B{constructor(){this.ContentType=B.ContentType,this.ResponseType=B.ResponseType,this.binaryExtensions=B.binaryExtensions}get(t,e,i){return"function"==typeof e&&(i=e,e={}),this.request("GET",t,e,i)}post(t,e,i,n){return"function"==typeof i&&(n=i,i={}),i.postdata=e,this.request("POST",t,i,n)}put(t,e,i,n){return"function"==typeof i&&(n=i,i={}),i.postdata=e,this.request("PUT",t,i,n)}del(t,e,i){return"function"==typeof e&&(i=e,e={}),this.request("DELETE",t,e,i)}request(t,e,i,n){var r,s,a,o,l,h=!1;if("function"==typeof i&&(n=i,i={}),i.retry&&(i=Object.assign({retries:0,maxRetries:5},i)),i.callback=n,null==i.async&&(i.async=!0),null==i.headers&&(i.headers={}),null!=i.postdata)if(i.postdata instanceof Document)o=i.postdata;else if(i.postdata instanceof FormData)o=i.postdata;else if(i.postdata instanceof Object){var c=i.headers["Content-Type"];switch(void 0===c&&(i.headers["Content-Type"]=B.ContentType.FORM_URLENCODED,c=i.headers["Content-Type"]),c){case B.ContentType.FORM_URLENCODED:o="";var d=!0;for(var f in i.postdata)i.postdata.hasOwnProperty(f)&&(d?d=!1:o+="&",o+=escape(f)+"="+escape(i.postdata[f]));break;default:case B.ContentType.JSON:null==c&&(i.headers["Content-Type"]=B.ContentType.JSON),o=JSON.stringify(i.postdata)}}else o=i.postdata;for(var p in!1===i.cache&&(a=N(),(r=new z(e)).query?r.query=r.query+"&ts="+a:r.query="ts="+a,e=r.toString()),i.query&&(s=u((r=new z(e)).getQuery(),i.query),r.setQuery(s),e=r.toString()),(l=new XMLHttpRequest).open(t,e,i.async),l.withCredentials=void 0!==i.withCredentials&&i.withCredentials,l.responseType=i.responseType||this._guessResponseType(e),i.headers)i.headers.hasOwnProperty(p)&&l.setRequestHeader(p,i.headers[p]);l.onreadystatechange=function(){this._onReadyStateChange(t,e,i,l)}.bind(this),l.onerror=function(){this._onError(t,e,i,l),h=!0}.bind(this);try{l.send(o)}catch(t){h||i.error(l.status,l,t)}return l}_guessResponseType(t){var e=new z(t),i=x.getExtension(e.path);return B.binaryExtensions.indexOf(i)>=0?B.ResponseType.ARRAY_BUFFER:".xml"===i?B.ResponseType.DOCUMENT:B.ResponseType.TEXT}_isBinaryContentType(t){return[B.ContentType.MP4,B.ContentType.WAV,B.ContentType.OGG,B.ContentType.MP3,B.ContentType.BIN,B.ContentType.DDS,B.ContentType.BASIS,B.ContentType.GLB].indexOf(t)>=0}_onReadyStateChange(t,e,i,n){if(4===n.readyState)switch(n.status){case 0:n.responseURL&&n.responseURL.startsWith("file:///")?this._onSuccess(t,e,i,n):this._onError(t,e,i,n);break;case 200:case 201:case 206:case 304:this._onSuccess(t,e,i,n);break;default:this._onError(t,e,i,n)}}_onSuccess(t,e,i,n){var r,s,a;(s=n.getResponseHeader("Content-Type"))&&(a=s.split(";")[0].trim());try{a===this.ContentType.JSON||e.split("?")[0].endsWith(".json")?r=JSON.parse(n.responseText):this._isBinaryContentType(a)?r=n.response:(a&&console.warn("responseType: "+n.responseType+" being served with Content-Type: "+a),r=n.responseType===B.ResponseType.ARRAY_BUFFER||n.responseType===B.ResponseType.BLOB||n.responseType===B.ResponseType.JSON?n.response:n.responseType===B.ResponseType.DOCUMENT||a===this.ContentType.XML?n.responseXML:n.responseText),i.callback(null,r)}catch(t){i.callback(t)}}_onError(t,e,i,n){if(!i.retrying)if(i.retry&&i.retries<i.maxRetries){i.retries++,i.retrying=!0;var r=k.clamp(Math.pow(2,i.retries)*B.retryDelay,0,i.maxRetryDelay||5e3);console.log(t+": "+e+" - Error "+n.status+". Retrying in "+r+" ms"),setTimeout(function(){i.retrying=!1,this.request(t,e,i,i.callback)}.bind(this),r)}else i.callback(0===n.status?"Network error":n.status,null)}}B.ContentType={FORM_URLENCODED:"application/x-www-form-urlencoded",GIF:"image/gif",JPEG:"image/jpeg",DDS:"image/dds",JSON:"application/json",PNG:"image/png",TEXT:"text/plain",XML:"application/xml",WAV:"audio/x-wav",OGG:"audio/ogg",MP3:"audio/mpeg",MP4:"audio/mp4",AAC:"audio/aac",BIN:"application/octet-stream",BASIS:"image/basis",GLB:"model/gltf-binary"},B.ResponseType={TEXT:"text",ARRAY_BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json"},B.binaryExtensions=[".model",".wav",".ogg",".mp3",".mp4",".m4a",".aac",".dds",".basis",".glb"],B.retryDelay=100;const F=new B;class j{constructor(t,e){this._curve=t,this._left=-1/0,this._right=1/0,this._recip=0,this._p0=0,this._p1=0,this._m0=0,this._m1=0,this._reset(e||0)}evaluate(t,e){var i;(e||t<this._left||t>=this._right)&&this._reset(t);var n=this._curve.type;if(5===n)i=this._p0;else{var r=0===this._recip?0:(t-this._left)*this._recip;i=0===n?k.lerp(this._p0,this._p1,r):1===n?k.lerp(this._p0,this._p1,r*r*(3-2*r)):this._evaluateHermite(this._p0,this._p1,this._m0,this._m1,r)}return i}_reset(t){var e=this._curve.keys,i=e.length;if(i)if(t<e[0][0])this._left=-1/0,this._right=e[0][0],this._recip=0,this._p0=this._p1=e[0][1],this._m0=this._m1=0;else if(t>=e[i-1][0])this._left=e[i-1][0],this._right=1/0,this._recip=0,this._p0=this._p1=e[i-1][1],this._m0=this._m1=0;else{for(var n=0;t>=e[n+1][0];)n++;this._left=e[n][0],this._right=e[n+1][0];var r=1/(this._right-this._left);this._recip=isFinite(r)?r:0,this._p0=e[n][1],this._p1=e[n+1][1],this._isHermite()&&this._calcTangents(e,n)}else this._left=-1/0,this._right=1/0,this._recip=0,this._p0=this._p1=this._m0=this._m1=0}_isHermite(){return 2===this._curve.type||3===this._curve.type||4===this._curve.type}_calcTangents(t,e){var i,n,r=t[e],s=t[e+1];if(i=0===e?[t[0][0]+(t[0][0]-t[1][0]),t[0][1]+(t[0][1]-t[1][1])]:t[e-1],n=e==t.length-2?[t[e+1][0]+(t[e+1][0]-t[e][0]),t[e+1][1]+(t[e+1][1]-t[e][1])]:t[e+2],4===this._curve.type){var a=2*(s[0]-r[0])/(s[0]-i[0]),o=2*(s[0]-r[0])/(n[0]-r[0]);this._m0=this._curve.tension*(isFinite(a)?a:0)*(s[1]-i[1]),this._m1=this._curve.tension*(isFinite(o)?o:0)*(n[1]-r[1])}else{var l=(s[0]-r[0])/(r[0]-i[0]),h=(s[0]-r[0])/(n[0]-s[0]),c=r[1]+(i[1]-r[1])*(isFinite(l)?l:0),u=s[1]+(n[1]-s[1])*(isFinite(h)?h:0),d=2===this._curve.type?.5:this._curve.tension;this._m0=d*(s[1]-c),this._m1=d*(u-r[1])}}_evaluateHermite(t,e,i,n,r){var s=r*r,a=r+r,o=1-r,l=o*o;return t*((1+a)*l)+i*(r*l)+e*(s*(3-a))+n*(s*(r-1))}}class V{constructor(t){if(this.keys=[],this.type=1,this.tension=.5,this._eval=new j(this),t)for(var e=0;e<t.length-1;e+=2)this.keys.push([t[e],t[e+1]]);this.sort()}add(t,e){for(var i=this.keys,n=i.length,r=0;r<n&&!(i[r][0]>t);r++);var s=[t,e];return this.keys.splice(r,0,s),s}get(t){return this.keys[t]}sort(){this.keys.sort((function(t,e){return t[0]-e[0]}))}value(t){return this._eval.evaluate(t,!0)}closest(t){for(var e=this.keys,i=e.length,n=2,r=null,s=0;s<i;s++){var a=Math.abs(t-e[s][0]);if(!(n>=a))break;n=a,r=e[s]}return r}clone(){var t=new V;return t.keys=u(t.keys,this.keys),t.type=this.type,t.tension=this.tension,t}quantize(t){t=Math.max(t,2);var e=new Float32Array(t),i=1/(t-1);e[0]=this._eval.evaluate(0,!0);for(var n=1;n<t;n++)e[n]=this._eval.evaluate(i*n);return e}quantizeClamped(t,e,i){for(var n=this.quantize(t),r=0;r<n.length;++r)n[r]=Math.min(i,Math.max(e,n[r]));return n}get length(){return this.keys.length}}class U{constructor(){var t;if(this.curves=[],this._type=1,arguments.length>1)for(t=0;t<arguments.length;t++)this.curves.push(new V(arguments[t]));else if(0===arguments.length)this.curves.push(new V);else{var e=arguments[0];if("number"==typeof e)for(t=0;t<e;t++)this.curves.push(new V);else for(t=0;t<e.length;t++)this.curves.push(new V(e[t]))}}get(t){return this.curves[t]}value(t,e=[]){var i=this.curves.length;e.length=i;for(var n=0;n<i;n++)e[n]=this.curves[n].value(t);return e}clone(){var t=new U;t.curves=[];for(var e=0;e<this.curves.length;e++)t.curves.push(this.curves[e].clone());return t._type=this._type,t}quantize(t){t=Math.max(t,2);for(var e=this.curves.length,i=new Float32Array(t*e),n=1/(t-1),r=0;r<e;r++)for(var s=new j(this.curves[r]),a=0;a<t;a++)i[a*e+r]=s.evaluate(n*a);return i}quantizeClamped(t,e,i){for(var n=this.quantize(t),r=0;r<n.length;++r)n[r]=Math.min(i,Math.max(e,n[r]));return n}get length(){return this.curves.length}get type(){return this._type}set type(t){this._type=t;for(var e=0;e<this.curves.length;e++)this.curves[e].type=t}}class G{constructor(){var t;(t=new Float32Array(9))[0]=t[4]=t[8]=1,this.data=t}clone(){return(new G).copy(this)}copy(t){var e=t.data,i=this.data;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this}set(t){var e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this}equals(t){var e=this.data,i=t.data;return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]}isIdentity(){var t=this.data;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]}setIdentity(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}toString(){for(var t="[",e=0;e<9;e++)t+=this.data[e],t+=8!==e?", ":"";return t+="]"}transpose(){var t,e=this.data;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}setFromMat4(t){var e=t.data,i=this.data;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this}}G.IDENTITY=Object.freeze(new G),G.ZERO=Object.freeze((new G).set([0,0,0,0,0,0,0,0,0]));class W{constructor(t=0,e=0){2===t.length?(this.x=t[0],this.y=t[1]):(this.x=t,this.y=e)}add(t){return this.x+=t.x,this.y+=t.y,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}clone(){return new W(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}distance(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}lerp(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this}mul(t){return this.x*=t.x,this.y*=t.y,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this}normalize(){var t=this.x*this.x+this.y*this.y;if(t>0){var e=1/Math.sqrt(t);this.x*=e,this.y*=e}return this}scale(t){return this.x*=t,this.y*=t,this}set(t,e){return this.x=t,this.y=e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}toString(){return"["+this.x+", "+this.y+"]"}}W.ZERO=Object.freeze(new W(0,0)),W.ONE=Object.freeze(new W(1,1)),W.UP=Object.freeze(new W(0,1)),W.DOWN=Object.freeze(new W(0,-1)),W.RIGHT=Object.freeze(new W(1,0)),W.LEFT=Object.freeze(new W(-1,0));class H{constructor(t=0,e=0,i=0){3===t.length?(this.x=t[0],this.y=t[1],this.z=t[2]):(this.x=t,this.y=e,this.z=i)}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}clone(){return new H(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}cross(t,e){var i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-a*r,this.y=r*s-o*i,this.z=i*a-s*n,this}distance(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+i*i+n*n)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}lerp(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}normalize(){var t=this.x*this.x+this.y*this.y+this.z*this.z;if(t>0){var e=1/Math.sqrt(t);this.x*=e,this.y*=e,this.z*=e}return this}project(t){var e=(this.x*t.x+this.y*t.y+this.z*t.z)/(t.x*t.x+t.y*t.y+t.z*t.z);return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}toString(){return"["+this.x+", "+this.y+", "+this.z+"]"}}H.ZERO=Object.freeze(new H(0,0,0)),H.ONE=Object.freeze(new H(1,1,1)),H.UP=Object.freeze(new H(0,1,0)),H.DOWN=Object.freeze(new H(0,-1,0)),H.RIGHT=Object.freeze(new H(1,0,0)),H.LEFT=Object.freeze(new H(-1,0,0)),H.FORWARD=Object.freeze(new H(0,0,-1)),H.BACK=Object.freeze(new H(0,0,1));class X{constructor(t=0,e=0,i=0,n=0){4===t.length?(this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3]):(this.x=t,this.y=e,this.z=i,this.w=n)}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}add2(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}clone(){return new X(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}lerp(t,e,i){return this.x=t.x+i*(e.x-t.x),this.y=t.y+i*(e.y-t.y),this.z=t.z+i*(e.z-t.z),this.w=t.w+i*(e.w-t.w),this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}mul2(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this}normalize(){var t=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;if(t>0){var e=1/Math.sqrt(t);this.x*=e,this.y*=e,this.z*=e,this.w*=e}return this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}sub2(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}toString(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}}X.ZERO=Object.freeze(new X(0,0,0,0)),X.ONE=Object.freeze(new X(1,1,1,1));var Z=new W,Y=new H,q=new H,K=new H,J=new H;class Q{constructor(){var t=new Float32Array(16);t[0]=t[5]=t[10]=t[15]=1,this.data=t}static _getPerspectiveHalfSize(t,e,i,n,r){r?(t.x=n*Math.tan(e*Math.PI/360),t.y=t.x/i):(t.y=n*Math.tan(e*Math.PI/360),t.x=t.y*i)}add2(t,e){var i=t.data,n=e.data,r=this.data;return r[0]=i[0]+n[0],r[1]=i[1]+n[1],r[2]=i[2]+n[2],r[3]=i[3]+n[3],r[4]=i[4]+n[4],r[5]=i[5]+n[5],r[6]=i[6]+n[6],r[7]=i[7]+n[7],r[8]=i[8]+n[8],r[9]=i[9]+n[9],r[10]=i[10]+n[10],r[11]=i[11]+n[11],r[12]=i[12]+n[12],r[13]=i[13]+n[13],r[14]=i[14]+n[14],r[15]=i[15]+n[15],this}add(t){return this.add2(this,t)}clone(){return(new Q).copy(this)}copy(t){var e=t.data,i=this.data;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this}equals(t){var e=this.data,i=t.data;return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}isIdentity(){var t=this.data;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}mul2(t,e){var i,n,r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w=t.data,A=e.data,C=this.data;return i=w[0],n=w[1],r=w[2],s=w[3],a=w[4],o=w[5],l=w[6],h=w[7],c=w[8],u=w[9],d=w[10],f=w[11],p=w[12],m=w[13],g=w[14],v=w[15],_=A[0],y=A[1],b=A[2],x=A[3],C[0]=i*_+a*y+c*b+p*x,C[1]=n*_+o*y+u*b+m*x,C[2]=r*_+l*y+d*b+g*x,C[3]=s*_+h*y+f*b+v*x,_=A[4],y=A[5],b=A[6],x=A[7],C[4]=i*_+a*y+c*b+p*x,C[5]=n*_+o*y+u*b+m*x,C[6]=r*_+l*y+d*b+g*x,C[7]=s*_+h*y+f*b+v*x,_=A[8],y=A[9],b=A[10],x=A[11],C[8]=i*_+a*y+c*b+p*x,C[9]=n*_+o*y+u*b+m*x,C[10]=r*_+l*y+d*b+g*x,C[11]=s*_+h*y+f*b+v*x,_=A[12],y=A[13],b=A[14],x=A[15],C[12]=i*_+a*y+c*b+p*x,C[13]=n*_+o*y+u*b+m*x,C[14]=r*_+l*y+d*b+g*x,C[15]=s*_+h*y+f*b+v*x,this}mulAffine2(t,e){var i,n,r,s,a,o,l,h,c,u,d,f,p,m,g,v=t.data,_=e.data,y=this.data;return i=v[0],n=v[1],r=v[2],s=v[4],a=v[5],o=v[6],l=v[8],h=v[9],c=v[10],u=v[12],d=v[13],f=v[14],p=_[0],m=_[1],g=_[2],y[0]=i*p+s*m+l*g,y[1]=n*p+a*m+h*g,y[2]=r*p+o*m+c*g,y[3]=0,p=_[4],m=_[5],g=_[6],y[4]=i*p+s*m+l*g,y[5]=n*p+a*m+h*g,y[6]=r*p+o*m+c*g,y[7]=0,p=_[8],m=_[9],g=_[10],y[8]=i*p+s*m+l*g,y[9]=n*p+a*m+h*g,y[10]=r*p+o*m+c*g,y[11]=0,p=_[12],m=_[13],g=_[14],y[12]=i*p+s*m+l*g+u,y[13]=n*p+a*m+h*g+d,y[14]=r*p+o*m+c*g+f,y[15]=1,this}mul(t){return this.mul2(this,t)}transformPoint(t,e=new H){var i,n,r,s;return s=this.data,i=t.x,n=t.y,r=t.z,e.x=i*s[0]+n*s[4]+r*s[8]+s[12],e.y=i*s[1]+n*s[5]+r*s[9]+s[13],e.z=i*s[2]+n*s[6]+r*s[10]+s[14],e}transformVector(t,e=new H){var i,n,r,s;return s=this.data,i=t.x,n=t.y,r=t.z,e.x=i*s[0]+n*s[4]+r*s[8],e.y=i*s[1]+n*s[5]+r*s[9],e.z=i*s[2]+n*s[6]+r*s[10],e}transformVec4(t,e=new X){var i,n,r,s,a;return a=this.data,i=t.x,n=t.y,r=t.z,s=t.w,e.x=i*a[0]+n*a[4]+r*a[8]+s*a[12],e.y=i*a[1]+n*a[5]+r*a[9]+s*a[13],e.z=i*a[2]+n*a[6]+r*a[10]+s*a[14],e.w=i*a[3]+n*a[7]+r*a[11]+s*a[15],e}setLookAt(t,e,i){K.sub2(t,e).normalize(),q.copy(i).normalize(),Y.cross(q,K).normalize(),q.cross(K,Y);var n=this.data;return n[0]=Y.x,n[1]=Y.y,n[2]=Y.z,n[3]=0,n[4]=q.x,n[5]=q.y,n[6]=q.z,n[7]=0,n[8]=K.x,n[9]=K.y,n[10]=K.z,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}setFrustum(t,e,i,n,r,s){var a,o,l,h,c;return a=2*r,o=e-t,l=n-i,h=s-r,(c=this.data)[0]=a/o,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a/l,c[6]=0,c[7]=0,c[8]=(e+t)/o,c[9]=(n+i)/l,c[10]=(-s-r)/h,c[11]=-1,c[12]=0,c[13]=0,c[14]=-a*s/h,c[15]=0,this}setPerspective(t,e,i,n,r){return Q._getPerspectiveHalfSize(Z,t,e,i,r),this.setFrustum(-Z.x,Z.x,-Z.y,Z.y,i,n)}setOrtho(t,e,i,n,r,s){var a=this.data;return a[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(n-i),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/(s-r),a[11]=0,a[12]=-(e+t)/(e-t),a[13]=-(n+i)/(n-i),a[14]=-(s+r)/(s-r),a[15]=1,this}setFromAxisAngle(t,e){var i,n,r,s,a,o,l,h,c;return e*=k.DEG_TO_RAD,i=t.x,n=t.y,r=t.z,s=Math.cos(e),a=Math.sin(e),l=(o=1-s)*i,h=o*n,(c=this.data)[0]=l*i+s,c[1]=l*n+a*r,c[2]=l*r-a*n,c[3]=0,c[4]=l*n-a*r,c[5]=h*n+s,c[6]=h*r+a*i,c[7]=0,c[8]=l*r+a*n,c[9]=h*r-i*a,c[10]=o*r*r+s,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this}setTranslate(t,e,i){var n=this.data;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t,n[13]=e,n[14]=i,n[15]=1,this}setScale(t,e,i){var n=this.data;return n[0]=t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}invert(){var t,e,i,n,r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,A,C,I,S,M,T,P,E;return t=(E=this.data)[0],e=E[1],i=E[2],n=E[3],r=E[4],s=E[5],a=E[6],o=E[7],l=E[8],h=E[9],c=E[10],u=E[11],d=E[12],f=E[13],p=E[14],0===(T=(g=t*s-e*r)*(M=c*(m=E[15])-u*p)-(v=t*a-i*r)*(S=h*m-u*f)+(_=t*o-n*r)*(I=h*p-c*f)+(y=e*a-i*s)*(C=l*m-u*d)-(b=e*o-n*s)*(A=l*p-c*d)+(x=i*o-n*a)*(w=l*f-h*d))?this.setIdentity():(P=1/T,E[0]=(s*M-a*S+o*I)*P,E[1]=(-e*M+i*S-n*I)*P,E[2]=(f*x-p*b+m*y)*P,E[3]=(-h*x+c*b-u*y)*P,E[4]=(-r*M+a*C-o*A)*P,E[5]=(t*M-i*C+n*A)*P,E[6]=(-d*x+p*_-m*v)*P,E[7]=(l*x-c*_+u*v)*P,E[8]=(r*S-s*C+o*w)*P,E[9]=(-t*S+e*C-n*w)*P,E[10]=(d*b-f*_+m*g)*P,E[11]=(-l*b+h*_-u*g)*P,E[12]=(-r*I+s*A-a*w)*P,E[13]=(t*I-e*A+i*w)*P,E[14]=(-d*y+f*v-p*g)*P,E[15]=(l*y-h*v+c*g)*P),this}set(t){var e=this.data;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this}setIdentity(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}setTRS(t,e,i){var n,r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w;return n=e.x,r=e.y,s=e.z,a=e.w,o=i.x,l=i.y,h=i.z,f=n*(c=n+n),p=n*(u=r+r),m=n*(d=s+s),g=r*u,v=r*d,_=s*d,y=a*c,b=a*u,x=a*d,(w=this.data)[0]=(1-(g+_))*o,w[1]=(p+x)*o,w[2]=(m-b)*o,w[3]=0,w[4]=(p-x)*l,w[5]=(1-(f+_))*l,w[6]=(v+y)*l,w[7]=0,w[8]=(m+b)*h,w[9]=(v-y)*h,w[10]=(1-(f+g))*h,w[11]=0,w[12]=t.x,w[13]=t.y,w[14]=t.z,w[15]=1,this}transpose(){var t,e=this.data;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}invertTo3x3(t){var e,i,n,r,s,a,o,l,h,c,u,d,f;c=this.data,u=t.data;var p=c[0],m=c[1],g=c[2],v=c[4],_=c[5],y=c[6],b=c[8],x=c[9],w=c[10];return i=-w*m+g*x,n=y*m-g*_,s=w*p-g*b,a=-y*p+g*v,l=-x*p+m*b,h=_*p-m*v,0===(d=p*(e=w*_-y*x)+m*(r=-w*v+y*b)+g*(o=x*v-_*b))||(f=1/d,u[0]=f*e,u[1]=f*i,u[2]=f*n,u[3]=f*r,u[4]=f*s,u[5]=f*a,u[6]=f*o,u[7]=f*l,u[8]=f*h),this}getTranslation(t=new H){return t.set(this.data[12],this.data[13],this.data[14])}getX(t=new H){return t.set(this.data[0],this.data[1],this.data[2])}getY(t=new H){return t.set(this.data[4],this.data[5],this.data[6])}getZ(t=new H){return t.set(this.data[8],this.data[9],this.data[10])}getScale(t=new H){return this.getX(Y),this.getY(q),this.getZ(K),t.set(Y.length(),q.length(),K.length()),t}setFromEulerAngles(t,e,i){var n,r,s,a,o,l,h;return t*=k.DEG_TO_RAD,e*=k.DEG_TO_RAD,i*=k.DEG_TO_RAD,n=Math.sin(-t),r=Math.cos(-t),s=Math.sin(-e),a=Math.cos(-e),o=Math.sin(-i),l=Math.cos(-i),(h=this.data)[0]=a*l,h[1]=-a*o,h[2]=s,h[3]=0,h[4]=r*o+l*n*s,h[5]=r*l-n*s*o,h[6]=-a*n,h[7]=0,h[8]=n*o-r*l*s,h[9]=l*n+r*s*o,h[10]=r*a,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,this}getEulerAngles(t=new H){var e,i,n,r,s,a,o,l;return this.getScale(J),r=J.x,s=J.y,a=J.z,o=this.data,(i=Math.asin(-o[2]/r))<(l=.5*Math.PI)?i>-l?(e=Math.atan2(o[6]/s,o[10]/a),n=Math.atan2(o[1]/r,o[0]/r)):(n=0,e=-Math.atan2(o[4]/s,o[5]/s)):(n=0,e=Math.atan2(o[4]/s,o[5]/s)),t.set(e,i,n).scale(k.RAD_TO_DEG)}toString(){var t,e;for(e="[",t=0;t<16;t+=1)e+=this.data[t],e+=15!==t?", ":"";return e+="]"}}Q.IDENTITY=Object.freeze(new Q),Q.ZERO=Object.freeze((new Q).set([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));class ${constructor(t=0,e=0,i=0,n=1){4===t.length?(this.x=t[0],this.y=t[1],this.z=t[2],this.w=t[3]):(this.x=t,this.y=e,this.z=i,this.w=n)}clone(){return new $(this.x,this.y,this.z,this.w)}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}getAxisAngle(t){var e=2*Math.acos(this.w),i=Math.sin(e/2);return 0!==i?(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i,(t.x<0||t.y<0||t.z<0)&&(t.x*=-1,t.y*=-1,t.z*=-1,e*=-1)):(t.x=1,t.y=0,t.z=0),e*k.RAD_TO_DEG}getEulerAngles(t=new H){var e,i,n,r,s,a,o,l;return r=this.x,s=this.y,a=this.z,(l=2*((o=this.w)*s-r*a))<=-.99999?(e=2*Math.atan2(r,o),i=-Math.PI/2,n=0):l>=.99999?(e=2*Math.atan2(r,o),i=Math.PI/2,n=0):(e=Math.atan2(2*(o*r+s*a),1-2*(r*r+s*s)),i=Math.asin(l),n=Math.atan2(2*(o*a+r*s),1-2*(s*s+a*a))),t.set(e,i,n).scale(k.RAD_TO_DEG)}invert(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}mul(t){var e,i,n,r,s,a,o,l;return e=this.x,i=this.y,n=this.z,r=this.w,s=t.x,a=t.y,o=t.z,l=t.w,this.x=r*s+e*l+i*o-n*a,this.y=r*a+i*l+n*s-e*o,this.z=r*o+n*l+e*a-i*s,this.w=r*l-e*s-i*a-n*o,this}mul2(t,e){var i,n,r,s,a,o,l,h;return i=t.x,n=t.y,r=t.z,s=t.w,a=e.x,o=e.y,l=e.z,h=e.w,this.x=s*a+i*h+n*l-r*o,this.y=s*o+n*h+r*a-i*l,this.z=s*l+r*h+i*o-n*a,this.w=s*h-i*a-n*o-r*l,this}normalize(){var t=this.length();return 0===t?(this.x=this.y=this.z=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setFromAxisAngle(t,e){var i,n;return e*=.5*k.DEG_TO_RAD,i=Math.sin(e),n=Math.cos(e),this.x=i*t.x,this.y=i*t.y,this.z=i*t.z,this.w=n,this}setFromEulerAngles(t,e,i){var n,r,s,a,o,l,h;return t*=h=.5*k.DEG_TO_RAD,e*=h,i*=h,n=Math.sin(t),r=Math.cos(t),s=Math.sin(e),a=Math.cos(e),o=Math.sin(i),l=Math.cos(i),this.x=n*a*l-r*s*o,this.y=r*s*l+n*a*o,this.z=r*a*o-n*s*l,this.w=r*a*l+n*s*o,this}setFromMat4(t){var e,i,n,r,s,a,o,l,h,c,u,d,f,p,m;return e=(t=t.data)[0],i=t[1],n=t[2],r=t[4],s=t[5],a=t[6],o=t[8],l=t[9],h=t[10],0===(f=e*e+i*i+n*n)?this:(f=1/Math.sqrt(f),0===(p=r*r+s*s+a*a)?this:(p=1/Math.sqrt(p),0===(m=o*o+l*l+h*h)||(i*=f,n*=f,r*=p,a*=p,o*=m=1/Math.sqrt(m),l*=m,(c=(e*=f)+(s*=p)+(h*=m))>=0?(u=Math.sqrt(c+1),this.w=.5*u,u=.5/u,this.x=(a-l)*u,this.y=(o-n)*u,this.z=(i-r)*u):e>s?e>h?(d=e-(s+h)+1,d=Math.sqrt(d),this.x=.5*d,d=.5/d,this.w=(a-l)*d,this.y=(i+r)*d,this.z=(n+o)*d):(d=h-(e+s)+1,d=Math.sqrt(d),this.z=.5*d,d=.5/d,this.w=(i-r)*d,this.x=(o+n)*d,this.y=(l+a)*d):s>h?(d=s-(h+e)+1,d=Math.sqrt(d),this.y=.5*d,d=.5/d,this.w=(o-n)*d,this.z=(a+l)*d,this.x=(r+i)*d):(d=h-(e+s)+1,d=Math.sqrt(d),this.z=.5*d,d=.5/d,this.w=(i-r)*d,this.x=(o+n)*d,this.y=(l+a)*d)),this))}slerp(t,e,i){var n,r,s,a,o,l,h,c;n=t.x,r=t.y,s=t.z,a=t.w,o=e.x,l=e.y,h=e.z;var u=a*(c=e.w)+n*o+r*l+s*h;if(u<0&&(c=-c,o=-o,l=-l,h=-h,u=-u),Math.abs(u)>=1)return this.w=a,this.x=n,this.y=r,this.z=s,this;var d=Math.acos(u),f=Math.sqrt(1-u*u);if(Math.abs(f)<.001)return this.w=.5*a+.5*c,this.x=.5*n+.5*o,this.y=.5*r+.5*l,this.z=.5*s+.5*h,this;var p=Math.sin((1-i)*d)/f,m=Math.sin(i*d)/f;return this.w=a*p+c*m,this.x=n*p+o*m,this.y=r*p+l*m,this.z=s*p+h*m,this}transformVector(t,e=new H){var i=t.x,n=t.y,r=t.z,s=this.x,a=this.y,o=this.z,l=this.w,h=l*i+a*r-o*n,c=l*n+o*i-s*r,u=l*r+s*n-a*i,d=-s*i-a*n-o*r;return e.x=h*l+d*-s+c*-o-u*-a,e.y=c*l+d*-a+u*-s-h*-o,e.z=u*l+d*-o+h*-a-c*-s,e}toString(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}}$.IDENTITY=Object.freeze(new $(0,0,0,1)),$.ZERO=Object.freeze(new $(0,0,0,0));var tt=new H,et=new H,it=new H,nt=new H,rt=new H;class st{constructor(t=new H,e=new H(.5,.5,.5)){this.center=t,this.halfExtents=e,this._min=new H,this._max=new H}add(t){var e=this.center,i=e.x,n=e.y,r=e.z,s=this.halfExtents,a=s.x,o=s.y,l=s.z,h=i-a,c=i+a,u=n-o,d=n+o,f=r-l,p=r+l,m=t.center,g=m.x,v=m.y,_=m.z,y=t.halfExtents,b=y.x,x=y.y,w=y.z,A=g-b,C=g+b,I=v-x,S=v+x,M=_-w,T=_+w;A<h&&(h=A),C>c&&(c=C),I<u&&(u=I),S>d&&(d=S),M<f&&(f=M),T>p&&(p=T),e.x=.5*(h+c),e.y=.5*(u+d),e.z=.5*(f+p),s.x=.5*(c-h),s.y=.5*(d-u),s.z=.5*(p-f)}copy(t){this.center.copy(t.center),this.halfExtents.copy(t.halfExtents)}clone(){return new st(this.center.clone(),this.halfExtents.clone())}intersects(t){var e=this.getMax(),i=this.getMin(),n=t.getMax(),r=t.getMin();return i.x<=n.x&&e.x>=r.x&&i.y<=n.y&&e.y>=r.y&&i.z<=n.z&&e.z>=r.z}_intersectsRay(t,e){var i=tt.copy(this.getMin()).sub(t.origin),n=et.copy(this.getMax()).sub(t.origin),r=t.direction;0===r.x?(i.x=i.x<0?-Number.MAX_VALUE:Number.MAX_VALUE,n.x=n.x<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.x/=r.x,n.x/=r.x),0===r.y?(i.y=i.y<0?-Number.MAX_VALUE:Number.MAX_VALUE,n.y=n.y<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.y/=r.y,n.y/=r.y),0===r.z?(i.z=i.z<0?-Number.MAX_VALUE:Number.MAX_VALUE,n.z=n.z<0?-Number.MAX_VALUE:Number.MAX_VALUE):(i.z/=r.z,n.z/=r.z);var s=it.set(Math.min(i.x,n.x),Math.min(i.y,n.y),Math.min(i.z,n.z)),a=nt.set(Math.max(i.x,n.x),Math.max(i.y,n.y),Math.max(i.z,n.z)),o=Math.min(Math.min(a.x,a.y),a.z),l=Math.max(Math.max(s.x,s.y),s.z),h=o>=l&&l>=0;return h&&e.copy(t.direction).scale(l).add(t.origin),h}_fastIntersectsRay(t){var e=tt,i=et,n=it,r=nt,s=rt,a=t.direction;return e.sub2(t.origin,this.center),r.set(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),n.mul2(e,a),!(r.x>this.halfExtents.x&&n.x>=0)&&(!(r.y>this.halfExtents.y&&n.y>=0)&&(!(r.z>this.halfExtents.z&&n.z>=0)&&(s.set(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z)),i.cross(a,e),i.set(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z)),!(i.x>this.halfExtents.y*s.z+this.halfExtents.z*s.y)&&(!(i.y>this.halfExtents.x*s.z+this.halfExtents.z*s.x)&&!(i.z>this.halfExtents.x*s.y+this.halfExtents.y*s.x)))))}intersectsRay(t,e){return e?this._intersectsRay(t,e):this._fastIntersectsRay(t)}setMinMax(t,e){this.center.add2(e,t).scale(.5),this.halfExtents.sub2(e,t).scale(.5)}getMin(){return this._min.copy(this.center).sub(this.halfExtents)}getMax(){return this._max.copy(this.center).add(this.halfExtents)}containsPoint(t){var e=this.getMin(),i=this.getMax();return!(t.x<e.x||t.x>i.x||t.y<e.y||t.y>i.y||t.z<e.z||t.z>i.z)}setFromTransformedAabb(t,e){var i=t.center,n=t.halfExtents,r=e.data,s=r[0],a=r[4],o=r[8],l=r[1],h=r[5],c=r[9],u=r[2],d=r[6],f=r[10];this.center.set(r[12]+s*i.x+a*i.y+o*i.z,r[13]+l*i.x+h*i.y+c*i.z,r[14]+u*i.x+d*i.y+f*i.z),this.halfExtents.set(Math.abs(s)*n.x+Math.abs(a)*n.y+Math.abs(o)*n.z,Math.abs(l)*n.x+Math.abs(h)*n.y+Math.abs(c)*n.z,Math.abs(u)*n.x+Math.abs(d)*n.y+Math.abs(f)*n.z)}compute(t,e){if((e=void 0===e?t.length/3:e)>0){for(var i=tt.set(t[0],t[1],t[2]),n=et.set(t[0],t[1],t[2]),r=1;r<e;r++){var s=t[3*r+0],a=t[3*r+1],o=t[3*r+2];s<i.x&&(i.x=s),a<i.y&&(i.y=a),o<i.z&&(i.z=o),s>n.x&&(n.x=s),a>n.y&&(n.y=a),o>n.z&&(n.z=o)}this.setMinMax(i,n)}}intersectsBoundingSphere(t){return this._distanceToBoundingSphereSq(t)<=t.radius*t.radius}_distanceToBoundingSphereSq(t){for(var e=this.getMin(),i=this.getMax(),n=0,r=["x","y","z"],s=0;s<3;++s){var a=0,o=t.center[r[s]],l=e[r[s]],h=i[r[s]],c=0;o<l&&(a+=(c=l-o)*c),o>h&&(a+=(c=o-h)*c),n+=a}return n}_expand(t,e){tt.add2(this.getMin(),t),et.add2(this.getMax(),e),this.setMinMax(tt,et)}}var at=new H,ot=new H,lt=new H,ht=new H;class ct{constructor(t=new H,e=.5){this.center=t,this.radius=e}containsPoint(t){var e=at.sub2(t,this.center).lengthSq(),i=this.radius;return e<i*i}compute(t){var e,i=t.length/3,n=at,r=ot,s=lt;for(e=0;e<i;e++)n.set(t[3*e],t[3*e+1],t[3*e+2]),s.addSelf(n),e%100==0&&(s.scale(1/i),r.add(s),s.set(0,0,0));s.scale(1/i),r.add(s),this.center.copy(r);var a=0,o=ht;for(e=0;e<i;e++)n.set(t[3*e],t[3*e+1],t[3*e+2]),o.sub2(n,this.center),a=Math.max(o.lengthSq(),a);this.radius=Math.sqrt(a)}intersectsRay(t,e){var i=at.copy(t.origin).sub(this.center),n=i.dot(ot.copy(t.direction).normalize()),r=i.dot(i)-this.radius*this.radius;if(r>0&&n>0)return null;var s=n*n-r;if(s<0)return!1;var a=Math.abs(-n-Math.sqrt(s));return e&&e.copy(t.direction).scale(a).add(t.origin),!0}intersectsBoundingSphere(t){at.sub2(t.center,this.center);var e=t.radius+this.radius;return at.lengthSq()<=e*e}}class ut{constructor(){this.planes=[];for(var t=0;t<6;t++)this.planes[t]=[]}setFromMat4(t){var e,i=t.data,n=this.planes;(e=n[0])[0]=i[3]-i[0],e[1]=i[7]-i[4],e[2]=i[11]-i[8],e[3]=i[15]-i[12];var r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=r,e[1]/=r,e[2]/=r,e[3]/=r,(e=n[1])[0]=i[3]+i[0],e[1]=i[7]+i[4],e[2]=i[11]+i[8],e[3]=i[15]+i[12],r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),e[0]/=r,e[1]/=r,e[2]/=r,e[3]/=r,(e=n[2])[0]=i[3]+i[1],e[1]=i[7]+i[5],e[2]=i[11]+i[9],e[3]=i[15]+i[13],r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),e[0]/=r,e[1]/=r,e[2]/=r,e[3]/=r,(e=n[3])[0]=i[3]-i[1],e[1]=i[7]-i[5],e[2]=i[11]-i[9],e[3]=i[15]-i[13],r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),e[0]/=r,e[1]/=r,e[2]/=r,e[3]/=r,(e=n[4])[0]=i[3]-i[2],e[1]=i[7]-i[6],e[2]=i[11]-i[10],e[3]=i[15]-i[14],r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),e[0]/=r,e[1]/=r,e[2]/=r,e[3]/=r,(e=n[5])[0]=i[3]+i[2],e[1]=i[7]+i[6],e[2]=i[11]+i[10],e[3]=i[15]+i[14],r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),e[0]/=r,e[1]/=r,e[2]/=r,e[3]/=r}containsPoint(t){var e,i;for(e=0;e<6;e++)if((i=this.planes[e])[0]*t.x+i[1]*t.y+i[2]*t.z+i[3]<=0)return!1;return!0}containsSphere(t){var e,i,n,r=0,s=t.radius,a=t.center,o=a.x,l=a.y,h=a.z,c=this.planes;for(i=0;i<6;i++){if((e=(n=c[i])[0]*o+n[1]*l+n[2]*h+n[3])<=-s)return 0;e>s&&r++}return 6===r?2:1}}class dt{constructor(t=new H,e=new H(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}}new dt,new H,new ct,new Q;new H;const ft=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array],pt=[1,1,2,2,4,4,4],mt=[Uint8Array,Uint16Array,Uint32Array],gt={POSITION:0,NORMAL:1,BLENDWEIGHT:2,BLENDINDICES:3,COLOR:4,TEXCOORD0:5,TEXCOORD1:6,TEXCOORD2:7,TEXCOORD3:8,TEXCOORD4:9,TEXCOORD5:10,TEXCOORD6:11,TEXCOORD7:12,TANGENT:13,ATTR0:0,ATTR1:1,ATTR2:2,ATTR3:3,ATTR4:4,ATTR5:5,ATTR6:6,ATTR7:7,ATTR8:8,ATTR9:9,ATTR10:10,ATTR11:11,ATTR12:12,ATTR13:13,ATTR14:14,ATTR15:15};let vt=0;class _t{constructor(t,e,i,n=0,r){this.device=t,this.format=e,this.numVertices=i,this.usage=n,this.id=vt++,this._vao=null,this.numBytes=e.verticesByteSize?e.verticesByteSize:e.size*i,t._vram.vb+=this.numBytes,r?this.setData(r):this.storage=new ArrayBuffer(this.numBytes),this.device.buffers.push(this)}destroy(){var t=this.device,e=t.buffers.indexOf(this);if(-1!==e&&t.buffers.splice(e,1),this.bufferId){var i=t.gl;t.boundVao=null,i.bindVertexArray(null),i.deleteBuffer(this.bufferId),t._vram.vb-=this.storage.byteLength,this.bufferId=null}}loseContext(){this.bufferId=void 0,this._vao=null}getFormat(){return this.format}getUsage(){return this.usage}getNumVertices(){return this.numVertices}lock(){return this.storage}unlock(){var t,e=this.device.gl;switch(this.bufferId||(this.bufferId=e.createBuffer()),this.usage){case 0:t=e.STATIC_DRAW;break;case 1:t=e.DYNAMIC_DRAW;break;case 2:t=e.STREAM_DRAW;break;case 3:t=this.device.webgl2?e.DYNAMIC_COPY:e.STATIC_DRAW}e.bindBuffer(e.ARRAY_BUFFER,this.bufferId),e.bufferData(e.ARRAY_BUFFER,this.storage,t)}setData(t){return t.byteLength!==this.numBytes?(console.error("VertexBuffer: wrong initial data size: expected "+this.numBytes+", got "+t.byteLength),!1):(this.storage=t,this.unlock(),!0)}}function yt(t){for(var e=0,i=0,n=t.length;i<n;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}class bt{constructor(t,e,i){var n,r,s;this.elements=[],this.hasUv0=!1,this.hasUv1=!1,this.hasColor=!1,this.hasTangents=!1,this.verticesByteSize=0,this.vertexCount=i,this.interleaved=void 0===i,this.size=e.reduce((t,e)=>t+4*Math.ceil(e.components*pt[e.type]/4),0);var a,o=0;for(n=0,r=e.length;n<r;n++){var l=e[n];a=l.components*pt[l.type],i&&(o=k.roundUp(o,a)),s={name:l.semantic,offset:i?o:l.hasOwnProperty("offset")?l.offset:o,stride:i?a:l.hasOwnProperty("stride")?l.stride:this.size,dataType:l.type,numComponents:l.components,normalize:void 0!==l.normalize&&l.normalize,size:a},this.elements.push(s),o+=i?a*i:4*Math.ceil(a/4),"TEXCOORD0"===l.semantic?this.hasUv0=!0:"TEXCOORD1"===l.semantic?this.hasUv1=!0:"COLOR"===l.semantic?this.hasColor=!0:"TANGENT"===l.semantic&&(this.hasTangents=!0)}i&&(this.verticesByteSize=o),this.update()}static init(t){var e=[{semantic:"TEXCOORD2",components:4,type:6},{semantic:"TEXCOORD3",components:4,type:6},{semantic:"TEXCOORD4",components:4,type:6},{semantic:"TEXCOORD5",components:4,type:6}];bt._defaultInstancingFormat=new bt(t,e)}static get defaultInstancingFormat(){return bt._defaultInstancingFormat}update(){this._evaluateHash()}_evaluateHash(){var t,e,i,n,r=[],s=[],a=this.elements.length;for(i=0;i<a;i++)t=(n=this.elements[i]).name,t+=n.dataType,t+=n.numComponents,t+=n.normalize,r.push(t),e=t,e+=n.offset,e+=n.stride,e+=n.size,s.push(e);r.sort(),this.batchingHash=yt(r.join()),this.renderingingHash=yt(s.join())}}function xt(t){this.array[this.index]=t}function wt(t,e){this.array[this.index]=t,this.array[this.index+1]=e}function At(t,e,i){this.array[this.index]=t,this.array[this.index+1]=e,this.array[this.index+2]=i}function Ct(t,e,i,n){this.array[this.index]=t,this.array[this.index+1]=e,this.array[this.index+2]=i,this.array[this.index+3]=n}function It(t,e,i){this.array[t]=e[i]}function St(t,e,i){this.array[t]=e[i],this.array[t+1]=e[i+1]}function Mt(t,e,i){this.array[t]=e[i],this.array[t+1]=e[i+1],this.array[t+2]=e[i+2]}function Tt(t,e,i){this.array[t]=e[i],this.array[t+1]=e[i+1],this.array[t+2]=e[i+2],this.array[t+3]=e[i+3]}function Pt(t,e,i){e[i]=this.array[t]}function Et(t,e,i){e[i]=this.array[t],e[i+1]=this.array[t+1]}function kt(t,e,i){e[i]=this.array[t],e[i+1]=this.array[t+1],e[i+2]=this.array[t+2]}function Dt(t,e,i){e[i]=this.array[t],e[i+1]=this.array[t+1],e[i+2]=this.array[t+2],e[i+3]=this.array[t+3]}bt._defaultInstancingFormat=null;class Ot{constructor(t,e,i){switch(this.index=0,this.numComponents=e.numComponents,i.interleaved?this.array=new ft[e.dataType](t,e.offset):this.array=new ft[e.dataType](t,e.offset,i.vertexCount*e.numComponents),this.stride=e.stride/this.array.constructor.BYTES_PER_ELEMENT,e.numComponents){case 1:this.set=xt,this.getToArray=Pt,this.setFromArray=It;break;case 2:this.set=wt,this.getToArray=Et,this.setFromArray=St;break;case 3:this.set=At,this.getToArray=kt,this.setFromArray=Mt;break;case 4:this.set=Ct,this.getToArray=Dt,this.setFromArray=Tt}}get(t){return this.array[this.index+t]}set(t,e,i,n){}getToArray(t,e,i){}setFromArray(t,e,i){}}class Rt{constructor(t){this.vertexBuffer=t,this.vertexFormatSize=t.getFormat().size,this.buffer=this.vertexBuffer.lock(),this.accessors=[],this.element={};for(var e=this.vertexBuffer.getFormat(),i=0;i<e.elements.length;i++){var n=e.elements[i];this.accessors[i]=new Ot(this.buffer,n,e),this.element[n.name]=this.accessors[i]}}next(t=1){for(var e=0,i=this.accessors,n=this.accessors.length;e<n;){var r=i[e++];r.index+=t*r.stride}}end(){this.vertexBuffer.unlock()}writeData(t,e,i){var n=this.element[t];if(n){i>this.vertexBuffer.numVertices&&(i=this.vertexBuffer.numVertices);var r,s=n.numComponents;if(this.vertexBuffer.getFormat().interleaved){var a=0;for(r=0;r<i;r++)n.setFromArray(a,e,r*s),a+=n.stride}else if(e.length>i*s){var o=i*s;if(ArrayBuffer.isView(e))e=e.subarray(0,o),n.array.set(e);else for(r=0;r<o;r++)n.array[r]=e[r]}else n.array.set(e)}}readData(t,e){var i=this.element[t],n=0;if(i){n=this.vertexBuffer.numVertices;var r,s=i.numComponents;if(this.vertexBuffer.getFormat().interleaved){Array.isArray(e)&&(e.length=0),i.index=0;var a=0;for(r=0;r<n;r++)i.getToArray(a,e,r*s),a+=i.stride}else if(ArrayBuffer.isView(e))e.set(i.array);else{e.length=0;var o=n*s;for(r=0;r<o;r++)e[r]=i.array[r]}}return n}}var Lt=null,Nt={type:5,base:0,count:4,indexed:!1};function zt(t,e,i,n,r,s=!1){if(null===Lt){var a=new bt(t,[{semantic:"POSITION",components:2,type:6}]);Lt=new _t(t,a,4);var o=new Rt(Lt);o.element.POSITION.set(-1,-1),o.next(),o.element.POSITION.set(1,-1),o.next(),o.element.POSITION.set(-1,1),o.next(),o.element.POSITION.set(1,1),o.end()}var l,h,c,u,d,f,p,m,g=t.renderTarget;t.setRenderTarget(e),t.updateBegin(),n?(l=n.x,h=n.y,c=n.z,u=n.w):(c=e?e.width:t.width,u=e?e.height:t.height,l=0,h=0),r?(d=r.x,f=r.y,p=r.z,m=r.w):(d=l,f=h,p=c,m=u);var v=t.vx,_=t.vy,y=t.vw,b=t.vh;t.setViewport(l,h,c,u);var x=t.sx,w=t.sy,A=t.sw,C=t.sh;t.setScissor(d,f,p,m);var I=t.getDepthTest(),S=t.getDepthWrite(),M=t.getCullMode(),T=t.writeRed,P=t.writeGreen,E=t.writeBlue,k=t.writeAlpha;t.setDepthTest(!1),t.setDepthWrite(!1),t.setCullMode(0),t.setColorWrite(!0,!0,!0,!0),s||t.setBlending(!1),t.setVertexBuffer(Lt,0),t.setShader(i),t.draw(Nt),t.setDepthTest(I),t.setDepthWrite(S),t.setCullMode(M),t.setColorWrite(T,P,E,k),t.updateEnd(),t.setRenderTarget(g),t.updateBegin(),t.setViewport(v,_,y,b),t.setScissor(x,w,A,C)}class Bt{constructor(t,e){this.device=t,this.definition=e,this.init(),this.device.createShader(this)}init(){this.attributes=[],this.uniforms=[],this.samplers=[],this.ready=!1,this.failed=!1}destroy(){this.device.destroyShader(this)}loseContext(){this.init()}}var Ft={alphaTestPS:"uniform float alpha_ref;\nvoid alphaTest(float a) {\n\tif (a < alpha_ref) discard;\n}\n",ambientConstantPS:"void addAmbient() {\n\tdDiffuseLight += light_globalAmbient;\n}\n",ambientPrefilteredCubePS:"#ifndef PMREM4\n#define PMREM4\nuniform samplerCube texture_prefilteredCubeMap4;\n#endif\nvoid addAmbient() {\n\tvec3 fixedReflDir = fixSeamsStatic(cubeMapRotate(dNormalW), 1.0 - 1.0 / 4.0);\n#ifndef RIGHT_HANDED_CUBEMAP\n\tfixedReflDir.x *= -1.0;\n#endif\n\tdDiffuseLight += processEnvironment($DECODE(textureCube(texture_prefilteredCubeMap4, fixedReflDir)).rgb);\n}\n",ambientPrefilteredCubeLodPS:"#ifndef PMREM4\n#define PMREM4\n#extension GL_EXT_shader_texture_lod : enable\nuniform samplerCube texture_prefilteredCubeMap128;\n#endif\nvoid addAmbient() {\n\tvec3 fixedReflDir = fixSeamsStatic(cubeMapRotate(dNormalW), 1.0 - 1.0 / 4.0);\n#ifndef RIGHT_HANDED_CUBEMAP\n\tfixedReflDir.x *= -1.0;\n#endif\n\tdDiffuseLight += processEnvironment($DECODE( textureCubeLodEXT(texture_prefilteredCubeMap128, fixedReflDir, 5.0) ).rgb);\n}\n",ambientSHPS:"uniform vec3 ambientSH[9];\nvoid addAmbient() {\n\tvec3 n = cubeMapRotate(dNormalW);\n\tvec3 color =\n\t\tambientSH[0] +\n\t\tambientSH[1] * n.x +\n\t\tambientSH[2] * n.y +\n\t\tambientSH[3] * n.z +\n\t\tambientSH[4] * n.x * n.z +\n\t\tambientSH[5] * n.z * n.y +\n\t\tambientSH[6] * n.y * n.x +\n\t\tambientSH[7] * (3.0 * n.z * n.z - 1.0) +\n\t\tambientSH[8] * (n.x * n.x - n.y * n.y);\n\tdDiffuseLight += processEnvironment(max(color, vec3(0.0)));\n}\n",aoPS:"#ifdef MAPTEXTURE\nuniform sampler2D texture_aoMap;\n#endif\nvoid applyAO() {\n\tdAo = 1.0;\n\t#ifdef MAPTEXTURE\n\tdAo *= texture2D(texture_aoMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdAo *= saturate(vVertexColor.$VC);\n\t#endif\n\tdDiffuseLight *= dAo;\n}\n",aoSpecOccPS:"uniform float material_occludeSpecularIntensity;\nvoid occludeSpecular() {\n\tfloat specPow = exp2(dGlossiness * 11.0);\n\tfloat specOcc = saturate(pow(dot(dNormalW, dViewDirW) + dAo, 0.01*specPow) - 1.0 + dAo);\n\tspecOcc = mix(1.0, specOcc, material_occludeSpecularIntensity);\n\tdSpecularLight *= specOcc;\n\tdReflection *= specOcc;\n}\n",aoSpecOccConstPS:"void occludeSpecular() {\n\tfloat specPow = exp2(dGlossiness * 11.0);\n\tfloat specOcc = saturate(pow(dot(dNormalW, dViewDirW) + dAo, 0.01*specPow) - 1.0 + dAo);\n\tdSpecularLight *= specOcc;\n\tdReflection *= specOcc;\n}\n",aoSpecOccConstSimplePS:"void occludeSpecular() {\n\tfloat specOcc = dAo;\n\tdSpecularLight *= specOcc;\n\tdReflection *= specOcc;\n}\n",aoSpecOccSimplePS:"uniform float material_occludeSpecularIntensity;\nvoid occludeSpecular() {\n\tfloat specOcc = mix(1.0, dAo, material_occludeSpecularIntensity);\n\tdSpecularLight *= specOcc;\n\tdReflection *= specOcc;\n}\n",bakeDirLmEndPS:"\tvec4 dirLm = texture2D(texture_dirLightMap, vUv1);\n\tif (bakeDir > 0.5) {\n\t\tif (dAtten > 0.00001) {\n\t\t\tdirLm.xyz = dirLm.xyz * 2.0 - vec3(1.0);\n\t\t\tdAtten = saturate(dAtten);\n\t\t\tgl_FragColor.rgb = normalize(dLightDirNormW.xyz*dAtten + dirLm.xyz*dirLm.w) * 0.5 + vec3(0.5);\n\t\t\tgl_FragColor.a = dirLm.w + dAtten;\n\t\t\tgl_FragColor.a = max(gl_FragColor.a, 1.0 / 255.0);\n\t\t} else {\n\t\t\tgl_FragColor = dirLm;\n\t\t}\n\t} else {\n\t\tgl_FragColor.rgb = dirLm.xyz;\n\t\tgl_FragColor.a = max(dirLm.w, dAtten > 0.00001? (1.0/255.0) : 0.0);\n\t}\n",bakeLmEndPS:"\tgl_FragColor.rgb = dDiffuseLight;\n\tgl_FragColor.rgb = pow(gl_FragColor.rgb, vec3(0.5));\n\tgl_FragColor.rgb /= 8.0;\n\tgl_FragColor.a = clamp( max( max( gl_FragColor.r, gl_FragColor.g ), max( gl_FragColor.b, 1.0 / 255.0 ) ), 0.0,1.0 );\n\tgl_FragColor.a = ceil(gl_FragColor.a * 255.0) / 255.0;\n\tgl_FragColor.rgb /= gl_FragColor.a;\n",basePS:"uniform vec3 view_position;\nuniform vec3 light_globalAmbient;\nfloat square(float x) {\n\treturn x*x;\n}\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec3 saturate(vec3 x) {\n\treturn clamp(x, vec3(0.0), vec3(1.0));\n}\n",baseVS:"attribute vec3 vertex_position;\nattribute vec3 vertex_normal;\nattribute vec4 vertex_tangent;\nattribute vec2 vertex_texCoord0;\nattribute vec2 vertex_texCoord1;\nattribute vec4 vertex_color;\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\nuniform mat3 matrix_normal;\nvec3 dPositionW;\nmat4 dModelMatrix;\nmat3 dNormalMatrix;\nvec3 dLightPosW;\nvec3 dLightDirNormW;\nvec3 dNormalW;\n",baseNineSlicedPS:"#define NINESLICED\nvarying vec2 vMask;\nvarying vec2 vTiledUv;\nuniform mediump vec4 innerOffset;\nuniform mediump vec2 outerScale;\nuniform mediump vec4 atlasRect;\nvec2 nineSlicedUv;\n",baseNineSlicedVS:"#define NINESLICED\nvarying vec2 vMask;\nvarying vec2 vTiledUv;\nuniform mediump vec4 innerOffset;\nuniform mediump vec2 outerScale;\nuniform mediump vec4 atlasRect;\n",baseNineSlicedTiledPS:"#define NINESLICED\n#define NINESLICETILED\nvarying vec2 vMask;\nvarying vec2 vTiledUv;\nuniform mediump vec4 innerOffset;\nuniform mediump vec2 outerScale;\nuniform mediump vec4 atlasRect;\nvec2 nineSlicedUv;\n",biasConstPS:"#define SHADOWBIAS\nfloat getShadowBias(float resolution, float maxBias) {\n\treturn maxBias;\n}\n",blurVSMPS:"varying vec2 vUv0;\nuniform sampler2D source;\nuniform vec2 pixelOffset;\n#ifdef GAUSS\nuniform float weight[SAMPLES];\n#endif\n#ifdef PACKED\nfloat decodeFloatRG(vec2 rg) {\n\treturn rg.y*(1.0/255.0) + rg.x;\n}\nvec2 encodeFloatRG( float v ) {\n\tvec2 enc = vec2(1.0, 255.0) * v;\n\tenc = fract(enc);\n\tenc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\n\treturn enc;\n}\n#endif\nvoid main(void) {\n\tvec3 moments = vec3(0.0);\n\tvec2 uv = vUv0 - pixelOffset * (float(SAMPLES) * 0.5);\n\tfor (int i=0; i<SAMPLES; i++) {\n\t\tvec4 c = texture2D(source, uv + pixelOffset * float(i));\n\t\t#ifdef PACKED\n\t\tc.xy = vec2(decodeFloatRG(c.xy), decodeFloatRG(c.zw));\n\t\t#endif\n\t\t#ifdef GAUSS\n\t\tmoments += c.xyz * weight[i];\n\t\t#else\n\t\tmoments += c.xyz;\n\t\t#endif\n\t}\n\t#ifndef GAUSS\n\tmoments /= float(SAMPLES);\n\t#endif\n\t#ifdef PACKED\n\tgl_FragColor = vec4(encodeFloatRG(moments.x), encodeFloatRG(moments.y));\n\t#else\n\tgl_FragColor = vec4(moments.x, moments.y, moments.z, 1.0);\n\t#endif\n}\n",clearCoatPS:"#ifdef MAPFLOAT\nuniform float material_clearCoat;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_clearCoatMap;\n#endif\nvoid getClearCoat() {\n\tccSpecularity = 1.0;\n\t#ifdef MAPFLOAT\n\tccSpecularity *= material_clearCoat;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tccSpecularity *= texture2D(texture_clearCoatMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tccSpecularity *= saturate(vVertexColor.$VC);\n\t#endif\n}\n",clearCoatGlossPS:"#ifdef MAPFLOAT\nuniform float material_clearCoatGlossiness;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_clearCoatGlossMap;\n#endif\nvoid getClearCoatGlossiness() {\n\tccGlossiness = 1.0;\n\t#ifdef MAPFLOAT\n\tccGlossiness *= material_clearCoatGlossiness;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tccGlossiness *= texture2D(texture_clearCoatGlossMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tccGlossiness *= saturate(vVertexColor.$VC);\n\t#endif\n\tccGlossiness += 0.0000001;\n}\n",clearCoatNormalPS:"#ifdef MAPTEXTURE\nuniform sampler2D texture_clearCoatNormalMap;\nuniform float material_clearCoatBumpiness;\n#endif\nvoid getClearCoatNormal() {\n\t#ifdef MAPTEXTURE\n\tvec3 normalMap = unpackNormal(texture2D(texture_clearCoatNormalMap, $UV));\n\tnormalMap = normalize(mix(vec3(0.0, 0.0, 1.0), normalMap, material_clearCoatBumpiness));\n\tccNormalW = dTBN * normalMap;\n\t#else\n\tccNormalW = normalize(dVertexNormalW);\n\t#endif\n\tccReflDirW = normalize(-reflect(dViewDirW, ccNormalW));\n}\n",combineClearCoatPS:"vec3 combineColorCC() {\n\treturn combineColor()+(ccSpecularLight*ccSpecularity+ccReflection.rgb*ccSpecularity*ccReflection.a);\n}\n",combineDiffusePS:"vec3 combineColor() {\n\treturn dAlbedo * dDiffuseLight;\n}\n",combineDiffuseSpecularPS:"vec3 combineColor() {\n\treturn mix(dAlbedo * dDiffuseLight, dSpecularLight + dReflection.rgb * dReflection.a, dSpecularity);\n}\n",combineDiffuseSpecularNoConservePS:"vec3 combineColor() {\n\treturn dAlbedo * dDiffuseLight + (dSpecularLight + dReflection.rgb * dReflection.a) * dSpecularity;\n}\n",combineDiffuseSpecularNoReflPS:"vec3 combineColor() {\n\treturn dAlbedo * dDiffuseLight + dSpecularLight * dSpecularity;\n}\n",combineDiffuseSpecularNoReflSeparateAmbientPS:"uniform vec3 material_ambient;\nvec3 combineColor() {\n\treturn (dDiffuseLight - light_globalAmbient) * dAlbedo + dSpecularLight * dSpecularity + material_ambient * light_globalAmbient;\n}\n",combineDiffuseSpecularOldPS:"vec3 combineColor() {\n\treturn mix(dAlbedo * dDiffuseLight + dSpecularLight * dSpecularity, dReflection.rgb, dReflection.a);\n}\n",cookiePS:"vec4 getCookie2D(sampler2D tex, mat4 transform, float intensity) {\n\tvec4 projPos = transform * vec4(vPositionW, 1.0);\n\tprojPos.xy /= projPos.w;\n\treturn mix(vec4(1.0), texture2D(tex, projPos.xy), intensity);\n}\nvec4 getCookie2DClip(sampler2D tex, mat4 transform, float intensity) {\n\tvec4 projPos = transform * vec4(vPositionW, 1.0);\n\tprojPos.xy /= projPos.w;\n\tif (projPos.x < 0.0 || projPos.x > 1.0 || projPos.y < 0.0 || projPos.y > 1.0 || projPos.z < 0.0) return vec4(0.0);\n\treturn mix(vec4(1.0), texture2D(tex, projPos.xy), intensity);\n}\nvec4 getCookie2DXform(sampler2D tex, mat4 transform, float intensity, vec4 cookieMatrix, vec2 cookieOffset) {\n\tvec4 projPos = transform * vec4(vPositionW, 1.0);\n\tprojPos.xy /= projPos.w;\n\tprojPos.xy += cookieOffset;\n\tvec2 uv = mat2(cookieMatrix) * (projPos.xy-vec2(0.5)) + vec2(0.5);\n\treturn mix(vec4(1.0), texture2D(tex, uv), intensity);\n}\nvec4 getCookie2DClipXform(sampler2D tex, mat4 transform, float intensity, vec4 cookieMatrix, vec2 cookieOffset) {\n\tvec4 projPos = transform * vec4(vPositionW, 1.0);\n\tprojPos.xy /= projPos.w;\n\tprojPos.xy += cookieOffset;\n\tif (projPos.x < 0.0 || projPos.x > 1.0 || projPos.y < 0.0 || projPos.y > 1.0 || projPos.z < 0.0) return vec4(0.0);\n\tvec2 uv = mat2(cookieMatrix) * (projPos.xy-vec2(0.5)) + vec2(0.5);\n\treturn mix(vec4(1.0), texture2D(tex, uv), intensity);\n}\nvec4 getCookieCube(samplerCube tex, mat4 transform, float intensity) {\n\treturn mix(vec4(1.0), textureCube(tex, dLightDirNormW * mat3(transform)), intensity);\n}\n",cubeMapProjectBoxPS:"uniform vec3 envBoxMin, envBoxMax;\nvec3 cubeMapProject(vec3 nrdir) {\n\tnrdir = cubeMapRotate(nrdir);\n\tvec3 rbmax = (envBoxMax - vPositionW) / nrdir;\n\tvec3 rbmin = (envBoxMin - vPositionW) / nrdir;\n\tvec3 rbminmax;\n\trbminmax.x = nrdir.x>0.0? rbmax.x : rbmin.x;\n\trbminmax.y = nrdir.y>0.0? rbmax.y : rbmin.y;\n\trbminmax.z = nrdir.z>0.0? rbmax.z : rbmin.z;\n\tfloat fa = min(min(rbminmax.x, rbminmax.y), rbminmax.z);\n\tvec3 posonbox = vPositionW + nrdir * fa;\n\tvec3 envBoxPos = (envBoxMin + envBoxMax) * 0.5;\n\treturn posonbox - envBoxPos;\n}\n",cubeMapProjectNonePS:"vec3 cubeMapProject(vec3 dir) {\n\treturn cubeMapRotate(dir);\n}\n",cubeMapRotatePS:"#ifdef CUBEMAP_ROTATION\nuniform mat3 cubeMapRotationMatrix;\n#endif\nvec3 cubeMapRotate(vec3 refDir) {\n#ifdef CUBEMAP_ROTATION\n\treturn refDir * cubeMapRotationMatrix;\n#else\n\treturn refDir;\n#endif\n}\n",detailModesPS:"vec3 detailMode_mul(vec3 c1, vec3 c2) {\n\treturn c1 * c2;\n}\nvec3 detailMode_add(vec3 c1, vec3 c2) {\n\treturn c1 + c2;\n}\nvec3 detailMode_screen(vec3 c1, vec3 c2) {\n\treturn 1.0 - (1.0 - c1)*(1.0 - c2);\n}\nvec3 detailMode_overlay(vec3 c1, vec3 c2) {\n\treturn mix(1.0 - 2.0*(1.0 - c1)*(1.0 - c2), 2.0*c1*c2, step(c1, vec3(0.5)));\n}\nvec3 detailMode_min(vec3 c1, vec3 c2) {\n\treturn min(c1, c2);\n}\nvec3 detailMode_max(vec3 c1, vec3 c2) {\n\treturn max(c1, c2);\n}\n",diffusePS:"#ifdef MAPCOLOR\nuniform vec3 material_diffuse;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_diffuseMap;\n#endif\nvoid getAlbedo() {\n\tdAlbedo = vec3(1.0);\n\t#ifdef MAPCOLOR\n\tdAlbedo *= material_diffuse.rgb;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tdAlbedo *= gammaCorrectInput(addAlbedoDetail(texture2D(texture_diffuseMap, $UV).$CH));\n\t#endif\n\t#ifdef MAPVERTEX\n\tdAlbedo *= gammaCorrectInput(saturate(vVertexColor.$VC));\n\t#endif\n}\n",diffuseDetailMapPS:"#ifdef MAPTEXTURE\nuniform sampler2D texture_diffuseDetailMap;\n#endif\nvec3 addAlbedoDetail(vec3 albedo) {\n\t#ifdef MAPTEXTURE\n\tvec3 albedoDetail = vec3(texture2D(texture_diffuseDetailMap, $UV).$CH);\n\treturn detailMode_$DETAILMODE(albedo, albedoDetail);\n\t#else\n\treturn albedo;\n\t#endif\n}\n",dilatePS:"varying vec2 vUv0;\nuniform sampler2D source;\nuniform vec2 pixelOffset;\nvoid main(void) {\n\tvec4 c = texture2D(source, vUv0);\n\tc = c.a>0.0? c : texture2D(source, vUv0 - pixelOffset);\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(0, -pixelOffset.y));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(pixelOffset.x, -pixelOffset.y));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(-pixelOffset.x, 0));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(pixelOffset.x, 0));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(-pixelOffset.x, pixelOffset.y));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + vec2(0, pixelOffset.y));\n\tc = c.a>0.0? c : texture2D(source, vUv0 + pixelOffset);\n\tgl_FragColor = c;\n}\n",dpAtlasQuadPS:"varying vec2 vUv0;\nuniform sampler2D source;\nuniform vec4 params;\nvoid main(void) {\n\tvec2 uv = vUv0;\n\tuv = uv * 2.0 - vec2(1.0);\n\tuv *= params.xy;\n\tuv = uv * 0.5 + 0.5;\n\tgl_FragColor = texture2D(source, uv);\n}\n",emissivePS:"#ifdef MAPCOLOR\nuniform vec3 material_emissive;\n#endif\n#ifdef MAPFLOAT\nuniform float material_emissiveIntensity;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_emissiveMap;\n#endif\nvec3 getEmission() {\n\tvec3 emission = vec3(1.0);\n\t#ifdef MAPFLOAT\n\temission *= material_emissiveIntensity;\n\t#endif\n\t#ifdef MAPCOLOR\n\temission *= material_emissive;\n\t#endif\n\t#ifdef MAPTEXTURE\n\temission *= $texture2DSAMPLE(texture_emissiveMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\temission *= gammaCorrectInput(saturate(vVertexColor.$VC));\n\t#endif\n\treturn emission;\n}\n",endPS:"\t#ifdef CLEARCOAT\n\tgl_FragColor.rgb = combineColorCC();\n\t#else\n\tgl_FragColor.rgb = combineColor();\n\t#endif\n\tgl_FragColor.rgb += getEmission();\n\tgl_FragColor.rgb = addFog(gl_FragColor.rgb);\n\t#ifndef HDR\n\tgl_FragColor.rgb = toneMap(gl_FragColor.rgb);\n\tgl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);\n\t#endif\n",envConstPS:"vec3 processEnvironment(vec3 color) {\n\treturn color;\n}\n",envMultiplyPS:"uniform float skyboxIntensity;\nvec3 processEnvironment(vec3 color) {\n\treturn color * skyboxIntensity;\n}\n",extensionPS:"\n",extensionVS:"\n",falloffInvSquaredPS:"float getFalloffWindow(float lightRadius) {\n\tfloat sqrDist = dot(dLightDirW, dLightDirW);\n\tfloat invRadius = 1.0 / lightRadius;\n\treturn square( saturate( 1.0 - square( sqrDist * square(invRadius) ) ) );\n}\nfloat getFalloffInvSquared(float lightRadius) {\n\tfloat sqrDist = dot(dLightDirW, dLightDirW);\n\tfloat falloff = 1.0 / (sqrDist + 1.0);\n\tfloat invRadius = 1.0 / lightRadius;\n\tfalloff *= 16.0;\n\tfalloff *= square( saturate( 1.0 - square( sqrDist * square(invRadius) ) ) );\n\treturn falloff;\n}\n",falloffLinearPS:"float getFalloffLinear(float lightRadius) {\n\tfloat d = length(dLightDirW);\n\treturn max(((lightRadius - d) / lightRadius), 0.0);\n}\n",fixCubemapSeamsNonePS:"vec3 fixSeams(vec3 vec, float mipmapIndex) {\n\treturn vec;\n}\nvec3 fixSeams(vec3 vec) {\n\treturn vec;\n}\nvec3 fixSeamsStatic(vec3 vec, float invRecMipSize) {\n\treturn vec;\n}\nvec3 calcSeam(vec3 vec) {\n\treturn vec3(0);\n}\nvec3 applySeam(vec3 vec, vec3 seam, float scale) {\n\treturn vec;\n}\n",fixCubemapSeamsStretchPS:"vec3 fixSeams(vec3 vec, float mipmapIndex) {\n\tfloat scale = 1.0 - exp2(mipmapIndex) / 128.0;\n\tfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n\tif (abs(vec.x) != M) vec.x *= scale;\n\tif (abs(vec.y) != M) vec.y *= scale;\n\tif (abs(vec.z) != M) vec.z *= scale;\n\treturn vec;\n}\nvec3 fixSeams(vec3 vec) {\n\tfloat scale = 1.0 - 1.0 / 128.0;\n\tfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n\tif (abs(vec.x) != M) vec.x *= scale;\n\tif (abs(vec.y) != M) vec.y *= scale;\n\tif (abs(vec.z) != M) vec.z *= scale;\n\treturn vec;\n}\nvec3 fixSeamsStatic(vec3 vec, float invRecMipSize) {\n\tfloat scale = invRecMipSize;\n\tfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n\tif (abs(vec.x) != M) vec.x *= scale;\n\tif (abs(vec.y) != M) vec.y *= scale;\n\tif (abs(vec.z) != M) vec.z *= scale;\n\treturn vec;\n}\nvec3 calcSeam(vec3 vec) {\n\tvec3 avec = abs(vec);\n\tfloat M = max(avec.x, max(avec.y, avec.z));\n\treturn vec3(avec.x != M ? 1.0 : 0.0,\n\t\t\t\tavec.y != M ? 1.0 : 0.0,\n\t\t\t\tavec.z != M ? 1.0 : 0.0);\n}\nvec3 applySeam(vec3 vec, vec3 seam, float scale) {\n\treturn vec * (seam * -scale + vec3(1.0));\n}\n",fogExpPS:"uniform vec3 fog_color;\nuniform float fog_density;\nfloat dBlendModeFogFactor = 1.0;\nvec3 addFog(vec3 color) {\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat fogFactor = exp(-depth * fog_density);\n\tfogFactor = clamp(fogFactor, 0.0, 1.0);\n\treturn mix(fog_color * dBlendModeFogFactor, color, fogFactor);\n}\n",fogExp2PS:"uniform vec3 fog_color;\nuniform float fog_density;\nfloat dBlendModeFogFactor = 1.0;\nvec3 addFog(vec3 color) {\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat fogFactor = exp(-depth * depth * fog_density * fog_density);\n\tfogFactor = clamp(fogFactor, 0.0, 1.0);\n\treturn mix(fog_color * dBlendModeFogFactor, color, fogFactor);\n}\n",fogLinearPS:"uniform vec3 fog_color;\nuniform float fog_start;\nuniform float fog_end;\nfloat dBlendModeFogFactor = 1.0;\nvec3 addFog(vec3 color) {\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat fogFactor = (fog_end - depth) / (fog_end - fog_start);\n\tfogFactor = clamp(fogFactor, 0.0, 1.0);\n\tfogFactor = gammaCorrectInput(fogFactor);\n\treturn mix(fog_color * dBlendModeFogFactor, color, fogFactor);\n}\n",fogNonePS:"float dBlendModeFogFactor = 1.0;\nvec3 addFog(vec3 color) {\n\treturn color;\n}\n",fresnelSchlickPS:"\nuniform float material_fresnelFactor;\nvoid getFresnel() {\n\tfloat fresnel = 1.0 - max(dot(dNormalW, dViewDirW), 0.0);\n\tfloat fresnel2 = fresnel * fresnel;\n\tfresnel *= fresnel2 * fresnel2;\n\tfresnel *= dGlossiness * dGlossiness;\n\tdSpecularity = dSpecularity + (1.0 - dSpecularity) * fresnel;\n\t#ifdef CLEARCOAT\n\tfresnel = 1.0 - max(dot(ccNormalW, dViewDirW), 0.0);\n\tfresnel2 = fresnel * fresnel;\n\tfresnel *= fresnel2 * fresnel2;\n\tfresnel *= ccGlossiness * ccGlossiness;\n\tccSpecularity = ccSpecularity + (1.0 - ccSpecularity) * fresnel;\n\t#endif\n}\n",fullscreenQuadPS:"varying vec2 vUv0;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vUv0);\n}\n",fullscreenQuadVS:"attribute vec2 vertex_position;\nvarying vec2 vUv0;\nvoid main(void)\n{\n\tgl_Position = vec4(vertex_position, 0.5, 1.0);\n\tvUv0 = vertex_position.xy*0.5+0.5;\n}\n",gamma1_0PS:"vec4 texture2DSRGB(sampler2D tex, vec2 uv) {\n\treturn texture2D(tex, uv);\n}\nvec4 texture2DSRGB(sampler2D tex, vec2 uv, float bias) {\n\treturn texture2D(tex, uv, bias);\n}\nvec4 textureCubeSRGB(samplerCube tex, vec3 uvw) {\n\treturn textureCube(tex, uvw);\n}\nvec3 gammaCorrectOutput(vec3 color) {\n\treturn color;\n}\nvec3 gammaCorrectInput(vec3 color) {\n\treturn color;\n}\nfloat gammaCorrectInput(float color) {\n\treturn color;\n}\nvec4 gammaCorrectInput(vec4 color) {\n\treturn color;\n}\n",gamma2_2PS:"vec3 gammaCorrectInput(vec3 color) {\n\treturn pow(color, vec3(2.2));\n}\nfloat gammaCorrectInput(float color) {\n\treturn pow(color, 2.2);\n}\nvec4 gammaCorrectInput(vec4 color) {\n\treturn vec4(pow(color.rgb, vec3(2.2)), color.a);\n}\nvec4 texture2DSRGB(sampler2D tex, vec2 uv) {\n\tvec4 rgba = texture2D(tex, uv);\n\trgba.rgb = gammaCorrectInput(rgba.rgb);\n\treturn rgba;\n}\nvec4 texture2DSRGB(sampler2D tex, vec2 uv, float bias) {\n\tvec4 rgba = texture2D(tex, uv, bias);\n\trgba.rgb = gammaCorrectInput(rgba.rgb);\n\treturn rgba;\n}\nvec4 textureCubeSRGB(samplerCube tex, vec3 uvw) {\n\tvec4 rgba = textureCube(tex, uvw);\n\trgba.rgb = gammaCorrectInput(rgba.rgb);\n\treturn rgba;\n}\nvec3 gammaCorrectOutput(vec3 color) {\n\t#ifdef HDR\n\treturn color;\n\t#else\n\tcolor += vec3(0.0000001);\n\treturn pow(color, vec3(0.45));\n\t#endif\n}\n",genParaboloidPS:"varying vec2 vUv0;\nuniform samplerCube source;\nuniform vec4 params;\nvoid main(void) {\n\tvec2 uv = vUv0;\n\tfloat side = uv.x < 0.5? 1.0 : -1.0;\n\tvec2 tc;\n\ttc.x = fract(uv.x * 2.0) * 2.0 - 1.0;\n\ttc.y = uv.y * 2.0 - 1.0;\n\tconst float scale = 1.1;\n\ttc *= scale;\n\tvec3 dir;\n\tdir.y = (dot(tc, tc) - 1.0) * side;\n\tdir.xz = tc * -2.0;\n\tdir.x *= -side * params.y;\n\tdir = fixSeams(dir, params.x);\n\tvec4 color = textureCube(source, dir, -100.0);\n\tgl_FragColor = color;\n}\n",gles3PS:"#define varying in\nout highp vec4 pc_fragColor;\n#define gl_FragColor pc_fragColor\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad\n#define GL2\n",gles3VS:"#define attribute in\n#define varying out\n#define texture2D texture\n#define GL2\n#define VERTEXSHADER\n",glossPS:"#ifdef MAPFLOAT\nuniform float material_shininess;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_glossMap;\n#endif\nvoid getGlossiness() {\n\tdGlossiness = 1.0;\n\t#ifdef MAPFLOAT\n\tdGlossiness *= material_shininess;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tdGlossiness *= texture2D(texture_glossMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdGlossiness *= saturate(vVertexColor.$VC);\n\t#endif\n\tdGlossiness += 0.0000001;\n}\n",instancingVS:"attribute vec4 instance_line1;\nattribute vec4 instance_line2;\nattribute vec4 instance_line3;\nattribute vec4 instance_line4;\n",lightDiffuseLambertPS:"float getLightDiffuse() {\n\treturn max(dot(dNormalW, -dLightDirNormW), 0.0);\n}\n",lightDirPointPS:"void getLightDirPoint(vec3 lightPosW) {\n\tdLightDirW = vPositionW - lightPosW;\n\tdLightDirNormW = normalize(dLightDirW);\n\tdLightPosW = lightPosW;\n}\n",lightmapDirPS:"uniform sampler2D texture_lightMap;\nuniform sampler2D texture_dirLightMap;\nvoid addLightMap() {\n\tvec3 color = $texture2DSAMPLE(texture_lightMap, $UV).$CH;\n\tvec3 dir = texture2D(texture_dirLightMap, $UV).xyz;\n\tif (dot(dir, vec3(1.0)) < 0.00001) {\n\t\tdDiffuseLight += color;\n\t} else {\n\t\tdLightDirNormW = normalize(dir * 2.0 - vec3(1.0));\n\t\tfloat vlight = saturate(dot(dLightDirNormW, -dVertexNormalW));\n\t\tfloat flight = saturate(dot(dLightDirNormW, -dNormalW));\n\t\tfloat nlight = (flight / max(vlight, 0.01)) * 0.5;\n\t\tdDiffuseLight += color * nlight * 2.0;\n\t}\n\tdSpecularLight += color * getLightSpecular();\n}\n",lightmapSinglePS:"#ifdef MAPTEXTURE\nuniform sampler2D texture_lightMap;\n#endif\nvoid addLightMap() {\n\tvec3 lm = vec3(1.0);\n\t#ifdef MAPTEXTURE\n\tlm *= $texture2DSAMPLE(texture_lightMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tlm *= saturate(vVertexColor.$VC);\n\t#endif\n\tdDiffuseLight += lm;\n}\n",lightmapSingleVertPS:"void addLightMap() {\n\tdDiffuseLight += saturate(vVertexColor.$CH);\n}\n",lightSpecularAnisoGGXPS:"\nfloat calcLightSpecular(float tGlossiness, vec3 tNormalW) {\n\tfloat PI = 3.141592653589793;\n\tfloat roughness = max((1.0 - tGlossiness) * (1.0 - tGlossiness), 0.001);\n\tfloat anisotropy = material_anisotropy * roughness;\n\tfloat at = max((roughness + anisotropy), roughness / 4.0);\n\tfloat ab = max((roughness - anisotropy), roughness / 4.0);\n\tvec3 h = normalize(normalize(-dLightDirNormW) + normalize(dViewDirW));\n\tfloat NoH = dot(tNormalW, h);\n\tfloat ToH = dot(dTBN[0], h);\n\tfloat BoH = dot(dTBN[1], h);\n\tfloat a2 = at * ab;\n\tvec3 v = vec3(ab * ToH, at * BoH, a2 * NoH);\n\tfloat v2 = dot(v, v);\n\tfloat w2 = a2 / v2;\n\tfloat D = a2 * w2 * w2 * (1.0 / PI);\n\tfloat ToV = dot(dTBN[0], dViewDirW);\n\tfloat BoV = dot(dTBN[1], dViewDirW);\n\tfloat ToL = dot(dTBN[0], -dLightDirNormW);\n\tfloat BoL = dot(dTBN[1], -dLightDirNormW);\n\tfloat NoV = dot(tNormalW, dViewDirW);\n\tfloat NoL = dot(tNormalW, -dLightDirNormW);\n\tfloat lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));\n\tfloat lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));\n\tfloat G = 0.5 / (lambdaV + lambdaL);\n\treturn D * G;\n}\nfloat getLightSpecular() {\n\treturn calcLightSpecular(dGlossiness, dNormalW);\n}\nfloat getLightSpecularCC() {\n\treturn calcLightSpecular(ccGlossiness, ccNormalW);\n}\n",lightSpecularBlinnPS:"\nfloat calcLightSpecular(float tGlossiness, vec3 tNormalW) {\n\tvec3 h = normalize( -dLightDirNormW + dViewDirW );\n\tfloat nh = max( dot( h, tNormalW ), 0.0 );\n\tfloat specPow = exp2(tGlossiness * 11.0);\n\tspecPow = antiAliasGlossiness(specPow);\n\tspecPow = max(specPow, 0.0001);\n\treturn pow(nh, specPow) * (specPow + 2.0) / 8.0;\n}\nfloat getLightSpecular() {\n\treturn calcLightSpecular(dGlossiness, dNormalW);\n}\nfloat getLightSpecularCC() {\n\treturn calcLightSpecular(ccGlossiness, ccNormalW);\n}\n",lightSpecularPhongPS:"float calcLightSpecular(float tGlossiness, vec3 tReflDirW) {\n\tfloat specPow = tGlossiness;\n\tspecPow = antiAliasGlossiness(specPow);\n\treturn pow(max(dot(tReflDirW, -dLightDirNormW), 0.0), specPow + 0.0001);\n}\nfloat getLightSpecular() {\n\treturn calcLightSpecular(dGlossiness, dReflDirW);\n}\nfloat getLightSpecularCC() {\n\treturn calcLightSpecular(ccGlossiness, ccReflDirW);\n}\n",ltc:"\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nstruct Coords {\n\tvec3 coord0;\n\tvec3 coord1;\n\tvec3 coord2;\n\tvec3 coord3;\n};\nfloat LTC_EvaluateRect( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in Coords rectCoords) {\n\tvec3 v1 = rectCoords.coord1 - rectCoords.coord0;\n\tvec3 v2 = rectCoords.coord3 - rectCoords.coord0;\n\tvec3 lightNormal = cross( v1, v2 );\n\tfloat factor = sign(-dot( lightNormal, P - rectCoords.coord0 ));\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 =  factor * cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords.coord0 - P );\n\tcoords[ 1 ] = mat * ( rectCoords.coord1 - P );\n\tcoords[ 2 ] = mat * ( rectCoords.coord2 - P );\n\tcoords[ 3 ] = mat * ( rectCoords.coord3 - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn result;\n}\nCoords dLTCCoords;\nCoords getLTCLightCoords(vec3 lightPos, vec3 halfWidth, vec3 halfHeight){\n\tCoords coords;\n\tcoords.coord0 = lightPos + halfWidth - halfHeight;\n\tcoords.coord1 = lightPos - halfWidth - halfHeight;\n\tcoords.coord2 = lightPos - halfWidth + halfHeight;\n\tcoords.coord3 = lightPos + halfWidth + halfHeight;\n\treturn coords;\n}\nfloat dSphereRadius;\nCoords getSphereLightCoords(vec3 lightPos, vec3 halfWidth, vec3 halfHeight){\n\tCoords coords;\n\tfloat radius = max(length(halfWidth), length(halfWidth));\n\tdSphereRadius = radius;\n\tvec3 f = normalize(lightPos-view_position);\n\tvec3 w = normalize(cross(f, halfHeight));\n\tvec3 h = normalize(cross(f, w));\n\tcoords.coord0 = lightPos + w * radius - h * radius;\n\tcoords.coord1 = lightPos - w * radius - h * radius;\n\tcoords.coord2 = lightPos - w * radius + h * radius;\n\tcoords.coord3 = lightPos + w * radius + h * radius;\n\treturn coords;\n}\nvec2 dLTCUV;\n#ifdef CLEARCOAT\nvec2 ccLTCUV;\n#endif\nvec2 getLTCLightUV(float tGlossiness, vec3 tNormalW)\n{\n\tfloat roughness = max((1.0 - tGlossiness) * (1.0 - tGlossiness), 0.001);\n\treturn LTC_Uv( tNormalW, dViewDirW, roughness );\n}\nvec3 dLTCSpecFres;\n#ifdef CLEARCOAT\nvec3 ccLTCSpecFres;\n#endif\nvec3 getLTCLightSpecFres(vec2 uv, vec3 tSpecularity)\n{\n\tvec4 t2 = texture2D( areaLightsLutTex2, uv );\n\t#ifdef AREA_R8_G8_B8_A8_LUTS\n\tt2 *= vec4(0.693103,1,1,1);\n\tt2 += vec4(0.306897,0,0,0);\n\t#endif\n\treturn tSpecularity * t2.x + ( vec3( 1.0 ) - tSpecularity) * t2.y;\n}\nvoid calcLTCLightValues()\n{\n\tdLTCUV = getLTCLightUV(dGlossiness, dNormalW);\n\tdLTCSpecFres = getLTCLightSpecFres(dLTCUV, dSpecularityNoFres);\n#ifdef CLEARCOAT\n\tccLTCUV = getLTCLightUV(ccGlossiness, ccNormalW);\n\tccLTCSpecFres = getLTCLightSpecFres(ccLTCUV, ccSpecularityNoFres);\n#endif\n}\nvoid calcRectLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight)\n{\n\tdLTCCoords = getLTCLightCoords(lightPos, halfWidth, halfHeight);\n\tcalcLTCLightValues();\n}\nvoid calcDiskLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight)\n{\n\tcalcRectLightValues(lightPos, halfWidth, halfHeight);\n}\nvoid calcSphereLightValues(vec3 lightPos, vec3 halfWidth, vec3 halfHeight)\n{\n\tdLTCCoords = getSphereLightCoords(lightPos, halfWidth, halfHeight);\n\tcalcLTCLightValues();\n}\nvec3 SolveCubic(vec4 Coefficient)\n{\n\tfloat pi = 3.14159;\n\tCoefficient.xyz /= Coefficient.w;\n\tCoefficient.yz /= 3.0;\n\tfloat A = Coefficient.w;\n\tfloat B = Coefficient.z;\n\tfloat C = Coefficient.y;\n\tfloat D = Coefficient.x;\n\tvec3 Delta = vec3(\n\t\t-Coefficient.z * Coefficient.z + Coefficient.y,\n\t\t-Coefficient.y * Coefficient.z + Coefficient.x,\n\t\tdot(vec2(Coefficient.z, -Coefficient.y), Coefficient.xy)\n\t);\n\tfloat Discriminant = dot(vec2(4.0 * Delta.x, -Delta.y), Delta.zy);\n\tvec3 RootsA, RootsD;\n\tvec2 xlc, xsc;\n\t{\n\t\tfloat A_a = 1.0;\n\t\tfloat C_a = Delta.x;\n\t\tfloat D_a = -2.0 * B * Delta.x + Delta.y;\n\t\tfloat Theta = atan(sqrt(Discriminant), -D_a) / 3.0;\n\t\tfloat x_1a = 2.0 * sqrt(-C_a) * cos(Theta);\n\t\tfloat x_3a = 2.0 * sqrt(-C_a) * cos(Theta + (2.0 / 3.0) * pi);\n\t\tfloat xl;\n\t\tif ((x_1a + x_3a) > 2.0 * B)\n\t\t\txl = x_1a;\n\t\telse\n\t\t\txl = x_3a;\n\t\txlc = vec2(xl - B, A);\n\t}\n\t{\n\t\tfloat A_d = D;\n\t\tfloat C_d = Delta.z;\n\t\tfloat D_d = -D * Delta.y + 2.0 * C * Delta.z;\n\t\tfloat Theta = atan(D * sqrt(Discriminant), -D_d) / 3.0;\n\t\tfloat x_1d = 2.0 * sqrt(-C_d) * cos(Theta);\n\t\tfloat x_3d = 2.0 * sqrt(-C_d) * cos(Theta + (2.0 / 3.0) * pi);\n\t\tfloat xs;\n\t\tif (x_1d + x_3d < 2.0 * C)\n\t\t\txs = x_1d;\n\t\telse\n\t\t\txs = x_3d;\n\t\txsc = vec2(-D, xs + C);\n\t}\n\tfloat E =  xlc.y * xsc.y;\n\tfloat F = -xlc.x * xsc.y - xlc.y * xsc.x;\n\tfloat G =  xlc.x * xsc.x;\n\tvec2 xmc = vec2(C * F - B * G, -B * F + C * E);\n\tvec3 Root = vec3(xsc.x / xsc.y, xmc.x / xmc.y, xlc.x / xlc.y);\n\tif (Root.x < Root.y && Root.x < Root.z)\n\t\tRoot.xyz = Root.yxz;\n\telse if (Root.z < Root.x && Root.z < Root.y)\n\t\tRoot.xyz = Root.xzy;\n\treturn Root;\n}\nfloat LTC_EvaluateDisk(vec3 N, vec3 V, vec3 P, mat3 Minv, Coords points)\n{\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot(V, N));\n\tT2 = cross(N, T1);\n\tmat3 R = transposeMat3( mat3( T1, T2, N ) );\n\tvec3 L_[ 3 ];\n\tL_[ 0 ] = R * ( points.coord0 - P );\n\tL_[ 1 ] = R * ( points.coord1 - P );\n\tL_[ 2 ] = R * ( points.coord2 - P );\n\tvec3 Lo_i = vec3(0);\n\tvec3 C  = 0.5 * (L_[0] + L_[2]);\n\tvec3 V1 = 0.5 * (L_[1] - L_[2]);\n\tvec3 V2 = 0.5 * (L_[1] - L_[0]);\n\tC  = Minv * C;\n\tV1 = Minv * V1;\n\tV2 = Minv * V2;\n\tfloat a, b;\n\tfloat d11 = dot(V1, V1);\n\tfloat d22 = dot(V2, V2);\n\tfloat d12 = dot(V1, V2);\n\tif (abs(d12) / sqrt(d11 * d22) > 0.0001)\n\t{\n\t\tfloat tr = d11 + d22;\n\t\tfloat det = -d12 * d12 + d11 * d22;\n\t\tdet = sqrt(det);\n\t\tfloat u = 0.5 * sqrt(tr - 2.0 * det);\n\t\tfloat v = 0.5 * sqrt(tr + 2.0 * det);\n\t\tfloat e_max = (u + v) * (u + v);\n\t\tfloat e_min = (u - v) * (u - v);\n\t\tvec3 V1_, V2_;\n\t\tif (d11 > d22)\n\t\t{\n\t\t\tV1_ = d12 * V1 + (e_max - d11) * V2;\n\t\t\tV2_ = d12 * V1 + (e_min - d11) * V2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tV1_ = d12*V2 + (e_max - d22)*V1;\n\t\t\tV2_ = d12*V2 + (e_min - d22)*V1;\n\t\t}\n\t\ta = 1.0 / e_max;\n\t\tb = 1.0 / e_min;\n\t\tV1 = normalize(V1_);\n\t\tV2 = normalize(V2_);\n\t}\n\telse\n\t{\n\t\ta = 1.0 / dot(V1, V1);\n\t\tb = 1.0 / dot(V2, V2);\n\t\tV1 *= sqrt(a);\n\t\tV2 *= sqrt(b);\n\t}\n\tvec3 V3 = cross(V1, V2);\n\tif (dot(C, V3) < 0.0)\n\t\tV3 *= -1.0;\n\tfloat L  = dot(V3, C);\n\tfloat x0 = dot(V1, C) / L;\n\tfloat y0 = dot(V2, C) / L;\n\tfloat E1 = inversesqrt(a);\n\tfloat E2 = inversesqrt(b);\n\ta *= L * L;\n\tb *= L * L;\n\tfloat c0 = a * b;\n\tfloat c1 = a * b * (1.0 + x0 * x0 + y0 * y0) - a - b;\n\tfloat c2 = 1.0 - a * (1.0 + x0 * x0) - b * (1.0 + y0 * y0);\n\tfloat c3 = 1.0;\n\tvec3 roots = SolveCubic(vec4(c0, c1, c2, c3));\n\tfloat e1 = roots.x;\n\tfloat e2 = roots.y;\n\tfloat e3 = roots.z;\n\tvec3 avgDir = vec3(a * x0 / (a - e2), b * y0 / (b - e2), 1.0);\n\tmat3 rotate = mat3(V1, V2, V3);\n\tavgDir = rotate * avgDir;\n\tavgDir = normalize(avgDir);\n\tfloat L1 = sqrt(-e2 / e3);\n\tfloat L2 = sqrt(-e2 / e1);\n\tfloat formFactor = L1 * L2 * inversesqrt((1.0 + L1 * L1) * (1.0 + L2 * L2));\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tvec2 uv = vec2(avgDir.z * 0.5 + 0.5, formFactor);\n\tuv = uv*LUT_SCALE + LUT_BIAS;\n\tfloat scale = texture2D( areaLightsLutTex2, uv ).w;\n\treturn formFactor*scale;\n}\nfloat getRectLightDiffuse() {\n\treturn LTC_EvaluateRect( dNormalW, dViewDirW, vPositionW, mat3( 1.0 ), dLTCCoords );\n}\nfloat getDiskLightDiffuse() {\n\treturn LTC_EvaluateDisk( dNormalW, dViewDirW, vPositionW, mat3( 1.0 ), dLTCCoords );\n}\nfloat getSphereLightDiffuse() {\n\tfloat falloff = dSphereRadius / (dot(dLightDirW, dLightDirW) + dSphereRadius);\n\treturn getLightDiffuse()*falloff;\n}\nmat3 getLTCLightInvMat(vec2 uv)\n{\n\tvec4 t1 = texture2D( areaLightsLutTex1, uv );\n\t#ifdef AREA_R8_G8_B8_A8_LUTS\n\tt1 *= vec4(1.001, 0.3239, 0.60437568, 1.0);\n\tt1 += vec4(0.0, -0.2976, -0.01381, 0.0);\n\t#endif\n\treturn mat3(\n\t\tvec3( t1.x, 0, t1.y ),\n\t\tvec3(\t0, 1,\t0 ),\n\t\tvec3( t1.z, 0, t1.w )\n\t);\n}\nfloat calcRectLightSpecular(vec3 tNormalW, vec2 uv) {\n\tmat3 mInv = getLTCLightInvMat(uv);\n\treturn LTC_EvaluateRect( tNormalW, dViewDirW, vPositionW, mInv, dLTCCoords );\n}\nfloat getRectLightSpecular() {\n\treturn calcRectLightSpecular(dNormalW, dLTCUV);\n}\n#ifdef CLEARCOAT\nfloat getRectLightSpecularCC() {\n\treturn calcRectLightSpecular(ccNormalW, ccLTCUV);\n}\n#endif\nfloat calcDiskLightSpecular(vec3 tNormalW, vec2 uv) {\n\tmat3 mInv = getLTCLightInvMat(uv);\n\treturn LTC_EvaluateDisk( tNormalW, dViewDirW, vPositionW, mInv, dLTCCoords );\n}\nfloat getDiskLightSpecular() {\n\treturn calcDiskLightSpecular(dNormalW, dLTCUV);\n}\n#ifdef CLEARCOAT\nfloat getDiskLightSpecularCC() {\n\treturn calcDiskLightSpecular(ccNormalW, ccLTCUV);\n}\n#endif\nfloat getSphereLightSpecular() {\n\treturn calcDiskLightSpecular(dNormalW, dLTCUV);\n}\n#ifdef CLEARCOAT\nfloat getSphereLightSpecularCC() {\n\treturn calcDiskLightSpecular(ccNormalW, ccLTCUV);\n}\n#endif\n",metalnessPS:"void processMetalness(float metalness) {\n\tconst float dielectricF0 = 0.04;\n\tdSpecularity = mix(vec3(dielectricF0), dAlbedo, metalness);\n\tdAlbedo *= 1.0 - metalness;\n}\n#ifdef MAPFLOAT\nuniform float material_metalness;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_metalnessMap;\n#endif\nvoid getSpecularity() {\n\tfloat metalness = 1.0;\n\t#ifdef MAPFLOAT\n\tmetalness *= material_metalness;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tmetalness *= texture2D(texture_metalnessMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tmetalness *= saturate(vVertexColor.$VC);\n\t#endif\n\tprocessMetalness(metalness);\n}\n",msdfPS:"uniform sampler2D texture_msdfMap;\n#ifdef GL_OES_standard_derivatives\n#define USE_FWIDTH\n#endif\n#ifdef GL2\n#define USE_FWIDTH\n#endif\nfloat median(float r, float g, float b) {\n\treturn max(min(r, g), min(max(r, g), b));\n}\nfloat map (float min, float max, float v) {\n\treturn (v - min) / (max - min);\n}\nuniform float font_sdfIntensity;\nuniform float font_pxrange;\nuniform float font_textureWidth;\nuniform vec4 outline_color;\nuniform float outline_thickness;\nuniform vec4 shadow_color;\nuniform vec2 shadow_offset;\nvec4 applyMsdf(vec4 color) {\n\tvec3 tsample = texture2D(texture_msdfMap, vUv0).rgb;\n\tvec2 uvShdw = vUv0 - shadow_offset;\n\tvec3 ssample = texture2D(texture_msdfMap, uvShdw).rgb;\n\tfloat sigDist = median(tsample.r, tsample.g, tsample.b);\n\tfloat sigDistShdw = median(ssample.r, ssample.g, ssample.b);\n\t#ifdef USE_FWIDTH\n\tvec2 w = fwidth(vUv0);\n\tfloat smoothing = clamp(w.x * font_textureWidth / font_pxrange, 0.0, 0.5);\n\t#else\n\tfloat font_size = 16.0;\n\tfloat smoothing = clamp(font_pxrange / font_size, 0.0, 0.5);\n\t#endif\n\tfloat mapMin = 0.05;\n\tfloat mapMax = clamp(1.0 - font_sdfIntensity, mapMin, 1.0);\n\tfloat sigDistInner = map(mapMin, mapMax, sigDist);\n\tfloat sigDistOutline = map(mapMin, mapMax, sigDist + outline_thickness);\n\tsigDistShdw = map(mapMin, mapMax, sigDistShdw + outline_thickness);\n\tfloat center = 0.5;\n\tfloat inside = smoothstep(center-smoothing, center+smoothing, sigDistInner);\n\tfloat outline = smoothstep(center-smoothing, center+smoothing, sigDistOutline);\n\tfloat shadow = smoothstep(center-smoothing, center+smoothing, sigDistShdw);\n\tvec4 tcolor = (outline > inside) ? outline * vec4(outline_color.a * outline_color.rgb, outline_color.a) : vec4(0.0);\n\ttcolor = mix(tcolor, color, inside);\n\tvec4 scolor = (shadow > outline) ? shadow * vec4(shadow_color.a * shadow_color.rgb, shadow_color.a) : tcolor;\n\ttcolor = mix(scolor, tcolor, outline);\n\treturn tcolor;\n}\n",normalVS:"#ifdef MORPHING_TEXTURE_BASED_NORMAL\nuniform highp sampler2D morphNormalTex;\n#endif\nvec3 getNormal() {\n\t#ifdef SKIN\n\tdNormalMatrix = mat3(dModelMatrix[0].xyz, dModelMatrix[1].xyz, dModelMatrix[2].xyz);\n\t#elif defined(INSTANCING)\n\tdNormalMatrix = mat3(instance_line1.xyz, instance_line2.xyz, instance_line3.xyz);\n\t#else\n\tdNormalMatrix = matrix_normal;\n\t#endif\n\tvec3 tempNormal = vertex_normal;\n\t#ifdef MORPHING\n\t#ifdef MORPHING_NRM03\n\ttempNormal += morph_weights_a[0] * morph_nrm0;\n\ttempNormal += morph_weights_a[1] * morph_nrm1;\n\ttempNormal += morph_weights_a[2] * morph_nrm2;\n\ttempNormal += morph_weights_a[3] * morph_nrm3;\n\t#endif\n\t#ifdef MORPHING_NRM47\n\ttempNormal += morph_weights_b[0] * morph_nrm4;\n\ttempNormal += morph_weights_b[1] * morph_nrm5;\n\ttempNormal += morph_weights_b[2] * morph_nrm6;\n\ttempNormal += morph_weights_b[3] * morph_nrm7;\n\t#endif\n\t#endif\n\t#ifdef MORPHING_TEXTURE_BASED_NORMAL\n\tvec2 morphUV = getTextureMorphCoords();\n\tvec3 morphNormal = texture2D(morphNormalTex, morphUV).xyz;\n\ttempNormal += morphNormal;\n\t#endif\n\treturn normalize(dNormalMatrix * tempNormal);\n}\n",normalDetailMapPS:"#ifdef MAPTEXTURE\nuniform sampler2D texture_normalDetailMap;\nuniform float material_normalDetailMapBumpiness;\nvec3 blendNormals(vec3 n1, vec3 n2) {\n\tn1 += vec3(0, 0, 1);\n\tn2 *= vec3(-1, -1, 1);\n\treturn normalize(n1*dot(n1, n2)/n1.z - n2);\n}\n#endif\nvec3 addNormalDetail(vec3 normalMap) {\n\t#ifdef MAPTEXTURE\n\tvec3 normalDetailMap = unpackNormal(texture2D(texture_normalDetailMap, $UV));\n\tnormalDetailMap = normalize(mix(vec3(0.0, 0.0, 1.0), normalDetailMap, material_normalDetailMapBumpiness));\n\treturn blendNormals(normalMap, normalDetailMap);\n\t#else\n\treturn normalMap;\n\t#endif\n}\n",normalInstancedVS:"vec3 getNormal() {\n\tdNormalMatrix = mat3(instance_line1.xyz, instance_line2.xyz, instance_line3.xyz);\n\treturn normalize(dNormalMatrix * vertex_normal);\n}\n",normalMapPS:"uniform sampler2D texture_normalMap;\nuniform float material_bumpiness;\nvoid getNormal() {\n\tvec3 normalMap = unpackNormal(texture2D(texture_normalMap, $UV));\n\tnormalMap = normalize(mix(vec3(0.0, 0.0, 1.0), normalMap, material_bumpiness));\n\tdNormalMap = addNormalDetail(normalMap);\n\tdNormalW = dTBN * dNormalMap;\n}\n",normalMapFastPS:"uniform sampler2D texture_normalMap;\nvoid getNormal() {\n\tvec3 normalMap = unpackNormal(texture2D(texture_normalMap, $UV));\n\tdNormalMap = addNormalDetail(normalMap);\n\tdNormalW = dTBN * dNormalMap;\n}\n",normalSkinnedVS:"vec3 getNormal() {\n\tdNormalMatrix = mat3(dModelMatrix[0].xyz, dModelMatrix[1].xyz, dModelMatrix[2].xyz);\n\treturn normalize(dNormalMatrix * vertex_normal);\n}\n",normalVertexPS:"void getNormal() {\n\tdNormalW = normalize(dVertexNormalW);\n}\n",normalXYPS:"vec3 unpackNormal(vec4 nmap) {\n\tvec3 normal;\n\tnormal.xy = nmap.wy * 2.0 - 1.0;\n\tnormal.z = sqrt(1.0 - saturate(dot(normal.xy, normal.xy)));\n\treturn normal;\n}\n",normalXYZPS:"vec3 unpackNormal(vec4 nmap) {\n\treturn nmap.xyz * 2.0 - 1.0;\n}\n",opacityPS:"#ifdef MAPFLOAT\nuniform float material_opacity;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_opacityMap;\n#endif\nvoid getOpacity() {\n\tdAlpha = 1.0;\n\t#ifdef MAPFLOAT\n\tdAlpha *= material_opacity;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tdAlpha *= texture2D(texture_opacityMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdAlpha *= clamp(vVertexColor.$VC, 0.0, 1.0);\n\t#endif\n}\n",outputAlphaPS:"gl_FragColor.a = dAlpha;\n",outputAlphaOpaquePS:"gl_FragColor.a = 1.0;\n",outputAlphaPremulPS:"gl_FragColor.rgb *= dAlpha;\ngl_FragColor.a = dAlpha;\n",outputCubemapPS:"varying vec2 vUv0;\nuniform samplerCube source;\nuniform vec4 params;\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec4 encodeRGBM(vec4 color) {\n\tcolor.rgb = pow(color.rgb, vec3(0.5));\n\tcolor.rgb *= 1.0 / 8.0;\n\tcolor.a = saturate( max( max( color.r, color.g ), max( color.b, 1.0 / 255.0 ) ) );\n\tcolor.a = ceil(color.a * 255.0) / 255.0;\n\tcolor.rgb /= color.a;\n\treturn color;\n}\nvoid main(void) {\n\tvec2 st = vUv0 * 2.0 - 1.0;\n\tfloat face = params.x;\n\tvec3 vec;\n\tif (face==0.0) {\n\t\tvec = vec3(1, -st.y, -st.x);\n\t} else if (face==1.0) {\n\t\tvec = vec3(-1, -st.y, st.x);\n\t} else if (face==2.0) {\n\t\tvec = vec3(st.x, 1, st.y);\n\t} else if (face==3.0) {\n\t\tvec = vec3(st.x, -1, -st.y);\n\t} else if (face==4.0) {\n\t\tvec = vec3(st.x, -st.y, 1);\n\t} else {\n\t\tvec = vec3(-st.x, -st.y, -1);\n\t}\n\tgl_FragColor = textureCube(source, vec);\n\tif (params.w >= 2.0) gl_FragColor = encodeRGBM(gl_FragColor);\n}\n",outputTex2DPS:"varying vec2 vUv0;\nuniform sampler2D source;\nvoid main(void) {\n\tgl_FragColor = texture2D(source, vUv0);\n}\n",packDepthPS:"\nvec4 packFloat(float depth) {\n\tconst vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n\tconst vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n\tvec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\n",packDepthMaskPS:"vec4 packFloat(float depth) {\n\tconst vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n\tconst vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n\tvec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n\tres.x = 0.0;\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\n",parallaxPS:"uniform sampler2D texture_heightMap;\nuniform float material_heightMapFactor;\nvoid getParallax() {\n\tfloat parallaxScale = material_heightMapFactor;\n\tfloat height = texture2D(texture_heightMap, $UV).$CH;\n\theight = height * parallaxScale - parallaxScale*0.5;\n\tvec3 viewDirT = dViewDirW * dTBN;\n\tviewDirT.z += 0.42;\n\tdUvOffset = height * (viewDirT.xy / viewDirT.z);\n}\n",particlePS:"varying vec4 texCoordsAlphaLife;\nuniform sampler2D colorMap;\nuniform sampler2D colorParam;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\nuniform float softening;\nuniform float colorMult;\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n\tconst vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\n#endif\nvoid main(void) {\n\tvec4 tex  = texture2DSRGB(colorMap, texCoordsAlphaLife.xy);\n\tvec4 ramp = texture2DSRGB(colorParam, vec2(texCoordsAlphaLife.w, 0.0));\n\tramp.rgb *= colorMult;\n\tramp.a += texCoordsAlphaLife.z;\n\tvec3 rgb = tex.rgb * ramp.rgb;\n\tfloat a  = tex.a * ramp.a;\n",particleVS:"vec3 unpack3NFloats(float src) {\n\tfloat r = fract(src);\n\tfloat g = fract(src * 256.0);\n\tfloat b = fract(src * 65536.0);\n\treturn vec3(r, g, b);\n}\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec4 tex1Dlod_lerp(highp sampler2D tex, vec2 tc) {\n\treturn mix( texture2D(tex,tc), texture2D(tex,tc + graphSampleSize), fract(tc.x*graphNumSamples) );\n}\nvec4 tex1Dlod_lerp(highp sampler2D tex, vec2 tc, out vec3 w) {\n\tvec4 a = texture2D(tex,tc);\n\tvec4 b = texture2D(tex,tc + graphSampleSize);\n\tfloat c = fract(tc.x*graphNumSamples);\n\tvec3 unpackedA = unpack3NFloats(a.w);\n\tvec3 unpackedB = unpack3NFloats(b.w);\n\tw = mix(unpackedA, unpackedB, c);\n\treturn mix(a, b, c);\n}\nvec2 rotate(vec2 quadXY, float pRotation, out mat2 rotMatrix) {\n\tfloat c = cos(pRotation);\n\tfloat s = sin(pRotation);\n\tmat2 m = mat2(c, -s, s, c);\n\trotMatrix = m;\n\treturn m * quadXY;\n}\nvec3 billboard(vec3 InstanceCoords, vec2 quadXY) {\n\t#ifdef SCREEN_SPACE\n\t\tvec3 pos = vec3(-1, 0, 0) * quadXY.x + vec3(0, -1, 0) * quadXY.y;\n\t#else\n\t\tvec3 pos = -matrix_viewInverse[0].xyz * quadXY.x + -matrix_viewInverse[1].xyz * quadXY.y;\n\t#endif\n\treturn pos;\n}\nvec3 customFace(vec3 InstanceCoords, vec2 quadXY) {\n\tvec3 pos = faceTangent * quadXY.x + faceBinorm * quadXY.y;\n\treturn pos;\n}\nvec2 safeNormalize(vec2 v) {\n\tfloat l = length(v);\n\treturn (l > 1e-06) ? v / l : v;\n}\nvoid main(void) {\n\tvec3 meshLocalPos = particle_vertexData.xyz;\n\tfloat id = floor(particle_vertexData.w);\n\tfloat rndFactor = fract(sin(id + 1.0 + seed));\n\tvec3 rndFactor3 = vec3(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));\n\tfloat uv = id / numParticlesPot;\n\treadInput(uv);\n#ifdef LOCAL_SPACE\n\tinVel = mat3(matrix_model) * inVel;\n#endif\n\tvec2 velocityV = safeNormalize((mat3(matrix_view) * inVel).xy);\n\tfloat particleLifetime = lifetime;\n\tif (inLife <= 0.0 || inLife > particleLifetime || !inShow) meshLocalPos = vec3(0.0);\n\tvec2 quadXY = meshLocalPos.xy;\n\tfloat nlife = clamp(inLife / particleLifetime, 0.0, 1.0);\n\tvec3 paramDiv;\n\tvec4 params = tex1Dlod_lerp(internalTex2, vec2(nlife, 0), paramDiv);\n\tfloat scale = params.y;\n\tfloat scaleDiv = paramDiv.x;\n\tfloat alphaDiv = paramDiv.z;\n\tscale += (scaleDiv * 2.0 - 1.0) * scaleDivMult * fract(rndFactor*10000.0);\n#ifndef USE_MESH\n\ttexCoordsAlphaLife = vec4(quadXY * -0.5 + 0.5, (alphaDiv * 2.0 - 1.0) * alphaDivMult * fract(rndFactor*1000.0), nlife);\n#else\n\ttexCoordsAlphaLife = vec4(particle_uv, (alphaDiv * 2.0 - 1.0) * alphaDivMult * fract(rndFactor*1000.0), nlife);\n#endif\n\tvec3 particlePos = inPos;\n\tvec3 particlePosMoved = vec3(0.0);\n\tmat2 rotMatrix;\n",particleAnimFrameClampVS:"\tfloat animFrame = min(floor(texCoordsAlphaLife.w * animTexParams.y) + animTexParams.x, animTexParams.z);\n",particleAnimFrameLoopVS:"\tfloat animFrame = floor(mod(texCoordsAlphaLife.w * animTexParams.y + animTexParams.x, animTexParams.z + 1.0));\n",particleAnimTexVS:"\tfloat animationIndex;\n\tif (animTexIndexParams.y == 1.0) {\n\t\tanimationIndex = floor((animTexParams.w + 1.0) * rndFactor3.z) * (animTexParams.z + 1.0);\n\t} else {\n\t\tanimationIndex = animTexIndexParams.x * (animTexParams.z + 1.0);\n\t}\n\tfloat atlasX = (animationIndex + animFrame) * animTexTilesParams.x;\n\tfloat atlasY = 1.0 - floor(atlasX + 1.0) * animTexTilesParams.y;\n\tatlasX = fract(atlasX);\n\ttexCoordsAlphaLife.xy *= animTexTilesParams.xy;\n\ttexCoordsAlphaLife.xy += vec2(atlasX, atlasY);\n",particleInputFloatPS:"void readInput(float uv) {\n\tvec4 tex = texture2D(particleTexIN, vec2(uv, 0.25));\n\tvec4 tex2 = texture2D(particleTexIN, vec2(uv, 0.75));\n\tinPos = tex.xyz;\n\tinVel = tex2.xyz;\n\tinAngle = (tex.w < 0.0? -tex.w : tex.w) - 1000.0;\n\tinShow = tex.w >= 0.0;\n\tinLife = tex2.w;\n}\n",particleInputRgba8PS:"\n#define PI2 6.283185307179586\nuniform vec3 inBoundsSize;\nuniform vec3 inBoundsCenter;\nuniform float maxVel;\nfloat decodeFloatRG(vec2 rg) {\n\treturn rg.y*(1.0/255.0) + rg.x;\n}\nfloat decodeFloatRGBA( vec4 rgba ) {\n  return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\nvoid readInput(float uv) {\n\tvec4 tex0 = texture2D(particleTexIN, vec2(uv, 0.125));\n\tvec4 tex1 = texture2D(particleTexIN, vec2(uv, 0.375));\n\tvec4 tex2 = texture2D(particleTexIN, vec2(uv, 0.625));\n\tvec4 tex3 = texture2D(particleTexIN, vec2(uv, 0.875));\n\tinPos = vec3(decodeFloatRG(tex0.rg), decodeFloatRG(tex0.ba), decodeFloatRG(tex1.rg));\n\tinPos = (inPos - vec3(0.5)) * inBoundsSize + inBoundsCenter;\n\tinVel = tex2.xyz;\n\tinVel = (inVel - vec3(0.5)) * maxVel;\n\tinAngle = decodeFloatRG(tex1.ba) * PI2;\n\tinShow = tex2.a > 0.5;\n\tinLife = decodeFloatRGBA(tex3);\n\tfloat maxNegLife = max(lifetime, (numParticles - 1.0) * (rate+rateDiv));\n\tfloat maxPosLife = lifetime+1.0;\n\tinLife = inLife * (maxNegLife + maxPosLife) - maxNegLife;\n}\n",particleOutputFloatPS:"void writeOutput() {\n\tif (gl_FragCoord.y<1.0) {\n\t\tgl_FragColor = vec4(outPos, (outAngle + 1000.0) * visMode);\n\t} else {\n\t\tgl_FragColor = vec4(outVel, outLife);\n\t}\n}\n",particleOutputRgba8PS:"uniform vec3 outBoundsMul;\nuniform vec3 outBoundsAdd;\nvec2 encodeFloatRG( float v ) {\n\tvec2 enc = vec2(1.0, 255.0) * v;\n\tenc = fract(enc);\n\tenc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\n\treturn enc;\n}\nvec4 encodeFloatRGBA( float v ) {\n\tvec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * v;\n\tenc = fract(enc);\n\tenc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n\treturn enc;\n}\nvoid writeOutput() {\n\toutPos = outPos * outBoundsMul + outBoundsAdd;\n\toutAngle = fract(outAngle / PI2);\n\toutVel = (outVel / maxVel) + vec3(0.5);\n\tfloat maxNegLife = max(lifetime, (numParticles - 1.0) * (rate+rateDiv));\n\tfloat maxPosLife = lifetime+1.0;\n\toutLife = (outLife + maxNegLife) / (maxNegLife + maxPosLife);\n\tif (gl_FragCoord.y < 1.0) {\n\t\tgl_FragColor = vec4(encodeFloatRG(outPos.x), encodeFloatRG(outPos.y));\n\t} else if (gl_FragCoord.y < 2.0) {\n\t\tgl_FragColor = vec4(encodeFloatRG(outPos.z), encodeFloatRG(outAngle));\n\t} else if (gl_FragCoord.y < 3.0) {\n\t\tgl_FragColor = vec4(outVel, visMode*0.5+0.5);\n\t} else {\n\t\tgl_FragColor = encodeFloatRGBA(outLife);\n\t}\n}\n",particleUpdaterAABBPS:"uniform mat3 spawnBounds;\nuniform vec3 spawnPosInnerRatio;\nvec3 calcSpawnPosition(vec3 inBounds, float rndFactor) {\n\tvec3 pos = inBounds - vec3(0.5);\n\tvec3 posAbs = abs(pos);\n\tvec3 maxPos = vec3(max(posAbs.x, max(posAbs.y, posAbs.z)));\n\tvec3 edge = maxPos + (vec3(0.5) - maxPos) * spawnPosInnerRatio;\n\tpos.x = edge.x * (maxPos.x == posAbs.x ? sign(pos.x) : 2.0 * pos.x);\n\tpos.y = edge.y * (maxPos.y == posAbs.y ? sign(pos.y) : 2.0 * pos.y);\n\tpos.z = edge.z * (maxPos.z == posAbs.z ? sign(pos.z) : 2.0 * pos.z);\n#ifndef LOCAL_SPACE\n\treturn emitterPos + spawnBounds * pos;\n#else\n\treturn spawnBounds * pos;\n#endif\n}\nvoid addInitialVelocity(inout vec3 localVelocity, vec3 inBounds) {\n\tlocalVelocity -= vec3(0, 0, initialVelocity);\n}\n",particleUpdaterEndPS:"\twriteOutput();\n}\n",particleUpdaterInitPS:"varying vec2 vUv0;\nuniform highp sampler2D particleTexIN;\nuniform highp sampler2D internalTex0;\nuniform highp sampler2D internalTex1;\nuniform highp sampler2D internalTex2;\nuniform highp sampler2D internalTex3;\nuniform mat3 emitterMatrix, emitterMatrixInv;\nuniform vec3 emitterScale;\nuniform vec3 emitterPos, frameRandom, localVelocityDivMult, velocityDivMult;\nuniform float delta, rate, rateDiv, lifetime, numParticles, rotSpeedDivMult, radialSpeedDivMult, seed;\nuniform float startAngle, startAngle2;\nuniform float initialVelocity;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\nvec3 inPos;\nvec3 inVel;\nfloat inAngle;\nbool inShow;\nfloat inLife;\nfloat visMode;\nvec3 outPos;\nvec3 outVel;\nfloat outAngle;\nbool outShow;\nfloat outLife;\n",particleUpdaterNoRespawnPS:"\tif (outLife >= lifetime) {\n\t\toutLife -= max(lifetime, (numParticles - 1.0) * particleRate);\n\t\tvisMode = -1.0;\n\t}\n",particleUpdaterOnStopPS:"\tvisMode = outLife < 0.0? -1.0: visMode;\n",particleUpdaterRespawnPS:"\tif (outLife >= lifetime) {\n\t\toutLife -= max(lifetime, (numParticles - 1.0) * particleRate);\n\t\tvisMode = 1.0;\n\t}\n\tvisMode = outLife < 0.0? 1.0: visMode;\n",particleUpdaterSpherePS:"uniform float spawnBoundsSphere;\nuniform float spawnBoundsSphereInnerRatio;\nvec3 calcSpawnPosition(vec3 inBounds, float rndFactor) {\n\tfloat rnd4 = fract(rndFactor * 1000.0);\n\tvec3 norm = normalize(inBounds.xyz - vec3(0.5));\n\tfloat r = rnd4 * (1.0 - spawnBoundsSphereInnerRatio) + spawnBoundsSphereInnerRatio;\n#ifndef LOCAL_SPACE\n\treturn emitterPos + norm * r * spawnBoundsSphere;\n#else\n\treturn norm * r * spawnBoundsSphere;\n#endif\n}\nvoid addInitialVelocity(inout vec3 localVelocity, vec3 inBounds) {\n\tlocalVelocity += normalize(inBounds - vec3(0.5)) * initialVelocity;\n}\n",particleUpdaterStartPS:"float saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec3 unpack3NFloats(float src) {\n\tfloat r = fract(src);\n\tfloat g = fract(src * 256.0);\n\tfloat b = fract(src * 65536.0);\n\treturn vec3(r, g, b);\n}\nvec3 tex1Dlod_lerp(highp sampler2D tex, vec2 tc, out vec3 w) {\n\tvec4 a = texture2D(tex, tc);\n\tvec4 b = texture2D(tex, tc + graphSampleSize);\n\tfloat c = fract(tc.x * graphNumSamples);\n\tvec3 unpackedA = unpack3NFloats(a.w);\n\tvec3 unpackedB = unpack3NFloats(b.w);\n\tw = mix(unpackedA, unpackedB, c);\n\treturn mix(a.xyz, b.xyz, c);\n}\n#define HASHSCALE4 vec4(1031, .1030, .0973, .1099)\nvec4 hash41(float p) {\n\tvec4 p4 = fract(vec4(p) * HASHSCALE4);\n\tp4 += dot(p4, p4.wzxy+19.19);\n\treturn fract(vec4((p4.x + p4.y)*p4.z, (p4.x + p4.z)*p4.y, (p4.y + p4.z)*p4.w, (p4.z + p4.w)*p4.x));\n}\nvoid main(void) {\n\tif (gl_FragCoord.x > numParticles) discard;\n\treadInput(vUv0.x);\n\tvisMode = inShow? 1.0 : -1.0;\n\tvec4 rndFactor = hash41(gl_FragCoord.x + seed);\n\tfloat particleRate = rate + rateDiv * rndFactor.x;\n\toutLife = inLife + delta;\n\tfloat nlife = clamp(outLife / lifetime, 0.0, 1.0);\n\tvec3 localVelocityDiv;\n\tvec3 velocityDiv;\n\tvec3 paramDiv;\n\tvec3 localVelocity = tex1Dlod_lerp(internalTex0, vec2(nlife, 0), localVelocityDiv);\n\tvec3 velocity =\t  tex1Dlod_lerp(internalTex1, vec2(nlife, 0), velocityDiv);\n\tvec3 params =\t\ttex1Dlod_lerp(internalTex2, vec2(nlife, 0), paramDiv);\n\tfloat rotSpeed = params.x;\n\tfloat rotSpeedDiv = paramDiv.y;\n\tvec3 radialParams = tex1Dlod_lerp(internalTex3, vec2(nlife, 0), paramDiv);\n\tfloat radialSpeed = radialParams.x;\n\tfloat radialSpeedDiv = radialParams.y;\n\tbool respawn = inLife <= 0.0 || outLife >= lifetime;\n\tinPos = respawn ? calcSpawnPosition(rndFactor.xyz, rndFactor.x) : inPos;\n\tinAngle = respawn ? mix(startAngle, startAngle2, rndFactor.x) : inAngle;\n#ifndef LOCAL_SPACE\n\tvec3 radialVel = inPos - emitterPos;\n#else\n\tvec3 radialVel = inPos;\n#endif\n\tradialVel = (dot(radialVel, radialVel) > 1.0E-8) ? radialSpeed * normalize(radialVel) : vec3(0.0);\n\tradialVel += (radialSpeedDiv * vec3(2.0) - vec3(1.0)) * radialSpeedDivMult * rndFactor.xyz;\n\tlocalVelocity +=\t(localVelocityDiv * vec3(2.0) - vec3(1.0)) * localVelocityDivMult * rndFactor.xyz;\n\tvelocity +=\t\t (velocityDiv * vec3(2.0) - vec3(1.0)) * velocityDivMult * rndFactor.xyz;\n\trotSpeed +=\t\t (rotSpeedDiv * 2.0 - 1.0) * rotSpeedDivMult * rndFactor.y;\n\taddInitialVelocity(localVelocity, rndFactor.xyz);\n#ifndef LOCAL_SPACE\n\toutVel = emitterMatrix * localVelocity + (radialVel + velocity) * emitterScale;\n#else\n\toutVel = (localVelocity + radialVel) / emitterScale + emitterMatrixInv * velocity;\n#endif\n\toutPos = inPos + outVel * delta;\n\toutAngle = inAngle + rotSpeed * delta;\n",particle_billboardVS:"\tquadXY = rotate(quadXY, inAngle, rotMatrix);\n\tvec3 localPos = billboard(particlePos, quadXY);\n",particle_blendAddPS:"\tdBlendModeFogFactor = 0.0;\n\trgb *= saturate(gammaCorrectInput(max(a, 0.0)));\n\tif ((rgb.r + rgb.g + rgb.b) < 0.000001) discard;\n",particle_blendMultiplyPS:"\trgb = mix(vec3(1.0), rgb, vec3(a));\n\tif (rgb.r + rgb.g + rgb.b > 2.99) discard;\n",particle_blendNormalPS:"\tif (a < 0.01) discard;\n",particle_cpuVS:"attribute vec4 particle_vertexData;\nattribute vec4 particle_vertexData2;\nattribute vec4 particle_vertexData3;\nattribute float particle_vertexData4;\n#ifndef USE_MESH\n#define VDATA5TYPE vec2\n#else\n#define VDATA5TYPE vec4\n#endif\nattribute VDATA5TYPE particle_vertexData5;\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform mat3 matrix_normal;\nuniform mat4 matrix_viewInverse;\nuniform float numParticles;\nuniform float lifetime;\nuniform float stretch;\nuniform float seed;\nuniform vec3 wrapBounds, emitterScale, faceTangent, faceBinorm;\nuniform sampler2D texLifeAndSourcePosOUT;\nuniform highp sampler2D internalTex0;\nuniform highp sampler2D internalTex1;\nuniform highp sampler2D internalTex2;\nuniform vec3 emitterPos;\nvarying vec4 texCoordsAlphaLife;\nvec2 rotate(vec2 quadXY, float pRotation, out mat2 rotMatrix)\n{\n\tfloat c = cos(pRotation);\n\tfloat s = sin(pRotation);\n\tmat2 m = mat2(c, -s, s, c);\n\trotMatrix = m;\n\treturn m * quadXY;\n}\nvec3 billboard(vec3 InstanceCoords, vec2 quadXY)\n{\n\tvec3 pos = -matrix_viewInverse[0].xyz * quadXY.x + -matrix_viewInverse[1].xyz * quadXY.y;\n\treturn pos;\n}\nvec3 customFace(vec3 InstanceCoords, vec2 quadXY)\n{\n\tvec3 pos = faceTangent * quadXY.x + faceBinorm * quadXY.y;\n\treturn pos;\n}\nvoid main(void)\n{\n\tvec3 particlePos = particle_vertexData.xyz;\n\tvec3 inPos = particlePos;\n\tvec3 vertPos = particle_vertexData3.xyz;\n\tvec3 inVel = vec3(particle_vertexData2.w, particle_vertexData3.w, particle_vertexData5.x);\n\tfloat id = floor(particle_vertexData4);\n\tfloat rndFactor = fract(sin(id + 1.0 + seed));\n\tvec3 rndFactor3 = vec3(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));\n#ifdef LOCAL_SPACE\n\tinVel = mat3(matrix_model) * inVel;\n#endif\n\tvec2 velocityV = normalize((mat3(matrix_view) * inVel).xy);\n\tvec2 quadXY = vertPos.xy;\n#ifndef USE_MESH\n\ttexCoordsAlphaLife = vec4(quadXY * -0.5 + 0.5, particle_vertexData2.z, particle_vertexData.w);\n#else\n\ttexCoordsAlphaLife = vec4(particle_vertexData5.zw, particle_vertexData2.z, particle_vertexData.w);\n#endif\n\tmat2 rotMatrix;\n\tfloat inAngle = particle_vertexData2.x;\n\tvec3 particlePosMoved = vec3(0.0);\n\tvec3 meshLocalPos = particle_vertexData3.xyz;\n",particle_cpu_endVS:"\tlocalPos *= particle_vertexData2.y * emitterScale;\n\tlocalPos += particlePos;\n\tgl_Position = matrix_viewProjection * vec4(localPos, 1.0);\n",particle_customFaceVS:"\tquadXY = rotate(quadXY, inAngle, rotMatrix);\n\tvec3 localPos = customFace(particlePos, quadXY);\n",particle_endPS:"\trgb = addFog(rgb);\n\trgb = toneMap(rgb);\n\trgb = gammaCorrectOutput(rgb);\n\tgl_FragColor = vec4(rgb, a);\n}\n",particle_endVS:"\tlocalPos *= scale * emitterScale;\n\tlocalPos += particlePos;\n\t#ifdef SCREEN_SPACE\n\tgl_Position = vec4(localPos.x, localPos.y, 0.0, 1.0);\n\t#else\n\tgl_Position = matrix_viewProjection * vec4(localPos.xyz, 1.0);\n\t#endif\n",particle_halflambertPS:"\tvec3 negNormal = normal*0.5+0.5;\n\tvec3 posNormal = -normal*0.5+0.5;\n\tnegNormal *= negNormal;\n\tposNormal *= posNormal;\n",particle_initVS:"attribute vec4 particle_vertexData;\n#ifdef USE_MESH\nattribute vec2 particle_uv;\n#endif\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\nuniform mat3 matrix_normal;\nuniform mat4 matrix_viewInverse;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform float numParticles, numParticlesPot;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\nuniform float stretch;\nuniform vec3 wrapBounds;\nuniform vec3 emitterScale, emitterPos, faceTangent, faceBinorm;\nuniform float rate, rateDiv, lifetime, deltaRandomnessStatic, scaleDivMult, alphaDivMult, seed, delta;\nuniform sampler2D particleTexOUT, particleTexIN;\nuniform highp sampler2D internalTex0;\nuniform highp sampler2D internalTex1;\nuniform highp sampler2D internalTex2;\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\nvarying vec4 texCoordsAlphaLife;\nvec3 inPos;\nvec3 inVel;\nfloat inAngle;\nbool inShow;\nfloat inLife;\n",particle_lambertPS:"\tvec3 negNormal = max(normal, vec3(0.0));\n\tvec3 posNormal = max(-normal, vec3(0.0));\n",particle_lightingPS:"\tvec3 light = negNormal.x*lightCube[0] + posNormal.x*lightCube[1] +\n\t\t\t\t\t\tnegNormal.y*lightCube[2] + posNormal.y*lightCube[3] +\n\t\t\t\t\t\tnegNormal.z*lightCube[4] + posNormal.z*lightCube[5];\n\trgb *= light;\n",particle_localShiftVS:"\tparticlePos = (matrix_model * vec4(particlePos, 1.0)).xyz;\n",particle_meshVS:"\tvec3 localPos = meshLocalPos;\n\tlocalPos.xy = rotate(localPos.xy, inAngle, rotMatrix);\n\tlocalPos.yz = rotate(localPos.yz, inAngle, rotMatrix);\n\tbillboard(particlePos, quadXY);\n",particle_normalVS:"\tNormal = normalize(localPos + matrix_viewInverse[2].xyz);\n",particle_normalMapPS:"\tvec3 normalMap = normalize(texture2D(normalMap, texCoordsAlphaLife.xy).xyz * 2.0 - 1.0);\n\tvec3 normal = ParticleMat * normalMap;\n",particle_pointAlongVS:"\tinAngle = atan(velocityV.x, velocityV.y);\n",particle_softPS:"\tfloat depth = getLinearScreenDepth();\n\tfloat particleDepth = vDepth;\n\tfloat depthDiff = saturate(abs(particleDepth - depth) * softening);\n\ta *= depthDiff;\n",particle_softVS:"\tvDepth = getLinearDepth(localPos);\n",particle_stretchVS:"\tvec3 moveDir = inVel * stretch;\n\tvec3 posPrev = particlePos - moveDir;\n\tposPrev += particlePosMoved;\n\tvec2 centerToVertexV = normalize((mat3(matrix_view) * localPos).xy);\n\tfloat interpolation = dot(-velocityV, centerToVertexV) * 0.5 + 0.5;\n\tparticlePos = mix(particlePos, posPrev, interpolation);\n",particle_TBNVS:"\tmat3 rot3 = mat3(rotMatrix[0][0], rotMatrix[0][1], 0.0, rotMatrix[1][0], rotMatrix[1][1], 0.0, 0.0, 0.0, 1.0);\n\tParticleMat = mat3(-matrix_viewInverse[0].xyz, -matrix_viewInverse[1].xyz, matrix_viewInverse[2].xyz) * rot3;\n",particle_wrapVS:"\tvec3 origParticlePos = particlePos;\n\tparticlePos -= matrix_model[3].xyz;\n\tparticlePos = mod(particlePos, wrapBounds) - wrapBounds * 0.5;\n\tparticlePos += matrix_model[3].xyz;\n\tparticlePosMoved = particlePos - origParticlePos;\n",precisionTestPS:"void main(void) {\n\tgl_FragColor = vec4(2147483648.0);\n}\n",precisionTest2PS:"uniform sampler2D source;\nvec4 packFloat(float depth) {\n\tconst vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n\tconst vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n\tvec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main(void) {\n\tfloat c = texture2D(source, vec2(0.0)).r;\n\tfloat diff = abs(c - 2147483648.0) / 2147483648.0;\n\tgl_FragColor = packFloat(diff);\n}\n",prefilterCubemapPS:"varying vec2 vUv0;\nuniform samplerCube source;\nuniform vec4 params;\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nfloat rnd(vec2 uv) {\n\treturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nconst float PI = 3.14159265358979;\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\n\tfloat phi = uv.y * 2.0 * PI;\n\tfloat cosTheta = sqrt(1.0 - uv.x);\n\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\treturn normalize(mix(vecSpace * sampleDir, cubeDir, params.y));\n}\nvec3 hemisphereSample_phong(vec2 uv, mat3 vecSpace, vec3 cubeDir, float specPow) {\n\tfloat phi = uv.y * 2.0 * PI;\n\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\tvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n\treturn vecSpace * sampleDir;\n}\nmat3 matrixFromVector(vec3 n) {\n\tfloat a = 1.0 / (1.0 + n.z);\n\tfloat b = -n.x * n.y * a;\n\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\treturn mat3(b1, b2, n);\n}\nvec4 encodeRGBM(vec3 color) {\n\tvec4 encoded;\n\tencoded.rgb = pow(color.rgb, vec3(0.5));\n\tencoded.rgb *= 1.0 / 8.0;\n\tencoded.a = saturate( max( max( encoded.r, encoded.g ), max( encoded.b, 1.0 / 255.0 ) ) );\n\tencoded.a = ceil(encoded.a * 255.0) / 255.0;\n\tencoded.rgb /= encoded.a;\n\treturn encoded;\n}\nvoid main(void) {\n\tvec2 st = vUv0 * 2.0 - 1.0;\n\tif (params.w==1.0 || params.w==3.0) {\n\t\tst = 2.0 * floor(gl_FragCoord.xy) / (params.z - 1.0) - 1.0;\n\t}\n\tfloat face = params.x;\n\tvec3 vec;\n\tif (face==0.0) {\n\t\tvec = vec3(1, -st.y, -st.x);\n\t} else if (face==1.0) {\n\t\tvec = vec3(-1, -st.y, st.x);\n\t} else if (face==2.0) {\n\t\tvec = vec3(st.x, 1, st.y);\n\t} else if (face==3.0) {\n\t\tvec = vec3(st.x, -1, -st.y);\n\t} else if (face==4.0) {\n\t\tvec = vec3(st.x, -st.y, 1);\n\t} else {\n\t\tvec = vec3(-st.x, -st.y, -1);\n\t}\n\tmat3 vecSpace = matrixFromVector(normalize(vec));\n\tvec3 color = vec3(0.0);\n\tconst int samples = $NUMSAMPLES;\n\tvec3 vect;\n\tfor(int i=0; i<samples; i++) {\n\t\tfloat sini = sin(float(i));\n\t\tfloat cosi = cos(float(i));\n\t\tfloat rand = rnd(vec2(sini, cosi));\n\t\tvect = hemisphereSample_$METHOD(vec2(float(i) / float(samples), rand), vecSpace, vec, params.y);\n\t\tcolor += $textureCube(source, vect).rgb;\n\t}\n\tcolor /= float(samples);\n\tgl_FragColor = params.w < 2.0? vec4(color, 1.0) : encodeRGBM(color);\n}\n",reflDirPS:"void getReflDir() {\n\tdReflDirW = normalize(-reflect(dViewDirW, dNormalW));\n}\n",reflDirAnisoPS:"void getReflDir() {\n\tfloat roughness = sqrt(1.0 - min(dGlossiness, 1.0));\n\tfloat anisotropy = material_anisotropy * roughness;\n\tvec3 anisotropicDirection = anisotropy >= 0.0 ? dTBN[1] : dTBN[0];\n\tvec3 anisotropicTangent = cross(anisotropicDirection, dViewDirW);\n\tvec3 anisotropicNormal = cross(anisotropicTangent, anisotropicDirection);\n\tvec3 bentNormal = normalize(mix(normalize(dNormalW), normalize(anisotropicNormal), anisotropy));\n\tdReflDirW = reflect(-dViewDirW, bentNormal);\n}\n",reflectionCCPS:"#ifdef CLEARCOAT\nuniform float material_clearCoatReflectivity;\nvoid addReflectionCC() {\n\tccReflection += vec4(calcReflection(ccReflDirW, ccGlossiness), material_clearCoatReflectivity);\n}\n#endif\n",reflectionCubePS:"uniform samplerCube texture_cubeMap;\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 tReflDirW, float tGlossiness) {\n\tvec3 lookupVec = fixSeams(cubeMapProject(tReflDirW));\n#ifndef RIGHT_HANDED_CUBEMAP\n\tlookupVec.x *= -1.0;\n#endif\n\treturn $textureCubeSAMPLE(texture_cubeMap, lookupVec).rgb;\n}\nvoid addReflection() {\n\tdReflection += vec4(calcReflection(dReflDirW, dGlossiness), material_reflectivity);\n}\n",reflectionDpAtlasPS:"uniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\nvec2 getDpAtlasUv(vec2 uv, float mip) {\n\tvec4 rect;\n\tfloat sx = saturate(mip - 2.0);\n\trect.x = sx * 0.5;\n\tfloat t = mip - rect.x * 6.0;\n\tfloat i = 1.0 - rect.x;\n\trect.y = min(t * 0.5, 0.75) * i + rect.x;\n\tfloat st = saturate(t);\n\trect.z = (1.0 - st * 0.5) * i;\n\trect.w = rect.z * 0.5;\n\tfloat rcRectZ = 1.0 / rect.z;\n\tfloat scaleFactor = 0.00390625 * rcRectZ;\n\tvec2 scale = vec2(scaleFactor, scaleFactor * 2.0);\n\tuv = uv * (vec2(1.0) - scale) + scale * 0.5;\n\tuv = uv * rect.zw + rect.xy;\n\treturn uv;\n}\nvec3 calcReflection(vec3 tReflDirW, float tGlossiness) {\n\tvec3 reflDir = normalize(cubeMapProject(tReflDirW));\n\tbool up = reflDir.y > 0.0;\n\tfloat scale = 0.90909090909090909090909090909091;\n\tvec3 reflDirWarp = reflDir.xzx * vec3(-0.25, 0.5, 0.25);\n\tfloat reflDirVer = abs(reflDir.y) + 1.0;\n\treflDirWarp /= reflDirVer;\n\treflDirWarp *= scale;\n\treflDirWarp = vec3(0.75, 0.5, 0.25) - reflDirWarp;\n\tvec2 tc = up? reflDirWarp.xy : reflDirWarp.zy;\n\tfloat bias = saturate(1.0 - tGlossiness) * 5.0;\n\tfloat mip = floor(bias);\n\tvec3 tex1 = $texture2DSAMPLE(texture_sphereMap, getDpAtlasUv(tc, mip)).rgb;\n\tmip = min(mip + 1.0, 5.0);\n\tvec3 tex2 = $texture2DSAMPLE(texture_sphereMap, getDpAtlasUv(tc, mip)).rgb;\n\ttex1 = mix(tex1, tex2, fract(bias));\n\ttex1 = processEnvironment(tex1);\n\treturn tex1;\n}\nvoid addReflection() {\n\tdReflection += vec4(calcReflection(dReflDirW, dGlossiness), material_reflectivity);\n}\n",reflectionPrefilteredCubePS:"uniform samplerCube texture_prefilteredCubeMap128;\nuniform samplerCube texture_prefilteredCubeMap64;\nuniform samplerCube texture_prefilteredCubeMap32;\nuniform samplerCube texture_prefilteredCubeMap16;\nuniform samplerCube texture_prefilteredCubeMap8;\n#ifndef PMREM4\n#define PMREM4\nuniform samplerCube texture_prefilteredCubeMap4;\n#endif\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 tReflDirW, float tGlossiness) {\n\tvec3 refl = cubeMapProject(tReflDirW);\n#ifndef RIGHT_HANDED_CUBEMAP\n\trefl.x *= -1.0;\n#endif\n\tvec3 seam = calcSeam(refl);\n\tvec4 c0 = textureCube(texture_prefilteredCubeMap128, applySeam(refl, seam, 1.0 / 128.0));\n\tvec4 c1 = textureCube(texture_prefilteredCubeMap64, applySeam(refl, seam, 2.0 / 128.0));\n\tvec4 c2 = textureCube(texture_prefilteredCubeMap32, applySeam(refl, seam, 4.0 / 128.0));\n\tvec4 c3 = textureCube(texture_prefilteredCubeMap16, applySeam(refl, seam, 8.0 / 128.0));\n\tvec4 c4 = textureCube(texture_prefilteredCubeMap8, applySeam(refl, seam, 16.0 / 128.0));\n\tvec4 c5 = textureCube(texture_prefilteredCubeMap4, applySeam(refl, seam, 32.0 / 128.0));\n\tfloat bias = saturate(1.0 - tGlossiness) * 5.0;\n\tvec4 cubes0;\n\tvec4 cubes1;\n\tif (bias < 1.0) {\n\t\tcubes0 = c0;\n\t\tcubes1 = c1;\n\t} else if (bias < 2.0) {\n\t\tcubes0 = c1;\n\t\tcubes1 = c2;\n\t} else if (bias < 3.0) {\n\t\tcubes0 = c2;\n\t\tcubes1 = c3;\n\t} else if (bias < 4.0) {\n\t\tcubes0 = c3;\n\t\tcubes1 = c4;\n\t} else {\n\t\tcubes0 = c4;\n\t\tcubes1 = c5;\n\t}\n\tvec4 cubeFinal = mix(cubes0, cubes1, fract(bias));\n\treturn processEnvironment($DECODE(cubeFinal).rgb);\n}\nvoid addReflection() {\n\tdReflection += vec4(calcReflection(dReflDirW, dGlossiness), material_reflectivity);\n}\n",reflectionPrefilteredCubeLodPS:"#ifndef PMREM4\n#define PMREM4\n#extension GL_EXT_shader_texture_lod : enable\nuniform samplerCube texture_prefilteredCubeMap128;\n#endif\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 tReflDirW, float tGlossiness) {\n\tfloat bias = saturate(1.0 - tGlossiness) * 5.0;\n\tvec3 fixedReflDir = fixSeams(cubeMapProject(tReflDirW), bias);\n#ifndef RIGHT_HANDED_CUBEMAP\n\tfixedReflDir.x *= -1.0;\n#endif\n\tvec3 refl = processEnvironment($DECODE( textureCubeLodEXT(texture_prefilteredCubeMap128, fixedReflDir, bias) ).rgb);\n\treturn refl;\n}\nvoid addReflection() {\n\tdReflection += vec4(calcReflection(dReflDirW, dGlossiness), material_reflectivity);\n}\n",reflectionSpherePS:"#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 tReflDirW, float tGlossiness) {\n\tvec3 reflDirV = (mat3(matrix_view) * tReflDirW).xyz;\n\tfloat m = 2.0 * sqrt( dot(reflDirV.xy, reflDirV.xy) + (reflDirV.z+1.0)*(reflDirV.z+1.0) );\n\tvec2 sphereMapUv = reflDirV.xy / m + 0.5;\n\treturn $texture2DSAMPLE(texture_sphereMap, sphereMapUv).rgb;\n}\nvoid addReflection() {\n\tdReflection += vec4(calcReflection(dReflDirW, dGlossiness), material_reflectivity);\n}\n",reflectionSphereLowPS:"uniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\nvec3 calcReflection(vec3 tReflDirW, float tGlossiness) {\n\tvec3 reflDirV = vNormalV;\n\tvec2 sphereMapUv = reflDirV.xy * 0.5 + 0.5;\n\treturn $texture2DSAMPLE(texture_sphereMap, sphereMapUv).rgb;\n}\nvoid addReflection() {\n\tdReflection += vec4(calcReflection(dReflDirW, dGlossiness), material_reflectivity);\n}\n",refractionPS:"uniform float material_refraction, material_refractionIndex;\nvec3 refract2(vec3 viewVec, vec3 Normal, float IOR) {\n\tfloat vn = dot(viewVec, Normal);\n\tfloat k = 1.0 - IOR * IOR * (1.0 - vn * vn);\n\tvec3 refrVec = IOR * viewVec - (IOR * vn + sqrt(k)) * Normal;\n\treturn refrVec;\n}\nvoid addRefraction() {\n\tvec3 tmp = dReflDirW;\n\tvec4 tmp2 = dReflection;\n\tdReflection = vec4(0.0);\n\tdReflDirW = refract2(-dViewDirW, dNormalW, material_refractionIndex);\n\taddReflection();\n\tdDiffuseLight = mix(dDiffuseLight, dReflection.rgb * dAlbedo, material_refraction);\n\tdReflDirW = tmp;\n\tdReflection = tmp2;\n}\n",reprojectPS:"\nvarying vec2 vUv0;\nuniform sampler2D sourceTex;\nuniform samplerCube sourceCube;\nuniform vec4 params;\nfloat targetFace() { return params.x; }\nfloat specularPower() { return params.y; }\nfloat sourceCubeSeamScale() { return params.z; }\nfloat targetCubeSeamScale() { return params.w; }\nfloat PI = 3.141592653589793;\nfloat saturate(float x) {\n\treturn clamp(x, 0.0, 1.0);\n}\nvec3 decodeLinear(vec4 source) {\n\treturn source.rgb;\n}\nvec4 encodeLinear(vec3 source) {\n\treturn vec4(source, 1.0);\n}\nvec3 decodeGamma(vec4 source) {\n\treturn pow(source.xyz, vec3(2.2));\n}\nvec4 encodeGamma(vec3 source) {\n\treturn vec4(pow(source + 0.0000001, vec3(1.0 / 2.2)), 1.0);\n}\nvec3 decodeRGBM(vec4 rgbm) {\n\tvec3 color = (8.0 * rgbm.a) * rgbm.rgb;\n\treturn color * color;\n}\nvec4 encodeRGBM(vec3 source) {\n\tvec4 result;\n\tresult.rgb = pow(source.rgb, vec3(0.5));\n\tresult.rgb *= 1.0 / 8.0;\n\tresult.a = saturate( max( max( result.r, result.g ), max( result.b, 1.0 / 255.0 ) ) );\n\tresult.a = ceil(result.a * 255.0) / 255.0;\n\tresult.rgb /= result.a;\n\treturn result;\n}\nvec3 decodeRGBE(vec4 source) {\n\tif (source.a == 0.0) {\n\t\treturn vec3(0.0, 0.0, 0.0);\n\t} else {\n\t\treturn source.xyz * pow(2.0, source.w * 255.0 - 128.0);\n\t}\n}\nvec4 encodeRGBE(vec3 source) {\n\tfloat maxVal = max(source.x, max(source.y, source.z));\n\tif (maxVal < 1e-32) {\n\t\treturn vec4(0, 0, 0, 0);\n\t} else {\n\t\tfloat e = ceil(log2(maxVal));\n\t\treturn vec4(source / pow(2.0, e), (e + 128.0) / 255.0);\n\t}\n}\nvec3 modifySeams(vec3 dir, float amount) {\n\tif (amount != 1.0) {\n\t\tvec3 adir = abs(dir);\n\t\tfloat M = max(max(adir.x, adir.y), adir.z);\n\t\tif (adir.x == M) {\n\t\t\tdir.y *= amount;\n\t\t\tdir.z *= amount;\n\t\t}\n\t\telse if (adir.y == M) {\n\t\t\tdir.x *= amount;\n\t\t\tdir.z *= amount;\n\t\t} else {\n\t\t\tdir.x *= amount;\n\t\t\tdir.y *= amount;\n\t\t}\n\t}\n\treturn dir;\n}\nvec2 toSpherical(vec3 dir) {\n\treturn vec2(atan(dir.z, dir.x) * -1.0, asin(dir.y));\n}\nvec3 fromSpherical(vec2 uv) {\n\treturn vec3(cos(uv.y) * cos(-uv.x),\n\t\t\t\tsin(uv.y),\n\t\t\t\tcos(uv.y) * sin(-uv.x));\n}\nvec4 sampleEquirect(vec2 sph) {\n\treturn texture2D(sourceTex, sph / vec2(PI * 2.0, PI) + 0.5);\n}\nvec4 sampleEquirect(vec3 dir) {\n\treturn sampleEquirect(toSpherical(dir));\n}\nvec4 sampleCubemap(vec3 dir) {\n\treturn textureCube(sourceCube, modifySeams(dir, sourceCubeSeamScale()));\n}\nvec4 sampleCubemap(vec2 sph) {\n\treturn sampleCubemap(fromSpherical(sph));\n}\nvec3 getDirectionEquirect() {\n\treturn fromSpherical((vUv0 * 2.0 - 1.0) * vec2(PI, PI * 0.5));\n}\nvec3 getDirectionCubemap() {\n\tvec2 st = vUv0 * 2.0 - 1.0;\n\tfloat face = targetFace();\n\tvec3 vec;\n\tif (face == 0.0) {\n\t\tvec = vec3(1, -st.y, -st.x);\n\t} else if (face == 1.0) {\n\t\tvec = vec3(-1, -st.y, st.x);\n\t} else if (face == 2.0) {\n\t\tvec = vec3(st.x, 1, st.y);\n\t} else if (face == 3.0) {\n\t\tvec = vec3(st.x, -1, -st.y);\n\t} else if (face == 4.0) {\n\t\tvec = vec3(st.x, -st.y, 1);\n\t} else {\n\t\tvec = vec3(-st.x, -st.y, -1);\n\t}\n\treturn normalize(modifySeams(vec, 1.0 / targetCubeSeamScale()));\n}\nmat3 matrixFromVector(vec3 n) {\n\tfloat a = 1.0 / (1.0 + n.z);\n\tfloat b = -n.x * n.y * a;\n\tvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n\tvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n\treturn mat3(b1, b2, n);\n}\nmat3 matrixFromVectorSlow(vec3 n) {\n\tvec3 a = normalize(cross(n, vec3(0, 1, 0)));\n\tvec3 b = cross(n, a);\n\treturn mat3(a, b, n);\n}\nfloat rnd(int i) {\n\tfloat sini = sin(float(i));\n\tfloat cosi = cos(float(i));\n\treturn fract(sin(dot(vec2(sini, cosi), vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSamplePhong(vec2 uv, float specPow) {\n\tfloat phi = uv.y * 2.0 * PI;\n\tfloat cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n\tfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\treturn vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n}\nvec4 reproject() {\n\tif (NUM_SAMPLES <= 1) {\n\t\treturn ENCODE_FUNC(DECODE_FUNC(SOURCE_FUNC(TARGET_FUNC())));\n\t} else {\n\t\tvec2 sph = toSpherical(TARGET_FUNC());\n\t\tvec2 sphu = dFdx(sph);\n\t\tvec2 sphv = dFdy(sph);\n\t\tconst float num = sqrt(float(NUM_SAMPLES));\n\t\tvec3 result = vec3(0.0);\n\t\tfor (float u=0.0; u<num; ++u) {\n\t\t\tfor (float v=0.0; v<num; ++v) {\n\t\t\t\tresult += DECODE_FUNC(SOURCE_FUNC(sph +\n\t\t\t\t\t\t\t\t\t\t\t\t  sphu * (u / num - 0.5) +\n\t\t\t\t\t\t\t\t\t\t\t\t  sphv * (v / num - 0.5)));\n\t\t\t}\n\t\t}\n\t\treturn ENCODE_FUNC(result / (num * num));\n\t}\n}\nvec4 prefilter() {\n\tvec3 vec = TARGET_FUNC();\n\tmat3 vecSpace = matrixFromVectorSlow(vec);\n\tvec3 result = vec3(0.0);\n\tfor (int i=0; i<NUM_SAMPLES; ++i) {\n\t\tvec2 uv = vec2(float(i) / float(NUM_SAMPLES), rnd(i));\n\t\tvec3 dir = vecSpace * hemisphereSamplePhong(uv, specularPower());\n\t\tresult += DECODE_FUNC(SOURCE_FUNC(dir));\n\t}\n\treturn ENCODE_FUNC(result / float(NUM_SAMPLES));\n}\nvoid main(void) {\n\tgl_FragColor = PROCESS_FUNC();\n}\n",rgbmPS:"vec3 decodeRGBM(vec4 rgbm) {\n\tvec3 color = (8.0 * rgbm.a) * rgbm.rgb;\n\treturn color * color;\n}\nvec3 texture2DRGBM(sampler2D tex, vec2 uv) {\n\treturn decodeRGBM(texture2D(tex, uv));\n}\nvec3 textureCubeRGBM(samplerCube tex, vec3 uvw) {\n\treturn decodeRGBM(textureCube(tex, uvw));\n}\n",screenDepthPS:"uniform sampler2D uDepthMap;\n#ifndef SCREENSIZE\n#define SCREENSIZE\nuniform vec4 uScreenSize;\n#endif\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\n#ifdef GL2\nfloat linearizeDepth(float z) {\n\tz = z * 2.0 - 1.0;\n\treturn 1.0 / (camera_params.z * z + camera_params.w);\n}\n#else\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n\tconst vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n\treturn dot(rgbaDepth, bitShift);\n}\n#endif\n#endif\nfloat getLinearScreenDepth(vec2 uv) {\n\t#ifdef GL2\n\treturn linearizeDepth(texture2D(uDepthMap, uv).r) * camera_params.y;\n\t#else\n\treturn unpackFloat(texture2D(uDepthMap, uv)) * camera_params.y;\n\t#endif\n}\n#ifndef VERTEXSHADER\nfloat getLinearScreenDepth() {\n\tvec2 uv = gl_FragCoord.xy * uScreenSize.zw;\n\treturn getLinearScreenDepth(uv);\n}\n#endif\nfloat getLinearDepth(vec3 pos) {\n\treturn -(matrix_view * vec4(pos, 1.0)).z;\n}\n",shadowCommonPS:"void normalOffsetPointShadow(vec4 shadowParams) {\n\tfloat distScale = length(dLightDirW);\n\tvec3 wPos = vPositionW + dVertexNormalW * shadowParams.y * clamp(1.0 - dot(dVertexNormalW, -dLightDirNormW), 0.0, 1.0) * distScale;\n\tvec3 dir = wPos - dLightPosW;\n\tdLightDirW = dir;\n}\n",shadowCoordPS:"void _getShadowCoordOrtho(mat4 shadowMatrix, vec3 shadowParams, vec3 wPos) {\n\tdShadowCoord = (shadowMatrix * vec4(wPos, 1.0)).xyz;\n\tdShadowCoord.z = saturate(dShadowCoord.z) - 0.0001;\n\t#ifdef SHADOWBIAS\n\tdShadowCoord.z += getShadowBias(shadowParams.x, shadowParams.z);\n\t#endif\n}\nvoid _getShadowCoordPersp(mat4 shadowMatrix, vec4 shadowParams, vec3 wPos) {\n\tvec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n\tprojPos.xy /= projPos.w;\n\tdShadowCoord.xy = projPos.xy;\n\tdShadowCoord.z = length(dLightDirW) * shadowParams.w;\n\t#ifdef SHADOWBIAS\n\tdShadowCoord.z += getShadowBias(shadowParams.x, shadowParams.z);\n\t#endif\n}\nvoid getShadowCoordOrtho(mat4 shadowMatrix, vec3 shadowParams) {\n\t_getShadowCoordOrtho(shadowMatrix, shadowParams, vPositionW);\n}\nvoid getShadowCoordPersp(mat4 shadowMatrix, vec4 shadowParams) {\n\t_getShadowCoordPersp(shadowMatrix, shadowParams, vPositionW);\n}\nvoid getShadowCoordPerspNormalOffset(mat4 shadowMatrix, vec4 shadowParams) {\n\tfloat distScale = abs(dot(vPositionW - dLightPosW, dLightDirNormW));\n\tvec3 wPos = vPositionW + dVertexNormalW * shadowParams.y * clamp(1.0 - dot(dVertexNormalW, -dLightDirNormW), 0.0, 1.0) * distScale;\n\t_getShadowCoordPersp(shadowMatrix, shadowParams, wPos);\n}\nvoid getShadowCoordOrthoNormalOffset(mat4 shadowMatrix, vec3 shadowParams) {\n\tvec3 wPos = vPositionW + dVertexNormalW * shadowParams.y * clamp(1.0 - dot(dVertexNormalW, -dLightDirNormW), 0.0, 1.0);\n\t_getShadowCoordOrtho(shadowMatrix, shadowParams, wPos);\n}\n",shadowCoordVS:"void getLightDirPoint(vec3 lightPosW) {\n\tvec3 lightDirW = vPositionW - lightPosW;\n\tdLightDirNormW = normalize(lightDirW);\n\tdLightPosW = lightPosW;\n}\nvoid _getShadowCoordOrtho(mat4 shadowMatrix, vec3 shadowParams, vec3 wPos) {\n\tvec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n\tvMainShadowUv = projPos;\n}\nvoid _getShadowCoordPersp(mat4 shadowMatrix, vec3 shadowParams, vec3 wPos) {\n\tvec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n\tvMainShadowUv = projPos;\n}\nvoid getShadowCoordOrtho(mat4 shadowMatrix, vec3 shadowParams) {\n\t_getShadowCoordOrtho(shadowMatrix, shadowParams, vPositionW);\n}\nvoid getShadowCoordPersp(mat4 shadowMatrix, vec3 shadowParams) {\n\t_getShadowCoordPersp(shadowMatrix, shadowParams, vPositionW);\n}\nvoid getShadowCoordPerspNormalOffset(mat4 shadowMatrix, vec3 shadowParams) {\n\tfloat distScale = abs(dot(vPositionW - dLightPosW, dLightDirNormW));\n\tvec3 wPos = vPositionW + dNormalW * shadowParams.y * clamp(1.0 - dot(dNormalW, -dLightDirNormW), 0.0, 1.0) * distScale;\n\t_getShadowCoordPersp(shadowMatrix, shadowParams, wPos);\n}\nvoid getShadowCoordOrthoNormalOffset(mat4 shadowMatrix, vec3 shadowParams) {\n\tvec3 wPos = vPositionW + dNormalW * shadowParams.y * clamp(1.0 - dot(dNormalW, -dLightDirNormW), 0.0, 1.0);\n\t_getShadowCoordOrtho(shadowMatrix, shadowParams, wPos);\n}\n",shadowCoordPerspZbufferPS:"void _getShadowCoordPerspZbuffer(mat4 shadowMatrix, vec4 shadowParams, vec3 wPos) {\n\tvec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n\tprojPos.xyz /= projPos.w;\n\tdShadowCoord = projPos.xyz;\n}\nvoid getShadowCoordPerspZbufferNormalOffset(mat4 shadowMatrix, vec4 shadowParams) {\n\tfloat distScale = abs(dot(vPositionW - dLightPosW, dLightDirNormW));\n\tvec3 wPos = vPositionW + dVertexNormalW * shadowParams.y * clamp(1.0 - dot(dVertexNormalW, -dLightDirNormW), 0.0, 1.0) * distScale;\n\t_getShadowCoordPerspZbuffer(shadowMatrix, shadowParams, wPos);\n}\nvoid getShadowCoordPerspZbuffer(mat4 shadowMatrix, vec4 shadowParams) {\n\t_getShadowCoordPerspZbuffer(shadowMatrix, shadowParams, vPositionW);\n}\n",shadowEVSMPS:"float VSM$(sampler2D tex, vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n\tvec3 moments = texture2D(tex, texCoords).xyz;\n\treturn calculateEVSM(moments, Z, vsmBias, exponent);\n}\nfloat getShadowVSM$(sampler2D shadowMap, vec3 shadowParams, float exponent) {\n\treturn VSM$(shadowMap, dShadowCoord.xy, shadowParams.x, dShadowCoord.z, shadowParams.y, exponent);\n}\nfloat getShadowSpotVSM$(sampler2D shadowMap, vec4 shadowParams, float exponent) {\n\treturn VSM$(shadowMap, dShadowCoord.xy, shadowParams.x, length(dLightDirW) * shadowParams.w + shadowParams.z, shadowParams.y, exponent);\n}\n",shadowEVSMnPS:"float VSM$(sampler2D tex, vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n\tfloat pixelSize = 1.0 / resolution;\n\ttexCoords -= vec2(pixelSize);\n\tvec3 s00 = texture2D(tex, texCoords).xyz;\n\tvec3 s10 = texture2D(tex, texCoords + vec2(pixelSize, 0)).xyz;\n\tvec3 s01 = texture2D(tex, texCoords + vec2(0, pixelSize)).xyz;\n\tvec3 s11 = texture2D(tex, texCoords + vec2(pixelSize)).xyz;\n\tvec2 fr = fract(texCoords * resolution);\n\tvec3 h0 = mix(s00, s10, fr.x);\n\tvec3 h1 = mix(s01, s11, fr.x);\n\tvec3 moments = mix(h0, h1, fr.y);\n\treturn calculateEVSM(moments, Z, vsmBias, exponent);\n}\nfloat getShadowVSM$(sampler2D shadowMap, vec3 shadowParams, float exponent) {\n\treturn VSM$(shadowMap, dShadowCoord.xy, shadowParams.x, dShadowCoord.z, shadowParams.y, exponent);\n}\nfloat getShadowSpotVSM$(sampler2D shadowMap, vec4 shadowParams, float exponent) {\n\treturn VSM$(shadowMap, dShadowCoord.xy, shadowParams.x, length(dLightDirW) * shadowParams.w + shadowParams.z, shadowParams.y, exponent);\n}\n",shadowStandardPS:"vec3 lessThan2(vec3 a, vec3 b) {\n\treturn clamp((b - a)*1000.0, 0.0, 1.0);\n}\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n\tconst vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n\treturn dot(rgbaDepth, bitShift);\n}\n#endif\n#ifdef GL2\nfloat _getShadowPCF3x3(sampler2DShadow shadowMap, vec3 shadowParams) {\n\tfloat z = dShadowCoord.z;\n\tvec2 uv = dShadowCoord.xy * shadowParams.x;\n\tfloat shadowMapSizeInv = 1.0 / shadowParams.x;\n\tvec2 base_uv = floor(uv + 0.5);\n\tfloat s = (uv.x + 0.5 - base_uv.x);\n\tfloat t = (uv.y + 0.5 - base_uv.y);\n\tbase_uv -= vec2(0.5);\n\tbase_uv *= shadowMapSizeInv;\n\tfloat sum = 0.0;\n\tfloat uw0 = (3.0 - 2.0 * s);\n\tfloat uw1 = (1.0 + 2.0 * s);\n\tfloat u0 = (2.0 - s) / uw0 - 1.0;\n\tfloat u1 = s / uw1 + 1.0;\n\tfloat vw0 = (3.0 - 2.0 * t);\n\tfloat vw1 = (1.0 + 2.0 * t);\n\tfloat v0 = (2.0 - t) / vw0 - 1.0;\n\tfloat v1 = t / vw1 + 1.0;\n\tu0 = u0 * shadowMapSizeInv + base_uv.x;\n\tv0 = v0 * shadowMapSizeInv + base_uv.y;\n\tu1 = u1 * shadowMapSizeInv + base_uv.x;\n\tv1 = v1 * shadowMapSizeInv + base_uv.y;\n\tsum += uw0 * vw0 * texture(shadowMap, vec3(u0, v0, z));\n\tsum += uw1 * vw0 * texture(shadowMap, vec3(u1, v0, z));\n\tsum += uw0 * vw1 * texture(shadowMap, vec3(u0, v1, z));\n\tsum += uw1 * vw1 * texture(shadowMap, vec3(u1, v1, z));\n\tsum *= 1.0f / 16.0;\n\treturn sum;\n}\nfloat getShadowPCF3x3(sampler2DShadow shadowMap, vec3 shadowParams) {\n\treturn _getShadowPCF3x3(shadowMap, shadowParams);\n}\nfloat getShadowSpotPCF3x3(sampler2DShadow shadowMap, vec4 shadowParams) {\n\treturn _getShadowPCF3x3(shadowMap, shadowParams.xyz);\n}\n#else\nfloat _xgetShadowPCF3x3(mat3 depthKernel, sampler2D shadowMap, vec3 shadowParams) {\n\tmat3 shadowKernel;\n\tvec3 shadowCoord = dShadowCoord;\n\tvec3 shadowZ = vec3(shadowCoord.z);\n\tshadowKernel[0] = vec3(greaterThan(depthKernel[0], shadowZ));\n\tshadowKernel[1] = vec3(greaterThan(depthKernel[1], shadowZ));\n\tshadowKernel[2] = vec3(greaterThan(depthKernel[2], shadowZ));\n\tvec2 fractionalCoord = fract( shadowCoord.xy * shadowParams.x );\n\tshadowKernel[0] = mix(shadowKernel[0], shadowKernel[1], fractionalCoord.x);\n\tshadowKernel[1] = mix(shadowKernel[1], shadowKernel[2], fractionalCoord.x);\n\tvec4 shadowValues;\n\tshadowValues.x = mix(shadowKernel[0][0], shadowKernel[0][1], fractionalCoord.y);\n\tshadowValues.y = mix(shadowKernel[0][1], shadowKernel[0][2], fractionalCoord.y);\n\tshadowValues.z = mix(shadowKernel[1][0], shadowKernel[1][1], fractionalCoord.y);\n\tshadowValues.w = mix(shadowKernel[1][1], shadowKernel[1][2], fractionalCoord.y);\n\treturn dot( shadowValues, vec4( 1.0 ) ) * 0.25;\n}\nfloat _getShadowPCF3x3(sampler2D shadowMap, vec3 shadowParams) {\n\tvec3 shadowCoord = dShadowCoord;\n\tfloat xoffset = 1.0 / shadowParams.x;\n\tfloat dx0 = -xoffset;\n\tfloat dx1 = xoffset;\n\tmat3 depthKernel;\n\tdepthKernel[0][0] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx0, dx0)));\n\tdepthKernel[0][1] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx0, 0.0)));\n\tdepthKernel[0][2] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx0, dx1)));\n\tdepthKernel[1][0] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(0.0, dx0)));\n\tdepthKernel[1][1] = unpackFloat(texture2D(shadowMap, shadowCoord.xy));\n\tdepthKernel[1][2] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(0.0, dx1)));\n\tdepthKernel[2][0] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx1, dx0)));\n\tdepthKernel[2][1] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx1, 0.0)));\n\tdepthKernel[2][2] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx1, dx1)));\n\treturn _xgetShadowPCF3x3(depthKernel, shadowMap, shadowParams);\n}\nfloat getShadowPCF3x3(sampler2D shadowMap, vec3 shadowParams) {\n\treturn _getShadowPCF3x3(shadowMap, shadowParams);\n}\nfloat getShadowSpotPCF3x3(sampler2D shadowMap, vec4 shadowParams) {\n\treturn _getShadowPCF3x3(shadowMap, shadowParams.xyz);\n}\n#endif\nfloat _getShadowPoint(samplerCube shadowMap, vec4 shadowParams, vec3 dir) {\n\tvec3 tc = normalize(dir);\n\tvec3 tcAbs = abs(tc);\n\tvec4 dirX = vec4(1,0,0, tc.x);\n\tvec4 dirY = vec4(0,1,0, tc.y);\n\tfloat majorAxisLength = tc.z;\n\tif ((tcAbs.x > tcAbs.y) && (tcAbs.x > tcAbs.z)) {\n\t\tdirX = vec4(0,0,1, tc.z);\n\t\tdirY = vec4(0,1,0, tc.y);\n\t\tmajorAxisLength = tc.x;\n\t} else if ((tcAbs.y > tcAbs.x) && (tcAbs.y > tcAbs.z)) {\n\t\tdirX = vec4(1,0,0, tc.x);\n\t\tdirY = vec4(0,0,1, tc.z);\n\t\tmajorAxisLength = tc.y;\n\t}\n\tfloat shadowParamsInFaceSpace = ((1.0/shadowParams.x) * 2.0) * abs(majorAxisLength);\n\tvec3 xoffset = (dirX.xyz * shadowParamsInFaceSpace);\n\tvec3 yoffset = (dirY.xyz * shadowParamsInFaceSpace);\n\tvec3 dx0 = -xoffset;\n\tvec3 dy0 = -yoffset;\n\tvec3 dx1 = xoffset;\n\tvec3 dy1 = yoffset;\n\tmat3 shadowKernel;\n\tmat3 depthKernel;\n\tdepthKernel[0][0] = unpackFloat(textureCube(shadowMap, tc + dx0 + dy0));\n\tdepthKernel[0][1] = unpackFloat(textureCube(shadowMap, tc + dx0));\n\tdepthKernel[0][2] = unpackFloat(textureCube(shadowMap, tc + dx0 + dy1));\n\tdepthKernel[1][0] = unpackFloat(textureCube(shadowMap, tc + dy0));\n\tdepthKernel[1][1] = unpackFloat(textureCube(shadowMap, tc));\n\tdepthKernel[1][2] = unpackFloat(textureCube(shadowMap, tc + dy1));\n\tdepthKernel[2][0] = unpackFloat(textureCube(shadowMap, tc + dx1 + dy0));\n\tdepthKernel[2][1] = unpackFloat(textureCube(shadowMap, tc + dx1));\n\tdepthKernel[2][2] = unpackFloat(textureCube(shadowMap, tc + dx1 + dy1));\n\tvec3 shadowZ = vec3(length(dir) * shadowParams.w + shadowParams.z);\n\tshadowKernel[0] = vec3(lessThan2(depthKernel[0], shadowZ));\n\tshadowKernel[1] = vec3(lessThan2(depthKernel[1], shadowZ));\n\tshadowKernel[2] = vec3(lessThan2(depthKernel[2], shadowZ));\n\tvec2 uv = (vec2(dirX.w, dirY.w) / abs(majorAxisLength)) * 0.5;\n\tvec2 fractionalCoord = fract( uv * shadowParams.x );\n\tshadowKernel[0] = mix(shadowKernel[0], shadowKernel[1], fractionalCoord.x);\n\tshadowKernel[1] = mix(shadowKernel[1], shadowKernel[2], fractionalCoord.x);\n\tvec4 shadowValues;\n\tshadowValues.x = mix(shadowKernel[0][0], shadowKernel[0][1], fractionalCoord.y);\n\tshadowValues.y = mix(shadowKernel[0][1], shadowKernel[0][2], fractionalCoord.y);\n\tshadowValues.z = mix(shadowKernel[1][0], shadowKernel[1][1], fractionalCoord.y);\n\tshadowValues.w = mix(shadowKernel[1][1], shadowKernel[1][2], fractionalCoord.y);\n\treturn 1.0 - dot( shadowValues, vec4( 1.0 ) ) * 0.25;\n}\nfloat getShadowPointPCF3x3(samplerCube shadowMap, vec4 shadowParams) {\n\treturn _getShadowPoint(shadowMap, shadowParams, dLightDirW);\n}\n",shadowStandardGL2PS:"float _getShadowPCF5x5(sampler2DShadow shadowMap, vec3 shadowParams) {\n\tfloat z = dShadowCoord.z;\n\tvec2 uv = dShadowCoord.xy * shadowParams.x;\n\tfloat shadowMapSizeInv = 1.0 / shadowParams.x;\n\tvec2 base_uv = floor(uv + 0.5);\n\tfloat s = (uv.x + 0.5 - base_uv.x);\n\tfloat t = (uv.y + 0.5 - base_uv.y);\n\tbase_uv -= vec2(0.5);\n\tbase_uv *= shadowMapSizeInv;\n\tfloat uw0 = (4.0 - 3.0 * s);\n\tfloat uw1 = 7.0;\n\tfloat uw2 = (1.0 + 3.0 * s);\n\tfloat u0 = (3.0 - 2.0 * s) / uw0 - 2.0;\n\tfloat u1 = (3.0 + s) / uw1;\n\tfloat u2 = s / uw2 + 2.0;\n\tfloat vw0 = (4.0 - 3.0 * t);\n\tfloat vw1 = 7.0;\n\tfloat vw2 = (1.0 + 3.0 * t);\n\tfloat v0 = (3.0 - 2.0 * t) / vw0 - 2.0;\n\tfloat v1 = (3.0 + t) / vw1;\n\tfloat v2 = t / vw2 + 2.0;\n\tfloat sum = 0.0;\n\tu0 = u0 * shadowMapSizeInv + base_uv.x;\n\tv0 = v0 * shadowMapSizeInv + base_uv.y;\n\tu1 = u1 * shadowMapSizeInv + base_uv.x;\n\tv1 = v1 * shadowMapSizeInv + base_uv.y;\n\tu2 = u2 * shadowMapSizeInv + base_uv.x;\n\tv2 = v2 * shadowMapSizeInv + base_uv.y;\n\tsum += uw0 * vw0 * texture(shadowMap, vec3(u0, v0, z));\n\tsum += uw1 * vw0 * texture(shadowMap, vec3(u1, v0, z));\n\tsum += uw2 * vw0 * texture(shadowMap, vec3(u2, v0, z));\n\tsum += uw0 * vw1 * texture(shadowMap, vec3(u0, v1, z));\n\tsum += uw1 * vw1 * texture(shadowMap, vec3(u1, v1, z));\n\tsum += uw2 * vw1 * texture(shadowMap, vec3(u2, v1, z));\n\tsum += uw0 * vw2 * texture(shadowMap, vec3(u0, v2, z));\n\tsum += uw1 * vw2 * texture(shadowMap, vec3(u1, v2, z));\n\tsum += uw2 * vw2 * texture(shadowMap, vec3(u2, v2, z));\n\tsum *= 1.0f / 144.0;\n\tsum = gammaCorrectInput(sum);\n\tsum = saturate(sum);\n\treturn sum;\n}\nfloat getShadowPCF5x5(sampler2DShadow shadowMap, vec3 shadowParams) {\n\treturn _getShadowPCF5x5(shadowMap, shadowParams);\n}\nfloat getShadowSpotPCF5x5(sampler2DShadow shadowMap, vec4 shadowParams) {\n\treturn _getShadowPCF5x5(shadowMap, shadowParams.xyz);\n}\n",shadowStandardGL2VSPS:"float getShadowPCF5x5VS(sampler2DShadow shadowMap, vec3 shadowParams) {\n\tdShadowCoord = vMainShadowUv.xyz;\n\tdShadowCoord.z = saturate(dShadowCoord.z) - 0.0001;\n\treturn _getShadowPCF5x5(shadowMap, shadowParams);\n}\n",shadowStandardVSPS:"#ifdef GL2\n#define SHADOW_SAMPLERVS sampler2DShadow\n#else\n#define SHADOW_SAMPLERVS sampler2D\n#endif\nfloat getShadowPCF3x3VS(SHADOW_SAMPLERVS shadowMap, vec3 shadowParams) {\n\tdShadowCoord = vMainShadowUv.xyz;\n\tdShadowCoord.z = saturate(dShadowCoord.z) - 0.0001;\n\t#ifdef SHADOWBIAS\n\tdShadowCoord.z += getShadowBias(shadowParams.x, shadowParams.z);\n\t#endif\n\treturn _getShadowPCF3x3(shadowMap, shadowParams);\n}\n",shadowVSM8PS:"float calculateVSM8(vec3 moments, float Z, float vsmBias) {\n\tfloat VSMBias = vsmBias;\n\tfloat depthScale = VSMBias * Z;\n\tfloat minVariance1 = depthScale * depthScale;\n\treturn chebyshevUpperBound(moments.xy, Z, minVariance1, 0.1);\n}\nfloat decodeFloatRG(vec2 rg) {\n\treturn rg.y*(1.0/255.0) + rg.x;\n}\nfloat VSM8(sampler2D tex, vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n\tvec4 c = texture2D(tex, texCoords);\n\tvec3 moments = vec3(decodeFloatRG(c.xy), decodeFloatRG(c.zw), 0.0);\n\treturn calculateVSM8(moments, Z, vsmBias);\n}\nfloat getShadowVSM8(sampler2D shadowMap, vec3 shadowParams, float exponent) {\n\treturn VSM8(shadowMap, dShadowCoord.xy, shadowParams.x, dShadowCoord.z, shadowParams.y, 0.0);\n}\nfloat getShadowSpotVSM8(sampler2D shadowMap, vec4 shadowParams, float exponent) {\n\treturn VSM8(shadowMap, dShadowCoord.xy, shadowParams.x, length(dLightDirW) * shadowParams.w + shadowParams.z, shadowParams.y, 0.0);\n}\n",shadowVSMVSPS:"float getShadowVSM$VS(sampler2D shadowMap, vec3 shadowParams, float exponent) {\n\tdShadowCoord = vMainShadowUv.xyz;\n\tdShadowCoord.z += shadowParams.z;\n\tdShadowCoord.xyz /= vMainShadowUv.w;\n\tdShadowCoord.z = min(dShadowCoord.z, 1.0);\n\treturn $VSM(shadowMap, dShadowCoord.xy, shadowParams.x, dShadowCoord.z, shadowParams.y, exponent);\n}\n",shadowVSM_commonPS:"float linstep(float a, float b, float v) {\n\treturn saturate((v - a) / (b - a));\n}\nfloat reduceLightBleeding(float pMax, float amount) {\n   return linstep(amount, 1.0, pMax);\n}\nfloat chebyshevUpperBound(vec2 moments, float mean, float minVariance, float lightBleedingReduction) {\n\tfloat variance = moments.y - (moments.x * moments.x);\n\tvariance = max(variance, minVariance);\n\tfloat d = mean - moments.x;\n\tfloat pMax = variance / (variance + (d * d));\n\tpMax = reduceLightBleeding(pMax, lightBleedingReduction);\n\treturn (mean <= moments.x ? 1.0 : pMax);\n}\nfloat calculateEVSM(vec3 moments, float Z, float vsmBias, float exponent) {\n\tZ = 2.0 * Z - 1.0;\n\tfloat warpedDepth = exp(exponent * Z);\n\tmoments.xy += vec2(warpedDepth, warpedDepth*warpedDepth) * (1.0 - moments.z);\n\tfloat VSMBias = vsmBias;\n\tfloat depthScale = VSMBias * exponent * warpedDepth;\n\tfloat minVariance1 = depthScale * depthScale;\n\treturn chebyshevUpperBound(moments.xy, warpedDepth, minVariance1, 0.1);\n}\n",skinBatchConstVS:"attribute float vertex_boneIndices;\nuniform vec4 matrix_pose[BONE_LIMIT * 3];\nmat4 getBoneMatrix(const in float i) {\n\tvec4 v1 = matrix_pose[int(3.0 * i)];\n\tvec4 v2 = matrix_pose[int(3.0 * i + 1.0)];\n\tvec4 v3 = matrix_pose[int(3.0 * i + 2.0)];\n\treturn mat4(\n\t\tv1.x, v2.x, v3.x, 0,\n\t\tv1.y, v2.y, v3.y, 0,\n\t\tv1.z, v2.z, v3.z, 0,\n\t\tv1.w, v2.w, v3.w, 1\n\t);\n}\n",skinBatchTexVS:"attribute float vertex_boneIndices;\nuniform highp sampler2D texture_poseMap;\nuniform vec4 texture_poseMapSize;\nmat4 getBoneMatrix(const in float i) {\n\tfloat j = i * 3.0;\n\tfloat dx = texture_poseMapSize.z;\n\tfloat dy = texture_poseMapSize.w;\n\tfloat y = floor(j * dx);\n\tfloat x = j - (y * texture_poseMapSize.x);\n\ty = dy * (y + 0.5);\n\tvec4 v1 = texture2D(texture_poseMap, vec2(dx * (x + 0.5), y));\n\tvec4 v2 = texture2D(texture_poseMap, vec2(dx * (x + 1.5), y));\n\tvec4 v3 = texture2D(texture_poseMap, vec2(dx * (x + 2.5), y));\n\treturn mat4(\n\t\tv1.x, v2.x, v3.x, 0,\n\t\tv1.y, v2.y, v3.y, 0,\n\t\tv1.z, v2.z, v3.z, 0,\n\t\tv1.w, v2.w, v3.w, 1\n\t);\n}\n",skinConstVS:"attribute vec4 vertex_boneWeights;\nattribute vec4 vertex_boneIndices;\nuniform vec4 matrix_pose[BONE_LIMIT * 3];\nvoid getBoneMatrix(const in float i, out vec4 v1, out vec4 v2, out vec4 v3) {\n\tv1 = matrix_pose[int(3.0 * i)];\n\tv2 = matrix_pose[int(3.0 * i + 1.0)];\n\tv3 = matrix_pose[int(3.0 * i + 2.0)];\n}\nmat4 getSkinMatrix(const in vec4 indices, const in vec4 weights) {\n\tvec4 a1, a2, a3;\n\tgetBoneMatrix(indices.x, a1, a2, a3);\n\tvec4 b1, b2, b3;\n\tgetBoneMatrix(indices.y, b1, b2, b3);\n\tvec4 c1, c2, c3;\n\tgetBoneMatrix(indices.z, c1, c2, c3);\n\tvec4 d1, d2, d3;\n\tgetBoneMatrix(indices.w, d1, d2, d3);\n\tvec4 v1 = a1 * weights.x + b1 * weights.y + c1 * weights.z + d1 * weights.w;\n\tvec4 v2 = a2 * weights.x + b2 * weights.y + c2 * weights.z + d2 * weights.w;\n\tvec4 v3 = a3 * weights.x + b3 * weights.y + c3 * weights.z + d3 * weights.w;\n\tfloat one = dot(weights, vec4(1.0));\n\treturn mat4(\n\t\tv1.x, v2.x, v3.x, 0,\n\t\tv1.y, v2.y, v3.y, 0,\n\t\tv1.z, v2.z, v3.z, 0,\n\t\tv1.w, v2.w, v3.w, one\n\t);\n}\n",skinTexVS:"attribute vec4 vertex_boneWeights;\nattribute vec4 vertex_boneIndices;\nuniform highp sampler2D texture_poseMap;\nuniform vec4 texture_poseMapSize;\nvoid getBoneMatrix(const in float i, out vec4 v1, out vec4 v2, out vec4 v3) {\n\tfloat j = i * 3.0;\n\tfloat dx = texture_poseMapSize.z;\n\tfloat dy = texture_poseMapSize.w;\n\tfloat y = floor(j * dx);\n\tfloat x = j - (y * texture_poseMapSize.x);\n\ty = dy * (y + 0.5);\n\tv1 = texture2D(texture_poseMap, vec2(dx * (x + 0.5), y));\n\tv2 = texture2D(texture_poseMap, vec2(dx * (x + 1.5), y));\n\tv3 = texture2D(texture_poseMap, vec2(dx * (x + 2.5), y));\n}\nmat4 getSkinMatrix(const in vec4 indices, const in vec4 weights) {\n\tvec4 a1, a2, a3;\n\tgetBoneMatrix(indices.x, a1, a2, a3);\n\tvec4 b1, b2, b3;\n\tgetBoneMatrix(indices.y, b1, b2, b3);\n\tvec4 c1, c2, c3;\n\tgetBoneMatrix(indices.z, c1, c2, c3);\n\tvec4 d1, d2, d3;\n\tgetBoneMatrix(indices.w, d1, d2, d3);\n\tvec4 v1 = a1 * weights.x + b1 * weights.y + c1 * weights.z + d1 * weights.w;\n\tvec4 v2 = a2 * weights.x + b2 * weights.y + c2 * weights.z + d2 * weights.w;\n\tvec4 v3 = a3 * weights.x + b3 * weights.y + c3 * weights.z + d3 * weights.w;\n\tfloat one = dot(weights, vec4(1.0));\n\treturn mat4(\n\t\tv1.x, v2.x, v3.x, 0,\n\t\tv1.y, v2.y, v3.y, 0,\n\t\tv1.z, v2.z, v3.z, 0,\n\t\tv1.w, v2.w, v3.w, one\n\t);\n}\n",skyboxPS:"varying vec3 vViewDir;\nuniform samplerCube texture_cubeMap;\nvoid main(void) {\n\tgl_FragColor = textureCube(texture_cubeMap, fixSeams(vViewDir));\n}\n",skyboxVS:"attribute vec3 aPosition;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform mat4 matrix_projectionSkybox;\nvarying vec3 vViewDir;\nvoid main(void) {\n\tmat4 view = matrix_view;\n\tview[3][0] = view[3][1] = view[3][2] = 0.0;\n\tgl_Position = matrix_projectionSkybox * view * vec4(aPosition, 1.0);\n\tgl_Position.z = gl_Position.w - 0.00001;\n\tvViewDir = aPosition;\n}\n",skyboxHDRPS:"varying vec3 vViewDir;\nuniform samplerCube texture_cubeMap;\n#ifdef CUBEMAP_ROTATION\nuniform mat3 cubeMapRotationMatrix;\n#endif\nvoid main(void) {\n#ifdef CUBEMAP_ROTATION\n\tvec3 dir=vViewDir * cubeMapRotationMatrix;\n#else\n\tvec3 dir=vViewDir;\n#endif\n#ifndef RIGHT_HANDED_CUBEMAP\n\tdir.x *= -1.0;\n#endif\n\tvec3 color = processEnvironment($textureCubeSAMPLE(texture_cubeMap, fixSeamsStatic(dir, $FIXCONST)).rgb);\n\tcolor = toneMap(color);\n\tcolor = gammaCorrectOutput(color);\n\tgl_FragColor = vec4(color, 1.0);\n}\n",skyboxPrefilteredCubePS:"varying vec3 vViewDir;\nuniform samplerCube texture_cubeMap;\nvec3 fixSeamsStretch(vec3 vec, float mipmapIndex, float cubemapSize) {\n\tfloat scale = 1.0 - exp2(mipmapIndex) / cubemapSize;\n\tfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n\tif (abs(vec.x) != M) vec.x *= scale;\n\tif (abs(vec.y) != M) vec.y *= scale;\n\tif (abs(vec.z) != M) vec.z *= scale;\n\treturn vec;\n}\nvoid main(void) {\n\tvec3 color = textureCubeRGBM(texture_cubeMap, fixSeamsStretch(vViewDir, 0.0, 128.0));\n\tcolor = toneMap(color);\n\tcolor = gammaCorrectOutput(color);\n\tgl_FragColor = vec4(color, 1.0);\n}\n",specularPS:"#ifdef MAPCOLOR\nuniform vec3 material_specular;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_specularMap;\n#endif\nvoid getSpecularity() {\n\tdSpecularity = vec3(1.0);\n\t#ifdef MAPCOLOR\n\tdSpecularity *= material_specular;\n\t#endif\n\t#ifdef MAPTEXTURE\n\tdSpecularity *= texture2D(texture_specularMap, $UV).$CH;\n\t#endif\n\t#ifdef MAPVERTEX\n\tdSpecularity *= saturate(vVertexColor.$VC);\n\t#endif\n}\n",specularAaNonePS:"float antiAliasGlossiness(float power) {\n\treturn power;\n}\n",specularAaToksvigPS:"float antiAliasGlossiness(float power) {\n\tfloat rlen = 1.0 / saturate(length(dNormalMap));\n\tfloat toksvig = 1.0 / (1.0 + power * (rlen - 1.0));\n\treturn power * mix(1.0, toksvig, material_bumpiness);\n}\n",specularAaToksvigFastPS:"float antiAliasGlossiness(float power) {\n\tfloat rlen = 1.0 / saturate(length(dNormalMap));\n\tfloat toksvig = 1.0 / (1.0 + power * (rlen - 1.0));\n\treturn power * toksvig;\n}\n",spotPS:"float getSpotEffect(vec3 lightSpotDirW, float lightInnerConeAngle, float lightOuterConeAngle) {\n\tfloat cosAngle = dot(dLightDirNormW, lightSpotDirW);\n\treturn smoothstep(lightOuterConeAngle, lightInnerConeAngle, cosAngle);\n}\n",startPS:"void main(void) {\n\tdDiffuseLight = vec3(0);\n\tdSpecularLight = vec3(0);\n\tdReflection = vec4(0);\n\tdSpecularity = vec3(0);\n\t#ifdef CLEARCOAT\n\tccSpecularLight = vec3(0);\n\tccReflection = vec4(0);\n\t#endif\n",startVS:"void main(void) {\n\tgl_Position = getPosition();\n",startNineSlicedPS:"\tnineSlicedUv = vUv0;\n",startNineSlicedTiledPS:"\tvec2 tileMask = step(vMask, vec2(0.99999));\n\tvec2 clampedUv = mix(innerOffset.xy*0.5, vec2(1.0) - innerOffset.zw*0.5, fract(vTiledUv));\n\tclampedUv = clampedUv * atlasRect.zw + atlasRect.xy;\n\tnineSlicedUv = vUv0 * tileMask + clampedUv * (vec2(1.0) - tileMask);\n",storeEVSMPS:"float exponent = VSM_EXPONENT;\ndepth = 2.0 * depth - 1.0;\ndepth =  exp(exponent * depth);\ngl_FragColor = vec4(depth, depth*depth, 1.0, 1.0);\n",tangentBinormalVS:"vec3 getTangent() {\n\treturn normalize(dNormalMatrix * vertex_tangent.xyz);\n}\nvec3 getBinormal() {\n\treturn cross(vNormalW, vTangentW) * vertex_tangent.w;\n}\nvec3 getObjectSpaceUp() {\n\treturn normalize(dNormalMatrix * vec3(0, 1, 0));\n}\n",TBNPS:"void getTBN() {\n\tdTBN = mat3(normalize(dTangentW), normalize(dBinormalW), normalize(dVertexNormalW));\n}\n",TBNderivativePS:"\nvoid getTBN() {\n\tvec2 uv = $UV;\n\tvec3 dp1 = dFdx( vPositionW );\n\tvec3 dp2 = dFdy( vPositionW );\n\tvec2 duv1 = dFdx( uv );\n\tvec2 duv2 = dFdy( uv );\n\tvec3 dp2perp = cross( dp2, dVertexNormalW );\n\tvec3 dp1perp = cross( dVertexNormalW, dp1 );\n\tvec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n\tvec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n\tfloat invmax = 1.0 / sqrt( max( dot(T,T), dot(B,B) ) );\n\tdTBN = mat3( T * invmax, B * invmax, dVertexNormalW );\n}\n",TBNfastPS:"void getTBN() {\n\tdTBN = mat3(dTangentW, dBinormalW, dVertexNormalW);\n}\n",TBNObjectSpacePS:"void getTBN() {\n\tvec3 B = cross(dVertexNormalW, vObjectSpaceUpW);\n\tvec3 T = cross(dVertexNormalW, B);\n\tif (dot(B,B)==0.0)\n\t{\n\t\tfloat major=max(max(dVertexNormalW.x, dVertexNormalW.y),dVertexNormalW.z);\n\t\tif (dVertexNormalW.x==major)\n\t\t{\n\t\t\tB=cross(dVertexNormalW, vec3(0,1,0));\n\t\t\tT=cross(dVertexNormalW, B);\n\t\t}\n\t\telse if (dVertexNormalW.y==major)\n\t\t{\n\t\t\tB=cross(dVertexNormalW, vec3(0,0,1));\n\t\t\tT=cross(dVertexNormalW, B);\n\t\t}\n\t\telse if (dVertexNormalW.z==major)\n\t\t{\n\t\t\tB=cross(dVertexNormalW, vec3(1,0,0));\n\t\t\tT=cross(dVertexNormalW, B);\n\t\t}\n\t}\n\tdTBN = mat3(normalize(T), normalize(B), normalize(dVertexNormalW));\n}\n",tonemappingAcesPS:"uniform float exposure;\nvec3 toneMap(vec3 color) {\n\tfloat tA = 2.51;\n\tfloat tB = 0.03;\n\tfloat tC = 2.43;\n\tfloat tD = 0.59;\n\tfloat tE = 0.14;\n\tvec3 x = color * exposure;\n\treturn (x*(tA*x+tB))/(x*(tC*x+tD)+tE);\n}\n",tonemappingAces2PS:"uniform float exposure;\nconst mat3 ACESInputMat = mat3(\n\t0.59719, 0.35458, 0.04823,\n\t0.07600, 0.90834, 0.01566,\n\t0.02840, 0.13383, 0.83777\n);\nconst mat3 ACESOutputMat = mat3(\n\t 1.60475, -0.53108, -0.07367,\n\t-0.10208,  1.10813, -0.00605,\n\t-0.00327, -0.07276,  1.07602\n);\nvec3 RRTAndODTFit(vec3 v) {\n\tvec3 a = v * (v + 0.0245786) - 0.000090537;\n\tvec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;\n\treturn a / b;\n}\nvec3 toneMap(vec3 color) {\n\tcolor *= exposure;\n\tcolor = color * ACESInputMat;\n\tcolor = RRTAndODTFit(color);\n\tcolor = color * ACESOutputMat;\n\tcolor = clamp(color, 0.0, 1.0);\n\treturn color;\n}\n",tonemappingFilmicPS:"const float A =  0.15;\nconst float B =  0.50;\nconst float C =  0.10;\nconst float D =  0.20;\nconst float E =  0.02;\nconst float F =  0.30;\nconst float W =  11.2;\nuniform float exposure;\nvec3 uncharted2Tonemap(vec3 x) {\n   return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\nvec3 toneMap(vec3 color) {\n\tcolor = uncharted2Tonemap(color * exposure);\n\tvec3 whiteScale = 1.0 / uncharted2Tonemap(vec3(W,W,W));\n\tcolor = color * whiteScale;\n\treturn color;\n}\n",tonemappingHejlPS:"uniform float exposure;\nvec3 toneMap(vec3 color) {\n\tcolor *= exposure;\n\tconst float  A = 0.22, B = 0.3, C = .1, D = 0.2, E = .01, F = 0.3;\n\tconst float Scl = 1.25;\n\tvec3 h = max( vec3(0.0), color - vec3(0.004) );\n\treturn (h*((Scl*A)*h+Scl*vec3(C*B,C*B,C*B))+Scl*vec3(D*E,D*E,D*E)) / (h*(A*h+vec3(B,B,B))+vec3(D*F,D*F,D*F)) - Scl*vec3(E/F,E/F,E/F);\n}\n",tonemappingLinearPS:"uniform float exposure;\nvec3 toneMap(vec3 color) {\n\treturn color * exposure;\n}\n",tonemappingNonePS:"vec3 toneMap(vec3 color) {\n\treturn color;\n}\n",transformVS:"#ifdef PIXELSNAP\nuniform vec4 uScreenSize;\n#endif\n#ifdef MORPHING\nuniform vec4 morph_weights_a;\nuniform vec4 morph_weights_b;\n#endif\n#ifdef MORPHING_TEXTURE_BASED\nuniform vec4 morph_tex_params;\nvec2 getTextureMorphCoords() {\n\tfloat vertexId = morph_vertex_id;\n\tvec2 textureSize = morph_tex_params.xy;\n\tvec2 invTextureSize = morph_tex_params.zw;\n\tfloat morphGridV = floor(vertexId * invTextureSize.x);\n\tfloat morphGridU = vertexId - (morphGridV * textureSize.x);\n\treturn (vec2(morphGridU, morphGridV) * invTextureSize) + (0.5 * invTextureSize);\n}\n#endif\n#ifdef MORPHING_TEXTURE_BASED_POSITION\nuniform highp sampler2D morphPositionTex;\n#endif\nmat4 getModelMatrix() {\n\t#ifdef DYNAMICBATCH\n\treturn getBoneMatrix(vertex_boneIndices);\n\t#elif defined(SKIN)\n\treturn matrix_model * getSkinMatrix(vertex_boneIndices, vertex_boneWeights);\n\t#elif defined(INSTANCING)\n\treturn mat4(instance_line1, instance_line2, instance_line3, instance_line4);\n\t#else\n\treturn matrix_model;\n\t#endif\n}\nvec4 getPosition() {\n\tdModelMatrix = getModelMatrix();\n\tvec3 localPos = vertex_position;\n\t#ifdef NINESLICED\n\tlocalPos.xz *= outerScale;\n\tvec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n\tvec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n\tlocalPos.xz += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n\tvTiledUv = (localPos.xz - outerScale + innerOffset.xy) * -0.5 + 1.0;\n\tlocalPos.xz *= -0.5;\n\tlocalPos = localPos.xzy;\n\t#endif\n\t#ifdef MORPHING\n\t#ifdef MORPHING_POS03\n\tlocalPos.xyz += morph_weights_a[0] * morph_pos0;\n\tlocalPos.xyz += morph_weights_a[1] * morph_pos1;\n\tlocalPos.xyz += morph_weights_a[2] * morph_pos2;\n\tlocalPos.xyz += morph_weights_a[3] * morph_pos3;\n\t#endif\n\t#ifdef MORPHING_POS47\n\tlocalPos.xyz += morph_weights_b[0] * morph_pos4;\n\tlocalPos.xyz += morph_weights_b[1] * morph_pos5;\n\tlocalPos.xyz += morph_weights_b[2] * morph_pos6;\n\tlocalPos.xyz += morph_weights_b[3] * morph_pos7;\n\t#endif\n\t#endif\n\t#ifdef MORPHING_TEXTURE_BASED_POSITION\n\tvec2 morphUV = getTextureMorphCoords();\n\tvec3 morphPos = texture2D(morphPositionTex, morphUV).xyz;\n\tlocalPos += morphPos;\n\t#endif\n\tvec4 posW = dModelMatrix * vec4(localPos, 1.0);\n\t#ifdef SCREENSPACE\n\tposW.zw = vec2(0.0, 1.0);\n\t#endif\n\tdPositionW = posW.xyz;\n\tvec4 screenPos;\n\t#ifdef UV1LAYOUT\n\tscreenPos = vec4(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1);\n\t#else\n\t#ifdef SCREENSPACE\n\tscreenPos = posW;\n\t#else\n\tscreenPos = matrix_viewProjection * posW;\n\t#endif\n\t#ifdef PIXELSNAP\n\tscreenPos.xy = (screenPos.xy * 0.5) + 0.5;\n\tscreenPos.xy *= uScreenSize.xy;\n\tscreenPos.xy = floor(screenPos.xy);\n\tscreenPos.xy *= uScreenSize.zw;\n\tscreenPos.xy = (screenPos.xy * 2.0) - 1.0;\n\t#endif\n\t#endif\n\treturn screenPos;\n}\nvec3 getWorldPosition() {\n\treturn dPositionW;\n}\n",transformDeclVS:"attribute vec3 vertex_position;\nuniform mat4 matrix_model;\nuniform mat4 matrix_viewProjection;\nvec3 dPositionW;\nmat4 dModelMatrix;\n",uv0VS:"#ifdef NINESLICED\nvec2 getUv0() {\n\tvec2 uv = vertex_position.xz;\n\tvec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n\tvec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n\tuv += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n\tuv = uv * -0.5 + 0.5;\n\tuv = uv * atlasRect.zw + atlasRect.xy;\n\tvMask = vertex_texCoord0.xy;\n\treturn uv;\n}\n#else\nvec2 getUv0() {\n\treturn vertex_texCoord0;\n}\n#endif\n",uv1VS:"vec2 getUv1() {\n\treturn vertex_texCoord1;\n}\n",viewDirPS:"void getViewDir() {\n\tdViewDirW = normalize(view_position - vPositionW);\n}\n",viewNormalVS:"#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nvec3 getViewNormal() {\n\treturn mat3(matrix_view) * vNormalW;\n}\n"};function jt(t,e){return e||(e=Ft),1===t||2===t?e.gamma2_2PS?e.gamma2_2PS:Ft.gamma2_2PS:3===t?"#define HDR\n"+(e.gamma2_2PS?e.gamma2_2PS:Ft.gamma2_2PS):e.gamma1_0PS?e.gamma1_0PS:Ft.gamma1_0PS}function Vt(t,e){return e||(e=Ft),1===t?e.tonemappingFilmicPS?e.tonemappingFilmicPS:Ft.tonemappingFilmicPS:0===t?e.tonemappingLinearPS?e.tonemappingLinearPS:Ft.tonemappingLinearPS:2===t?e.tonemappingHejlPS?e.tonemappingHejlPS:Ft.tonemappingHejlPS:3===t?e.tonemappingAcesPS?e.tonemappingAcesPS:Ft.tonemappingAcesPS:4===t?e.tonemappingAces2PS?e.tonemappingAces2PS:Ft.tonemappingAces2PS:e.tonemapingNonePS?e.tonemapingNonePS:Ft.tonemappingNonePS}function Ut(t,e){return e||(e=Ft),"linear"===t?e.fogLinearPS?e.fogLinearPS:Ft.fogLinearPS:"exp"===t?e.fogExpPS?e.fogExpPS:Ft.fogExpPS:"exp2"===t?e.fogExp2PS?e.fogExp2PS:Ft.fogExp2PS:e.fogNonePS?e.fogNonePS:Ft.fogNonePS}function Gt(t,e){return e||(e=Ft),t.supportsBoneTextures?e.skinTexVS:"#define BONE_LIMIT "+t.getBoneLimit()+"\n"+e.skinConstVS}function Wt(t){var e="precision "+t.precision+" float;\n";return t.webgl2&&(e+="#ifdef GL2\nprecision "+t.precision+" sampler2DShadow;\n#endif\n"),e}function Ht(t){return t.webgl2?"#version 300 es\n":""}function Xt(){return"void main(void) {gl_FragColor = vec4(0.0);}"}function Zt(){return"void main(void)\n{\n"}function Yt(){return"}\n"}var qt={vertex_position:"POSITION",vertex_normal:"NORMAL",vertex_tangent:"TANGENT",vertex_texCoord0:"TEXCOORD0",vertex_texCoord1:"TEXCOORD1",vertex_texCoord2:"TEXCOORD2",vertex_texCoord3:"TEXCOORD3",vertex_texCoord4:"TEXCOORD4",vertex_texCoord5:"TEXCOORD5",vertex_texCoord6:"TEXCOORD6",vertex_texCoord7:"TEXCOORD7",vertex_color:"COLOR",vertex_boneIndices:"BLENDINDICES",vertex_boneWeights:"BLENDWEIGHT"};function Kt(t){for(var e={},i=0,n=t.indexOf("attribute");n>=0&&!(n>0&&"/"===t[n-1]);){var r=t.indexOf(";",n),s=t.lastIndexOf(" ",r),a=t.substr(s+1,r-(s+1)),o=qt[a];void 0!==o?e[a]=o:(e[a]="ATTR"+i,i++),n=t.indexOf("attribute",n+1)}return e}function Jt(t,e,i,n,r,s){var a=t.programLib._cache,o=a[n];if(void 0!==o)return o;i=Wt(t)+"\n"+(i||"void main(void) {gl_FragColor = vec4(0.0);}");var l=Kt(e);return t.webgl2&&(e=Ht(t)+Ft.gles3VS+e,i=Ht(t)+Ft.gles3PS+i),a[n]=new Bt(t,{attributes:l,vshader:e,fshader:(s||"")+i,useTransformFeedback:r}),a[n]}Ft.collectAttribs=Kt,Ft.createShader=function(t,e,i,n){var r=Ft[e],s=Wt(t)+"\n"+Ft[i],a=Kt(r);return t.webgl2&&(r=Ht(t)+Ft.gles3VS+r,s=Ht(t)+Ft.gles3PS+s),new Bt(t,{attributes:a,vshader:r,fshader:s,useTransformFeedback:n})},Ft.createShaderFromCode=Jt;var Qt={generateKey:function(t){var e="basic";return t.fog&&(e+="_fog"),t.alphaTest&&(e+="_atst"),t.vertexColors&&(e+="_vcol"),t.diffuseMap&&(e+="_diff"),e+="_"+t.pass},createShaderDefinition:function(t,e){var i={vertex_position:"POSITION"};e.skin&&(i.vertex_boneWeights="BLENDWEIGHT",i.vertex_boneIndices="BLENDINDICES"),e.vertexColors&&(i.vertex_color="COLOR"),e.diffuseMap&&(i.vertex_texCoord0="TEXCOORD0");var n="";n+=Ft.transformDeclVS,e.skin?(n+=Gt(t),n+=Ft.transformSkinnedVS):n+=Ft.transformVS,e.vertexColors&&(n+="attribute vec4 vertex_color;\n",n+="varying vec4 vColor;\n"),e.diffuseMap&&(n+="attribute vec2 vertex_texCoord0;\n",n+="varying vec2 vUv0;\n"),2===e.pass&&(n+="varying float vDepth;\n",n+="#ifndef VIEWMATRIX\n",n+="#define VIEWMATRIX\n",n+="uniform mat4 matrix_view;\n",n+="#endif\n",n+="#ifndef CAMERAPLANES\n",n+="#define CAMERAPLANES\n",n+="uniform vec4 camera_params;\n\n",n+="#endif\n"),n+="void main(void)\n{\n",n+="\t gl_Position = getPosition();\n",2===e.pass&&(n+="\t\tvDepth = -(matrix_view * vec4(getWorldPosition(),1.0)).z * camera_params.x;\n"),e.vertexColors&&(n+="\t\tvColor = vertex_color;\n"),e.diffuseMap&&(n+="\t\tvUv0 = vertex_texCoord0;\n");var r=n+="}\n";return n=Wt(t),e.vertexColors?n+="varying vec4 vColor;\n":n+="uniform vec4 uColor;\n",e.diffuseMap&&(n+="varying vec2 vUv0;\n",n+="uniform sampler2D texture_diffuseMap;\n"),e.fog&&(n+=Ut(e.fog)),e.alphatest&&(n+=Ft.alphaTestPS),2===e.pass&&(n+="varying float vDepth;\n",n+=Ft.packDepthPS),n+="void main(void)\n{\n",e.vertexColors?n+="\t\tgl_FragColor = vColor;\n":n+="\t\tgl_FragColor = uColor;\n",e.diffuseMap&&(n+="\t\tgl_FragColor *= texture2D(texture_diffuseMap, vUv0);\n"),e.alphatest&&(n+="\t alphaTest(gl_FragColor.a);\n"),18!==e.pass&&(2===e.pass?n+="\t\tgl_FragColor = packFloat(vDepth);\n":e.fog&&(n+="\t glFragColor.rgb = addFog(gl_FragColor.rgb);\n")),{attributes:i,vshader:r,fshader:n+="}\n"}}},$t={generateKey:function(t){var e="particle";for(var i in t)t.hasOwnProperty(i)&&(e+=t[i]);return e},_animTex:function(t){var e="";return e+=t.animTexLoop?Ft.particleAnimFrameLoopVS:Ft.particleAnimFrameClampVS,e+=Ft.particleAnimTexVS},createShaderDefinition:function(t,e){var i="",n=Wt(t)+"\n";n+="#define PARTICLE\n",t.webgl2&&(i+="#define GL2\n",n+="#define GL2\n"),i+="#define VERTEXSHADER\n",e.mesh&&(i+="#define USE_MESH\n"),e.localSpace&&(i+="#define LOCAL_SPACE\n"),e.screenSpace&&(i+="#define SCREEN_SPACE\n"),e.animTex&&(i+="\nuniform vec2 animTexTilesParams;\n"),e.animTex&&(i+="\nuniform vec4 animTexParams;\n"),e.animTex&&(i+="\nuniform vec2 animTexIndexParams;\n"),2==e.normal&&(i+="\nvarying mat3 ParticleMat;\n"),1==e.normal&&(i+="\nvarying vec3 Normal;\n"),e.soft&&(i+="\nvarying float vDepth;\n");var r=e.customFace?Ft.particle_customFaceVS:Ft.particle_billboardVS;return e.useCpu?(e.soft>0&&(i+=Ft.screenDepthPS),i+=Ft.particle_cpuVS,e.localSpace&&(i+=Ft.particle_localShiftVS),e.animTex&&(i+=this._animTex(e)),e.alignToMotion&&(i+=Ft.particle_pointAlongVS),i+=e.mesh?Ft.particle_meshVS:r,1==e.normal&&(i+=Ft.particle_normalVS),2==e.normal&&(i+=Ft.particle_TBNVS),e.stretch>0&&(i+=Ft.particle_stretchVS),i+=Ft.particle_cpu_endVS,e.soft>0&&(i+=Ft.particle_softVS)):(i+=Ft.particle_initVS,i+=e.pack8?Ft.particleInputRgba8PS:Ft.particleInputFloatPS,e.soft>0&&(i+=Ft.screenDepthPS),i+=Ft.particleVS,e.localSpace&&(i+=Ft.particle_localShiftVS),e.animTex&&(i+=this._animTex(e)),e.wrap&&(i+=Ft.particle_wrapVS),e.alignToMotion&&(i+=Ft.particle_pointAlongVS),i+=e.mesh?Ft.particle_meshVS:r,1==e.normal&&(i+=Ft.particle_normalVS),2==e.normal&&(i+=Ft.particle_TBNVS),e.stretch>0&&(i+=Ft.particle_stretchVS),i+=Ft.particle_endVS,e.soft>0&&(i+=Ft.particle_softVS)),i+="}\n",e.normal>0&&(1==e.normal?n+="\nvarying vec3 Normal;\n":2==e.normal&&(n+="\nvarying mat3 ParticleMat;\n"),n+="\nuniform vec3 lightCube[6];\n"),e.soft&&(n+="\nvarying float vDepth;\n"),0===e.normal&&"none"===e.fog&&(e.srgb=!1),n+=jt(e.gamma),n+=Vt(e.toneMap),"linear"===e.fog?n+=Ft.fogLinearPS:"exp"===e.fog?n+=Ft.fogExpPS:"exp2"===e.fog?n+=Ft.fogExp2PS:n+=Ft.fogNonePS,2==e.normal&&(n+="\nuniform sampler2D normalMap;\n"),e.soft>0&&(n+=Ft.screenDepthPS),n+=Ft.particlePS,e.soft>0&&(n+=Ft.particle_softPS),1==e.normal&&(n+="\nvec3 normal = Normal;\n"),2==e.normal&&(n+=Ft.particle_normalMapPS),e.normal>0&&(n+=e.halflambert?Ft.particle_halflambertPS:Ft.particle_lambertPS),e.normal>0&&(n+=Ft.particle_lightingPS),2==e.blend?n+=Ft.particle_blendNormalPS:1==e.blend?n+=Ft.particle_blendAddPS:5==e.blend&&(n+=Ft.particle_blendMultiplyPS),n+=Ft.particle_endPS,{attributes:Kt(i),vshader:i,fshader:n}}},te={generateKey:function(t){return"skybox"+t.rgbm+" "+t.hdr+" "+t.fixSeams+t.toneMapping+t.gamma+t.useIntensity+t.useCubeMapRotation+t.useRightHandedCubeMap+t.mip},createShaderDefinition:function(t,e){var i;return i=Wt(t),i+=e.useCubeMapRotation?"#define CUBEMAP_ROTATION\n":"",i+=e.useRightHandedCubeMap?"#define RIGHT_HANDED_CUBEMAP\n":"",i+=e.mip?Ft.fixCubemapSeamsStretchPS:Ft.fixCubemapSeamsNonePS,i+=e.useIntensity?Ft.envMultiplyPS:Ft.envConstPS,i+=jt(e.gamma),i+=Vt(e.toneMapping),i+=Ft.rgbmPS,i+=Ft.skyboxHDRPS.replace(/\$textureCubeSAMPLE/g,e.rgbm?"textureCubeRGBM":e.hdr?"textureCube":"textureCubeSRGB").replace(/\$FIXCONST/g,1-1/[128,64,32,16,8,4,2][e.mip]+""),{attributes:{aPosition:"POSITION"},vshader:Ft.skyboxVS,fshader:i}}},ee=function(t,e,i){return"\n#ifdef MAPFLOAT\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"},ie=function(t,e,i){return"\n#ifdef MAPCOLOR\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"},ne=function(t,e,i){return"\n#ifdef MAPTEXTURE\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"},re=function(t,e,i){return"#undef MAPTEXTURECOLOR\n#ifdef MAPTEXTURE\n#ifdef MAPCOLOR\n#define MAPTEXTURECOLOR\n#endif\n#endif\n#ifdef MAPTEXTURECOLOR\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"},se=function(t,e,i){return"#undef MAPTEXTUREFLOAT\n#ifdef MAPTEXTURE\n#ifdef MAPFLOAT\n#define MAPTEXTUREFLOAT\n#endif\n#endif\n#ifdef MAPTEXTUREFLOAT\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"},ae=function(t,e,i){return"\n#ifdef MAPVERTEX\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"},oe=function(t,e,i){return"#undef MAPVERTEXCOLOR\n#ifdef MAPVERTEX\n#ifdef MAPCOLOR\n#define MAPVERTEXCOLOR\n#endif\n#endif\n#ifdef MAPVERTEXCOLOR\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"},le=function(t,e,i){return"#undef MAPVERTEXFLOAT\n#ifdef MAPVERTEX\n#ifdef MAPFLOAT\n#define MAPVERTEXFLOAT\n#endif\n#endif\n#ifdef MAPVERTEXFLOAT\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"},he=[],ce={_oldChunkToNew:{aoTexPS:{n:"aoPS",f:ne},aoVertPS:{n:"aoPS",f:ae},diffuseConstPS:{n:"diffusePS",f:ie},diffuseTexPS:{n:"diffusePS",f:ne},diffuseTexConstPS:{n:"diffusePS",f:re},diffuseVertPS:{n:"diffusePS",f:ae},diffuseVertConstPS:{n:"diffusePS",f:oe},emissiveConstPS:{n:"emissivePS",f:ie},emissiveTexPS:{n:"emissivePS",f:ne},emissiveTexConstPS:{n:"emissivePS",f:re},emissiveTexConstFloatPS:{n:"emissivePS",f:se},emissiveVertPS:{n:"emissivePS",f:ae},emissiveVertConstPS:{n:"emissivePS",f:oe},emissiveVertConstFloatPS:{n:"emissivePS",f:le},glossConstPS:{n:"glossPS",f:ee},glossTexPS:{n:"glossPS",f:ne},glossTexConstPS:{n:"glossPS",f:se},glossVertPS:{n:"glossPS",f:ae},glossVertConstPS:{n:"glossPS",f:le},metalnessConstPS:{n:"metalnessPS",f:ee},metalnessTexPS:{n:"metalnessPS",f:ne},metalnessTexConstPS:{n:"metalnessPS",f:se},metalnessVertPS:{n:"metalnessPS",f:ae},metalnessVertConstPS:{n:"metalnessPS",f:le},opacityConstPS:{n:"opacityPS",f:ee},opacityTexPS:{n:"opacityPS",f:ne},opacityTexConstPS:{n:"opacityPS",f:se},opacityVertPS:{n:"opacityPS",f:ae},opacityVertConstPS:{n:"opacityPS",f:le},specularConstPS:{n:"specularPS",f:ie},specularTexPS:{n:"specularPS",f:ne},specularTexConstPS:{n:"specularPS",f:re},specularVertPS:{n:"specularPS",f:ae},specularVertConstPS:{n:"specularPS",f:oe},transformBatchSkinnedVS:{n:"transformVS",f:function(t,e,i){return"\n#ifdef DYNAMICBATCH\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"}},transformInstancedVS:{n:"transformVS",f:function(t,e,i){return"\n#ifdef INSTANCING\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"}},transformPixelSnapVS:{n:"transformVS",f:function(t,e,i){return"\n#ifdef PIXELSNAP\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"}},transformScreenSpaceVS:{n:"transformVS",f:function(t,e,i){return"\n#ifdef SCREENSPACE\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"}},transformScreenSpaceBatchSkinned:{n:"transformVS",f:function(t,e,i){return"#undef SCREENSPACEBATCH\n#ifdef SCREENSPACE\n#ifdef BATCH\n#define SCREENSPACEBATCH\n#endif\n#endif\n#ifdef SCREENSPACEBATCH\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"}},transformSkinned:{n:"transformVS",f:function(t,e,i){return"\n#ifdef SKIN\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"}},transformUv1:{n:"transformVS",f:function(t,e,i){return"\n#ifdef UV1LAYOUT\n"+t+"\n#else\n"+Ft[e]+"\n#endif\n"}}},optionsContext:{},optionsContextMin:{},generateKey:function(t){var e,i=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&"chunks"!==i&&"lights"!==i&&e.push(i);return e.sort()};t===this.optionsContextMin?(this.propsMin||(this.propsMin=i(t)),e=this.propsMin):t===this.optionsContext?(this.props||(this.props=i(t)),e=this.props):e=i(t);var n,r="standard";for(n=0;n<e.length;n++)t[e[n]]&&(r+=e[n]+t[e[n]]);if(t.chunks){var s=[];for(var a in t.chunks)t.chunks.hasOwnProperty(a)&&s.push(a+t.chunks[a]);s.sort(),r+=s}if(t.lights)for(n=0;n<t.lights.length;n++)r+=t.lights[n].key;return yt(r)},_correctChannel:function(t,e){if(he[t]>0){if(he[t]<e.length)return e.substring(0,he[t]);if(he[t]>e.length){for(var i=e,n=i.charAt(i.length-1),r=he[t]-i.length,s=0;s<r;s++)i+=n;return i}return e}},_setMapTransform:function(t,e,i,n){t[0]+="uniform vec4 texture_"+e+"MapTransform;\n";var r=i+100*n;return t[3][r]||(t[1]+="varying vec2 vUV"+n+"_"+i+";\n",t[2]+="\t vUV"+n+"_"+i+" = uv"+n+" * texture_"+e+"MapTransform.xy + texture_"+e+"MapTransform.zw;\n",t[3][r]=!0),t},_getUvSourceExpression:function(t,e,i){var n,r=i[t],s=i[e],a=0===i.pass||1===i.pass;return a&&1===i.nineSlicedMode?n="nineSlicedUv":a&&2===i.nineSlicedMode?n="nineSlicedUv, -1000.0":(n=0===r?"vUv"+s:"vUV"+s+"_"+r,i.heightMap&&"heightMapTransform"!==t&&(n+=" + dUvOffset")),n},_addMapDef:function(t,e){var i="\n#undef "+t+"\n";return e&&(i+=" #define "+t+"\n"),i},_addMapDefs:function(t,e,i,n){var r="";return r+=this._addMapDef("MAPFLOAT",t),r+=this._addMapDef("MAPCOLOR",e),r+=this._addMapDef("MAPVERTEX",i),r+=this._addMapDef("MAPTEXTURE",n)},_addMap:function(t,e,i,n,r){var s=t+"Map",a=s+"Uv",o=s+"Transform",l=s+"Channel",h=t+"VertexColorChannel",c=t+"VertexColor",u=t+"Mode",d=i[t+"Tint"],f=i[c],p=i[s],m=i[u],g=n[e];if(p){var v=this._getUvSourceExpression(o,a,i);if(g=g.replace(/\$UV/g,v).replace(/\$CH/g,i[l]),void 0!==r){var _=0===r?"texture2DSRGB":1===r?"texture2DRGBM":"texture2D";g=g.replace(/\$texture2DSAMPLE/g,_)}}f&&(g=g.replace(/\$VC/g,i[h])),m&&(g=g.replace(/\$DETAILMODE/g,m));var y=1===d,b=3===d;return(g=this._addMapDefs(y,b,f,p)+g).replace(/\$/g,"")},_nonPointShadowMapProjection:function(t,e,i){return!e._normalOffsetBias||e._isVsm?2===e._type?e._isPcf&&(t.webgl2||t.extStandardDerivatives)?"\t\t\t getShadowCoordPerspZbuffer"+i:"\t\t\t getShadowCoordPersp"+i:"\t\t\t getShadowCoordOrtho"+i:2===e._type?e._isPcf&&(t.webgl2||t.extStandardDerivatives)?"\t\t\t getShadowCoordPerspZbufferNormalOffset"+i:"\t\t\t getShadowCoordPerspNormalOffset"+i:"\t\t\t getShadowCoordOrthoNormalOffset"+i},_addVaryingIfNeeded:function(t,e,i){return t.indexOf(i)>=0?"varying "+e+" "+i+";\n":""},_getLightSourceShapeString:function(t){switch(t){case 1:return"Rect";case 2:return"Disk";case 3:return"Sphere";default:return""}},_vsAddTransformCode:function(t,e,i,n){return t+=i.transformVS},_vsAddBaseCode:function(t,e,i,n){return t+=i.baseVS,1!==n.nineSlicedMode&&2!==n.nineSlicedMode||(t+=i.baseNineSlicedVS),t},_fsAddBaseCode:function(t,e,i,n){return t+=i.basePS,1===n.nineSlicedMode?t+=i.baseNineSlicedPS:2===n.nineSlicedMode&&(t+=i.baseNineSlicedTiledPS),t},_fsAddStartCode:function(t,e,i,n){return t+=i.startPS,1===n.nineSlicedMode?t+=i.startNineSlicedPS:2===n.nineSlicedMode&&(t+=i.startNineSlicedTiledPS),t},createShaderDefinition:function(t,e){var i,n,r=e.lights.length>0;e.dirLightMap&&(r=!0,e.useSpecular=!0),0===e.shadingModel?(e.fresnelModel=0,e.specularAntialias=!1,e.prefilteredCubemap=!1,e.dpAtlas=!1,e.ambientSH=!1):e.fresnelModel=0===e.fresnelModel?2:e.fresnelModel;var s=(e.cubeMap||e.prefilteredCubemap&&e.useSpecular)&&!e.sphereMap&&!e.dpAtlas,a=e.sphereMap||s||e.dpAtlas,o=e.useTexCubeLod;e.cubeMap&&(e.sphereMap=null),e.dpAtlas&&(e.prefilteredCubemap=null),e.useSpecular||(e.specularMap=e.glossMap=null);var l=r||a||e.ambientSH||e.prefilteredCubemap||e.heightMap||e.enableGGXSpecular,h=e.pass>=3&&e.pass<=17;this.options=e;var c,u,d,f="",p="",m="",g=Ft,v={vertex_position:"POSITION"};if(e.chunks){var _,y={};for(n in g)g.hasOwnProperty(n)&&(e.chunks[n]?((d=e.chunks[n]).indexOf("vertex_normal")>=0&&(v.vertex_normal="NORMAL"),d.indexOf("vertex_tangent")>=0&&(v.vertex_tangent="TANGENT"),d.indexOf("vertex_texCoord0")>=0&&(v.vertex_texCoord0="TEXCOORD0"),d.indexOf("vertex_texCoord1")>=0&&(v.vertex_texCoord1="TEXCOORD1"),d.indexOf("vertex_color")>=0&&(v.vertex_color="COLOR"),d.indexOf("vertex_boneWeights")>=0&&(v.vertex_boneWeights="BLENDWEIGHT"),d.indexOf("vertex_boneIndices")>=0&&(v.vertex_boneIndices="BLENDINDICES"),y[n]=d):y[n]=g[n]);for(n in e.chunks)(_=this._oldChunkToNew[n])&&(y[_.n]=_.f(e.chunks[n],_.n,n));g=y}f=this._vsAddBaseCode(f,t,g,e);var b=-1;if(!e.noShadow&&!e.twoSidedLighting){for(i=0;i<e.lights.length;i++)if(c=e.lights[i]._type,e.lights[i].castShadows&&0===c){f+="uniform mat4 light"+i+"_shadowMatrixVS;\n",f+="uniform vec3 light"+i+"_shadowParamsVS;\n",f+="uniform vec3 light"+i+(0===c?"_directionVS":"_positionVS")+";\n",b=i;break}b>=0&&(f+=g.shadowCoordVS)}p+="\t vPositionW\t\t= getWorldPosition();\n",2===e.pass&&(f+="varying float vDepth;\n",f+="#ifndef VIEWMATRIX\n",f+="#define VIEWMATRIX\n",f+="uniform mat4 matrix_view;\n",f+="#endif\n",f+="#ifndef CAMERAPLANES\n",f+="#define CAMERAPLANES\n",f+="uniform vec4 camera_params;\n\n",f+="#endif\n",p+="\t\tvDepth = -(matrix_view * vec4(vPositionW,1.0)).z * camera_params.x;\n"),e.useInstancing&&(v.instance_line1="TEXCOORD2",v.instance_line2="TEXCOORD3",v.instance_line3="TEXCOORD4",v.instance_line4="TEXCOORD5",f+=g.instancingVS),l&&(v.vertex_normal="NORMAL",p+="\t vNormalW\t\t= dNormalW = getNormal();\n",e.sphereMap&&t.fragmentUniformsCount<=16&&(f+=g.viewNormalVS,p+="\t vNormalV\t\t= getViewNormal();\n"),(e.heightMap||e.normalMap||e.enableGGXSpecular)&&e.hasTangents?(v.vertex_tangent="TANGENT",f+=g.tangentBinormalVS,p+="\t vTangentW\t = getTangent();\n",p+="\t vBinormalW\t= getBinormal();\n"):e.enableGGXSpecular&&(f+=g.tangentBinormalVS,p+="\t vObjectSpaceUpW\t= getObjectSpaceUp();\n"),b>=0&&(p+=0===(c=e.lights[b]._type)?"\t dLightDirNormW = light"+b+"_directionVS;\n":"\t getLightDirPoint(light"+b+"_positionVS);\n",u="(light"+b+"_shadowMatrixVS, light"+b+"_shadowParamsVS);\n",p+=this._nonPointShadowMapProjection(t,e.lights[b],u)));var x,w,A,C,I=[],S=[];for(n in he)if(w=n+"Map",e[n+"VertexColor"]&&(e[x=n+"VertexColorChannel"]=this._correctChannel(n,e[x])),e[w]){x=w+"Channel",A=w+"Transform",e[C=w+"Uv"]=Math.min(e[C],1),e[x]=this._correctChannel(n,e[x]);var M=e[C];I[M]=!0,S[M]=S[M]||e[w]&&!e[A]}for(e.forceUv1&&(I[1]=!0,S[1]=void 0===S[1]||S[1]),i=0;i<2;i++)I[i]&&(v["vertex_texCoord"+i]="TEXCOORD"+i,f+=g["uv"+i+"VS"],p+="\t vec2 uv"+i+" = getUv"+i+"();\n"),S[i]&&(p+="\t vUv"+i+" = uv"+i+";\n");var T=[f,m,p,[]];for(n in he)e[w=n+"Map"]&&e[A=w+"Transform"]&&(C=w+"Uv",this._setMapTransform(T,n,e[A],e[C]));f=T[0],m=T[1],p=T[2],e.vertexColors&&(v.vertex_color="COLOR",p+="\t vVertexColor = vertex_color;\n"),(e.useMorphPosition||e.useMorphNormal)&&(e.useMorphTextureBased?(f+="#define MORPHING_TEXTURE_BASED\n",e.useMorphPosition&&(f+="#define MORPHING_TEXTURE_BASED_POSITION\n"),e.useMorphNormal&&(f+="#define MORPHING_TEXTURE_BASED_NORMAL\n"),v.morph_vertex_id="ATTR15",f+="attribute float morph_vertex_id;\n"):(f+="#define MORPHING\n",e.useMorphPosition?(v.morph_pos0="ATTR8",v.morph_pos1="ATTR9",v.morph_pos2="ATTR10",v.morph_pos3="ATTR11",f+="#define MORPHING_POS03\n",f+="attribute vec3 morph_pos0;\n",f+="attribute vec3 morph_pos1;\n",f+="attribute vec3 morph_pos2;\n",f+="attribute vec3 morph_pos3;\n"):e.useMorphNormal&&(v.morph_nrm0="ATTR8",v.morph_nrm1="ATTR9",v.morph_nrm2="ATTR10",v.morph_nrm3="ATTR11",f+="#define MORPHING_NRM03\n",f+="attribute vec3 morph_nrm0;\n",f+="attribute vec3 morph_nrm1;\n",f+="attribute vec3 morph_nrm2;\n",f+="attribute vec3 morph_nrm3;\n"),e.useMorphNormal?(v.morph_nrm4="ATTR12",v.morph_nrm5="ATTR13",v.morph_nrm6="ATTR14",v.morph_nrm7="ATTR15",f+="#define MORPHING_NRM47\n",f+="attribute vec3 morph_nrm4;\n",f+="attribute vec3 morph_nrm5;\n",f+="attribute vec3 morph_nrm6;\n",f+="attribute vec3 morph_nrm7;\n"):(v.morph_pos4="ATTR12",v.morph_pos5="ATTR13",v.morph_pos6="ATTR14",v.morph_pos7="ATTR15",f+="#define MORPHING_POS47\n",f+="attribute vec3 morph_pos4;\n",f+="attribute vec3 morph_pos5;\n",f+="attribute vec3 morph_pos6;\n",f+="attribute vec3 morph_pos7;\n"))),e.skin?(v.vertex_boneWeights="BLENDWEIGHT",v.vertex_boneIndices="BLENDINDICES",f+=Gt(t,g),f+="#define SKIN\n"):e.useInstancing&&(f+="#define INSTANCING\n"),e.screenSpace&&(f+="#define SCREENSPACE\n"),e.pixelSnap&&(f+="#define PIXELSNAP\n"),f=this._vsAddTransformCode(f,t,g,e),l&&(f+=g.normalVS),f+="\n",f+=g.startVS,f+=p;var P=f+="}",E=m;m="",m+=this._addVaryingIfNeeded(f,"vec4","vMainShadowUv"),m+=this._addVaryingIfNeeded(f,"vec4","vVertexColor"),m+=this._addVaryingIfNeeded(f,"vec3","vPositionW"),m+=this._addVaryingIfNeeded(f,"vec3","vNormalV"),m+=this._addVaryingIfNeeded(f,"vec3","vNormalW"),m+=this._addVaryingIfNeeded(f,"vec3","vTangentW"),m+=this._addVaryingIfNeeded(f,"vec3","vBinormalW"),m+=this._addVaryingIfNeeded(f,"vec3","vObjectSpaceUpW"),m+=this._addVaryingIfNeeded(f,"vec2","vUv0"),m+=this._addVaryingIfNeeded(f,"vec2","vUv1"),P=(m+=E)+P;var k="";if(t.webgl2?(k=Ht(t),g.extensionVS&&(k+=g.extensionVS+"\n"),P=k+g.gles3VS+P):(g.extensionVS&&(k=g.extensionVS+"\n"),P=k+P),e.forceFragmentPrecision&&"highp"!=e.forceFragmentPrecision&&"mediump"!==e.forceFragmentPrecision&&"lowp"!==e.forceFragmentPrecision&&(e.forceFragmentPrecision=null),e.forceFragmentPrecision&&("highp"===e.forceFragmentPrecision&&"highp"!==t.maxPrecision&&(e.forceFragmentPrecision="mediump"),"mediump"===e.forceFragmentPrecision&&"lowp"===t.maxPrecision&&(e.forceFragmentPrecision="lowp")),f="",t.webgl2&&(f+=Ht(t)),t.extStandardDerivatives&&!t.webgl2&&(f+="#extension GL_OES_standard_derivatives : enable\n\n"),g.extensionPS&&(f+=g.extensionPS+"\n"),t.webgl2&&(f+=g.gles3PS),f+=e.forceFragmentPrecision?"precision "+e.forceFragmentPrecision+" float;\n\n":Wt(t),18===e.pass)return f+="uniform vec4 uColor;\n",f+=m,e.alphaTest&&(f+="float dAlpha;\n",f+=this._addMap("opacity","opacityPS",e,g),f+=g.alphaTestPS),f+="void main(void)\n{\n",e.alphaTest&&(f+="\t getOpacity();\n",f+="\t alphaTest(dAlpha);\n"),f+="\t\tgl_FragColor = uColor;\n",{attributes:v,vshader:P,fshader:f+="}\n"};if(2===e.pass)return f+="varying float vDepth;\n",f+=m,f+=g.packDepthPS,e.alphaTest&&(f+="float dAlpha;\n",f+=this._addMap("opacity","opacityPS",e,g),f+=g.alphaTestPS),f+="void main(void)\n{\n",e.alphaTest&&(f+="\t getOpacity();\n",f+="\t alphaTest(dAlpha);\n"),f+="\t\tgl_FragColor = packFloat(vDepth);\n",{attributes:v,vshader:P,fshader:f+="}\n"};if(h){var D=e.pass-3,O=D-5*(c=Math.floor(D/5));return t.extStandardDerivatives&&!t.webgl2&&(f+="uniform vec2 polygonOffset;\n"),3===O?t.textureFloatHighPrecision?f+="#define VSM_EXPONENT 15.0\n\n":f+="#define VSM_EXPONENT 5.54\n\n":2===O&&(f+="#define VSM_EXPONENT 5.54\n\n"),0!==c&&(f+="uniform vec3 view_position;\n",f+="uniform float light_radius;\n"),f+=m,e.alphaTest&&(f+="float dAlpha;\n",f+=this._addMap("opacity","opacityPS",e,g),f+=g.alphaTestPS),0!==O||t.webgl2&&1!==c?1===O&&(f+="vec2 encodeFloatRG( float v ) {\n",f+="\t\tvec2 enc = vec2(1.0, 255.0) * v;\n",f+="\t\tenc = fract(enc);\n",f+="\t\tenc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\n",f+="\t\treturn enc;\n",f+="}\n\n"):f+=g.packDepthPS,f+="void main(void)\n{\n",e.alphaTest&&(f+="\t getOpacity();\n",f+="\t alphaTest(dAlpha);\n"),f+=1===c||(1===O||2===O||3===O)&&0!==c?"\t float depth = min(distance(view_position, vPositionW) / light_radius, 0.99999);\n":"\t float depth = gl_FragCoord.z;\n",0!==O||t.webgl2&&1!==c?f+=0===O||4===O?"\t gl_FragColor = vec4(1.0);\n":1===O?"\t gl_FragColor = vec4(encodeFloatRG(depth), encodeFloatRG(depth*depth));\n":g.storeEVSMPS:t.extStandardDerivatives&&!t.webgl2?(f+="\t float minValue = 2.3374370500153186e-10; //(1.0 / 255.0) / (256.0 * 256.0 * 256.0);\n",f+="\t depth += polygonOffset.x * max(abs(dFdx(depth)), abs(dFdy(depth))) + minValue * polygonOffset.y;\n",f+="\t gl_FragColor = packFloat(depth);\n"):f+="\t gl_FragColor = packFloat(depth);\n",{attributes:v,vshader:P,fshader:f+="}\n"}}if(e.customFragmentShader)return{attributes:v,vshader:P,fshader:f+e.customFragmentShader,tag:1};f+=m,f=this._fsAddBaseCode(f,t,g,e),e.detailModes&&(f+=g.detailModesPS);var R=f;f="",e.clearCoat>0&&(f+="#define CLEARCOAT\n"),!1===e.opacityFadesSpecular&&(f+="uniform float material_alphaFade;\n");var L,N=0,z=[],B=!1,F=!1,j=e.lights.some((function(t){return t._shape&&0!==t._shape}));7===t._areaLightLutFormat&&(f+="#define AREA_R8_G8_B8_A8_LUTS\n"),j&&(f+="#define AREA_LIGHTS\n",f+="uniform sampler2D areaLightsLutTex1;\n",f+="uniform sampler2D areaLightsLutTex2;\n");var V,U=0;for(i=0;i<e.lights.length;i++)f+="uniform vec3 light"+i+"_color;\n",0===(c=(L=e.lights[i])._type)?f+="uniform vec3 light"+i+"_direction;\n":(f+="uniform vec3 light"+i+"_position;\n",f+="uniform float light"+i+"_radius;\n",2===c&&(f+="uniform vec3 light"+i+"_direction;\n",f+="uniform float light"+i+"_innerConeAngle;\n",f+="uniform float light"+i+"_outerConeAngle;\n")),0!==(U=j&&L._shape?L._shape:0)&&(0===c&&(f+="uniform vec3 light"+i+"_position;\n"),f+="uniform vec3 light"+i+"_halfWidth;\n",f+="uniform vec3 light"+i+"_halfHeight;\n"),L.castShadows&&!e.noShadow&&(f+="uniform mat4 light"+i+"_shadowMatrix;\n",f+=0!==c?"uniform vec4 light"+i+"_shadowParams;\n":"uniform vec3 light"+i+"_shadowParams;\n",1===c?f+="uniform samplerCube light"+i+"_shadowMap;\n":L._isPcf&&t.webgl2?f+="uniform sampler2DShadow light"+i+"_shadowMap;\n":f+="uniform sampler2D light"+i+"_shadowMap;\n",N++,z[L._shadowType]=!0,L._isVsm&&(B=!0),L._isPcf&&(t.webgl2||t.extStandardDerivatives)&&2===c&&(F=!0)),L._cookie&&(L._cookie._cubemap?1===c&&(f+="uniform samplerCube light"+i+"_cookie;\n",f+="uniform float light"+i+"_cookieIntensity;\n",L.castShadows&&!e.noShadow||(f+="uniform mat4 light"+i+"_shadowMatrix;\n")):2===c&&(f+="uniform sampler2D light"+i+"_cookie;\n",f+="uniform float light"+i+"_cookieIntensity;\n",L.castShadows&&!e.noShadow||(f+="uniform mat4 light"+i+"_shadowMatrix;\n"),L._cookieTransform&&(f+="uniform vec4 light"+i+"_cookieMatrix;\n",f+="uniform vec2 light"+i+"_cookieOffset;\n")));if(f+="\n",V=!e.hasTangents&&t.extStandardDerivatives?g.TBNderivativePS:e.fastTbn?g.TBNfastPS:g.TBNPS,l)if(e.normalMap||e.clearCoatNormalMap){if(f+=e.packedNormal?g.normalXYPS:g.normalXYZPS,!e.hasTangents){var G=this._getUvSourceExpression("normalMapTransform","normalMapUv",e);V=V.replace(/\$UV/g,G)}f+=V}else e.enableGGXSpecular&&!e.heightMap&&(f+=g.normalVertexPS,f+=g.TBNObjectSpacePS);if(l)if(e.normalMap){e.normalDetail&&(f+=this._addMap("normalDetail","normalDetailMapPS",e,g));var W=this._getUvSourceExpression("normalMapTransform","normalMapUv",e);e.normalizeNormalMap?f+=g.normalMapPS.replace(/\$UV/g,W):f+=g.normalMapFastPS.replace(/\$UV/g,W)}else e.enableGGXSpecular&&!e.heightMap||(f+=g.normalVertexPS);if(f+=jt(e.gamma,g),f+=Vt(e.toneMap,g),f+=Ut(e.fog,g),e.useRgbm&&(f+=g.rgbmPS),(s||e.prefilteredCubemap)&&(f+=e.fixSeams?g.fixCubemapSeamsStretchPS:g.fixCubemapSeamsNonePS),e.useCubeMapRotation&&(f+="#define CUBEMAP_ROTATION\n"),e.useRightHandedCubeMap&&(f+="#define RIGHT_HANDED_CUBEMAP\n"),l&&(f+=g.cubeMapRotatePS,f+=e.cubeMapProjection>0?g.cubeMapProjectBoxPS:g.cubeMapProjectNonePS,f+=e.skyboxIntensity?g.envMultiplyPS:g.envConstPS),e.diffuseDetail&&(f+=this._addMap("diffuseDetail","diffuseDetailMapPS",e,g)),f+=this._addMap("diffuse","diffusePS",e,g),(3!==e.blendType||e.alphaTest||e.alphaToCoverage)&&(f+=this._addMap("opacity","opacityPS",e,g)),f+=this._addMap("emissive","emissivePS",e,g,e.emissiveFormat),r&&e.useSpecular||a){e.specularAntialias&&e.normalMap?e.normalizeNormalMap&&l?f+=g.specularAaToksvigPS:f+=g.specularAaToksvigFastPS:f+=g.specularAaNonePS;var H=e.useMetalness?"metalness":"specular";f+=this._addMap(H,H+"PS",e,g),f+=this._addMap("gloss","glossPS",e,g),2===e.fresnelModel&&(f+=g.fresnelSchlickPS)}if(e.clearCoat>0&&(f+=this._addMap("clearCoat","clearCoatPS",e,g),f+=this._addMap("clearCoatGloss","clearCoatGlossPS",e,g),f+=this._addMap("clearCoatNormal","clearCoatNormalPS",e,g)),e.heightMap){if(!e.normalMap){var X=this._getUvSourceExpression("heightMapTransform","heightMapUv",e);e.hasTangents||(V=V.replace(/\$UV/g,X)),f+=V}f+=this._addMap("height","parallaxPS",e,g)}var Z=e.aoMap||e.aoVertexColor;Z&&(f+=this._addMap("ao","aoPS",e,g),e.occludeSpecular&&(1===e.occludeSpecular?f+=e.occludeSpecularFloat?g.aoSpecOccSimplePS:g.aoSpecOccConstSimplePS:f+=e.occludeSpecularFloat?g.aoSpecOccPS:g.aoSpecOccConstPS));var Y=e.rgbmReflection?"decodeRGBM":e.hdrReflection?"":"gammaCorrectInput";if(e.sphereMap){var q=t.fragmentUniformsCount>16?g.reflectionSpherePS:g.reflectionSphereLowPS;f+=q=q.replace(/\$texture2DSAMPLE/g,e.rgbmReflection?"texture2DRGBM":e.hdrReflection?"texture2D":"texture2DSRGB")}else s?e.prefilteredCubemap?f+=o?g.reflectionPrefilteredCubeLodPS.replace(/\$DECODE/g,Y):g.reflectionPrefilteredCubePS.replace(/\$DECODE/g,Y):f+=g.reflectionCubePS.replace(/\$textureCubeSAMPLE/g,e.rgbmReflection?"textureCubeRGBM":e.hdrReflection?"textureCube":"textureCubeSRGB"):e.dpAtlas&&(f+=g.reflectionDpAtlasPS.replace(/\$texture2DSAMPLE/g,e.rgbmReflection?"texture2DRGBM":e.hdrReflection?"texture2D":"texture2DSRGB"));(s||e.sphereMap||e.dpAtlas)&&(e.clearCoat>0&&(f+=g.reflectionCCPS),e.refraction&&(f+=g.refractionPS)),N>0&&(z[0]&&(f+=g.shadowStandardPS),z[4]&&(f+=g.shadowStandardGL2PS),B&&(f+=g.shadowVSM_commonPS,z[1]&&(f+=g.shadowVSM8PS),z[2]&&(f+=t.extTextureHalfFloatLinear?g.shadowEVSMPS.replace(/\$/g,"16"):g.shadowEVSMnPS.replace(/\$/g,"16")),z[3]&&(f+=t.extTextureFloatLinear?g.shadowEVSMPS.replace(/\$/g,"32"):g.shadowEVSMnPS.replace(/\$/g,"32"))),t.webgl2||t.extStandardDerivatives||(f+=g.biasConstPS),f+=g.shadowCoordPS+g.shadowCommonPS,F&&(f+=g.shadowCoordPerspZbufferPS),b>=0&&(z[0]&&(f+=g.shadowStandardVSPS),z[4]&&(f+=g.shadowStandardGL2VSPS),B&&(z[1]&&(f+=g.shadowVSMVSPS.replace(/\$VSM/g,"VSM8").replace(/\$/g,"8")),z[2]&&(f+=g.shadowVSMVSPS.replace(/\$VSM/g,"VSM16").replace(/\$/g,"16")),z[3]&&(f+=g.shadowVSMVSPS.replace(/\$VSM/g,"VSM32").replace(/\$/g,"32"))))),e.enableGGXSpecular&&(f+="uniform float material_anisotropy;\n"),r&&(f+=g.lightDiffuseLambertPS,j&&(f+=g.ltc));var K=!1;e.useSpecular?(r&&(f+=0===e.shadingModel?g.lightSpecularPhongPS:e.enableGGXSpecular?g.lightSpecularAnisoGGXPS:g.lightSpecularBlinnPS),e.sphereMap||s||e.dpAtlas||e.fresnelModel>0?e.fresnelModel>0?e.conserveEnergy&&!j?f+=g.combineDiffuseSpecularPS:f+=g.combineDiffuseSpecularNoConservePS:f+=g.combineDiffuseSpecularOldPS:e.diffuseMap?f+=g.combineDiffuseSpecularNoReflPS:(f+=g.combineDiffuseSpecularNoReflSeparateAmbientPS,K=!0)):f+=g.combineDiffusePS,e.clearCoat>0&&(f+=g.combineClearCoatPS);var J=!0;if(e.lightMap||e.lightVertexColor){var Q=e.dirLightMap?"lightmapDirPS":"lightmapSinglePS";f+=this._addMap("light",Q,e,g,e.lightMapFormat),J=e.lightMapWithoutAmbient}if(J){var $=e.rgbmAmbient?"decodeRGBM":e.hdrAmbient?"":"gammaCorrectInput";e.ambientSH?f+=g.ambientSHPS:e.prefilteredCubemap?f+=o?g.ambientPrefilteredCubeLodPS.replace(/\$DECODE/g,$):g.ambientPrefilteredCubePS.replace(/\$DECODE/g,$):f+=g.ambientConstantPS}e.ambientTint&&!K&&(f+="uniform vec3 material_ambient;\n"),e.alphaTest&&(f+=g.alphaTestPS),e.msdf&&(f+=g.msdfPS),l&&(f+=g.viewDirPS,e.useSpecular&&(f+=e.enableGGXSpecular?g.reflDirAnisoPS:g.reflDirPS));var tt,et=!1,it=!1,nt=!1,rt=!1,st=!1;e.twoSidedLighting&&(f+="uniform float twoSidedLightingNegScaleFactor;\n"),f=this._fsAddStartCode(f,t,g,e),l&&(e.hasTangents||!t.extStandardDerivatives||e.fastTbn?e.twoSidedLighting?f+="\t dVertexNormalW = gl_FrontFacing ? vNormalW * twoSidedLightingNegScaleFactor : -vNormalW * twoSidedLightingNegScaleFactor;\n":f+="\t dVertexNormalW = vNormalW;\n":e.twoSidedLighting?f+="\t dVertexNormalW = normalize(gl_FrontFacing ? vNormalW * twoSidedLightingNegScaleFactor : -vNormalW * twoSidedLightingNegScaleFactor);\n":f+="\t dVertexNormalW = normalize(vNormalW);\n",(e.heightMap||e.normalMap)&&e.hasTangents&&(e.twoSidedLighting?(f+="\t dTangentW = gl_FrontFacing ? vTangentW * twoSidedLightingNegScaleFactor : -vTangentW * twoSidedLightingNegScaleFactor;\n",f+="\t dBinormalW = gl_FrontFacing ? vBinormalW * twoSidedLightingNegScaleFactor : -vBinormalW * twoSidedLightingNegScaleFactor;\n"):(f+="\t dTangentW = vTangentW;\n",f+="\t dBinormalW = vBinormalW;\n")));var at=!1;3!==e.blendType||e.alphaTest||e.alphaToCoverage?e.heightMap&&e.opacityMap?at=!0:(f+="\t getOpacity();\n",e.alphaTest&&(f+="\t alphaTest(dAlpha);\n")):f+="\t dAlpha = 1.0;\n";var ot=!1;if(l&&(f+="\t getViewDir();\n",(e.heightMap||e.normalMap||e.clearCoatNormalMap||e.enableGGXSpecular)&&(f+="\t getTBN();\n"),e.heightMap&&(f+="\t getParallax();\n"),at&&(f+="\t getOpacity();\n",e.alphaTest&&(f+="\t alphaTest(dAlpha);\n")),f+="\t getNormal();\n",e.useSpecular&&(e.enableGGXSpecular&&(f+="\t getGlossiness();\n",ot=!0),f+="\t getReflDir();\n")),f+="\t getAlbedo();\n",e.clearCoat>0&&(f+="\t getClearCoat();\n",f+="\t getClearCoatGlossiness();\n",f+="\t getClearCoatNormal();\n"),(r&&e.useSpecular||a)&&(f+="\t getSpecularity();\n",ot||(f+="\t getGlossiness();\n"),j&&(f+="\t #ifdef AREA_LIGHTS\n",f+="\t dSpecularityNoFres = dSpecularity;\n",f+="\t #ifdef CLEARCOAT\n",f+="\t ccSpecularityNoFres = ccSpecularity;\n",f+="\t #endif\n",f+="\t #endif\n"),e.fresnelModel>0&&(f+="\t getFresnel();\n")),J&&(f+="\t addAmbient();\n"),e.ambientTint&&!K&&(f+="\t dDiffuseLight *= material_ambient;\n"),Z&&!e.occludeDirect&&(f+="\t\tapplyAO();\n"),(e.lightMap||e.lightVertexColor)&&(f+="\t addLightMap();\n"),r||a){(s||e.sphereMap||e.dpAtlas)&&(e.clearCoat>0&&(f+="\t addReflectionCC();\n"),f+="\t addReflection();\n"),j&&(f+="\t ccReflection.rgb *= ccSpecularity;\n",f+="\t dReflection.rgb *= dSpecularity;\n",f+="\t dSpecularLight *= dSpecularity;\n",f+="\t float roughness = max((1.0 - dGlossiness) * (1.0 - dGlossiness), 0.001);\n");var lt="";for(i=0;i<e.lights.length;i++){if(c=(L=e.lights[i])._type,tt=!1,j&&L._shape?(U=L._shape,lt=this._getLightSourceShapeString(U)):(U=0,lt=""),0!==U&&(f+="\t calc"+lt+"LightValues(light"+i+"_position, light"+i+"_halfWidth, light"+i+"_halfHeight);\n"),0===c?(f+="\t dLightDirNormW = light"+i+"_direction;\n",f+="\t dAtten = 1.0;\n"):(L._cookie&&(2!==c||L._cookie._cubemap?1===c&&L._cookie._cubemap&&(st=!0,tt=!0):(st=!0,tt=!0)),f+="\t getLightDirPoint(light"+i+"_position);\n",et=!0,tt&&(f+=2===c?"\t dAtten3 = getCookie2D"+(L._cookieFalloff?"":"Clip")+(L._cookieTransform?"Xform":"")+"(light"+i+"_cookie, light"+i+"_shadowMatrix, light"+i+"_cookieIntensity"+(L._cookieTransform?", light"+i+"_cookieMatrix, light"+i+"_cookieOffset":"")+")."+L._cookieChannel+";\n":"\t dAtten3 = getCookieCube(light"+i+"_cookie, light"+i+"_shadowMatrix, light"+i+"_cookieIntensity)."+L._cookieChannel+";\n"),0===U?0===L._falloffMode?(f+="\t dAtten = getFalloffLinear(light"+i+"_radius);\n",it=!0):(f+="\t dAtten = getFalloffInvSquared(light"+i+"_radius);\n",nt=!0):(f+="\t dAtten = getFalloffWindow(light"+i+"_radius);\n",nt=!0),f+="\t if (dAtten > 0.00001) {\n",2===c&&(tt&&!L._cookieFalloff||(f+="\t\t\t dAtten *= getSpotEffect(light"+i+"_direction, light"+i+"_innerConeAngle, light"+i+"_outerConeAngle);\n",rt=!0))),f+=0!==U?0===c?"\t\t\t dAttenD = getLightDiffuse();\n":"\t\t\t dAttenD = get"+lt+"LightDiffuse() * 16.0;\n":"\t\t\t dAtten *= getLightDiffuse();\n",L.castShadows&&!e.noShadow){var ht,ct=null;1===L._shadowType?(ct="VSM8",ht="0.0"):2===L._shadowType?(ct="VSM16",ht="5.54"):3===L._shadowType?(ct="VSM32",ht=t.textureFloatHighPrecision?"15.0":"5.54"):ct=4===L._shadowType?"PCF5x5":"PCF3x3",null!==ct&&(1===c?(u="(light"+i+"_shadowMap, light"+i+"_shadowParams);\n",L._normalOffsetBias&&(f+="\t\t\t normalOffsetPointShadow(light"+i+"_shadowParams);\n"),f+="\t\t\t dAtten *= getShadowPoint"+ct+u):(b===i?ct+="VS":(u="(light"+i+"_shadowMatrix, light"+i+"_shadowParams);\n",f+=this._nonPointShadowMapProjection(t,e.lights[i],u)),2===c&&(ct="Spot"+ct),f+="\t\t\t dAtten *= getShadow"+ct+"(light"+i+"_shadowMap, light"+i+"_shadowParams"+(L._isVsm?", "+ht:"")+");\n"))}0!==U?e.conserveEnergy&&e.useSpecular?f+="\t\t\t dDiffuseLight += mix((dAttenD * dAtten) * light"+i+"_color"+(tt?" * dAtten3":"")+", vec3(0), dLTCSpecFres);\n":f+="\t\t\t dDiffuseLight += (dAttenD * dAtten) * light"+i+"_color"+(tt?" * dAtten3":"")+";\n":j&&e.conserveEnergy&&e.useSpecular?f+="\t\t\t dDiffuseLight += mix(dAtten * light"+i+"_color"+(tt?" * dAtten3":"")+", vec3(0), dSpecularity);\n":f+="\t\t\t dDiffuseLight += dAtten * light"+i+"_color"+(tt?" * dAtten3":"")+";\n",0!==U?(e.clearCoat>0&&(f+="\t\t\t ccSpecularLight += ccLTCSpecFres * get"+lt+"LightSpecularCC() * dAtten * light"+i+"_color"+(tt?" * dAtten3":"")+";\n"),e.useSpecular&&(f+="\t\t\t dSpecularLight += dLTCSpecFres * get"+lt+"LightSpecular() * dAtten * light"+i+"_color"+(tt?" * dAtten3":"")+";\n")):j?(e.clearCoat>0&&(f+="\t\t\t ccSpecularLight += ccSpecularity * getLightSpecularCC() * dAtten * light"+i+"_color"+(tt?" * dAtten3":"")+";\n"),e.useSpecular&&(f+="\t\t\t dSpecularLight += dSpecularity * getLightSpecular() * dAtten * light"+i+"_color"+(tt?" * dAtten3":"")+";\n")):(e.clearCoat>0&&(f+="\t\t\t ccSpecularLight += getLightSpecularCC() * dAtten * light"+i+"_color"+(tt?" * dAtten3":"")+";\n"),e.useSpecular&&(f+="\t\t\t dSpecularLight += getLightSpecular() * dAtten * light"+i+"_color"+(tt?" * dAtten3":"")+";\n")),0!==c&&(f+="\t }\n"),f+="\n"}j&&(e.clearCoat>0&&(f+="\t ccSpecularity = vec3(1);\n"),e.useSpecular&&(f+="\t dSpecularity = vec3(1);\n")),(s||e.sphereMap||e.dpAtlas)&&e.refraction&&(f+="\t addRefraction();\n")}f+="\n",Z&&(e.occludeDirect&&(f+="\t\tapplyAO();\n"),e.occludeSpecular&&(f+="\t\toccludeSpecular();\n")),!1===e.opacityFadesSpecular&&(2!==e.blendType&&4!==e.blendType||(f+="float specLum = dot((dSpecularLight + dReflection.rgb * dReflection.a) * dSpecularity, vec3( 0.2126, 0.7152, 0.0722 ));\n",f+="#ifdef CLEARCOAT\n specLum += dot(ccSpecularLight * ccSpecularity + ccReflection.rgb * ccReflection.a * ccSpecularity, vec3( 0.2126, 0.7152, 0.0722 ));\n#endif\n",f+="dAlpha = clamp(dAlpha + gammaCorrectInput(specLum), 0.0, 1.0);\n"),f+="dAlpha *= material_alphaFade;\n"),f+=g.endPS,2===e.blendType||6===e.blendType||e.alphaToCoverage?f+=g.outputAlphaPS:4===e.blendType?f+=g.outputAlphaPremulPS:f+=g.outputAlphaOpaquePS,e.msdf&&(f+="\t gl_FragColor = applyMsdf(gl_FragColor);\n"),f+="\n",f+="}\n",et&&(f=g.lightDirPointPS+f),it&&(f=g.falloffLinearPS+f),nt&&(f=g.falloffInvSquaredPS+f),rt&&(f=g.spotPS+f),st&&(f=g.cookiePS+f);var ut="";return f.includes("dReflection")&&(ut+="vec4 dReflection;\n"),f.includes("dTBN")&&(ut+="mat3 dTBN;\n"),f.includes("dAlbedo")&&(ut+="vec3 dAlbedo;\n"),f.includes("dEmission")&&(ut+="vec3 dEmission;\n"),f.includes("dNormalW")&&(ut+="vec3 dNormalW;\n"),f.includes("dVertexNormalW")&&(ut+="vec3 dVertexNormalW;\n"),f.includes("dTangentW")&&(ut+="vec3 dTangentW;\n"),f.includes("dBinormalW")&&(ut+="vec3 dBinormalW;\n"),f.includes("dViewDirW")&&(ut+="vec3 dViewDirW;\n"),f.includes("dReflDirW")&&(ut+="vec3 dReflDirW;\n"),f.includes("dDiffuseLight")&&(ut+="vec3 dDiffuseLight;\n"),f.includes("dSpecularLight")&&(ut+="vec3 dSpecularLight;\n"),f.includes("dLightDirNormW")&&(ut+="vec3 dLightDirNormW;\n"),f.includes("dLightDirW")&&(ut+="vec3 dLightDirW;\n"),f.includes("dLightPosW")&&(ut+="vec3 dLightPosW;\n"),f.includes("dShadowCoord")&&(ut+="vec3 dShadowCoord;\n"),f.includes("dNormalMap")&&(ut+="vec3 dNormalMap;\n"),f.includes("dSpecularity")&&(ut+="vec3 dSpecularity;\n"),f.includes("dSpecularityNoFres")&&(ut+="vec3 dSpecularityNoFres;\n"),f.includes("dUvOffset")&&(ut+="vec2 dUvOffset;\n"),f.includes("dGlossiness")&&(ut+="float dGlossiness;\n"),f.includes("dAlpha")&&(ut+="float dAlpha;\n"),f.includes("dAtten")&&(ut+="float dAtten;\n"),f.includes("dAttenD")&&(ut+="float dAttenD;\n"),f.includes("dAtten3")&&(ut+="vec3 dAtten3;\n"),f.includes("dAo")&&(ut+="float dAo;\n"),f.includes("dMsdf")&&(ut+="vec4 dMsdf;\n"),f.includes("ccReflection")&&(ut+="vec4 ccReflection;\n"),f.includes("ccNormalW")&&(ut+="vec3 ccNormalW;\n"),f.includes("ccReflDirW")&&(ut+="vec3 ccReflDirW;\n"),f.includes("ccSpecularLight")&&(ut+="vec3 ccSpecularLight;\n"),f.includes("ccSpecularity")&&(ut+="float ccSpecularity;\n"),f.includes("ccSpecularityNoFres")&&(ut+="float ccSpecularityNoFres;\n"),f.includes("ccGlossiness")&&(ut+="float ccGlossiness;\n"),{attributes:v,vshader:P,fshader:f=R+ut+f,tag:1}}},ue={begin:Zt,dummyFragmentCode:Xt,end:Yt,fogCode:Ut,gammaCode:jt,precisionCode:Wt,skinCode:Gt,tonemapCode:Vt,versionCode:Ht,basic:Qt,particle:$t,skybox:te,standard:ce},de=null,fe=null;class pe{constructor(t,e){this.device=t,this.name=null,this._width=4,this._height=4,this._depth=1,this._format=7,this.type="default",this._cubemap=!1,this._volume=!1,this.fixCubemapSeams=!1,this._flipY=!0,this._premultiplyAlpha=!1,this._isRenderTarget=!1,this._mipmaps=!0,this._minFilter=5,this._magFilter=1,this._anisotropy=1,this._addressU=0,this._addressV=0,this._addressW=0,this._compareOnRead=!1,this._compareFunc=1,void 0!==e&&(void 0!==e.name&&(this.name=e.name),this._width=void 0!==e.width?e.width:this._width,this._height=void 0!==e.height?e.height:this._height,this._format=void 0!==e.format?e.format:this._format,e.hasOwnProperty("type")?this.type=e.type:e.hasOwnProperty("rgbm")?this.type=e.rgbm?"rgbm":"default":e.hasOwnProperty("swizzleGGGR")&&(this.type=e.swizzleGGGR?"swizzleGGGR":"default"),void 0!==e.mipmaps?this._mipmaps=e.mipmaps:this._mipmaps=void 0!==e.autoMipmap?e.autoMipmap:this._mipmaps,this._levels=e.levels,this._cubemap=void 0!==e.cubemap?e.cubemap:this._cubemap,this.fixCubemapSeams=void 0!==e.fixCubemapSeams?e.fixCubemapSeams:this.fixCubemapSeams,this._minFilter=void 0!==e.minFilter?e.minFilter:this._minFilter,this._magFilter=void 0!==e.magFilter?e.magFilter:this._magFilter,this._anisotropy=void 0!==e.anisotropy?e.anisotropy:this._anisotropy,this._addressU=void 0!==e.addressU?e.addressU:this._addressU,this._addressV=void 0!==e.addressV?e.addressV:this._addressV,this._compareOnRead=void 0!==e.compareOnRead?e.compareOnRead:this._compareOnRead,this._compareFunc=void 0!==e._compareFunc?e._compareFunc:this._compareFunc,this._flipY=void 0!==e.flipY?e.flipY:this._flipY,this._premultiplyAlpha=void 0!==e.premultiplyAlpha?e.premultiplyAlpha:this._premultiplyAlpha,t.webgl2&&(this._depth=void 0!==e.depth?e.depth:this._depth,this._volume=void 0!==e.volume?e.volume:this._volume,this._addressW=void 0!==e.addressW?e.addressW:this._addressW)),this._compressed=8===this._format||9===this._format||10===this._format||this._format>=21,this._invalid=!1,this._lockedLevel=-1,this._levels||(this._levels=this._cubemap?[[null,null,null,null,null,null]]:[null]),this.dirtyAll(),this._gpuSize=0}get minFilter(){return this._minFilter}set minFilter(t){this._minFilter!==t&&(this._minFilter=t,this._parameterFlags|=1)}get magFilter(){return this._magFilter}set magFilter(t){this._magFilter!==t&&(this._magFilter=t,this._parameterFlags|=2)}get addressU(){return this._addressU}set addressU(t){this._addressU!==t&&(this._addressU=t,this._parameterFlags|=4)}get addressV(){return this._addressV}set addressV(t){this._addressV!==t&&(this._addressV=t,this._parameterFlags|=8)}get addressW(){return this._addressW}set addressW(t){this.device.webgl2&&this._volume&&t!==this._addressW&&(this._addressW=t,this._parameterFlags|=16)}get compareOnRead(){return this._compareOnRead}set compareOnRead(t){this._compareOnRead!==t&&(this._compareOnRead=t,this._parameterFlags|=32)}get compareFunc(){return this._compareFunc}set compareFunc(t){this._compareFunc!==t&&(this._compareFunc=t,this._parameterFlags|=64)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy!==t&&(this._anisotropy=t,this._parameterFlags|=128)}get autoMipmap(){return this._mipmaps}set autoMipmap(t){this._mipmaps=t}get mipmaps(){return this._mipmaps}set mipmaps(t){this._mipmaps!==t&&(this._mipmaps=t,this._minFilterDirty=!0,t&&(this._needsMipmapsUpload=!0))}get width(){return this._width}get height(){return this._height}get depth(){return this._depth}get format(){return this._format}get cubemap(){return this._cubemap}get gpuSize(){var t=this.pot&&this._mipmaps&&!(this._compressed&&1===this._levels.length);return pe.calcGpuSize(this._width,this._height,this._depth,this._format,t,this._cubemap)}get volume(){return this._volume}get flipY(){return this._flipY}set flipY(t){this._flipY!==t&&(this._flipY=t,this._needsUpload=!0)}get premultiplyAlpha(){return this._premultiplyAlpha}set premultiplyAlpha(t){this._premultiplyAlpha!==t&&(this._premultiplyAlpha=t,this._needsUpload=!0)}get pot(){return k.powerOfTwo(this._width)&&k.powerOfTwo(this._height)}static calcGpuSize(t,e,i,n,r,s){de||((de=[])[0]=1,de[1]=1,de[2]=2,de[3]=2,de[4]=2,de[5]=2,de[6]=4,de[7]=4,de[11]=8,de[12]=8,de[13]=16,de[14]=16,de[15]=4,de[16]=4,de[17]=4,de[18]=4,de[19]=4,de[20]=4),fe||((fe=[])[21]=8,fe[22]=8,fe[24]=8,fe[25]=8,fe[26]=8,fe[27]=8,fe[8]=8,fe[29]=8,fe[23]=16,fe[9]=16,fe[10]=16,fe[28]=16,fe[30]=16);for(var a=de.hasOwnProperty(n)?de[n]:0,o=fe.hasOwnProperty(n)?fe[n]:0,l=0;;){if(a>0)l+=t*e*i*a;else{var h=Math.floor((t+3)/4),c=Math.floor((e+3)/4),u=Math.floor((i+3)/4);24!==n&&25!==n||(h=Math.floor(h/2,1)),l+=h*c*u*o}if(!r||1===t&&1===e&&1===i)break;t=Math.max(Math.floor(t/2),1),e=Math.max(Math.floor(e/2),1),i=Math.max(Math.floor(i/2),1)}return l*(s?6:1)}destroy(){this.device&&this.device.destroyTexture(this),this.device=null,this._levels=this._cubemap?[[null,null,null,null,null,null]]:[null]}dirtyAll(){this._levelsUpdated=this._cubemap?[[!0,!0,!0,!0,!0,!0]]:[!0],this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps,this._mipmapsUploaded=!1,this._parameterFlags=255}lock(t={}){if(void 0===t.level&&(t.level=0),void 0===t.face&&(t.face=0),void 0===t.mode&&(t.mode=2),this._lockedLevel=t.level,null===this._levels[t.level])switch(this._format){case 0:case 1:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth);break;case 2:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*2);break;case 3:case 4:case 5:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth);break;case 6:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*3);break;case 7:this._levels[t.level]=new Uint8Array(this._width*this._height*this._depth*4);break;case 8:this._levels[t.level]=new Uint8Array(Math.floor((this._width+3)/4)*Math.floor((this._height+3)/4)*8*this._depth);break;case 9:case 10:this._levels[t.level]=new Uint8Array(Math.floor((this._width+3)/4)*Math.floor((this._height+3)/4)*16*this._depth);break;case 11:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth*3);break;case 13:this._levels[t.level]=new Float32Array(this._width*this._height*this._depth*3);break;case 12:this._levels[t.level]=new Uint16Array(this._width*this._height*this._depth*4);break;case 14:this._levels[t.level]=new Float32Array(this._width*this._height*this._depth*4)}return this._levels[t.level]}setSource(t,e=0){var i,n,r,s=!1;if(this._cubemap){if(t[0])for(n=t[0].width||0,r=t[0].height||0,i=0;i<6;i++){var a=t[i];if(!a||a.width!==n||a.height!==r||!this.device._isBrowserInterface(a)){s=!0;break}}else s=!0;if(!s)for(i=0;i<6;i++)this._levels[e][i]!==t[i]&&(this._levelsUpdated[e][i]=!0)}else this.device._isBrowserInterface(t)||(s=!0),s||(t!==this._levels[e]&&(this._levelsUpdated[e]=!0),n=t.width,r=t.height);if(s)if(this._width=4,this._height=4,this._cubemap)for(i=0;i<6;i++)this._levels[e][i]=null,this._levelsUpdated[e][i]=!0;else this._levels[e]=null,this._levelsUpdated[e]=!0;else 0===e&&(this._width=n,this._height=r),this._levels[e]=t;this._invalid===s&&s||(this._invalid=s,this.upload())}getSource(t=0){return this._levels[t]}unlock(){this.upload(),this._lockedLevel=-1}upload(){this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps}getDds(){for(var t,e,i=128,n=0;this._levels[n];){var r;if(this.cubemap)for(e=0;e<6;e++){if(!this._levels[n][e])return;if(!(r=this._levels[n][e].length))return;i+=r}else{if(!(r=this._levels[n].length))return;i+=r}i+=this._levels[n].length,n++}var s=new ArrayBuffer(i),a=new Uint32Array(s,0,32),o=528391;this._levels.length>1&&(o|=131072);var l=4096;this._levels.length>1&&(l|=4194304),(this._levels.length>1||this.cubemap)&&(l|=8);var h=this.cubemap?65024:0;for(a[0]=542327876,a[1]=124,a[2]=o,a[3]=this.height,a[4]=this.width,a[5]=this.width*this.height*4,a[6]=0,a[7]=this._levels.length,n=0;n<11;n++)a[8+n]=0;a[19]=32,a[20]=65,a[21]=0,a[22]=32,a[23]=16711680,a[24]=65280,a[25]=255,a[26]=4278190080,a[27]=l,a[28]=h,a[29]=0,a[30]=0,a[31]=0;var c,u,d=128;if(this.cubemap)for(e=0;e<6;e++)for(n=0;n<this._levels.length;n++){for(c=this._levels[n][e],u=new Uint8Array(s,d,c.length),t=0;t<c.length;t++)u[t]=c[t];d+=c.length}else for(n=0;n<this._levels.length;n++){for(c=this._levels[n],u=new Uint8Array(s,d,c.length),t=0;t<c.length;t++)u[t]=c[t];d+=c.length}return s}}function me(t,e,i,n){var r=e.fixCubemapSeams?Ft.fixCubemapSeamsStretchPS:Ft.fixCubemapSeamsNonePS,s=Jt(t,Ft.fullscreenQuadVS,r+Ft.genParaboloidPS,"genParaboloid"),a=t.scope.resolve("source"),o=t.scope.resolve("params"),l=new X,h=e.width,c=e.format;h=2*Math.max(h,8);var u=new pe(t,{type:e.type,format:c,width:2*h,height:h,mipmaps:!1});u.name="paraboloid";var d=new Cf(t,u,{depth:!1});return l.x=i,l.y=n?-1:1,a.setValue(e),o.setValue(l.data),zt(t,d,s),u}function ge(t,e){t.x=.5*k.clamp(e-2,0,1);var i=e-6*t.x,n=1-t.x;return t.y=Math.min(.5*i,.75)*n+t.x,t.z=(1-.5*k.clamp(i,0,1))*n,t.w=.5*t.z,1/t.z}var ve=0;class _e{constructor(){this.name="Untitled",this.id=ve++,this._shader=null,this.variants={},this.parameters={},this.alphaTest=0,this.alphaToCoverage=!1,this.blend=!1,this.blendSrc=1,this.blendDst=0,this.blendEquation=0,this.separateAlphaBlend=!1,this.blendSrcAlpha=1,this.blendDstAlpha=0,this.blendAlphaEquation=0,this.cull=1,this.depthTest=!0,this.depthWrite=!0,this.stencilFront=null,this.stencilBack=null,this.depthBias=0,this.slopeDepthBias=0,this.redWrite=!0,this.greenWrite=!0,this.blueWrite=!0,this.alphaWrite=!0,this.meshInstances=[],this._shaderVersion=0,this._scene=null,this._dirtyBlend=!1,this.dirty=!0}get shader(){return this._shader}set shader(t){this._shader=t}get blendType(){return this.blend||1!==this.blendSrc||0!==this.blendDst||0!==this.blendEquation?this.blend&&6===this.blendSrc&&8===this.blendDst&&0===this.blendEquation?2:this.blend&&1===this.blendSrc&&1===this.blendDst&&0===this.blendEquation?1:this.blend&&6===this.blendSrc&&1===this.blendDst&&0===this.blendEquation?6:this.blend&&4===this.blendSrc&&2===this.blendDst&&0===this.blendEquation?7:this.blend&&5===this.blendSrc&&1===this.blendDst&&0===this.blendEquation?8:this.blend&&1===this.blendSrc&&1===this.blendDst&&3===this.blendEquation?9:this.blend&&1===this.blendSrc&&1===this.blendDst&&4===this.blendEquation?10:this.blend&&4===this.blendSrc&&0===this.blendDst&&0===this.blendEquation?5:this.blend&&1===this.blendSrc&&8===this.blendDst&&0===this.blendEquation?4:2:3}set blendType(t){var e=this.blend;switch(t){case 3:this.blend=!1,this.blendSrc=1,this.blendDst=0,this.blendEquation=0;break;case 2:this.blend=!0,this.blendSrc=6,this.blendDst=8,this.blendEquation=0;break;case 4:this.blend=!0,this.blendSrc=1,this.blendDst=8,this.blendEquation=0;break;case 1:this.blend=!0,this.blendSrc=1,this.blendDst=1,this.blendEquation=0;break;case 6:this.blend=!0,this.blendSrc=6,this.blendDst=1,this.blendEquation=0;break;case 7:this.blend=!0,this.blendSrc=4,this.blendDst=2,this.blendEquation=0;break;case 8:this.blend=!0,this.blendSrc=5,this.blendDst=1,this.blendEquation=0;break;case 5:this.blend=!0,this.blendSrc=4,this.blendDst=0,this.blendEquation=0;break;case 9:this.blend=!0,this.blendSrc=1,this.blendDst=1,this.blendEquation=3;break;case 10:this.blend=!0,this.blendSrc=1,this.blendDst=1,this.blendEquation=4}e!==this.blend&&(this._scene?this._scene.layers._dirtyBlend=!0:this._dirtyBlend=!0),this._updateMeshInstanceKeys()}_cloneInternal(t){t.name=this.name,t.shader=this.shader,t.alphaTest=this.alphaTest,t.alphaToCoverage=this.alphaToCoverage,t.blend=this.blend,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.separateAlphaBlend=this.separateAlphaBlend,t.blendSrcAlpha=this.blendSrcAlpha,t.blendDstAlpha=this.blendDstAlpha,t.blendAlphaEquation=this.blendAlphaEquation,t.cull=this.cull,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.depthBias=this.depthBias,t.slopeDepthBias=this.slopeDepthBias,this.stencilFront&&(t.stencilFront=this.stencilFront.clone()),this.stencilBack&&(this.stencilFront===this.stencilBack?t.stencilBack=t.stencilFront:t.stencilBack=this.stencilBack.clone()),t.redWrite=this.redWrite,t.greenWrite=this.greenWrite,t.blueWrite=this.blueWrite,t.alphaWrite=this.alphaWrite}clone(){var t=new _e;return this._cloneInternal(t),t}_updateMeshInstanceKeys(){var t,e=this.meshInstances;for(t=0;t<e.length;t++)e[t].updateKey()}updateUniforms(){}updateShader(t,e,i){}update(){this.dirty=!0,this._shader&&(this._shader.failed=!1)}clearParameters(){this.parameters={}}getParameters(){return this.parameters}clearVariants(){var t,e;this.variants={};for(var i=0;i<this.meshInstances.length;i++)for(t=this.meshInstances[i],e=0;e<t._shader.length;e++)t._shader[e]=null}getParameter(t){return this.parameters[t]}setParameter(t,e){if(void 0===e&&"object"==typeof t){var i=t;if(i.length){for(var n=0;n<i.length;n++)this.setParameter(i[n]);return}t=i.name,e=i.value}var r=this.parameters[t];r?r.data=e:this.parameters[t]={scopeId:null,data:e}}deleteParameter(t){this.parameters[t]&&delete this.parameters[t]}setParameters(t,e){var i,n=this.parameters;for(var r in void 0===e&&(e=n),e)(i=n[r])&&(i.scopeId||(i.scopeId=t.scope.resolve(r)),i.scopeId.setValue(i.data))}destroy(){var t,e;this.variants={},this.shader=null;for(var i=0;i<this.meshInstances.length;i++){for(t=this.meshInstances[i],e=0;e<t._shader.length;e++)t._shader[e]=null;t._material=null;var n=_e.defaultMaterial;this!==n&&(t.material=n)}}}function ye(){this._mapXForms=null}_e.defaultMaterial=null,ye.prototype.updateMinRef=function(t,e,i,n,r,s,a,o,l){this._updateSharedOptions(t,n,r,a),this._updateMinOptions(t,n),this._updateUVOptions(t,n,r,!0)},ye.prototype.updateRef=function(t,e,i,n,r,s,a,o,l){this._updateSharedOptions(t,n,r,a),t.useTexCubeLod=e.useTexCubeLod,this._updateEnvOptions(t,n,i,l),this._updateMaterialOptions(t,n),1===a&&(t.gamma&&(t.gamma=3),t.toneMap=0),t.hasTangents=r&&n.normalMap&&0!=(512&r),this._updateLightOptions(t,n,r,o,s),this._updateUVOptions(t,n,r,!1),t.clearCoat=n.clearCoat,t.clearCoatGlossiness=n.clearCoatGlossiness},ye.prototype._updateSharedOptions=function(t,e,i,n){t.pass=n,t.alphaTest=e.alphaTest>0,t.forceFragmentPrecision=e.forceFragmentPrecision||"",t.chunks=e.chunks||"",t.blendType=e.blendType,t.forceUv1=e.forceUv1,t.screenSpace=i&&0!=(256&i),t.skin=i&&0!=(2&i),t.useInstancing=i&&0!=(32&i),t.useMorphPosition=i&&0!=(1024&i),t.useMorphNormal=i&&0!=(2048&i),t.useMorphTextureBased=i&&0!=(4096&i),t.nineSlicedMode=e.nineSlicedMode||0},ye.prototype._updateUVOptions=function(t,e,i,n){var r=!1,s=!1,a=!1;for(var o in i&&(r=0!=(4&i),s=0!=(8&i),a=0!=(16&i)),t.vertexColors=!1,this._mapXForms=[],he)this._updateTexOptions(t,e,o,r,s,a,n);this._mapXForms=null},ye.prototype._updateMinOptions=function(t,e){t.opacityTint=1!==e.opacity&&3!==e.blendType,t.lights=[]},ye.prototype._updateMaterialOptions=function(t,e){var i=1===e.diffuse.r&&1===e.diffuse.g&&1===e.diffuse.b||!e.diffuseTint&&(e.diffuseMap||e.diffuseVertexColor)?0:3,n=!1,r=!!(e.useMetalness||e.specularMap||e.sphereMap||e.cubeMap||e.dpAtlas);(r=(r=(r=r||!!e.useMetalness||!(0===e.specular.r&&0===e.specular.g&&0===e.specular.b))||e.enableGGXSpecular)||e.clearCoat>0)&&(!e.specularTint&&(e.specularMap||e.specularVertexColor)||e.useMetalness||(n=1!==e.specular.r||1!==e.specular.g||1!==e.specular.b));var s=e.emissiveMap?0:3;s||(s=(s=(1!==e.emissive.r||1!==e.emissive.g||1!==e.emissive.b||1!==e.emissiveIntensity)&&e.emissiveTint)?3:1!==e.emissiveIntensity?1:0);var a=!!e.normalMap&&(10===e.normalMap.format||"swizzleGGGR"===e.normalMap.type);t.opacityTint=1!==e.opacity&&3!==e.blendType?1:0,t.blendMapsWithColors=!0,t.ambientTint=e.ambientTint,t.diffuseTint=i,t.specularTint=n?3:0,t.metalnessTint=e.useMetalness&&e.metalness<1?1:0,t.glossTint=1,t.emissiveTint=s,t.alphaToCoverage=e.alphaToCoverage,t.normalizeNormalMap=e.normalizeNormalMap,t.sphereMap=!!e.sphereMap,t.cubeMap=!!e.cubeMap,t.dpAtlas=!!e.dpAtlas,t.ambientSH=!!e.ambientSH,t.useSpecular=r,t.emissiveFormat=e.emissiveMap?"rgbm"===e.emissiveMap.type?1:14===e.emissiveMap.format?2:0:null,t.lightMapFormat=e.lightMap?"rgbm"===e.lightMap.type?1:14===e.lightMap.format?2:0:null,t.specularAntialias=e.specularAntialias&&!!e.normalMap&&!!e.normalMap.mipmaps&&!a,t.conserveEnergy=e.conserveEnergy,t.opacityFadesSpecular=e.opacityFadesSpecular,t.alphaFade=e.alphaFade,t.occludeSpecular=e.occludeSpecular,t.occludeSpecularFloat=1!==e.occludeSpecularIntensity,t.occludeDirect=e.occludeDirect,t.shadingModel=e.shadingModel,t.fresnelModel=e.fresnelModel,t.packedNormal=a,t.fastTbn=e.fastTbn,t.cubeMapProjection=e.cubeMapProjection,t.customFragmentShader=e.customFragmentShader,t.refraction=!!e.refraction,t.useMetalness=e.useMetalness,t.enableGGXSpecular=e.enableGGXSpecular,t.msdf=!!e.msdfMap,t.twoSidedLighting=e.twoSidedLighting,t.pixelSnap=e.pixelSnap,t.aoMapUv=e.aoUvSet,t.diffuseDetail=!!e.diffuseMap,t.normalDetail=!!e.normalMap,t.diffuseDetailMode=e.diffuseDetailMode,t.detailModes=!!t.diffuseDetail,t.clearCoatTint=1!==e.clearCoat?1:0,t.clearCoatGlossTint=1!==e.clearCoatGlossiness?1:0},ye.prototype._updateEnvOptions=function(t,e,i,n){var r,s=n&&"rgbm"===n.type||e.cubeMap&&"rgbm"===e.cubeMap.type||e.dpAtlas&&"rgbm"===e.dpAtlas.type,a=n&&("rgbm"===n.type||14===n.format)||e.cubeMap&&("rgbm"===e.cubeMap.type||14===e.cubeMap.format)||e.dpAtlas&&("rgbm"===e.dpAtlas.type||14===e.dpAtlas.format),o=n&&!e.cubeMap&&!e.sphereMap&&!e.dpAtlas&&"rgbm"===n.type||e.cubeMap&&"rgbm"===e.cubeMap.type||e.sphereMap&&"rgbm"===e.sphereMap.type||e.dpAtlas&&"rgbm"===e.dpAtlas.type,l=!(!n||e.cubeMap||e.sphereMap||e.dpAtlas)&&("rgbm"===n.type||14===n.format)||e.cubeMap&&("rgbm"===e.cubeMap.type||14===e.cubeMap.format)||e.sphereMap&&("rgbm"===e.sphereMap.type||14===e.sphereMap.format)||e.dpAtlas&&("rgbm"===e.dpAtlas.type||14===e.dpAtlas.format);e.useSkybox&&i._skyboxPrefiltered&&(r=i._skyboxPrefiltered[0]),t.fog=e.useFog?i.fog:"none",t.gamma=e.useGammaTonemap?i.gammaCorrection:0,t.toneMap=e.useGammaTonemap?i.toneMapping:-1,t.rgbmAmbient=s,t.hdrAmbient=a,t.rgbmReflection=o,t.hdrReflection=l,t.useRgbm=o||s||e.emissiveMap&&"rgbm"===e.emissiveMap.type||e.lightMap&&"rgbm"===e.lightMap.type,t.fixSeams=n?n.fixCubemapSeams:!!e.cubeMap&&e.cubeMap.fixCubemapSeams,t.prefilteredCubemap=!!n,t.skyboxIntensity=n&&r&&n===r&&1!==i.skyboxIntensity,t.useCubeMapRotation=e.useSkybox&&i&&i.skyboxRotation&&!i.skyboxRotation.equals($.IDENTITY),t.useRightHandedCubeMap=e.cubeMap?e.cubeMap._isRenderTarget:e.useSkybox&&i&&i._skyboxIsRenderTarget},ye.prototype._updateLightOptions=function(t,e,i,n,r){if(t.lightMap=!1,t.lightMapChannel="",t.lightMapUv=0,t.lightMapTransform=0,t.lightMapWithoutAmbient=!1,t.dirLightMap=!1,i&&(t.noShadow=0!=(1&i),0!=(64&i)&&(t.lightMapFormat=1,t.lightMap=!0,t.lightMapChannel="rgb",t.lightMapUv=1,t.lightMapTransform=0,t.lightMapWithoutAmbient=!e.lightMap,t.useRgbm=!0,0!=(128&i)&&(t.dirLightMap=!0))),e.useLighting){var s=[],a=i?i>>16:1;n&&(this._collectLights(0,n[0],s,a),this._collectLights(1,n[1],s,a,r),this._collectLights(2,n[2],s,a,r)),t.lights=s}else t.lights=[];0===t.lights.length&&(t.noShadow=!0)},ye.prototype._updateTexOptions=function(t,e,i,n,r,s,a){var o=i+"Map",l=i+"VertexColor",h=i+"VertexColorChannel",c=o+"Channel",u=o+"Transform",d=o+"Uv";"light"!==i&&(t[o]=!1,t[c]="",t[u]=0,t[d]=0),t[l]=!1,t[h]="";var f="opacity"===i;if(f&&3===e.blendType&&0===e.alphaTest&&!e.alphaToCoverage)return t;if((!a||f)&&("height"!==i&&e[l]&&s&&(t[l]=e[l],t[h]=e[h],t.vertexColors=!0),e[o])){var p=!0;0!==e[d]||n||(p=!1),1!==e[d]||r||(p=!1),p&&(t[o]=!!e[o],t[u]=this._getMapTransformID(e[u],e[d]),t[c]=e[c],t[d]=e[d])}},ye.prototype._collectLights=function(t,e,i,n,r){var s,a;for(a=0;a<e.length;a++)if((s=e[a]).enabled&&s.mask&n){if(0!==t&&s.isStatic)continue;i.push(s)}if(r)for(a=0;a<r.length;a++)(s=r[a])._type===t&&i.push(s)},ye.prototype._getMapTransformID=function(t,e){if(!t)return 0;var i,n;for(this._mapXForms[e]||(this._mapXForms[e]=[]),i=0;i<this._mapXForms[e].length;i++){if(n=!0,this._mapXForms[e][i][0]!=t.x){n=!1;break}if(this._mapXForms[e][i][1]!=t.y){n=!1;break}if(this._mapXForms[e][i][2]!=t.z){n=!1;break}if(this._mapXForms[e][i][3]!=t.w){n=!1;break}if(n)return i+1}var r=this._mapXForms[e].length;return this._mapXForms[e][r]=[],this._mapXForms[e][r][0]=t.x,this._mapXForms[e][r][1]=t.y,this._mapXForms[e][r][2]=t.z,this._mapXForms[e][r][3]=t.w,r+1};class be{constructor(){this._refCount=0}incRefCount(){this._refCount++}decRefCount(){this._refCount--}getRefCount(){return this._refCount}}class xe{constructor(t,e,i,n=0,r){this.device=t,this.format=e,this.numIndices=i,this.usage=n;var s,a=this.device.gl;0===e?(s=1,this.glFormat=a.UNSIGNED_BYTE):1===e?(s=2,this.glFormat=a.UNSIGNED_SHORT):2===e&&(s=4,this.glFormat=a.UNSIGNED_INT),this.bytesPerIndex=s,this.numBytes=this.numIndices*s,r?this.setData(r):this.storage=new ArrayBuffer(this.numBytes),t._vram.ib+=this.numBytes,this.device.buffers.push(this)}destroy(){var t=this.device,e=t.buffers.indexOf(this);(-1!==e&&t.buffers.splice(e,1),this.bufferId)&&(this.device.gl.deleteBuffer(this.bufferId),this.device._vram.ib-=this.storage.byteLength,this.bufferId=null,this.device.indexBuffer===this&&(this.device.indexBuffer=null))}loseContext(){this.bufferId=void 0}getFormat(){return this.format}getNumIndices(){return this.numIndices}lock(){return this.storage}unlock(){var t,e=this.device.gl;switch(this.bufferId||(this.bufferId=e.createBuffer()),this.usage){case 0:t=e.STATIC_DRAW;break;case 1:t=e.DYNAMIC_DRAW;break;case 2:t=e.STREAM_DRAW;break;case 3:t=this.device.webgl2?e.DYNAMIC_COPY:e.STATIC_DRAW}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.bufferId),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.storage,t)}setData(t){return t.byteLength===this.numBytes&&(this.storage=t,this.unlock(),!0)}_lockTypedArray(){var t=this.lock();return 2===this.format?new Uint32Array(t):1===this.format?new Uint16Array(t):new Uint8Array(t)}writeData(t,e){var i,n=this._lockTypedArray();if(t.length>e)if(ArrayBuffer.isView(t))t=t.subarray(0,e),n.set(t);else for(i=0;i<e;i++)n[i]=t[i];else n.set(t);this.unlock()}readData(t){var e,i=this._lockTypedArray(),n=this.numIndices;if(ArrayBuffer.isView(t))t.set(i);else for(t.length=0,e=0;e<n;e++)t[e]=i[e];return n}}var we=0;class Ae{constructor(){this.initDefaults()}initDefaults(){this.recreate=!1,this.verticesUsage=0,this.indicesUsage=0,this.maxVertices=0,this.maxIndices=0,this.vertexCount=0,this.indexCount=0,this.vertexStreamsUpdated=!1,this.indexStreamUpdated=!1,this.vertexStreamDictionary={},this.indices=null}_validateVertexCount(t,e){}_changeVertexCount(t,e){this.vertexCount?this._validateVertexCount(t,e):this.vertexCount=t}}Ae.DEFAULT_COMPONENTS_POSITION=3,Ae.DEFAULT_COMPONENTS_NORMAL=3,Ae.DEFAULT_COMPONENTS_UV=2,Ae.DEFAULT_COMPONENTS_COLORS=4;class Ce{constructor(t,e,i,n){this.data=t,this.componentCount=e,this.dataType=i,this.dataTypeNormalize=n}}class Ie extends be{constructor(t){super(),this.id=we++,this.device=t||qd.getApplication().graphicsDevice,this.vertexBuffer=null,this.indexBuffer=[null],this.primitive=[{type:0,base:0,count:0}],this.skin=null,this.morph=null,this._geometryData=null,this._aabb=new st,this.boneAabb=null}get aabb(){return this._aabb}set aabb(t){this._aabb=t}destroy(){var t,e;for(this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=null),t=0;t<this.indexBuffer.length;t++)(e=this.indexBuffer[t])&&e.destroy();this.indexBuffer.length=0,this._geometryData=null}_initBoneAabbs(t){this.boneAabb=[],this.boneUsed=[];var e,i,n,r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w=this.vertexBuffer.numVertices,A=[],C=[],I=this.boneUsed,S=this.skin.boneNames.length;for(e=0;e<S;e++)A[e]=new H(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C[e]=new H(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);var M=new Rt(this.vertexBuffer),T=M.element.POSITION,P=M.element.BLENDWEIGHT,E=M.element.BLENDINDICES;for(i=0;i<w;i++){for(n=0;n<4;n++)if(P.array[P.index+n]>0&&(I[u=E.array[E.index+n]]=!0,s=T.array[T.index],a=T.array[T.index+1],o=T.array[T.index+2],l=C[u],(h=A[u]).x>s&&(h.x=s),h.y>a&&(h.y=a),h.z>o&&(h.z=o),l.x<s&&(l.x=s),l.y<a&&(l.y=a),l.z<o&&(l.z=o),t)){for(d=m=s,f=g=a,p=v=o,r=0;r<t.length;r++)(_=(x=t[r]).deltaPositions[3*i])<0?d+=_:m+=_,(y=x.deltaPositions[3*i+1])<0?f+=y:g+=y,(b=x.deltaPositions[3*i+2])<0?p+=b:v+=b;h.x>d&&(h.x=d),h.y>f&&(h.y=f),h.z>p&&(h.z=p),l.x<m&&(l.x=m),l.y<g&&(l.y=g),l.z<v&&(l.z=v)}M.next()}for(e=0;e<S;e++)(c=new st).setMinMax(A[e],C[e]),this.boneAabb.push(c)}_initGeometryData(){this._geometryData||(this._geometryData=new Ae,this.vertexBuffer&&(this._geometryData.vertexCount=this.vertexBuffer.numVertices,this._geometryData.maxVertices=this.vertexBuffer.numVertices),this.indexBuffer.length>0&&this.indexBuffer[0]&&(this._geometryData.indexCount=this.indexBuffer[0].numIndices,this._geometryData.maxIndices=this.indexBuffer[0].numIndices))}clear(t,e,i=0,n=0){this._initGeometryData(),this._geometryData.initDefaults(),this._geometryData.recreate=!0,this._geometryData.maxVertices=i,this._geometryData.maxIndices=n,this._geometryData.verticesUsage=t?0:1,this._geometryData.indicesUsage=e?0:1}setVertexStream(t,e,i,n,r=6,s=!1){this._initGeometryData();var a=n||e.length/i;this._geometryData._changeVertexCount(a,t),this._geometryData.vertexStreamsUpdated=!0,this._geometryData.vertexStreamDictionary[t]=new Ce(e,i,r,s)}getVertexStream(t,e){var i=0,n=!1;if(this._geometryData){var r=this._geometryData.vertexStreamDictionary[t];r&&(n=!0,i=this._geometryData.vertexCount,ArrayBuffer.isView(e)?e.set(r.data):(e.length=0,e.push(r.data)))}n||this.vertexBuffer&&(i=new Rt(this.vertexBuffer).readData(t,e));return i}setPositions(t,e=Ae.DEFAULT_COMPONENTS_POSITION,i){this.setVertexStream("POSITION",t,e,i,6,!1)}setNormals(t,e=Ae.DEFAULT_COMPONENTS_NORMAL,i){this.setVertexStream("NORMAL",t,e,i,6,!1)}setUvs(t,e,i=Ae.DEFAULT_COMPONENTS_UV,n){this.setVertexStream("TEXCOORD"+t,e,i,n,6,!1)}setColors(t,e=Ae.DEFAULT_COMPONENTS_COLORS,i){this.setVertexStream("COLOR",t,e,i,6,!1)}setColors32(t,e){this.setVertexStream("COLOR",t,Ae.DEFAULT_COMPONENTS_COLORS,e,1,!0)}setIndices(t,e){this._initGeometryData(),this._geometryData.indexStreamUpdated=!0,this._geometryData.indices=t,this._geometryData.indexCount=e||t.length}getPositions(t){return this.getVertexStream("POSITION",t)}getNormals(t){return this.getVertexStream("NORMAL",t)}getUvs(t,e){return this.getVertexStream("TEXCOORD"+t,e)}getColors(t){return this.getVertexStream("COLOR",t)}getIndices(t){var e=0;if(this._geometryData&&this._geometryData.indices){var i=this._geometryData.indices;e=this._geometryData.indexCount,ArrayBuffer.isView(t)?t.set(i):(t.length=0,t.push(i))}else{if(this.indexBuffer.length>0&&this.indexBuffer[0])e=this.indexBuffer[0].readData(t)}return e}update(t=4,e=!0){if(this._geometryData){if(e){var i=this._geometryData.vertexStreamDictionary.POSITION;i&&3==i.componentCount&&this._aabb.compute(i.data,this._geometryData.vertexCount)}var n=this._geometryData.recreate;this._geometryData.vertexCount>this._geometryData.maxVertices&&(n=!0,this._geometryData.maxVertices=this._geometryData.vertexCount),n&&this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=null);var r=this._geometryData.recreate;this._geometryData.indexCount>this._geometryData.maxIndices&&(r=!0,this._geometryData.maxIndices=this._geometryData.indexCount),r&&this.indexBuffer.length>0&&this.indexBuffer[0]&&(this.indexBuffer[0].destroy(),this.indexBuffer[0]=null),this._geometryData.vertexStreamsUpdated&&this._updateVertexBuffer(),this._geometryData.indexStreamUpdated&&this._updateIndexBuffer(),this.primitive[0].type=t,this.indexBuffer.length>0&&this.indexBuffer[0]?this._geometryData.indexStreamUpdated&&(this.primitive[0].count=this._geometryData.indexCount,this.primitive[0].indexed=!0):this._geometryData.vertexStreamsUpdated&&(this.primitive[0].count=this._geometryData.vertexCount,this.primitive[0].indexed=!1),this._geometryData.vertexCount=0,this._geometryData.indexCount=0,this._geometryData.vertexStreamsUpdated=!1,this._geometryData.indexStreamUpdated=!1,this._geometryData.recreate=!1}}_buildVertexFormat(t){var e=[];for(var i in this._geometryData.vertexStreamDictionary){var n=this._geometryData.vertexStreamDictionary[i];e.push({semantic:i,components:n.componentCount,type:n.dataType,normalize:n.dataTypeNormalize})}return new bt(this.device,e,t)}_updateVertexBuffer(){if(!this.vertexBuffer){var t=this._geometryData.maxVertices,e=this._buildVertexFormat(t);this.vertexBuffer=new _t(this.device,e,t,this._geometryData.verticesUsage)}var i=new Rt(this.vertexBuffer),n=this._geometryData.vertexCount;for(var r in this._geometryData.vertexStreamDictionary){var s=this._geometryData.vertexStreamDictionary[r];i.writeData(r,s.data,n),delete this._geometryData.vertexStreamDictionary[r]}i.end()}_updateIndexBuffer(){if(this.indexBuffer.length<=0||!this.indexBuffer[0]){var t=this._geometryData.maxVertices>65535?2:1;this.indexBuffer[0]=new xe(this.device,t,this._geometryData.maxIndices,this._geometryData.indicesUsage)}var e=this._geometryData.indices;e&&(this.indexBuffer[0].writeData(e,this._geometryData.indexCount),this._geometryData.indices=null)}generateWireframe(){var t,e=function(t){switch(t.format){case 0:return new Uint8Array(t.storage);case 1:return new Uint16Array(t.storage);case 2:return new Uint32Array(t.storage);default:return null}},i=[];if(this.indexBuffer.length>0&&this.indexBuffer[0]){for(var n=[[0,1],[1,2],[2,0]],r=this.primitive[0].base,s=this.primitive[0].count,a=this.indexBuffer[0],o=e(a),l={},h=r;h<r+s;h+=3)for(var c=0;c<3;c++){var u=o[h+n[c][0]],d=o[h+n[c][1]],f=u>d?d<<16|u:u<<16|d;void 0===l[f]&&(l[f]=0,i.push(u,d))}t=a.format}else{for(var p=0;p<this.vertexBuffer.numVertices;p+=3)i.push(p,p+1,p+1,p+2,p+2,p);t=i.length>65535?2:1}var m=new xe(this.vertexBuffer.device,t,i.length);e(m).set(i),m.unlock(),this.primitive[1]={type:1,base:0,count:i.length,indexed:!0},this.indexBuffer[1]=m}}var Se=new st,Me=new st,Te=new ct;class Pe{constructor(t){this.count=t,this.vertexBuffer=null}}class Ee{constructor(t,e,i){this._key=[0,0],this._shader=[null,null,null],this.isStatic=!1,this._staticLightList=null,this._staticSource=null,this.node=t,this._mesh=e,e.incRefCount(),this.material=i,this._shaderDefs=65536,this._shaderDefs|=e.vertexBuffer.format.hasUv0?4:0,this._shaderDefs|=e.vertexBuffer.format.hasUv1?8:0,this._shaderDefs|=e.vertexBuffer.format.hasColor?16:0,this._shaderDefs|=e.vertexBuffer.format.hasTangents?512:0,this._lightHash=0,this.visible=!0,this.layer=15,this.renderStyle=0,this.castShadow=!1,this._receiveShadow=!0,this._screenSpace=!1,this._noDepthDrawGl1=!1,this.cull=!0,this.pick=!0,this._updateAabb=!0,this._updateAabbFunc=null,this._calculateSortDistance=null,this.updateKey(),this._skinInstance=null,this._morphInstance=null,this.instancingData=null,this.aabb=new st,this._aabbVer=-1,this.drawOrder=0,this.visibleThisFrame=0,this.isVisibleFunc=null,this.parameters={},this.stencilFront=null,this.stencilBack=null,this.flipFaces=!1}get mesh(){return this._mesh}set mesh(t){t!==this._mesh&&(this._mesh&&this._mesh.decRefCount(),this._mesh=t,t&&t.incRefCount())}get aabb(){var t;if(!this._updateAabb)return this._aabb;if(this._updateAabbFunc)return this._updateAabbFunc(this._aabb);if(this.skinInstance){if(!this.mesh.boneAabb){var e=this._morphInstance?this._morphInstance.morph._targets:null;this.mesh._initBoneAabbs(e)}var i=this.mesh.boneUsed,n=this.node.getWorldTransform(),r=!0;for(t=0;t<this.mesh.boneAabb.length;t++)i[t]&&(Me.setFromTransformedAabb(this.mesh.boneAabb[t],this.skinInstance.matrices[t]),r?(r=!1,Se.center.copy(Me.center),Se.halfExtents.copy(Me.halfExtents)):Se.add(Me));this._aabb.setFromTransformedAabb(Se,n)}else this.node._aabbVer!==this._aabbVer&&(this.mesh?(Se.center.copy(this.mesh.aabb.center),Se.halfExtents.copy(this.mesh.aabb.halfExtents)):(Se.center.set(0,0,0),Se.halfExtents.set(0,0,0)),this.mesh&&this.mesh.morph&&Se._expand(this.mesh.morph.aabb.getMin(),this.mesh.morph.aabb.getMax()),this._aabb.setFromTransformedAabb(Se,this.node.getWorldTransform()),this._aabbVer=this.node._aabbVer);return this._aabb}set aabb(t){this._aabb=t}get material(){return this._material}set material(t){var e;for(e=0;e<this._shader.length;e++)this._shader[e]=null;if(this._material){var i=this._material.meshInstances;-1!==(e=i.indexOf(this))&&i.splice(e,1)}var n=this._material;if((this._material=t,this._material)&&(this._material.meshInstances.push(this),this.updateKey(),(n&&3!==n.blendType)!==(3!==this._material.blendType))){var r=this._material._scene;!r&&n&&n._scene&&(r=n._scene),r?r.layers._dirtyBlend=!0:this._material._dirtyBlend=!0}}get layer(){return this._layer}set layer(t){this._layer=t,this.updateKey()}get calculateSortDistance(){return this._calculateSortDistance}set calculateSortDistance(t){this._calculateSortDistance=t}get receiveShadow(){return this._receiveShadow}set receiveShadow(t){this._receiveShadow=t,this._shaderDefs=t?-2&this._shaderDefs:1|this._shaderDefs,this._shader[0]=null,this._shader[1]=null}get skinInstance(){return this._skinInstance}set skinInstance(t){this._skinInstance=t,this._shaderDefs=t?2|this._shaderDefs:-3&this._shaderDefs;for(var e=0;e<this._shader.length;e++)this._shader[e]=null;this._setupSkinUpdate()}get morphInstance(){return this._morphInstance}set morphInstance(t){this._morphInstance=t,this._morphInstance&&(this._morphInstance.meshInstance=this),this._shaderDefs=t&&t.morph.useTextureMorph?4096|this._shaderDefs:-4097&this._shaderDefs,this._shaderDefs=t&&t.morph.morphPositions?1024|this._shaderDefs:-1025&this._shaderDefs,this._shaderDefs=t&&t.morph.morphNormals?2048|this._shaderDefs:-2049&this._shaderDefs;for(var e=0;e<this._shader.length;e++)this._shader[e]=null}get screenSpace(){return this._screenSpace}set screenSpace(t){this._screenSpace=t,this._shaderDefs=t?256|this._shaderDefs:-257&this._shaderDefs,this._shader[0]=null}get key(){return this._key[0]}set key(t){this._key[0]=t}get mask(){return this._shaderDefs>>16}set mask(t){var e=65535&this._shaderDefs;this._shaderDefs=e|t<<16,this._shader[0]=null,this._shader[1]=null}get instancingCount(){return this.instancingData?this.instancingData.count:0}set instancingCount(t){this.instancingData&&(this.instancingData.count=t)}destroy(){let t=this.mesh;t&&(this.mesh=null,t.getRefCount()<1&&t.destroy()),this._skinInstance&&(this._skinInstance.destroy(),this._skinInstance=null),this.morphInstance&&(this.morphInstance.destroy(),this.morphInstance=null),this.material=null}syncAabb(){}_isVisible(t){if(this.visible){if(this.isVisibleFunc)return this.isVisibleFunc(t);var e=this.aabb.center;return this._aabb._radiusVer!==this._aabbVer&&(this._aabb._radius=this._aabb.halfExtents.length(),this._aabb._radiusVer=this._aabbVer),Te.radius=this._aabb._radius,Te.center=e,t.frustum.containsSphere(Te)}return!1}updateKey(){var t=this.material;this._key[0]=ke(this.layer,t.alphaToCoverage||t.alphaTest?2:t.blendType,!1,t.id)}setInstancing(t){t?(this.instancingData=new Pe(t.numVertices),this.instancingData.vertexBuffer=t,t.instancing=!0,this.cull=!1):(this.instancingData=null,this.cull=!0)}clearParameters(){this.parameters={}}getParameters(){return this.parameters}getParameter(t){return this.parameters[t]}setParameter(t,e,i=-524285){if(void 0===e&&"object"==typeof t){var n=t;if(n.length){for(var r=0;r<n.length;r++)this.setParameter(n[r]);return}t=n.name,e=n.value}var s=this.parameters[t];s?(s.data=e,s.passFlags=i):this.parameters[t]={scopeId:null,data:e,passFlags:i}}deleteParameter(t){this.parameters[t]&&delete this.parameters[t]}setParameters(t,e){var i,n=this.parameters;for(var r in n)(i=n[r]).passFlags&e&&(i.scopeId||(i.scopeId=t.scope.resolve(r)),i.scopeId.setValue(i.data))}setLightmapped(t){t?this.mask=-6&(2|this.mask):(this.deleteParameter("texture_lightMap"),this.deleteParameter("texture_dirLightMap"),this._shaderDefs&=-65,this.mask=-7&(1|this.mask))}setOverrideAabb(t){this._updateAabb=!t,t&&this.aabb.copy(t),this._setupSkinUpdate()}_setupSkinUpdate(){this._skinInstance&&(this._skinInstance._updateBeforeCull=this._updateAabb)}}function ke(t,e,i,n){return(15&t)<<27|(3===e?1:0)<<26|(i?1:0)<<25|(33554431&n)<<0}class De extends be{constructor(t,e){super(),this.device=e||qd.getApplication().graphicsDevice,this._targets=t,this.device.supportsMorphTargetTexturesCore&&(this.device.extTextureHalfFloat&&this.device.textureHalfFloatRenderable?this._renderTextureFormat=De.FORMAT_HALF_FLOAT:this.device.extTextureFloat&&this.device.textureFloatRenderable&&(this._renderTextureFormat=De.FORMAT_FLOAT),this.device.extTextureHalfFloat&&this.device.textureHalfFloatUpdatable?this._textureFormat=De.FORMAT_HALF_FLOAT:this.device.extTextureFloat&&(this._textureFormat=De.FORMAT_FLOAT),void 0!==this._renderTextureFormat&&void 0!==this._textureFormat&&(this._useTextureMorph=!0)),this._init(),this._updateMorphFlags(),this._calculateAabb()}get morphPositions(){return this._morphPositions}get morphNormals(){return this._morphNormals}get maxActiveTargets(){return this._useTextureMorph?this._targets.length:this._morphPositions&&this._morphNormals?4:8}get useTextureMorph(){return this._useTextureMorph}_init(){var t;if(this._useTextureMorph&&(this._useTextureMorph=this._initTextureBased()),!this._useTextureMorph)for(t=0;t<this._targets.length;t++)this._targets[t]._initVertexBuffers(this.device);for(t=0;t<this._targets.length;t++)this._targets[t]._postInit()}_initTextureBased(){var t,e,i,n=[],r=[];for(e=0;e<this._targets.length;e++)(t=this._targets[e]).options.deltaPositions&&(n.push(t.options.deltaPositions),r.push({target:t,name:"texturePositions"})),t.options.deltaNormals&&(n.push(t.options.deltaNormals),r.push({target:t,name:"textureNormals"}));var s,a,o=[],l=[],h=1,c=n[0].length;for(i=0;i<c;i+=3){for(s=!1,e=0;e<n.length;e++)if(0!==(a=n[e])[i]||0!==a[i+1]||0!==a[i+2]){s=!0;break}s?(o.push(h),l.push(i/3),h++):o.push(0)}var u=Math.min(this.device.maxTextureSize,4096),d=Math.ceil(Math.sqrt(h));d=Math.min(d,u);var f=Math.ceil(h/d);if(f>u)return!1;this.morphTextureWidth=d,this.morphTextureHeight=f;var p=!1,m=3,g=k.float2Half;this._textureFormat===De.FORMAT_HALF_FLOAT&&(p=!0,m=4);var v=this.morphTextureWidth*this.morphTextureHeight*m,_=p?new Uint16Array(v):new Float32Array(v);for(e=0;e<n.length;e++){for(a=n[e],i=0;i<l.length;i++){var y=l[i];p?(_[i*m+m]=g(a[3*y]),_[i*m+m+1]=g(a[3*y+1]),_[i*m+m+2]=g(a[3*y+2])):(_[i*m+m]=a[3*y],_[i*m+m+1]=a[3*y+1],_[i*m+m+2]=a[3*y+2])}t=r[e].target;var b=this._textureFormat===De.FORMAT_FLOAT?13:12;t._setTexture(r[e].name,this._createTexture("MorphTarget",b,_))}var x=[{semantic:"ATTR15",components:1,type:6}];return this.vertexBufferIds=new _t(this.device,new bt(this.device,x),o.length,0,new Float32Array(o)),!0}destroy(){this.vertexBufferIds&&(this.vertexBufferIds.destroy(),this.vertexBufferIds=null);for(var t=0;t<this._targets.length;t++)this._targets[t].destroy();this._targets.length=0}getTarget(t){return this._targets[t]}_updateMorphFlags(){var t;this._morphPositions=!1,this._morphNormals=!1;for(var e=0;e<this._targets.length;e++)(t=this._targets[e]).morphPositions&&(this._morphPositions=!0),t.morphNormals&&(this._morphNormals=!0)}_calculateAabb(){var t;this.aabb=new st(new H(0,0,0),new H(0,0,0));for(var e=0;e<this._targets.length;e++)t=this._targets[e],this.aabb._expand(t.aabb.getMin(),t.aabb.getMax())}_createTexture(t,e,i){var n=new pe(this.device,{width:this.morphTextureWidth,height:this.morphTextureHeight,format:e,cubemap:!1,mipmaps:!1,minFilter:0,magFilter:0,addressU:1,addressV:1});(n.name=t,i)&&(n.lock().set(i),n.unlock());return n}}De.FORMAT_FLOAT=0,De.FORMAT_HALF_FLOAT=1;class Oe{constructor(t){this.morph=t,t.incRefCount(),this.device=t.device,this.meshInstance=null,this._weights=[];for(var e=0;e<t._targets.length;e++)this.setWeight(e,t._targets[e].defaultWeight);if(this._activeTargets=[],t.useTextureMorph){this.shaderCache={},this.maxSubmitCount=this.device.maxTextures,this._shaderMorphWeights=new Float32Array(this.maxSubmitCount);var i=function(e,i){var n=t._renderTextureFormat===De.FORMAT_FLOAT?14:12;return this[i]=t._createTexture(e,n),new Cf({colorBuffer:this[i],depth:!1})}.bind(this);t.morphPositions&&(this.rtPositions=i("MorphRTPos","texturePositions")),t.morphNormals&&(this.rtNormals=i("MorphRTNrm","textureNormals")),this._textureParams=new Float32Array([t.morphTextureWidth,t.morphTextureHeight,1/t.morphTextureWidth,1/t.morphTextureHeight]);for(var n=0;n<this.maxSubmitCount;n++)this["morphBlendTex"+n]=this.device.scope.resolve("morphBlendTex"+n);this.morphFactor=this.device.scope.resolve("morphFactor[0]"),this.zeroTextures=!1}else this.maxSubmitCount=8,this._shaderMorphWeights=new Float32Array(this.maxSubmitCount),this._shaderMorphWeightsA=new Float32Array(this._shaderMorphWeights.buffer,0,4),this._shaderMorphWeightsB=new Float32Array(this._shaderMorphWeights.buffer,16,4),this._activeVertexBuffers=new Array(this.maxSubmitCount)}destroy(){this.meshInstance=null,this.shader=null;let t=this.morph;t&&(this.morph=null,t.decRefCount(),t.getRefCount()<1&&t.destroy()),this.rtPositions&&(this.rtPositions.destroy(),this.rtPositions=null),this.texturePositions&&(this.texturePositions.destroy(),this.texturePositions=null),this.rtNormals&&(this.rtNormals.destroy(),this.rtNormals=null),this.textureNormals&&(this.textureNormals.destroy(),this.textureNormals=null)}clone(){return new Oe(this.morph)}getWeight(t){return this._weights[t]}setWeight(t,e){this._weights[t]=e,this._dirty=!0}_getFragmentShader(t){var e,i="";for(t>0&&(i+="varying vec2 uv0;\nuniform highp float morphFactor["+t+"];\n"),e=0;e<t;e++)i+="uniform highp sampler2D morphBlendTex"+e+";\n";for(i+="void main (void) {\n\t\thighp vec4 color = vec4(0, 0, 0, 1);\n",e=0;e<t;e++)i+="\t\tcolor.xyz += morphFactor["+e+"] * texture2D(morphBlendTex"+e+", uv0).xyz;\n";return i+="\t\tgl_FragColor = color;\n}\n"}_getShader(t){var e=this.shaderCache[t];if(!e){var i=this._getFragmentShader(t);e=Jt(this.device,"attribute vec2 vertex_position;\nvarying vec2 uv0;\nvoid main(void) {\n\t\tgl_Position = vec4(vertex_position, 0.5, 1.0);\n\t\tuv0 = vertex_position.xy * 0.5 + 0.5;\n}\n",i,"textureMorph"+t),this.shaderCache[t]=e}return e}_updateTextureRenderTarget(t,e){for(var i=this.device,n=function(e,n){this.morphFactor.setValue(this._shaderMorphWeights),i.setBlending(n),n&&(i.setBlendFunction(1,1),i.setBlendEquation(0));var r=this._getShader(e);zt(i,t,r,void 0,void 0,n)}.bind(this),r=0,s=!1,a=this._activeTargets.length,o=0;o<a;o++){var l=this._activeTargets[o],h=l.target[e];h&&(this["morphBlendTex"+r].setValue(h),this._shaderMorphWeights[r]=l.weight,++r>=this.maxSubmitCount&&(n(r,s),r=0,s=!0))}(r>0||0===a&&!this.zeroTextures)&&n(r,s)}_updateTextureMorph(){this.device;(this._activeTargets.length>0||!this.zeroTextures)&&(this._updateTextureRenderTarget(this.rtPositions,"texturePositions"),this._updateTextureRenderTarget(this.rtNormals,"textureNormals"),this.zeroTextures=0===this._activeTargets.length)}_updateVertexMorph(){var t,e=this.maxSubmitCount;for(t=0;t<e;t++)this._shaderMorphWeights[t]=0,this._activeVertexBuffers[t]=null;var i,n=0,r=this.morph.morphPositions?4:0;for(t=0;t<this._activeTargets.length;t++)(i=this._activeTargets[t].target)._vertexBufferPositions&&(this._activeVertexBuffers[n]=i._vertexBufferPositions,this._shaderMorphWeights[n]=this._activeTargets[t].weight,n++),i._vertexBufferNormals&&(this._activeVertexBuffers[r]=i._vertexBufferNormals,this._shaderMorphWeights[r]=this._activeTargets[t].weight,r++)}update(){this._dirty=!1;var t,e,i,n=this.morph._targets,r=0;for(e=0;e<n.length;e++)(i=Math.abs(this.getWeight(e)))>1e-5&&(this._activeTargets.length<=r&&(this._activeTargets[r]={}),(t=this._activeTargets[r++]).absWeight=i,t.weight=this.getWeight(e),t.target=n[e]);this._activeTargets.length=r;var s=this.morph.maxActiveTargets;this._activeTargets.length>s&&(this._activeTargets.sort((function(t,e){return t.absWeight<e.absWeight?1:e.absWeight<t.absWeight?-1:0})),this._activeTargets.length=s),this.morph.useTextureMorph?this._updateTextureMorph():this._updateVertexMorph()}}var Re=new Q;class Le{constructor(t){this._dirty=!0,this._skinUpdateIndex=-1,this._updateBeforeCull=!0,t&&this.initSkin(t)}init(t,e){if(t.supportsBoneTextures){var i=3*e,n=Math.ceil(Math.sqrt(i));n=k.roundUp(n,3);var r=Math.ceil(i/n);this.boneTexture=new pe(t,{width:n,height:r,format:14,mipmaps:!1,minFilter:0,magFilter:0}),this.boneTexture.name="skin",this.matrixPalette=this.boneTexture.lock()}else this.matrixPalette=new Float32Array(12*e)}destroy(){this.boneTexture&&(this.boneTexture.destroy(),this.boneTexture=null)}initSkin(t){this.skin=t,this.bones=[];var e=t.inverseBindPose.length;this.init(t.device,e),this.matrices=[];for(var i=0;i<e;i++)this.matrices[i]=new Q}uploadBones(t){t.supportsBoneTextures&&(this.boneTexture.lock(),this.boneTexture.unlock())}_updateMatrices(t,e){if(this._skinUpdateIndex!==e){this._skinUpdateIndex=e,Re.copy(t.getWorldTransform()).invert();for(var i=this.bones.length-1;i>=0;i--)this.matrices[i].mulAffine2(Re,this.bones[i].getWorldTransform()),this.matrices[i].mulAffine2(this.matrices[i],this.skin.inverseBindPose[i])}}updateMatrices(t,e){this._updateBeforeCull&&this._updateMatrices(t,e)}updateMatrixPalette(t,e){var i;this._updateMatrices(t,e);for(var n,r=this.matrixPalette,s=this.bones.length,a=0;a<s;a++)i=this.matrices[a].data,r[n=12*a]=i[0],r[n+1]=i[4],r[n+2]=i[8],r[n+3]=i[12],r[n+4]=i[1],r[n+5]=i[5],r[n+6]=i[9],r[n+7]=i[13],r[n+8]=i[2],r[n+9]=i[6],r[n+10]=i[10],r[n+11]=i[14];this.uploadBones(this.skin.device)}}class Ne{constructor(){this.graph=null,this.meshInstances=[],this.skinInstances=[],this.morphInstances=[],this.cameras=[],this.lights=[],this._shadersVersion=0,this._immutable=!1}getGraph(){return this.graph}setGraph(t){this.graph=t}getCameras(){return this.cameras}setCameras(t){this.cameras=t}getLights(){return this.lights}setLights(t){this.lights=t}getMaterials(){var t,e=[];for(t=0;t<this.meshInstances.length;t++){var i=this.meshInstances[t];-1===e.indexOf(i.material)&&e.push(i.material)}return e}clone(){var t,e,i=[],n=[],r=function t(e){var r=e.clone();i.push(e),n.push(r);for(var s=0;s<e._children.length;s++)r.addChild(t(e._children[s]));return r}(this.graph),s=[],a=[],o=[];for(t=0;t<this.skinInstances.length;t++){var l=this.skinInstances[t].skin,h=new Le(l),c=[];for(e=0;e<l.boneNames.length;e++){var u=l.boneNames[e],d=r.findByName(u);c.push(d)}h.bones=c,a.push(h)}for(t=0;t<this.morphInstances.length;t++){var f=this.morphInstances[t].morph,p=new Oe(f);o.push(p)}for(t=0;t<this.meshInstances.length;t++){var m=this.meshInstances[t],g=i.indexOf(m.node),v=new Ee(n[g],m.mesh,m.material);if(m.skinInstance){var _=this.skinInstances.indexOf(m.skinInstance);v.skinInstance=a[_]}if(m.morphInstance){var y=this.morphInstances.indexOf(m.morphInstance);v.morphInstance=o[y]}s.push(v)}var b=new Ne;return b.graph=r,b.meshInstances=s,b.skinInstances=a,b.morphInstances=o,b.getGraph().syncHierarchy(),b}destroy(){for(var t=this.meshInstances,e=0;e<t.length;e++)t[e].destroy();this.meshInstances.length=0}generateWireframe(){var t,e,i=[];for(t=0;t<this.meshInstances.length;t++)e=this.meshInstances[t].mesh,-1===i.indexOf(e)&&i.push(e);for(t=0;t<i.length;++t)(e=i[t]).primitive[1]||e.generateWireframe()}}class ze{constructor(t,e,i){this.origMeshInstances=t,this._aabb=new st,this.meshInstance=null,this.model=null,this.dynamic=e,this.batchGroupId=i}}class Be{constructor(t,e,i,n,r=[0]){this.dynamic=i,this.maxAabbSize=n,this.id=t,this.name=e,this.layers=r,this._ui=!1,this._sprite=!1,this._obj={model:[],element:[],sprite:[],render:[]}}}Be.MODEL="model",Be.ELEMENT="element",Be.SPRITE="sprite",Be.RENDER="render";class Fe extends Le{constructor(t,e,i){super();var n=e.length;this.init(t,n),this.device=t,this.rootNode=i,this.bones=e}updateMatrices(t,e){}updateMatrixPalette(t,e){for(var i,n,r=this.matrixPalette,s=this.bones.length,a=0;a<s;a++)i=this.bones[a].getWorldTransform().data,r[n=12*a]=i[0],r[n+1]=i[4],r[n+2]=i[8],r[n+3]=i[12],r[n+4]=i[1],r[n+5]=i[5],r[n+6]=i[9],r[n+7]=i[13],r[n+8]=i[2],r[n+9]=i[6],r[n+10]=i[10],r[n+11]=i[14];this.uploadBones(this.device)}}function je(t,e){if(t&&!e)return!1;if(!t&&e)return!1;if((t=t.data)===(e=e.data))return!0;if(t instanceof Float32Array&&e instanceof Float32Array){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Ve(t,e){var i;for(i in t)if(t.hasOwnProperty(i)&&!je(t[i],e[i]))return!1;for(i in e)if(e.hasOwnProperty(i)&&!je(e[i],t[i]))return!1;return!0}function Ue(t,e){var i;for(i=0;i<t.length;i++)if(e.indexOf(t[i])<0)return!1;for(i=0;i<e.length;i++)if(t.indexOf(e[i])<0)return!1;return!0}var Ge=new H,We=new H,He=new H;function Xe(t){var e=t.node.worldTransform;return e.getX(Ge),e.getY(We),e.getZ(He),Ge.cross(Ge,We),Ge.dot(He)>=0?1:-1}class Ze{constructor(t,e,i){this.device=t,this.rootNode=e,this.scene=i,this._init=!1,this._batchGroups={},this._batchGroupCounter=0,this._batchList=[],this._dirtyGroups=[]}destroyManager(){this.device=null,this.rootNode=null,this.scene=null,this._batchGroups={},this._batchList=[],this._dirtyGroups=[]}addGroup(t,e,i,n,r){var s;if(void 0===n&&(n=this._batchGroupCounter,this._batchGroupCounter++),!this._batchGroups[n])return this._batchGroups[n]=s=new Be(n,t,e,i,r),s}removeGroup(t){if(this._batchGroups[t]){for(var e=[],i=0;i<this._batchList.length;i++)this._batchList[i].batchGroupId===t?this.destroy(this._batchList[i]):e.push(this._batchList[i]);this._batchList=e,this._removeModelsFromBatchGroup(this.rootNode,t),delete this._batchGroups[t]}}markGroupDirty(t){this._dirtyGroups.indexOf(t)<0&&this._dirtyGroups.push(t)}getGroupByName(t){var e=this._batchGroups;for(var i in e)if(e.hasOwnProperty(i)&&e[i].name===t)return e[i];return null}getBatches(t){for(var e=[],i=this._batchList.length,n=0;n<i;n++){var r=this._batchList[n];r.batchGroupId===t&&e.push(r)}return e}_removeModelsFromBatchGroup(t,e){if(t.enabled){t.model&&t.model.batchGroupId===e&&(t.model.batchGroupId=-1),t.render&&t.render.batchGroupId===e&&(t.render.batchGroupId=-1),t.element&&t.element.batchGroupId===e&&(t.element.batchGroupId=-1),t.sprite&&t.sprite.batchGroupId===e&&(t.sprite.batchGroupId=-1);for(var i=0;i<t._children.length;i++)this._removeModelsFromBatchGroup(t._children[i],e)}}insert(t,e,i){var n=this._batchGroups[e];n&&n._obj[t].indexOf(i)<0&&(n._obj[t].push(i),this.markGroupDirty(e))}remove(t,e,i){var n=this._batchGroups[e];if(n){var r=n._obj[t].indexOf(i);r>=0&&(n._obj[t].splice(r,1),this.markGroupDirty(e))}}_extractRender(t,e,i,n){if(t.render){if(t.render.isStatic){var r,s=this.scene.drawCalls,a=t.render.meshInstances;for(r=0;r<s.length;r++)s[r]._staticSource&&(a.indexOf(s[r]._staticSource)<0||e.push(s[r]));for(r=0;r<a.length;r++)s.indexOf(a[r])>=0&&e.push(a[r])}else e=n[t.render.batchGroupId]=e.concat(t.render.meshInstances);t.render.removeFromLayers()}return e}_extractModel(t,e,i,n){if(t.model&&t.model.model){var r;if(t.model.isStatic){var s=this.scene.drawCalls,a=t.model.meshInstances;for(r=0;r<s.length;r++)s[r]._staticSource&&(a.indexOf(s[r]._staticSource)<0||e.push(s[r]));for(r=0;r<a.length;r++)s.indexOf(a[r])>=0&&e.push(a[r])}else e=n[t.model.batchGroupId]=e.concat(t.model.meshInstances);t.model.removeModelFromLayers()}return e}_extractElement(t,e,i){if(t.element){var n=!1;t.element._text&&t.element._text._model.meshInstances.length>0?(e.push(t.element._text._model.meshInstances[0]),t.element.removeModelFromLayers(t.element._text._model),n=!0):t.element._image&&(e.push(t.element._image._renderable.meshInstance),t.element.removeModelFromLayers(t.element._image._renderable.model),t.element._image._renderable.unmaskMeshInstance&&(e.push(t.element._image._renderable.unmaskMeshInstance),t.element._image._renderable.unmaskMeshInstance.stencilFront&&t.element._image._renderable.unmaskMeshInstance.stencilBack||(t.element._dirtifyMask(),t.element._onPrerender())),n=!0),n&&(i._ui=!0)}}_collectAndRemoveMeshInstances(t,e){for(var i,n,r,s,a=0;a<e.length;a++)if(s=e[a],n=this._batchGroups[s]){(r=t[s])||(r=t[s]=[]);for(var o=0;o<n._obj.model.length;o++)r=this._extractModel(n._obj.model[o],r,n,t);for(var l=0;l<n._obj.render.length;l++)r=this._extractRender(n._obj.render[l],r,n,t);for(var h=0;h<n._obj.element.length;h++)this._extractElement(n._obj.element[h],r,n);for(var c=0;c<n._obj.sprite.length;c++)(i=n._obj.sprite[c]).sprite&&i.sprite._meshInstance&&(n.dynamic||0===i.sprite.sprite._renderMode)&&(r.push(i.sprite._meshInstance),i.sprite.removeModelFromLayers(),n._sprite=!0,i.sprite._batchGroup=n)}}generate(t){var e,i,n={};t||(t=Object.keys(this._batchGroups));var r,s,a,o,l=[];for(e=0;e<this._batchList.length;e++)t.indexOf(this._batchList[e].batchGroupId)<0?l.push(this._batchList[e]):this.destroy(this._batchList[e]);if(this._batchList=l,this._collectAndRemoveMeshInstances(n,t),t===this._dirtyGroups)this._dirtyGroups.length=0;else{var h=[];for(e=0;e<this._dirtyGroups.length;e++)t.indexOf(this._dirtyGroups[e])<0&&h.push(this._dirtyGroups[e]);this._dirtyGroups=h}for(var c in n)if(n.hasOwnProperty(c)&&(r=n[c],a=this._batchGroups[c]))for(s=this.prepare(r,a.dynamic,a.maxAabbSize,a._ui||a._sprite),e=0;e<s.length;e++)if(o=this.create(s[e],a.dynamic,parseInt(c,10)))for(i=0;i<a.layers.length;i++){var u=this.scene.layers.getLayerById(a.layers[i]);u&&u.addMeshInstances(o.model.meshInstances)}}prepare(t,e,i=Number.POSITIVE_INFINITY,n){if(0===t.length)return[];var r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y=.5*i,b=this.device.supportsBoneTextures?1024:this.device.boneLimit,x=this.device.extUintElement?4294967295:65535,w=new st,A=new st,C=null,I=[],S=0;n&&t.sort((function(t,e){return t.drawOrder-e.drawOrder}));for(var M,T=t,P=n?function(t){C?C.add(t.aabb):C=t.aabb.clone(),M.push(t)}:function(t){M.push(t)};T.length>0;){for(I[S]=[T[0]],M=[],r=T[0].material,s=T[0].layer,h=T[0]._shaderDefs,o=T[0].parameters,c=T[0].stencilFront,l=T[0]._staticLightList,a=T[0].mesh.vertexBuffer.getNumVertices(),f=T[0].drawOrder,w.copy(T[0].aabb),d=Xe(T[0]),m=T[0].mesh.vertexBuffer.format.batchingHash,p=T[0].mesh.primitive[0].indexed,C=null,_=1;_<T.length;_++){if(g=T[_],e&&I[S].length>=b){M=M.concat(T.slice(_));break}if(r!==g.material||s!==g.layer||m!==g.mesh.vertexBuffer.format.batchingHash||p!==g.mesh.primitive[0].indexed||h!==g._shaderDefs||a+g.mesh.vertexBuffer.getNumVertices()>x)P(g);else if(A.copy(w),A.add(g.aabb),A.halfExtents.x>y||A.halfExtents.y>y||A.halfExtents.z>y)P(g);else if(!c||(v=g.stencilFront)&&c.func==v.func&&c.zpass==v.zpass)if(d==Xe(g))if(Ve(o,g.parameters)){if(u=g._staticLightList,l&&u){if(!Ue(l,u)){P(g);continue}}else if(l||u){P(g);continue}n&&C&&C.intersects(g.aabb)&&g.drawOrder!==f?P(g):(w.add(g.aabb),a+=g.mesh.vertexBuffer.getNumVertices(),I[S].push(g))}else P(g);else P(g);else P(g)}S++,T=M}return I}create(t,e,i){if(!this._init){var n="#define BONE_LIMIT "+this.device.getBoneLimit()+"\n";this.transformVS=n+"#define DYNAMICBATCH\n"+Ft.transformVS,this.skinTexVS=Ft.skinBatchTexVS,this.skinConstVS=Ft.skinBatchConstVS,this.vertexFormats={},this._init=!0}var r,s,a,o,l,h,c,u=null,d=null,f=0,p=0,m=null;for(r=0;r<t.length;r++)if(t[r].visible&&(f+=c=(l=t[r].mesh).vertexBuffer.numVertices,p+=l.primitive[0].indexed?l.primitive[0].count:6==l.primitive[0].type&&4===l.primitive[0].count?6:0,!u)){for(d=t[r].material,u={},h=l.vertexBuffer.format.elements,s=0;s<h.length;s++)u[o=h[s].name]={numComponents:h[s].numComponents,dataType:h[s].dataType,normalize:h[s].normalize,count:0};e&&(u.BLENDINDICES={numComponents:1,dataType:6,normalize:!1,count:0})}if(u){var g,v,_;m=new ze(t,e,i),this._batchList.push(m);var y,b=0,x=0,w=new H,A=new(f<=65535?Uint16Array:Uint32Array)(p);for(o in u)(a=u[o]).typeArrayType=ft[a.dataType],a.elementByteSize=pt[a.dataType],a.buffer=new a.typeArrayType(f*a.numComponents);for(r=0;r<t.length;r++)if(t[r].visible){for(o in c=(l=t[r].mesh).vertexBuffer.numVertices,e||(y=t[r].node.getWorldTransform()),u)if("BLENDINDICES"!==o){var C=new(a=u[o]).typeArrayType(a.buffer.buffer,a.elementByteSize*a.count),I=l.getVertexStream(o,C)*a.numComponents;if(a.count+=I,!e&&a.numComponents>=3&&("POSITION"==o||"NORMAL"==o||"TANGENT"==o))for(y.transformFunction="POSITION"==o?Q.prototype.transformPoint:Q.prototype.transformVector,s=0;s<I;s+=a.numComponents)w.set(C[s],C[s+1],C[s+2]),y.transformFunction(w,w),C[s]=w.x,C[s+1]=w.y,C[s+2]=w.z}if(e)for(a=u.BLENDINDICES,s=0;s<c;s++)a.buffer[a.count++]=r;if(l.primitive[0].indexed){g=l.primitive[0].base,v=l.primitive[0].count;var S=l.indexBuffer[0].getFormat();_=new mt[S](l.indexBuffer[0].storage)}else{if(6!=l.primitive[0].type||4!==l.primitive[0].count){v=0;continue}g=0,v=6,_=[0,1,3,2,3,1]}for(s=0;s<v;s++)A[s+x]=_[g+s]+b;x+=v,b+=c}for(o in l=new Ie(this.device),u)a=u[o],l.setVertexStream(o,a.buffer,a.numComponents,void 0,a.dataType,a.normalize);A.length>0&&l.setIndices(A),l.update(4,!1),e&&((d=d.clone()).chunks.transformVS=this.transformVS,d.chunks.skinTexVS=this.skinTexVS,d.chunks.skinConstVS=this.skinConstVS,d.update());var M=new Ee(this.rootNode,l,d);M.castShadow=m.origMeshInstances[0].castShadow,M.parameters=m.origMeshInstances[0].parameters,M.isStatic=m.origMeshInstances[0].isStatic,M.layer=m.origMeshInstances[0].layer,M._staticLightList=m.origMeshInstances[0]._staticLightList,M._shaderDefs=m.origMeshInstances[0]._shaderDefs,M.cull=m.origMeshInstances[0].cull;var T=this._batchGroups[i];if(T&&T._ui&&(M.cull=!1),e){var P=[];for(r=0;r<m.origMeshInstances.length;r++)P.push(m.origMeshInstances[r].node);M.skinInstance=new Fe(this.device,P,this.rootNode)}M._updateAabb=!1,M.drawOrder=m.origMeshInstances[0].drawOrder,M.stencilFront=m.origMeshInstances[0].stencilFront,M.stencilBack=m.origMeshInstances[0].stencilBack,M.flipFaces=Xe(m.origMeshInstances[0])<0,m.meshInstance=M,this.update(m);var E=new Ne;E.meshInstances=[m.meshInstance],E.castShadows=m.origMeshInstances[0].castShadows,m.model=E}return m}update(t){t._aabb.copy(t.origMeshInstances[0].aabb);for(var e=1;e<t.origMeshInstances.length;e++)t._aabb.add(t.origMeshInstances[e].aabb);t.meshInstance.aabb=t._aabb,t._aabb._radiusVer=-1,t.meshInstance._aabbVer=0}updateAll(){this._dirtyGroups.length>0&&this.generate(this._dirtyGroups);for(var t=0;t<this._batchList.length;t++)this._batchList[t].dynamic&&this.update(this._batchList[t])}clone(t,e){var i=new ze(e,t.dynamic,t.batchGroupId);this._batchList.push(i);for(var n=[],r=0;r<e.length;r++)n.push(e[r].node);i.meshInstance=new Ee(t.meshInstance.node,t.meshInstance.mesh,t.meshInstance.material),i.meshInstance._updateAabb=!1,i.meshInstance.parameters=e[0].parameters,i.meshInstance.isStatic=e[0].isStatic,i.meshInstance.cull=e[0].cull,i.meshInstance.layer=e[0].layer,i.meshInstance._staticLightList=e[0]._staticLightList,t.dynamic&&(i.meshInstance.skinInstance=new Fe(this.device,n,this.rootNode)),i.meshInstance.castShadow=t.meshInstance.castShadow,i.meshInstance._shader=t.meshInstance._shader;var s=new Ne;return s.meshInstances=[i.meshInstance],s.castShadows=t.origMeshInstances[0].castShadows,i.model=s,i}destroy(t){if(t.model){for(var e=this._batchGroups[t.batchGroupId].layers,i=0;i<e.length;i++){var n=this.scene.layers.getLayerById(e[i]);n&&n.removeMeshInstances(t.model.meshInstances)}t.model.destroy()}}}var Ye=new H,qe=new H,Ke=new H,Je=new Q;class Qe{constructor(){this._aspectRatio=16/9,this._aspectRatioMode=0,this._calculateProjection=null,this._calculateTransform=null,this._clearColor=new D(.75,.75,.75,1),this._clearColorBuffer=!0,this._clearDepth=1,this._clearDepthBuffer=!0,this._clearStencil=0,this._clearStencilBuffer=!0,this._cullingMask=4294967295,this._cullFaces=!0,this._farClip=1e3,this._flipFaces=!1,this._fov=45,this._frustumCulling=!0,this._horizontalFov=!1,this._layers=[0,1,2,4,3],this._nearClip=.1,this._node=null,this._orthoHeight=10,this._projection=0,this._rect=new X(0,0,1,1),this._renderTarget=null,this._scissorRect=new X(0,0,1,1),this._vrDisplay=null,this._projMat=new Q,this._projMatDirty=!0,this._projMatSkybox=new Q,this._viewMat=new Q,this._viewMatDirty=!0,this._viewProjMat=new Q,this._viewProjMatDirty=!0,this.frustum=new ut}get aspectRatio(){return this._aspectRatio}set aspectRatio(t){this._aspectRatio!==t&&(this._aspectRatio=t,this._projMatDirty=!0)}get aspectRatioMode(){return this._aspectRatioMode}set aspectRatioMode(t){this._aspectRatioMode!==t&&(this._aspectRatioMode=t,this._projMatDirty=!0)}get calculateProjection(){return this._calculateProjection}set calculateProjection(t){this._calculateProjection=t,this._projMatDirty=!0}get calculateTransform(){return this._calculateTransform}set calculateTransform(t){this._calculateTransform=t}get clearColor(){return this._clearColor}set clearColor(t){this._clearColor.copy(t)}get clearColorBuffer(){return this._clearColorBuffer}set clearColorBuffer(t){this._clearColorBuffer=t}get clearDepth(){return this._clearDepth}set clearDepth(t){this._clearDepth=t}get clearDepthBuffer(){return this._clearDepthBuffer}set clearDepthBuffer(t){this._clearDepthBuffer=t}get clearStencil(){return this._clearStencil}set clearStencil(t){this._clearStencil=t}get clearStencilBuffer(){return this._clearStencilBuffer}set clearStencilBuffer(t){this._clearStencilBuffer=t}get cullingMask(){return this._cullingMask}set cullingMask(t){this._cullingMask=t}get cullFaces(){return this._cullFaces}set cullFaces(t){this._cullFaces=t}get farClip(){return this._farClip}set farClip(t){this._farClip!==t&&(this._farClip=t,this._projMatDirty=!0)}get flipFaces(){return this._flipFaces}set flipFaces(t){this._flipFaces=t}get fov(){return this._fov}set fov(t){this._fov!==t&&(this._fov=t,this._projMatDirty=!0)}get frustumCulling(){return this._frustumCulling}set frustumCulling(t){this._frustumCulling=t}get horizontalFov(){return this._horizontalFov}set horizontalFov(t){this._horizontalFov!==t&&(this._horizontalFov=t,this._projMatDirty=!0)}get layers(){return this._layers}set layers(t){this._layers=t.slice(0)}get nearClip(){return this._nearClip}set nearClip(t){this._nearClip!==t&&(this._nearClip=t,this._projMatDirty=!0)}get node(){return this._node}set node(t){this._node=t}get orthoHeight(){return this._orthoHeight}set orthoHeight(t){this._orthoHeight!==t&&(this._orthoHeight=t,this._projMatDirty=!0)}get projection(){return this._projection}set projection(t){this._projection!==t&&(this._projection=t,this._projMatDirty=!0)}get projectionMatrix(){return this._evaluateProjectionMatrix(),this._projMat}get rect(){return this._rect}set rect(t){this._rect.copy(t)}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t}get scissorRect(){return this._scissorRect}set scissorRect(t){this._scissorRect.copy(t)}get viewMatrix(){if(this._viewMatDirty){var t=this._node.getWorldTransform();this._viewMat.copy(t).invert(),this._viewMatDirty=!1}return this._viewMat}get vrDisplay(){return this._vrDisplay}set vrDisplay(t){this._vrDisplay=t,t&&(t._camera=this)}clone(){return(new this.constructor).copy(this)}copy(t){this.aspectRatio=t.aspectRatio,this.aspectRatioMode=t.aspectRatioMode,this.calculateProjection=t.calculateProjection,this.calculateTransform=t.calculateTransform,this.clearColor=t.clearColor,this.clearColorBuffer=t.clearColorBuffer,this.clearDepth=t.clearDepth,this.clearDepthBuffer=t.clearDepthBuffer,this.clearStencil=t.clearStencil,this.clearStencilBuffer=t.clearStencilBuffer,this.cullFaces=t.cullFaces,this.cullingMask=t.cullingMask,this.farClip=t.farClip,this.flipFaces=t.flipFaces,this.fov=t.fov,this.frustumCulling=t.frustumCulling,this.horizontalFov=t.horizontalFov,this.layers=t.layers,this.nearClip=t.nearClip,this.orthoHeight=t.orthoHeight,this.projection=t.projection,this.rect=t.rect,this.renderTarget=t.renderTarget,this.scissorRect=t.scissorRect,this.vrDisplay=t.vrDisplay}_updateViewProjMat(){if(this._projMatDirty||this._viewMatDirty||this._viewProjMatDirty){var t=this.projectionMatrix,e=this.viewMatrix;this._viewProjMat.mul2(t,e),this._viewProjMatDirty=!1}}worldToScreen(t,e,i,n=new H){this._updateViewProjMat(),this._viewProjMat.transformPoint(t,n);var r=this._viewProjMat.data,s=t.x*r[3]+t.y*r[7]+t.z*r[11]+1*r[15];return n.x=.5*(n.x/s+1)*e,n.y=.5*(1-n.y/s)*i,n}screenToWorld(t,e,i,n,r,s=new H){var a=this._farClip-this._nearClip;if(Ye.set(t/n,(r-e)/r,i/a),Ye.scale(2),Ye.sub(H.ONE),0===this._projection){Q._getPerspectiveHalfSize(qe,this._fov,this._aspectRatio,this._nearClip,this._horizontalFov),qe.x*=Ye.x,qe.y*=Ye.y;var o=this._node.getWorldTransform();qe.z=-this._nearClip,o.transformPoint(qe,Ke);var l=this._node.getPosition();s.sub2(Ke,l),s.normalize(),s.scale(i),s.add(l)}else this._updateViewProjMat(),Je.copy(this._viewProjMat).invert(),Je.transformPoint(Ye,s);return s}_evaluateProjectionMatrix(){if(this._projMatDirty){if(0===this._projection)this._projMat.setPerspective(this._fov,this._aspectRatio,this._nearClip,this._farClip,this._horizontalFov),this._projMatSkybox.copy(this._projMat);else{var t=this._orthoHeight,e=t*this._aspectRatio;this._projMat.setOrtho(-e,e,-t,t,this._nearClip,this._farClip),this._projMatSkybox.setPerspective(this._fov,this._aspectRatio,this._nearClip,this._farClip)}this._projMatDirty=!1}}getProjectionMatrixSkybox(){return this._evaluateProjectionMatrix(),this._projMatSkybox}}var $e,ti,ei,ii,ni=new Q,ri=new H,si=new $,ai=new $,oi=new H,li=new H,hi=new Q,ci=new $,ui=new H,di=new Q,fi=new $,pi=new $,mi=new Q,gi=new H,vi=new H;class _i extends v{constructor(t){super(),this.name="string"==typeof t?t:"Untitled",this.tags=new L(this),this._labels={},this.localPosition=new H(0,0,0),this.localRotation=new $(0,0,0,1),this.localScale=new H(1,1,1),this.localEulerAngles=new H(0,0,0),this.position=new H(0,0,0),this.rotation=new $(0,0,0,1),this.eulerAngles=new H(0,0,0),this._scale=null,this.localTransform=new Q,this._dirtyLocal=!1,this._aabbVer=0,this._frozen=!1,this.worldTransform=new Q,this._dirtyWorld=!1,this.normalMatrix=new G,this._dirtyNormal=!0,this._right=null,this._up=null,this._forward=null,this._parent=null,this._children=[],this._graphDepth=0,this._enabled=!0,this._enabledInHierarchy=!1,this.scaleCompensation=!1}get right(){return this._right||(this._right=new H),this.getWorldTransform().getX(this._right).normalize()}get up(){return this._up||(this._up=new H),this.getWorldTransform().getY(this._up).normalize()}get forward(){return this._forward||(this._forward=new H),this.getWorldTransform().getZ(this._forward).normalize().scale(-1)}get enabled(){return this._enabled&&this._enabledInHierarchy}set enabled(t){this._enabled!==t&&(this._enabled=t,this._parent&&!this._parent.enabled||this._notifyHierarchyStateChanged(this,t))}get parent(){return this._parent}get path(){var t=this._parent;if(t){for(var e=this.name;t&&t._parent;)e=t.name+"/"+e,t=t._parent;return e}return""}get root(){var t=this._parent;if(!t)return this;for(;t._parent;)t=t._parent;return t}get children(){return this._children}get graphDepth(){return this._graphDepth}_notifyHierarchyStateChanged(t,e){t._onHierarchyStateChanged(e);for(var i=t._children,n=0,r=i.length;n<r;n++)i[n]._enabled&&this._notifyHierarchyStateChanged(i[n],e)}_onHierarchyStateChanged(t){this._enabledInHierarchy=t,t&&!this._frozen&&this._unfreezeParentToRoot()}_cloneInternal(t){t.name=this.name;for(var e=this.tags._list,i=0;i<e.length;i++)t.tags.add(e[i]);t._labels=Object.assign({},this._labels),t.localPosition.copy(this.localPosition),t.localRotation.copy(this.localRotation),t.localScale.copy(this.localScale),t.localEulerAngles.copy(this.localEulerAngles),t.position.copy(this.position),t.rotation.copy(this.rotation),t.eulerAngles.copy(this.eulerAngles),t.localTransform.copy(this.localTransform),t._dirtyLocal=this._dirtyLocal,t.worldTransform.copy(this.worldTransform),t._dirtyWorld=this._dirtyWorld,t._dirtyNormal=this._dirtyNormal,t._aabbVer=this._aabbVer+1,t._enabled=this._enabled,t.scaleCompensation=this.scaleCompensation,t._enabledInHierarchy=!1}clone(){var t=new _i;return this._cloneInternal(t),t}find(t,e){var i,n,r=[],s=this._children.length;if(t instanceof Function){var a=t;for(a(this)&&r.push(this),i=0;i<s;i++)(n=this._children[i].find(a)).length&&(r=r.concat(n))}else{for(this[t]&&(this[t]instanceof Function?this[t]():this[t])===e&&r.push(this),i=0;i<s;++i)(n=this._children[i].find(t,e)).length&&(r=r.concat(n))}return r}findOne(t,e){var i,n=this._children.length,r=null;if(t instanceof Function){var s=t;if(r=s(this))return this;for(i=0;i<n;i++)if(r=this._children[i].findOne(s))return r}else{if(this[t]&&(this[t]instanceof Function?this[t]():this[t])===e)return this;for(i=0;i<n;i++)if(null!==(r=this._children[i].findOne(t,e)))return r}return null}findByTag(){var t=this.tags._processArguments(arguments);return this._findByTag(t)}_findByTag(t){var e,i,n=[],r=this._children.length;for(e=0;e<r;e++)this._children[e].tags._has(t)&&n.push(this._children[e]),(i=this._children[e]._findByTag(t)).length&&(n=n.concat(i));return n}findByName(t){if(this.name===t)return this;for(var e=0;e<this._children.length;e++){var i=this._children[e].findByName(t);if(null!==i)return i}return null}findByPath(t){for(var e=t.split("/"),i=this,n=null,r=0,s=e.length;r<s&&i;r++){var a=e[r];n=null;for(var o=i._children,l=0,h=o.length;l<h;l++)if(o[l].name==a){n=o[l];break}i=n}return n}forEach(t,e){t.call(e,this);for(var i=this._children,n=0;n<i.length;n++)i[n].forEach(t,e)}isDescendantOf(t){for(var e=this._parent;e;){if(e===t)return!0;e=e._parent}return!1}isAncestorOf(t){return t.isDescendantOf(this)}getEulerAngles(){return this.getWorldTransform().getEulerAngles(this.eulerAngles),this.eulerAngles}getLocalEulerAngles(){return this.localRotation.getEulerAngles(this.localEulerAngles),this.localEulerAngles}getLocalPosition(){return this.localPosition}getLocalRotation(){return this.localRotation}getLocalScale(){return this.localScale}getLocalTransform(){return this._dirtyLocal&&(this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale),this._dirtyLocal=!1),this.localTransform}getPosition(){return this.getWorldTransform().getTranslation(this.position),this.position}getRotation(){return this.rotation.setFromMat4(this.getWorldTransform()),this.rotation}getScale(){return this._scale||(this._scale=new H),this.getWorldTransform().getScale(this._scale)}getWorldTransform(){return this._dirtyLocal||this._dirtyWorld?(this._parent&&this._parent.getWorldTransform(),this._sync(),this.worldTransform):this.worldTransform}reparent(t,e){var i=this._parent;i&&i.removeChild(this),t&&(e>=0?t.insertChild(this,e):t.addChild(this))}setLocalEulerAngles(t,e,i){t instanceof H?this.localRotation.setFromEulerAngles(t.x,t.y,t.z):this.localRotation.setFromEulerAngles(t,e,i),this._dirtyLocal||this._dirtifyLocal()}setLocalPosition(t,e,i){t instanceof H?this.localPosition.copy(t):this.localPosition.set(t,e,i),this._dirtyLocal||this._dirtifyLocal()}setLocalRotation(t,e,i,n){t instanceof $?this.localRotation.copy(t):this.localRotation.set(t,e,i,n),this._dirtyLocal||this._dirtifyLocal()}setLocalScale(t,e,i){t instanceof H?this.localScale.copy(t):this.localScale.set(t,e,i),this._dirtyLocal||this._dirtifyLocal()}_dirtifyLocal(){this._dirtyLocal||(this._dirtyLocal=!0,this._dirtyWorld||this._dirtifyWorld())}_unfreezeParentToRoot(){for(var t=this._parent;t;)t._frozen=!1,t=t._parent}_dirtifyWorld(){this._dirtyWorld||this._unfreezeParentToRoot(),this._dirtifyWorldInternal()}_dirtifyWorldInternal(){if(!this._dirtyWorld){this._frozen=!1,this._dirtyWorld=!0;for(var t=0;t<this._children.length;t++)this._children[t]._dirtyWorld||this._children[t]._dirtifyWorldInternal()}this._dirtyNormal=!0,this._aabbVer++}setPosition(t,e,i){t instanceof H?ui.copy(t):ui.set(t,e,i),null===this._parent?this.localPosition.copy(ui):(di.copy(this._parent.getWorldTransform()).invert(),di.transformPoint(ui,this.localPosition)),this._dirtyLocal||this._dirtifyLocal()}setRotation(t,e,i,n){if(t instanceof $?fi.copy(t):fi.set(t,e,i,n),null===this._parent)this.localRotation.copy(fi);else{var r=this._parent.getRotation();pi.copy(r).invert(),this.localRotation.copy(pi).mul(fi)}this._dirtyLocal||this._dirtifyLocal()}setEulerAngles(t,e,i){if(t instanceof H?this.localRotation.setFromEulerAngles(t.x,t.y,t.z):this.localRotation.setFromEulerAngles(t,e,i),null!==this._parent){var n=this._parent.getRotation();pi.copy(n).invert(),this.localRotation.mul2(pi,this.localRotation)}this._dirtyLocal||this._dirtifyLocal()}addChild(t){if(null!==t._parent)throw new Error("GraphNode is already parented");this._children.push(t),this._onInsertChild(t)}addChildAndSaveTransform(t){var e=t.getPosition(),i=t.getRotation(),n=t._parent;n&&n.removeChild(t),t.setPosition(hi.copy(this.worldTransform).invert().transformPoint(e)),t.setRotation(ci.copy(this.getRotation()).invert().mul(i)),this._children.push(t),this._onInsertChild(t)}insertChild(t,e){if(null!==t._parent)throw new Error("GraphNode is already parented");this._children.splice(e,0,t),this._onInsertChild(t)}_onInsertChild(t){t._parent=this;var e=t._enabled&&this.enabled;t._enabledInHierarchy!==e&&(t._enabledInHierarchy=e,t._notifyHierarchyStateChanged(t,e)),t._updateGraphDepth(),t._dirtifyWorld(),this._frozen&&t._unfreezeParentToRoot(),t.fire&&t.fire("insert",this),this.fire&&this.fire("childinsert",t)}_updateGraphDepth(){this._parent?this._graphDepth=this._parent._graphDepth+1:this._graphDepth=0;for(var t=0,e=this._children.length;t<e;t++)this._children[t]._updateGraphDepth()}removeChild(t){var e,i=this._children.length;for(e=0;e<i;++e)if(this._children[e]===t)return this._children.splice(e,1),t._parent=null,t.fire&&t.fire("remove",this),void(this.fire&&this.fire("childremove",t))}_sync(){if(this._dirtyLocal&&(this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale),this._dirtyLocal=!1),this._dirtyWorld){if(null===this._parent)this.worldTransform.copy(this.localTransform);else if(this.scaleCompensation){var t,e=this._parent,i=this.localScale,n=e;if(n){for(;n&&n.scaleCompensation;)n=n._parent;n&&(n=n._parent)&&(t=n.worldTransform.getScale(),oi.mul2(t,this.localScale),i=oi)}ai.setFromMat4(e.worldTransform),si.mul2(ai,this.localRotation);var r=e.worldTransform;e.scaleCompensation&&(li.mul2(t,e.getLocalScale()),ni.setTRS(e.worldTransform.getTranslation(ri),ai,li),r=ni),r.transformPoint(this.localPosition,ri),this.worldTransform.setTRS(ri,si,i)}else this.worldTransform.mulAffine2(this._parent.worldTransform,this.localTransform);this._dirtyWorld=!1}}syncHierarchy(){if(this._enabled&&!this._frozen){this._frozen=!0,(this._dirtyLocal||this._dirtyWorld)&&this._sync();for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].syncHierarchy()}}lookAt(t,e,i,n=0,r=1,s=0){if(t instanceof H)gi.copy(t),e instanceof H?vi.copy(e):vi.copy(H.UP);else{if(void 0===i)return;gi.set(t,e,i),vi.set(n,r,s)}mi.setLookAt(this.getPosition(),gi,vi),fi.setFromMat4(mi),this.setRotation(fi)}translate(t,e,i){t instanceof H?ui.copy(t):ui.set(t,e,i),ui.add(this.getPosition()),this.setPosition(ui)}translateLocal(t,e,i){t instanceof H?ui.copy(t):ui.set(t,e,i),this.localRotation.transformVector(ui,ui),this.localPosition.add(ui),this._dirtyLocal||this._dirtifyLocal()}rotate(t,e,i){if(t instanceof H?fi.setFromEulerAngles(t.x,t.y,t.z):fi.setFromEulerAngles(t,e,i),null===this._parent)this.localRotation.mul2(fi,this.localRotation);else{var n=this.getRotation(),r=this._parent.getRotation();pi.copy(r).invert(),fi.mul2(pi,fi),this.localRotation.mul2(fi,n)}this._dirtyLocal||this._dirtifyLocal()}rotateLocal(t,e,i){t instanceof H?fi.setFromEulerAngles(t.x,t.y,t.z):fi.setFromEulerAngles(t,e,i),this.localRotation.mul(fi),this._dirtyLocal||this._dirtifyLocal()}}var yi=[null,function(t,e){return t.drawOrder-e.drawOrder},function(t,e){return $e=t._key[0],ti=e._key[0],$e===ti&&t.mesh&&e.mesh?e.mesh.id-t.mesh.id:ti-$e},function(t,e){return e.zdist-t.zdist},function(t,e){return t.zdist-e.zdist}];function bi(t,e){return t.priority-e.priority}function xi(t,e){return e.key-t.key}var wi=0;class Ai{constructor(){this.list=[],this.length=0,this.done=!1}}class Ci{constructor(){this.opaqueMeshInstances=[],this.transparentMeshInstances=[],this.shadowCasters=[],this.visibleOpaque=[],this.visibleTransparent=[]}clearVisibleLists(t){this.visibleOpaque[t]&&(this.visibleOpaque[t].length=0,this.visibleOpaque[t].list.length=0),this.visibleTransparent[t]&&(this.visibleTransparent[t].length=0,this.visibleTransparent[t].list.length=0)}}class Ii{constructor(t={}){void 0!==t.id?(this.id=t.id,wi=Math.max(this.id+1,wi)):this.id=wi++,this.name=t.name,this._enabled=void 0===t.enabled||t.enabled,this._refCounter=this._enabled?1:0,this.opaqueSortMode=void 0===t.opaqueSortMode?2:t.opaqueSortMode,this.transparentSortMode=void 0===t.transparentSortMode?3:t.transparentSortMode,this.renderTarget=t.renderTarget,this.shaderPass=void 0===t.shaderPass?0:t.shaderPass,this.passThrough=void 0!==t.passThrough&&t.passThrough,this.overrideClear=void 0!==t.overrideClear&&t.overrideClear,this._clearColor=new D(0,0,0,1),t.clearColor&&this._clearColor.copy(t.clearColor),this._clearColorBuffer=void 0!==t.clearColorBuffer&&t.clearColorBuffer,this._clearDepthBuffer=void 0!==t.clearDepthBuffer&&t.clearDepthBuffer,this._clearStencilBuffer=void 0!==t.clearStencilBuffer&&t.clearStencilBuffer,this._clearOptions={color:[this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a],depth:1,stencil:0,flags:(this._clearColorBuffer?1:0)|(this._clearDepthBuffer?2:0)|(this._clearStencilBuffer?4:0)},this.onPreCull=t.onPreCull,this.onPreRender=t.onPreRender,this.onPreRenderOpaque=t.onPreRenderOpaque,this.onPreRenderTransparent=t.onPreRenderTransparent,this.onPostCull=t.onPostCull,this.onPostRender=t.onPostRender,this.onPostRenderOpaque=t.onPostRenderOpaque,this.onPostRenderTransparent=t.onPostRenderTransparent,this.onDrawCall=t.onDrawCall,this.onEnable=t.onEnable,this.onDisable=t.onDisable,this._enabled&&this.onEnable&&this.onEnable(),this.layerReference=t.layerReference,this.instances=t.layerReference?t.layerReference.instances:new Ci,this.cullingMask=t.cullingMask?t.cullingMask:4294967295,this.opaqueMeshInstances=this.instances.opaqueMeshInstances,this.transparentMeshInstances=this.instances.transparentMeshInstances,this.shadowCasters=this.instances.shadowCasters,this.customSortCallback=null,this.customCalculateSortValues=null,this._lightComponents=[],this._lights=[],this._splitLights=[[],[],[]],this.cameras=[],this._dirty=!1,this._dirtyLights=!1,this._dirtyCameras=!1,this._cameraHash=0,this._lightHash=0,this._staticLightHash=0,this._needsStaticPrepare=!0,this._staticPrepareDone=!1,this._shaderVersion=-1,this._version=0,this._lightCube=null}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._dirtyCameras=!0}get enabled(){return this._enabled}set enabled(t){t!==this._enabled&&(this._enabled=t,t?(this.incrementCounter(),this.onEnable&&this.onEnable()):(this.decrementCounter(),this.onDisable&&this.onDisable()))}get clearColor(){return this._clearColor}set clearColor(t){this._clearColor.copy(t)}_updateClearFlags(){var t=0;this._clearColorBuffer&&(t|=1),this._clearDepthBuffer&&(t|=2),this._clearStencilBuffer&&(t|=4),this._clearOptions.flags=t}get clearColorBuffer(){return this._clearColorBuffer}set clearColorBuffer(t){this._clearColorBuffer=t,this._updateClearFlags()}get clearDepthBuffer(){return this._clearDepthBuffer}set clearDepthBuffer(t){this._clearDepthBuffer=t,this._updateClearFlags()}get clearStencilBuffer(){return this._clearStencilBuffer}set clearStencilBuffer(t){this._clearStencilBuffer=t,this._updateClearFlags()}incrementCounter(){0===this._refCounter&&(this._enabled=!0,this.onEnable&&this.onEnable()),this._refCounter++}decrementCounter(){if(1===this._refCounter)this._enabled=!1,this.onDisable&&this.onDisable();else if(0===this._refCounter)return;this._refCounter--}addMeshInstances(t,e){for(var i,n,r,s=this._shaderVersion,a=this.shadowCasters,o=0;o<t.length;o++)n=3===(r=(i=t[o]).material).blendType?this.opaqueMeshInstances:this.transparentMeshInstances,this.opaqueMeshInstances.indexOf(i)<0&&this.transparentMeshInstances.indexOf(i)<0&&n.push(i),!e&&i.castShadow&&a.indexOf(i)<0&&a.push(i),!this.passThrough&&s>=0&&r._shaderVersion!==s&&(r.updateShader!==_e.prototype.updateShader&&(r.clearVariants(),r.shader=null),r._shaderVersion=s);this.passThrough||(this._dirty=!0)}removeMeshInstanceFromArray(t,e){for(var i,n=-1,r=0,s=e.length,a=0;a<s;a++){if((i=e[a])===t){n=a,r=1;break}if(i._staticSource===t)n<0&&(n=a),r++;else if(n>=0)break}n>=0&&e.splice(n,r)}removeMeshInstances(t,e){for(var i,n,r=this.opaqueMeshInstances,s=this.transparentMeshInstances,a=this.shadowCasters,o=0;o<t.length;o++)n=t[o],this.removeMeshInstanceFromArray(n,r),this.removeMeshInstanceFromArray(n,s),e||(i=a.indexOf(n))>=0&&a.splice(i,1);this._dirty=!0}clearMeshInstances(t){(0!==this.opaqueMeshInstances.length||0!==this.transparentMeshInstances.length||!t&&0!==this.shadowCasters.length)&&(this.opaqueMeshInstances.length=0,this.transparentMeshInstances.length=0,t||(this.shadowCasters.length=0),this.passThrough||(this._dirty=!0))}addLight(t){this._lightComponents.indexOf(t)>=0||(this._lightComponents.push(t),this._lights.push(t.light),this._dirtyLights=!0,this._generateLightHash())}removeLight(t){var e=this._lightComponents.indexOf(t);e<0||(this._lightComponents.splice(e,1),e=this._lights.indexOf(t.light),this._lights.splice(e,1),this._dirtyLights=!0,this._generateLightHash())}clearLights(){this._lightComponents.length=0,this._lights.length=0,this._dirtyLights=!0}addShadowCasters(t){for(var e,i=this.shadowCasters,n=0;n<t.length;n++)(e=t[n]).castShadow&&i.indexOf(e)<0&&i.push(e);this._dirtyLights=!0}removeShadowCasters(t){for(var e,i=this.shadowCasters,n=0;n<t.length;n++)(e=i.indexOf(t[n]))>=0&&i.splice(e,1);this._dirtyLights=!0}_generateLightHash(){if(this._lights.length>0){this._lights.sort(xi);for(var t="",e="",i=0;i<this._lights.length;i++)this._lights[i].isStatic?e+=this._lights[i].key:t+=this._lights[i].key;0===t.length?this._lightHash=0:this._lightHash=yt(t),0===e.length?this._staticLightHash=0:this._staticLightHash=yt(e)}else this._lightHash=0,this._staticLightHash=0}_generateCameraHash(){if(this.cameras.length>1){this.cameras.sort(bi);for(var t="",e=0;e<this.cameras.length;e++)t+=this.cameras[e].entity.getGuid();this._cameraHash=yt(t)}else this._cameraHash=0;this._dirtyCameras=!0}addCamera(t){this.cameras.indexOf(t)>=0||(this.cameras.push(t),this._generateCameraHash())}removeCamera(t){var e=this.cameras.indexOf(t);e<0||(this.cameras.splice(e,1),this._generateCameraHash(),this.instances.clearVisibleLists(e))}clearCameras(){this.cameras.length=0,this._cameraHash=0,this._dirtyCameras=!0}_sortCameras(){this._generateCameraHash()}_calculateSortDistances(t,e,i,n){var r,s,a,o,l,h;for(r=0;r<e;r++)(s=t[r]).command||s.layer<=2||(s.calculateSortDistance?s.zdist=s.calculateSortDistance(s,i,n):(o=(a=s.aabb.center).x-i.x,l=a.y-i.y,h=a.z-i.z,s.zdist=o*n.x+l*n.y+h*n.z))}_sortVisible(t,e,i){var n=this.instances,r=t?this.transparentSortMode:this.opaqueSortMode;if(0!==r){var s=t?n.visibleTransparent[i]:n.visibleOpaque[i];5===r?(ei=e.getPosition(),ii=e.forward,this.customCalculateSortValues&&this.customCalculateSortValues(s.list,s.length,ei,ii),s.list.length!==s.length&&(s.list.length=s.length),this.customSortCallback&&s.list.sort(this.customSortCallback)):(3!==r&&4!==r||(ei=e.getPosition(),ii=e.forward,this._calculateSortDistances(s.list,s.length,ei,ii)),s.list.length!==s.length&&(s.list.length=s.length),s.list.sort(yi[r]))}}}for(var Si,Mi,Ti,Pi,Ei,ki,Di,Oi,Ri,Li=(new Q).mul2((new Q).setTranslate(.5,.5,.5),(new Q).setScale(.5,.5,.5)),Ni={r:1,g:2,b:3,a:4},zi=[(new $).setFromEulerAngles(0,90,180),(new $).setFromEulerAngles(0,-90,180),(new $).setFromEulerAngles(90,0,0),(new $).setFromEulerAngles(-90,0,0),(new $).setFromEulerAngles(0,180,180),(new $).setFromEulerAngles(0,0,180)],Bi=[{},{},{},{},{}],Fi=new Float32Array(2),ji={x:1,y:1,z:0,w:0},Vi=new Q,Ui=new Q,Gi=new Q,Wi=new Q,Hi=new Q,Xi=new G,Zi=new Q,Yi=new Q,qi=new Q,Ki=new Q,Ji=new Q,Qi=new H,$i=new H,tn=new Q,en=new Q,nn=new Q,rn=new Q,sn=new H,an=new H,on=new H,ln=new H,hn={center:null,radius:0},cn=new st,un=[0,0,0,0],dn={},fn=null,pn=0,mn=new Set,gn=[],vn=0;vn<8;vn++)gn.push(new H);var _n=[new H,new H,new H,new H,new H,new H,new H,new H];function yn(t,e,i,n){var r=function(t,e){return 3===e?14:2===e?12:4===e||0===e&&t.webgl2?16:7}(t,n),s=function(t,e){return 0!==e||t.webgl2?3===e?t.extTextureFloatLinear?1:0:2===e?t.extTextureHalfFloatLinear?1:0:1:0}(t,n),a=new pe(t,{format:r,width:e,height:i,mipmaps:!1,minFilter:s,magFilter:s,addressU:1,addressV:1});return a.name="shadowmap",4===n||0===n&&t.webgl2?(a.compareOnRead=!0,a.compareFunc=1,new Cf({depthBuffer:a})):new Cf({colorBuffer:a,depth:!0})}function bn(t,e){var i=new pe(t,{format:7,width:e,height:e,cubemap:!0,mipmaps:!1,minFilter:0,magFilter:0,addressU:1,addressV:1});i.name="shadowcube";for(var n,r=[],s=0;s<6;s++)n=new Cf({colorBuffer:i,face:s,depth:!0}),r.push(n);return r}function xn(t,e){return Math.exp(-t*t/(2*e*e))}function wn(t){t>25&&(t=25);var e,i,n,r,s=(t-1)/6;for(r=.5*(t-1),i=new Array(t),n=0,e=0;e<t;++e)i[e]=xn(e-r,s),n+=i[e];for(e=0;e<t;++e)i[e]/=n;return i}function An(t,e,i,n=0){var r=1e4*n+e,s=Bi[i][r];return s||(s=yn(t,e,e,i||0),Bi[i][r]=s),s}function Cn(t,e){var i;1===e._type?(e._shadowType>0&&(e._shadowType=0),e._cacheShadowMap?(i=dn[e._shadowResolution])||(i=bn(t,e._shadowResolution),dn[e._shadowResolution]=i):i=bn(t,e._shadowResolution),e._shadowCamera.renderTarget=i[0],e._shadowCubeMap=i):(i=e._cacheShadowMap?An(t,e._shadowResolution,e._shadowType):yn(t,e._shadowResolution,e._shadowResolution,e._shadowType),e._shadowCamera.renderTarget=i),e._isCachedShadowMap=e._cacheShadowMap}function In(t){var e=t.material,i=t.skinInstance?10:0,n=0;if(e.opacityMap){var r=e.opacityMapChannel;r&&(n=Ni[r])}return i+n}class Sn{constructor(t){this.device=t;var e=this.device;this._shadowDrawCalls=0,this._forwardDrawCalls=0,this._skinDrawCalls=0,this._camerasRendered=0,this._materialSwitches=0,this._shadowMapUpdates=0,this._shadowMapTime=0,this._depthMapTime=0,this._forwardTime=0,this._cullTime=0,this._sortTime=0,this._skinTime=0,this._morphTime=0,this._instancingTime=0,this._layerCompositionUpdateTime=0;var i=e.getProgramLibrary();this.library=i;var n=e.scope;this.projId=n.resolve("matrix_projection"),this.projSkyboxId=n.resolve("matrix_projectionSkybox"),this.viewId=n.resolve("matrix_view"),this.viewId3=n.resolve("matrix_view3"),this.viewInvId=n.resolve("matrix_viewInverse"),this.viewProjId=n.resolve("matrix_viewProjection"),this.viewPos=new Float32Array(3),this.viewPosId=n.resolve("view_position"),this.nearClipId=n.resolve("camera_near"),this.farClipId=n.resolve("camera_far"),this.cameraParamsId=n.resolve("camera_params"),this.shadowMapLightRadiusId=n.resolve("light_radius"),this.fogColorId=n.resolve("fog_color"),this.fogStartId=n.resolve("fog_start"),this.fogEndId=n.resolve("fog_end"),this.fogDensityId=n.resolve("fog_density"),this.modelMatrixId=n.resolve("matrix_model"),this.normalMatrixId=n.resolve("matrix_normal"),this.poseMatrixId=n.resolve("matrix_pose[0]"),this.boneTextureId=n.resolve("texture_poseMap"),this.boneTextureSizeId=n.resolve("texture_poseMapSize"),this.morphWeightsA=n.resolve("morph_weights_a"),this.morphWeightsB=n.resolve("morph_weights_b"),this.morphPositionTex=n.resolve("morphPositionTex"),this.morphNormalTex=n.resolve("morphNormalTex"),this.morphTexParams=n.resolve("morph_tex_params"),this.alphaTestId=n.resolve("alpha_ref"),this.opacityMapId=n.resolve("texture_opacityMap"),this.ambientId=n.resolve("light_globalAmbient"),this.exposureId=n.resolve("exposure"),this.skyboxIntensityId=n.resolve("skyboxIntensity"),this.lightColorId=[],this.lightDir=[],this.lightDirId=[],this.lightShadowMapId=[],this.lightShadowMatrixId=[],this.lightShadowParamsId=[],this.lightShadowMatrixVsId=[],this.lightShadowParamsVsId=[],this.lightDirVs=[],this.lightDirVsId=[],this.lightRadiusId=[],this.lightPos=[],this.lightPosId=[],this.lightWidth=[],this.lightWidthId=[],this.lightHeight=[],this.lightHeightId=[],this.lightInAngleId=[],this.lightOutAngleId=[],this.lightPosVsId=[],this.lightCookieId=[],this.lightCookieIntId=[],this.lightCookieMatrixId=[],this.lightCookieOffsetId=[],this.depthMapId=n.resolve("uDepthMap"),this.screenSizeId=n.resolve("uScreenSize"),this._screenSize=new Float32Array(4),this.sourceId=n.resolve("source"),this.pixelOffsetId=n.resolve("pixelOffset"),this.weightId=n.resolve("weight[0]"),this.blurVsmShaderCode=[Ft.blurVSMPS,"#define GAUSS\n"+Ft.blurVSMPS];this.blurPackedVsmShaderCode=["#define PACKED\n"+this.blurVsmShaderCode[0],"#define PACKED\n"+this.blurVsmShaderCode[1]],this.blurVsmShader=[{},{}],this.blurPackedVsmShader=[{},{}],this.blurVsmWeights={},this.twoSidedLightingNegScaleFactorId=n.resolve("twoSidedLightingNegScaleFactor"),this.polygonOffsetId=n.resolve("polygonOffset"),this.polygonOffset=new Float32Array(2),this.fogColor=new Float32Array(3),this.ambientColor=new Float32Array(3),this.cameraParams=new Float32Array(4)}sortCompare(t,e){if(t.layer===e.layer){if(t.drawOrder&&e.drawOrder)return t.drawOrder-e.drawOrder;if(t.zdist&&e.zdist)return e.zdist-t.zdist;if(t.zdist2&&e.zdist2)return t.zdist2-e.zdist2}return e._key[0]-t._key[0]}sortCompareMesh(t,e){if(t.layer===e.layer){if(t.drawOrder&&e.drawOrder)return t.drawOrder-e.drawOrder;if(t.zdist&&e.zdist)return e.zdist-t.zdist}return Oi=t._key[0],Ri=e._key[0],Oi===Ri&&t.mesh&&e.mesh?e.mesh.id-t.mesh.id:Ri-Oi}depthSortCompare(t,e){return Oi=t._key[1],Ri=e._key[1],Oi===Ri&&t.mesh&&e.mesh?e.mesh.id-t.mesh.id:Ri-Oi}lightCompare(t,e){return t.key-e.key}getShadowCamera(t,e){var i,n=e._shadowCamera;return null===n?(n=e._shadowCamera=function(t,e,i){var n=4===e||0===e&&t.webgl2;1===i&&(n=!1);var r=new Qe;return r.clearColor=e>=1&&e<=3?new D(0,0,0,0):new D(1,1,1,1),r.clearColorBuffer=!n,r.clearDepthBuffer=!0,r.clearStencilBuffer=!1,r.node=new _i,r}(t,e._shadowType,e._type),Cn(t,e)):(i=n.renderTarget).width===e._shadowResolution&&i.height===e._shadowResolution||Cn(t,e),n}updateCameraFrustum(t){if(t.vrDisplay&&t.vrDisplay.presenting){Si=t.vrDisplay.combinedProj;var e=t._node.parent;e?Hi.copy(e.getWorldTransform()).mul(t.vrDisplay.combinedViewInv).invert():Hi.copy(t.vrDisplay.combinedView),Wi.copy(Hi).invert(),this.viewInvId.setValue(Wi.data),Zi.mul2(Si,Hi),t.frustum.setFromMat4(Zi)}else if(t.xr&&t.xr.views.length){var i=t.xr.views[0];return Zi.mul2(i.projMat,i.viewOffMat),void t.frustum.setFromMat4(Zi)}if(Si=t.projectionMatrix,t.calculateProjection&&t.calculateProjection(Si,0),t.calculateTransform)t.calculateTransform(Wi,0);else{var n=t._node.getPosition(),r=t._node.getRotation();Wi.setTRS(n,r,H.ONE),this.viewInvId.setValue(Wi.data)}Hi.copy(Wi).invert(),Zi.mul2(Si,Hi),t.frustum.setFromMat4(Zi)}setCamera(t,e,i,n){var r,s,a=t.vrDisplay;if(a&&a.presenting)Mi=a.leftProj,Ti=a.rightProj,Si=a.combinedProj,t.calculateProjection&&(t.calculateProjection(Mi,1),t.calculateProjection(Ti,2),t.calculateProjection(Si,0)),t.calculateTransform?(t.calculateTransform(Yi,1),t.calculateTransform(qi,2),t.calculateTransform(Wi,0),Ki.copy(Yi).invert(),Ji.copy(qi).invert(),Hi.copy(Wi).invert()):(r=t._node.parent)?(s=r.getWorldTransform(),Yi.mul2(s,a.leftViewInv),qi.mul2(s,a.rightViewInv),Ki.copy(Yi).invert(),Ji.copy(qi).invert(),Hi.copy(r.getWorldTransform()).mul(a.combinedViewInv).invert()):(Yi.copy(a.leftViewInv),qi.copy(a.rightViewInv),Ki.copy(a.leftView),Ji.copy(a.rightView),Hi.copy(a.combinedView)),tn.setFromMat4(Ki),en.setFromMat4(Ji),nn.mul2(Mi,Ki),rn.mul2(Ti,Ji),Qi.x=Yi.data[12],Qi.y=Yi.data[13],Qi.z=Yi.data[14],$i.x=qi.data[12],$i.y=qi.data[13],$i.z=qi.data[14],Zi.mul2(Si,Hi),t.frustum.setFromMat4(Zi);else if(t.xr&&t.xr.session){(r=t._node.parent)&&(s=r.getWorldTransform());for(var o=t.xr.views,l=0;l<o.length;l++){var h=o[l];r?(h.viewInvOffMat.mul2(s,h.viewInvMat),h.viewOffMat.copy(h.viewInvOffMat).invert()):(h.viewInvOffMat.copy(h.viewInvMat),h.viewOffMat.copy(h.viewMat)),h.viewMat3.setFromMat4(h.viewOffMat),h.projViewOffMat.mul2(h.projMat,h.viewOffMat),h.position[0]=h.viewInvOffMat.data[12],h.position[1]=h.viewInvOffMat.data[13],h.position[2]=h.viewInvOffMat.data[14],t.frustum.setFromMat4(h.projViewOffMat)}}else{if(Si=t.projectionMatrix,t.calculateProjection&&t.calculateProjection(Si,0),this.projId.setValue(Si.data),this.projSkyboxId.setValue(t.getProjectionMatrixSkybox().data),t.calculateTransform)t.calculateTransform(Wi,0);else{var c=t._node.getPosition(),u=t._node.getRotation();Wi.setTRS(c,u,H.ONE)}this.viewInvId.setValue(Wi.data),Hi.copy(Wi).invert(),this.viewId.setValue(Hi.data),Xi.setFromMat4(Hi),this.viewId3.setValue(Xi.data),Zi.mul2(Si,Hi),this.viewProjId.setValue(Zi.data);var d=t._node.getPosition();this.viewPos[0]=d.x,this.viewPos[1]=d.y,this.viewPos[2]=d.z,this.viewPosId.setValue(this.viewPos),t.frustum.setFromMat4(Zi)}this.nearClipId.setValue(t._nearClip),this.farClipId.setValue(t._farClip);var f=t._nearClip,p=t._farClip;this.cameraParams[0]=1/p,this.cameraParams[1]=p,this.cameraParams[2]=.5*(1-p/f),this.cameraParams[3]=.5*(1+p/f),this.cameraParamsId.setValue(this.cameraParams),this.clearView(t,e,i,!1);var m=this.device,g=e?e.width:m.width,v=e?e.height:m.height,_=t.scissorRect,y=Math.floor(_.x*g),b=Math.floor(_.y*v),x=Math.floor(_.z*g),w=Math.floor(_.w*v);m.setScissor(y,b,x,w),n&&m.setScissor(1,1,g-2,v-2)}clearView(t,e,i,n,r){var s=this.device;s.setRenderTarget(e),s.updateBegin(),n&&(s.setColorWrite(!0,!0,!0,!0),s.setDepthWrite(!0));var a=t.rect,o=e?e.width:s.width,l=e?e.height:s.height,h=Math.floor(a.x*o),c=Math.floor(a.y*l),u=Math.floor(a.z*o),d=Math.floor(a.w*l);s.setViewport(h,c,u,d),s.setScissor(h,c,u,d),i&&(r||(r=t._clearOptions),s.clear(r||{color:[t._clearColor.r,t._clearColor.g,t._clearColor.b,t._clearColor.a],depth:t._clearDepth,flags:(t._clearColorBuffer?1:0)|(t._clearDepthBuffer?2:0)|(t._clearStencilBuffer?4:0),stencil:t._clearStencil}))}dispatchGlobalLights(t){var e;if(this.mainLight=-1,this.ambientColor[0]=t.ambientLight.r,this.ambientColor[1]=t.ambientLight.g,this.ambientColor[2]=t.ambientLight.b,t.gammaCorrection)for(e=0;e<3;e++)this.ambientColor[e]=Math.pow(this.ambientColor[e],2.2);this.ambientId.setValue(this.ambientColor),this.exposureId.setValue(t.exposure),t.skyboxModel&&this.skyboxIntensityId.setValue(t.skyboxIntensity)}_resolveLight(t,e){var i="light"+e;this.lightColorId[e]=t.resolve(i+"_color"),this.lightDir[e]=new Float32Array(3),this.lightDirId[e]=t.resolve(i+"_direction"),this.lightShadowMapId[e]=t.resolve(i+"_shadowMap"),this.lightShadowMatrixId[e]=t.resolve(i+"_shadowMatrix"),this.lightShadowParamsId[e]=t.resolve(i+"_shadowParams"),this.lightShadowMatrixVsId[e]=t.resolve(i+"_shadowMatrixVS"),this.lightShadowParamsVsId[e]=t.resolve(i+"_shadowParamsVS"),this.lightDirVs[e]=new Float32Array(3),this.lightDirVsId[e]=t.resolve(i+"_directionVS"),this.lightRadiusId[e]=t.resolve(i+"_radius"),this.lightPos[e]=new Float32Array(3),this.lightPosId[e]=t.resolve(i+"_position"),this.lightWidth[e]=new Float32Array(3),this.lightWidthId[e]=t.resolve(i+"_halfWidth"),this.lightHeight[e]=new Float32Array(3),this.lightHeightId[e]=t.resolve(i+"_halfHeight"),this.lightInAngleId[e]=t.resolve(i+"_innerConeAngle"),this.lightOutAngleId[e]=t.resolve(i+"_outerConeAngle"),this.lightPosVsId[e]=t.resolve(i+"_positionVS"),this.lightCookieId[e]=t.resolve(i+"_cookie"),this.lightCookieIntId[e]=t.resolve(i+"_cookieIntensity"),this.lightCookieMatrixId[e]=t.resolve(i+"_cookieMatrix"),this.lightCookieOffsetId[e]=t.resolve(i+"_cookieOffset")}setLTCDirectionallLight(t,e,i,n,r){this.lightPos[e][0]=n.x-i.x*r,this.lightPos[e][1]=n.y-i.y*r,this.lightPos[e][2]=n.z-i.z*r,this.lightPosId[e].setValue(this.lightPos[e]);var s=t.transformVector(new H(-.5,0,0));this.lightWidth[e][0]=s.x*r,this.lightWidth[e][1]=s.y*r,this.lightWidth[e][2]=s.z*r,this.lightWidthId[e].setValue(this.lightWidth[e]);var a=t.transformVector(new H(0,0,.5));this.lightHeight[e][0]=a.x*r,this.lightHeight[e][1]=a.y*r,this.lightHeight[e][2]=a.z*r,this.lightHeightId[e].setValue(this.lightHeight[e])}dispatchDirectLights(t,e,i,n){var r,s,a,o=t.length,l=0;this.mainLight=-1;var h=this.device.scope;for(r=0;r<o;r++)if(t[r].mask&i){if(a=(s=t[r])._node.getWorldTransform(),this.lightColorId[l]||this._resolveLight(h,l),this.lightColorId[l].setValue(e.gammaCorrection?s._linearFinalColor:s._finalColor),a.getY(s._direction).scale(-1),s._direction.normalize(),this.lightDir[l][0]=s._direction.x,this.lightDir[l][1]=s._direction.y,this.lightDir[l][2]=s._direction.z,this.lightDirId[l].setValue(this.lightDir[l]),0!==s.shape&&this.setLTCDirectionallLight(a,l,s._direction,n._node.getPosition(),n.farClip),s.castShadows){var c,u=s._isPcf&&this.device.webgl2?s._shadowCamera.renderTarget.depthBuffer:s._shadowCamera.renderTarget.colorBuffer;s._isVsm?c=-2e-4:(c=s.shadowBias/s._shadowCamera._farClip*100,!this.device.webgl2&&this.device.extStandardDerivatives&&(c*=-100));var d=s._isVsm?s.vsmBias/(s._shadowCamera._farClip/7):s._normalOffsetBias;this.lightShadowMapId[l].setValue(u),this.lightShadowMatrixId[l].setValue(s._shadowMatrix.data);var f=s._rendererParams;3!==f.length&&(f.length=3),f[0]=s._shadowResolution,f[1]=d,f[2]=c,this.lightShadowParamsId[l].setValue(f),this.mainLight<0&&(this.lightShadowMatrixVsId[l].setValue(s._shadowMatrix.data),this.lightShadowParamsVsId[l].setValue(f),s._direction.normalize(),this.lightDirVs[l][0]=s._direction.x,this.lightDirVs[l][1]=s._direction.y,this.lightDirVs[l][2]=s._direction.z,this.lightDirVsId[l].setValue(this.lightDirVs[l]),this.mainLight=r)}l++}return l}setLTCPositionalLight(t,e){var i=t.transformVector(new H(-.5,0,0));this.lightWidth[e][0]=i.x,this.lightWidth[e][1]=i.y,this.lightWidth[e][2]=i.z,this.lightWidthId[e].setValue(this.lightWidth[e]);var n=t.transformVector(new H(0,0,.5));this.lightHeight[e][0]=n.x,this.lightHeight[e][1]=n.y,this.lightHeight[e][2]=n.z,this.lightHeightId[e].setValue(this.lightHeight[e])}dispatchOmniLight(t,e,i,n){var r=i._node.getWorldTransform();if(this.lightColorId[n]||this._resolveLight(e,n),this.lightRadiusId[n].setValue(i.attenuationEnd),this.lightColorId[n].setValue(t.gammaCorrection?i._linearFinalColor:i._finalColor),r.getTranslation(i._position),this.lightPos[n][0]=i._position.x,this.lightPos[n][1]=i._position.y,this.lightPos[n][2]=i._position.z,this.lightPosId[n].setValue(this.lightPos[n]),0!==i.shape&&this.setLTCPositionalLight(r,n),i.castShadows){var s=i._shadowCamera.renderTarget.colorBuffer;this.lightShadowMapId[n].setValue(s);var a=i._rendererParams;4!==a.length&&(a.length=4),a[0]=i._shadowResolution,a[1]=i._normalOffsetBias,a[2]=i.shadowBias,a[3]=1/i.attenuationEnd,this.lightShadowParamsId[n].setValue(a)}i._cookie&&(this.lightCookieId[n].setValue(i._cookie),this.lightShadowMatrixId[n].setValue(r.data),this.lightCookieIntId[n].setValue(i.cookieIntensity))}dispatchSpotLight(t,e,i,n){var r=i._node.getWorldTransform();if(this.lightColorId[n]||this._resolveLight(e,n),this.lightInAngleId[n].setValue(i._innerConeAngleCos),this.lightOutAngleId[n].setValue(i._outerConeAngleCos),this.lightRadiusId[n].setValue(i.attenuationEnd),this.lightColorId[n].setValue(t.gammaCorrection?i._linearFinalColor:i._finalColor),r.getTranslation(i._position),this.lightPos[n][0]=i._position.x,this.lightPos[n][1]=i._position.y,this.lightPos[n][2]=i._position.z,this.lightPosId[n].setValue(this.lightPos[n]),0!==i.shape&&this.setLTCPositionalLight(r,n),r.getY(i._direction).scale(-1),i._direction.normalize(),this.lightDir[n][0]=i._direction.x,this.lightDir[n][1]=i._direction.y,this.lightDir[n][2]=i._direction.z,this.lightDirId[n].setValue(this.lightDir[n]),i.castShadows){var s;i._isVsm?s=-2e-4:(s=20*i.shadowBias,!this.device.webgl2&&this.device.extStandardDerivatives&&(s*=-100));var a=i._isVsm?i.vsmBias/(i.attenuationEnd/7):i._normalOffsetBias,o=i._isPcf&&this.device.webgl2?i._shadowCamera.renderTarget.depthBuffer:i._shadowCamera.renderTarget.colorBuffer;this.lightShadowMapId[n].setValue(o),this.lightShadowMatrixId[n].setValue(i._shadowMatrix.data);var l=i._rendererParams;4!==l.length&&(l.length=4),l[0]=i._shadowResolution,l[1]=a,l[2]=s,l[3]=1/i.attenuationEnd,this.lightShadowParamsId[n].setValue(l)}if(i._cookie){if(this.lightCookieId[n].setValue(i._cookie),!i.castShadows){var h=this.getShadowCamera(this.device,i),c=h._node;c.setPosition(i._node.getPosition()),c.setRotation(i._node.getRotation()),c.rotateLocal(-90,0,0),h.projection=0,h.aspectRatio=1,h.fov=2*i._outerConeAngle,Vi.setTRS(c.getPosition(),c.getRotation(),H.ONE).invert(),Ui.mul2(h.projectionMatrix,Vi),i._shadowMatrix.mul2(Li,Ui)}this.lightShadowMatrixId[n].setValue(i._shadowMatrix.data),this.lightCookieIntId[n].setValue(i.cookieIntensity),i._cookieTransform&&(i._cookieTransformUniform[0]=i._cookieTransform.x,i._cookieTransformUniform[1]=i._cookieTransform.y,i._cookieTransformUniform[2]=i._cookieTransform.z,i._cookieTransformUniform[3]=i._cookieTransform.w,this.lightCookieMatrixId[n].setValue(i._cookieTransformUniform),i._cookieOffsetUniform[0]=i._cookieOffset.x,i._cookieOffsetUniform[1]=i._cookieOffset.y,this.lightCookieOffsetId[n].setValue(i._cookieOffsetUniform))}}dispatchLocalLights(t,e,i,n,r){var s,a,o,l=t[1],h=t[2],c=n,u=l.length,d=h.length,f=c,p=this.device.scope;for(s=0;s<u;s++)(a=l[s]).mask&i&&(a.isStatic||(this.dispatchOmniLight(e,p,a,f),f++));var m=0;if(r)for(a=r[m];a&&1===a._type;)this.dispatchOmniLight(e,p,a,f),f++,a=r[++m];for(s=0;s<d;s++)(o=h[s]).mask&i&&(o.isStatic||(this.dispatchSpotLight(e,p,o,f),f++));if(r)for(o=r[m];o&&2===o._type;)this.dispatchSpotLight(e,p,o,f),f++,o=r[++m]}cull(t,e,i){var n,r,s,a=0,o=e.length,l=t.cullingMask||4294967295;if(!t.frustumCulling){for(n=0;n<o;n++)((r=e[n]).visible||r.command)&&(r.mask&&0==(r.mask&l)||(i[a]=r,a++,r.visibleThisFrame=!0));return a}for(n=0;n<o;n++)if((r=e[n]).command)i[a]=r,a++,r.visibleThisFrame=!0;else{if(!r.visible)continue;if(s=!0,r.mask&&0==(r.mask&l))continue;r.cull&&(s=r._isVisible(t)),s&&(i[a]=r,a++,r.visibleThisFrame=!0)}return a}cullLights(t,e){var i,n;for(i=0;i<e.length;i++)(n=e[i]).castShadows&&n.enabled&&0!==n.shadowUpdateMode&&0!==n._type&&(n.getBoundingSphere(hn),t.frustum.containsSphere(hn)&&(n.visibleThisFrame=!0))}updateCpuSkinMatrices(t){pn++;var e,i,n=t.length;if(0!==n)for(e=0;e<n;e++)(i=t[e].skinInstance)&&(i.updateMatrices(t[e].node,pn),i._dirty=!0)}updateGpuSkinMatrices(t){var e,i,n=t.length;for(e=0;e<n;e++)t[e].visibleThisFrame&&(i=t[e].skinInstance)&&i._dirty&&(i.updateMatrixPalette(t[e].node,pn),i._dirty=!1)}updateMorphing(t){var e,i,n=t.length;for(e=0;e<n;e++)(i=t[e].morphInstance)&&i._dirty&&t[e].visibleThisFrame&&i.update()}setBaseConstants(t,e){t.setCullMode(e.cull),e.opacityMap&&(this.opacityMapId.setValue(e.opacityMap),this.alphaTestId.setValue(e.alphaTest))}setSkinning(t,e,i){e.skinInstance&&(this._skinDrawCalls++,t.supportsBoneTextures?(Pi=e.skinInstance.boneTexture,this.boneTextureId.setValue(Pi),un[0]=Pi.width,un[1]=Pi.height,un[2]=1/Pi.width,un[3]=1/Pi.height,this.boneTextureSizeId.setValue(un)):this.poseMatrixId.setValue(e.skinInstance.matrixPalette))}drawInstance(t,e,i,n,r){if(Ei=e.instancingData){if(Ei.count>0&&(this._instancedDrawCalls++,t.setVertexBuffer(Ei.vertexBuffer),t.draw(i.primitive[n],Ei.count),Ei.vertexBuffer===fn))return this._removedByInstancing+=Ei.count,e.instancingData=null,Ei.count-1}else ki=e.node.worldTransform,this.modelMatrixId.setValue(ki.data),r&&(Di=e.node.normalMatrix,e.node._dirtyNormal&&(ki.invertTo3x3(Di),Di.transpose(),e.node._dirtyNormal=!1),this.normalMatrixId.setValue(Di.data)),t.draw(i.primitive[n]);return 0}drawInstance2(t,e,i,n){if(Ei=e.instancingData){if(Ei.count>0&&(this._instancedDrawCalls++,t.draw(i.primitive[n],Ei.count,!0),Ei.vertexBuffer===fn))return this._removedByInstancing+=Ei.count,e.instancingData=null,Ei.count-1}else t.draw(i.primitive[n],void 0,!0);return 0}renderShadows(t,e){var i,n,r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b=this.device;b.grabPassAvailable=!1;for(i=0;i<t.length;i++)if(a=(r=t[i])._type,r.castShadows&&r.enabled&&(r._shadowCamera||this.getShadowCamera(b,r),0!==r.shadowUpdateMode&&r.visibleThisFrame)){var x;if(l=(o=this.getShadowCamera(b,r))._node,h=0,c=1,0===a){if(r._visibleLength[e]<0)continue;v=r._visibleCameraSettings[e],l.setPosition(v.x,v.y,v.z),o.orthoHeight=v.orthoHeight,o.farClip=v.farClip,h=e}else 2===a?(x=l.getPosition(),this.viewPos[0]=x.x,this.viewPos[1]=x.y,this.viewPos[2]=x.z,this.viewPosId.setValue(this.viewPos),this.shadowMapLightRadiusId.setValue(r.attenuationEnd)):1===a&&(x=l.getPosition(),this.viewPos[0]=x.x,this.viewPos[1]=x.y,this.viewPos[2]=x.z,this.viewPosId.setValue(this.viewPos),this.shadowMapLightRadiusId.setValue(r.attenuationEnd),c=6);for(1!==a&&(Vi.setTRS(l.getPosition(),l.getRotation(),H.ONE).invert(),Ui.mul2(o.projectionMatrix,Vi),r._shadowMatrix.mul2(Li,Ui)),b.webgl2?1===a?b.setDepthBias(!1):(b.setDepthBias(!0),b.setDepthBiasValues(-1e3*r.shadowBias,-1e3*r.shadowBias)):b.extStandardDerivatives&&(1===a?(this.polygonOffset[0]=0,this.polygonOffset[1]=0,this.polygonOffsetId.setValue(this.polygonOffset)):(this.polygonOffset[0]=-1e3*r.shadowBias,this.polygonOffset[1]=-1e3*r.shadowBias,this.polygonOffsetId.setValue(this.polygonOffset))),1===r.shadowUpdateMode&&(r.shadowUpdateMode=0),this._shadowMapUpdates+=c,b.setBlending(!1),b.setDepthWrite(!0),b.setDepthTest(!0),r._isPcf&&b.webgl2&&1!==a?b.setColorWrite(!1,!1,!1,!1):b.setColorWrite(!0,!0,!0,!0),h?c=h+1:h=0;h<c;){for(1===a&&(l.setRotation(zi[h]),o.renderTarget=r._shadowCubeMap[h]),this.setCamera(o,o.renderTarget,!0,1!==a),_=r._visibleList[h],y=r._visibleLength[h],u=r._shadowType+5*a,n=0,d=y;n<d;n++)p=(f=_[n]).mesh,m=f.material,this.setBaseConstants(b,m),this.setSkinning(b,f,m),m.dirty&&(m.updateUniforms(),m.dirty=!1),m.chunks&&(this.setCullMode(!0,!1,f),m.setParameters(b),f.setParameters(b,8)),(s=f._shader[3+u])||(this.updateShader(f,f._shaderDefs,null,3+u),s=f._shader[3+u],f._key[1]=In(f)),b.setShader(s),g=f.renderStyle,this.setVertexBuffers(b,p),this.setMorphing(b,f.morphInstance),b.setIndexBuffer(p.indexBuffer[g]),n+=this.drawInstance(b,f,p,g),this._shadowDrawCalls++;h++,0===a&&(r._visibleLength[e]=-1)}if(r._isVsm){var w=r._vsmBlurSize;if(w>1){var A=o.renderTarget,C=An(b,r._shadowResolution,r._shadowType,1),I=1===r._shadowType,S=r.vsmBlurMode,M=(I?this.blurPackedVsmShader:this.blurVsmShader)[S][w];if(!M){this.blurVsmWeights[w]=wn(w);var T=Ft.fullscreenQuadVS,P="#define SAMPLES "+w+"\n";P+=I?this.blurPackedVsmShaderCode[S]:this.blurVsmShaderCode[S];var E="blurVsm"+S+w+I;M=Jt(this.device,T,P,E),I?this.blurPackedVsmShader[S][w]=M:this.blurVsmShader[S][w]=M}ji.z=r._shadowResolution-2,ji.w=ji.z,this.sourceId.setValue(A.colorBuffer),Fi[0]=1/r._shadowResolution,Fi[1]=0,this.pixelOffsetId.setValue(Fi),1===S&&this.weightId.setValue(this.blurVsmWeights[w]),zt(b,C,M,null,ji),this.sourceId.setValue(C.colorBuffer),Fi[1]=Fi[0],Fi[0]=0,this.pixelOffsetId.setValue(Fi),zt(b,A,M,null,ji)}}}b.webgl2?b.setDepthBias(!1):b.extStandardDerivatives&&(this.polygonOffset[0]=0,this.polygonOffset[1]=0,this.polygonOffsetId.setValue(this.polygonOffset)),b.grabPassAvailable=!0}updateShader(t,e,i,n,r){t.material._scene=this.scene,t.material._dirtyBlend&&(this.scene.layers._dirtyBlend=!0),t.material.updateShader(this.device,this.scene,e,i,n,r),t._shader[n]=t.material.shader}setCullMode(t,e,i){var n=i.material,r=0;if(t){var s=1;if(n.cull>0&&n.cull<3){i.flipFaces&&(s*=-1),e&&(s*=-1);var a=i.node.worldTransform;a.getX(sn),a.getY(an),a.getZ(on),sn.cross(sn,an),sn.dot(on)<0&&(s*=-1)}r=s<0?2===n.cull?1:2:n.cull}if(this.device.setCullMode(r),0===r&&0===n.cull){var o=i.node.worldTransform;o.getX(sn),o.getY(an),o.getZ(on),sn.cross(sn,an),sn.dot(on)<0?this.twoSidedLightingNegScaleFactorId.setValue(-1):this.twoSidedLightingNegScaleFactorId.setValue(1)}}setVertexBuffers(t,e){t.setVertexBuffer(e.vertexBuffer)}setMorphing(t,e){if(e)if(e.morph.useTextureMorph)t.setVertexBuffer(e.morph.vertexBufferIds),this.morphPositionTex.setValue(e.texturePositions),this.morphNormalTex.setValue(e.textureNormals),this.morphTexParams.setValue(e._textureParams);else{for(var i,n,r=0;r<e._activeVertexBuffers.length;r++)(i=e._activeVertexBuffers[r])&&(n="ATTR"+(r+8),i.format.elements[0].name=n,i.format.elements[0].scopeId=t.scope.resolve(n),i.format.update(),t.setVertexBuffer(i));this.morphWeightsA.setValue(e._shaderMorphWeightsA),this.morphWeightsB.setValue(e._shaderMorphWeightsB)}}renderForward(t,e,i,n,r,s,a,o){var l,h,c,u,d,f,p,m,g,v,_,y,b,x,w=this.device,A=this.scene,C=t.vrDisplay,I=o?o._lightHash:0,S=1<<r,M=null,T=.5*w.width;for(l=0;l<i;l++)if(h=e[l],!s||!h.mask||s&h.mask)if(h.command)h.command();else{if(c=h.mesh,u=h.material,d=h._shaderDefs,p=h.mask,this.setSkinning(w,h,u),u&&u===M&&d!==v&&(M=null),(h.isStatic||y)&&(M=null),u!==M&&(this._materialSwitches++,u.dirty&&(u.updateUniforms(),u.dirty=!1),h._shader[r]&&h._shaderDefs===d&&h._lightHash===I||(h.isStatic?this.updateShader(h,d,h._staticLightList,r,n):(f=r+"_"+d+"_"+I,h._shader[r]=u.variants[f],h._shader[r]||(this.updateShader(h,d,null,r,n),u.variants[f]=h._shader[r])),h._shaderDefs=d,h._lightHash=I),h._shader[r].failed||w.setShader(h._shader[r])||(h._shader[r].failed=!0),u.setParameters(w),M&&p===_||(g=this.dispatchDirectLights(n[0],A,p,t),this.dispatchLocalLights(n,A,p,g,h._staticLightList)),this.alphaTestId.setValue(u.alphaTest),w.setBlending(u.blend),u.blend&&(u.separateAlphaBlend?(w.setBlendFunctionSeparate(u.blendSrc,u.blendDst,u.blendSrcAlpha,u.blendDstAlpha),w.setBlendEquationSeparate(u.blendEquation,u.blendAlphaEquation)):(w.setBlendFunction(u.blendSrc,u.blendDst),w.setBlendEquation(u.blendEquation))),w.setColorWrite(u.redWrite,u.greenWrite,u.blueWrite,u.alphaWrite),w.setDepthWrite(u.depthWrite),u.depthWrite&&!u.depthTest?(w.setDepthFunc(7),w.setDepthTest(!0)):(w.setDepthFunc(3),w.setDepthTest(u.depthTest)),w.setAlphaToCoverage(u.alphaToCoverage),u.depthBias||u.slopeDepthBias?(w.setDepthBias(!0),w.setDepthBiasValues(u.depthBias,u.slopeDepthBias)):w.setDepthBias(!1)),this.setCullMode(t._cullFaces,t._flipFaces,h),b=h.stencilFront||u.stencilFront,x=h.stencilBack||u.stencilBack,b||x?(w.setStencilTest(!0),b===x?(w.setStencilFunc(b.func,b.ref,b.readMask),w.setStencilOperation(b.fail,b.zfail,b.zpass,b.writeMask)):(b?(w.setStencilFuncFront(b.func,b.ref,b.readMask),w.setStencilOperationFront(b.fail,b.zfail,b.zpass,b.writeMask)):(w.setStencilFuncFront(7,0,255),w.setStencilOperationFront(0,0,0,255)),x?(w.setStencilFuncBack(x.func,x.ref,x.readMask),w.setStencilOperationBack(x.fail,x.zfail,x.zpass,x.writeMask)):(w.setStencilFuncBack(7,0,255),w.setStencilOperationBack(0,0,0,255)))):w.setStencilTest(!1),h.setParameters(w,S),this.setVertexBuffers(w,c),this.setMorphing(w,h.morphInstance),m=h.renderStyle,w.setIndexBuffer(c.indexBuffer[m]),a&&a(h,l),C&&C.presenting)w.setViewport(0,0,T,w.height),this.projId.setValue(Mi.data),this.projSkyboxId.setValue(Mi.data),this.viewInvId.setValue(Yi.data),this.viewId.setValue(Ki.data),this.viewId3.setValue(tn.data),this.viewProjId.setValue(nn.data),this.viewPos[0]=Qi.x,this.viewPos[1]=Qi.y,this.viewPos[2]=Qi.z,this.viewPosId.setValue(this.viewPos),l+=this.drawInstance(w,h,c,m,!0),this._forwardDrawCalls++,w.setViewport(T,0,T,w.height),this.projId.setValue(Ti.data),this.projSkyboxId.setValue(Ti.data),this.viewInvId.setValue(qi.data),this.viewId.setValue(Ji.data),this.viewId3.setValue(en.data),this.viewProjId.setValue(rn.data),this.viewPos[0]=$i.x,this.viewPos[1]=$i.y,this.viewPos[2]=$i.z,this.viewPosId.setValue(this.viewPos),l+=this.drawInstance2(w,h,c,m),this._forwardDrawCalls++;else if(t.xr&&t.xr.session&&t.xr.views.length)for(var P=t.xr.views,E=0;E<P.length;E++){var k=P[E];w.setViewport(k.viewport.x,k.viewport.y,k.viewport.z,k.viewport.w),this.projId.setValue(k.projMat.data),this.projSkyboxId.setValue(k.projMat.data),this.viewId.setValue(k.viewOffMat.data),this.viewInvId.setValue(k.viewInvOffMat.data),this.viewId3.setValue(k.viewMat3.data),this.viewProjId.setValue(k.projViewOffMat.data),this.viewPosId.setValue(k.position),l+=0===E?this.drawInstance(w,h,c,m,!0):this.drawInstance2(w,h,c,m),this._forwardDrawCalls++}else l+=this.drawInstance(w,h,c,m,!0),this._forwardDrawCalls++;l<i-1&&e[l+1].material===u&&u.setParameters(w,h.parameters),M=u,v=d,_=p,y=h.isStatic}w.updateEnd()}setupInstancing(t){t.enableAutoInstancing&&(fn||(fn=new _t(t,bt.defaultInstancingFormat,t.autoInstancingMaxObjects,1)))}revertStaticMeshes(t){var e,i,n,r=t,s=r.length,a=[];for(e=0;e<s;e++)(i=r[e])._staticSource?i._staticSource!==n&&(a.push(i._staticSource),n=i._staticSource):a.push(i);for(t.length=a.length,e=0;e<a.length;e++)t[e]=a[e]}prepareStaticMeshes(t,e){var i,n,r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,A,C,I,S,M,T,P,E,k,D,O,R,L,N,z,B,F=this.device,j=(this.scene,t),V=j.length,U=[],G=new H,W=new H,X=new st,Z=new Q,Y=[],q=[],K=[],J=[];for(i=0;i<V;i++)if((l=j[i]).isStatic){for(N=l.aabb,J.length=0,L=1;L<=2;L++)for(n=0;n<e.length;n++)if((h=e[n])._type===L&&h.enabled&&h.mask&l.mask&&h.isStatic){if(q[n]||(q[n]=new st,h._node.getWorldTransform(),h.getBoundingSphere(hn),q[n].center.copy(hn.center),q[n].halfExtents.x=hn.radius,q[n].halfExtents.y=hn.radius,q[n].halfExtents.z=hn.radius),!q[n].intersects(N))continue;J.push(n)}if(0===J.length){U.push(l);continue}for(k=(c=l.mesh).vertexBuffer,u=2===(E=c.indexBuffer[l.renderStyle]).bytesPerIndex?new Uint16Array(E.lock()):new Uint32Array(E.lock()),f=c.primitive[l.renderStyle].count/3,v=c.primitive[l.renderStyle].base,p=k.format.elements,m=k.format.size/4,d=new Float32Array(k.storage),r=0;r<p.length;r++)"POSITION"===p[r].name&&(g=p[r].offset/4);for(Y.length=f,r=0;r<f;r++)Y[r]=0;for(P=!1,K.length=6*f,r=0;r<f;r++){for(x=Number.MAX_VALUE,w=Number.MAX_VALUE,A=Number.MAX_VALUE,C=-Number.MAX_VALUE,I=-Number.MAX_VALUE,S=-Number.MAX_VALUE,s=0;s<3;s++)(_=d[o=(o=u[3*r+s+v])*m+g])<x&&(x=_),(y=d[o+1])<w&&(w=y),(b=d[o+2])<A&&(A=b),_>C&&(C=_),y>I&&(I=y),b>S&&(S=b);K[o=6*r]=x,K[o+1]=w,K[o+2]=A,K[o+3]=C,K[o+4]=I,K[o+5]=S}for(a=0;a<J.length;a++)for(h=e[n=J[a]],Z.copy(l.node.worldTransform).invert(),X.setFromTransformedAabb(q[n],Z),M=X.getMin(),T=X.getMax(),z=1<<a,r=0;r<f;r++)K[o=6*r]<=T.x&&K[o+3]>=M.x&&K[o+1]<=T.y&&K[o+4]>=M.y&&K[o+2]<=T.z&&K[o+5]>=M.z&&(Y[r]|=z,P=!0);if(P){for(D={},r=0;r<f;r++)n=3*r+v,D[O=Y[r]]||(D[O]=[]),(R=D[O]).push(u[n]),R.push(u[n+1]),R.push(u[n+2]);for(O in D){R=D[O];var $=new xe(F,E.format,R.length,E.usage);for((2===$.bytesPerIndex?new Uint16Array($.lock()):new Uint32Array($.lock())).set(R),$.unlock(),x=Number.MAX_VALUE,w=Number.MAX_VALUE,A=Number.MAX_VALUE,C=-Number.MAX_VALUE,I=-Number.MAX_VALUE,S=-Number.MAX_VALUE,r=0;r<R.length;r++)(_=d[(o=R[r])*m+g])<x&&(x=_),(y=d[o*m+g+1])<w&&(w=y),(b=d[o*m+g+2])<A&&(A=b),_>C&&(C=_),y>I&&(I=y),b>S&&(S=b);G.set(x,w,A),W.set(C,I,S);var tt=new st;tt.setMinMax(G,W);var et=new Ie(F);et.vertexBuffer=k,et.indexBuffer[0]=$,et.primitive[0].type=4,et.primitive[0].base=0,et.primitive[0].count=R.length,et.primitive[0].indexed=!0,et.aabb=tt;var it=new Ee(l.node,et,l.material);for(it.isStatic=l.isStatic,it.visible=l.visible,it.layer=l.layer,it.castShadow=l.castShadow,it._receiveShadow=l._receiveShadow,it.cull=l.cull,it.pick=l.pick,it.mask=l.mask,it.parameters=l.parameters,it._shaderDefs=l._shaderDefs,it._staticSource=l,l._staticLightList?it._staticLightList=l._staticLightList:it._staticLightList=[],r=0;r<J.length;r++)O&(z=1<<r)&&(B=e[J[r]],it._staticLightList.indexOf(B)<0&&it._staticLightList.push(B));it._staticLightList.sort(this.lightCompare),U.push(it)}}else U.push(l)}else U.push(l);for(t.length=U.length,i=0;i<U.length;i++)t[i]=U[i]}updateShaders(t){for(var e,i=t.length,n=0;n<i;n++)(e=t[n].material)&&(mn.has(e)||(mn.add(e),e.updateShader!==_e.prototype.updateShader&&(e.clearVariants(),e.shader=null)));mn.clear()}updateLitShaders(t){for(var e,i=t.length,n=0;n<i;n++)(e=t[n].material)&&(mn.has(e)||(mn.add(e),e.updateShader!==_e.prototype.updateShader&&(!e.useLighting||e.emitter&&!e.emitter.lighting||(e.clearVariants(),e.shader=null))));mn.clear()}beginFrame(t){var e,i=this.scene,n=t._meshInstances,r=t._lights;i.updateShaders?(this.updateShaders(n),i.updateShaders=!1,i.updateLitShaders=!1,i._shaderVersion++):i.updateLitShaders&&(this.updateLitShaders(n),i.updateLitShaders=!1,i._shaderVersion++),this.updateCpuSkinMatrices(n);var s=n.length;for(e=0;e<s;e++)n[e].visibleThisFrame=!1;for(s=r.length,e=0;e<s;e++)r[e].visibleThisFrame=0===r[e]._type}beginLayers(t){var e,i,n,r,s=this.scene,a=t.layerList.length,o=this.scene._shaderVersion;for(i=0;i<a;i++)t.layerList[i]._postRenderCounter=0;for(i=0;i<a;i++){for((e=t.layerList[i])._shaderVersion=o,e._preRenderCalledForCameras=0,e._postRenderCalledForCameras=0,r=t.subLayerList[i],e._postRenderCounter|=r?2:1,e._postRenderCounterMax=e._postRenderCounter,n=0;n<e.cameras.length;n++)e.instances.visibleOpaque[n]||(e.instances.visibleOpaque[n]=new Ai),e.instances.visibleTransparent[n]||(e.instances.visibleTransparent[n]=new Ai),e.instances.visibleOpaque[n].done=!1,e.instances.visibleTransparent[n].done=!1;e.cameras.length<e.instances.visibleOpaque.length&&e.instances.visibleOpaque.splice(e.cameras.length,1),e.cameras.length<e.instances.visibleTransparent.length&&e.instances.visibleTransparent.splice(e.cameras.length,1),e._needsStaticPrepare&&e._staticLightHash&&(e._staticPrepareDone&&(this.revertStaticMeshes(e.opaqueMeshInstances),this.revertStaticMeshes(e.transparentMeshInstances)),this.prepareStaticMeshes(e.opaqueMeshInstances,e._lights),this.prepareStaticMeshes(e.transparentMeshInstances,e._lights),t._dirty=!0,s.updateShaders=!0,e._needsStaticPrepare=!1,e._staticPrepareDone=!0)}}cullLocalShadowmap(t,e){var i,n,r,s,a,o,l,h,c,u,d,f;if(0!==(n=t._type))for(t.visibleThisFrame=!0,(r=this.getShadowCamera(this.device,t)).projection=0,r.nearClip=t.attenuationEnd/1e3,r.farClip=t.attenuationEnd,r.aspectRatio=1,2===n?(r.fov=2*t._outerConeAngle,a=1):(r.fov=90,a=6),s=r._node,f=t._node,s.setPosition(f.getPosition()),2===n&&(s.setRotation(f.getRotation()),s.rotateLocal(-90,0,0)),o=0;o<a;o++){for(1===n&&(s.setRotation(zi[o]),r.renderTarget=t._shadowCubeMap[o]),this.updateCameraFrustum(r),(c=t._visibleList[o])||(c=t._visibleList[o]=[]),t._visibleLength[o]=0,u=0,i=0,l=e.length;i<l;i++)d=!0,(h=e[i]).cull&&(d=h._isVisible(r)),d&&(c[u]=h,u++,h.visibleThisFrame=!0);t._visibleLength[o]=u,c.length!==u&&(c.length=u),c.sort(this.depthSortCompare)}}cullDirectionalShadowmap(t,e,i,n){var r,s,a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,A,C,I,S,M=this.device;for(t.visibleThisFrame=!0,a=(s=this.getShadowCamera(M,t))._node,o=t._node,a.setPosition(o.getPosition()),a.setRotation(o.getRotation()),a.rotateLocal(-90,0,0),function(t,e,i){var n,r,s=t._nearClip,a=t._fov*Math.PI/180,o=t._aspectRatio,l=t._projection;n=(r=0===l?Math.tan(a/2)*s:t._orthoHeight)*o,i[0].x=n,i[0].y=-r,i[0].z=-s,i[1].x=n,i[1].y=r,i[1].z=-s,i[2].x=-n,i[2].y=r,i[2].z=-s,i[3].x=-n,i[3].y=-r,i[3].z=-s,0===l&&(n=(r=Math.tan(a/2)*e)*o),i[4].x=n,i[4].y=-r,i[4].z=-e,i[5].x=n,i[5].y=r,i[5].z=-e,i[6].x=-n,i[6].y=r,i[6].z=-e,i[7].x=-n,i[7].y=-r,i[7].z=-e}(i,t.shadowDistance||i._farClip,gn),l=ln.sub2(gn[0],gn[6]).length(),l=Math.max(l,ln.sub2(gn[4],gn[6]).length()),Vi.copy(a.getWorldTransform()).invert(),Gi.copy(Vi).mul(i._node.getWorldTransform()),r=0;r<8;r++)Gi.transformPoint(gn[r],gn[r]);for(p=m=g=1e6,v=_=y=-1e6,r=0;r<8;r++)(f=gn[r]).x<p&&(p=f.x),f.x>v&&(v=f.x),f.y<m&&(m=f.y),f.y>_&&(_=f.y),f.z<g&&(g=f.z),f.z>y&&(y=f.z);for(u=l/t._shadowResolution,d=.5*(l-(v-p)),p=Math.floor((p-d)/u)*u,d=.5*(l-(_-m)),b=.5*((v=p+l)+p),x=.5*((_=(m=Math.floor((m-d)/u)*u)+l)+m),a.translateLocal(b,x,1e5),s.projection=1,s.nearClip=0,s.farClip=2e5,s.aspectRatio=1,s.orthoHeight=.5*l,this.updateCameraFrustum(s),I=!0,(c=t._visibleList[n])||(c=t._visibleList[n]=[]),h=t._visibleLength[n]=0,r=0,A=e.length;r<A;r++)w=!0,(C=e[r]).cull&&(w=C._isVisible(s)),w&&(c[h]=C,h++,C.visibleThisFrame=!0,S=C.aabb,I?(cn.copy(S),I=!1):cn.add(S));t._visibleLength[n]=h,c.length!==h&&(c.length=h),c.sort(this.depthSortCompare);var T=function(t,e,i,n,r,s,a){_n[0].x=_n[1].x=_n[2].x=_n[3].x=e.x,_n[1].y=_n[3].y=_n[7].y=_n[5].y=e.y,_n[2].z=_n[3].z=_n[6].z=_n[7].z=e.z,_n[4].x=_n[5].x=_n[6].x=_n[7].x=i.x,_n[0].y=_n[2].y=_n[4].y=_n[6].y=i.y,_n[0].z=_n[1].z=_n[4].z=_n[5].z=i.z;for(var o,l=9999999999,h=-9999999999,c=0;c<8;++c)t.transformPoint(_n[c],_n[c]),(o=_n[c].z)<l&&(l=o),o>h&&(h=o);return{min:l,max:h}}(Vi,cn.getMin(),cn.getMax());y=T.max,T.min>g&&(g=T.min),a.setPosition(o.getPosition()),a.translateLocal(b,x,y+.01),s.farClip=y-g;var P=t._visibleCameraSettings[n];P||(P=t._visibleCameraSettings[n]={});var E=a.getPosition();P.x=E.x,P.y=E.y,P.z=E.z,P.orthoHeight=s.orthoHeight,P.farClip=s.farClip}gpuUpdate(t){this.updateGpuSkinMatrices(t),this.updateMorphing(t)}setSceneConstants(){var t,e=this.device,i=this.scene;if(this.dispatchGlobalLights(i),"none"!==i.fog){if(this.fogColor[0]=i.fogColor.r,this.fogColor[1]=i.fogColor.g,this.fogColor[2]=i.fogColor.b,i.gammaCorrection)for(t=0;t<3;t++)this.fogColor[t]=Math.pow(this.fogColor[t],2.2);this.fogColorId.setValue(this.fogColor),"linear"===i.fog?(this.fogStartId.setValue(i.fogStart),this.fogEndId.setValue(i.fogEnd)):this.fogDensityId.setValue(i.fogDensity)}this._screenSize[0]=e.width,this._screenSize[1]=e.height,this._screenSize[2]=1/e.width,this._screenSize[3]=1/e.height,this.screenSizeId.setValue(this._screenSize)}updateLightStats(t,e){}renderComposition(t){var e,i,n,r,s,a,o,l,h,c,u,d,f,p=this.device,m=t._renderedRt,g=t._renderedByCam,v=t._renderedLayer,_=t._renderActions;this.scene.updateSkybox&&(this.scene._updateSkybox(p),this.scene.updateSkybox=!1),this.beginLayers(t);var y=t._update();2&y&&(this.scene.updateLitShaders=!0),this.updateLightStats(t,y),this.beginFrame(t),this.setSceneConstants();var b,x,w,A,C,I,S=0;for(n=0;n<_.length;n++)if(s=(i=_[n]).layerIndex,(r=t.layerList[s]).enabled&&t.subLayerEnabled[s]&&(a=t.subLayerList[s],b=i.cameraIndex,e=r.cameras[b])){for(e.frameBegin(i.renderTarget),u=!1,d=!1,c=0;c<S;c++)if(g[c]===e&&(u=!0,v[c]===r)){d=!0;break}u||(this.updateCameraFrustum(e.camera),this._camerasRendered++),d||this.cullLights(e.camera,r._lights),u&&d||(g[S]=e,v[S]=r,S++),x=r.instances,(A=a?x.visibleTransparent[b]:x.visibleOpaque[b]).done||(r.onPreCull&&r.onPreCull(l),w=a?r.transparentMeshInstances:r.opaqueMeshInstances,A.length=this.cull(e.camera,w,A.list),A.done=!0,r.onPostCull&&r.onPostCull(b)),e.frameEnd()}for(n=0;n<t._lights.length;n++)(C=t._lights[n]).visibleThisFrame&&0!==C._type&&C.castShadows&&C.enabled&&0!==C.shadowUpdateMode&&(I=t._lightShadowCasters[n],this.cullLocalShadowmap(C,I));var M=-1;for(n=0;n<t._lights.length;n++)if(0===(C=t._lights[n])._type&&(M++,C.castShadows&&C.enabled&&0!==C.shadowUpdateMode))for(I=t._lightShadowCasters[n],o=t._globalLightCameras[M],l=0;l<o.length;l++)this.cullDirectionalShadowmap(C,I,o[l].camera,t._globalLightCameraIds[M][l]);for(this.gpuUpdate(t._meshInstances),this.renderShadows(t._splitLights[2]),this.renderShadows(t._splitLights[1]),S=0,n=0;n<_.length;n++)if(s=(i=_[n]).layerIndex,(r=t.layerList[s]).enabled&&t.subLayerEnabled[s]){if(a=t.subLayerList[s],b=i.cameraIndex,(e=r.cameras[b])&&e.frameBegin(i.renderTarget),!a&&r.onPreRenderOpaque?r.onPreRenderOpaque(b):a&&r.onPreRenderTransparent&&r.onPreRenderTransparent(b),r._preRenderCalledForCameras&1<<b||(r.onPreRender&&r.onPreRender(b),r._preRenderCalledForCameras|=1<<b,r.overrideClear&&this.clearView(e.camera,i.renderTarget,!0,!0,r._clearOptions)),e){for(h=i.renderTarget,f=!1,c=0;c<S;c++)if(m[c]===h&&g[c]===e){f=!0;break}f||(r.overrideClear||this.clearView(e.camera,i.renderTarget,!0,!0),m[S]=h,g[S]=e,S++),this.renderShadows(r._splitLights[0],b),r._sortVisible(a,e.camera.node,b),x=r.instances,A=a?x.visibleTransparent[b]:x.visibleOpaque[b],this.scene._activeCamera=e.camera,this.setCamera(e.camera,i.renderTarget),this.renderForward(e.camera,A.list,A.length,r._splitLights,r.shaderPass,r.cullingMask,r.onDrawCall,r),p.setColorWrite(!0,!0,!0,!0),p.setStencilTest(!1),p.setAlphaToCoverage(!1),p.setDepthBias(!1),e.frameEnd()}!a&&r.onPostRenderOpaque?r.onPostRenderOpaque(b):a&&r.onPostRenderTransparent&&r.onPostRenderTransparent(b),!r.onPostRender||r._postRenderCalledForCameras&1<<b||(r._postRenderCounter&=~(a?2:1),0===r._postRenderCounter&&(r.onPostRender(b),r._postRenderCalledForCameras|=1<<b,r._postRenderCounter=r._postRenderCounterMax))}}}class Mn extends _e{constructor(){super(),this.color=new D(1,1,1,1),this.colorUniform=new Float32Array(4),this.colorMap=null,this.vertexColors=!1}clone(){var t=new Mn;return _e.prototype._cloneInternal.call(this,t),t.color.copy(this.color),t.colorMap=this.colorMap,t.vertexColors=this.vertexColors,t}updateUniforms(){this.clearParameters(),this.colorUniform[0]=this.color.r,this.colorUniform[1]=this.color.g,this.colorUniform[2]=this.color.b,this.colorUniform[3]=this.color.a,this.setParameter("uColor",this.colorUniform),this.colorMap&&this.setParameter("texture_diffuseMap",this.colorMap)}updateShader(t,e,i,n,r,s){var a={skin:!!this.meshInstances[0].skinInstance,vertexColors:this.vertexColors,diffuseMap:!!this.colorMap,pass:r},o=t.getProgramLibrary();this.shader=o.getProgram("basic",a)}}var Tn=new _i;class Pn{constructor(t){this.lineVertexFormat=new bt(t,[{semantic:"POSITION",components:3,type:6},{semantic:"COLOR",components:4,type:1,normalize:!0}]),this.lineBatches=[],this.layers=[],this.layerToBatch={},this.quadMesh=null,this.cubeLocalPos=null,this.cubeWorldPos=null}addLayer(t){this.layers.indexOf(t)<0&&this.layers.push(t)}getLayerIdx(t){return this.layerToBatch[t.id]}addLayerIdx(t,e){this.layerToBatch[e.id]=t}}class En{constructor(){this.numLinesAllocated=128,this.vb=null,this.vbRam=null,this.mesh=null,this.linesUsed=0,this.material=null,this.meshInstance=null,this.layer=null}init(t,e,i,n){for(this.mesh||(this.mesh=new Ie(t),this.mesh.primitive[0].type=1,this.mesh.primitive[0].base=0,this.mesh.primitive[0].indexed=!1,this.material=new Mn,this.material.vertexColors=!0,this.material.blend=!0,this.material.blendType=2,this.material.update()),this.layer=i;this.linesUsed+n>this.numLinesAllocated;)this.vb&&(this.vb.destroy(),this.vb=null),this.numLinesAllocated*=2;this.vertexFormat=e,this.vb||(this.vb=new _t(t,e,2*this.numLinesAllocated,1),this.mesh.vertexBuffer=this.vb,this.vbRam=new DataView(this.vb.lock()),this.meshInstance||(Tn.worldTransform=Q.IDENTITY,Tn._dirtyWorld=Tn._dirtyNormal=!1,this.meshInstance=new Ee(Tn,this.mesh,this.material),this.meshInstance.cull=!1))}addLines(t,e){for(var i,n=!!e.length,r=2*this.linesUsed*this.vertexFormat.size,s=0;s<t.length;s++)this.vbRam.setFloat32(r,t[s].x,!0),r+=4,this.vbRam.setFloat32(r,t[s].y,!0),r+=4,this.vbRam.setFloat32(r,t[s].z,!0),r+=4,i=n?e[s]:e,this.vbRam.setUint8(r,255*i.r),r+=1,this.vbRam.setUint8(r,255*i.g),r+=1,this.vbRam.setUint8(r,255*i.b),r+=1,this.vbRam.setUint8(r,255*i.a),r+=1;this.linesUsed+=t.length/2}finalize(t){this.linesUsed>0&&(this.vb.setData(this.vbRam.buffer),this.mesh.primitive[0].count=2*this.linesUsed,t[0]=this.meshInstance,this.layer.addMeshInstances(t,!0),this.linesUsed=0)}}class kn{constructor(){this.layerIndex=0,this.cameraIndex=0,this.renderTarget=null}}class Dn extends v{constructor(){super(),this.layerList=[],this.subLayerList=[],this.subLayerEnabled=[],this._opaqueOrder={},this._transparentOrder={},this._dirty=!1,this._dirtyBlend=!1,this._dirtyLights=!1,this._dirtyCameras=!1,this._meshInstances=[],this._meshInstancesSet=new Set,this._lights=[],this._lightsMap=new Map,this._lightShadowCasters=[],this._lightShadowCastersSets=[],this._splitLights=[[],[],[]],this._globalLightCameras=[],this.cameras=[],this._globalLightCameraIds=[],this._renderedRt=[],this._renderedByCam=[],this._renderedLayer=[],this._renderActions=[]}_splitLightsArray(t){var e,i=t._lights;t._splitLights[0].length=0,t._splitLights[1].length=0,t._splitLights[2].length=0;for(var n=0;n<i.length;n++)(e=i[n]).enabled&&t._splitLights[e._type].push(e)}_update(){var t,e,i,n,r,s,a,o,l,h,c,u,d=this.layerList.length,f=0;if(!this._dirty||!this._dirtyLights||!this._dirtyCameras)for(t=0;t<d;t++)(r=this.layerList[t])._dirty&&(this._dirty=!0),r._dirtyLights&&(this._dirtyLights=!0),r._dirtyCameras&&(this._dirtyCameras=!0);function p(t,e,i){for(var n,r,s=!1,a=i.length,o=0;o<a;o++)n=i[o],e.has(n)||(e.add(n),t.push(n),(r=n.material)&&r._dirtyBlend&&(s=!0,r._dirtyBlend=!1));return s}if(this._dirty){for(f|=1,this._meshInstances.length=0,this._meshInstancesSet.clear(),t=0;t<d;t++)(r=this.layerList[t]).passThrough||(this._dirtyBlend=p(this._meshInstances,this._meshInstancesSet,r.opaqueMeshInstances)||this._dirtyBlend,this._dirtyBlend=p(this._meshInstances,this._meshInstancesSet,r.transparentMeshInstances)||this._dirtyBlend),r._dirty=!1,r._version++;this._dirty=!1}function m(t,e,i){for(var n,r=0;r<e.length;)((n=e[r].material)&&3!==n.blendType)===i?(t.push(e[r]),e[r]=e[e.length-1],e.length--):r++}if(this._dirtyBlend){for(f|=8,t=0;t<d;t++)(r=this.layerList[t]).passThrough||(m(r.opaqueMeshInstances,r.transparentMeshInstances,!1),m(r.transparentMeshInstances,r.opaqueMeshInstances,!0));this._dirtyBlend=!1}if(this._dirtyLights){for(f|=2,this._lights.length=0,this._lightsMap.clear(),t=0;t<d;t++)for(a=(r=this.layerList[t])._lights,e=0;e<a.length;e++)s=a[e],this._lightsMap.has(s)||(this._lightsMap.set(s,this._lights.length),this._lights.push(s));var g=this._lights.length;for(this._lightShadowCasters.length=g,this._lightShadowCastersSets.length=g,t=0;t<g;t++)this._lightShadowCasters[t]?this._lightShadowCasters[t].length=0:this._lightShadowCasters[t]=[],this._lightShadowCastersSets[t]?this._lightShadowCastersSets[t].clear():this._lightShadowCastersSets[t]=new Set;for(this._splitLightsArray(this),this._dirtyLights=!1,t=0;t<d;t++)r=this.layerList[t],this._splitLightsArray(r),r._dirtyLights=!1}if(f){for(t=0;t<this._lightShadowCasters.length;t++)this._lightShadowCasters[t].length=0,this._lightShadowCastersSets[t].clear();for(t=0;t<d;t++)for(a=(r=this.layerList[t])._lights,e=0;e<a.length;e++)for(u=this._lightsMap.get(a[e]),o=this._lightShadowCasters[u],l=this._lightShadowCastersSets[u],h=r.shadowCasters,i=0;i<h.length;i++)c=h[i],l.has(c)||(l.add(c),o.push(c))}if(2&f||this._dirtyCameras){this._globalLightCameras.length=0;var v=this._splitLights[0];for(n=0;n<v.length;n++)for(s=v[n],this._globalLightCameras[n]=[],t=0;t<d;t++)if((r=this.layerList[t])._splitLights[0].indexOf(s)>=0)for(i=0;i<r.cameras.length;i++)this._globalLightCameras[n].indexOf(r.cameras[i])<0&&this._globalLightCameras[n].push(r.cameras[i])}var _,y,b,x,w=0,A=this._renderActions;function C(t,e,i){var n=A[w];n||(n=A[w]=new kn),n.layerIndex=e,n.cameraIndex=i;var r=t.cameras[i],s=r?r.renderTarget:void 0;n.renderTarget=s||t.renderTarget,w++}if(this._dirtyCameras){for(this._dirtyCameras=!1,f|=4,this.cameras.length=0,t=0;t<d;t++)for((r=this.layerList[t])._dirtyCameras=!1,e=0;e<r.cameras.length;e++)_=r.cameras[e],(y=this.cameras.indexOf(_))<0&&this.cameras.push(_);var I,S,M=0;for(t=0;t<d;t++)if(M)M--;else if(0!==(r=this.layerList[t]).cameras.length||r.isPostEffect)if(0===(I=r._cameraHash))C(r,t,0);else{for(S=1,e=t+1;e<d;e++){if(I!==this.layerList[e]._cameraHash){S=e-t-1;break}e===d-1&&(S=e-t)}if(1===S)for(b=0;b<r.cameras.length;b++)C(r,t,b);else{for(b=0;b<r.cameras.length;b++)for(e=0;e<=S;e++)C(r,t+e,b);M=S}}this._renderActions.length=w}if(2&f||4&f)for(this._globalLightCameraIds.length=0,n=0;n<this._globalLightCameras.length;n++){for(x=[],t=0;t<this._globalLightCameras[n].length;t++)(y=this.cameras.indexOf(this._globalLightCameras[n][t]))<0||x.push(y);this._globalLightCameraIds.push(x)}return f}_isLayerAdded(t){return this.layerList.indexOf(t)>=0}_isSublayerAdded(t,e){for(var i=0;i<this.layerList.length;i++)if(this.layerList[i]===t&&this.subLayerList[i]===e)return!0;return!1}push(t){this._isLayerAdded(t)||(this.layerList.push(t),this.layerList.push(t),this._opaqueOrder[t.id]=this.subLayerList.push(!1)-1,this._transparentOrder[t.id]=this.subLayerList.push(!0)-1,this.subLayerEnabled.push(!0),this.subLayerEnabled.push(!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",t))}insert(t,e){if(!this._isLayerAdded(t)){this.layerList.splice(e,0,t,t),this.subLayerList.splice(e,0,!1,!0);var i=this.layerList.length;this._updateOpaqueOrder(e,i-1),this._updateTransparentOrder(e,i-1),this.subLayerEnabled.splice(e,0,!0,!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",t)}}remove(t){var e=this.layerList.indexOf(t);for(delete this._opaqueOrder[e],delete this._transparentOrder[e];e>=0;)this.layerList.splice(e,1),this.subLayerList.splice(e,1),this.subLayerEnabled.splice(e,1),e=this.layerList.indexOf(t),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("remove",t);var i=this.layerList.length;this._updateOpaqueOrder(0,i-1),this._updateTransparentOrder(0,i-1)}pushOpaque(t){this._isSublayerAdded(t,!1)||(this.layerList.push(t),this._opaqueOrder[t.id]=this.subLayerList.push(!1)-1,this.subLayerEnabled.push(!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",t))}insertOpaque(t,e){if(!this._isSublayerAdded(t,!1)){this.layerList.splice(e,0,t),this.subLayerList.splice(e,0,!1);var i=this.subLayerList.length;this._updateOpaqueOrder(e,i-1),this.subLayerEnabled.splice(e,0,!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",t)}}removeOpaque(t){for(var e=0,i=this.layerList.length;e<i;e++)if(this.layerList[e]===t&&!this.subLayerList[e])return this.layerList.splice(e,1),this.subLayerList.splice(e,1),i--,this._updateOpaqueOrder(e,i-1),this.subLayerEnabled.splice(e,1),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,void(this.layerList.indexOf(t)<0&&this.fire("remove",t))}pushTransparent(t){this._isSublayerAdded(t,!0)||(this.layerList.push(t),this._transparentOrder[t.id]=this.subLayerList.push(!0)-1,this.subLayerEnabled.push(!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",t))}insertTransparent(t,e){if(!this._isSublayerAdded(t,!0)){this.layerList.splice(e,0,t),this.subLayerList.splice(e,0,!0);var i=this.subLayerList.length;this._updateTransparentOrder(e,i-1),this.subLayerEnabled.splice(e,0,!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",t)}}removeTransparent(t){for(var e=0,i=this.layerList.length;e<i;e++)if(this.layerList[e]===t&&this.subLayerList[e])return this.layerList.splice(e,1),this.subLayerList.splice(e,1),i--,this._updateTransparentOrder(e,i-1),this.subLayerEnabled.splice(e,1),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,void(this.layerList.indexOf(t)<0&&this.fire("remove",t))}_getSublayerIndex(t,e){var i=this.layerList.indexOf(t);if(i<0)return-1;if(this.subLayerList[i]!==e){if((i=this.layerList.indexOf(t,i+1))<0)return-1;if(this.subLayerList[i]!==e)return-1}return i}getOpaqueIndex(t){return this._getSublayerIndex(t,!1)}getTransparentIndex(t){return this._getSublayerIndex(t,!0)}getLayerById(t){for(var e=0;e<this.layerList.length;e++)if(this.layerList[e].id===t)return this.layerList[e];return null}getLayerByName(t){for(var e=0;e<this.layerList.length;e++)if(this.layerList[e].name===t)return this.layerList[e];return null}_updateOpaqueOrder(t,e){for(var i=t;i<=e;i++)!1===this.subLayerList[i]&&(this._opaqueOrder[this.layerList[i].id]=i)}_updateTransparentOrder(t,e){for(var i=t;i<=e;i++)!0===this.subLayerList[i]&&(this._transparentOrder[this.layerList[i].id]=i)}_sortLayersDescending(t,e,i){var n=0,r=0,s=0,a=-1,o=-1;for(n=0,r=t.length;n<r;n++)s=t[n],i.hasOwnProperty(s)&&(a=Math.max(a,i[s]));for(n=0,r=e.length;n<r;n++)s=e[n],i.hasOwnProperty(s)&&(o=Math.max(o,i[s]));return-1===a&&-1!==o?1:-1===o&&-1!==a?-1:o-a}sortTransparentLayers(t,e){return this._sortLayersDescending(t,e,this._transparentOrder)}sortOpaqueLayers(t,e){return this._sortLayersDescending(t,e,this._opaqueOrder)}}var On,Rn,Ln=[],Nn=[],zn=new H,Bn=new st,Fn=new st,jn={},Vn=["texture_lightMap","texture_dirLightMap"],Un=[];function Gn(t,e,i,n){if(t.enabled){var r,s;if(t.model&&t.model.model&&t.model.enabled&&(n&&n.push(t),t.model.lightmapped&&e&&(s=t.model.model.meshInstances)),t.render&&t.render.enabled&&(n&&n.push(t),t.render.lightmapped&&e&&(s=t.render.meshInstances)),s){var a=!0;for(r=0;r<s.length;r++)if(!s[r].mesh.vertexBuffer.format.hasUv1){a=!1;break}if(a){var o,l,h=[];for(r=0;r<s.length;r++){for(l=!1,o=0;o<s.length;o++)r!==o&&s[r].mesh===s[o].mesh&&(l=!0);l?(e.push(t),i.push([s[r]])):h.push(s[r])}h.length>0&&(e.push(t),i.push(h))}}for(r=0;r<t._children.length;r++)Gn(t._children[r],e,i,n)}}class Wn{constructor(t,e,i,n,r){this.device=t,this.root=e,this.scene=i,this.renderer=n,this.assets=r}destroy(){this.device=null,this.root=null,this.scene=null,this.renderer=null,this.assets=null}calculateLightmapSize(t){var e,i,n,r,s=this.scene.lightmapSizeMultiplier||16,a=zn;t.model?(r=t.model.lightmapSizeMultiplier,t.model.asset?(e=this.assets.get(t.model.asset).data).area&&(n=e.area):t.model._area&&(e=t.model)._area&&(n=e._area)):t.render&&(r=t.render.lightmapSizeMultiplier,"asset"!==t.render.type&&t.render._area&&(e=t.render)._area&&(n=e._area));var o={x:1,y:1,z:1,uv:1};n&&(o.x=n.x,o.y=n.y,o.z=n.z,o.uv=n.uv);var l=r||1;for(o.x*=l,o.y*=l,o.z*=l,a.copy(t.localScale),i=t._parent;i;)a.mul(i.localScale),i=i._parent;a.x=Math.abs(a.x),a.y=Math.abs(a.y),a.z=Math.abs(a.z);var h=o.x*a.y*a.z+o.y*a.x*a.z+o.z*a.x*a.y;return h/=o.uv,h=Math.sqrt(h),Math.min(k.nextPowerOfTwo(h*s),this.scene.lightmapMaxResolution||2048)}bake(t,e){var i,n,r,s=this.device,a=this.scene,o=1;void 0===e&&(e=1),1===e&&(o=2);var l=[],h=[];if(t){var c;for(i=Nn.length-1;i>=0;i--)for(n=0;n<t.length;n++)if(Nn[i]===t[n]){for(c=0;c<Ln[i].length;c++)Ln[i][c].destroy();Ln.splice(i,1),Nn.splice(i,1)}var u=[];for(i=0;i<t.length;i++)Gn(t[i],u,h);t=u,Gn(this.root,null,null,l)}else{for(i=0;i<Ln.length;i++)for(n=0;n<Ln[i].length;n++)Ln[i][n].destroy();Ln=[],Nn=[],t=[],Gn(this.root,t,h,l)}if(0!==t.length){var d=!1;a._needsStaticPrepare&&(a._needsStaticPrepare=!1,d=!0);var f,p,m=[[],[]],g={},v=new pe(this.device,{width:4,height:4,format:7,type:"rgbm"});for(v.name="lightmap",i=0;i<t.length;i++){for(f=this.calculateLightmapSize(t[i]),r=0;r<o;r++)(p=new pe(s,{width:f,height:f,format:7,mipmaps:!1,type:0===r?"rgbm":"default",minFilter:0,magFilter:0})).name="lightmap",m[r].push(p);if(!g[f]){var _=new pe(s,{width:f,height:f,format:7,mipmaps:!1,type:"rgbm",minFilter:0,magFilter:0});_.name="lightmap";var y=new Cf(s,_,{depth:!1});g[f]=y}}var b=a.layers;b._update();var x,w=[],A=[],C=[],I=[],S=b._lights;for(i=0;i<S.length;i++)S[i].enabled&&0!=(4&(x=S[i].mask))&&(A.push(x),C.push(S[i].shadowUpdateMode),S[i].mask=4294967295,S[i].shadowUpdateMode=0===S[i]._type?2:1,w.push(S[i]),S[i].isStatic=!1),I.push(S[i].enabled),S[i].enabled=!1;var M="#define UV1LAYOUT\n"+Ft.transformVS,T=Ft.bakeLmEndPS,P=Ft.dilatePS,E=Jt(s,Ft.fullscreenQuadVS,P,"lmDilate"),k=s.scope.resolve("source"),O=s.scope.resolve("pixelOffset"),R=s.scope.resolve("bakeDir"),L=new Float32Array(2),z=b._meshInstances;for(i=0;i<z.length;i++)z[i].node&&z[i].node.getWorldTransform();var B,F,j,V,U=a.fog,G=a.ambientLight.r,W=a.ambientLight.g,H=a.ambientLight.b;a.fog="none",a.ambientLight.set(0,0,0),On||((On=new Qe).clearColor=new D(0,0,0,0),On.clearColorBuffer=!0,On.clearDepthBuffer=!1,On.clearStencilBuffer=!1,On.frustumCulling=!1,On.node=new _i);var X,Z=function(t){return t.render?t.render:t.model},Y=function(t){return t.render?t.render.meshInstances:t.model.model.meshInstances},q=[];for(q.length=Nn.length,B=0;B<l.length;B++){for(j=Y(l[B]),X=[],i=0;i<j.length;i++)X.push(j[i]._shaderDefs),j[i]._shaderDefs&=-193;for(i=0;i<Nn.length;i++)if(Nn[i]===l[B]){q[i]=X;break}}var K,J,Q=[],$=[];for(B=0;B<l.length;B++)if(J=Z(l[B]),Q[B]=J.castShadows,J.castShadows=J.castShadowsLightmap,J.castShadowsLightmap)for(K=Y(l[B]),i=0;i<K.length;i++)K[i].visibleThisFrame=!0,$.push(K[i]);this.renderer.updateCpuSkinMatrices($),this.renderer.gpuUpdate($);var tt,et,it,nt,rt,at,ot=[],lt=[],ht=[[],[]],ct=[];for(ct.length=t.length,r=0;r<o;r++)Un[r]||((at=new af).chunks.transformVS=M,0===r?(at.chunks.endPS=T,at.ambient=new D(0,0,0),at.ambientTint=!0,at.lightMap=v):(at.chunks.basePS=Ft.basePS+"\nuniform sampler2D texture_dirLightMap;\nuniform float bakeDir;\n",at.chunks.endPS=Ft.bakeDirLmEndPS),at.chunks.outputAlphaPS="\n",at.chunks.outputAlphaOpaquePS="\n",at.chunks.outputAlphaPremulPS="\n",at.cull=0,at.forceUv1=!0,at.update(),at.updateShader(s,a),at.name="lmMaterial"+r,Un[r]=at);for(B=0;B<t.length;B++){if(j=h[B],ct[B]=0,j.length>0)for(Bn.copy(j[0].aabb),i=0;i<j.length;i++)j[i].node.getWorldTransform(),Bn.add(j[i].aabb);var ut=new st;for(ut.copy(Bn),lt.push(ut),i=0;i<j.length;i++)(V=j[i])._shaderDefs&=-193,V.mask=4,V.deleteParameter("texture_lightMap"),V.deleteParameter("texture_dirLightMap"),V.setParameter("texture_lightMap",V.material.lightMap?V.material.lightMap:v),V.setParameter("texture_dirLightMap",v);for(r=0;r<o;r++)F=m[r][B],tt=new Cf(s,F,{depth:!1}),ht[r].push(tt)}for(n=0;n<w.length;n++)w[n].enabled=!1;var dt,ft,pt=[[],[],[]],mt=!1;for(i=0;i<w.length;i++){for(w[i].enabled=!0,dt=!1,w[i]._cacheShadowMap=!0,0!==w[i]._type&&(w[i]._node.getWorldTransform(),w[i].getBoundingSphere(jn),Fn.center=jn.center,Fn.halfExtents.x=jn.radius,Fn.halfExtents.y=jn.radius,Fn.halfExtents.z=jn.radius),2===w[i]._type&&(nt=w[i],(rt=this.renderer.getShadowCamera(s,nt))._node.setPosition(nt._node.getPosition()),rt._node.setRotation(nt._node.getRotation()),rt._node.rotateLocal(-90,0,0),rt.projection=0,rt.nearClip=nt.attenuationEnd/1e3,rt.farClip=nt.attenuationEnd,rt.aspectRatio=1,rt.fov=2*nt._outerConeAngle,this.renderer.updateCameraFrustum(rt)),h.length>0&&this.renderer.updateShaders(h[0]),B=0;B<t.length;B++){if(j=h[B],Bn=lt[B],0===w[i]._type){zn.copy(Bn.center),zn.y+=Bn.halfExtents.y,On.node.setPosition(zn),On.node.setEulerAngles(-90,0,0);var gt=Math.max(Bn.halfExtents.x,Bn.halfExtents.z);On.projection=1,On.nearClip=0,On.farClip=2*Bn.halfExtents.y,On.aspectRatio=1,On.orthoHeight=gt}else if(!Fn.intersects(Bn))continue;if(2===w[i]._type){var vt=!1;for(n=0;n<j.length;n++)if(j[n]._isVisible(rt)){vt=!0;break}if(!vt)continue}for(0===w[i]._type?(pt[0][0]=w[i],pt[1].length=0,pt[2].length=0,!dt&&w[i].castShadows&&(this.renderer.cullDirectionalShadowmap(w[i],$,On,0),this.renderer.renderShadows(pt[0],0),dt=!0)):(pt[0].length=0,1===w[i]._type?(pt[1][0]=w[i],pt[2].length=0,!dt&&w[i].castShadows&&(this.renderer.cullLocalShadowmap(w[i],$),this.renderer.renderShadows(pt[1]),dt=!0)):(pt[1].length=0,pt[2][0]=w[i],!dt&&w[i].castShadows&&(this.renderer.cullLocalShadowmap(w[i],$),this.renderer.renderShadows(pt[2]),dt=!0))),n=0;n<j.length;n++)ot[n]=j[n].material;for(r=0;r<o;r++){for(F=m[r][B],tt=ht[r][B],it=(et=g[F.width]).colorBuffer,0===r?mt=a.updateShaders:mt&&(a.updateShaders=!0),n=0;n<j.length;n++)j[n].material=Un[r];for(o>1&&this.renderer.updateShaders(j),this.renderer.setCamera(On,et,!0),1===r&&R.setValue(w[i].bakeDir?1:0),this.renderer._forwardTime=0,this.renderer._shadowMapTime=0,this.renderer.renderForward(On,j,j.length,pt,1),m[r][B]=it,ht[r][B]=et,g[F.width]=tt,n=0;n<j.length;n++)(V=j[n]).setParameter(Vn[r],it),V._shaderDefs|=64}for(ct[B]++,n=0;n<j.length;n++)j[n].material=ot[n]}w[i].enabled=!1,w[i]._cacheShadowMap=!1,w[i]._isCachedShadowMap&&w[i]._destroyShadowMap()}for(B=0;B<t.length;B++){for(j=h[B],ft=[],r=0;r<o;r++){F=m[r][B],tt=ht[r][B],it=(et=g[F.width]).colorBuffer;for(L[0]=1/F.width,L[1]=1/F.height,O.setValue(L),i=0;i<4;i++)k.setValue(F),zt(s,et,E),k.setValue(it),zt(s,tt,E);for(i=0;i<j.length;i++)(V=j[i]).mask=2,j[i].setParameter(Vn[r],F),1===r&&(j[i]._shaderDefs|=128);ft[r]=F,r===o-1&&tt.destroy()}Ln.push(ft),Nn.push(t[B])}for(var _t in g)g.hasOwnProperty(_t)&&(g[_t].colorBuffer.destroy(),g[_t].destroy());for(i=0;i<Ln.length;i++)for(n=0;n<Ln[i].length;n++)(p=Ln[i][n]).minFilter=1,p.magFilter=1;for(B=0;B<l.length;B++)Z(l[B]).castShadows=Q[B];for(i=0;i<q.length;i++)if(q[i])for(j=Y(Nn[i]),n=0;n<j.length;n++)j[n]._shaderDefs|=192&q[i][n];for(i=0;i<w.length;i++)w[i].mask=A[i],w[i].shadowUpdateMode=C[i];for(i=0;i<S.length;i++)S[i].enabled=I[i];a.fog=U,a.ambientLight.set(G,W,H),d&&(a._needsStaticPrepare=!0)}else s.fire("lightmapper:end",{timestamp:N(),target:this})}}var Hn=1,Xn=new Q,Zn=new Q,Yn=new H,qn=new H,Kn=new H,Jn=new H,Qn=new H,$n=new H,tr=new H,er=new H,ir=new H,nr=new H,rr=new H,sr=new H,ar=new H;function or(t){return t-Math.floor(t)}function lr(t){return Math.max(Math.min(t,1),0)}function hr(t,e){return t-e*Math.floor(t/e)}function cr(t){var e=or(t),i=or(255*t);return[e-=i/255,i-=i/255]}class ur{constructor(t){this._emitter=t}calcSpawnPosition(t,e,i,n,r){var s,a,o,l,h,c,u=this._emitter,d=Math.random(),f=Math.random(),p=Math.random(),m=Math.random();if(u.useCpu&&(t[4*r+0+2*u.numParticlesPot*4]=d,t[4*r+1+2*u.numParticlesPot*4]=f,t[4*r+2+2*u.numParticlesPot*4]=p),qn.x=d-.5,qn.y=f-.5,qn.z=p-.5,0===u.emitterShape){var g=Math.max(Math.abs(qn.x),Math.max(Math.abs(qn.y),Math.abs(qn.z))),v=g+(.5-g)*i[0],_=g+(.5-g)*i[1],y=g+(.5-g)*i[2];qn.x=v*(g==Math.abs(qn.x)?Math.sign(qn.x):2*qn.x),qn.y=_*(g==Math.abs(qn.y)?Math.sign(qn.y):2*qn.y),qn.z=y*(g==Math.abs(qn.z)?Math.sign(qn.z):2*qn.z),u.localSpace?Yn.copy(e.transformPoint(qn)):Yn.copy(n).add(e.transformPoint(qn))}else{qn.normalize();var b=0===u.emitterRadius?0:u.emitterRadiusInner/u.emitterRadius,x=m*(1-b)+b;u.localSpace?Yn.copy(qn.scale(x*u.emitterRadius)):Yn.copy(n).add(qn.scale(x*u.emitterRadius))}if(s=-k.lerp(u.rate,u.rate2,d)*r,u.pack8){var w=(Yn.x-u.worldBounds.center.x)/u.worldBoundsSize.x+.5,A=(Yn.y-u.worldBounds.center.y)/u.worldBoundsSize.y+.5,C=(Yn.z-u.worldBounds.center.z)/u.worldBoundsSize.z+.5,I=k.lerp(u.startAngle*k.DEG_TO_RAD,u.startAngle2*k.DEG_TO_RAD,d);I=I%(2*Math.PI)/(2*Math.PI);var S=cr(w);t[4*r]=S[0],t[4*r+1]=S[1];var M=cr(A);t[4*r+2]=M[0],t[4*r+3]=M[1];var T=cr(C);t[4*r+0+4*u.numParticlesPot]=T[0],t[4*r+1+4*u.numParticlesPot]=T[1];var P=cr(I);t[4*r+2+4*u.numParticlesPot]=P[0],t[4*r+3+4*u.numParticlesPot]=P[1];t[4*r+3+4*u.numParticlesPot*2]=1;var E=Math.max(u.lifetime,(u.numParticles-1)*Math.max(u.rate,u.rate2)),D=u.lifetime+1,O=(o=or(a=s=(s+E)/(E+D)),l=or(255*a),h=or(65025*a),c=or(160581375*a),[o-=l/255,l-=h/255,h-=c/255,c-=c/255]);t[4*r+0+4*u.numParticlesPot*3]=O[0],t[4*r+1+4*u.numParticlesPot*3]=O[1],t[4*r+2+4*u.numParticlesPot*3]=O[2],t[4*r+3+4*u.numParticlesPot*3]=O[3]}else t[4*r]=Yn.x,t[4*r+1]=Yn.y,t[4*r+2]=Yn.z,t[4*r+3]=k.lerp(u.startAngle*k.DEG_TO_RAD,u.startAngle2*k.DEG_TO_RAD,d),t[4*r+3+4*u.numParticlesPot]=s}update(t,e,i,n,r,s,a,o){var l,h,c,u,d,f=this._emitter;if(f.meshInstance.node){var p=f.meshInstance.node.worldTransform;for(d=0;d<12;d++)Xn.data[d]=p.data[d];Zn.copy(Xn),Zn.invert(),Rn=f.meshInstance.node.localScale,Hn=Math.max(Math.max(Rn.x,Rn.y),Rn.z)}s=null===f.meshInstance.node||f.localSpace?H.ZERO:f.meshInstance.node.getPosition();var m,g,v,_,y,b,x,w,A=f.camera?f.camera._node.getPosition():H.ZERO,C=f.useMesh?17:15,I=f.precision-1;for(u=0;u<f.numParticles;u++){var S=Math.floor(f.vbCPU[u*f.numParticleVerts*(f.useMesh?6:4)+3]),M=i[4*S+0+2*f.numParticlesPot*4];Kn.x=M,Kn.y=i[4*S+1+2*f.numParticlesPot*4],Kn.z=i[4*S+2+2*f.numParticlesPot*4];var T=f.rate+(f.rate2-f.rate)*M,P=f.lifetime,E=i[4*S+3+4*f.numParticlesPot]+a,k=lr(E/P),D=0,O=0;(E-a<=0||E>=P)&&this.calcSpawnPosition(i,n,r,s,S);var R=E>0&&E<P;R&&(c=k*I,m=Math.floor(c),g=Math.ceil(c),c%=1,v=(l=f.qRotSpeed[m])+((h=f.qRotSpeed[g])-l)*c,_=(l=f.qRotSpeed2[m])+((h=f.qRotSpeed2[g])-l)*c,D=(l=f.qScale[m])+((h=f.qScale[g])-l)*c,y=(l=f.qScale2[m])+((h=f.qScale2[g])-l)*c,b=(l=f.qAlpha[m])+((h=f.qAlpha[g])-l)*c,x=(l=f.qAlpha2[m])+((h=f.qAlpha2[g])-l)*c,w=(l=f.qRadialSpeed[m])+((h=f.qRadialSpeed[g])-l)*c,w+=100*M%1*((l=f.qRadialSpeed2[m])+((h=f.qRadialSpeed2[g])-l)*c-w),Jn.x=i[4*S],Jn.y=i[4*S+1],Jn.z=i[4*S+2],f.localSpace?ir.copy(Jn):ir.copy(Jn).sub(s),ir.normalize().scale(w),m*=3,g*=3,l=f.qLocalVelocity[m],h=f.qLocalVelocity[g],$n.x=l+(h-l)*c,l=f.qLocalVelocity[m+1],h=f.qLocalVelocity[g+1],$n.y=l+(h-l)*c,l=f.qLocalVelocity[m+2],h=f.qLocalVelocity[g+2],$n.z=l+(h-l)*c,l=f.qLocalVelocity2[m],h=f.qLocalVelocity2[g],er.x=l+(h-l)*c,l=f.qLocalVelocity2[m+1],h=f.qLocalVelocity2[g+1],er.y=l+(h-l)*c,l=f.qLocalVelocity2[m+2],h=f.qLocalVelocity2[g+2],er.z=l+(h-l)*c,l=f.qVelocity[m],h=f.qVelocity[g],Qn.x=l+(h-l)*c,l=f.qVelocity[m+1],h=f.qVelocity[g+1],Qn.y=l+(h-l)*c,l=f.qVelocity[m+2],h=f.qVelocity[g+2],Qn.z=l+(h-l)*c,l=f.qVelocity2[m],h=f.qVelocity2[g],tr.x=l+(h-l)*c,l=f.qVelocity2[m+1],h=f.qVelocity2[g+1],tr.y=l+(h-l)*c,l=f.qVelocity2[m+2],h=f.qVelocity2[g+2],tr.z=l+(h-l)*c,$n.x+=(er.x-$n.x)*Kn.x,$n.y+=(er.y-$n.y)*Kn.y,$n.z+=(er.z-$n.z)*Kn.z,f.initialVelocity>0&&(1===f.emitterShape?(qn.copy(Kn).scale(2).sub(H.ONE).normalize(),$n.add(qn.scale(f.initialVelocity))):$n.add(H.FORWARD.scale(f.initialVelocity))),Qn.x+=(tr.x-Qn.x)*Kn.x,Qn.y+=(tr.y-Qn.y)*Kn.y,Qn.z+=(tr.z-Qn.z)*Kn.z,v+=(_-v)*Kn.y,D=(D+1e4*M%1*(y-D))*Hn,O=1e3*M%1*(x-b),f.meshInstance.node&&(f.localSpace?($n.x/=Rn.x,$n.y/=Rn.y,$n.z/=Rn.z):Xn.transformPoint($n,$n)),f.localSpace?(Zn.transformPoint(Qn,Qn),$n.add(Qn).add(ir)):($n.add(Qn.mul(Rn)),$n.add(ir.mul(Rn))),sr.copy($n),nr.copy(Jn).add($n.scale(a)),rr.copy(nr),i[4*S]=rr.x,i[4*S+1]=rr.y,i[4*S+2]=rr.z,i[4*S+3]+=v*a,f.wrap&&f.wrapBounds&&(f.localSpace||rr.sub(s),rr.x=hr(rr.x,f.wrapBounds.x)-.5*f.wrapBounds.x,rr.y=hr(rr.y,f.wrapBounds.y)-.5*f.wrapBounds.y,rr.z=hr(rr.z,f.wrapBounds.z)-.5*f.wrapBounds.z,f.localSpace||rr.add(s)),f.sort>0&&(1===f.sort?(ar.copy(rr).sub(A),f.particleDistance[S]=-(ar.x*ar.x+ar.y*ar.y+ar.z*ar.z)):2===f.sort?f.particleDistance[S]=E:3===f.sort&&(f.particleDistance[S]=-E))),o?E<0&&(i[4*S+3+2*f.numParticlesPot*4]=-1):(E>=P&&(E-=Math.max(P,(f.numParticles-1)*T),i[4*S+3+2*f.numParticlesPot*4]=f.loop?1:-1),E<0&&f.loop&&(i[4*S+3+2*f.numParticlesPot*4]=1)),i[4*S+3+2*f.numParticlesPot*4]<0&&(R=!1),i[4*S+3+4*f.numParticlesPot]=E;for(var L=0;L<f.numParticleVerts;L++){var N=(u*f.numParticleVerts+L)*(f.useMesh?6:4),z=f.vbCPU[N],B=f.vbCPU[N+1],F=f.vbCPU[N+2];R||(z=B=F=0);var j=u*f.numParticleVerts*C+L*C;t[j]=rr.x,t[j+1]=rr.y,t[j+2]=rr.z,t[j+3]=k,t[j+4]=f.alignToMotion?0:i[4*S+3],t[j+5]=D,t[j+6]=O,t[j+7]=sr.x,t[j+8]=z,t[j+9]=B,t[j+10]=F,t[j+11]=sr.y,t[j+12]=S,t[j+13]=sr.z,t[j+14]=f.vbCPU[N+3],f.useMesh&&(t[j+15]=f.vbCPU[N+4],t[j+16]=f.vbCPU[N+5])}}if(f.sort>0&&f.camera){var V=f.useMesh?6:4,U=f.particleDistance;for(u=0;u<f.numParticles;u++)e[u][0]=u,e[u][1]=U[Math.floor(f.vbCPU[u*f.numParticleVerts*V+3])];for(f.vbOld.set(f.vbCPU),e.sort((function(t,e){return t[1]-e[1]})),u=0;u<f.numParticles;u++){var G=e[u][0]*f.numParticleVerts*V,W=u*f.numParticleVerts*V;for(d=0;d<f.numParticleVerts*V;d++)f.vbCPU[W+d]=f.vbOld[G+d]}}}}var dr=new G,fr=new G,pr=new G;class mr{constructor(t,e){this.randomize=function(){this.frameRandomUniform[0]=Math.random(),this.frameRandomUniform[1]=Math.random(),this.frameRandomUniform[2]=Math.random()},this._emitter=t,this.frameRandomUniform=new Float32Array(3),this.emitterPosUniform=new Float32Array(3),this.emitterScaleUniform=new Float32Array([1,1,1]),this.worldBoundsMulUniform=new Float32Array(3),this.worldBoundsAddUniform=new Float32Array(3),this.inBoundsSizeUniform=new Float32Array(3),this.inBoundsCenterUniform=new Float32Array(3),this.constantParticleTexIN=e.scope.resolve("particleTexIN"),this.constantParticleTexOUT=e.scope.resolve("particleTexOUT"),this.constantEmitterPos=e.scope.resolve("emitterPos"),this.constantEmitterScale=e.scope.resolve("emitterScale"),this.constantSpawnBounds=e.scope.resolve("spawnBounds"),this.constantSpawnPosInnerRatio=e.scope.resolve("spawnPosInnerRatio"),this.constantSpawnBoundsSphere=e.scope.resolve("spawnBoundsSphere"),this.constantSpawnBoundsSphereInnerRatio=e.scope.resolve("spawnBoundsSphereInnerRatio"),this.constantInitialVelocity=e.scope.resolve("initialVelocity"),this.constantFrameRandom=e.scope.resolve("frameRandom"),this.constantDelta=e.scope.resolve("delta"),this.constantRate=e.scope.resolve("rate"),this.constantRateDiv=e.scope.resolve("rateDiv"),this.constantLifetime=e.scope.resolve("lifetime"),this.constantGraphSampleSize=e.scope.resolve("graphSampleSize"),this.constantGraphNumSamples=e.scope.resolve("graphNumSamples"),this.constantInternalTex0=e.scope.resolve("internalTex0"),this.constantInternalTex1=e.scope.resolve("internalTex1"),this.constantInternalTex2=e.scope.resolve("internalTex2"),this.constantInternalTex3=e.scope.resolve("internalTex3"),this.constantEmitterMatrix=e.scope.resolve("emitterMatrix"),this.constantEmitterMatrixInv=e.scope.resolve("emitterMatrixInv"),this.constantNumParticles=e.scope.resolve("numParticles"),this.constantNumParticlesPot=e.scope.resolve("numParticlesPot"),this.constantLocalVelocityDivMult=e.scope.resolve("localVelocityDivMult"),this.constantVelocityDivMult=e.scope.resolve("velocityDivMult"),this.constantRotSpeedDivMult=e.scope.resolve("rotSpeedDivMult"),this.constantSeed=e.scope.resolve("seed"),this.constantStartAngle=e.scope.resolve("startAngle"),this.constantStartAngle2=e.scope.resolve("startAngle2"),this.constantOutBoundsMul=e.scope.resolve("outBoundsMul"),this.constantOutBoundsAdd=e.scope.resolve("outBoundsAdd"),this.constantInBoundsSize=e.scope.resolve("inBoundsSize"),this.constantInBoundsCenter=e.scope.resolve("inBoundsCenter"),this.constantMaxVel=e.scope.resolve("maxVel"),this.constantFaceTangent=e.scope.resolve("faceTangent"),this.constantFaceBinorm=e.scope.resolve("faceBinorm")}_setInputBounds(){this.inBoundsSizeUniform[0]=this._emitter.prevWorldBoundsSize.x,this.inBoundsSizeUniform[1]=this._emitter.prevWorldBoundsSize.y,this.inBoundsSizeUniform[2]=this._emitter.prevWorldBoundsSize.z,this.constantInBoundsSize.setValue(this.inBoundsSizeUniform),this.inBoundsCenterUniform[0]=this._emitter.prevWorldBoundsCenter.x,this.inBoundsCenterUniform[1]=this._emitter.prevWorldBoundsCenter.y,this.inBoundsCenterUniform[2]=this._emitter.prevWorldBoundsCenter.z,this.constantInBoundsCenter.setValue(this.inBoundsCenterUniform)}update(t,e,i,n,r){var s=this._emitter;t.setBlending(!1),t.setColorWrite(!0,!0,!0,!0),t.setCullMode(0),t.setDepthTest(!1),t.setDepthWrite(!1),this.randomize(),this.constantGraphSampleSize.setValue(1/s.precision),this.constantGraphNumSamples.setValue(s.precision),this.constantNumParticles.setValue(s.numParticles),this.constantNumParticlesPot.setValue(s.numParticlesPot),this.constantInternalTex0.setValue(s.internalTex0),this.constantInternalTex1.setValue(s.internalTex1),this.constantInternalTex2.setValue(s.internalTex2),this.constantInternalTex3.setValue(s.internalTex3);var a=s.meshInstance.node,o=null===a?H.ONE:a.localScale;if(s.pack8){this.worldBoundsMulUniform[0]=s.worldBoundsMul.x,this.worldBoundsMulUniform[1]=s.worldBoundsMul.y,this.worldBoundsMulUniform[2]=s.worldBoundsMul.z,this.constantOutBoundsMul.setValue(this.worldBoundsMulUniform),this.worldBoundsAddUniform[0]=s.worldBoundsAdd.x,this.worldBoundsAddUniform[1]=s.worldBoundsAdd.y,this.worldBoundsAddUniform[2]=s.worldBoundsAdd.z,this.constantOutBoundsAdd.setValue(this.worldBoundsAddUniform),this._setInputBounds();var l=s.maxVel*Math.max(Math.max(o.x,o.y),o.z);l=Math.max(l,1),this.constantMaxVel.setValue(l)}var h=null===a||s.localSpace?H.ZERO:a.getPosition(),c=null===a?Q.IDENTITY:a.getWorldTransform();0===s.emitterShape?(dr.setFromMat4(e),this.constantSpawnBounds.setValue(dr.data),this.constantSpawnPosInnerRatio.setValue(i)):(this.constantSpawnBoundsSphere.setValue(s.emitterRadius),this.constantSpawnBoundsSphereInnerRatio.setValue(0===s.emitterRadius?0:s.emitterRadiusInner/s.emitterRadius)),this.constantInitialVelocity.setValue(s.initialVelocity),fr.setFromMat4(c),c.invertTo3x3(pr),this.emitterPosUniform[0]=h.x,this.emitterPosUniform[1]=h.y,this.emitterPosUniform[2]=h.z,this.constantEmitterPos.setValue(this.emitterPosUniform),this.constantFrameRandom.setValue(this.frameRandomUniform),this.constantDelta.setValue(n),this.constantRate.setValue(s.rate),this.constantRateDiv.setValue(s.rate2-s.rate),this.constantStartAngle.setValue(s.startAngle*k.DEG_TO_RAD),this.constantStartAngle2.setValue(s.startAngle2*k.DEG_TO_RAD),this.constantSeed.setValue(s.seed),this.constantLifetime.setValue(s.lifetime),this.emitterScaleUniform[0]=o.x,this.emitterScaleUniform[1]=o.y,this.emitterScaleUniform[2]=o.z,this.constantEmitterScale.setValue(this.emitterScaleUniform),this.constantEmitterMatrix.setValue(fr.data),this.constantEmitterMatrixInv.setValue(pr.data),this.constantLocalVelocityDivMult.setValue(s.localVelocityUMax),this.constantVelocityDivMult.setValue(s.velocityUMax),this.constantRotSpeedDivMult.setValue(s.rotSpeedUMax[0]);var u=s.swapTex?s.particleTexOUT:s.particleTexIN;u=s.beenReset?s.particleTexStart:u;var d=s.swapTex?s.particleTexIN:s.particleTexOUT;this.constantParticleTexIN.setValue(u),zt(t,s.swapTex?s.rtParticleTexIN:s.rtParticleTexOUT,r?s.shaderParticleUpdateOnStop:s.loop?s.shaderParticleUpdateRespawn:s.shaderParticleUpdateNoRespawn),s.material.setParameter("particleTexOUT",u),s.material.setParameter("particleTexIN",d),s.beenReset=!1,s.swapTex=!s.swapTex,t.setDepthTest(!0),t.setDepthWrite(!0),s.prevWorldBoundsSize.copy(s.worldBoundsSize),s.prevWorldBoundsCenter.copy(s.worldBounds.center),s.pack8&&this._setInputBounds()}}const gr=[[-1,-1],[1,-1],[1,1],[-1,1]];var vr=function(t,e,i,n,r=14,s,a){var o=0;a&&7===r&&(o=1);var l=new pe(t,{width:e,height:i,format:r,cubemap:!1,mipmaps:!1,minFilter:o,magFilter:o,addressU:1,addressV:1});l.name="PSTexture";var h=l.lock();if(7===r){for(var c=new Uint8Array(n.length),u=0;u<n.length;u++)c[u]=n[u]*s*255;n=c}return h.set(n),l.unlock(),l};function _r(t){return Math.max(Math.min(t,1),0)}var yr,br,xr=new V([0,0,1,0]),wr=new V([0,1,1,1]),Ar=new U([0,0,1,0],[0,0,1,0],[0,0,1,0]),Cr=new U([0,1,1,1],[0,1,1,1],[0,1,1,1]),Ir=2,Sr=new Float32Array(3),Mr=new Q,Tr=new H,Pr=new H,Er=new H;function kr(t,e){void 0!==br[t]&&null!==br[t]?yr[t]=br[t]:yr[t]=e}function Dr(t,e,i){return(255*t<<16|255*e<<8|255*i)/(1<<24)}function Or(t,e){for(var i=t.length/3,n=new Array(4*i),r=0;r<i;r++)n[4*r]=t[3*r],n[4*r+1]=t[3*r+1],n[4*r+2]=t[3*r+2],n[4*r+3]=Dr(e[3*r],e[3*r+1],e[3*r+2]);return n}function Rr(t,e){var i,n,r=e.length,s=t.length/r;for(i=0;i<s;i++)for(n=0;n<r;n++){var a=Math.abs(t[i*r+n]);e[n]=Math.max(e[n],a)}}function Lr(t,e,i){var n=function(t,e){for(var i=new Float32Array(t.length),n=0;n<t.length;n++)i[n]=t[n]-e[n];return i}(e,t);return Rr(n,i),function(t,e){var i,n,r=e.length,s=t.length/r;for(i=0;i<s;i++)for(n=0;n<r;n++)t[i*r+n]/=0===e[n]?1:e[n],t[i*r+n]*=.5,t[i*r+n]+=.5}(n,i),n}class Nr{constructor(t,e){this.graphicsDevice=t;var i=t;if(this.precision=32,this._addTimeTime=0,!Nr.DEFAULT_PARAM_TEXTURE){var n,r,s,a,o,l,h=new Float32Array(1024);for(r=0;r<16;r++)for(n=0;n<16;n++)s=n+1-8.5,a=r+1-8.5,l=_r(1-_r(Math.sqrt(s*s+a*a)/16)-.5),h[4*(o=16*r+n)]=1,h[4*o+1]=1,h[4*o+2]=1,h[4*o+3]=l;Nr.DEFAULT_PARAM_TEXTURE=vr(i,16,16,h,7,1,!0),Nr.DEFAULT_PARAM_TEXTURE.minFilter=1,Nr.DEFAULT_PARAM_TEXTURE.magFilter=1}yr=this,br=e,kr("numParticles",1),this.numParticles>t.maxTextureSize&&(console.warn("WARNING: can't create more than "+t.maxTextureSize+" particles on this device."),this.numParticles=t.maxTextureSize),kr("rate",1),kr("rate2",this.rate),kr("lifetime",50),kr("emitterExtents",new H(0,0,0)),kr("emitterExtentsInner",new H(0,0,0)),kr("emitterRadius",0),kr("emitterRadiusInner",0),kr("emitterShape",0),kr("initialVelocity",1),kr("wrap",!1),kr("localSpace",!1),kr("screenSpace",!1),kr("wrapBounds",null),kr("colorMap",Nr.DEFAULT_PARAM_TEXTURE),kr("normalMap",null),kr("loop",!0),kr("preWarm",!1),kr("sort",0),kr("mode",0),kr("scene",null),kr("lighting",!1),kr("halfLambert",!1),kr("intensity",1),kr("stretch",0),kr("alignToMotion",!1),kr("depthSoftening",0),kr("mesh",null),kr("particleNormal",new H(0,1,0)),kr("orientation",0),kr("depthWrite",!1),kr("noFog",!1),kr("blendType",2),kr("node",null),kr("startAngle",0),kr("startAngle2",this.startAngle),kr("animTilesX",1),kr("animTilesY",1),kr("animStartFrame",0),kr("animNumFrames",1),kr("animNumAnimations",1),kr("animIndex",0),kr("randomizeAnimIndex",!1),kr("animSpeed",1),kr("animLoop",!0),this._gpuUpdater=new mr(this,i),this._cpuUpdater=new ur(this),this.constantLightCube=i.scope.resolve("lightCube[0]"),this.emitterPosUniform=new Float32Array(3),this.wrapBoundsUniform=new Float32Array(3),this.emitterScaleUniform=new Float32Array([1,1,1]),kr("colorGraph",Cr),kr("colorGraph2",this.colorGraph),kr("scaleGraph",wr),kr("scaleGraph2",this.scaleGraph),kr("alphaGraph",wr),kr("alphaGraph2",this.alphaGraph),kr("localVelocityGraph",Ar),kr("localVelocityGraph2",this.localVelocityGraph),kr("velocityGraph",Ar),kr("velocityGraph2",this.velocityGraph),kr("rotationSpeedGraph",xr),kr("rotationSpeedGraph2",this.rotationSpeedGraph),kr("radialSpeedGraph",xr),kr("radialSpeedGraph2",this.radialSpeedGraph),this.lightCube=new Float32Array(18),this.lightCubeDir=new Array(6),this.lightCubeDir[0]=new H(-1,0,0),this.lightCubeDir[1]=new H(1,0,0),this.lightCubeDir[2]=new H(0,-1,0),this.lightCubeDir[3]=new H(0,1,0),this.lightCubeDir[4]=new H(0,0,-1),this.lightCubeDir[5]=new H(0,0,1),this.animTilesParams=new Float32Array(2),this.animParams=new Float32Array(4),this.animIndexParams=new Float32Array(2),this.internalTex0=null,this.internalTex1=null,this.internalTex2=null,this.colorParam=null,this.vbToSort=null,this.vbOld=null,this.particleDistance=null,this.camera=null,this.swapTex=!1,this.useMesh=!0,this.useCpu=!1,this.pack8=!0,this.localBounds=new st,this.worldBoundsNoTrail=new st,this.worldBoundsTrail=[new st,new st],this.worldBounds=new st,this.worldBoundsSize=new H,this.prevWorldBoundsSize=new H,this.prevWorldBoundsCenter=new H,this.prevEmitterExtents=this.emitterExtents,this.prevEmitterRadius=this.emitterRadius,this.worldBoundsMul=new H,this.worldBoundsAdd=new H,this.timeToSwitchBounds=0,this.shaderParticleUpdateRespawn=null,this.shaderParticleUpdateNoRespawn=null,this.shaderParticleUpdateOnStop=null,this.numParticleVerts=0,this.numParticleIndices=0,this.material=null,this.meshInstance=null,this.drawOrder=0,this.seed=Math.random(),this.fixedTimeStep=1/60,this.maxSubSteps=10,this.simTime=0,this.simTimeTotal=0,this.beenReset=!1,this._layer=null,this.rebuild()}onChangeCamera(){this.regenShader(),this.resetMaterial()}calculateBoundsMad(){this.worldBoundsMul.x=1/this.worldBoundsSize.x,this.worldBoundsMul.y=1/this.worldBoundsSize.y,this.worldBoundsMul.z=1/this.worldBoundsSize.z,this.worldBoundsAdd.copy(this.worldBounds.center).mul(this.worldBoundsMul).scale(-1),this.worldBoundsAdd.x+=.5,this.worldBoundsAdd.y+=.5,this.worldBoundsAdd.z+=.5}calculateWorldBounds(){if(this.node){if(this.prevWorldBoundsSize.copy(this.worldBoundsSize),this.prevWorldBoundsCenter.copy(this.worldBounds.center),!this.useCpu){(0===this.emitterShape?!this.emitterExtents.equals(this.prevEmitterExtents):!(this.emitterRadius===this.prevEmitterRadius))&&this.calculateLocalBounds()}var t=this.node.getWorldTransform();this.localSpace?this.worldBoundsNoTrail.copy(this.localBounds):this.worldBoundsNoTrail.setFromTransformedAabb(this.localBounds,t),this.worldBoundsTrail[0].add(this.worldBoundsNoTrail),this.worldBoundsTrail[1].add(this.worldBoundsNoTrail);var e=this.simTimeTotal;e>=this.timeToSwitchBounds&&(this.worldBoundsTrail[0].copy(this.worldBoundsTrail[1]),this.worldBoundsTrail[1].copy(this.worldBoundsNoTrail),this.timeToSwitchBounds=e+this.lifetime),this.worldBounds.copy(this.worldBoundsTrail[0]),this.worldBoundsSize.copy(this.worldBounds.halfExtents).scale(2),this.localSpace?(this.meshInstance.aabb.setFromTransformedAabb(this.worldBounds,t),this.meshInstance.mesh.aabb.setFromTransformedAabb(this.worldBounds,t)):(this.meshInstance.aabb.copy(this.worldBounds),this.meshInstance.mesh.aabb.copy(this.worldBounds)),this.meshInstance._aabbVer=1-this.meshInstance._aabbVer,this.pack8&&this.calculateBoundsMad()}}resetWorldBounds(){this.node&&(this.worldBoundsNoTrail.setFromTransformedAabb(this.localBounds,this.localSpace?Q.IDENTITY:this.node.getWorldTransform()),this.worldBoundsTrail[0].copy(this.worldBoundsNoTrail),this.worldBoundsTrail[1].copy(this.worldBoundsNoTrail),this.worldBounds.copy(this.worldBoundsTrail[0]),this.worldBoundsSize.copy(this.worldBounds.halfExtents).scale(2),this.prevWorldBoundsSize.copy(this.worldBoundsSize),this.prevWorldBoundsCenter.copy(this.worldBounds.center),this.simTimeTotal=0,this.timeToSwitchBounds=0)}calculateLocalBounds(){var t,e,i,n,r,s,a=Number.MAX_VALUE,o=Number.MAX_VALUE,l=Number.MAX_VALUE,h=-Number.MAX_VALUE,c=-Number.MAX_VALUE,u=-Number.MAX_VALUE,d=0,f=0,p=this.lifetime/this.precision,m=[this.qVelocity,this.qVelocity2],g=[this.qLocalVelocity,this.qLocalVelocity2],v=[0,0],_=[0,0],y=[0,0],b=[0,0],x=[0,0];for(t=0;t<this.precision+1;t++){for(i=Math.min(t,this.precision-1),e=0;e<2;e++)n=g[e][3*i+0]*p+v[e],r=g[e][3*i+1]*p+_[e],s=g[e][3*i+2]*p+y[e],a=Math.min(n,a),o=Math.min(r,o),l=Math.min(s,l),h=Math.max(n,h),c=Math.max(r,c),u=Math.max(s,u),v[e]=n,_[e]=r,y[e]=s;for(e=0;e<2;e++)x[e]+=p*Math.sqrt(m[e][3*i+0]*m[e][3*i+0]+m[e][3*i+1]*m[e][3*i+1]+m[e][3*i+2]*m[e][3*i+2]);b[0]+=this.qRadialSpeed[i]*p,b[1]+=this.qRadialSpeed2[i]*p,d=Math.max(d,Math.max(Math.abs(b[0]),Math.abs(b[1]))),f=Math.max(f,this.qScale[i])}0===this.emitterShape?(n=.5*this.emitterExtents.x,r=.5*this.emitterExtents.y,s=.5*this.emitterExtents.z):(n=this.emitterRadius,r=this.emitterRadius,s=this.emitterRadius);var w=Math.max(x[0],x[1]);Pr.x=a-f-n-d-w,Pr.y=o-f-r-d-w,Pr.z=l-f-s-d-w,Er.x=h+f+n+d+w,Er.y=c+f+r+d+w,Er.z=u+f+s+d+w,this.localBounds.setMinMax(Pr,Er)}rebuild(){var t,e=this.graphicsDevice;(null===this.colorMap&&(this.colorMap=Nr.DEFAULT_PARAM_TEXTURE),this.spawnBounds=0===this.emitterShape?this.emitterExtents:this.emitterRadius,this.useCpu=this.useCpu||this.sort>0||e.maxVertexTextures<=1||e.fragmentUniformsCount<64||e.forceCpuParticles||!e.extTextureFloat,this._destroyResources(),this.pack8=(this.pack8||!e.textureFloatRenderable)&&!this.useCpu,Ir=this.useCpu||this.pack8?4:2,this.useMesh=!1,this.mesh)&&(this.numParticles*this.mesh.vertexBuffer.numVertices>65535?console.warn("WARNING: particle system can't render mesh particles because numParticles * numVertices is more than 65k. Reverting to quad particles."):this.useMesh=!0);this.numParticlesPot=k.nextPowerOfTwo(this.numParticles),this.rebuildGraphs(),this.calculateLocalBounds(),this.resetWorldBounds(),this.node&&(this.worldBounds.setFromTransformedAabb(this.localBounds,this.localSpace?Q.IDENTITY:this.node.getWorldTransform()),this.worldBoundsTrail[0].copy(this.worldBounds),this.worldBoundsTrail[1].copy(this.worldBounds),this.worldBoundsSize.copy(this.worldBounds.halfExtents).scale(2),this.prevWorldBoundsSize.copy(this.worldBoundsSize),this.prevWorldBoundsCenter.copy(this.worldBounds.center),this.pack8&&this.calculateBoundsMad()),this.vbToSort=new Array(this.numParticles);for(var i=0;i<this.numParticles;i++)this.vbToSort[i]=[0,0];this.particleDistance=new Float32Array(this.numParticles),this._gpuUpdater.randomize(),this.particleTex=new Float32Array(this.numParticlesPot*Ir*4);var n=null===this.node||this.localSpace?H.ZERO:this.node.getPosition();for(0===this.emitterShape&&(null===this.node||this.localSpace?Mr.setTRS(H.ZERO,$.IDENTITY,this.spawnBounds):Mr.setTRS(H.ZERO,this.node.getRotation(),Tr.copy(this.spawnBounds).mul(this.node.localScale)),Sr[0]=0!=this.emitterExtents.x?this.emitterExtentsInner.x/this.emitterExtents.x:0,Sr[1]=0!=this.emitterExtents.y?this.emitterExtentsInner.y/this.emitterExtents.y:0,Sr[2]=0!=this.emitterExtents.z?this.emitterExtentsInner.z/this.emitterExtents.z:0),t=0;t<this.numParticles;t++)this._cpuUpdater.calcSpawnPosition(this.particleTex,Mr,Sr,n,t),this.useCpu&&(this.particleTex[4*t+3+2*this.numParticlesPot*4]=1);for(this.particleTexStart=new Float32Array(this.numParticlesPot*Ir*4),t=0;t<this.particleTexStart.length;t++)this.particleTexStart[t]=this.particleTex[t];this.useCpu||(this.pack8?(this.particleTexIN=vr(e,this.numParticlesPot,Ir,this.particleTex,7,1,!1),this.particleTexOUT=vr(e,this.numParticlesPot,Ir,this.particleTex,7,1,!1),this.particleTexStart=vr(e,this.numParticlesPot,Ir,this.particleTexStart,7,1,!1)):(this.particleTexIN=vr(e,this.numParticlesPot,Ir,this.particleTex),this.particleTexOUT=vr(e,this.numParticlesPot,Ir,this.particleTex),this.particleTexStart=vr(e,this.numParticlesPot,Ir,this.particleTexStart)),this.rtParticleTexIN=new Cf(e,this.particleTexIN,{depth:!1}),this.rtParticleTexOUT=new Cf(e,this.particleTexOUT,{depth:!1}),this.swapTex=!1);var r=(this.localSpace?"#define LOCAL_SPACE\n":"")+Ft.particleUpdaterInitPS+(this.pack8?Ft.particleInputRgba8PS+Ft.particleOutputRgba8PS:Ft.particleInputFloatPS+Ft.particleOutputFloatPS)+(0===this.emitterShape?Ft.particleUpdaterAABBPS:Ft.particleUpdaterSpherePS)+Ft.particleUpdaterStartPS,s=r+Ft.particleUpdaterRespawnPS+Ft.particleUpdaterEndPS,a=r+Ft.particleUpdaterNoRespawnPS+Ft.particleUpdaterEndPS,o=r+Ft.particleUpdaterOnStopPS+Ft.particleUpdaterEndPS,l=this.emitterShape+""+this.pack8+this.localSpace;this.shaderParticleUpdateRespawn=Jt(e,Ft.fullscreenQuadVS,s,"fsQuad0"+l),this.shaderParticleUpdateNoRespawn=Jt(e,Ft.fullscreenQuadVS,a,"fsQuad1"+l),this.shaderParticleUpdateOnStop=Jt(e,Ft.fullscreenQuadVS,o,"fsQuad2"+l),this.numParticleVerts=this.useMesh?this.mesh.vertexBuffer.numVertices:4,this.numParticleIndices=this.useMesh?this.mesh.indexBuffer[0].numIndices:6,this._allocate(this.numParticles);var h=new Ie(e);h.vertexBuffer=this.vertexBuffer,h.indexBuffer[0]=this.indexBuffer,h.primitive[0].type=4,h.primitive[0].base=0,h.primitive[0].count=this.numParticles*this.numParticleIndices,h.primitive[0].indexed=!0,this.material=new _e,this.material.name=this.node.name,this.material.cull=0,this.material.alphaWrite=!1,this.material.blend=!0,this.material.blendType=this.blendType,this.material.depthWrite=this.depthWrite,this.material.emitter=this,this.regenShader(),this.resetMaterial();var c=!this.meshInstance||this.meshInstance.visible;this.meshInstance=new Ee(this.node,h,this.material),this.meshInstance.pick=!1,this.meshInstance.updateKey(),this.meshInstance.cull=!0,this.meshInstance._noDepthDrawGl1=!0,this.localSpace?this.meshInstance.aabb.setFromTransformedAabb(this.worldBounds,this.node.getWorldTransform()):this.meshInstance.aabb.copy(this.worldBounds),this.meshInstance._updateAabb=!1,this.meshInstance.visible=c,this._initializeTextures(),this.resetTime(),this.addTime(0,!1),this.preWarm&&this.prewarm(this.lifetime)}_isAnimated(){return this.animNumFrames>=1&&(this.animTilesX>1||this.animTilesY>1)&&(this.colorMap&&this.colorMap!==Nr.DEFAULT_PARAM_TEXTURE||this.normalMap)}rebuildGraphs(){var t,e=this.precision,i=this.graphicsDevice;for(this.qLocalVelocity=this.localVelocityGraph.quantize(e),this.qVelocity=this.velocityGraph.quantize(e),this.qColor=this.colorGraph.quantizeClamped(e,0,1),this.qRotSpeed=this.rotationSpeedGraph.quantize(e),this.qScale=this.scaleGraph.quantize(e),this.qAlpha=this.alphaGraph.quantize(e),this.qRadialSpeed=this.radialSpeedGraph.quantize(e),this.qLocalVelocity2=this.localVelocityGraph2.quantize(e),this.qVelocity2=this.velocityGraph2.quantize(e),this.qColor2=this.colorGraph2.quantizeClamped(e,0,1),this.qRotSpeed2=this.rotationSpeedGraph2.quantize(e),this.qScale2=this.scaleGraph2.quantize(e),this.qAlpha2=this.alphaGraph2.quantize(e),this.qRadialSpeed2=this.radialSpeedGraph2.quantize(e),t=0;t<e;t++)this.qRotSpeed[t]*=k.DEG_TO_RAD,this.qRotSpeed2[t]*=k.DEG_TO_RAD;if(this.localVelocityUMax=new Float32Array(3),this.velocityUMax=new Float32Array(3),this.colorUMax=new Float32Array(3),this.rotSpeedUMax=[0],this.scaleUMax=[0],this.alphaUMax=[0],this.radialSpeedUMax=[0],this.qLocalVelocityDiv=Lr(this.qLocalVelocity,this.qLocalVelocity2,this.localVelocityUMax),this.qVelocityDiv=Lr(this.qVelocity,this.qVelocity2,this.velocityUMax),this.qColorDiv=Lr(this.qColor,this.qColor2,this.colorUMax),this.qRotSpeedDiv=Lr(this.qRotSpeed,this.qRotSpeed2,this.rotSpeedUMax),this.qScaleDiv=Lr(this.qScale,this.qScale2,this.scaleUMax),this.qAlphaDiv=Lr(this.qAlpha,this.qAlpha2,this.alphaUMax),this.qRadialSpeedDiv=Lr(this.qRadialSpeed,this.qRadialSpeed2,this.radialSpeedUMax),this.pack8){var n=[0,0,0];Rr(this.qVelocity,n);var r=[0,0,0];Rr(this.qVelocity2,r);var s=[0,0,0];Rr(this.qLocalVelocity,s);var a=[0,0,0];Rr(this.qLocalVelocity2,a);var o=[0];Rr(this.qRadialSpeed,o);var l=[0];Rr(this.qRadialSpeed2,l);var h=Math.max(n[0],r[0]);h=Math.max(h,n[1]),h=Math.max(h,r[1]),h=Math.max(h,n[2]),h=Math.max(h,r[2]);var c=Math.max(s[0],a[0]);c=Math.max(c,s[1]),c=Math.max(c,a[1]),c=Math.max(c,s[2]),c=Math.max(c,a[2]);var u=Math.max(o[0],l[0]);this.maxVel=h+c+u}this.useCpu||(this.internalTex0=vr(i,e,1,Or(this.qLocalVelocity,this.qLocalVelocityDiv)),this.internalTex1=vr(i,e,1,Or(this.qVelocity,this.qVelocityDiv)),this.internalTex2=vr(i,e,1,function(t,e,i,n,r){for(var s=new Array(4*t.length),a=0;a<t.length;a++)s[4*a]=t[a],s[4*a+1]=e[a],s[4*a+2]=0,s[4*a+3]=Dr(i[a],n[a],r[a]);return s}(this.qRotSpeed,this.qScale,this.qScaleDiv,this.qRotSpeedDiv,this.qAlphaDiv)),this.internalTex3=vr(i,e,1,function(t,e){for(var i=new Array(4*t.length),n=0;n<t.length;n++)i[4*n]=t[n],i[4*n+1]=e[n],i[4*n+2]=0,i[4*n+3]=0;return i}(this.qRadialSpeed,this.qRadialSpeedDiv))),this.colorParam=vr(i,e,1,function(t,e){for(var i=new Array(4*e.length),n=0;n<e.length;n++)i[4*n]=t[3*n],i[4*n+1]=t[3*n+1],i[4*n+2]=t[3*n+2],i[4*n+3]=e[n];return i}(this.qColor,this.qAlpha),7,1,!0)}_initializeTextures(){this.colorMap&&(this.material.setParameter("colorMap",this.colorMap),this.lighting&&this.normalMap&&this.material.setParameter("normalMap",this.normalMap))}regenShader(){var t=this.graphicsDevice.getProgramLibrary(),e=null!==this.normalMap;this.normalOption=0,this.lighting&&(this.normalOption=e?2:1),this.material.updateShader=function(){this.emitter.scene&&this.emitter.camera!=this.emitter.scene._activeCamera&&(this.emitter.camera=this.emitter.scene._activeCamera,this.emitter.onChangeCamera());var e=this.emitter.inTools,i=t.getProgram("particle",{useCpu:this.emitter.useCpu,normal:this.emitter.normalOption,halflambert:this.emitter.halfLambert,stretch:this.emitter.stretch,alignToMotion:this.emitter.alignToMotion,soft:this.emitter.depthSoftening,mesh:this.emitter.useMesh,gamma:this.emitter.scene?this.emitter.scene.gammaCorrection:0,toneMap:this.emitter.scene?this.emitter.scene.toneMapping:0,fog:this.emitter.scene&&!this.emitter.noFog?this.emitter.scene.fog:"none",wrap:this.emitter.wrap&&this.emitter.wrapBounds,localSpace:this.emitter.localSpace,screenSpace:!e&&this.emitter.screenSpace,blend:this.blendType,animTex:this.emitter._isAnimated(),animTexLoop:this.emitter.animLoop,pack8:this.emitter.pack8,customFace:0!=this.emitter.orientation});this.shader=i},this.material.updateShader()}resetMaterial(){var t=this.material;t.setParameter("stretch",this.stretch),this._isAnimated()&&(t.setParameter("animTexTilesParams",this.animTilesParams),t.setParameter("animTexParams",this.animParams),t.setParameter("animTexIndexParams",this.animIndexParams)),t.setParameter("colorMult",this.intensity),this.useCpu||(t.setParameter("internalTex0",this.internalTex0),t.setParameter("internalTex1",this.internalTex1),t.setParameter("internalTex2",this.internalTex2),t.setParameter("internalTex3",this.internalTex3)),t.setParameter("colorParam",this.colorParam),t.setParameter("numParticles",this.numParticles),t.setParameter("numParticlesPot",this.numParticlesPot),t.setParameter("lifetime",this.lifetime),t.setParameter("rate",this.rate),t.setParameter("rateDiv",this.rate2-this.rate),t.setParameter("seed",this.seed),t.setParameter("scaleDivMult",this.scaleUMax[0]),t.setParameter("alphaDivMult",this.alphaUMax[0]),t.setParameter("radialSpeedDivMult",this.radialSpeedUMax[0]),t.setParameter("graphNumSamples",this.precision),t.setParameter("graphSampleSize",1/this.precision),t.setParameter("emitterScale",new Float32Array([1,1,1])),this.pack8&&(this._gpuUpdater._setInputBounds(),t.setParameter("inBoundsSize",this._gpuUpdater.inBoundsSizeUniform),t.setParameter("inBoundsCenter",this._gpuUpdater.inBoundsCenterUniform),t.setParameter("maxVel",this.maxVel)),this.wrap&&this.wrapBounds&&(this.wrapBoundsUniform[0]=this.wrapBounds.x,this.wrapBoundsUniform[1]=this.wrapBounds.y,this.wrapBoundsUniform[2]=this.wrapBounds.z,t.setParameter("wrapBounds",this.wrapBoundsUniform)),this.colorMap&&t.setParameter("colorMap",this.colorMap),this.lighting&&this.normalMap&&t.setParameter("normalMap",this.normalMap),this.depthSoftening>0&&t.setParameter("softening",1/(this.depthSoftening*this.depthSoftening*100)),this.stretch>0&&(t.cull=0),this._compParticleFaceParams()}_compParticleFaceParams(){var t,e;if(0==this.orientation)t=new Float32Array([1,0,0]),e=new Float32Array([0,0,1]);else{var i;if(1==this.orientation)i=this.particleNormal.normalize();else i=(null===this.node?Q.IDENTITY:this.node.getWorldTransform()).transformVector(this.particleNormal).normalize();var n=new H(1,0,0);1==Math.abs(n.dot(i))&&n.set(0,0,1);var r=(new H).cross(i,n).normalize();n.cross(r,i).normalize(),t=new Float32Array([n.x,n.y,n.z]),e=new Float32Array([r.x,r.y,r.z])}this.material.setParameter("faceTangent",t),this.material.setParameter("faceBinorm",e)}_allocate(t){var e,i,n,r=t*this.numParticleVerts,s=t*this.numParticleIndices;if(void 0===this.vertexBuffer||this.vertexBuffer.getNumVertices()!==r){this.useCpu?(e=[{semantic:"ATTR0",components:4,type:6},{semantic:"ATTR1",components:4,type:6},{semantic:"ATTR2",components:4,type:6},{semantic:"ATTR3",components:1,type:6},{semantic:"ATTR4",components:this.useMesh?4:2,type:6}],i=new bt(this.graphicsDevice,e),this.vertexBuffer=new _t(this.graphicsDevice,i,r,1),this.indexBuffer=new xe(this.graphicsDevice,1,s)):(e=[{semantic:"ATTR0",components:4,type:6}],this.useMesh&&e.push({semantic:"ATTR1",components:2,type:6}),i=new bt(this.graphicsDevice,e),this.vertexBuffer=new _t(this.graphicsDevice,i,r,1),this.indexBuffer=new xe(this.graphicsDevice,1,s));var a,o,l,h,c=new Float32Array(this.vertexBuffer.lock());if(this.useMesh){o=(a=new Float32Array(this.mesh.vertexBuffer.lock())).length/this.mesh.vertexBuffer.numVertices;for(var u=0;u<this.mesh.vertexBuffer.format.elements.length;u++)if("TEXCOORD0"===this.mesh.vertexBuffer.format.elements[u].name){l=this.mesh.vertexBuffer.format.elements[u].offset/4;break}}for(n=0;n<r;n++)if(h=Math.floor(n/this.numParticleVerts),this.useMesh){var d=n%this.numParticleVerts;c[6*n]=a[d*o],c[6*n+1]=a[d*o+1],c[6*n+2]=a[d*o+2],c[6*n+3]=h,c[6*n+4]=a[d*o+l+0],c[6*n+5]=a[d*o+l+1]}else{var f=n%4;c[4*n]=gr[f][0],c[4*n+1]=gr[f][1],c[4*n+2]=0,c[4*n+3]=h}this.useCpu&&(this.vbCPU=new Float32Array(c),this.vbOld=new Float32Array(this.vbCPU.length)),this.vertexBuffer.unlock(),this.useMesh&&this.mesh.vertexBuffer.unlock();var p=0,m=new Uint16Array(this.indexBuffer.lock());for(this.useMesh&&(a=new Uint16Array(this.mesh.indexBuffer[0].lock())),n=0;n<t;n++)if(this.useMesh)for(var g=0;g<this.numParticleIndices;g++)m[n*this.numParticleIndices+g]=a[g]+n*this.numParticleVerts;else{var v=4*n;m[p++]=v,m[p++]=v+1,m[p++]=v+2,m[p++]=v,m[p++]=v+2,m[p++]=v+3}this.indexBuffer.unlock(),this.useMesh&&this.mesh.indexBuffer[0].unlock()}}reset(){if(this.beenReset=!0,this.seed=Math.random(),this.material.setParameter("seed",this.seed),this.useCpu)for(var t=0;t<this.particleTexStart.length;t++)this.particleTex[t]=this.particleTexStart[t];else this._initializeTextures();this.resetWorldBounds(),this.resetTime();var e=this.loop;this.loop=!0,this.addTime(0,!1),this.loop=e,this.preWarm&&this.prewarm(this.lifetime)}prewarm(t){for(var e=t/this.lifetime,i=Math.min(Math.floor(e*this.precision),this.precision),n=t/i,r=0;r<i;r++)this.addTime(n,!1)}resetTime(){var t,e;this.endTime=(t=this,e=Math.max(t.rate,t.rate2)*t.numParticles+t.lifetime,Date.now()+1e3*e)}finishFrame(){this.useCpu&&this.vertexBuffer.unlock()}addTime(t,e){var i,n=this.graphicsDevice;if(this.simTimeTotal+=t,this.calculateWorldBounds(),this._isAnimated()){var r=this.animTilesParams;r[0]=1/this.animTilesX,r[1]=1/this.animTilesY;var s=this.animParams;s[0]=this.animStartFrame,s[1]=this.animNumFrames*this.animSpeed,s[2]=this.animNumFrames-1,s[3]=this.animNumAnimations-1;var a=this.animIndexParams;a[0]=this.animIndex,a[1]=this.randomizeAnimIndex}this.scene&&this.camera!=this.scene._activeCamera&&(this.camera=this.scene._activeCamera,this.onChangeCamera()),0===this.emitterShape&&(Sr[0]=0!=this.emitterExtents.x?this.emitterExtentsInner.x/this.emitterExtents.x:0,Sr[1]=0!=this.emitterExtents.y?this.emitterExtentsInner.y/this.emitterExtents.y:0,Sr[2]=0!=this.emitterExtents.z?this.emitterExtentsInner.z/this.emitterExtents.z:0,null===this.meshInstance.node?Mr.setTRS(H.ZERO,$.IDENTITY,this.emitterExtents):Mr.setTRS(H.ZERO,this.meshInstance.node.getRotation(),Tr.copy(this.emitterExtents).mul(this.meshInstance.node.localScale)));var o=null===this.meshInstance.node?H.ONE:this.meshInstance.node.localScale;if(this.emitterScaleUniform[0]=o.x,this.emitterScaleUniform[1]=o.y,this.emitterScaleUniform[2]=o.z,this.material.setParameter("emitterScale",this.emitterScaleUniform),this.localSpace&&this.meshInstance.node&&(i=this.meshInstance.node.getPosition(),this.emitterPosUniform[0]=i.x,this.emitterPosUniform[1]=i.y,this.emitterPosUniform[2]=i.z,this.material.setParameter("emitterPos",this.emitterPosUniform)),this._compParticleFaceParams(),this.useCpu){var l=new Float32Array(this.vertexBuffer.lock());this._cpuUpdater.update(l,this.vbToSort,this.particleTex,Mr,Sr,i,t,e)}else this._gpuUpdater.update(n,Mr,Sr,t,e);this.loop||Date.now()>this.endTime&&(this.onFinished&&this.onFinished(),this.meshInstance.visible=!1),this.meshInstance&&(this.meshInstance.drawOrder=this.drawOrder)}_destroyResources(){this.particleTexIN&&(this.particleTexIN.destroy(),this.particleTexIN=null),this.particleTexOUT&&(this.particleTexOUT.destroy(),this.particleTexOUT=null),this.particleTexStart&&this.particleTexStart.destroy&&(this.particleTexStart.destroy(),this.particleTexStart=null),this.rtParticleTexIN&&(this.rtParticleTexIN.destroy(),this.rtParticleTexIN=null),this.rtParticleTexOUT&&(this.rtParticleTexOUT.destroy(),this.rtParticleTexOUT=null),this.internalTex0&&(this.internalTex0.destroy(),this.internalTex0=null),this.internalTex1&&(this.internalTex1.destroy(),this.internalTex1=null),this.internalTex2&&(this.internalTex2.destroy(),this.internalTex2=null),this.internalTex3&&(this.internalTex3.destroy(),this.internalTex3=null),this.colorParam&&(this.colorParam.destroy(),this.colorParam=null),this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=void 0),this.indexBuffer&&(this.indexBuffer.destroy(),this.indexBuffer=void 0),this.material&&(this.material.destroy(),this.material=null)}destroy(){this.camera=null,this._destroyResources()}}var zr=[];function Br(t,e,i){var n=i&&void 0!==i.normals?i.normals:null,r=i&&void 0!==i.tangents?i.tangents:null,s=i&&void 0!==i.colors?i.colors:null,a=i&&void 0!==i.uvs?i.uvs:null,o=i&&void 0!==i.uvs1?i.uvs1:null,l=i&&void 0!==i.indices?i.indices:null,h=i&&void 0!==i.blendIndices?i.blendIndices:null,c=i&&void 0!==i.blendWeights?i.blendWeights:null,u=[{semantic:"POSITION",components:3,type:6}];null!==n&&u.push({semantic:"NORMAL",components:3,type:6}),null!==r&&u.push({semantic:"TANGENT",components:4,type:6}),null!==s&&u.push({semantic:"COLOR",components:4,type:1,normalize:!0}),null!==a&&u.push({semantic:"TEXCOORD0",components:2,type:6}),null!==o&&u.push({semantic:"TEXCOORD1",components:2,type:6}),null!==h&&u.push({semantic:"BLENDINDICES",components:2,type:1}),null!==c&&u.push({semantic:"BLENDWEIGHT",components:2,type:6});for(var d=new bt(t,u),f=e.length/3,p=new _t(t,d,f),m=new Rt(p),g=0;g<f;g++)m.element.POSITION.set(e[3*g],e[3*g+1],e[3*g+2]),null!==n&&m.element.NORMAL.set(n[3*g],n[3*g+1],n[3*g+2]),null!==r&&m.element.TANGENT.set(r[4*g],r[4*g+1],r[4*g+2],r[4*g+3]),null!==s&&m.element.COLOR.set(s[4*g],s[4*g+1],s[4*g+2],s[4*g+3]),null!==a&&m.element.TEXCOORD0.set(a[2*g],a[2*g+1]),null!==o&&m.element.TEXCOORD1.set(o[2*g],o[2*g+1]),null!==h&&m.element.BLENDINDICES.set(h[2*g],h[2*g+1]),null!==c&&m.element.BLENDWEIGHT.set(c[2*g],c[2*g+1]),m.next();m.end();var v=null,_=null!==l;_&&(v=new xe(t,1,l.length),new Uint16Array(v.lock()).set(l),v.unlock());var y=new st;y.compute(e);var b=new Ie(t);return b.vertexBuffer=p,b.indexBuffer[0]=v,b.primitive[0].type=4,b.primitive[0].base=0,b.primitive[0].count=_?l.length:f,b.primitive[0].indexed=_,b.aabb=y,b}function Fr(t,e,i,n,r,s){var a,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,A,C,I,S=new H,M=new H,T=new H,P=[],E=[],k=[],D=[],O=[];if(i>0)for(a=0;a<=n;a++)for(o=0;o<=r;o++){g=o/r*2*Math.PI-Math.PI,_=Math.sin(g),v=Math.cos(g),p=new H(_*t,-i/2,v*t),f=new H(_*e,i/2,v*e),S.lerp(p,f,a/n),M.sub2(f,p).normalize(),m=new H(v,0,-_),T.cross(m,M).normalize(),P.push(S.x,S.y,S.z),E.push(T.x,T.y,T.z),u=o/r,d=a/n,k.push(u,d);var R=d;d=u,u=R,u=.875*(u/=3)+4/64,d=.875*d+4/64,D.push(u,d),a<n&&o<r&&(x=a*(r+1)+o,w=a*(r+1)+(o+1),A=(a+1)*(r+1)+o,C=(a+1)*(r+1)+(o+1),O.push(x,w,A),O.push(w,C,A))}if(s){var L,N,z=Math.floor(r/2),B=r,F=i/2;for(L=0;L<=z;L++)for(g=L*Math.PI*.5/z,_=Math.sin(g),v=Math.cos(g),N=0;N<=B;N++)y=2*N*Math.PI/B-Math.PI/2,b=Math.sin(y),l=Math.cos(y)*_,h=v,c=b*_,u=1-N/B,d=1-L/z,P.push(l*e,h*e+F,c*e),E.push(l,h,c),k.push(u,d),u=.875*(u/=3)+4/64,d=.875*(d/=3)+4/64,u+=1/3,D.push(u,d);for(I=(n+1)*(r+1),L=0;L<z;++L)for(N=0;N<B;++N)w=(x=L*(B+1)+N)+B+1,O.push(I+x+1,I+w,I+x),O.push(I+x+1,I+w+1,I+w);for(L=0;L<=z;L++)for(g=.5*Math.PI+L*Math.PI*.5/z,_=Math.sin(g),v=Math.cos(g),N=0;N<=B;N++)y=2*N*Math.PI/B-Math.PI/2,b=Math.sin(y),l=Math.cos(y)*_,h=v,c=b*_,u=1-N/B,d=1-L/z,P.push(l*e,h*e-F,c*e),E.push(l,h,c),k.push(u,d),u=.875*(u/=3)+4/64,d=.875*(d/=3)+4/64,u+=2/3,D.push(u,d);for(I=(n+1)*(r+1)+(B+1)*(z+1),L=0;L<z;++L)for(N=0;N<B;++N)w=(x=L*(B+1)+N)+B+1,O.push(I+x+1,I+w,I+x),O.push(I+x+1,I+w+1,I+w)}else{if(I=(n+1)*(r+1),t>0)for(a=0;a<r;a++)g=a/r*2*Math.PI,h=-i/2,u=1-((l=Math.sin(g))+1)/2,d=((c=Math.cos(g))+1)/2,P.push(l*t,h,c*t),E.push(0,-1,0),k.push(u,d),u=.875*(u/=3)+4/64,d=.875*(d/=3)+4/64,u+=1/3,D.push(u,d),a>1&&O.push(I,I+a,I+a-1);if(I+=r,e>0)for(a=0;a<r;a++)g=a/r*2*Math.PI,h=i/2,u=1-((l=Math.sin(g))+1)/2,d=((c=Math.cos(g))+1)/2,P.push(l*e,h,c*e),E.push(0,1,0),k.push(u,d),u=.875*(u/=3)+4/64,d=.875*(d/=3)+4/64,u+=2/3,D.push(u,d),a>1&&O.push(I,I+a-1,I+a)}return{positions:P,normals:E,uvs:k,uvs1:D,indices:O}}function jr(t,e){var i=e&&(e.radius||e.baseRadius);i=void 0!==i?i:.5;var n=e&&void 0!==e.height?e.height:1,r=e&&void 0!==e.heightSegments?e.heightSegments:5,s=e&&void 0!==e.capSegments?e.capSegments:20,a=!(!e||void 0===e.calculateTangents)&&e.calculateTangents,o=Fr(i,i,n,r,s,!1);return a&&(o.tangents=a(o.positions,o.normals,o.uvs,o.indices)),Br(t,o.positions,o)}function Vr(t,e){var i=e&&void 0!==e.radius?e.radius:.3,n=e&&void 0!==e.height?e.height:1,r=e&&void 0!==e.heightSegments?e.heightSegments:1,s=e&&void 0!==e.sides?e.sides:20,a=!(!e||void 0===e.calculateTangents)&&e.calculateTangents,o=Fr(i,i,n-2*i,r,s,!0);return a&&(o.tangents=a(o.positions,o.normals,o.uvs,o.indices)),Br(t,o.positions,o)}function Ur(t,e){var i=e&&void 0!==e.baseRadius?e.baseRadius:.5,n=e&&void 0!==e.peakRadius?e.peakRadius:0,r=e&&void 0!==e.height?e.height:1,s=e&&void 0!==e.heightSegments?e.heightSegments:5,a=e&&void 0!==e.capSegments?e.capSegments:18,o=!(!e||void 0===e.calculateTangents)&&e.calculateTangents,l=Fr(i,n,r,s,a,!1);return o&&(l.tangents=o(l.positions,l.normals,l.uvs,l.indices)),Br(t,l.positions,l)}function Gr(t,e){var i,n,r,s,a,o,l,h,c,u,d,f,p,m,g=e&&void 0!==e.radius?e.radius:.5,v=e&&void 0!==e.latitudeBands?e.latitudeBands:16,_=e&&void 0!==e.longitudeBands?e.longitudeBands:16,y=!(!e||void 0===e.calculateTangents)&&e.calculateTangents,b=[],x=[],w=[],A=[];for(n=0;n<=v;n++)for(r=n*Math.PI/v,s=Math.sin(r),a=Math.cos(r),i=0;i<=_;i++)o=2*i*Math.PI/_-Math.PI/2,l=Math.sin(o),u=Math.cos(o)*s,d=a,f=l*s,p=1-i/_,m=1-n/v,b.push(u*g,d*g,f*g),x.push(u,d,f),w.push(p,m);for(n=0;n<v;++n)for(i=0;i<_;++i)c=(h=n*(_+1)+i)+_+1,A.push(h+1,c,h),A.push(h+1,c+1,c);var C={normals:x,uvs:w,uvs1:w,indices:A};return y&&(C.tangents=y(b,x,w,A)),Br(t,b,C)}function Wr(t,e){var i,n,r,s,a,o,l=e&&void 0!==e.halfExtents?e.halfExtents:new W(.5,.5),h=e&&void 0!==e.widthSegments?e.widthSegments:5,c=e&&void 0!==e.lengthSegments?e.lengthSegments:5,u=!(!e||void 0===e.calculateTangents)&&e.calculateTangents,d=[],f=[],p=[],m=[],g=0;for(i=0;i<=h;i++)for(n=0;n<=c;n++)r=-l.x+2*l.x*i/h,0,s=-(-l.y+2*l.y*n/c),a=i/h,o=n/c,d.push(r,0,s),f.push(0,1,0),p.push(a,o),i<h&&n<c&&(m.push(g+c+1,g+1,g),m.push(g+c+1,g+c+2,g+1)),g++;var v={normals:f,uvs:p,uvs1:p,indices:m};return u&&(v.tangents=u(d,f,p,m)),Br(t,d,v)}function Hr(t,e){var i=e&&void 0!==e.halfExtents?e.halfExtents:new H(.5,.5,.5),n=e&&void 0!==e.widthSegments?e.widthSegments:1,r=e&&void 0!==e.lengthSegments?e.lengthSegments:1,s=e&&void 0!==e.heightSegments?e.heightSegments:1,a=!(!e||void 0===e.calculateTangents)&&e.calculateTangents,o=[new H(-i.x,-i.y,i.z),new H(i.x,-i.y,i.z),new H(i.x,i.y,i.z),new H(-i.x,i.y,i.z),new H(i.x,-i.y,-i.z),new H(-i.x,-i.y,-i.z),new H(-i.x,i.y,-i.z),new H(i.x,i.y,-i.z)],l=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],h=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],c=1,u=2,d=3,f=4,p=5,m=[],g=[],v=[],_=[],y=[],b=0,x=function(t,e,i){var n,r,s,a;for(s=0;s<=e;s++)for(a=0;a<=i;a++){var c=new H,u=new H,d=new H,f=new H;c.lerp(o[l[t][0]],o[l[t][1]],s/e),u.lerp(o[l[t][0]],o[l[t][2]],a/i),d.sub2(u,o[l[t][0]]),f.add2(c,d),n=s/e,r=a/i,m.push(f.x,f.y,f.z),g.push(h[t][0],h[t][1],h[t][2]),v.push(n,r),n=.875*(n/=3)+4/64,r=.875*(r/=3)+4/64,n+=t%3/3,r+=Math.floor(t/3)/3,_.push(n,r),s<e&&a<i&&(y.push(b+i+1,b+1,b),y.push(b+i+1,b+i+2,b+1)),b++}};x(0,n,s),x(c,n,s),x(u,n,r),x(d,n,r),x(f,r,s),x(p,r,s);var w={normals:g,uvs:v,uvs1:_,indices:y};return a&&(w.tangents=a(m,g,v,y)),Br(t,m,w)}function Xr(t,e){for(var i=null,n=0;n<zr.length;n++)zr[n].type===e&&zr[n].device===t&&(i=zr[n].primData);if(!i){var r,s;switch(e){case"box":r=Hr(t,{halfExtents:new H(.5,.5,.5)}),s={x:2,y:2,z:2,uv:2/3};break;case"capsule":r=Vr(t,{radius:.5,height:2}),s={x:2*Math.PI,y:Math.PI,z:2*Math.PI,uv:1/3+1/3/3*2};break;case"cone":r=Ur(t,{baseRadius:.5,peakRadius:0,height:1}),s={x:2.54,y:2.54,z:2.54,uv:1/3+1/3/3};break;case"cylinder":r=jr(t,{radius:.5,height:1}),s={x:Math.PI,y:1.58,z:Math.PI,uv:1/3+1/3/3*2};break;case"plane":r=Wr(t,{halfExtents:new W(.5,.5),widthSegments:1,lengthSegments:1}),s={x:0,y:1,z:0,uv:1};break;case"sphere":r=Gr(t,{radius:.5}),s={x:Math.PI,y:Math.PI,z:Math.PI,uv:1};break;default:throw new Error("Invalid primitive type: "+e)}i={mesh:r,area:s},zr.push({type:e,device:t,primData:i})}return i}class Zr extends v{constructor(){super(),this.destroy=function(){this.skybox=null},this.root=null,this._gravity=new H(0,-9.8,0),this._layers=null,this._fog="none",this.fogColor=new D(0,0,0),this.fogStart=1,this.fogEnd=1e3,this.fogDensity=0,this.ambientLight=new D(0,0,0),this._gammaCorrection=0,this._toneMapping=0,this.exposure=1,this._skyboxPrefiltered=[null,null,null,null,null,null],this._firstUpdateSkybox=!0,this._skyboxCubeMap=null,this.skyboxModel=null,this._skyboxIntensity=1,this._skyboxMip=0,this._skyboxRotation=new $,this._skyboxRotationMat3=null,this._skyboxRotationMat4=null,this._skyboxIsRenderTarget=!1,this.lightmapSizeMultiplier=1,this.lightmapMaxResolution=2048,this.lightmapMode=1,this._stats={meshInstances:0,lights:0,dynamicLights:0,bakedLights:0,lastStaticPrepareFullTime:0,lastStaticPrepareSearchTime:0,lastStaticPrepareWriteTime:0,lastStaticPrepareTriAabbTime:0,lastStaticPrepareCombineTime:0,updateShadersTime:0},this.updateShaders=!0,this.updateSkybox=!0,this._shaderVersion=0,this._statsUpdated=!1,this._models=[],this.defaultMaterial=new af,this.defaultMaterial.name="Default Material",this.defaultMaterial.shadingModel=1}destroy(){this.root=null,this.defaultMaterial.destroy(),this.defaultMaterial=null,this.off()}get fog(){return this._fog}set fog(t){t!==this._fog&&(this._fog=t,this.updateShaders=!0)}get gammaCorrection(){return this._gammaCorrection}set gammaCorrection(t){t!==this._gammaCorrection&&(this._gammaCorrection=t,this.updateShaders=!0)}get toneMapping(){return this._toneMapping}set toneMapping(t){t!==this._toneMapping&&(this._toneMapping=t,this.updateShaders=!0)}get skybox(){return this._skyboxCubeMap}set skybox(t){this._skyboxCubeMap=t,this._resetSkyboxModel(),this.updateShaders=!0}get skyboxIntensity(){return this._skyboxIntensity}set skyboxIntensity(t){this._skyboxIntensity=t,this._resetSkyboxModel(),this.updateShaders=!0}get skyboxRotation(){return this._skyboxRotation}set skyboxRotation(t){this._skyboxRotation.equals(t)||(this._skyboxRotation.copy(t),this._resetSkyboxModel(),this.updateShaders=!0)}get skyboxMip(){return this._skyboxMip}set skyboxMip(t){this._skyboxMip=t,this._resetSkyboxModel(),this.updateShaders=!0}get skyboxPrefiltered128(){return this._skyboxPrefiltered[0]}set skyboxPrefiltered128(t){this._skyboxPrefiltered[0]!==t&&(this._skyboxPrefiltered[0]=t,this.updateShaders=!0)}get skyboxPrefiltered64(){return this._skyboxPrefiltered[1]}set skyboxPrefiltered64(t){this._skyboxPrefiltered[1]!==t&&(this._skyboxPrefiltered[1]=t,this.updateShaders=!0)}get skyboxPrefiltered32(){return this._skyboxPrefiltered[2]}set skyboxPrefiltered32(t){this._skyboxPrefiltered[2]!==t&&(this._skyboxPrefiltered[2]=t,this.updateShaders=!0)}get skyboxPrefiltered16(){return this._skyboxPrefiltered[3]}set skyboxPrefiltered16(t){this._skyboxPrefiltered[3]!==t&&(this._skyboxPrefiltered[3]=t,this.updateShaders=!0)}get skyboxPrefiltered8(){return this._skyboxPrefiltered[4]}set skyboxPrefiltered8(t){this._skyboxPrefiltered[4]!==t&&(this._skyboxPrefiltered[4]=t,this.updateShaders=!0)}get skyboxPrefiltered4(){return this._skyboxPrefiltered[5]}set skyboxPrefiltered4(t){this._skyboxPrefiltered[5]!==t&&(this._skyboxPrefiltered[5]=t,this.updateShaders=!0)}get drawCalls(){var t=this.layers._meshInstances;return t.length||(this.layers._update(),t=this.layers._meshInstances),t}set drawCalls(t){}get layers(){return this._layers}set layers(t){var e=this._layers;this._layers=t,this.fire("set:layers",e,t)}get defaultMaterial(){return _e.defaultMaterial}set defaultMaterial(t){_e.defaultMaterial=t}applySettings(t){this._gravity.set(t.physics.gravity[0],t.physics.gravity[1],t.physics.gravity[2]),this.ambientLight.set(t.render.global_ambient[0],t.render.global_ambient[1],t.render.global_ambient[2]),this._fog=t.render.fog,this.fogColor.set(t.render.fog_color[0],t.render.fog_color[1],t.render.fog_color[2]),this.fogStart=t.render.fog_start,this.fogEnd=t.render.fog_end,this.fogDensity=t.render.fog_density,this._gammaCorrection=t.render.gamma_correction,this._toneMapping=t.render.tonemapping,this.lightmapSizeMultiplier=t.render.lightmapSizeMultiplier,this.lightmapMaxResolution=t.render.lightmapMaxResolution,this.lightmapMode=t.render.lightmapMode,this.exposure=t.render.exposure,this._skyboxIntensity=void 0===t.render.skyboxIntensity?1:t.render.skyboxIntensity,this._skyboxMip=void 0===t.render.skyboxMip?0:t.render.skyboxMip,void 0!==t.render.skyboxRotation&&this._skyboxRotation.setFromEulerAngles(t.render.skyboxRotation[0],t.render.skyboxRotation[1],t.render.skyboxRotation[2]),this._resetSkyboxModel(),this.updateShaders=!0}_updateSkybox(t){if(!this.skyboxModel){var e=this._skyboxMip?this._skyboxPrefiltered[[0,1,3,4,5,6][this._skyboxMip]]||this._skyboxPrefiltered[0]||this._skyboxCubeMap:this._skyboxCubeMap||this._skyboxPrefiltered[0];if(!e)return;e._isRenderTarget?this._skyboxIsRenderTarget=!0:this._skyboxIsRenderTarget=!1;var i=new _e,n=this;i.updateShader=function(i,r,s,a,o){var l=t.getProgramLibrary().getProgram("skybox",{rgbm:"rgbm"===e.type,hdr:"rgbm"===e.type||14===e.format,useIntensity:1!==n.skyboxIntensity,useCubeMapRotation:!n.skyboxRotation.equals($.IDENTITY),useRightHandedCubeMap:n._skyboxIsRenderTarget,mip:e.fixCubemapSeams?n.skyboxMip:0,fixSeams:e.fixCubemapSeams,gamma:1===o?n.gammaCorrection?3:0:n.gammaCorrection,toneMapping:1===o?0:n.toneMapping});this.shader=l},i.updateShader(),i.setParameter("texture_cubeMap",e),this.skyboxRotation.equals($.IDENTITY)||(this._skyboxRotationMat4||(this._skyboxRotationMat4=new Q),this._skyboxRotationMat3||(this._skyboxRotationMat3=new G),this._skyboxRotationMat4.setTRS(pc.Vec3.ZERO,this._skyboxRotation,pc.Vec3.ONE),this._skyboxRotationMat4.invertTo3x3(this._skyboxRotationMat3),i.setParameter("cubeMapRotationMatrix",this._skyboxRotationMat3.data)),i.cull=2,i.depthWrite=!1;var r=this.layers.getLayerById(2);if(r){var s=new _i,a=Hr(t),o=new Ee(s,a,i);o.cull=!1,o._noDepthDrawGl1=!0;var l=new Ne;l.graph=s,l.meshInstances=[o],this.skyboxModel=l,r.addMeshInstances(l.meshInstances),this.skyLayer=r,this._firstUpdateSkybox&&(r.enabled=!0,this._firstUpdateSkybox=!1),this.fire("set:skybox",e)}}}_resetSkyboxModel(){this.skyboxModel&&(this.skyLayer.removeMeshInstances(this.skyboxModel.meshInstances),this.skyboxModel.destroy()),this.skyboxModel=null,this.updateSkybox=!0}setSkybox(t){var e;t||(t=[null,null,null,null,null,null,null]);var i=!1;if(this._skyboxCubeMap!==t[0]&&(i=!0),!i)for(e=0;e<6&&!i;e++)this._skyboxPrefiltered[e]!==t[e+1]&&(i=!0);if(i){for(e=0;e<6;e++)this._skyboxPrefiltered[e]=t[e+1];this.skybox=t[0]}}addModel(t){if(!this.containsModel(t)){var e=this.layers.getLayerById(0);e&&(e.addMeshInstances(t.meshInstances),this._models.push(t))}}addShadowCaster(t){var e=this.layers.getLayerById(0);e&&e.addShadowCasters(t.meshInstances)}removeModel(t){var e=this._models.indexOf(t);if(-1!==e){var i=this.layers.getLayerById(0);if(!i)return;i.removeMeshInstances(t.meshInstances),this._models.splice(e,1)}}removeShadowCasters(t){var e=this.layers.getLayerById(0);e&&e.removeShadowCasters(t.meshInstances)}containsModel(t){return this._models.indexOf(t)>=0}getModels(t){return this._models}}function Yr(){return"undefined"!=typeof Audio}function qr(){return!("undefined"==typeof AudioContext&&"undefined"==typeof webkitAudioContext)}class Kr{constructor(t,e,i={}){if(this.volume=void 0===i.volume?1:i.volume,this.loop=void 0!==i.loop&&i.loop,this.pitch=void 0===i.pitch?1:i.pitch,this.sound=e,this.paused=!1,this.suspended=!1,this.manager=t,this.source=null,qr()){this.startTime=0,this.startOffset=0;const e=t.context;this.gain=e.createGain()}else Yr()&&e.audio&&(this.source=e.audio.cloneNode(!1),this.source.pause())}getVolume(){return this.volume}getLoop(){return this.loop}setLoop(t){this.loop=t,this.source&&(this.source.loop=t)}getPitch(){return this.pitch}onManagerVolumeChange(){this.setVolume(this.getVolume())}onManagerSuspend(){this.isPlaying()&&!this.suspended&&(this.suspended=!0,this.pause())}onManagerResume(){this.suspended&&(this.suspended=!1,this.unpause())}}qr()?Object.assign(Kr.prototype,{play:function(){if(this.source)throw new Error("Call stop() before calling play()");this._createSource(),this.source&&(this.startTime=this.manager.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration),this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch),this.manager.on("volumechange",this.onManagerVolumeChange,this),this.manager.on("suspend",this.onManagerSuspend,this),this.manager.on("resume",this.onManagerResume,this),this.manager.suspended&&this.onManagerSuspend())},pause:function(){this.source&&(this.paused=!0,this.startOffset+=this.manager.context.currentTime-this.startTime,this.source.stop(0),this.source=null)},unpause:function(){!this.source&&this.paused?(this._createSource(),this.source&&(this.startTime=this.manager.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration),this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch),this.paused=!1)):console.warn("Call pause() before unpausing.")},stop:function(){this.source&&(this.source.stop(0),this.source=null),this.manager.off("volumechange",this.onManagerVolumeChange,this),this.manager.off("suspend",this.onManagerSuspend,this),this.manager.off("resume",this.onManagerResume,this)},setVolume:function(t){t=k.clamp(t,0,1),this.volume=t,this.gain&&(this.gain.gain.value=t*this.manager.volume)},setPitch:function(t){this.pitch=t,this.source&&(this.source.playbackRate.value=t)},isPlaying:function(){return!this.paused&&this.source.playbackState===this.source.PLAYING_STATE},getDuration:function(){return this.source?this.source.buffer.duration:0},_createSource:function(){const t=this.manager.context;this.sound.buffer&&(this.source=t.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this.gain),this.gain.connect(t.destination),this.loop||(this.source.onended=this.pause.bind(this)))}}):Yr()&&Object.assign(Kr.prototype,{play:function(){this.source&&(this.paused=!1,this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch),this.source.play()),this.manager.on("volumechange",this.onManagerVolumeChange,this),this.manager.on("suspend",this.onManagerSuspend,this),this.manager.on("resume",this.onManagerResume,this),this.manager.suspended&&this.onManagerSuspend()},pause:function(){this.source&&(this.paused=!0,this.source.pause())},unpause:function(){this.source&&(this.paused=!1,this.source.play())},stop:function(){this.source&&this.source.pause(),this.manager.off("volumechange",this.onManagerVolumeChange,this),this.manager.off("suspend",this.onManagerSuspend,this),this.manager.off("resume",this.onManagerResume,this)},setVolume:function(t){t=k.clamp(t,0,1),this.volume=t,this.source&&(this.source.volume=t*this.manager.volume)},setPitch:function(t){this.pitch=t,this.source&&(this.source.playbackRate=t)},getDuration:function(){return this.source&&!isNaN(this.source.duration)?this.source.duration:0},isPlaying:function(){return!this.source.paused}});class Jr extends Kr{constructor(t,e,i){super(t,e,i),this.position=new H,this.velocity=new H,qr()?this.panner=t.context.createPanner():(this.maxDistance=1e4,this.minDistance=1,this.rollOffFactor=1,this.distanceModel="inverse")}getPosition(){return this.position}getVelocity(){return this.velocity}}if(qr())Object.assign(Jr.prototype,{setPosition:function(t){this.position.copy(t),this.panner.setPosition(t.x,t.y,t.z)},setVelocity:function(t){this.velocity.copy(t),this.panner.setVelocity(t.x,t.y,t.z)},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},getMinDistance:function(){return this.panner.refDistance},setMinDistance:function(t){this.panner.refDistance=t},getRollOffFactor:function(){return this.panner.rolloffFactor},setRollOffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.pannel.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},_createSource:function(){const t=this.manager.context;this.source=t.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this.panner),this.panner.connect(this.gain),this.gain.connect(t.destination),this.loop||(this.source.onended=this.pause.bind(this))}});else{let t=new H;const e=function(e,i,n,r,s,a){t=t.sub2(e,i);let o=t.length();if(o<n)return 1;if(o>r)return 0;let l=0;return"linear"===a?l=1-s*(o-n)/(r-n):"inverse"===a?l=n/(n+s*(o-n)):"exponential"===a&&(l=Math.pow(o/n,-s)),k.clamp(l,0,1)};Object.assign(Jr.prototype,{setPosition:function(t){if(this.position.copy(t),this.source){const t=this.manager.listener.getPosition(),i=e(t,this.position,this.minDistance,this.maxDistance,this.rollOffFactor,this.distanceModel),n=this.getVolume();this.source.volume=n*i}},setVelocity:function(t){this.velocity.copy(t)},getMaxDistance:function(){return this.maxDistance},setMaxDistance:function(t){this.maxDistance=t},getMinDistance:function(){return this.minDistance},setMinDistance:function(t){this.minDistance=t},getRollOffFactor:function(){return this.rollOffFactor},setRollOffFactor:function(t){this.rollOffFactor=t},getDistanceModel:function(){return this.distanceModel},setDistanceModel:function(t){this.distanceModel=t}})}class Qr{constructor(t){this.position=new H,this.velocity=new H,this.orientation=new Q,qr()&&(this.listener=t.context.listener)}getPosition(){return this.position}setPosition(t){this.position.copy(t),this.listener&&this.listener.setPosition(t.x,t.y,t.z)}getVelocity(){return this.velocity}setVelocity(t){this.velocity.copy(t),this.listener&&this.listener.setPosition(t.x,t.y,t.z)}setOrientation(t){this.orientation.copy(t),this.listener&&this.listener.setOrientation(-t.data[8],-t.data[9],-t.data[10],t.data[4],t.data[5],t.data[6])}getOrientation(){return this.orientation}}class $r extends v{constructor(t){if(super(),qr()||t.forceWebAudioApi){if("undefined"!=typeof AudioContext?this.context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this.context=new webkitAudioContext),this.context){var e=this.context;if(this.resumeContext=function(){this.context.resume(),window.removeEventListener("mousedown",this.resumeContext),window.removeEventListener("touchend",this.resumeContext)}.bind(this),window.addEventListener("mousedown",this.resumeContext),window.addEventListener("touchend",this.resumeContext),w.ios){window.addEventListener("touchend",(function t(){var i=e.createBuffer(1,1,44100),n=e.createBufferSource();n.buffer=i,n.connect(e.destination),n.start(0),n.disconnect(),window.removeEventListener("touchend",t)}))}}}else console.warn("No support for 3D audio found");Yr()||console.warn("No support for 2D audio found"),this.listener=new Qr(this),this._volume=1,this.suspended=!1}suspend(){this.suspended=!0,this.fire("suspend")}resume(){this.suspended=!1,this.fire("resume")}destroy(){window.removeEventListener("mousedown",this.resumeContext),window.removeEventListener("touchend",this.resumeContext),this.fire("destroy"),this.context&&this.context.close&&(this.context.close(),this.context=null)}playSound(t,e){e=e||{};var i=null;return Kr&&(i=new Kr(this,t,e)).play(),i}playSound3d(t,e,i){i=i||{};var n=null;return Jr&&((n=new Jr(this,t,i)).setPosition(e),i.volume&&n.setVolume(i.volume),i.loop&&n.setLoop(i.loop),i.maxDistance&&n.setMaxDistance(i.maxDistance),i.minDistance&&n.setMinDistance(i.minDistance),i.rollOffFactor&&n.setRollOffFactor(i.rollOffFactor),i.distanceModel&&n.setDistanceModel(i.distanceModel),n.play()),n}get volume(){return this._volume}set volume(t){t=k.clamp(t,0,1),this._volume=t,this.fire("volumechange",t)}}class ts{constructor(t,e,i,n){this.time=t,this.position=e,this.rotation=i,this.scale=n}}class es{constructor(){this._name="",this._keys=[]}}class is{constructor(){this.name="",this.duration=0,this._nodes=[],this._nodeDict={}}getNode(t){return this._nodeDict[t]}get nodes(){return this._nodes}addNode(t){this._nodes.push(t),this._nodeDict[t._name]=t}}class ns{constructor(t){2===arguments.length&&(t=arguments[1]),this.options=t,this.name=t.name,this.defaultWeight=t.defaultWeight||0,this.aabb=t.aabb,this.aabb||(this.aabb=new st,t.deltaPositions&&this.aabb.compute(t.deltaPositions)),this.deltaPositions=t.deltaPositions}get morphPositions(){return!!this._vertexBufferPositions||!!this.texturePositions}get morphNormals(){return!!this._vertexBufferNormals||!!this.textureNormals}_postInit(){this.options=null}_initVertexBuffers(t){var e=this.options;this._vertexBufferPositions=this._createVertexBuffer(t,e.deltaPositions,e.deltaPositionsType),this._vertexBufferNormals=this._createVertexBuffer(t,e.deltaNormals,e.deltaNormalsType),this._vertexBufferPositions&&(this.deltaPositions=this._vertexBufferPositions.lock())}_createVertexBuffer(t,e,i=6){return e?new _t(t,new bt(t,[{semantic:"ATTR0",components:3,type:i}]),e.length/3,0,e):null}_setTexture(t,e){this[t]=e}destroy(){this._vertexBufferPositions&&(this._vertexBufferPositions.destroy(),this._vertexBufferPositions=null),this._vertexBufferNormals&&(this._vertexBufferNormals.destroy(),this._vertexBufferNormals=null),this.texturePositions&&(this.texturePositions.destroy(),this.texturePositions=null),this.textureNormals&&(this.textureNormals.destroy(),this.textureNormals=null)}}class rs{constructor(t,e,i){this.device=t,this.inverseBindPose=e,this.boneNames=i}}class ss{constructor(t,e,i,n){this._paths=t,this._input=e,this._output=i,this._interpolation=n}get paths(){return this._paths}get input(){return this._input}get output(){return this._output}get interpolation(){return this._interpolation}}class as{constructor(t,e){this._components=t,this._data=e}get components(){return this._components}get data(){return this._data}}class os{constructor(t,e,i,n,r){this._name=t,this._duration=e,this._inputs=i,this._outputs=n,this._curves=r}get name(){return this._name}get duration(){return this._duration}get inputs(){return this._inputs}get outputs(){return this._outputs}get curves(){return this._curves}eval(t,e){e._time=t;var i,n=this._inputs,r=this._outputs,s=this._curves,a=e._cache,o=e._results;for(i=0;i<n.length;++i)a[i].update(t,n[i]._data);for(i=0;i<s.length;++i){var l=s[i],h=r[l._output],c=o[i];a[l._input].eval(c,l._interpolation,h)}}}class ls{constructor(){}_validate(t){if(!t.header)throw new Error('pc.I18n#addData: Missing "header" field');if(!t.header.version)throw new Error('pc.I18n#addData: Missing "header.version" field');if(1!==t.header.version)throw new Error('pc.I18n#addData: Invalid "header.version" field');if(!t.data)throw new Error('pc.I18n#addData: Missing "data" field');if(!Array.isArray(t.data))throw new Error('pc.I18n#addData: "data" field must be an array');for(var e=0,i=t.data.length;e<i;e++){var n=t.data[e];if(!n.info)throw new Error('pc.I18n#addData: missing "data['+e+'].info" field');if(!n.info.locale)throw new Error('pc.I18n#addData: missing "data['+e+'].info.locale" field');if("string"!=typeof n.info.locale)throw new Error('pc.I18n#addData: "data['+e+'].info.locale" must be a string');if(!n.messages)throw new Error('pc.I18n#addData: missing "data['+e+'].messages" field')}}parse(t){return t.data}}var hs={},cs=function(t,e){for(var i=0,n=t.length;i<n;i++)hs[t[i]]=e},us=function(t){var e=t.indexOf("-");return-1!==e?t.substring(0,e):t};const ds={en:"en-US",es:"en-ES",zh:"zh-CN","zh-HK":"zh-TW","zh-TW":"zh-HK","zh-MO":"zh-HK",fr:"fr-FR",de:"de-DE",it:"it-IT",ru:"ru-RU",ja:"ja-JP"};cs(["ja","ko","th","vi","zh","id"],(function(t){return 0})),cs(["fa","hi"],(function(t){return t>=0&&t<=1?0:1})),cs(["fr","pt"],(function(t){return t>=0&&t<2?0:1})),cs(["da"],(function(t){return 1===t||!Number.isInteger(t)&&t>=0&&t<=1?0:1})),cs(["de","en","it","el","es","tr","fi","sv","nb","no","ur"],(function(t){return 1===t?0:1})),cs(["ru","uk"],(function(t){if(Number.isInteger(t)){var e=t%10,i=t%100;if(1===e&&11!==i)return 0;if(e>=2&&e<=4&&(i<12||i>14))return 1;if(0===e||e>=5&&e<=9||i>=11&&i<=14)return 2}return 3})),cs(["pl"],(function(t){if(Number.isInteger(t)){if(1===t)return 0;var e=t%10,i=t%100;if(e>=2&&e<=4&&(i<12||i>14))return 1;if(e>=0&&e<=1||e>=5&&e<=9||i>=12&&i<=14)return 2}return 3})),cs(["ar"],(function(t){if(0===t)return 0;if(1===t)return 1;if(2===t)return 2;if(Number.isInteger(t)){var e=t%100;if(e>=3&&e<=10)return 3;if(e>=11&&e<=99)return 4}return 5}));var fs=hs[us("en-US")],ps=function(t){return hs[t]||fs};class ms extends v{constructor(t){super(),this.destroy=function(){this._translations=null,this._availableLangs=null,this._assets=null,this._parser=null,this.off()},this.locale="en-US",this._translations={},this._availableLangs={},this._app=t,this._assets=[],this._parser=new ls}static findAvailableLocale(t,e){if(e[t])return t;var i=ds[t];if(i&&e[i])return i;var n=us(t);return e[i=ds[n]]?i:e[n]?n:"en-US"}getText(t,e){var i,n=t;e||(e=this._locale,i=this._lang);var r=this._translations[e];return r||(i||(i=us(e)),e=this._findFallbackLocale(e,i),r=this._translations[e]),r&&r.hasOwnProperty(t)&&(n=r[t],Array.isArray(n)&&(n=n[0]),null==n&&(n=t)),n}getPluralText(t,e,i){var n,r,s=t;i?(r=us(i),n=ps(r)):(i=this._locale,r=this._lang,n=this._pluralFn);var a=this._translations[i];if(a||(i=this._findFallbackLocale(i,r),r=us(i),n=ps(r),a=this._translations[i]),a&&a[t]&&n){var o=n(e);null==(s=a[t][o])&&(s=t)}return s}addData(t){var e;try{e=this._parser.parse(t)}catch(t){return void console.error(t)}for(var i=0,n=e.length;i<n;i++){var r=e[i],s=r.info.locale,a=r.messages;if(!this._translations[s]){this._translations[s]={};var o=us(s);this._availableLangs[o]||(this._availableLangs[o]=s)}Object.assign(this._translations[s],a),this.fire("data:add",s,a)}}removeData(t){var e,i;try{e=this._parser.parse(t)}catch(t){return void console.error(t)}for(var n=0,r=e.length;n<r;n++){var s=e[n],a=s.info.locale,o=this._translations[a];if(o){var l=s.messages;for(i in l)delete o[i];var h=!1;for(i in o){h=!0;break}h||(delete this._translations[a],delete this._availableLangs[us(a)]),this.fire("data:remove",a,l)}}}get locale(){return this._locale}set locale(t){if(this._locale!==t){var e=us(t);if("in"!==e||(n=e="id",t=-1!==(r=(i=t).indexOf("-"))?n+i.substring(r):n,this._locale!==t)){var i,n,r,s=this._locale;this._locale=t,this._lang=e,this._pluralFn=ps(this._lang),this.fire("set:locale",t,s)}}}get assets(){return this._assets}set assets(t){var e,i,n,r,s={};for(e=0,i=t.length;e<i;e++)s[n=t[e]instanceof As?t[e].id:t[e]]=!0;for(e=this._assets.length;e--;)s[n=this._assets[e]]||(this._app.assets.off("add:"+n,this._onAssetAdd,this),(r=this._app.assets.get(n))&&this._onAssetRemove(r),this._assets.splice(e,1));for(n in s)n=parseInt(n,10),-1===this._assets.indexOf(n)&&(this._assets.push(n),(r=this._app.assets.get(n))?this._onAssetAdd(r):this._app.assets.once("add:"+n,this._onAssetAdd,this))}_findFallbackLocale(t,e){var i=ds[t];return i&&this._translations[i]||(i=ds[e])&&this._translations[i]||(i=this._availableLangs[e])&&this._translations[i]?i:"en-US"}_onAssetAdd(t){t.on("load",this._onAssetLoad,this),t.on("change",this._onAssetChange,this),t.on("remove",this._onAssetRemove,this),t.on("unload",this._onAssetUnload,this),t.resource&&this._onAssetLoad(t)}_onAssetLoad(t){this.addData(t.resource)}_onAssetChange(t){t.resource&&this.addData(t.resource)}_onAssetRemove(t){t.off("load",this._onAssetLoad,this),t.off("change",this._onAssetChange,this),t.off("remove",this._onAssetRemove,this),t.off("unload",this._onAssetUnload,this),t.resource&&this.removeData(t.resource),this._app.assets.once("add:"+t.id,this._onAssetAdd,this)}_onAssetUnload(t){t.resource&&this.removeData(t.resource)}}const gs=new RegExp("^\\s*(?:(?:[a-z]+[a-z0-9\\-\\+\\.]*:)?//|data:|blob:)","i"),vs=[];class _s{constructor(t){this.asset=t}clear(){for(let t=0;t<vs.length;t++)this[vs[t]]=null}}function ys(t){const e="_"+t;vs.push(e),Object.defineProperty(_s.prototype,t,{get:function(){return this[e]||null},set:function(t){(!!this[e]!==!!t||this[e]&&t&&this[e].hash!==t.hash)&&(this[e]=t?{url:t.url,filename:t.filename,size:t.size,hash:t.hash,opt:t.opt||0}:null,this.asset.file&&(this.asset.fire("change",this.asset,"file",this.asset._file,this.asset._file),this.asset.reload()))}})}ys("dxt"),ys("pvr"),ys("etc1"),ys("etc2"),ys("basis");var bs=-1;const xs={pvr:"extCompressedTexturePVRTC",dxt:"extCompressedTextureS3TC",etc2:"extCompressedTextureETC",etc1:"extCompressedTextureETC1",basis:"canvas"},ws=["pvr","dxt","etc2","etc1","basis"];class As extends v{constructor(t,e,i,n,r){super(),this._id=bs--,this.name=t||"",this.type=e,this.tags=new L(this),this._preload=!1,this.variants=new _s(this),this._file=null,this._data=n||{},this.options=r||{},this._resources=[],this._i18n={},this.loaded=!1,this.loading=!1,this.registry=null,i&&(this.file=i)}getFileUrl(){var t=this.getPreferredFile();if(!t||!t.url)return null;var e=t.url;if(this.registry&&this.registry.prefix&&!gs.test(e)&&(e=this.registry.prefix+e),"script"!==this.type&&t.hash){var i=-1!==e.indexOf("?")?"&":"?";e+=i+"t="+t.hash}return e}getPreferredFile(){if(!this.file)return null;if("texture"===this.type||"textureatlas"===this.type||"bundle"===this.type)for(var t=this.registry._loader._app,e=t.graphicsDevice,i=0,n=ws.length;i<n;i++){var r=ws[i];if(e[xs[r]]){if(this.file.variants[r])return this.file.variants[r];if(t.enableBundles){var s=t.bundles.listBundlesForAsset(this);if(!s)continue;for(var a=0,o=s.length;a<o;a++)if(s[a].file&&s[a].file.variants&&s[a].file.variants[r])return this.file}}}return this.file}getAbsoluteUrl(t){var e=x.getDirectory(this.file.url);return x.join(e,t)}getLocalizedAssetId(t){return t=ms.findAvailableLocale(t,this._i18n),this._i18n[t]||null}addLocalizedAssetId(t,e){this._i18n[t]=e,this.fire("add:localized",t,e)}removeLocalizedAssetId(t){var e=this._i18n[t];e&&(delete this._i18n[t],this.fire("remove:localized",t,e))}ready(t,e){e=e||this,this.resource?t.call(e,this):this.once("load",(function(i){t.call(e,i)}))}reload(){this.loaded&&(this.loaded=!1,this.registry.load(this))}unload(){if(this.loaded||0!==this._resources.length){this.fire("unload",this),this.registry.fire("unload:"+this.id,this);var t=this._resources;this.resources=[],this.loaded=!1,this.file&&this.registry._loader.clearCache(this.getFileUrl(),this.type);for(var e=0;e<t.length;++e){var i=t[e];i&&i.destroy&&i.destroy()}}}get id(){return this._id}set id(t){this._id=t}get file(){return this._file}set file(t){var e;if(!!t!==!!this._file||t&&this._file&&t.hash!==this._file)if(t){if(this._file||(this._file={}),this._file.url=t.url,this._file.filename=t.filename,this._file.hash=t.hash,this._file.size=t.size,this._file.variants=this.variants,this._file.contents=t.contents,t.hasOwnProperty("variants")&&(this.variants.clear(),t.variants))for(e in t.variants)t.variants[e]&&(this.variants[e]=t.variants[e]);this.fire("change",this,"file",this._file,this._file),this.reload()}else this._file=null,this.variants.clear();else if(t&&this._file&&t.hasOwnProperty("variants")&&(this.variants.clear(),t.variants))for(e in t.variants)t.variants[e]&&(this.variants[e]=t.variants[e])}get data(){return this._data}set data(t){var e=this._data;this._data=t,t!==e&&(this.fire("change",this,"data",t,e),this.loaded&&this.registry._loader.patch(this,this.registry))}get resource(){return this._resources[0]}set resource(t){var e=this._resources[0];this._resources[0]=t,this.fire("change",this,"resource",t,e)}get resources(){return this._resources}set resources(t){var e=this._resources;this._resources=t,this.fire("change",this,"resources",t,e)}get preload(){return this._preload}set preload(t){t=!!t,this._preload!==t&&(this._preload=t,this._preload&&!this.loaded&&!this.loading&&this.registry&&this.registry.load(this))}get loadFaces(){return this._loadFaces}set loadFaces(t){t=!!t,this.hasOwnProperty("_loadFaces")&&t===this._loadFaces||(this._loadFaces=t,this.loaded&&this.registry._loader.patch(this,this.registry))}}class Cs{constructor(){}static joinPath(t,e){e=e||".";return t.map((function(t){return t.replace(/\\/g,"\\\\").replace(new RegExp("\\"+e,"g"),"\\"+e)})).join(e)}static splitPath(t,e){e=e||".";for(var i=[],n="",r=0;r<t.length;){var s=t[r++];"\\"===s&&r<t.length?n+="\\"===(s=t[r++])||s===e?s:"\\"+s:s===e?(i.push(n),n=""):n+=s}return n.length>0&&i.push(n),i}resolve(t){return null}unresolve(t){}update(t){}}class Is{constructor(){}encode(t){return Cs.joinPath([Cs.joinPath(t[0]),t[1],Cs.joinPath(t[2])],"/")}decode(t){var e=Cs.splitPath(t,"/");return[Cs.splitPath(e[0]),e[1],Cs.splitPath(e[2])]}}var Ss=function(t){return/^data:.*,.*$/i.test(t)},Ms=function(t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 3}},Ts=function(t){switch(t){case 5120:return 0;case 5121:return 1;case 5122:return 2;case 5123:return 3;case 5124:return 4;case 5125:return 5;case 5126:return 6;default:return 0}},Ps=function(t){switch(t){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:return 0}},Es={POSITION:"POSITION",NORMAL:"NORMAL",TANGENT:"TANGENT",COLOR_0:"COLOR",JOINTS_0:"BLENDINDICES",WEIGHTS_0:"BLENDWEIGHT",TEXCOORD_0:"TEXCOORD0",TEXCOORD_1:"TEXCOORD1"},ks=function t(e,i){var n,r=Ms(e.type),s=function(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:return null}}(e.componentType);if(!s)return null;if(e.sparse){var a=e.sparse,o={count:a.count,type:"SCALAR"},l=t(Object.assign(o,a.indices),i),h={count:a.count,type:e.scalar,componentType:e.componentType},c=t(Object.assign(h,a.values),i);if(e.hasOwnProperty("bufferView"))n=t({bufferView:e.bufferView,byteOffset:e.byteOffset,componentType:e.componentType,count:e.count,type:e.type},i).slice();else n=new s(e.count*r);for(var u=0;u<a.count;++u)for(var d=l[u],f=0;f<r;++f)n[d*r+f]=c[u*r+f]}else{var p=i[e.bufferView];n=new s(p.buffer,p.byteOffset+(e.hasOwnProperty("byteOffset")?e.byteOffset:0),e.count*r)}return n},Ds=function(t,e){var i=t.POSITION;if(i&&3===i.components){var n;if(i.size!==i.stride){var r=i.stride/pt[i.type],s=new ft[i.type](i.buffer,i.offset,i.count*r);n=new ft[i.type](3*i.count);for(var a=0;a<i.count;++a)n[3*a+0]=s[a*r+0],n[3*a+1]=s[a*r+1],n[3*a+2]=s[a*r+2]}else n=new ft[i.type](i.buffer,i.offset,3*i.count);var o=i.count;e||(e=function(t){for(var e=new Uint16Array(t),i=0;i<t;i++)e[i]=i;return e}(o));var l=function(t,e){var i,n,r,s,a=e.length/3,o=t.length/3,l=new H,h=new H,c=new H,u=new H,d=new H,f=new H,p=[];for(s=0;s<t.length;s++)p[s]=0;for(s=0;s<a;s++)i=e[3*s],n=e[3*s+1],r=e[3*s+2],l.set(t[3*i],t[3*i+1],t[3*i+2]),h.set(t[3*n],t[3*n+1],t[3*n+2]),c.set(t[3*r],t[3*r+1],t[3*r+2]),u.sub2(h,l),d.sub2(c,l),f.cross(u,d).normalize(),p[3*i]+=f.x,p[3*i+1]+=f.y,p[3*i+2]+=f.z,p[3*n]+=f.x,p[3*n+1]+=f.y,p[3*n+2]+=f.z,p[3*r]+=f.x,p[3*r+1]+=f.y,p[3*r+2]+=f.z;for(s=0;s<o;s++){var m=p[3*s],g=p[3*s+1],v=p[3*s+2],_=1/Math.sqrt(m*m+g*g+v*v);p[3*s]*=_,p[3*s+1]*=_,p[3*s+2]*=_}return p}(n,e),h=new Float32Array(l.length);h.set(l),t.NORMAL={buffer:h.buffer,size:12,offset:0,stride:12,count:o,components:3,type:6}}},Os=function(t){var e=new pc.Asset(t.name+"_clone",t.type,t.file,t.data,t.options);return e.loaded=!0,e.resource=function(t){var e=new pc.Texture(t.device,t);return e._levels=function(t){for(var e=[],i=0;i<t._levels.length;++i){var n=[];if(t.cubemap)for(var r=0;r<6;++r)n.push(t._levels[i][r]);else n=t._levels[i];e.push(n)}return e}(t),e}(t.resource),t.registry.add(e),e},Rs=function(t,e,i){var n=e.POSITION,r=n.count,s=[];for(var a in e)e.hasOwnProperty(a)&&s.push({semantic:a,components:e[a].components,type:e[a].type,normalize:!!e[a].normalize});var o,l,h,c,u,d,f=["POSITION","NORMAL","TANGENT","COLOR","BLENDINDICES","BLENDWEIGHT","TEXCOORD0","TEXCOORD1"];s.sort((function(t,e){var i=f.indexOf(t.semantic),n=f.indexOf(e.semantic);return i<n?-1:n<i?1:0}));var p=new bt(t,s),m=!0;for(o=0;o<p.elements.length;++o)if(d=(c=e[(u=p.elements[o]).name]).offset-n.offset,c.buffer!==n.buffer||c.stride!==u.stride||c.size!==u.size||d!==u.offset){m=!1;break}var g,v,_,y=new _t(t,p,r,0),b=y.lock(),x=new Uint32Array(b);if(m)g=new Uint32Array(n.buffer,n.offset,r*y.format.size/4),x.set(g);else for(o=0;o<y.format.elements.length;++o){v=(u=y.format.elements[o]).stride/4,c=e[u.name],g=new Uint32Array(c.buffer,c.offset,c.count*c.stride/4),_=c.stride/4;var w=0,A=u.offset/4,C=Math.floor((c.size+3)/4);for(l=0;l<r;++l){for(h=0;h<C;++h)x[A+h]=g[w+h];w+=_,A+=v}}return i||function(t){var e,i,n=[],r=[],s=[];for(e=0;e<t.format.elements.length;++e){var a=t.format.elements[e];if("TEXCOORD0"===a.name||"TEXCOORD1"===a.name)switch(a.dataType){case 6:n.push({offset:a.offset/4+1,stride:a.stride/4});break;case 3:r.push({offset:a.offset/2+1,stride:a.stride/2});break;case 1:s.push({offset:a.offset+1,stride:a.stride})}}var o=function(n,r,s){var a=new r(t.storage);for(e=0;e<n.length;++e){var o=n[e].offset,l=n[e].stride;for(i=0;i<t.numVertices;++i)a[o]=s-a[o],o+=l}};n.length>0&&o(n,Float32Array,1),r.length>0&&o(r,Uint16Array,65535),s.length>0&&o(s,Uint8Array,255)}(y),y.unlock(),y},Ls=new Q,Ns=new H,zs=function(t,e,i,n,r,s,a){var o=[];return e.primitives.forEach((function(l){var h,c,u,d=null,f=new Ie(t),p=!0;if(l.hasOwnProperty("extensions")){var m=l.extensions;if(m.hasOwnProperty("KHR_draco_mesh_compression")){var g=window.DracoDecoderModule;if(g){var v=m.KHR_draco_mesh_compression;if(v.hasOwnProperty("attributes")){var _=n[v.bufferView],y=new g.DecoderBuffer;y.Init(_,_.length);var b,x,w=new g.Decoder,A=w.GetEncodedGeometryType(y);switch(A){case g.POINT_CLOUD:h=0,b=new g.PointCloud,x=w.DecodeBufferToPointCloud(y,b);break;case g.TRIANGULAR_MESH:h=4,b=new g.Mesh,x=w.DecodeBufferToMesh(y,b);break;case g.INVALID_GEOMETRY_TYPE:}if(!x||!x.ok()||0==b.ptr)return void r("Failed to decode draco compressed asset: "+(x?x.error_msg():"Mesh asset - invalid draco compressed geometry type: "+A));var C=b.num_faces();if(A==g.TRIANGULAR_MESH){var I=b.num_points()>65535,S=(u=3*C)*(I?4:2),M=g._malloc(S);I?(w.GetTrianglesUInt32Array(b,S,M),d=new Uint32Array(g.HEAPU32.buffer,M,u).slice()):(w.GetTrianglesUInt16Array(b,S,M),d=new Uint16Array(g.HEAPU16.buffer,M,u).slice()),g._free(M)}c=function(t,e,i,n,r,s,a){var o=e.num_points(),l=function(t){var i,s,a,l,h=n.GetAttributeByUniqueId(e,t),c=o*h.num_components();switch(h.data_type()){case r.DT_UINT8:l=1,a=1,i=r._malloc(c*a),n.GetAttributeDataArrayForAllPoints(e,h,r.DT_UINT8,c*a,i),s=new Uint8Array(r.HEAPU8.buffer,i,c).slice();break;case r.DT_UINT16:l=3,a=2,i=r._malloc(c*a),n.GetAttributeDataArrayForAllPoints(e,h,r.DT_UINT16,c*a,i),s=new Uint16Array(r.HEAPU16.buffer,i,c).slice();break;case r.DT_FLOAT32:default:l=6,a=4,i=r._malloc(c*a),n.GetAttributeDataArrayForAllPoints(e,h,r.DT_FLOAT32,c*a,i),s=new Float32Array(r.HEAPF32.buffer,i,c).slice()}return r._free(i),{values:s,numComponents:h.num_components(),componentSizeInBytes:a,storageType:l,normalized:h.normalized()}},h={},c=i.attributes;for(var u in c)if(c.hasOwnProperty(u)&&Es.hasOwnProperty(u)){var d=Es[u],f=l(c[u]),p=f.numComponents*f.componentSizeInBytes;h[d]={values:f.values,buffer:f.values.buffer,size:p,offset:0,stride:p,count:o,components:f.numComponents,type:f.storageType,normalize:f.normalized}}return h.hasOwnProperty("NORMAL")||Ds(h,s),Rs(t,h,a)}(t,b,v,w,g,d,s),g.destroy(b),g.destroy(w),g.destroy(y),p=!1}}}}if(c||(d=l.hasOwnProperty("indices")?ks(i[l.indices],n):null,c=function(t,e,i,n,r,s,a){var o,l={},h=[];for(o in e)e.hasOwnProperty(o)&&Es.hasOwnProperty(o)&&(l[o]=e[o],h.push(o+":"+e[o]));h.sort();var c=h.join(),u=a[c];if(!u){var d={};for(o in l){var f=n[e[o]],p=ks(f,r),m=r[f.bufferView],g=Es[o],v=Ms(f.type)*Ps(f.componentType),_=m.hasOwnProperty("byteStride")?m.byteStride:v;d[g]={buffer:p.buffer,size:v,offset:p.byteOffset,stride:_,count:f.count,components:Ms(f.type),type:Ts(f.componentType),normalize:f.normalized}}d.hasOwnProperty("NORMAL")||Ds(d,i),u=Rs(t,d,s),a[c]=u}return u}(t,l.attributes,d,i,n,s,a),h=function(t){if(!t.hasOwnProperty("mode"))return 4;switch(t.mode){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;default:return 4}}(l)),f.vertexBuffer=c,f.primitive[0].type=h,f.primitive[0].base=0,f.primitive[0].indexed=null!==d,null!==d){var T;2!==(T=d instanceof Uint8Array?0:d instanceof Uint16Array?1:2)||t.extUintElement||(T=1,d=new Uint16Array(d));var P=new xe(t,T,d.length,0,d);f.indexBuffer[0]=P,f.primitive[0].count=d.length}else f.primitive[0].count=c.numVertices;f.materialIndex=l.material;var E=i[l.attributes.POSITION],k=E.min,D=E.max,O=new st(new H((D[0]+k[0])/2,(D[1]+k[1])/2,(D[2]+k[2])/2),new H((D[0]-k[0])/2,(D[1]-k[1])/2,(D[2]-k[2])/2));if(f.aabb=O,p&&l.hasOwnProperty("targets")){var R=[];if(l.targets.forEach((function(r,s){var a={};r.hasOwnProperty("POSITION")&&(E=i[r.POSITION],a.deltaPositions=ks(E,n),a.deltaPositionsType=Ts(E.componentType),E.hasOwnProperty("min")&&E.hasOwnProperty("max")&&(a.aabb=new st,a.aabb.setMinMax(new H(E.min),new H(E.max)))),r.hasOwnProperty("NORMAL")&&(E=i[r.NORMAL],a.deltaNormals=ks(E,n),a.deltaNormalsType=Ts(E.componentType)),e.hasOwnProperty("extras")&&e.extras.hasOwnProperty("targetNames")?a.name=e.extras.targetNames[s]:a.name=R.length.toString(10),R.push(new ns(t,a))})),f.morph=new De(R),e.hasOwnProperty("weights"))for(var L=0;L<e.weights.length;++L)R[L].defaultWeight=e.weights[L]}o.push(f)})),o},Bs=function(t,e,i){var n,r,s=["#ifdef MAPFLOAT","uniform float material_shininess;","#endif","","#ifdef MAPTEXTURE","uniform sampler2D texture_glossMap;","#endif","","void getGlossiness() {","\t\tdGlossiness = 1.0;","","#ifdef MAPFLOAT","\t\tdGlossiness *= material_shininess;","#endif","","#ifdef MAPTEXTURE","\t\tdGlossiness *= texture2D(texture_glossMap, $UV).$CH;","#endif","","#ifdef MAPVERTEX","\t\tdGlossiness *= saturate(vVertexColor.$VC);","#endif","","\t\tdGlossiness = 1.0 - dGlossiness;","","\t\tdGlossiness += 0.0000001;","}"].join("\n"),a=["#ifdef MAPCOLOR","uniform vec3 material_specular;","#endif","","#ifdef MAPTEXTURE","uniform sampler2D texture_specularMap;","#endif","","void getSpecularity() {","\t\tdSpecularity = vec3(1.0);","","\t\t#ifdef MAPCOLOR","\t\t\t\tdSpecularity *= material_specular;","\t\t#endif","","\t\t#ifdef MAPTEXTURE","\t\t\t\tvec3 srgb = texture2D(texture_specularMap, $UV).$CH;","\t\t\t\tdSpecularity *= vec3(pow(srgb.r, 2.2), pow(srgb.g, 2.2), pow(srgb.b, 2.2));","\t\t#endif","","\t\t#ifdef MAPVERTEX","\t\t\t\tdSpecularity *= saturate(vVertexColor.$VC);","\t\t#endif","}"].join("\n"),o=["#ifdef MAPFLOAT","uniform float material_clearCoatGlossiness;","#endif","","#ifdef MAPTEXTURE","uniform sampler2D texture_clearCoatGlossMap;","#endif","","void getClearCoatGlossiness() {","\t\tccGlossiness = 1.0;","","#ifdef MAPFLOAT","\t\tccGlossiness *= material_clearCoatGlossiness;","#endif","","#ifdef MAPTEXTURE","\t\tccGlossiness *= texture2D(texture_clearCoatGlossMap, $UV).$CH;","#endif","","#ifdef MAPVERTEX","\t\tccGlossiness *= saturate(vVertexColor.$VC);","#endif","","\t\tccGlossiness = 1.0 - ccGlossiness;","","\t\tccGlossiness += 0.0000001;","}"].join("\n"),l=[1,1],h=[0,0],c=function(t,e,n){var r,s=t.texCoord;if(s)for(r=0;r<n.length;++r)e[n[r]+"MapUv"]=s;var a=l,o=h,c=t.extensions;if(c){var u=c.KHR_texture_transform;u&&(u.scale&&(a=u.scale),u.offset&&(o=u.offset))}for(r=0;r<n.length;++r)e[n[r]+"MapTiling"]=new W(a[0],a[1]),e[n[r]+"MapOffset"]=new W(o[0],i?o[1]:1-a[1]-o[1])},u=new af;if(u.occludeSpecular=!0,u.diffuseTint=!0,u.diffuseVertexColor=!0,u.specularTint=!0,u.specularVertexColor=!0,t.hasOwnProperty("name")&&(u.name=t.name),t.hasOwnProperty("extensions")&&t.extensions.hasOwnProperty("KHR_materials_pbrSpecularGlossiness")){var d=t.extensions.KHR_materials_pbrSpecularGlossiness;if(d.hasOwnProperty("diffuseFactor")?(n=d.diffuseFactor,u.diffuse.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)),u.opacity=null!=n[3]?n[3]:1):(u.diffuse.set(1,1,1),u.opacity=1),d.hasOwnProperty("diffuseTexture")){var f=d.diffuseTexture;r=e[f.index],u.diffuseMap=r,u.diffuseMapChannel="rgb",u.opacityMap=r,u.opacityMapChannel="a",c(f,u,["diffuse","opacity"])}if(u.useMetalness=!1,d.hasOwnProperty("specularFactor")?(n=d.specularFactor,u.specular.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2))):u.specular.set(1,1,1),d.hasOwnProperty("glossinessFactor")?u.shininess=100*d.glossinessFactor:u.shininess=100,d.hasOwnProperty("specularGlossinessTexture")){var p=d.specularGlossinessTexture;u.specularMap=u.glossMap=e[p.index],u.specularMapChannel="rgb",u.glossMapChannel="a",c(p,u,["gloss","metalness"])}u.chunks.specularPS=a}else if(t.hasOwnProperty("pbrMetallicRoughness")){var m=t.pbrMetallicRoughness;if(m.hasOwnProperty("baseColorFactor")?(n=m.baseColorFactor,u.diffuse.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)),u.opacity=n[3]):(u.diffuse.set(1,1,1),u.opacity=1),m.hasOwnProperty("baseColorTexture")){var g=m.baseColorTexture;r=e[g.index],u.diffuseMap=r,u.diffuseMapChannel="rgb",u.opacityMap=r,u.opacityMapChannel="a",c(g,u,["diffuse","opacity"])}if(u.useMetalness=!0,m.hasOwnProperty("metallicFactor")?u.metalness=m.metallicFactor:u.metalness=1,m.hasOwnProperty("roughnessFactor")?u.shininess=100*m.roughnessFactor:u.shininess=100,m.hasOwnProperty("metallicRoughnessTexture")){var v=m.metallicRoughnessTexture;u.metalnessMap=u.glossMap=e[v.index],u.metalnessMapChannel="b",u.glossMapChannel="g",c(v,u,["gloss","metalness"])}u.chunks.glossPS=s}if(t.hasOwnProperty("normalTexture")){var _=t.normalTexture;u.normalMap=e[_.index],c(_,u,["normal"]),_.hasOwnProperty("scale")&&(u.bumpiness=_.scale)}if(t.hasOwnProperty("occlusionTexture")){var y=t.occlusionTexture;u.aoMap=e[y.index],u.aoMapChannel="r",c(y,u,["ao"])}if(t.hasOwnProperty("emissiveFactor")?(n=t.emissiveFactor,u.emissive.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)),u.emissiveTint=!0):(u.emissive.set(0,0,0),u.emissiveTint=!1),t.hasOwnProperty("emissiveTexture")){var b=t.emissiveTexture;u.emissiveMap=e[b.index],c(b,u,["emissive"])}if(t.hasOwnProperty("alphaMode"))switch(t.alphaMode){case"MASK":u.blendType=3,t.hasOwnProperty("alphaCutoff")?u.alphaTest=t.alphaCutoff:u.alphaTest=.5;break;case"BLEND":u.blendType=2;break;default:case"OPAQUE":u.blendType=3}else u.blendType=3;if(t.hasOwnProperty("doubleSided")?(u.twoSidedLighting=t.doubleSided,u.cull=t.doubleSided?0:1):(u.twoSidedLighting=!1,u.cull=1),t.hasOwnProperty("extensions")&&t.extensions.hasOwnProperty("KHR_materials_clearcoat")){var x=t.extensions.KHR_materials_clearcoat;if(x.hasOwnProperty("clearcoatFactor")?u.clearCoat=.25*x.clearcoatFactor:u.clearCoat=0,x.hasOwnProperty("clearcoatTexture")){var w=x.clearcoatTexture;u.clearCoatMap=e[w.index],u.clearCoatMapChannel="r",c(w,u,["clearCoat"])}if(x.hasOwnProperty("clearcoatRoughnessFactor")?u.clearCoatGlossiness=x.clearcoatRoughnessFactor:u.clearCoatGlossiness=0,x.hasOwnProperty("clearcoatRoughnessTexture")){var A=x.clearcoatRoughnessTexture;u.clearCoatGlossMap=e[A.index],u.clearCoatGlossMapChannel="g",c(A,u,["clearCoatGloss"])}if(x.hasOwnProperty("clearcoatNormalTexture")){var C=x.clearcoatNormalTexture;u.clearCoatNormalMap=e[C.index],c(C,u,["clearCoatNormal"]),C.hasOwnProperty("scale")&&(u.clearCoatBumpiness=C.scale)}u.chunks.clearCoatGlossPS=o}return t.hasOwnProperty("extensions")&&t.extensions.hasOwnProperty("KHR_materials_unlit")&&(u.useLighting=!1,u.emissive.copy(u.diffuse),u.emissiveTint=u.diffuseTint,u.emissiveMap=u.diffuseMap,u.emissiveMapUv=u.diffuseMapUv,u.emissiveMapTiling.copy(u.diffuseMapTiling),u.emissiveMapOffset.copy(u.diffuseMapOffset),u.emissiveMapChannel=u.diffuseMapChannel,u.emissiveVertexColor=u.diffuseVertexColor,u.emissiveVertexColorChannel=u.diffuseVertexColorChannel,u.diffuse.set(0,0,0),u.diffuseTint=!1,u.diffuseMap=null,u.diffuseVertexColor=!1),u.update(),u},Fs=function(t,e){var i=new _i;if(t.hasOwnProperty("name")&&t.name.length>0?i.name=t.name:i.name="node_"+e,t.hasOwnProperty("matrix")&&(Ls.data.set(t.matrix),Ls.getTranslation(Ns),i.setLocalPosition(Ns),Ls.getEulerAngles(Ns),i.setLocalEulerAngles(Ns),Ls.getScale(Ns),i.setLocalScale(Ns)),t.hasOwnProperty("rotation")){var n=t.rotation;i.setLocalRotation(n[0],n[1],n[2],n[3])}if(t.hasOwnProperty("translation")){var r=t.translation;i.setLocalPosition(r[0],r[1],r[2])}if(t.hasOwnProperty("scale")){var s=t.scale;i.setLocalScale(s[0],s[1],s[2])}return i},js=function(t,e,i,n){return e.hasOwnProperty("skins")&&0!==e.skins.length?e.skins.map((function(r){return function(t,e,i,n,r){var s,a,o,l=e.joints,h=l.length,c=[];if(e.hasOwnProperty("inverseBindMatrices")){var u=e.inverseBindMatrices,d=ks(i[u],n),f=[];for(s=0;s<h;s++){for(a=0;a<16;a++)f[a]=d[16*s+a];(o=new Q).set(f),c.push(o)}}else for(s=0;s<h;s++)o=new Q,c.push(o);var p=[];for(s=0;s<h;s++)p[s]=r[l[s]].name;var m=e.skeleton,g=new rs(t,c,p);for(g.skeleton=r[m],g.bones=[],s=0;s<l.length;s++)g.bones[s]=r[l[s]];return g}(t,r,e.accessors,n,i)})):[]},Vs=function(t,e,i,n){if(!t.hasOwnProperty("animations")||0===t.animations.length)return[];var r=n&&n.animation&&n.animation.preprocess,s=n&&n.animation&&n.animation.postprocess;return t.animations.map((function(n,a){r&&r(n);var o=function(t,e,i,n,r){var s,a=function(t){var e=ks(t,n);return new as(Ms(t.type),new e.constructor(e))},o={STEP:0,LINEAR:1,CUBICSPLINE:2},l={},h=[],c={},u=[],d=[];for(s=0;s<t.samplers.length;++s){var f=t.samplers[s];l.hasOwnProperty(f.input)||(l[f.input]=h.length,h.push(a(i[f.input]))),c.hasOwnProperty(f.output)||(c[f.output]=u.length,u.push(a(i[f.output])));var p=f.hasOwnProperty("interpolation")&&o.hasOwnProperty(f.interpolation)?o[f.interpolation]:1;d.push(new ss([],l[f.input],c[f.output],p))}var m=[],g=new Is,v={translation:"localPosition",rotation:"localRotation",scale:"localScale",weights:"weights"};for(s=0;s<t.channels.length;++s){var _=t.channels[s],y=_.target,b=d[_.sampler];b._paths.push(g.encode([[r[y.node].name],"graph",[v[y.path]]])),y.path.startsWith("rotation")&&2!==b.interpolation?m.push(b.output):y.path.startsWith("weights")&&(u[b.output]._components=u[b.output].data.length/h[b.input].data.length)}m.sort();var x,w=null;for(s=0;s<m.length;++s){var A=m[s];if(0===s||A!==w){if(4===(x=u[A]).components)for(var C=x.data,I=C.length-4,S=0;S<I;S+=4){C[S+0]*C[S+4]+C[S+1]*C[S+5]+C[S+2]*C[S+6]+C[S+3]*C[S+7]<0&&(C[S+4]*=-1,C[S+5]*=-1,C[S+6]*=-1,C[S+7]*=-1)}w=A}}var M=0;for(s=0;s<h.length;s++)x=h[s]._data,M=Math.max(M,0===x.length?0:x[x.length-1]);return new os(t.hasOwnProperty("name")?t.name:"animation_"+e,M,h,u,d)}(n,a,t.accessors,i,e);return s&&s(n,o),o}))},Us=function(t,e,i,n,r,s){var a=r&&r.global&&r.global.preprocess,o=r&&r.global&&r.global.postprocess;a&&a(e);var l=e.asset&&"PlayCanvas"===e.asset.generator,h=function(t,e){if(!t.hasOwnProperty("nodes")||0===t.nodes.length)return[];for(var i=e&&e.node&&e.node.preprocess,n=e&&e.node&&e.node.process||Fs,r=e&&e.node&&e.node.postprocess,s=t.nodes.map((function(t,e){i&&i(t);var s=n(t,e);return r&&r(t,s),s})),a=0;a<t.nodes.length;++a){var o=t.nodes[a];if(o.hasOwnProperty("children"))for(var l=0;l<o.children.length;++l){var h=s[a],c=s[o.children[l]];c.parent||h.addChild(c)}}return s}(e,r),c=function(t,e){var i=[],n=t.scenes.length;if(1===n&&1===t.scenes[0].nodes.length){var r=t.scenes[0].nodes[0];i.push(e[r])}else for(var s=0;s<n;s++){for(var a=t.scenes[s],o=new _i(a.name),l=0;l<a.nodes.length;l++){var h=e[a.nodes[l]];o.addChild(h)}i.push(o)}return i}(e,h),u=Vs(e,h,i,r),d=function(t,e,i,n){if(!t.hasOwnProperty("materials")||0===t.materials.length)return[];var r=i&&i.material&&i.material.preprocess,s=i&&i.material&&i.material.process||Bs,a=i&&i.material&&i.material.postprocess;return t.materials.map((function(t){r&&r(t);var i=s(t,e,n);return a&&a(t,i),i}))}(e,n.map((function(t){return t.resource})),r,l),f=function(t,e,i,n,r){if(!e.hasOwnProperty("meshes")||0===e.meshes.length||!e.hasOwnProperty("accessors")||0===e.accessors.length||!e.hasOwnProperty("bufferViews")||0===e.bufferViews.length)return[];var s={};return e.meshes.map((function(a){return zs(t,a,e.accessors,i,n,r,s)}))}(t,e,i,s,l),p={gltf:e,nodes:h,scenes:c,animations:u,textures:n,materials:d,meshes:f,skins:js(t,e,h,i)};o&&o(e,p),s(null,p)},Gs=function(t,e,i,n,r,s,a){var o=s&&s.image&&s.image.preprocess,l=s&&s.image&&s.image.processAsync||function(t,e){e(null,null)},h=s&&s.image&&s.image.postprocess,c=function(e){h&&h(t,e),a(null,e)},u=function(t,i,n,s){var o={url:t};if(i){var l={"image/png":"png","image/jpeg":"jpg","image/basis":"basis","image/ktx":"ktx","image/vnd-ms.dds":"dds"}[i];l&&(o.filename="glb-texture-"+e+"."+l)}var h=new As("texture_"+e,"texture",o,null,{crossOrigin:n});h.on("load",(function(){s&&URL.revokeObjectURL(t),c(h)})),h.on("error",(function(t,e){a(t)})),r.add(h),r.load(h)};o&&o(t),l(t,(function(r,s){if(r)a(r);else if(s)c(s);else if(t.hasOwnProperty("uri"))Ss(t.uri)?u(t.uri,(l=t.uri).substring(l.indexOf(":")+1,l.indexOf(";"))):u(x.join(n,t.uri),null,"anonymous");else if(t.hasOwnProperty("bufferView")&&t.hasOwnProperty("mimeType")){var o=new Blob([i[t.bufferView]],{type:t.mimeType});u(URL.createObjectURL(o),t.mimeType,null,!0)}else a("Invalid image found in gltf (neither uri or bufferView found). index="+e);var l}))},Ws=function(t,e){var i=JSON.parse(function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return decodeURIComponent(escape(e))}(t));i.asset&&i.asset.version&&parseFloat(i.asset.version)<2?e("Invalid gltf version. Expected version 2.0 or above but found version '"+i.asset.version+"'."):e(null,i)},Hs=function(t,e,i){t&&t.toLowerCase().endsWith(".glb")?function(t,e){var i=new DataView(t),n=i.getUint32(0,!0),r=i.getUint32(4,!0),s=i.getUint32(8,!0);if(1179937895===n)if(2===r)if(s<=0||s>t.byteLength)e("Invalid length found in glb header. Found "+s);else{for(var a=[],o=12;o<s;){var l=i.getUint32(o,!0);if(o+l+8>t.byteLength)throw new Error("Invalid chunk length found in glb. Found "+l);var h=i.getUint32(o+4,!0),c=new Uint8Array(t,o+8,l);a.push({length:l,type:h,data:c}),o+=l+8}1===a.length||2===a.length?1313821514===a[0].type?a.length>1&&5130562!==a[1].type?e("Invalid chunk type found in glb file. Expected 0x004E4942, found 0x"+a[1].type.toString(16)):e(null,{gltfChunk:a[0].data,binaryChunk:2===a.length?a[1].data:null}):e("Invalid chunk type found in glb file. Expected 0x4E4F534A, found 0x"+a[0].type.toString(16)):e("Invalid number of chunks found in glb file.")}else e("Invalid version number found in glb header. Expected 2, found "+r);else e("Invalid magic number found in glb header. Expected 0x46546C67, found 0x"+n.toString(16))}(e,i):i(null,{gltfChunk:e,binaryChunk:null})},Xs=function(t,e,i,n){var r=[],s=i&&i.bufferView&&i.bufferView.preprocess,a=i&&i.bufferView&&i.bufferView.processAsync||function(t,e,i){i(null,null)},o=i&&i.bufferView&&i.bufferView.postprocess,l=t.bufferViews?t.bufferViews.length:0;if(l)for(var h=function(e,i){var s=t.bufferViews[e];s.hasOwnProperty("byteStride")&&(i.byteStride=s.byteStride),r[e]=i,o&&o(s,i),0==--l&&n(null,r)},c=0;c<t.bufferViews.length;++c){var u=t.bufferViews[c];s&&s(u),a(u,e,function(t,i,r,s){if(r)n(r);else if(s)h(t,s);else{var a=e[i.buffer],o=new Uint8Array(a.buffer,a.byteOffset+(i.hasOwnProperty("byteOffset")?i.byteOffset:0),i.byteLength);h(t,o)}}.bind(null,c,u))}else n(null,null)};class Zs{constructor(){}static parseAsync(t,e,i,n,r,s,a){Hs(t,i,(function(t,i){t?a(t):Ws(i.gltfChunk,(function(t,o){t?a(t):function(t,e,i,n,r){var s=[];if(t.buffers&&0!==t.buffers.length)for(var a=n&&n.buffer&&n.buffer.preprocess,o=n&&n.buffer&&n.buffer.processAsync||function(t,e){e(null,null)},l=n&&n.buffer&&n.buffer.postprocess,h=t.buffers.length,c=function(e,i){s[e]=i,l&&l(t.buffers[e],i),0==--h&&r(null,s)},u=0;u<t.buffers.length;++u){var d=t.buffers[u];a&&a(d),o(d,function(t,n,s,a){if(s)r(s);else if(a)c(t,new Uint8Array(a));else if(n.hasOwnProperty("uri"))if(Ss(n.uri)){for(var o=atob(n.uri.split(",")[1]),l=new Uint8Array(o.length),h=0;h<o.length;h++)l[h]=o.charCodeAt(h);c(t,l)}else F.get(x.join(i,n.uri),{cache:!0,responseType:"arraybuffer",retry:!1},function(t,e,i){e?r(e):c(t,new Uint8Array(i))}.bind(null,t));else c(t,e)}.bind(null,u,d))}else r(null,s)}(o,i.binaryChunk,e,s,(function(t,i){t?a(t):Xs(o,i,s,(function(t,i){t?a(t):function(t,e,i,n,r,s){if(t.hasOwnProperty("images")&&0!==t.images.length&&t.hasOwnProperty("textures")&&0!==t.textures.length)for(var a=r&&r.texture&&r.texture.preprocess,o=r&&r.texture&&r.texture.processAsync||function(t,e,i){i(null,null)},l=r&&r.texture&&r.texture.postprocess,h=[],c=[],u=t.textures.length,d=function(e,i){if(c[i]||(c[i]=[]),c[i].push(e),0==--u){var n=[];c.forEach((function(e,i){e.forEach((function(e,r){var s,a,o,c,u=0===r?h[i]:Os(h[i]);s=u.resource,a=(t.samplers||[])[t.textures[e].sampler],o=function(t){switch(t){case 9728:return 0;case 9729:return 1;case 9984:return 2;case 9985:return 4;case 9986:return 3;case 9987:return 5;default:return 1}},c=function(t){switch(t){case 33071:return 1;case 33648:return 2;case 10497:default:return 0}},s&&(a=a||{magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497},s.minFilter=o(a.minFilter),s.magFilter=o(a.magFilter),s.addressU=c(a.wrapS),s.addressV=c(a.wrapT)),n[e]=u,l&&l(t.textures[r],u)}))})),s(null,n)}},f=0;f<t.textures.length;++f){var p=t.textures[f];a&&a(p),o(p,t.images,function(a,o,l,c){if(l)s(l);else if(null==c&&(c=o.source),h[c])d(a,c);else{var u=t.images[c];Gs(u,a,e,i,n,r,(function(t,e){t?s(t):(h[c]=e,d(a,c))}))}}.bind(null,f,p))}else s(null,[])}(o,i,e,r,s,(function(t,e){t?a(t):Us(n,o,i,e,s,a)}))}))}))}))}))}static parse(t,e,i,n){var r=null;return n=n||{},Hs(t,e,(function(t,e){t?console.error(t):Ws(e.gltfChunk,(function(t,s){t?console.error(t):Xs(s,[e.binaryChunk],n,(function(t,e){t?console.error(t):Us(i,s,e,[],n,(function(t,e){t?console.error(t):r=e}))}))}))})),r}static createModel(t,e){var i,n=function(t,i,n,r,s,a,o){var l=void 0===i.materialIndex?e:s[i.materialIndex],h=new Ee(a,i,l);if(i.morph){var c=new Oe(i.morph);if(i.weights)for(var u=0;u<i.weights.length;u++)c.setWeight(u,i.weights[u]);h.morphInstance=c,t.morphInstances.push(c)}if(o.hasOwnProperty("skin")){var d=o.skin,f=n[d];i.skin=f;var p=r[d];h.skinInstance=p,t.skinInstances.push(p)}t.meshInstances.push(h)},r=new Ne,s=[];for(i=0;i<t.skins.length;i++){var a=new Le(t.skins[i]);a.bones=t.skins[i].bones,s.push(a)}if(1===t.scenes.length)r.graph=t.scenes[0];else for(r.graph=new _i("SceneGroup"),i=0;i<t.scenes.length;i++)r.graph.addChild(t.scenes[i]);for(var o=0;o<t.nodes.length;o++){var l=t.nodes[o];if(l.root===r.graph){var h=t.gltf.nodes[o];if(h.hasOwnProperty("mesh"))for(var c=t.meshes[h.mesh],u=0;u<c.length;u++)n(r,c[u],t.skins,s,t.materials,l,h)}}return r}}class Ys{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i={retry:this.maxRetries>0,maxRetries:this.maxRetries};(t.load.startsWith("blob:")||t.load.startsWith("data:"))&&(".glb"===x.getExtension(t.original).toLowerCase()?i.responseType=B.ResponseType.ARRAY_BUFFER:i.responseType=B.ResponseType.JSON),F.get(t.load,i,(function(i,n){i?e("Error loading animation resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){if(".glb"===x.getExtension(t).toLowerCase()){var i=Zs.parse("filename.glb",e,null);return i?i.animations:null}return this["_parseAnimationV"+e.animation.version](e)}_parseAnimationV3(t){var e=t.animation,i=new is;i.name=e.name,i.duration=e.duration;for(var n=0;n<e.nodes.length;n++){var r=new es,s=e.nodes[n];r._name=s.name;for(var a=0;a<s.keys.length;a++){var o=s.keys[a],l=o.time,h=o.pos,c=o.rot,u=o.scale,d=new H(h[0],h[1],h[2]),f=(new $).setFromEulerAngles(c[0],c[1],c[2]),p=new H(u[0],u[1],u[2]),m=new ts(l,d,f,p);r._keys.push(m)}i.addNode(r)}return i}_parseAnimationV4(t){var e=t.animation,i=new is;i.name=e.name,i.duration=e.duration;for(var n=0;n<e.nodes.length;n++){var r=new es,s=e.nodes[n];r._name=s.name;for(var a=s.defaults.p,o=s.defaults.r,l=s.defaults.s,h=0;h<s.keys.length;h++){var c=s.keys[h],u=c.t,d=a||c.p,f=o||c.r,p=l||c.s,m=new H(d[0],d[1],d[2]),g=(new $).setFromEulerAngles(f[0],f[1],f[2]),v=new H(p[0],p[1],p[2]),_=new ts(u,m,g,v);r._keys.push(_)}i.addNode(r)}return i}}class qs{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i={retry:this.maxRetries>0,maxRetries:this.maxRetries};t.load.startsWith("blob:")&&(i.responseType=B.ResponseType.JSON),F.get(t.load,i,(function(i,n){i?e("Error loading animation clip resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){var i=e.name,n=e.duration,r=e.inputs.map((function(t){return new as(1,t)})),s=e.outputs.map((function(t){return new as(t.components,t.data)})),a=e.curves.map((function(t){return new ss([t.path],t.inputIndex,t.outputIndex,t.interpolation)}));return new os(i,n,r,s,a)}}class Ks{constructor(t){var e;if(this._layers=[],this._parameters={},Array.isArray(t.layers))this._layers=t.layers;else for(var i in t.layers){var n=t.layers[i],r={name:n.name,states:[],transitions:[]};for(e=0;e<n.states.length;e++)r.states.push(t.states[n.states[e]]);for(e=0;e<n.transitions.length;e++){var s=t.transitions[n.transitions[e]];if(s.conditions&&!Array.isArray(s.conditions)){for(var a=Object.keys(s.conditions),o=[],l=0;l<a.length;l++){var h=s.conditions[a[l]];h.parameterName&&o.push(h)}s.conditions=o}Number.isInteger(s.from)&&(s.from=t.states[s.from].name),Number.isInteger(s.to)&&(s.to=t.states[s.to].name),r.transitions.push(s)}this._layers.push(r)}for(var c in t.parameters){var u=t.parameters[c];this._parameters[u.name]={type:u.type,value:u.value}}}get parameters(){return Object.assign({},this._parameters)}get layers(){return this._layers}}class Js{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i={retry:this.maxRetries>0,maxRetries:this.maxRetries};t.load.startsWith("blob:")&&(i.responseType=B.ResponseType.JSON),F.get(t.load,i,(function(i,n){i?e("Error loading animation state graph resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){return new Ks(e)}}class Qs{constructor(t){t instanceof Audio?this.audio=t:this.buffer=t}get duration(){let t=0;return this.buffer?t=this.buffer.duration:this.audio&&(t=this.audio.duration),t||0}}var $s=function(){if("undefined"==typeof window)return!1;var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}return!1}();const ta={".ogg":"audio/ogg",".mp3":"audio/mpeg",".wav":"audio/x-wav",".mp4a":"audio/mp4",".m4a":"audio/mp4",".mp4":"audio/mp4",".aac":"audio/aac"};class ea{constructor(t){this.manager=t,this.maxRetries=0}_isSupported(t){var e=x.getExtension(t);return!!ta[e]}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i=function(i){var n="Error loading audio url: "+t.original;i&&(n+=": "+(i.message||i)),console.warn(n),e(n)};if(this._createSound){if(!this._isSupported(t.original))return void i("Audio format for "+t.original+" not supported");this._createSound(t.load,(function(t){e(null,new Qs(t))}),i)}else i(null)}open(t,e){return e}_createSound(t,e,i){if(qr()){var n=this.manager;if(!n.context)return void i("Audio manager has no audio context");var r={retry:this.maxRetries>0,maxRetries:this.maxRetries};(t.startsWith("blob:")||t.startsWith("data:"))&&(r.responseType=B.ResponseType.ARRAY_BUFFER),F.get(t,r,(function(t,r){t?i(t):n.context.decodeAudioData(r,e,i)}))}else if(Yr()){var s=null;try{s=new Audio}catch(t){return void i("No support for Audio element")}$s&&document.body.appendChild(s);s.onerror=function(){s.onerror=null,$s&&document.body.removeChild(s),i()},s.addEventListener("canplaythrough",(function t(){s.removeEventListener("canplaythrough",t),$s&&document.body.removeChild(s),e(s)})),s.src=t}}}class ia{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t}),F.get(t.load,{responseType:B.ResponseType.ARRAY_BUFFER,retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(i,n){i?e("Error loading binary resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){return e}patch(t,e){}}class na{constructor(t){this._blobUrls={};for(var e=0,i=t.length;e<i;e++)t[e].url&&(this._blobUrls[t[e].name]=t[e].url)}hasBlobUrl(t){return!!this._blobUrls[t]}getBlobUrl(t){return this._blobUrls[t]}destroy(){for(var t in this._blobUrls)URL.revokeObjectURL(this._blobUrls[t]);this._blobUrls=null}}var ra;function sa(t){var e,i;function n(t){this._fields=t}function r(t){this._arrayBuffer=t||new ArrayBuffer(0),this._bufferView=new DataView(this._arrayBuffer),this._globalPaxHeader=null,this._paxHeader=null,this._bytesRead=0}"undefined"!=typeof TextDecoder?(e=new TextDecoder("utf-8"),i=new TextDecoder("windows-1252")):console.warn("TextDecoder not supported - pc.Untar module will not work"),n.parse=function(t,i,r){for(var s=new Uint8Array(t,i,r),a=0,o=[];a<r;){var l;for(l=a;l<r&&32!=s[l];l++);if(l>=r)throw new Error("Invalid PAX header data format.");var h=parseInt(e.decode(new Uint8Array(t,i+a,l-a)),10),c=e.decode(new Uint8Array(t,i+l+1,h-(l-a)-2)).split("=");if(2!==c.length)throw new Error("Invalid PAX header data format.");0===c[1].length&&(c[1]=null),o.push({name:c[0],value:c[1]}),a+=h}return new n(o)},n.prototype.applyHeader=function(t){for(var e=0;e<this._fields.length;e++){var i=this._fields[e].name,n=this._fields[e].value;"path"===i&&(i="name"),null===n?delete t[i]:t[i]=n}},t||(ra=r),r.prototype._hasNext=function(){return this._bytesRead+4<this._arrayBuffer.byteLength&&0!==this._bufferView.getUint32(this._bytesRead)},r.prototype._readNextFile=function(){var e=new DataView(this._arrayBuffer,this._bytesRead,512),r=i.decode(e);this._bytesRead+=512;var s=r.substr(0,100).replace(/\0/g,""),a=r.substr(257,6),o=parseInt(r.substr(124,12),8),l=r.substr(156,1),h=this._bytesRead,c=null,u=!1;switch(l){case"0":case"":if(u=!0,!t){var d=new Blob([this._arrayBuffer.slice(this._bytesRead,this._bytesRead+o)]);c=URL.createObjectURL(d)}break;case"g":this._globalPaxHeader=n.parse(this._arrayBuffer,this._bytesRead,o);break;case"x":this._paxHeader=n.parse(this._arrayBuffer,this._bytesRead,o)}this._bytesRead+=o;var f=o%512;if(0!==f&&(this._bytesRead+=512-f),!u)return null;if(-1!==a.indexOf("ustar")){var p=r.substr(345,155).replace(/\0/g,"");p.length>0&&(s=p.trim()+s.trim())}var m={name:s,start:h,size:o,url:c};return this._globalPaxHeader&&this._globalPaxHeader.applyHeader(m),this._paxHeader&&(this._paxHeader.applyHeader(m),this._paxHeader=null),m},r.prototype.untar=function(t){if(!e)return console.error("Cannot untar because TextDecoder interface is not available for this platform."),[];for(var i=[];this._hasNext();){var n=this._readNextFile();n&&(t&&n.name&&(n.name=t+n.name),i.push(n))}return i},t&&(self.onmessage=function(t){var e=t.data.id;try{var i=new r(t.data.arrayBuffer).untar(t.data.prefix);postMessage({id:e,files:i,arrayBuffer:t.data.arrayBuffer},[t.data.arrayBuffer])}catch(t){postMessage({id:e,error:t.toString()})}})}var aa=null;class oa{constructor(t){this._requestId=0,this._pendingRequests={},this._filenamePrefix=t,this._worker=new Worker(function(){if(!aa){var t="("+sa.toString()+")(true)\n\n",e=new Blob([t],{type:"application/javascript"});aa=URL.createObjectURL(e)}return aa}()),this._worker.addEventListener("message",this._onMessage.bind(this))}_onMessage(t){var e=t.data.id;if(this._pendingRequests[e]){var i=this._pendingRequests[e];if(delete this._pendingRequests[e],t.data.error)i(t.data.error);else{for(var n=t.data.arrayBuffer,r=0,s=t.data.files.length;r<s;r++){var a=t.data.files[r],o=new Blob([n.slice(a.start,a.start+a.size)]);a.url=URL.createObjectURL(o)}i(null,t.data.files)}}}untar(t,e){var i=this._requestId++;this._pendingRequests[i]=e,this._worker.postMessage({id:i,prefix:this._filenamePrefix,arrayBuffer:t},[t])}hasPendingRequests(){for(var t in this._pendingRequests)return!0;return!1}destroy(){this._worker&&(this._worker.terminate(),this._worker=null,this._pendingRequests=null)}}sa();class la{constructor(t){this._assets=t,this._worker=null,this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i=this;F.get(t.load,{responseType:B.ResponseType.ARRAY_BUFFER,retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(n,r){if(n)e("Error loading bundle resource "+t.original+": "+n);else try{i._untar(r,e)}catch(i){e("Error loading bundle resource "+t.original+": "+i)}}))}_untar(t,e){var i=this;if(w.workers)i._worker||(i._worker=new oa(i._assets.prefix)),i._worker.untar(t,(function(t,n){e(t,n),i._worker.hasPendingRequests()||(i._worker.destroy(),i._worker=null)}));else{var n=new ra(t).untar(i._assets.prefix);e(null,n)}}open(t,e){return new na(e)}patch(t,e){}}class ha extends _i{constructor(t,e){if(super(t),t instanceof qd&&(e=t),this._batchHandle=null,this.c={},this._app=e,!e&&(this._app=qd.getApplication(),!this._app))throw new Error("Couldn't find current application");this._guid=null,this._destroying=!1,this._template=!1}addComponent(t,e){var i=this._app.systems[t];return i?this.c[t]?null:i.addComponent(this,e):null}removeComponent(t){var e=this._app.systems[t];e&&this.c[t]&&e.removeComponent(this)}findComponent(t){var e=this.findOne((function(e){return e.c&&e.c[t]}));return e&&e.c[t]}findComponents(t){return this.find((function(e){return e.c&&e.c[t]})).map((function(e){return e.c[t]}))}getGuid(){return this._guid||this.setGuid(b()),this._guid}setGuid(t){var e=this._app._entityIndex;this._guid&&delete e[this._guid],this._guid=t,e[this._guid]=this}_notifyHierarchyStateChanged(t,e){var i,n,r=!1;t===this&&0===this._app._enableList.length&&(r=!0),t._beingEnabled=!0,t._onHierarchyStateChanged(e),t._onHierarchyStatePostChanged&&this._app._enableList.push(t);var s=t._children;for(i=0,n=s.length;i<n;i++)s[i]._enabled&&this._notifyHierarchyStateChanged(s[i],e);if(t._beingEnabled=!1,r){for(i=0;i<this._app._enableList.length;i++)this._app._enableList[i]._onHierarchyStatePostChanged();this._app._enableList.length=0}}_onHierarchyStateChanged(t){var e;super._onHierarchyStateChanged(t);var i=this.c;for(var n in i)i.hasOwnProperty(n)&&(e=i[n]).enabled&&(t?e.onEnable():e.onDisable())}_onHierarchyStatePostChanged(){var t=this.c;for(var e in t)t.hasOwnProperty(e)&&t[e].onPostStateChange()}findByGuid(t){if(this._guid===t)return this;var e=this._app._entityIndex[t];return e&&(e===this||e.isDescendantOf(this))?e:null}destroy(){var t;for(t in this._destroying=!0,this.c)this.c[t].enabled=!1;for(t in this.c)this.c[t].system.removeComponent(this);this._parent&&this._parent.removeChild(this);for(var e=this._children,i=e.shift();i;)i instanceof ha&&i.destroy(),i._parent=null,i=e.shift();this.fire("destroy",this),this.off(),this._guid&&delete this._app._entityIndex[this._guid],this._destroying=!1}clone(){var t={},e=this._cloneRecursively(t);return t[this.getGuid()]=e,function t(e,i,n,r){var s,a;if(i instanceof ha){var o=i.c;for(var l in o){var h=o[l],c=h.system.getPropertiesOfType("entity");for(s=0,a=c.length;s<a;s++){var u=c[s].name,d=h[u];if(!!e.findByGuid(d)){var f=r[d].getGuid();f?n.c[l][u]=f:console.warn("Could not find corresponding entity id when resolving duplicated entity references")}}}o.script&&!n._app.useLegacyScriptAttributeCloning&&n.script.resolveDuplicatedEntityReferenceProperties(o.script,r);var p=i.children.filter((function(t){return t instanceof ha})),m=n.children.filter((function(t){return t instanceof ha}));for(s=0,a=p.length;s<a;s++)t(e,p[s],m[s],r)}}(this,this,e,t),e}_cloneRecursively(t){var e,i=new ha(this._app);for(var n in super._cloneInternal(i),this.c){this.c[n].system.cloneComponent(this,i)}for(e=0;e<this._children.length;e++){var r=this._children[e];if(r instanceof ha){var s=r._cloneRecursively(t);i.addChild(s),t[r.getGuid()]=s}}return i}}class ca{constructor(t){this.data=t,this.model=null,this.renders=[],this.materials=[],this.textures=[],this.animations=[],this.registry=null}instantiateModelEntity(t){var e=new pc.Entity;return e.addComponent("model",Object.assign({type:"asset",asset:this.model},t)),e}instantiateRenderEntity(t){for(var e=[],i=function e(i,n,r){if(r){var s=new ha;r._cloneInternal(s);for(var a=null,o=0;o<n.meshInstances.length;o++){var l=n.meshInstances[o];if(l.node===r){var h=new Ee(s,l.mesh,l.material);l.morphInstance&&(h.morphInstance=l.morphInstance.clone()),l.skinInstance&&i.push({src:l.skinInstance,dst:h}),a||(a=[]),a.push(h)}}a&&(s.addComponent("render",Object.assign({type:"asset"},t)),s.render.meshInstances=a);for(var c=r.children,u=0;u<c.length;u++){var d=e(i,n,c[u]);s.addChild(d)}return s}return null}(e,this.model.resource,this.model.resource.graph),n=0;n<e.length;n++){for(var r=e[n].src,s=e[n].dst,a=r.skin,o=new Le(a),l=[],h=0;h<a.boneNames.length;h++){var c=a.boneNames[h],u=i.findByName(c);l.push(u)}o.bones=l,s.skinInstance=o}return i}destroy(){var t=this.registry,e=function(e){t.remove(e),e.unload()},i=function(t){t.forEach((function(t){e(t)}))};this.animations&&(i(this.animations),this.animations=null),this.textures&&(i(this.textures),this.textures=null),this.materials&&(i(this.materials),this.materials=null),this.model&&(e(this.model),this.model=null),this.data=null,this.assets=null}}class ua{constructor(t,e){this._device=t,this._defaultMaterial=e,this.maxRetries=0}_getUrlWithoutParams(t){return t.indexOf("?")>=0?t.split("?")[0]:t}load(t,e,i){"string"==typeof t&&(t={load:t,original:t});var n={responseType:B.ResponseType.ARRAY_BUFFER,retry:this.maxRetries>0,maxRetries:this.maxRetries},r=this,s=function(n){Zs.parseAsync(r._getUrlWithoutParams(t.original),x.extractPath(t.load),n,r._device,i.registry,i.options,(function(t,i){t?e(t):e(null,new ca(i))}))};i&&i.file&&i.file.contents?s(i.file.contents):F.get(t.load,n,(function(i,n){e&&(i?e("Error loading model: "+t.original+" ["+i+"]"):s(n))}))}open(t,e,i){return e}patch(t,e){var i=t.resource,n=i&&i.data;if(n){var r,s=function(i,n,r){var s=new As(t.name+"/"+i+"/"+r,i,{url:""});return s.resource=n,s.loaded=!0,e.add(s),s},a=s("model",Zs.createModel(n,this._defaultMaterial),0),o=[];for(r=0;r<n.meshes.length;++r)o.push(s("render",n.meshes[r],r));var l=[];for(r=0;r<n.materials.length;++r)l.push(s("material",n.materials[r],r));var h=[];for(r=0;r<n.animations.length;++r)h.push(s("animation",n.animations[r],r));i.data=null,i.model=a,i.renders=o,i.materials=l,i.textures=n.textures,i.animations=h,i.registry=e}}}class da{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t}),F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(i,n){i?e("Error loading css resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){return e}patch(t,e){}}class fa{constructor(t,e,i){this._device=t,this._registry=e,this._loader=i}load(t,e,i){this.loadAssets(i,e)}open(t,e,i){return i?i.resource:null}patch(t,e){this.loadAssets(t,(function(i,n){i&&(e.fire("error",t),e.fire("error:"+t.id,i,t),t.fire("error",t))}))}getAssetIds(t){var e=[];if(e[0]=t.file,(t.loadFaces||!t.file)&&t.data&&t.data.textures)for(var i=0;i<6;++i)e[i+1]=t.data.textures[i];else e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=null;return e}compareAssetIds(t,e){return t&&e?parseInt(t,10)===t||"string"==typeof t?t===e:t.url===e.url:null!==t==(null!==e)}update(t,e,i){var n,r,s,a=t.data||{},o=t._handlerState.assets,l=t._resources,h=[null,null,null,null,null,null,null],c=function(){return a.hasOwnProperty("type")?a.type:a.hasOwnProperty("rgbm")?a.rgbm?"rgbm":"default":null};if(t.loaded&&i[0]===o[0])h[1]=l[1]||null,h[2]=l[2]||null,h[3]=l[3]||null,h[4]=l[4]||null,h[5]=l[5]||null,h[6]=l[6]||null;else if(i[0])for(n=i[0].resource,s=0;s<6;++s){var u=[n._levels[s]];if(0===s&&this._device.useTexCubeLod)for(r=1;r<n._levels.length;++r)u[r]=n._levels[r];var d=new pe(this._device,{name:t.name+"_prelitCubemap"+(n.width>>s),cubemap:!0,type:c()||n.type,width:n.width>>s,height:n.height>>s,format:n.format,levels:u,fixCubemapSeams:!0,addressU:1,addressV:1});h[s+1]=d}var f=i.slice(1);if(t.loaded&&this.cmpArrays(f,o.slice(1)))h[0]=l[0]||null;else if(-1===f.indexOf(null)){var p=f.map((function(t){return t.resource})),m=[];for(r=0;r<p[0]._levels.length;++r)m.push(p.map((function(t){return t._levels[r]})));var g=new pe(this._device,{name:t.name+"_faces",cubemap:!0,type:c()||p[0].type,width:p[0].width,height:p[0].height,format:p[0].format,levels:m,minFilter:a.hasOwnProperty("minFilter")?a.minFilter:p[0].minFilter,magFilter:a.hasOwnProperty("magFilter")?a.magFilter:p[0].magFilter,anisotropy:a.hasOwnProperty("anisotropy")?a.anisotropy:1,addressU:1,addressV:1,fixCubemapSeams:!!i[0]});h[0]=g}if(!this.cmpArrays(h,l))for(t.resources=h,t._handlerState.assetIds=e,t._handlerState.assets=i,s=0;s<l.length;++s)null!==l[s]&&-1===h.indexOf(l[s])&&l[s].destroy();for(s=0;s<o.length;++s)null!==o[s]&&-1===i.indexOf(o[s])&&o[s].unload()}cmpArrays(t,e){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}resolveId(t){var e=parseInt(t,10);return e===t||e.toString()===t?e:t}loadAssets(t,e){t.hasOwnProperty("_handlerState")||(t._handlerState={assetIds:[null,null,null,null,null,null,null],assets:[null,null,null,null,null,null,null]});for(var i,n=this,r=n.getAssetIds(t),s=[null,null,null,null,null,null,null],a=t._handlerState.assetIds,o=t._handlerState.assets,l=n._registry,h=7,c=function(i,a){s[i]=a,0===--h&&(n.update(t,r,s),e(null,t.resources))},u=function(t,i){var n=i&&i.resource&&i.resource._levels[0];n&&"undefined"!=typeof ImageBitmap&&n instanceof ImageBitmap?createImageBitmap(n,{premultiplyAlpha:"none",imageOrientation:"flipY"}).then((function(e){i.resource._levels[0]=e,c(t,i)})).catch((function(t){e(t)})):c(t,i)},d=function(t,i,n){e(i)},f=function(t,e){e.loaded?u(t,e):(l.once("load:"+e.id,u.bind(n,t)),l.once("error:"+e.id,d.bind(n,t)),e.loading||l.load(e))},p=0;p<7;++p){var m=this.resolveId(r[p]);if(m)if(n.compareAssetIds(m,a[p]))c(p,o[p]);else if(parseInt(m,10)===m)(i=l.get(m))?f(p,i):setTimeout(function(t,e){var i=l.get(e);i?f(t,i):d(0,"failed to find dependent cubemap asset="+e)}.bind(null,p,m));else{var g="string"==typeof m?{url:m,filename:m}:m;i=new As(t.name+"_part_"+p,"texture",g),l.add(i),l.once("load:"+i.id,u.bind(n,p)),l.once("error:"+i.id,d.bind(n,p)),l.load(i)}else c(p,null)}}}class pa{constructor(){}load(t,e){e(null,null)}open(t,e){return e}}class ma{constructor(t,e){this.type=e&&e.type||"msdf",this.em=1,this.textures=t,this.intensity=0,this._data=null,this.data=e}get data(){return this._data}set data(t){if(this._data=t,t&&(void 0!==this._data.intensity&&(this.intensity=this._data.intensity),this._data.info||(this._data.info={}),(!this._data.version||this._data.version<2)&&(this._data.info.maps=[{width:this._data.info.width,height:this._data.info.height}],this._data.chars)))for(var e in this._data.chars)this._data.chars[e].map=0}}function ga(t){return t.version<3&&(t.version<2&&(t.info.maps=t.info.maps||[{width:t.info.width,height:t.info.height}]),t.chars=Object.keys(t.chars||{}).reduce((function(e,i){var n=t.chars[i],r=void 0!==n.letter?n.letter:E.fromCodePoint(i);return t.version<2&&(n.map=n.map||0),e[r]=n,e}),{}),t.version=3),t}class va{constructor(t){this._loader=t,this.maxRetries=0}load(t,e,i){"string"==typeof t&&(t={load:t,original:t});var n=this;".json"===x.getExtension(t.original)?F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(i,r){if(i)e("Error loading font resource: "+t.original+" ["+i+"]");else{var s=ga(r);n._loadTextures(t.load.replace(".json",".png"),s,(function(t,i){if(t)return e(t);e(null,{data:s,textures:i})}))}})):(i&&i.data&&(i.data=ga(i.data)),this._loadTextures(t.load,i&&i.data,e))}_loadTextures(t,e,i){for(var n=e.info.maps.length,r=0,s=null,a=new Array(n),o=this._loader,l=function(e){var l=function(t,o){if(!s){if(t)return s=t,i(t);o.upload(),a[e]=o,++r===n&&i(null,a)}};0===e?o.load(t,"texture",l):o.load(t.replace(".png",e+".png"),"texture",l)},h=0;h<n;h++)l(h)}open(t,e,i){return e.textures?new ma(e.textures,e.data):new ma(e,null)}patch(t,e){var i=t.resource;!i.data&&t.data?i.data=t.data:!t.data&&i.data&&(t.data=i.data),t.data&&(t.data=ga(t.data))}}class _a extends v{constructor(t,e){if(super(),this._assets=[],this._registry=e,this._loaded=!1,this._count=0,this._total=0,this._failed=[],this._waitingAssets=[],t.length&&t[0]instanceof As)this._assets=t;else for(var i=0;i<t.length;i++){var n=e.get(t[i]);n?this._assets.push(n):(this._waitForAsset(t[i]),this._total++)}}destroy(){var t=this;this._registry.off("load",this._onLoad),this._registry.off("error",this._onError),this._waitingAssets.forEach((function(e){t._registry.off("add:"+e,this._onAddAsset)})),this.off("progress"),this.off("load")}load(t,e){var i,n=0,r=this._assets.length;for(this._count=0,this._failed=[],this._callback=t,this._scope=e,this._registry.on("load",this._onLoad,this),this._registry.on("error",this._onError,this),n=0;n<r;n++)(i=this._assets[n]).loading||i.loaded||(this._registry.load(i),this._total++)}ready(t,e){e=e||this,this._loaded?t.call(e,this._assets):this.once("load",(function(i){t.call(e,i)}))}_loadingComplete(){this._loaded=!0,this._registry.off("load",this._onLoad,this),this._registry.off("error",this._onError,this),this._failed&&this._failed.length?(this._callback&&this._callback.call(this._scope,"Failed to load some assets",this._failed),this.fire("error",this._failed)):(this._callback&&this._callback.call(this._scope),this.fire("load",this._assets))}_onLoad(t){var e=this;this._assets.indexOf(t)>=0&&(this._count++,this.fire("progress",t)),this._count===this._total&&setTimeout((function(){e._loadingComplete(e._failed)}),0)}_onError(t,e){var i=this;this._assets.indexOf(e)>=0&&(this._count++,this._failed.push(e)),this._count===this._total&&setTimeout((function(){i._loadingComplete(i._failed)}),0)}_onAddAsset(t){var e,i=this._waitingAssets.indexOf(t);i>=0&&this._waitingAssets.splice(i,1),this._assets.push(t);var n=this._assets.length;for(e=0;e<n;e++)(t=this._assets[e]).loading||t.loaded||this._registry.load(t)}_waitForAsset(t){this._waitingAssets.push(t),this._registry.once("add:"+t,this._onAddAsset,this)}}var ya={waitForTemplatesInScene:function(t,e,i){if(t.collapsedInstances){var n=ya._getAllCollapsedEntities(t);ya.waitForTemplateAssets(n,e,i,t)}else i(null,t)},waitForTemplateAssets:function(t,e,i,n){var r=ya._extractTemplateIds(t);new _a(r,e).load((function(t){i(t,n)}))},_getAllCollapsedEntities:function(t){var e={};return t.collapsedInstances.forEach((function(t){Object.assign(e,t.instanceEntities)})),e},_extractTemplateIds:function(t){var e=[];for(var i in t){var n=t[i].template_id;n&&e.push(n)}return e},expandTemplateEntities:function(t,e){var i={};for(var n in e){var r=e[n];i[n]=r.collapsed_entity?ya.expandEntity(t,r):r}return i},expandEntity:function(t,e){}},ba=function(t,e,i){var n,r,s=i.singleVecs,a=e.___1;a||(n=i.tripleVecs,r=e.___2);var o=a?a[0]:n[r];t.setLocalPosition(s[o],s[o+1],s[o+2]),o=a?a[1]:n[r+1],t.setLocalEulerAngles(s[o],s[o+1],s[o+2]),o=a?a[2]:n[r+2],t.setLocalScale(s[o],s[o+1],s[o+2])},xa=function(t,e){var i=t.charCodeAt(0)-e.fieldFirstCode;return e.fieldArray[i]},wa=function(t,e){for(var i=0,n=0;n<t.length;n++)i=i*e.fieldCodeBase+t.charCodeAt(n)-e.fieldFirstCode;return e.fieldArray[i]};class Aa{constructor(t,e){this._node=t,this._data=e}run(){var t=Object.prototype.toString.call(this._node);return"[object Object]"===t?this._handleMap():"[object Array]"===t?this._handleArray():this._result=this._node,this._result}_handleMap(){this._result={},Object.keys(this._node).forEach(this._handleKey,this)}_handleKey(t){var e=t,i=t.length;1===i?e=xa(t,this._data):2===i&&(e=wa(t,this._data)),this._result[e]=new Aa(this._node[t],this._data).run()}_handleArray(){this._result=[],this._node.forEach(this._handleArElt,this)}_handleArElt(t){var e=new Aa(t,this._data).run();this._result.push(e)}}class Ca{constructor(t,e){this._app=t,this._isTemplate=e}parse(t){var e,i,n,r={},s=null,a=t.compressedFormat;for(e in a&&(t.entities=new Aa(t.entities,a).run()),t.collapsedInstances&&this._addCollapsedToEntities(this._app,t),t.entities){var o=t.entities[e];n=this._createEntity(o,a),r[e]=n,null===o.parent&&(s=n)}for(e in t.entities){n=r[e];var l=t.entities[e].children,h=l.length;for(i=0;i<h;i++){var c=r[l[i]];c&&n.addChild(c)}}return this._openComponentData(s,t.entities),delete t.compressedFormat,s}_createEntity(t,e){var i=new ha;if(i.name=t.name,i.setGuid(t.resource_id),this._setPosRotScale(i,t,e),i._enabled=void 0===t.enabled||t.enabled,this._isTemplate?i._template=!0:i._enabledInHierarchy=i._enabled,i.template=t.template,t.tags)for(var n=0;n<t.tags.length;n++)i.tags.add(t.tags[n]);return t.labels&&t.labels.forEach((function(t){i.addLabel(t)})),i}_setPosRotScale(t,e,i){if(i)ba(t,e,i);else{var n=e.position,r=e.rotation,s=e.scale;t.setLocalPosition(n[0],n[1],n[2]),t.setLocalEulerAngles(r[0],r[1],r[2]),t.setLocalScale(s[0],s[1],s[2])}}_openComponentData(t,e){var i,n=this._app.systems.list,r=n.length,s=e[t.getGuid()];for(i=0;i<r;i++){var a=n[i],o=s.components[a.id];o&&a.addComponent(t,o)}r=s.children.length;var l=t._children;for(i=0;i<r;i++)l[i]=this._openComponentData(l[i],e);return t}_addCollapsedToEntities(t,e){e.collapsedInstances.forEach((function(i){var n=ya.expandTemplateEntities(t,i.instanceEntities);Object.assign(e.entities,n)}))}}class Ia{constructor(t){this._app=t,this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i=this._app.assets;F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(n,r){if(n){var s="Error while loading scene "+t.original;n.message?(s+=": "+n.message,n.stack&&(s+="\n"+n.stack)):s+=": "+n,e(s)}else ya.waitForTemplatesInScene(r,i,e)}))}open(t,e){this._app.systems.script.preloading=!0;var i=new Ca(this._app,!1).parse(e);return this._app.systems.script.preloading=!1,i}}class Sa{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t}),F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(i,n){i?e("Error loading html resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){return e}patch(t,e){}}class Ma{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i={retry:this.maxRetries>0,maxRetries:this.maxRetries};t.load.startsWith("blob:")&&(i.responseType=B.ResponseType.JSON),F.get(t.load,i,(function(i,n){i?e("Error loading JSON resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){return e}patch(t,e){}}var Ta,Pa={name:"string",chunks:"chunks",mappingFormat:"string",_engine:"boolean",ambient:"rgb",ambientTint:"boolean",aoVertexColor:"boolean",aoVertexColorChannel:"string",aoMap:"texture",aoMapChannel:"string",aoMapUv:"number",aoMapTiling:"vec2",aoMapOffset:"vec2",diffuse:"rgb",diffuseTint:"boolean",diffuseVertexColor:"boolean",diffuseVertexColorChannel:"string",diffuseMap:"texture",diffuseMapChannel:"string",diffuseMapUv:"number",diffuseMapTiling:"vec2",diffuseMapOffset:"vec2",diffuseDetailMap:"texture",diffuseDetailMapChannel:"string",diffuseDetailMapUv:"number",diffuseDetailMapTiling:"vec2",diffuseDetailMapOffset:"vec2",diffuseDetailMode:"string",specular:"rgb",specularTint:"boolean",specularVertexColor:"boolean",specularVertexColorChannel:"string",specularMap:"texture",specularMapChannel:"string",specularMapUv:"number",specularMapTiling:"vec2",specularMapOffset:"vec2",specularAntialias:"boolean",occludeSpecular:"enum:occludeSpecular",useMetalness:"boolean",metalness:"number",enableGGXSpecular:"boolean",anisotropy:"number",metalnessTint:"boolean",metalnessVertexColor:"boolean",metalnessVertexColorChannel:"string",metalnessMap:"texture",metalnessMapChannel:"string",metalnessMapUv:"number",metalnessMapTiling:"vec2",metalnessMapOffset:"vec2",conserveEnergy:"boolean",shininess:"number",glossVertexColor:"boolean",glossVertexColorChannel:"string",glossMap:"texture",glossMapChannel:"string",glossMapUv:"number",glossMapTiling:"vec2",glossMapOffset:"vec2",clearCoat:"number",clearCoatVertexColor:"boolean",clearCoatVertexColorChannel:"string",clearCoatMap:"texture",clearCoatMapChannel:"string",clearCoatMapUv:"number",clearCoatMapTiling:"vec2",clearCoatMapOffset:"vec2",clearCoatGlossiness:"number",clearCoatGlossVertexColor:"boolean",clearCoatGlossVertexColorChannel:"string",clearCoatGlossMap:"texture",clearCoatGlossMapChannel:"string",clearCoatGlossMapUv:"number",clearCoatGlossMapTiling:"vec2",clearCoatGlossMapOffset:"vec2",clearCoatBumpiness:"number",clearCoatNormalMap:"texture",clearCoatNormalMapUv:"number",clearCoatNormalMapTiling:"vec2",clearCoatNormalMapOffset:"vec2",fresnelModel:"number",emissive:"rgb",emissiveTint:"boolean",emissiveVertexColor:"boolean",emissiveVertexColorChannel:"string",emissiveMap:"texture",emissiveMapChannel:"string",emissiveMapUv:"number",emissiveMapTiling:"vec2",emissiveMapOffset:"vec2",emissiveIntensity:"number",normalMap:"texture",normalMapTiling:"vec2",normalMapOffset:"vec2",normalMapUv:"number",bumpiness:"number",normalDetailMap:"texture",normalDetailMapTiling:"vec2",normalDetailMapOffset:"vec2",normalDetailMapUv:"number",normalDetailMapBumpiness:"number",heightMap:"texture",heightMapChannel:"string",heightMapUv:"number",heightMapTiling:"vec2",heightMapOffset:"vec2",heightMapFactor:"number",alphaToCoverage:"boolean",alphaTest:"number",alphaFade:"number",opacity:"number",opacityVertexColor:"boolean",opacityVertexColorChannel:"string",opacityMap:"texture",opacityMapChannel:"string",opacityMapUv:"number",opacityMapTiling:"vec2",opacityMapOffset:"vec2",opacityFadesSpecular:"boolean",reflectivity:"number",refraction:"number",refractionIndex:"number",sphereMap:"texture",cubeMap:"cubemap",cubeMapProjection:"number",cubeMapProjectionBox:"boundingbox",lightVertexColor:"boolean",lightVertexColorChannel:"string",lightMap:"texture",lightMapChannel:"string",lightMapUv:"number",lightMapTiling:"vec2",lightMapOffset:"vec2",depthTest:"boolean",depthWrite:"boolean",depthBias:"number",slopeDepthBias:"number",cull:"enum:cull",blendType:"enum:blendType",shadingModel:"enum:shadingModel",useFog:"boolean",useLighting:"boolean",useSkybox:"boolean",useGammaTonemap:"boolean",prefilteredCubeMap128:"texture",prefilteredCubeMap64:"texture",prefilteredCubeMap32:"texture",prefilteredCubeMap16:"texture",prefilteredCubeMap8:"texture",prefilteredCubeMap4:"texture"},Ea=[];for(Ta in Pa)"texture"===Pa[Ta]&&Ea.push(Ta);var ka=[];for(Ta in Pa)"cubemap"===Pa[Ta]&&ka.push(Ta);class Da{constructor(t,e,i,n,r){this.propertyName=t,this.parent=e,this._scope=r,this._registry=i,this.id=null,this.url=null,this.asset=null,this._onAssetLoad=n.load,this._onAssetAdd=n.add,this._onAssetRemove=n.remove,this._onAssetUnload=n.unload}_bind(){this.id&&(this._onAssetLoad&&this._registry.on("load:"+this.id,this._onLoad,this),this._onAssetAdd&&this._registry.once("add:"+this.id,this._onAdd,this),this._onAssetRemove&&this._registry.on("remove:"+this.id,this._onRemove,this),this._onAssetUnload&&this._registry.on("unload:"+this.id,this._onUnload,this)),this.url&&(this._onAssetLoad&&this._registry.on("load:url:"+this.url,this._onLoad,this),this._onAssetAdd&&this._registry.once("add:url:"+this.url,this._onAdd,this),this._onAssetRemove&&this._registry.on("remove:url:"+this.url,this._onRemove,this))}_unbind(){this.id&&(this._onAssetLoad&&this._registry.off("load:"+this.id,this._onLoad,this),this._onAssetAdd&&this._registry.off("add:"+this.id,this._onAdd,this),this._onAssetRemove&&this._registry.off("remove:"+this.id,this._onRemove,this),this._onAssetUnload&&this._registry.off("unload:"+this.id,this._onUnload,this)),this.url&&(this._onAssetLoad&&this._registry.off("load:"+this.url,this._onLoad,this),this._onAssetAdd&&this._registry.off("add:"+this.url,this._onAdd,this),this._onAssetRemove&&this._registry.off("remove:"+this.url,this._onRemove,this))}_onLoad(t){this._onAssetLoad.call(this._scope,this.propertyName,this.parent,t)}_onAdd(t){this.asset=t,this._onAssetAdd.call(this._scope,this.propertyName,this.parent,t)}_onRemove(t){this._onAssetRemove.call(this._scope,this.propertyName,this.parent,t),this.asset=null}_onUnload(t){this._onAssetUnload.call(this._scope,this.propertyName,this.parent,t)}get id(){return this._id}set id(t){if(this.url)throw Error("Can't set id and url");this._unbind(),this._id=t,this.asset=this._registry.get(this._id),this._bind()}get url(){return this._url}set url(t){if(this.id)throw Error("Can't set id and url");this._unbind(),this._url=t,this.asset=this._registry.getByUrl(this._url),this._bind()}}function Oa(){this.removeInvalid=!0,this.valid=!0,this.enumValidators={occludeSpecular:this._createEnumValidator([0,1,2]),cull:this._createEnumValidator([0,1,2,3]),blendType:this._createEnumValidator([0,1,2,3,4,5,6,7,8,9,10]),shadingModel:this._createEnumValidator([0,1])}}Oa.prototype.setInvalid=function(t,e){this.valid=!1,this.removeInvalid&&delete e[t]},Oa.prototype.validate=function(t){var e,i,n=Pa,r="path"===t.mappingFormat;for(var s in t)if(e=n[s])if(e.startsWith("enum")){var a=e.split(":")[1];this.enumValidators[a]&&(this.enumValidators[a](t[s])||this.setInvalid(s,t))}else if("number"===e)"number"!=typeof t[s]&&this.setInvalid(s,t);else if("boolean"===e)"boolean"!=typeof t[s]&&this.setInvalid(s,t);else if("string"===e)"string"!=typeof t[s]&&this.setInvalid(s,t);else if("vec2"===e)t[s]instanceof Array&&2===t[s].length||this.setInvalid(s,t);else if("rgb"===e)t[s]instanceof Array&&3===t[s].length||this.setInvalid(s,t);else if("texture"===e)r?"string"==typeof t[s]||t[null===s]||t[s]instanceof pe||this.setInvalid(s,t):"number"!=typeof t[s]&&null!==t[s]&&(t[s]instanceof pe||this.setInvalid(s,t));else if("boundingbox"===e)t[s].center&&t[s].center instanceof Array&&3===t[s].center.length||this.setInvalid(s,t),t[s].halfExtents&&t[s].halfExtents instanceof Array&&3===t[s].halfExtents.length||this.setInvalid(s,t);else if("cubemap"===e)"number"!=typeof t[s]&&null!==t[s]&&void 0!==t[s]&&(t[s]instanceof pe&&t[s].cubemap||this.setInvalid(s,t));else if("chunks"===e){var o=Object.keys(t[s]);for(i=0;i<o.length;i++)"string"!=typeof t[s][o[i]]&&this.setInvalid(o[i],t[s])}else console.error("Unknown material type: "+e);else this.valid=!1;return t.validated=!0,this.valid},Oa.prototype._createEnumValidator=function(t){return function(e){return t.indexOf(e)>=0}};class Ra{constructor(){this._validator=null}parse(t){var e=this.migrate(t),i=this._validate(e),n=new af;return this.initialize(n,i),n}initialize(t,e){for(var i in e.validated||(this._validator||(this._validator=new Oa),this._validator.validate(e)),e.chunks&&t.chunks.copy(e.chunks),e){var n=Pa[i],r=e[i];if("vec2"===n)t[i]=new W(r[0],r[1]);else if("rgb"===n)t[i]=new D(r[0],r[1],r[2]);else if("texture"===n)r instanceof pe?t[i]=r:t[i]instanceof pe&&"number"==typeof r&&r>0||(t[i]=null);else if("cubemap"===n)r instanceof pe?t[i]=r:t[i]instanceof pe&&"number"==typeof r&&r>0||(t[i]=null);else if("boundingbox"===n){var s=new H(r.center[0],r.center[1],r.center[2]),a=new H(r.halfExtents[0],r.halfExtents[1],r.halfExtents[2]);t[i]=new st(s,a)}else t[i]=e[i]}t.update()}migrate(t){var e;void 0===t.shadingModel&&("blinn"===t.shader?t.shadingModel=1:t.shadingModel=0),t.shader&&delete t.shader,t.mapping_format&&(t.mappingFormat=t.mapping_format,delete t.mapping_format);var i=[["bumpMapFactor","bumpiness"],["aoUvSet","aoMapUv"],["aoMapVertexColor","aoVertexColor"],["diffuseMapVertexColor","diffuseVertexColor"],["emissiveMapVertexColor","emissiveVertexColor"],["specularMapVertexColor","specularVertexColor"],["metalnessMapVertexColor","metalnessVertexColor"],["opacityMapVertexColor","opacityVertexColor"],["glossMapVertexColor","glossVertexColor"],["lightMapVertexColor","lightVertexColor"],["diffuseMapTint","diffuseTint"],["specularMapTint","specularTint"],["emissiveMapTint","emissiveTint"],["metalnessMapTint","metalnessTint"]];for(e=0;e<i.length;e++){var n=i[e][0],r=i[e][1];void 0!==t[n]&&void 0===t[r]&&(t[r]=t[n],delete t[n])}var s=["fresnelFactor","shadowSampleType"];for(e=0;e<s.length;e++){var a=s[e];t.hasOwnProperty(a)&&delete t[a]}return t}_validate(t){return this._validator||(this._validator=new Oa),this._validator.validate(t),t}}var La={aoMap:"white",diffuseMap:"gray",specularMap:"gray",metalnessMap:"black",glossMap:"gray",emissiveMap:"gray",normalMap:"normal",heightMap:"gray",opacityMap:"gray",sphereMap:"gray",lightMap:"white"};class Na{constructor(t){this._assets=t.assets,this._device=t.graphicsDevice,this._placeholderTextures=null,this._parser=new Ra,this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t}),F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(i,n){i?e&&e("Error loading material: "+t.original+" ["+i+"]"):e&&(n._engine=!0,e(null,n))}))}open(t,e){var i=this._parser.parse(e);return e._engine&&(i._data=e,delete e._engine),i}_createPlaceholders(){this._placeholderTextures={};var t={white:[255,255,255,255],gray:[128,128,128,255],black:[0,0,0,255],normal:[128,128,255,255]};for(var e in t)if(t.hasOwnProperty(e)){this._placeholderTextures[e]=new pe(this._device,{width:2,height:2,format:7}),this._placeholderTextures[e].name="placeholder";for(var i=this._placeholderTextures[e].lock(),n=0;n<4;n++)for(var r=0;r<4;r++)i[4*n+r]=t[e][r];this._placeholderTextures[e].unlock()}}patch(t,e){t.resource._data&&(t._data=t.resource._data,delete t.resource._data),t.data.name=t.name,t.resource.name=t.name,this._bindAndAssignAssets(t,e),t.off("unload",this._onAssetUnload,this),t.on("unload",this._onAssetUnload,this)}_onAssetUnload(t){delete t.data.parameters,delete t.data.chunks,delete t.data.name}_assignTexture(t,e,i){e.data[t]=i,e.resource[t]=i}_assignPlaceholderTexture(t,e){this._placeholderTextures||this._createPlaceholders();var i=La[t],n=this._placeholderTextures[i];e.resource[t]=n}_onTextureLoad(t,e,i){this._assignTexture(t,e,i.resource),e.resource.update()}_onTextureAdd(t,e,i){this._assets.load(i)}_onTextureRemove(t,e,i){var n=e.resource;n&&n[t]===i.resource&&(this._assignTexture(t,e,null),n.update())}_assignCubemap(t,e,i){e.data[t]=i[0],7===i.length&&(e.data.prefilteredCubeMap128=i[1],e.data.prefilteredCubeMap64=i[2],e.data.prefilteredCubeMap32=i[3],e.data.prefilteredCubeMap16=i[4],e.data.prefilteredCubeMap8=i[5],e.data.prefilteredCubeMap4=i[6])}_onCubemapLoad(t,e,i){this._assignCubemap(t,e,i.resources),this._parser.initialize(e.resource,e.data)}_onCubemapAdd(t,e,i){0===e.data.shadingModel&&(e.loadFaces=!0),this._assets.load(i)}_onCubemapRemove(t,e,i){var n=e.resource;n[t]===i.resource&&(this._assignCubemap(t,e,[null,null,null,null,null,null,null]),n.update())}_bindAndAssignAssets(t,e){var i,n,r,s=this._parser.migrate(t.data),a=t.resource,o="path"===s.mappingFormat,l=Ea;for(i=0;i<l.length;i++)n=l[i],r=a._assetReferences[n],!s[n]||s[n]instanceof pe?r&&(o?r.url=null:r.id=null):(r||(r=new Da(n,t,e,{load:this._onTextureLoad,add:this._onTextureAdd,remove:this._onTextureRemove},this),a._assetReferences[n]=r),o?r.url=t.getAbsoluteUrl(s[n]):r.id=s[n],r.asset&&(r.asset.resource?this._assignTexture(n,t,r.asset.resource):this._assignPlaceholderTexture(n,t),e.load(r.asset)));var h=ka;for(i=0;i<h.length;i++)n=h[i],r=a._assetReferences[n],!s[n]||s[n]instanceof pe||(r||(r=new Da(n,t,e,{load:this._onCubemapLoad,add:this._onCubemapAdd,remove:this._onCubemapRemove},this),a._assetReferences[n]=r),o?r.url=s[n]:r.id=s[n],r.asset&&(r.asset.loaded&&this._assignCubemap(n,t,r.asset.resources),e.load(r.asset)));this._parser.initialize(a,s)}}class za{constructor(t){this._device=t}parse(t){var e=Zs.parse("filename.glb",t,this._device);return e?Zs.createModel(e,_e.defaultMaterial):null}}class Ba{constructor(){this.index=0,this.boneIndices=[0,0,0,0]}}class Fa{constructor(){this.partition=0,this.vertexStart=0,this.vertexCount=0,this.indexStart=0,this.indexCount=0,this.boneIndices=[],this.vertices=[],this.indices=[],this.indexMap={}}addVertex(t,e,i){var n=-1;if(void 0!==this.indexMap[e])n=this.indexMap[e],this.indices.push(n);else{for(var r=0;r<4;r++)if(0!==i.blendWeight.data[4*e+r]){var s=i.blendIndices.data[4*t.index+r];t.boneIndices[r]=this.getBoneRemap(s)}n=this.vertices.length,this.indices.push(n),this.vertices.push(t),this.indexMap[e]=n}}addPrimitive(t,e,i,n){var r,s,a=[],o=0,l=t.length;for(r=0;r<l;r++)for(var h=t[r].index,c=0;c<4;c++)if(i.blendWeight.data[4*h+c]>0){var u=i.blendIndices.data[4*h+c],d=!0;for(s=0;s<o;s++)if(a[s]==u){d=!1;break}if(d)a[o]=u,o+=-1===this.getBoneRemap(u)?1:0}if(this.boneIndices.length+o>n)return!1;for(r=0;r<o;r++)this.boneIndices.push(a[r]);for(r=0;r<l;r++)this.addVertex(t[r],e[r],i);return!0}getBoneRemap(t){for(var e=0;e<this.boneIndices.length;e++)if(this.boneIndices[e]===t)return e;return-1}}function ja(t,e,i){var n,r,s,a;!function(t){var e,i=t.vertices,n=t.skins,r=t.meshes,s=t.meshInstances;for(e=0;e<r.length;e++)r[e].vertices=i[r[e].vertices],void 0!==r[e].skin&&(r[e].skin=n[r[e].skin]);for(e=0;e<s.length;e++)s[e].mesh=r[s[e].mesh]}(t);var o,l=t.vertices,h=t.skins,c=t.meshes,u=t.meshInstances,d=function(t){var e=new Ba;return e.index=t,e};for(n=h.length-1;n>=0;n--)if(h[n].boneNames.length>i){var f=h.splice(n,1)[0],p=[];for(r=0;r<c.length;r++)c[r].skin===f&&p.push(c[r]);for(r=0;r<p.length;r++)-1!==(a=c.indexOf(p[r]))&&c.splice(a,1);if(0===p.length)throw new Error("partitionSkin: There should be at least one mesh that references a skin");var m,g=p[0].vertices;for(r=1;r<p.length;r++)if(p[r].vertices!==g)throw new Error("partitionSkin: All meshes that share a skin should also share the same vertex buffer");var v=[],_=[],y=[],b=0;for(r=0;r<p.length;r++){for(var x=(o=p[r]).indices,w=o.base;w<o.base+o.count;){a=x[w++],_[0]=d(a),y[0]=a,a=x[w++],_[1]=d(a),y[1]=a,a=x[w++],_[2]=d(a),y[2]=a;for(var A=!1,C=b;C<v.length;C++)if((m=v[C]).addPrimitive(_,y,g,i)){A=!0;break}A||((m=new Fa).originalMesh=o,m.addPrimitive(_,y,g,i),v.push(m))}b=v.length}var I=[],S=[];for(r=0;r<v.length;r++)if((m=v[r]).vertices.length&&m.indices.length){var M,T,P=I.length,E=m.vertices.length,k=S.length,D=m.indices.length;for(m.partition=r,m.vertexStart=P,m.vertexCount=E,m.indexStart=k,m.indexCount=D,M=0,T=P;M<E;)I[T++]=m.vertices[M++];for(M=0,T=k;M<D;)S[T++]=m.indices[M++]+P}var O,R,L,N,z=[];for(r=0;r<v.length;r++){m=v[r];var B=[],F=[];for(s=0;s<m.boneIndices.length;s++)B.push(f.inverseBindMatrices[m.boneIndices[s]]),F.push(f.boneNames[m.boneIndices[s]]);var j={inverseBindMatrices:B,boneNames:F};z.push(j),h.push(j)}var V={};for(R in g)V[R]={components:g[R].components,data:[],type:g[R].type};for(R in g)if("blendIndices"===R){var U=V[R].data;for(r=0;r<I.length;r++){var G=I[r].boneIndices;U.push(G[0],G[1],G[2],G[3])}}else for(L=(O=g[R]).data,N=O.components,r=0;r<I.length;r++)for(a=I[r].index,s=0;s<N;s++)V[R].data.push(L[a*N+s]);for(l[l.indexOf(g)]=V,r=0;r<v.length;r++)for(m=v[r],o={aabb:{min:[0,0,0],max:[0,0,0]},vertices:V,skin:z[r],indices:S.splice(0,m.indexCount),type:"triangles",base:0,count:m.indexCount},c.push(o),s=u.length-1;s>=0;s--)u[s].mesh===m.originalMesh&&(u.push({mesh:o,node:u[s].node}),e&&e.push({material:e[s].material,path:e[s].path}));for(r=0;r<v.length;r++)for(m=v[r],s=u.length-1;s>=0;s--)u[s].mesh===m.originalMesh&&(u.splice(s,1),e&&e.splice(s,1))}!function(t){var e,i=t.vertices,n=t.skins,r=t.meshes,s=t.meshInstances;for(e=0;e<r.length;e++)r[e].vertices=i.indexOf(r[e].vertices),void 0!==r[e].skin&&(r[e].skin=n.indexOf(r[e].skin));for(e=0;e<s.length;e++)s[e].mesh=r.indexOf(s[e].mesh)}(t)}var Va={points:0,lines:1,lineloop:2,linestrip:3,triangles:4,trianglestrip:5,trianglefan:6},Ua={int8:0,uint8:1,int16:2,uint16:3,int32:4,uint32:5,float32:6};class Ga{constructor(t){this._device=t}parse(t){var e=t.model;if(!e)return null;if(e.version<=1)return null;var i=this._parseNodes(t),n=this._parseSkins(t,i),r=this._parseVertexBuffers(t),s=this._parseIndexBuffers(t,r),a=this._parseMorphs(t,i,r),o=this._parseMeshes(t,n.skins,a.morphs,r,s.buffer,s.data),l=this._parseMeshInstances(t,i,o,n.skins,n.instances,a.morphs,a.instances),h=new Ne;return h.graph=i[0],h.meshInstances=l,h.skinInstances=n.instances,h.morphInstances=a.instances,h.getGraph().syncHierarchy(),h}_parseNodes(t){var e,i=t.model,n=[];for(e=0;e<i.nodes.length;e++){var r=i.nodes[e],s=new _i(r.name);s.setLocalPosition(r.position[0],r.position[1],r.position[2]),s.setLocalEulerAngles(r.rotation[0],r.rotation[1],r.rotation[2]),s.setLocalScale(r.scale[0],r.scale[1],r.scale[2]),s.scaleCompensation=!!r.scaleCompensation,n.push(s)}for(e=1;e<i.parents.length;e++)n[i.parents[e]].addChild(n[e]);return n}_parseSkins(t,e){var i,n,r=t.model,s=[],a=[];!this._device.supportsBoneTextures&&r.skins.length>0&&ja(r,null,this._device.getBoneLimit());for(i=0;i<r.skins.length;i++){var o=r.skins[i],l=[];for(n=0;n<o.inverseBindMatrices.length;n++){var h=o.inverseBindMatrices[n];l[n]=(new Q).set(h)}var c=new rs(this._device,l,o.boneNames);s.push(c);var u=new Le(c),d=[];for(n=0;n<c.boneNames.length;n++){var f=c.boneNames[n],p=e[0].findByName(f);d.push(p)}u.bones=d,a.push(u)}return{skins:s,instances:a}}_getMorphVertexCount(t,e,i){for(var n=0;n<t.meshes.length;n++){var r=t.meshes[n];if(r.morph===e)return i[r.vertices].numVertices}}_parseMorphs(t,e,i){var n,r,s,a,o,l,h=t.model,c=[],u=[];if(h.morphs){var d=function(t,e,i){for(var n=new Float32Array(3*i),r=0;r<e.length;r++){var s=3*e[r];n[s]=t[3*r],n[s+1]=t[3*r+1],n[s+2]=t[3*r+2]}return n};for(n=0;n<h.morphs.length;n++){for(a=h.morphs[n].targets,l=[],s=this._getMorphVertexCount(h,n,i),r=0;r<a.length;r++){var f=a[r].aabb,p=f.min,m=f.max,g=new st(new H(.5*(m[0]+p[0]),.5*(m[1]+p[1]),.5*(m[2]+p[2])),new H(.5*(m[0]-p[0]),.5*(m[1]-p[1]),.5*(m[2]-p[2]))),v=a[r].indices,_=a[r].deltaPositions,y=a[r].deltaNormals;v&&(_=d(_,v,s),y=d(y,v,s)),o=new ns({deltaPositions:_,deltaNormals:y,name:a[r].name,aabb:g}),l.push(o)}var b=new De(l,this._device);c.push(b);var x=new Oe(b);u.push(x)}}return{morphs:c,instances:u}}_parseVertexBuffers(t){var e,i,n,r,s=t.model,a=[],o={position:"POSITION",normal:"NORMAL",tangent:"TANGENT",blendWeight:"BLENDWEIGHT",blendIndices:"BLENDINDICES",color:"COLOR",texCoord0:"TEXCOORD0",texCoord1:"TEXCOORD1",texCoord2:"TEXCOORD2",texCoord3:"TEXCOORD3",texCoord4:"TEXCOORD4",texCoord5:"TEXCOORD5",texCoord6:"TEXCOORD6",texCoord7:"TEXCOORD7"};for(n=0;n<s.vertices.length;n++){var l=s.vertices[n],h=[];for(i in l)e=l[i],h.push({semantic:o[i],components:e.components,type:Ua[e.type],normalize:"COLOR"===o[i]});var c=new bt(this._device,h),u=l.position.data.length/l.position.components,d=new _t(this._device,c,u),f=new Rt(d);for(r=0;r<u;r++){for(i in l)switch((e=l[i]).components){case 1:f.element[o[i]].set(e.data[r]);break;case 2:f.element[o[i]].set(e.data[2*r],e.data[2*r+1]);break;case 3:f.element[o[i]].set(e.data[3*r],e.data[3*r+1],e.data[3*r+2]);break;case 4:f.element[o[i]].set(e.data[4*r],e.data[4*r+1],e.data[4*r+2],e.data[4*r+3])}f.next()}f.end(),a.push(d)}return a}_parseIndexBuffers(t,e){var i,n=t.model,r=null,s=null,a=0;for(i=0;i<n.meshes.length;i++){var o=n.meshes[i];void 0!==o.indices&&(a+=o.indices.length)}var l=0;for(i=0;i<e.length;i++)l=Math.max(l,e[i].numVertices);return a>0&&(l>65535&&this._device.extUintElement?(r=new xe(this._device,2,a),s=new Uint32Array(r.lock())):(r=new xe(this._device,1,a),s=new Uint16Array(r.lock()))),{buffer:r,data:s}}_parseMeshes(t,e,i,n,r,s){var a,o=t.model,l=[],h=0;for(a=0;a<o.meshes.length;a++){var c=o.meshes[a],u=c.aabb,d=u.min,f=u.max,p=new st(new H(.5*(f[0]+d[0]),.5*(f[1]+d[1]),.5*(f[2]+d[2])),new H(.5*(f[0]-d[0]),.5*(f[1]-d[1]),.5*(f[2]-d[2]))),m=void 0!==c.indices,g=new Ie(this._device);g.vertexBuffer=n[c.vertices],g.indexBuffer[0]=m?r:null,g.primitive[0].type=Va[c.type],g.primitive[0].base=m?c.base+h:c.base,g.primitive[0].count=c.count,g.primitive[0].indexed=m,g.skin=void 0!==c.skin?e[c.skin]:null,g.morph=void 0!==c.morph?i[c.morph]:null,g.aabb=p,m&&(s.set(c.indices,h),h+=c.indices.length),l.push(g)}return null!==r&&r.unlock(),l}_parseMeshInstances(t,e,i,n,r,s,a){var o,l=t.model,h=[];for(o=0;o<l.meshInstances.length;o++){var c=l.meshInstances[o],u=e[c.node],d=i[c.mesh],f=new Ee(u,d,_e.defaultMaterial);if(d.skin){var p=n.indexOf(d.skin);f.skinInstance=r[p]}if(d.morph){var m=s.indexOf(d.morph);f.morphInstance=a[m]}h.push(f)}return h}}class Wa{constructor(t,e){this._device=t,this._parsers=[],this._defaultMaterial=e,this.maxRetries=0,this.addParser(new Ga(this._device),(function(t,e){return".json"===x.getExtension(t)})),this.addParser(new za(this._device),(function(t,e){return".glb"===x.getExtension(t)}))}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i={retry:this.maxRetries>0,maxRetries:this.maxRetries};(t.load.startsWith("blob:")||t.load.startsWith("data:"))&&(".glb"===x.getExtension(t.original).toLowerCase()?i.responseType=B.ResponseType.ARRAY_BUFFER:i.responseType=B.ResponseType.JSON),F.get(t.load,i,(function(i,n){e&&(i?e("Error loading model: "+t.original+" ["+i+"]"):e(null,n))}))}open(t,e){for(var i=0;i<this._parsers.length;i++){var n=this._parsers[i];if(n.decider(t,e))return n.parser.parse(e)}return null}patch(t,e){if(t.resource){var i=t.data,n=this;t.resource.meshInstances.forEach((function(r,s){if(i.mapping){var a=function t(i){i.resource?r.material=i.resource:(i.once("load",t),e.load(i)),i.once("remove",(function(t){r.material===t.resource&&(r.material=n._defaultMaterial)}))};if(!i.mapping[s])return void(r.material=n._defaultMaterial);var o,l=i.mapping[s].material,h=i.mapping[s].path;if(void 0!==l)l?(o=e.get(l))?a(o):e.once("add:"+l,a):r.material=n._defaultMaterial;else if(h){var c=t.getAbsoluteUrl(i.mapping[s].path);(o=e.getByUrl(c))?a(o):e.once("add:url:"+c,a)}}}))}}addParser(t,e){this._parsers.push({parser:t,decider:e})}}class Ha extends v{constructor(){super(),this._meshes=null}get meshes(){return this._meshes}set meshes(t){this._meshes=t,this.fire("set:meshes",t)}}function Xa(t){if(this.resource){var e=t.resource,i=e.renders&&e.renders[this.data.renderIndex];i&&(this.resource.meshes=i.resource)}}function Za(t){this.registry.off("load:"+t.id,Xa,this),this.registry.on("load:"+t.id,Xa,this),this.registry.off("remove:"+t.id,Ya,this),this.registry.once("remove:"+t.id,Ya,this),t.resource?Xa.call(this,t):this.registry.load(t)}function Ya(t){this.registry.off("load:"+t.id,Xa,this),this.resource&&(this.resource.meshes=null)}class qa{constructor(t){this._registry=t}load(t,e,i){}open(t,e){return new Ha}patch(t,e){if(t.data.containerAsset){var i=e.get(t.data.containerAsset);i?Za.call(t,i):e.once("add:"+t.data.containerAsset,Za,t)}}}class Ka{constructor(t){this._handlers={},this._requests={},this._cache={},this._app=t}addHandler(t,e){this._handlers[t]=e,e._loader=this}removeHandler(t){delete this._handlers[t]}getHandler(t){return this._handlers[t]}load(t,e,i,n){var r=this._handlers[e];if(r)if(t){var s=t+e;if(void 0!==this._cache[s])i(null,this._cache[s]);else if(this._requests[s])this._requests[s].push(i);else{this._requests[s]=[i];var a=this,o=function(t,e){t?a._onFailure(s,t):r.load(e,(function(t,i,o){if(a._requests[s])if(t)a._onFailure(s,t);else try{a._onSuccess(s,r.open(e.original,i,n),o)}catch(t){a._onFailure(s,t)}}),n)},l=t.split("?")[0];if(this._app.enableBundles&&this._app.bundles.hasUrl(l)){if(!this._app.bundles.canLoadUrl(l))return void o("Bundle for "+t+" not loaded yet");this._app.bundles.loadUrl(l,(function(t,e){o(t,{load:e,original:l})}))}else o(null,{load:t,original:n&&n.getPreferredFile().filename||t})}}else this._loadNull(r,i,n);else i("No handler for asset type: "+e)}_loadNull(t,e,i){t.load(null,(function(n,r,s){if(n)e(n);else try{e(null,t.open(null,r,i),s)}catch(t){e(t)}}),i)}_onSuccess(t,e,i){this._cache[t]=e;for(var n=0;n<this._requests[t].length;n++)this._requests[t][n](null,e,i);delete this._requests[t]}_onFailure(t,e){if(console.error(e),this._requests[t]){for(var i=0;i<this._requests[t].length;i++)this._requests[t][i](e);delete this._requests[t]}}open(t,e){var i=this._handlers[t];return i?i.open(null,e):(console.warn("No resource handler found for: "+t),e)}patch(t,e){var i=this._handlers[t.type];i?i.patch&&i.patch(t,e):console.warn("No resource handler found for: "+t.type)}clearCache(t,e){delete this._cache[t+e]}getFromCache(t,e){if(this._cache[t+e])return this._cache[t+e]}enableRetry(t=5){for(var e in t=Math.max(0,t)||0,this._handlers)this._handlers[e].maxRetries=t}disableRetry(){for(var t in this._handlers)this._handlers[t].maxRetries=0}destroy(){this._handlers={},this._requests={},this._cache={}}}class Ja{constructor(t){this._app=t,this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i=this._app.assets;F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(n,r){if(n){var s="Error while loading scene "+t.original;n.message?(s+=": "+n.message,n.stack&&(s+="\n"+n.stack)):s+=": "+n,e(s)}else ya.waitForTemplatesInScene(r,i,e)}))}open(t,e){this._app.systems.script.preloading=!0;var i=new Ca(this._app,!1).parse(e),n=this._app.scene;return n.root=i,this._app.applySceneSettings(e.settings),this._app.systems.script.preloading=!1,n}patch(t,e){}}class Qa{constructor(t){this._app=t,this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t}),F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(i,n){if(i){var r="Error while loading scene settings "+t.original;i.message?(r+=": "+i.message,i.stack&&(r+="\n"+i.stack)):r+=": "+i,e(r)}else e(null,n)}))}open(t,e){return e.settings}}var $a=!1,to=!1,eo={app:null,create:function(t,e){if($a){var i=e(eo.app);i._pcScriptName=t,io._push(i),this.fire("created",t,e)}},attribute:function(t,e,i,n){},createLoadingScreen:function(t){to||(to=!0,t(qd.getApplication()))}};Object.defineProperty(eo,"legacy",{get:function(){return $a},set:function(t){$a=t}}),y.attach(eo);class io{constructor(t){this._app=t,this._scripts={},this._cache={}}static _push(t){eo.legacy&&io._types.length>0?console.assert("Script Ordering Error. Contact support@playcanvas.com"):io._types.push(t)}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i=this;eo.app=this._app,this._loadScript(t.load,function(t,n,r){if(t)e(t);else if(eo.legacy){var s=null;io._types.length&&(s=io._types.pop()),s?this._scripts[n]=s:s=null,e(null,s,r)}else{for(var a={},o=0;o<io._types.length;o++)a[io._types[o].name]=io._types[o];io._types.length=0,e(null,a,r),delete i._loader._cache[n+"script"]}}.bind(this))}open(t,e){return e}patch(t,e){}_loadScript(t,e){var i=document.head,n=document.createElement("script");this._cache[t]=n,n.async=!1,n.addEventListener("error",(function(t){e("Script: "+t.target.src+" failed to load")}),!1);var r=!1;n.onload=n.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,e(null,t,n))},n.src=t,i.appendChild(n)}}io._types=[];class no{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t}),F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(i,n){i?e("Error loading shader resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){return e}patch(t,e){}}const ro=[0,0,1,0,0,1,0,0,1,0,0,1],so=[0,1,3,2,3,1];class ao extends v{constructor(t,e){super(),this._device=t,this._pixelsPerUnit=e&&void 0!==e.pixelsPerUnit?e.pixelsPerUnit:1,this._renderMode=e&&void 0!==e.renderMode?e.renderMode:0,this._atlas=e&&void 0!==e.atlas?e.atlas:null,this._frameKeys=e&&void 0!==e.frameKeys?e.frameKeys:null,this._meshes=[],this._updatingProperties=!1,this._meshesDirty=!1,this._atlas&&this._frameKeys&&this._createMeshes()}_createMeshes(){var t,e;for(t=0,e=this._meshes.length;t<e;t++){var i=this._meshes[t];i&&i.destroy()}var n=this._frameKeys.length;this._meshes=new Array(n);var r=1===this.renderMode||2===this._renderMode?this._create9SliceMesh:this._createSimpleMesh;for(t=0;t<n;t++){var s=this._atlas.frames[this._frameKeys[t]];this._meshes[t]=s?r.call(this,s):null}this.fire("set:meshes")}_createSimpleMesh(t){var e=t.rect,i=this._atlas.texture.width,n=this._atlas.texture.height,r=e.z/this._pixelsPerUnit,s=e.w/this._pixelsPerUnit,a=t.pivot.x,o=t.pivot.y,l=[-a*r,-o*s,0,(1-a)*r,-o*s,0,(1-a)*r,(1-o)*s,0,-a*r,(1-o)*s,0],h=e.x/i,c=e.y/n,u=(e.x+e.z)/i,d=(e.y+e.w)/n,f=[h,c,u,c,u,d,h,d];return Br(this._device,l,{uvs:f,normals:ro,indices:so})}_create9SliceMesh(){var t,e,i,n,r,s,a=W.ONE,o=[],l=[],h=[],c=[],u=0;for(t=0;t<=3;t++)for(r=0===t||3===t?0:1,e=0;e<=3;e++)i=-a.x+2*a.x*(t<=1?0:3)/3,0,n=-(-a.y+2*a.y*(e<=1?0:3)/3),s=0===e||3===e?0:1,o.push(-i,0,n),l.push(0,1,0),h.push(r,s),t<3&&e<3&&(c.push(u+3+1,u+1,u),c.push(u+3+1,u+3+2,u+1)),u++;var d={normals:l,uvs:h,indices:c};return Br(this._device,o,d)}_onSetFrames(t){this._updatingProperties?this._meshesDirty=!0:this._createMeshes()}_onFrameChanged(t,e){var i=this._frameKeys.indexOf(t);i<0||(e?0===this.renderMode&&(this._meshes[i]=this._createSimpleMesh(e)):this._meshes[i]=null,this.fire("set:meshes"))}_onFrameRemoved(t){var e=this._frameKeys.indexOf(t);e<0||(this._meshes[e]=null,this.fire("set:meshes"))}startUpdate(){this._updatingProperties=!0,this._meshesDirty=!1}endUpdate(){this._updatingProperties=!1,this._meshesDirty&&this._atlas&&this._frameKeys&&this._createMeshes(),this._meshesDirty=!1}destroy(){for(const t of this._meshes)t&&t.destroy();this._meshes.length=0}get frameKeys(){return this._frameKeys}set frameKeys(t){this._frameKeys=t,this._atlas&&this._frameKeys&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes()),this.fire("set:frameKeys",t)}get atlas(){return this._atlas}set atlas(t){t!==this._atlas&&(this._atlas&&(this._atlas.off("set:frames",this._onSetFrames,this),this._atlas.off("set:frame",this._onFrameChanged,this),this._atlas.off("remove:frame",this._onFrameRemoved,this)),this._atlas=t,this._atlas&&this._frameKeys&&(this._atlas.on("set:frames",this._onSetFrames,this),this._atlas.on("set:frame",this._onFrameChanged,this),this._atlas.on("remove:frame",this._onFrameRemoved,this),this._updatingProperties?this._meshesDirty=!0:this._createMeshes()),this.fire("set:atlas",t))}get pixelsPerUnit(){return this._pixelsPerUnit}set pixelsPerUnit(t){this._pixelsPerUnit!==t&&(this._pixelsPerUnit=t,this.fire("set:pixelsPerUnit",t),this._atlas&&this._frameKeys&&0===this.renderMode&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes()))}get renderMode(){return this._renderMode}set renderMode(t){if(this._renderMode!==t){var e=this._renderMode;this._renderMode=t,this.fire("set:renderMode",t),0!==e&&0!==t||this._atlas&&this._frameKeys&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes())}}get meshes(){return this._meshes}}function oo(t){this.resource&&(this.resource.atlas=t.resource)}function lo(t){this.registry.load(t)}class ho{constructor(t,e){this._assets=t,this._device=e,this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t}),".json"===x.getExtension(t.original)&&F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(t,i){t?e(t):e(null,i)}))}open(t,e){var i=new ao(this._device);return t&&(i.__data=e),i}patch(t,e){var i=t.resource;if(i.__data&&(t.data.pixelsPerUnit=i.__data.pixelsPerUnit,t.data.renderMode=i.__data.renderMode,t.data.frameKeys=i.__data.frameKeys,i.__data.textureAtlasAsset)){var n=e.getByUrl(i.__data.textureAtlasAsset);n?t.data.textureAtlasAsset=n.id:console.warn("Could not find textureatlas with url: "+i.__data.textureAtlasAsset)}i.startUpdate(),i.renderMode=t.data.renderMode,i.pixelsPerUnit=t.data.pixelsPerUnit,i.frameKeys=t.data.frameKeys,this._updateAtlas(t),i.endUpdate(),t.off("change",this._onAssetChange,this),t.on("change",this._onAssetChange,this)}_updateAtlas(t){var e=t.resource;if(t.data.textureAtlasAsset){this._assets.off("load:"+t.data.textureAtlasAsset,oo,t),this._assets.on("load:"+t.data.textureAtlasAsset,oo,t);var i=this._assets.get(t.data.textureAtlasAsset);i&&i.resource?e.atlas=i.resource:i?this._assets.load(i):(this._assets.off("add:"+t.data.textureAtlasAsset,lo,t),this._assets.on("add:"+t.data.textureAtlasAsset,lo,t))}else e.atlas=null}_onAssetChange(t,e,i,n){"data"===e&&i&&i.textureAtlasAsset&&n&&i.textureAtlasAsset!==n.textureAtlasAsset&&(this._assets.off("load:"+n.textureAtlasAsset,oo,t),this._assets.off("add:"+n.textureAtlasAsset,lo,t))}}class co{constructor(t,e){this._app=t,this._data=e,this._templateRoot=null}instantiate(){return this._templateRoot||this._parseTemplate(),this._templateRoot.clone()}_parseTemplate(){var t=new Ca(this._app,!0);this._templateRoot=t.parse(this._data)}}class uo{constructor(t){this._app=t}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i=this._app.assets;F.get(t.load,(function(n,r){n?e("Error requesting template: "+t.original):ya.waitForTemplateAssets(r.entities,i,e,r)}))}open(t,e){return new co(this._app,e)}}class fo{constructor(){this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t}),F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(i,n){i?e("Error loading text resource: "+t.original+" ["+i+"]"):e(null,n)}))}open(t,e){return e}patch(t,e){}}class po extends v{constructor(){super(),this._texture=null,this._frames=null}setFrame(t,e){var i=this._frames[t];i?(i.rect.copy(e.rect),i.pivot.copy(e.pivot),i.border.copy(e.border)):(i={rect:e.rect.clone(),pivot:e.pivot.clone(),border:e.border.clone()},this._frames[t]=i),this.fire("set:frame",t.toString(),i)}removeFrame(t){var e=this._frames[t];e&&(delete this._frames[t],this.fire("remove:frame",t.toString(),e))}destroy(){this._texture&&this._texture.destroy()}get texture(){return this._texture}set texture(t){this._texture=t,this.fire("set:texture",t)}get frames(){return this._frames}set frames(t){this._frames=t,this.fire("set:frames",t)}}var mo={repeat:0,clamp:1,mirror:2},go={nearest:0,linear:1,nearest_mip_nearest:2,linear_mip_nearest:4,nearest_mip_linear:3,linear_mip_linear:5},vo=/^data\.frames\.(\d+)$/;class _o{constructor(t){this._loader=t,this.maxRetries=0}load(t,e){"string"==typeof t&&(t={load:t,original:t});var i=this,n=this._loader.getHandler("texture");if(".json"!==x.getExtension(t.original))return n.load(t,e);F.get(t.load,{retry:this.maxRetries>0,maxRetries:this.maxRetries},(function(n,r){if(n)e(n);else{var s=t.original.replace(".json",".png");i._loader.load(s,"texture",(function(t,i){t?e(t):e(null,{data:r,texture:i})}))}}))}open(t,e){var i=new po;if(e.texture&&e.data)i.texture=e.texture,i.__data=e.data;else{var n=this._loader.getHandler("texture").open(t,e);if(!n)return null;i.texture=n}return i}patch(t,e){t.resource.__data&&(void 0!==t.resource.__data.minfilter&&(t.data.minfilter=t.resource.__data.minfilter),void 0!==t.resource.__data.magfilter&&(t.data.magfilter=t.resource.__data.magfilter),void 0!==t.resource.__data.addressu&&(t.data.addressu=t.resource.__data.addressu),void 0!==t.resource.__data.addressv&&(t.data.addressv=t.resource.__data.addressv),void 0!==t.resource.__data.mipmaps&&(t.data.mipmaps=t.resource.__data.mipmaps),void 0!==t.resource.__data.anisotropy&&(t.data.anisotropy=t.resource.__data.anisotropy),void 0!==t.resource.__data.rgbm&&(t.data.rgbm=!!t.resource.__data.rgbm),t.data.frames=t.resource.__data.frames,delete t.resource.__data);var i=t.resource.texture;if(i&&(i.name=t.name,t.data.hasOwnProperty("minfilter")&&i.minFilter!==go[t.data.minfilter]&&(i.minFilter=go[t.data.minfilter]),t.data.hasOwnProperty("magfilter")&&i.magFilter!==go[t.data.magfilter]&&(i.magFilter=go[t.data.magfilter]),t.data.hasOwnProperty("addressu")&&i.addressU!==mo[t.data.addressu]&&(i.addressU=mo[t.data.addressu]),t.data.hasOwnProperty("addressv")&&i.addressV!==mo[t.data.addressv]&&(i.addressV=mo[t.data.addressv]),t.data.hasOwnProperty("mipmaps")&&i.mipmaps!==t.data.mipmaps&&(i.mipmaps=t.data.mipmaps),t.data.hasOwnProperty("anisotropy")&&i.anisotropy!==t.data.anisotropy&&(i.anisotropy=t.data.anisotropy),t.data.hasOwnProperty("rgbm"))){var n=t.data.rgbm?"rgbm":"default";i.type!==n&&(i.type=n)}t.resource.texture=i;var r={};for(var s in t.data.frames){var a=t.data.frames[s];r[s]={rect:new X(a.rect),pivot:new W(a.pivot),border:new X(a.border)}}t.resource.frames=r,t.off("change",this._onAssetChange,this),t.on("change",this._onAssetChange,this)}_onAssetChange(t,e,i){var n;if("data"===e||"data.frames"===e){var r={};for(var s in i.frames)n=i.frames[s],r[s]={rect:new X(n.rect),pivot:new W(n.pivot),border:new X(n.border)};t.resource.frames=r}else{var a=e.match(vo);if(a){var o=a[1];i?(t.resource.frames[o]?((n=t.resource.frames[o]).rect.set(i.rect[0],i.rect[1],i.rect[2],i.rect[3]),n.pivot.set(i.pivot[0],i.pivot[1]),n.border.set(i.border[0],i.border[1],i.border[2],i.border[3])):t.resource.frames[o]={rect:new X(i.rect),pivot:new W(i.pivot),border:new X(i.border)},t.resource.fire("set:frame",o,t.resource.frames[o])):t.resource.frames[o]&&(delete t.resource.frames[o],t.resource.fire("remove:frame",o))}}}}function yo(){var t=0,e=1,i=2,n=3,r=8,s=9,a=10,o=11,l=12,h=13,c=14,u=16,d={astc:a,dxt:i,etc2:t,etc1:t,pvr:r,atc:o,none:c},f={astc:a,dxt:n,etc2:e,etc1:u,pvr:s,atc:l,none:u},p={};p[t]=21,p[e]=23,p[i]=8,p[n]=10,p[r]=26,p[s]=27,p[a]=28,p[o]=29,p[l]=30,p[h]=7,p[c]=3,p[u]=5;var m="undefined"!=typeof performance,g=function(t){for(var e=function(t,e){var i=t*(2/255)-1,n=e*(2/255)-1,r=Math.sqrt(1-Math.min(1,i*i+n*n));return Math.max(0,Math.min(255,Math.floor(.5*(r+1)*255)))},i=0;i<t.length;i+=4){var n=t[i+3],r=t[i+1];t[i+0]=n,t[i+2]=e(n,r),t[i+3]=255}return t},v=function(t){for(var e=new Uint16Array(t.length/4),i=0;i<t.length;i+=4){var n=t[i+0],r=t[i+1],s=t[i+2];e[i/4]=(248&n)<<8|(252&r)<<3|s>>3}return e},_=null,y=[],b=function(t,e,i,n){try{var a=function(t,e,i,n,a){var o=m?performance.now():0,l=new t.BasisFile(new Uint8Array(n)),_=l.getImageWidth(0,0),y=l.getImageHeight(0,0),b=l.getNumImages(),x=l.getNumLevels(0),w=!!l.getHasAlpha();if(!(_&&y&&b&&x))throw l.close(),l.delete(),new Error("Invalid image dimensions url="+e+" width="+_+" height="+y+" images="+b+" levels="+x);var A,C=w?f[i]:d[i];if(C!==r&&C!==s||0==(_&_-1)&&_===y||(C=C===r?c:h),a&&a.unswizzleGGGR&&(C=h),!l.startTranscoding())throw l.close(),l.delete(),new Error("Failed to start transcoding url="+e);for(var I=[],S=0;S<x;++S){var M=l.getImageTranscodedSizeInBytes(0,S,C),T=new Uint8Array(M);if(!l.transcodeImage(T,0,S,C,1,0))throw l.close(),l.delete(),new Error("Failed to transcode image url="+e);if(C===c||C===u){var P=new Uint16Array(M/2);for(A=0;A<M/2;++A)P[A]=T[2*A]+256*T[2*A+1];T=P}I.push(T)}if(l.close(),l.delete(),a&&a.unswizzleGGGR)for(C=c,A=0;A<I.length;++A)I[A]=v(g(I[A]));return{format:p[C],width:_+3&-4,height:y+3&-4,levels:I,cubemap:!1,mipmaps:!0,transcodeTime:m?performance.now()-o:0,url:e}}(_,t,e,i,n);a.levels=a.levels.map((function(t){return t.buffer})),self.postMessage({url:t,data:a},a.levels)}catch(e){self.postMessage({url:t.toString(),err:e.toString()})}};self.onmessage=function(t){var e,i=t.data;switch(i.type){case"init":e=i.module,self.BASIS(e?{instantiateWasm:function(t,i){return WebAssembly.instantiate(e,t).then((function(t){i(t)})),{}}}:null).then((function(t){(_=t).initializeBasis();for(var e=0;e<y.length;++e)b(y[e].url,y[e].format,y[e].data,y[e].options);y=[]}));break;case"transcode":_?b(i.url,i.format,i.data,i.options):y.push(i)}}}var bo=function(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1}();var xo=!1,wo=null,Ao={},Co=null,Io=[],So=null;function Mo(){var t;return Co||(t=qd.getApplication().graphicsDevice,Co=t.extCompressedTextureASTC?"astc":t.extCompressedTextureS3TC?"dxt":t.extCompressedTextureETC?"etc2":t.extCompressedTextureETC1?"etc1":t.extCompressedTexturePVRTC?"pvr":t.extCompressedTextureATC?"atc":"none"),Co}function To(t){var e,i=t.data.url,n=t.data.err,r=t.data.data,s=Ao[i];if(s)if(n)for(e=0;e<s.length;++e)s[e](n);else{for(3===r.format||5===r.format?r.levels=r.levels.map((function(t){return new Uint16Array(t)})):r.levels=r.levels.map((function(t){return new Uint8Array(t)})),e=0;e<s.length;++e)s[e](null,r);delete Ao[i]}else console.error("internal logical error encountered in basis transcoder")}function Po(t,e,i,n){Ao.hasOwnProperty(t)?Ao[t].push(i):(Ao[t]=[i],wo.postMessage({type:"transcode",url:t,format:Mo(),data:e,options:n},[e]))}function Eo(t,e,i){var n=["/* basis.js */",t,"/* mappings */","var PIXELFORMAT_ETC1 = 21;","var PIXELFORMAT_ETC2_RGBA = 23;","var PIXELFORMAT_DXT1 = 8;","var PIXELFORMAT_DXT5 = 10;","var PIXELFORMAT_PVRTC_4BPP_RGB_1 = 26;","var PIXELFORMAT_PVRTC_4BPP_RGBA_1 = 27;","var PIXELFORMAT_ASTC_4x4 = 28;","var PIXELFORMAT_ATC_RGB = 29;","var PIXELFORMAT_ATC_RGBA = 30;","var PIXELFORMAT_R8_G8_B8_A8 = 7;","var PIXELFORMAT_R5_G6_B5 = 3;","var PIXELFORMAT_R4_G4_B4_A4 = 5;","","/* worker */","("+yo.toString()+")()\n\n"].join("\n"),r=new Blob([n],{type:"application/javascript"}),s=URL.createObjectURL(r);(wo=new Worker(s)).addEventListener("message",To),wo.postMessage({type:"init",module:e}),i&&i();for(var a=0;a<Io.length;++a){var o=Io[a];Po(o.url,o.data,o.callback,o.options)}}function ko(t,e,i,n){if(xo&&console.warn("basis module is being downloaded more than once"),xo=!0,bo){var r=null,s=null,a=function(){r&&s&&Eo(r,s,n)},o=function(){F.get(e,{cache:!0,responseType:"arraybuffer",retry:!1},(function(t,e){e&&WebAssembly.compile(e).then((function(t){s=t,a()}))}))};WebAssembly.compileStreaming?WebAssembly.compileStreaming(fetch(e)).then((function(t){s=t,a()})).catch((function(t){console.error(t),console.warn("compileStreaming() failed for "+e+", falling back to arraybuffer download..."),o()})):o(),F.get(t,{cache:!0,responseType:"text",retry:!1},(function(t,e){r=e,a()}))}else F.get(i,{cache:!0,responseType:"text",retry:!1},(function(t,e){e&&Eo(e,null,n)}))}function Do(t,e,i,n){wo?Po(t,e,i,n):(Io.push({url:t,data:e,callback:i,options:n}),xo||function(t){if(So)ko(So.glueUrl,So.wasmUrl,So.fallbackUrl,t);else{var e=((window.config?window.config.wasmModules:window.PRELOAD_MODULES)||[]).find((function(t){return"BASIS"===t.moduleName}));if(e){var i=window.ASSET_PREFIX?window.ASSET_PREFIX:"";ko(i+e.glueUrl,i+e.wasmUrl,i+e.fallbackUrl,t)}}}())}class Oo{constructor(t){this.maxRetries=0}load(t,e,i){var n={cache:!0,responseType:"arraybuffer",retry:this.maxRetries>0,maxRetries:this.maxRetries};F.get(t.load,n,(function(n,r){if(n)e(n,r);else{var s="pvr"===Mo()&&i&&i.file&&i.file.variants&&i.file.variants.basis&&0!=(8&i.file.variants.basis.opt);s&&(i.file.variants.basis.opt&=-9),Do(t.load,r,e,{unswizzleGGGR:s})}}))}open(t,e,i){var n=new pe(i,{name:t,addressU:e.cubemap?1:0,addressV:e.cubemap?1:0,width:e.width,height:e.height,format:e.format,cubemap:e.cubemap,levels:e.levels});return n.upload(),n}}class Ro{constructor(t){this.crossOrigin=t.prefix?"anonymous":null,this.maxRetries=0,this.useImageBitmap=!1}load(t,e,i){var n;i&&i.options&&i.options.hasOwnProperty("crossOrigin")?n=i.options.crossOrigin:gs.test(t.load)&&(n=this.crossOrigin),this.useImageBitmap?this._loadImageBitmap(t.load,t.original,n,e):this._loadImage(t.load,t.original,n,e)}open(t,e,i){var n=x.getExtension(t).toLowerCase(),r=".jpg"===n||".jpeg"===n?6:7,s=new pe(i,{name:t,width:e.width,height:e.height,format:r});return s.setSource(e),s}_loadImage(t,e,i,n){var r=new Image;i&&(r.crossOrigin=i);var s,a=0,o=this.maxRetries;r.onload=function(){n(null,r)},r.onerror=function(){if(!s)if(o>0&&++a<=o){var i=100*Math.pow(2,a);console.log("Error loading Texture from: '"+e+"' - Retrying in "+i+"ms...");var l=t.indexOf("?")>=0?"&":"?";s=setTimeout((function(){r.src=t+l+"retry="+Date.now(),s=null}),i)}else n("Error loading Texture from: '"+e+"'")},r.src=t}_loadImageBitmap(t,e,i,n){var r={cache:!0,responseType:"blob",retry:this.maxRetries>0,maxRetries:this.maxRetries};F.get(t,r,(function(t,e){t?n(t):createImageBitmap(e,{premultiplyAlpha:"none",imageOrientation:"flipY"}).then((function(t){n(null,t)})).catch((function(t){n(t)}))}))}}const Lo=[1481919403,3140563232,169478669],No={33776:8,33778:9,33779:10,36196:21,37492:22,37496:23,35840:26,35841:24,35842:27,35843:25};class zo{constructor(t){this.maxRetries=0}load(t,e,i){var n={cache:!0,responseType:"arraybuffer",retry:this.maxRetries>0,maxRetries:this.maxRetries};F.get(t.load,n,e)}open(t,e,i){var n=this.parse(e);if(!n)return null;var r=new pe(i,{name:t,addressU:n.cubemap?1:0,addressV:n.cubemap?1:0,width:n.width,height:n.height,format:n.format,cubemap:n.cubemap,levels:n.levels});return r.upload(),r}parse(t){var e=new Uint32Array(t,0,16);if(Lo[0]!==e[0]||Lo[1]!==e[1]||Lo[2]!==e[2])return null;var i={endianness:e[3],glType:e[4],glTypeSize:e[5],glFormat:e[6],glInternalFormat:e[7],glBaseInternalFormat:e[8],pixelWidth:e[9],pixelHeight:e[10],pixelDepth:e[11],numberOfArrayElements:e[12],numberOfFaces:e[13],numberOfMipmapLevels:e[14],bytesOfKeyValueData:e[15]};if(i.pixelDepth>1)return null;if(i.numberOfArrayElements>1)return null;if(0!==i.glFormat)return null;if(!No[i.glInternalFormat])return null;for(var n=64+i.bytesOfKeyValueData,r=[],s=!1,a=0;a<(i.numberOfMipmapLevels||1);a++){var o=new Uint32Array(t.slice(n,n+4))[0];n+=4;var l=o/(i.numberOfFaces||1);i.numberOfFaces>1&&(s=!0,r.push([]));for(var h=0;h<i.numberOfFaces;h++){var c=new Uint8Array(t,n,l);i.numberOfFaces>1?r[a].push(c):r.push(c),n+=l}n+=3-(n+3)%4}return{format:No[i.glInternalFormat],width:i.pixelWidth,height:i.pixelHeight,levels:r,cubemap:s}}}class Bo{constructor(t){this.maxRetries=0}load(t,e,i){var n={cache:!0,responseType:"arraybuffer",retry:this.maxRetries>0,maxRetries:this.maxRetries};F.get(t.load,n,e)}open(t,e,i){var n,r=new Uint32Array(e,0,32),s=r[4],a=r[3],o=Math.max(r[7],1),l=4===r[20],h=r[21],c=r[22],u=65024===r[28],d=!1,f=!1,p=!1,m=!1,g=!1,v=null;if(l?827611204===h?(v=8,d=!0):894720068===h?(v=10,d=!0):116===h?(v=14,f=!0):826496069===h?(v=21,d=!0,p=!0):825438800===h||825504336===h?(v=825438800===h?24:25,d=!0,m=!0):825439312!==h&&825504848!==h||(v=825439312===h?26:27,d=!0,g=!0):32===c&&(v=7),!v)return(n=new pe(i,{width:4,height:4,format:6})).name="dds-legacy-empty",n;n=new pe(i,{name:t,addressU:u?1:0,addressV:u?1:0,width:s,height:a,format:v,cubemap:u});for(var _,y=128,b=u?6:1,x=827611204===h?8:16,w=0;w<b;w++)for(var A=s,C=a,I=0;I<o;I++){_=d?p?Math.floor((A+3)/4)*Math.floor((C+3)/4)*8:m?Math.max(A,16)*Math.max(C,8)/4:g?Math.max(A,8)*Math.max(C,8)/2:Math.floor((A+4-1)/4)*Math.floor((C+4-1)/4)*x:A*C*4;var S=f?new Float32Array(e,y,_):new Uint8Array(e,y,_);u?(n._levels[I]||(n._levels[I]=[]),n._levels[I][w]=S):n._levels[I]=S,y+=f?4*_:_,A=Math.max(.5*A,1),C=Math.max(.5*C,1)}return n.upload(),n}}var Fo={repeat:0,clamp:1,mirror:2},jo={nearest:0,linear:1,nearest_mip_nearest:2,linear_mip_nearest:4,nearest_mip_linear:3,linear_mip_linear:5},Vo={default:"default",rgbm:"rgbm",rgbe:"rgbe",swizzleGGGR:"swizzleGGGR"};class Uo{constructor(t,e,i){this._device=t,this._assets=e,this._loader=i,this.imgParser=new Ro(e),this.parsers={dds:new Bo(e),ktx:new zo(e),basis:new Oo(e)}}get crossOrigin(){return this.imgParser.crossOrigin}set crossOrigin(t){this.imgParser.crossOrigin=t}get maxRetries(){return this.imgParser.maxRetries}set maxRetries(t){for(var e in this.imgParser.maxRetries=t,this.parsers)this.parsers.hasOwnProperty(e)&&(this.parsers[e].maxRetries=t)}_getUrlWithoutParams(t){return t.indexOf("?")>=0?t.split("?")[0]:t}_getParser(t){var e=x.getExtension(this._getUrlWithoutParams(t)).toLowerCase().replace(".","");return this.parsers[e]||this.imgParser}load(t,e,i){"string"==typeof t&&(t={load:t,original:t}),this._getParser(t.original).load(t,e,i)}open(t,e,i){if(t){var n=this._getParser(t).open(t,e,this._device);return null===n?n=new pe(this._device,{width:4,height:4,format:6}):function(t){var e=Math.log2(Math.max(t._width,t._height))+1;if(!(7!==t._format&&14!==t._format||t._volume||t._compressed||1===t._levels.length||t._levels.length===e||(i=t._cubemap?t._levels[0][0]:t._levels[0],i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement))){for(var i,n=function(t,e,i){for(var n=Math.max(1,t>>1),r=Math.max(1,e>>1),s=new i.constructor(n*r*4),a=Math.floor(t/n),o=Math.floor(e/r),l=a*o,h=0;h<r;++h)for(var c=0;c<n;++c)for(var u=0;u<4;++u){for(var d=0,f=0;f<o;++f)for(var p=0;p<a;++p)d+=i[4*(c*a+p+(h*o+f)*t)+u];s[4*(c+h*n)+u]=d/l}return s},r=t._levels.length;r<e;++r){var s=Math.max(1,t._width>>r-1),a=Math.max(1,t._height>>r-1);if(t._cubemap){for(var o=[],l=0;l<6;++l)o.push(n(s,a,t._levels[r-1][l]));t._levels.push(o)}else t._levels.push(n(s,a,t._levels[r-1]))}t._levelsUpdated=t._cubemap?[[!0,!0,!0,!0,!0,!0]]:[!0]}}(n),n}}patch(t,e){var i=t.resource;if(i){t.name&&t.name.length>0&&(i.name=t.name);var n=t.data;if(n.hasOwnProperty("minfilter")&&(i.minFilter=jo[n.minfilter]),n.hasOwnProperty("magfilter")&&(i.magFilter=jo[n.magfilter]),i.cubemap||(n.hasOwnProperty("addressu")&&(i.addressU=Fo[n.addressu]),n.hasOwnProperty("addressv")&&(i.addressV=Fo[n.addressv])),n.hasOwnProperty("mipmaps")&&(i.mipmaps=n.mipmaps),n.hasOwnProperty("anisotropy")&&(i.anisotropy=n.anisotropy),n.hasOwnProperty("flipY")&&(i.flipY=!!n.flipY),n.hasOwnProperty("type"))i.type=Vo[n.type];else if(n.hasOwnProperty("rgbm")&&n.rgbm)i.type="rgbm";else if(t.file&&t.getPreferredFile){var r=t.getPreferredFile();r&&r.opt&&0!=(8&r.opt)&&(i.type="swizzleGGGR")}}}}class Go{constructor(t=null){this._index={},this._key=t}addItem(t){for(var e=t.tags._list,i=0;i<e.length;i++)this.add(e[i],t)}removeItem(t){for(var e=t.tags._list,i=0;i<e.length;i++)this.remove(e[i],t)}add(t,e){this._index[t]&&-1!==this._index[t].list.indexOf(e)||(this._index[t]||(this._index[t]={list:[]},this._key&&(this._index[t].keys={})),this._index[t].list.push(e),this._key&&(this._index[t].keys[e[this._key]]=e))}remove(t,e){if(this._index[t]&&(!this._key||this._index[t].keys[e[this._key]])){var i=this._index[t].list.indexOf(e);-1!==i&&(this._index[t].list.splice(i,1),this._key&&delete this._index[t].keys[e[this._key]],0===this._index[t].list.length&&delete this._index[t])}}find(t){var e,i,n,r,s,a,o,l,h=this,c={},u=[],d=(t,e)=>h._index[t].list.length-h._index[e].list.length;for(e=0;e<t.length;e++){if((s=t[e])instanceof Array){if(0===s.length)continue;if(1!==s.length){for(l=!1,n=0;n<s.length;n++)if(!this._index[s[n]]){l=!0;break}if(l)continue;for(1===(o=(a=s.slice(0).sort(d)).slice(1)).length&&(o=o[0]),i=0;i<this._index[a[0]].list.length;i++)r=this._index[a[0]].list[i],(this._key?!c[r[this._key]]:-1===u.indexOf(r))&&r.tags.has(o)&&(this._key&&(c[r[this._key]]=!0),u.push(r));continue}s=s[0]}if(s&&"string"==typeof s&&this._index[s])for(i=0;i<this._index[s].list.length;i++)r=this._index[s].list[i],this._key?c[r[this._key]]||(c[r[this._key]]=!0,u.push(r)):-1===u.indexOf(r)&&u.push(r)}return u}}class Wo extends v{constructor(t){super(),this._loader=t,this._assets=[],this._cache={},this._names={},this._tags=new Go("_id"),this._urls={},this.prefix=null}list(t){return t=t||{},this._assets.filter((function(e){var i=!0;return void 0!==t.preload&&(i=e.preload===t.preload),i}))}add(t){var e,i=this._assets.push(t)-1;this._cache[t.id]=i,this._names[t.name]||(this._names[t.name]=[]),this._names[t.name].push(i),t.file&&(e=t.file.url,this._urls[e]=i),t.registry=this,this._tags.addItem(t),t.tags.on("add",this._onTagAdd,this),t.tags.on("remove",this._onTagRemove,this),this.fire("add",t),this.fire("add:"+t.id,t),e&&this.fire("add:url:"+e,t),t.preload&&this.load(t)}remove(t){var e=this._cache[t.id],i=t.file?t.file.url:null;if(void 0!==e){this._assets.splice(e,1),delete this._cache[t.id],this._names={},this._urls=[];for(var n=0,r=this._assets.length;n<r;n++){var s=this._assets[n];this._cache[s.id]=n,this._names[s.name]||(this._names[s.name]=[]),this._names[s.name].push(n),s.file&&(this._urls[s.file.url]=n)}return this._tags.removeItem(t),t.tags.off("add",this._onTagAdd,this),t.tags.off("remove",this._onTagRemove,this),t.fire("remove",t),this.fire("remove",t),this.fire("remove:"+t.id,t),i&&this.fire("remove:url:"+i,t),!0}return!1}get(t){var e=this._cache[t];return this._assets[e]}getByUrl(t){var e=this._urls[t];return this._assets[e]}load(t){if(!t.loading&&!t.loaded){var e=this,i=t.getPreferredFile(),n=function(n){n instanceof Array?t.resources=n:t.resource=n,e._loader.patch(t,e),e.fire("load",t),e.fire("load:"+t.id,t),i&&i.url&&e.fire("load:url:"+i.url,t),t.fire("load",t)};if(i||"cubemap"===t.type)this.fire("load:start",t),this.fire("load:"+t.id+":start",t),t.loading=!0,e._loader.load(t.getFileUrl(),t.type,(function(i,r,s){if(t.loaded=!0,t.loading=!1,i)e.fire("error",i,t),e.fire("error:"+t.id,i,t),t.fire("error",i,t);else{if(!eo.legacy&&"script"===t.type){var a=e._loader.getHandler("script");a._cache[t.id]&&a._cache[t.id].parentNode===document.head&&document.head.removeChild(a._cache[t.id]),a._cache[t.id]=s}n(r)}}),t);else{var r=e._loader.open(t.type,t.data);t.loaded=!0,n(r)}}}loadFromUrl(t,e,i){this.loadFromUrlAndFilename(t,null,e,i)}loadFromUrlAndFilename(t,e,i,n){var r=this,s=x.getBasename(e||t),a={filename:e||s,url:t},o=r.getByUrl(t);o||(o=new As(s,i,a),r.add(o));var l=function(t){t.once("load",(function(t){"material"===i?r._loadTextures(t,(function(e,i){n(e,t)})):n(null,t)})),t.once("error",(function(t){n(t)})),r.load(t)};o.resource?n(null,o):"model"===i?r._loadModel(o,l):l(o)}_loadModel(t,e){var i=this,n=t.getFileUrl(),r=x.getExtension(n);if(".json"===r||".glb"===r){var s=x.getDirectory(n),a=x.getBasename(n),o=x.join(s,a.replace(r,".mapping.json"));this._loader.load(o,"json",(function(n,r){n?(t.data={mapping:[]},e(t)):i._loadMaterials(t,r,(function(i,n){t.data=r,e(t)}))}))}else e(t)}_loadMaterials(t,e,i){for(var n=this,r=[],s=0,a=function(t,e){n._loadTextures(e,(function(t,n){r.push(e),r.length===s&&i(null,r)}))},o=0;o<e.mapping.length;o++){var l=e.mapping[o].path;l&&(s++,n.loadFromUrl(t.getAbsoluteUrl(l),"material",a))}0===s&&i(null,r)}_loadTextures(t,e){var i=[],n=0,r=t.data;if("path"===r.mappingFormat){for(var s=function(t,r){t&&console.error(t),i.push(r),i.length===n&&e(null,i)},a=Ea,o=0;o<a.length;o++){var l=r[a[o]];l&&"string"==typeof l&&(n++,this.loadFromUrl(t.getAbsoluteUrl(l),"texture",s))}0===n&&e(null,i)}else e(null,i)}findAll(t,e){var i=this,n=this._names[t];if(n){var r=n.map((function(t){return i._assets[t]}));return e?r.filter((function(t){return t.type===e})):r}return[]}_onTagAdd(t,e){this._tags.add(t,e)}_onTagRemove(t,e){this._tags.remove(t,e)}findByTag(){return this._tags.find(arguments)}filter(t){for(var e=[],i=0,n=this._assets.length;i<n;i++)t(this._assets[i])&&e.push(this._assets[i]);return e}find(t,e){var i=this.findAll(t,e);return i.length>0?i[0]:null}}class Ho{constructor(t){this._assets=t,this._bundleAssets={},this._assetsInBundles={},this._urlsInBundles={},this._fileRequests={},this._assets.on("add",this._onAssetAdded,this),this._assets.on("remove",this._onAssetRemoved,this)}_onAssetAdded(t){if("bundle"===t.type){this._bundleAssets[t.id]=t,this._registerBundleEventListeners(t.id);for(var e=0,i=t.data.assets.length;e<i;e++)this._indexAssetInBundle(t.data.assets[e],t)}else this._assetsInBundles[t.id]&&this._indexAssetFileUrls(t)}_registerBundleEventListeners(t){this._assets.on("load:"+t,this._onBundleLoaded,this),this._assets.on("error:"+t,this._onBundleError,this)}_unregisterBundleEventListeners(t){this._assets.off("load:"+t,this._onBundleLoaded,this),this._assets.off("error:"+t,this._onBundleError,this)}_indexAssetInBundle(t,e){if(this._assetsInBundles[t]){var i=this._assetsInBundles[t];-1===i.indexOf(e)&&i.push(e)}else this._assetsInBundles[t]=[e];var n=this._assets.get(t);n&&this._indexAssetFileUrls(n)}_indexAssetFileUrls(t){var e=this._getAssetFileUrls(t);if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];this._urlsInBundles[r]=this._assetsInBundles[t.id]}}_getAssetFileUrls(t){var e=t.getFileUrl();if(!e)return null;var i=[e=this._normalizeUrl(e)];if("font"===t.type)for(var n=t.data.info.maps.length,r=1;r<n;r++)i.push(e.replace(".png",r+".png"));return i}_normalizeUrl(t){return t&&t.split("?")[0]}_onAssetRemoved(t){if("bundle"===t.type){var e,i;for(i in delete this._bundleAssets[t.id],this._unregisterBundleEventListeners(t.id),this._assetsInBundles){var n=this._assetsInBundles[i];if(-1!==(e=n.indexOf(t))&&(n.splice(e,1),!n.length))for(var r in delete this._assetsInBundles[i],this._urlsInBundles)this._urlsInBundles[r]===n&&delete this._urlsInBundles[r]}this._onBundleError("Bundle "+t.id+" was removed",t)}else if(this._assetsInBundles[t.id]){delete this._assetsInBundles[t.id];for(var s=this._getAssetFileUrls(t),a=0,o=s.length;a<o;a++)delete this._urlsInBundles[s[a]]}}_onBundleLoaded(t){t.resource?requestAnimationFrame(function(){if(this._fileRequests)for(var e in this._fileRequests){var i=this._urlsInBundles[e];if(i&&-1!==i.indexOf(t)){var n=decodeURIComponent(e),r=null;t.resource.hasBlobUrl(n)||(r="Bundle "+t.id+" does not contain URL "+e);for(var s=this._fileRequests[e],a=0,o=s.length;a<o;a++)r?s[a](r):s[a](null,t.resource.getBlobUrl(n));delete this._fileRequests[e]}}}.bind(this)):this._onBundleError("Bundle "+t.id+" failed to load",t)}_onBundleError(t,e){for(var i in this._fileRequests){if(!this._findLoadedOrLoadingBundleForUrl(i)){for(var n=this._fileRequests[i],r=0,s=n.length;r<s;r++)n[r](t);delete this._fileRequests[i]}}}_findLoadedOrLoadingBundleForUrl(t){var e=this._urlsInBundles[t];if(!e)return null;var i,n=e.length;for(i=0;i<n;i++)if(e[i].loaded&&e[i].resource)return e[i];for(i=0;i<n;i++)if(e[i].loading)return e[i];return null}listBundlesForAsset(t){return this._assetsInBundles[t.id]||null}list(){var t=[];for(var e in this._bundleAssets)t.push(this._bundleAssets[e]);return t}hasUrl(t){return!!this._urlsInBundles[t]}canLoadUrl(t){return!!this._findLoadedOrLoadingBundleForUrl(t)}loadUrl(t,e){var i=this._findLoadedOrLoadingBundleForUrl(t);if(i)if(i.loaded){var n=decodeURIComponent(t);if(!i.resource.hasBlobUrl(n))return void e("Bundle "+i.id+" does not contain URL "+t);e(null,i.resource.getBlobUrl(n))}else this._fileRequests.hasOwnProperty(t)?this._fileRequests[t].push(e):this._fileRequests[t]=[e];else e("URL "+t+" not found in any bundles")}destroy(){for(var t in this._assets.off("add",this._onAssetAdded,this),this._assets.off("remove",this._onAssetRemoved,this),this._bundleAssets)this._unregisterBundleEventListeners(t);this._assets=null,this._bundleAssets=null,this._assetsInBundles=null,this._urlsInBundles=null,this._fileRequests=null}}class Xo extends v{constructor(t){super(),this.list=function(){return this._list},this.app=t,this._scripts={},this._list=[]}destroy(){this.app=null,this.off()}add(t){var e=this,i=t.__name;return this._scripts.hasOwnProperty(i)?(setTimeout((function(){if(t.prototype.swap){var n=e._scripts[i],r=e._list.indexOf(n);e._list[r]=t,e._scripts[i]=t,e.fire("swap",i,t),e.fire("swap:"+i,t)}else console.warn("script registry already has '"+i+"' script, define 'swap' method for new script type to enable code hot swapping")})),!1):(this._scripts[i]=t,this._list.push(t),this.fire("add",i,t),this.fire("add:"+i,t),setTimeout((function(){if(e._scripts.hasOwnProperty(i)&&e.app&&e.app.systems&&e.app.systems.script){var t,n,r,s=e.app.systems.script._components,a=[],o=[];for(s.loopIndex=0;s.loopIndex<s.length;s.loopIndex++){var l=s.items[s.loopIndex];l._scriptsIndex[i]&&l._scriptsIndex[i].awaiting&&(l._scriptsData&&l._scriptsData[i]&&(r=l._scriptsData[i].attributes),(n=l.create(i,{preloading:!0,ind:l._scriptsIndex[i].ind,attributes:r}))&&a.push(n))}for(t=0;t<a.length;t++)a[t].__initializeAttributes();for(t=0;t<a.length;t++)a[t].enabled&&(a[t]._initialized=!0,o.push(a[t]),a[t].initialize&&a[t].initialize());for(t=0;t<o.length;t++)o[t].enabled&&!o[t]._postInitialized&&(o[t]._postInitialized=!0,o[t].postInitialize&&o[t].postInitialize())}})),!0)}remove(t){var e=t,i=t;if("string"!=typeof i?i=e.__name:e=this.get(i),this.get(i)!==e)return!1;delete this._scripts[i];var n=this._list.indexOf(e);return this._list.splice(n,1),this.fire("remove",i,e),this.fire("remove:"+i,e),!0}get(t){return this._scripts[t]||null}has(t){if("string"==typeof t)return this._scripts.hasOwnProperty(t);if(!t)return!1;var e=t.__name;return this._scripts[e]===t}}class Zo extends v{constructor(t,e){super();var i=this;this._app=t,this._device=t.graphicsDevice,this.id=e.displayId,this._frameData=null,window.VRFrameData&&(this._frameData=new window.VRFrameData),this.display=e,this._camera=null,this.sitToStandInv=new Q,this.leftView=new Q,this.leftProj=new Q,this.leftViewInv=new Q,this.leftPos=new H,this.rightView=new Q,this.rightProj=new Q,this.rightViewInv=new Q,this.rightPos=new H,this.combinedPos=new H,this.combinedView=new Q,this.combinedProj=new Q,this.combinedViewInv=new Q,this.combinedFov=0,this.combinedAspect=0,this.presenting=!1,i._presentChange=function(t){if((t.display?t.display:t.detail&&t.detail.display?t.detail.display:t.detail&&t.detail.vrdisplay?t.detail.vrdisplay:i.display)===i.display){if(i.presenting=i.display&&i.display.isPresenting,i.presenting){var e=i.display.getEyeParameters("left"),n=i.display.getEyeParameters("right"),r=2*Math.max(e.renderWidth,n.renderWidth),s=Math.max(e.renderHeight,n.renderHeight);i._app.graphicsDevice.setResolution(r,s),i._app._allowResize=!1}else i._app.setCanvasResolution("AUTO"),i._app._allowResize=!0;i.fire("beforepresentchange",i),i.fire("presentchange",i)}},window.addEventListener("vrdisplaypresentchange",i._presentChange,!1)}destroy(){window.removeEventListener("vrdisplaypresentchange",self._presentChange),this._camera&&(this._camera.vrDisplay=null),this._camera=null}poll(){if(this.display){this.display.getFrameData(this._frameData),this.leftProj.data=this._frameData.leftProjectionMatrix,this.rightProj.data=this._frameData.rightProjectionMatrix;var t=this.display.stageParameters;t?(this.sitToStandInv.set(t.sittingToStandingTransform).invert(),this.combinedView.set(this._frameData.leftViewMatrix),this.leftView.mul2(this.combinedView,this.sitToStandInv),this.combinedView.set(this._frameData.rightViewMatrix),this.rightView.mul2(this.combinedView,this.sitToStandInv)):(this.leftView.set(this._frameData.leftViewMatrix),this.rightView.set(this._frameData.rightViewMatrix));var e=this.leftProj.data[3]+this.leftProj.data[0],i=this.leftProj.data[11]+this.leftProj.data[8],n=1/Math.sqrt(e*e+i*i);e*=n,i*=n;var r=-Math.atan2(i,e);e=this.rightProj.data[3]+this.rightProj.data[0],i=this.rightProj.data[11]+this.rightProj.data[8],e*=n=1/Math.sqrt(e*e+i*i),i*=n,r=Math.max(r,-Math.atan2(i,e)),r*=2,this.combinedFov=r;var s=this.rightProj.data[5]/this.rightProj.data[0];this.combinedAspect=s;var a=this.combinedView;a.copy(this.leftView),a.invert(),this.leftViewInv.copy(a);var o=this.combinedPos;o.x=this.leftPos.x=a.data[12],o.y=this.leftPos.y=a.data[13],o.z=this.leftPos.z=a.data[14],a.copy(this.rightView),a.invert(),this.rightViewInv.copy(a);var l=o.x-a.data[12],h=o.y-a.data[13],c=o.z-a.data[14],u=Math.sqrt(l*l+h*h+c*c);this.rightPos.x=a.data[12],this.rightPos.y=a.data[13],this.rightPos.z=a.data[14],o.x+=a.data[12],o.y+=a.data[13],o.z+=a.data[14],o.x*=.5,o.y*=.5,o.z*=.5;var d=.5*Math.PI,f=.5*r,p=Math.PI-(d+f),m=.5*u*Math.sin(p),g=a.data[8],v=a.data[9],_=a.data[10];a.data[12]=o.x+g*m,a.data[13]=o.y+v*m,a.data[14]=o.z+_*m,this.combinedViewInv.copy(a),a.invert(),this.combinedProj.setPerspective(r*k.RAD_TO_DEG,s,this.display.depthNear+m,this.display.depthFar+m,!0)}}requestPresent(t){this.display?this.presenting?t&&t(new Error("VrDisplay already presenting")):this.display.requestPresent([{source:this._device.canvas}]).then((function(){t&&t()}),(function(e){t&&t(e)})):t&&t(new Error("No VrDisplay to requestPresent"))}exitPresent(t){this.display||t&&t(new Error("No VrDisplay to exitPresent")),this.presenting?this.display.exitPresent().then((function(){t&&t()}),(function(){t&&t(new Error("exitPresent failed"))})):t&&t(new Error("VrDisplay not presenting"))}requestAnimationFrame(t){this.display&&this.display.requestAnimationFrame(t)}submitFrame(){this.display&&this.display.submitFrame()}reset(){this.display&&this.display.resetPose()}setClipPlanes(t,e){this.display&&(this.display.depthNear=t,this.display.depthFar=e)}getFrameData(){if(this.display)return this._frameData}get capabilities(){return this.display?this.display.capabilities:{}}}class Yo extends v{constructor(t){var e=this;this.isSupported=Yo.isSupported,this._index={},this.displays=[],this.display=null,this._app=t,this._onDisplayConnect=this._onDisplayConnect.bind(this),this._onDisplayDisconnect=this._onDisplayDisconnect.bind(this),e._attach(),this._getDisplays((function(t,i){if(t)e.fire("error",t);else{for(var n=0;n<i.length;n++)e._addDisplay(i[n]);e.fire("ready",e.displays)}}))}_attach(){window.addEventListener("vrdisplayconnect",this._onDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onDisplayDisconnect)}_detach(){window.removeEventListener("vrdisplayconnect",this._onDisplayConnect),window.removeEventListener("vrdisplaydisconnect",this._onDisplayDisconnect)}destroy(){this._detach()}poll(){var t=this.displays.length;if(t)for(var e=0;e<t;e++)this.displays[e]._camera&&this.displays[e].poll()}_getDisplays(t){navigator.getVRDisplays?navigator.getVRDisplays().then((function(e){t&&t(null,e)})):t&&t(new Error("WebVR not supported"))}_addDisplay(t){if(!this._index[t.displayId]){var e=new Zo(this._app,t);this._index[e.id]=e,this.displays.push(e),this.display||(this.display=e),this.fire("displayconnect",e)}}_onDisplayConnect(t){t.detail&&t.detail.display?this._addDisplay(t.detail.display):this._addDisplay(t.display)}_onDisplayDisconnect(t){var e;e=t.detail&&t.detail.display?t.detail.display.displayId:t.display.displayId;var i=this._index[e];if(i){i.destroy(),delete this._index[i.id];var n=this.displays.indexOf(i);this.displays.splice(n,1),this.display===i&&(this.displays.length?this.display=this.displays[0]:this.display=null),this.fire("displaydisconnect",i)}}}Yo.isSupported="undefined"!=typeof navigator&&!!navigator.getVRDisplays;const qo="immersive-ar";var Ko=[],Jo=[];class Qo extends v{constructor(t,e,i){super(),this.manager=t,this._xrHitTestSource=e,this._transient=i}remove(){if(this._xrHitTestSource){var t=this.manager.hitTest.sources,e=t.indexOf(this);-1!==e&&t.splice(e,1),this.onStop()}}onStop(){this._xrHitTestSource.cancel(),this._xrHitTestSource=null,this.fire("remove"),this.manager.hitTest.fire("remove",this)}update(t){if(this._transient)for(var e=t.getHitTestResultsForTransientInput(this._xrHitTestSource),i=0;i<e.length;i++){var n,r=e[i];r.inputSource&&(n=this.manager.input._getByInputSource(r.inputSource)),this.updateHitResults(r.results,n)}else this.updateHitResults(t.getHitTestResults(this._xrHitTestSource))}updateHitResults(t,e){for(var i=0;i<t.length;i++){var n=t[i].getPose(this.manager._referenceSpace),r=Ko.pop();r||(r=new H),r.copy(n.transform.position);var s=Jo.pop();s||(s=new $),s.copy(n.transform.orientation),this.fire("result",r,s,e),this.manager.hitTest.fire("result",this,r,s,e),Ko.push(r),Jo.push(s)}}}class $o extends v{constructor(t){super(),this.manager=t,this._supported=!(!window.XRSession||!window.XRSession.prototype.requestHitTestSource),this._session=null,this.sources=[],this._supported&&(this.manager.on("start",this._onSessionStart,this),this.manager.on("end",this._onSessionEnd,this))}_onSessionStart(){this.manager.type===qo&&(this._session=this.manager.session)}_onSessionEnd(){if(this._session){this._session=null;for(var t=0;t<this.sources.length;t++)this.sources[t].onStop();this.sources=[]}}isAvailable(t,e){var i;return this._supported||(i=new Error("XR HitTest is not supported")),this._session||(i=new Error("XR Session is not started (1)")),this.manager.type!==qo&&(i=new Error("XR HitTest is available only for AR")),!i||(t&&t(i),e&&e.fire("error",i),!1)}start(t){var e=this;if(t=t||{},this.isAvailable(t.callback,this)){var i;t.profile||t.spaceType||(t.spaceType="viewer");var n=t.offsetRay;n&&(i=new XRRay(new DOMPoint(n.origin.x,n.origin.y,n.origin.z),new DOMPoint(n.direction.x,n.direction.y,n.direction.z)));var r=t.callback;t.spaceType?this._session.requestReferenceSpace(t.spaceType).then((function(n){if(!e._session){var s=new Error("XR Session is not started (2)");return r&&r(s),void e.fire("error",s)}e._session.requestHitTestSource({space:n,entityTypes:t.entityTypes||void 0,offsetRay:i}).then((function(t){e._onHitTestSource(t,!1,r)})).catch((function(t){r&&r(t),e.fire("error",t)}))})).catch((function(t){r&&r(t),e.fire("error",t)})):this._session.requestHitTestSourceForTransientInput({profile:t.profile,entityTypes:t.entityTypes||void 0,offsetRay:i}).then((function(t){e._onHitTestSource(t,!0,r)})).catch((function(t){r&&r(t),e.fire("error",t)}))}}_onHitTestSource(t,e,i){if(!this._session){t.cancel();var n=new Error("XR Session is not started (3)");return i&&i(n),void this.fire("error",n)}var r=new Qo(this.manager,t,e);this.sources.push(r),i&&i(null,r),this.fire("add",r)}update(t){for(var e=0;e<this.sources.length;e++)this.sources[e].update(t)}get supported(){return this._supported}}class tl{constructor(t,e){this._index=t,this._hand=e,this._hand._fingers.push(this),this._joints=[],this._tip=null}get index(){return this._index}get hand(){return this._hand}get joints(){return this._joints}get tip(){return this._tip}}for(var el=window.XRHand?[XRHand.THUMB_PHALANX_TIP,XRHand.INDEX_PHALANX_TIP,XRHand.MIDDLE_PHALANX_TIP,XRHand.RING_PHALANX_TIP,XRHand.LITTLE_PHALANX_TIP]:[],il={},nl=0;nl<el.length;nl++)il[el[nl]]=!0;class rl{constructor(t,e,i,n=null){this._index=t,this._id=e,this._hand=i,this._hand._joints.push(this),this._hand._jointsById[e]=this,this._finger=n,this._finger&&this._finger._joints.push(this),this._wrist=e===XRHand.WRIST,this._wrist&&(this._hand._wrist=this),this._tip=this._finger&&!!il[e],this._tip&&(this._hand._tips.push(this),this._finger&&(this._finger._tip=this)),this._radius=null,this._localTransform=new Q,this._worldTransform=new Q,this._localPosition=new H,this._localRotation=new $,this._position=new H,this._rotation=new $,this._dirtyLocal=!0}update(t){this._dirtyLocal=!0,this._radius=t.radius,this._localPosition.copy(t.transform.position),this._localRotation.copy(t.transform.orientation)}_updateTransforms(){this._dirtyLocal&&(this._dirtyLocal=!1,this._localTransform.setTRS(this._localPosition,this._localRotation,H.ONE));var t=this._hand._manager.camera.parent;t?this._worldTransform.mul2(t.getWorldTransform(),this._localTransform):this._worldTransform.copy(this._localTransform)}getPosition(){return this._updateTransforms(),this._worldTransform.getTranslation(this._position),this._position}getRotation(){return this._updateTransforms(),this._rotation.setFromMat4(this._worldTransform),this._rotation}get index(){return this._index}get hand(){return this._hand}get finger(){return this._finger}get wrist(){return this._wrist}get tip(){return this._tip}get radius(){return this._radius||.005}}var sl=[],al=new H,ol=new H,ll=new H;window.XRHand&&(sl=[[XRHand.THUMB_METACARPAL,XRHand.THUMB_PHALANX_PROXIMAL,XRHand.THUMB_PHALANX_DISTAL,XRHand.THUMB_PHALANX_TIP],[XRHand.INDEX_METACARPAL,XRHand.INDEX_PHALANX_PROXIMAL,XRHand.INDEX_PHALANX_INTERMEDIATE,XRHand.INDEX_PHALANX_DISTAL,XRHand.INDEX_PHALANX_TIP],[XRHand.MIDDLE_METACARPAL,XRHand.MIDDLE_PHALANX_PROXIMAL,XRHand.MIDDLE_PHALANX_INTERMEDIATE,XRHand.MIDDLE_PHALANX_DISTAL,XRHand.MIDDLE_PHALANX_TIP],[XRHand.RING_METACARPAL,XRHand.RING_PHALANX_PROXIMAL,XRHand.RING_PHALANX_INTERMEDIATE,XRHand.RING_PHALANX_DISTAL,XRHand.RING_PHALANX_TIP],[XRHand.LITTLE_METACARPAL,XRHand.LITTLE_PHALANX_PROXIMAL,XRHand.LITTLE_PHALANX_INTERMEDIATE,XRHand.LITTLE_PHALANX_DISTAL,XRHand.LITTLE_PHALANX_TIP]]);class hl extends v{constructor(t){super(),this.update=function(t){for(var e=this._inputSource._xrInputSource,i=0;i<this._joints.length;i++){var n=this._joints[i],r=e.hand[n._id];if(r){var s=t.getJointPose(r,this._manager._referenceSpace);if(s)n.update(s),n.wrist&&!this._tracking&&(this._tracking=!0,this.fire("tracking"));else if(n.wrist){this._tracking&&(this._tracking=!1,this.fire("trackinglost"));break}}}var a=this._jointsById[XRHand.THUMB_METACARPAL],o=this._jointsById[XRHand.THUMB_PHALANX_TIP],l=this._jointsById[XRHand.INDEX_PHALANX_PROXIMAL],h=this._jointsById[XRHand.INDEX_PHALANX_TIP],c=this._jointsById[XRHand.RING_PHALANX_PROXIMAL],u=this._jointsById[XRHand.LITTLE_PHALANX_PROXIMAL];if(a&&o&&l&&h&&c&&u){this._inputSource._dirtyRay=!0,this._inputSource._rayLocal.origin.lerp(o._localPosition,h._localPosition,.5);var d=a,f=u;if("left"===this._inputSource.handedness){var p=d;d=f,f=p}al.sub2(d._localPosition,this._wrist._localPosition),ol.sub2(f._localPosition,this._wrist._localPosition),ll.cross(al,ol).normalize(),al.lerp(l._localPosition,c._localPosition,.5),al.sub(this._wrist._localPosition).normalize(),this._inputSource._rayLocal.direction.lerp(ll,al,.5).normalize()}this._fingerIsClosed(1)&&this._fingerIsClosed(2)&&this._fingerIsClosed(3)&&this._fingerIsClosed(4)?this._inputSource._squeezing||(this._inputSource._squeezing=!0,this._inputSource.fire("squeezestart"),this._manager.input.fire("squeezestart",this._inputSource)):this._inputSource._squeezing&&(this._inputSource._squeezing=!1,this._inputSource.fire("squeeze"),this._manager.input.fire("squeeze",this._inputSource),this._inputSource.fire("squeezeend"),this._manager.input.fire("squeezeend",this._inputSource))};var e=t._xrInputSource.hand;this._manager=t._manager,this._inputSource=t,this._tracking=!1,this._fingers=[],this._joints=[],this._jointsById={},this._tips=[],this._wrist=null,e[XRHand.WRIST]&&(this._wrist=new rl(0,XRHand.WRIST,this,null));for(var i=0;i<sl.length;i++)for(var n=new tl(i,this),r=0;r<sl[i].length;r++){var s=sl[i][r];e[s]&&new rl(r,s,this,n)}}_fingerIsClosed(t){var e=this._fingers[t];return al.sub2(e.joints[0]._localPosition,e.joints[1]._localPosition).normalize(),ol.sub2(e.joints[2]._localPosition,e.joints[3]._localPosition).normalize(),al.dot(ol)<-.8}getJointById(t){return this._jointsById[t]||null}get fingers(){return this._fingers}get joints(){return this._joints}get tips(){return this._tips}get wrist(){return this._wrist}get tracking(){return this._tracking}}var cl=new $,ul=0;class dl extends v{constructor(t,e){super(),this._updateRayTransforms=function(){var t=this._dirtyRay;if(this._dirtyRay=!1,this._manager.camera.parent){var e=this._manager.camera.parent.getWorldTransform();e.getTranslation(this._position),this._rotation.setFromMat4(e),this._rotation.transformVector(this._rayLocal.origin,this._ray.origin),this._ray.origin.add(this._position),this._rotation.transformVector(this._rayLocal.direction,this._ray.direction)}else t&&(this._ray.origin.copy(this._rayLocal.origin),this._ray.direction.copy(this._rayLocal.direction))},this.getLocalRotation=function(){return this._localRotation},this.getOrigin=function(){return this._updateRayTransforms(),this._ray.origin},this._id=++ul,this._manager=t,this._xrInputSource=e,this._ray=new dt,this._rayLocal=new dt,this._grip=!1,this._hand=null,e.hand&&(this._hand=new hl(this)),this._localTransform=null,this._worldTransform=null,this._position=new H,this._rotation=new $,this._localPosition=null,this._localRotation=null,this._dirtyLocal=!0,this._selecting=!1,this._squeezing=!1,this._elementInput=!0,this._elementEntity=null,this._hitTestSources=[]}update(t){if(this._hand)this._hand.update(t);else{if(this._xrInputSource.gripSpace){var e=t.getPose(this._xrInputSource.gripSpace,this._manager._referenceSpace);e&&(this._grip||(this._grip=!0,this._localTransform=new Q,this._worldTransform=new Q,this._localPosition=new H,this._localRotation=new $),this._dirtyLocal=!0,this._localPosition.copy(e.transform.position),this._localRotation.copy(e.transform.orientation))}var i=t.getPose(this._xrInputSource.targetRaySpace,this._manager._referenceSpace);i&&(this._dirtyRay=!0,this._rayLocal.origin.copy(i.transform.position),this._rayLocal.direction.set(0,0,-1),cl.copy(i.transform.orientation),cl.transformVector(this._rayLocal.direction,this._rayLocal.direction))}}_updateTransforms(){this._dirtyLocal&&(this._dirtyLocal=!1,this._localTransform.setTRS(this._localPosition,this._localRotation,H.ONE));var t=this._manager.camera.parent;t?this._worldTransform.mul2(t.getWorldTransform(),this._localTransform):this._worldTransform.copy(this._localTransform)}getPosition(){return this._position?(this._updateTransforms(),this._worldTransform.getTranslation(this._position),this._position):null}getLocalPosition(){return this._localPosition}getRotation(){return this._rotation?(this._updateTransforms(),this._rotation.setFromMat4(this._worldTransform),this._rotation):null}getDirection(){return this._updateRayTransforms(),this._ray.direction}hitTestStart(t={}){var e=this;t.profile=this._xrInputSource.profiles[0];var i=t.callback;t.callback=function(t,n){n&&e.onHitTestSourceAdd(n),i&&i(t,n)},this._manager.hitTest.start(t)}onHitTestSourceAdd(t){this._hitTestSources.push(t),this.fire("hittest:add",t),t.on("result",(function(e,i,n){n===this&&this.fire("hittest:result",t,e,i)}),this),t.once("remove",(function(){this.onHitTestSourceRemove(t),this.fire("hittest:remove",t)}),this)}onHitTestSourceRemove(t){var e=this._hitTestSources.indexOf(t);-1!==e&&this._hitTestSources.splice(e,1)}get id(){return this._id}get inputSource(){return this._xrInputSource}get targetRayMode(){return this._xrInputSource.targetRayMode}get handedness(){return this._xrInputSource.handedness}get profiles(){return this._xrInputSource.profiles}get grip(){return this._grip}get hand(){return this._hand}get gamepad(){return this._xrInputSource.gamepad||null}get selecting(){return this._selecting}get squeezing(){return this._squeezing}get elementInput(){return this._elementInput}set elementInput(t){this._elementInput!==t&&(this._elementInput=t,this._elementInput||(this._elementEntity=null))}get elementEntity(){return this._elementEntity}get hitTestSources(){return this._hitTestSources}}class fl extends v{constructor(t){super();var e=this;this.manager=t,this._session=null,this._inputSources=[],this._onInputSourcesChangeEvt=function(t){e._onInputSourcesChange(t)},this.manager.on("start",this._onSessionStart,this),this.manager.on("end",this._onSessionEnd,this)}_onSessionStart(){this._session=this.manager.session,this._session.addEventListener("inputsourceschange",this._onInputSourcesChangeEvt);var t=this;this._session.addEventListener("select",(function(e){var i=t._getByInputSource(e.inputSource);i.update(e.frame),i.fire("select",e),t.fire("select",i,e)})),this._session.addEventListener("selectstart",(function(e){var i=t._getByInputSource(e.inputSource);i.update(e.frame),i._selecting=!0,i.fire("selectstart",e),t.fire("selectstart",i,e)})),this._session.addEventListener("selectend",(function(e){var i=t._getByInputSource(e.inputSource);i.update(e.frame),i._selecting=!1,i.fire("selectend",e),t.fire("selectend",i,e)})),this._session.addEventListener("squeeze",(function(e){var i=t._getByInputSource(e.inputSource);i.update(e.frame),i.fire("squeeze",e),t.fire("squeeze",i,e)})),this._session.addEventListener("squeezestart",(function(e){var i=t._getByInputSource(e.inputSource);i.update(e.frame),i._squeezing=!0,i.fire("squeezestart",e),t.fire("squeezestart",i,e)})),this._session.addEventListener("squeezeend",(function(e){var i=t._getByInputSource(e.inputSource);i.update(e.frame),i._squeezing=!1,i.fire("squeezeend",e),t.fire("squeezeend",i,e)}));for(var e=this._session.inputSources,i=0;i<e.length;i++)this._addInputSource(e[i])}_onSessionEnd(){for(var t=this._inputSources.length;t--;){var e=this._inputSources[t];this._inputSources.splice(t,1),e.fire("remove"),this.fire("remove",e)}this._session.removeEventListener("inputsourceschange",this._onInputSourcesChangeEvt),this._session=null}_onInputSourcesChange(t){var e;for(e=0;e<t.removed.length;e++)this._removeInputSource(t.removed[e]);for(e=0;e<t.added.length;e++)this._addInputSource(t.added[e])}_getByInputSource(t){for(var e=0;e<this._inputSources.length;e++)if(this._inputSources[e].inputSource===t)return this._inputSources[e];return null}_addInputSource(t){if(!this._getByInputSource(t)){var e=new dl(this.manager,t);this._inputSources.push(e),this.fire("add",e)}}_removeInputSource(t){for(var e=0;e<this._inputSources.length;e++)if(this._inputSources[e].inputSource===t){var i=this._inputSources[e];this._inputSources.splice(e,1);for(var n=i.hitTestSources.length;n--;)i.hitTestSources[n].remove();return i.fire("remove"),void this.fire("remove",i)}}update(t){for(var e=0;e<this._inputSources.length;e++)this._inputSources[e].update(t)}get inputSources(){return this._inputSources}}var pl=new H,ml=new H,gl=new Q,vl=new Q;class _l extends v{constructor(t){super(),this._manager=t,this._supported=!1,this._available=!1,this._lightProbeRequested=!1,this._lightProbe=null,this._intensity=0,this._rotation=new $,this._color=new D,this._sphericalHarmonics=new Float32Array(27),this._manager.on("start",this._onSessionStart,this),this._manager.on("end",this._onSessionEnd,this)}_onSessionStart(){!!this._manager.session.requestLightProbe&&(this._supported=!0)}_onSessionEnd(){this._supported=!1,this._available=!1,this._lightProbeRequested=!1,this._lightProbe=null}start(){var t;if(this._manager.session||(t=new Error("XR session is not running")),t||this._manager.type===qo||(t=new Error("XR session type is not AR")),t||this._supported||(t=new Error("light-estimation is not supported")),(!t&&this._lightProbe||this._lightProbeRequested)&&(t=new Error("light estimation is already requested")),t)this.fire("error",t);else{var e=this;this._lightProbeRequested=!0,this._manager.session.requestLightProbe().then((function(t){var i=e._lightProbeRequested;e._lightProbeRequested=!1,e._manager.active?i&&(e._lightProbe=t):e.fire("error",new Error("XR session is not active"))})).catch((function(t){e._lightProbeRequested=!1,e.fire("error",t)}))}}end(){this._lightProbeRequested=!1,this._lightProbe=null,this._available=!1}update(t){if(this._lightProbe){var e=t.getLightEstimate(this._lightProbe);if(e){this._available||(this._available=!0,this.fire("available"));var i=e.primaryLightIntensity;this._intensity=Math.max(1,Math.max(i.x,Math.max(i.y,i.z))),pl.copy(i).scale(1/this._intensity),this._color.set(pl.x,pl.y,pl.z),pl.set(0,0,0),ml.copy(e.primaryLightDirection),gl.setLookAt(ml,pl,H.UP),vl.setFromAxisAngle(H.RIGHT,90),gl.mul(vl),this._rotation.setFromMat4(gl),this._sphericalHarmonics.set(e.sphericalHarmonicsCoefficients)}}}get supported(){return this._supported}get available(){return this._available}get intensity(){return this._available?this._intensity:null}get color(){return this._available?this._color:null}get rotation(){return this._available?this._rotation:null}get sphericalHarmonics(){return this._available?this._sphericalHarmonics:null}}class yl extends v{constructor(t,e){super(),this.destroy=function(){this._image=null,this._pose=null,this._bitmap&&(this._bitmap.close(),this._bitmap=null)},this.getRotation=function(){return this._pose&&this._rotation.copy(this._pose.transform.orientation),this._rotation},this._image=t,this._bitmap=null,this._width=e,this._measuredWidth=0,this._trackable=!1,this._tracking=!1,this._emulated=!1,this._pose=null,this._position=new H,this._rotation=new $}prepare(){var t=this;return this._bitmap?{image:this._bitmap,widthInMeters:this._width}:createImageBitmap(this._image).then((function(e){return t._bitmap=e,{image:t._bitmap,widthInMeters:t._width}}))}getPosition(){return this._pose&&this._position.copy(this._pose.transform.position),this._position}get image(){return this._image}get width(){return this._width}set width(t){this._width=t}get trackable(){return this._trackable}get tracking(){return this._tracking}get emulated(){return this._emulated}}class bl extends v{constructor(t){super(),this._manager=t,this._supported=!!window.XRImageTrackingResult,this._available=!1,this._images=[],this._supported&&(this._manager.on("start",this._onSessionStart,this),this._manager.on("end",this._onSessionEnd,this))}add(t,e){if(!this._supported||this._manager.active)return null;var i=new yl(t,e);return this._images.push(i),i}remove(t){if(!this._manager.active){var e=this._images.indexOf(t);-1!==e&&(t.destroy(),this._images.splice(e,1))}}_onSessionStart(){var t=this;this._manager.session.getTrackedImageScores().then((function(e){t._available=!0;for(var i=0;i<e.length;i++)t._images[i]._trackable="trackable"===e[i]})).catch((function(e){t._available=!1,t.fire("error",e)}))}_onSessionEnd(){this._available=!1;for(var t=0;t<this._images.length;t++)this._images[t]._pose=null,this._images[t]._measuredWidth=0,this._images[t]._tracking&&(this._images[t]._tracking=!1,this._images[t].fire("untracked"))}prepareImages(t){this._images.length?Promise.all(this._images.map((function(t){return t.prepare()}))).then((function(e){t(null,e)})).catch((function(e){t(e,null)})):t(null,null)}update(t){if(this._available){var e,i=t.getImageTrackingResults(),n={};for(e=0;e<i.length;e++){n[i[e].index]=i[e];var r=this._images[i[e].index];r._emulated="emulated"===i[e].trackingState,r._measuredWidth=i[e].measuredWidthInMeters,r._dirtyTransform=!0,r._pose=t.getPose(i[e].imageSpace,this._manager._referenceSpace)}for(e=0;e<this._images.length;e++)this._images[e]._tracking&&!n[e]?(this._images[e]._tracking=!1,this._images[e].fire("untracked")):!this._images[e]._tracking&&n[e]&&(this._images[e]._tracking=!0,this._images[e].fire("tracked"))}}get supported(){return this._supported}get available(){return this._available}get images(){return this._images}}class xl{constructor(t){this._manager=t,this._supported=!!window.XRDOMOverlayState,this._root=null}get supported(){return this._supported}get available(){return this._supported&&this._manager.active&&null!==this._manager._session.domOverlayState}get state(){return this._supported&&this._manager.active&&this._manager._session.domOverlayState?this._manager._session.domOverlayState.type:null}set root(t){this._supported&&!this._manager.active&&(this._root=t)}get root(){return this._root}}class wl extends v{constructor(t){super(),this._manager=t,this._depthInfo=null,this._available=!1,this._matrixDirty=!1,this._matrix=new Q,this._emptyBuffer=new Uint8Array(32),this._depthBuffer=null,this._texture=new pe(this._manager.app.graphicsDevice,{format:2,mipmaps:!1,addressU:1,addressV:1,minFilter:1,magFilter:1}),this._manager.on("end",this._onSessionEnd,this)}_onSessionEnd(){this._depthInfo=null,this._available&&(this._available=!1,this.fire("unavailable")),this._depthBuffer=null,this._texture._width=4,this._texture._height=4,this._texture._levels[0]=this._emptyBuffer,this._texture.upload()}_updateTexture(){if(this._depthInfo){var t=!1;this._depthInfo.width===this._texture.width&&this._depthInfo.height===this._texture.height||(this._texture._width=this._depthInfo.width,this._texture._height=this._depthInfo.height,this._matrixDirty=!0,t=!0);var e=this._depthInfo.data;this._depthBuffer=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this._texture._levels[0]=this._depthBuffer,this._texture.upload(),t&&this.fire("resize",this._depthInfo.width,this._depthInfo.height)}else this._depthBuffer&&(this._depthBuffer=null,this._texture._width=4,this._texture._height=4,this._texture._levels[0]=this._emptyBuffer,this._texture.upload())}update(t,e){e?(this._depthInfo||(this._matrixDirty=!0),this._depthInfo=t.getDepthInformation(e)):(this._depthInfo&&(this._matrixDirty=!0),this._depthInfo=null),this._updateTexture(),this._matrixDirty&&(this._matrixDirty=!1,this._depthInfo?this._matrix.data.set(this._depthInfo.normTextureFromNormView.matrix):this._matrix.setIdentity()),this._depthInfo&&!this._available?(this._available=!0,this.fire("available")):!this._depthInfo&&this._available&&(this._available=!1,this.fire("unavailable"))}getDepth(t,e){return this._depthInfo?this._depthInfo.getDepth(t,e):null}get supported(){return!!window.XRDepthInformation}get available(){return this._available}get width(){return this._depthInfo&&this._depthInfo.width||0}get height(){return this._depthInfo&&this._depthInfo.height||0}get texture(){return this._texture}get uvMatrix(){return this._matrix}}class Al extends v{constructor(t){super();var e=this;this.app=t,this._supported=!!navigator.xr,this._available={},this._available.inline=!1,this._available["immersive-vr"]=!1,this._available[qo]=!1,this._type=null,this._spaceType=null,this._session=null,this._baseLayer=null,this._referenceSpace=null,this.depthSensing=new wl(this),this.domOverlay=new xl(this),this.hitTest=new $o(this),this.imageTracking=new bl(this),this.input=new fl(this),this.lightEstimation=new _l(this),this._camera=null,this.views=[],this.viewsPool=[],this._localPosition=new H,this._localRotation=new $,this._depthNear=.1,this._depthFar=1e3,this._width=0,this._height=0,this._supported&&(navigator.xr.addEventListener("devicechange",(function(){e._deviceAvailabilityCheck()})),this._deviceAvailabilityCheck())}start(t,e,i,n){var r=this,s=n;if("object"==typeof n&&(s=n.callback),this._available[e])if(this._session)s&&s(new Error("XR session is already started"));else{this._camera=t,this._camera.camera.xr=this,this._type=e,this._spaceType=i,this._setClipPlanes(t.nearClip,t.farClip);var a={requiredFeatures:[i],optionalFeatures:[]};e===qo?(a.optionalFeatures.push("light-estimation"),a.optionalFeatures.push("hit-test"),a.optionalFeatures.push("depth-sensing"),n&&n.imageTracking&&a.optionalFeatures.push("image-tracking"),this.domOverlay.root&&(a.optionalFeatures.push("dom-overlay"),a.domOverlay={root:this.domOverlay.root})):"immersive-vr"===e&&a.optionalFeatures.push("hand-tracking"),n&&n.optionalFeatures&&(a.optionalFeatures=a.optionalFeatures.concat(n.optionalFeatures)),this.imageTracking.images.length?this.imageTracking.prepareImages((function(t,n){if(t)return s&&s(t),void r.fire("error",t);null!==n&&(a.trackedImages=n),r._onStartOptionsReady(e,i,a,s)})):r._onStartOptionsReady(e,i,a,s)}else s&&s(new Error("XR is not available"))}_onStartOptionsReady(t,e,i,n){var r=this;navigator.xr.requestSession(t,i).then((function(t){r._onSessionStart(t,e,n)})).catch((function(t){r._camera.camera.xr=null,r._camera=null,r._type=null,r._spaceType=null,n&&n(t),r.fire("error",t)}))}end(t){this._session?(t&&this.once("end",t),this._session.end()):t&&t(new Error("XR Session is not initialized"))}isAvailable(t){return this._available[t]}_deviceAvailabilityCheck(){for(var t in this._available)this._sessionSupportCheck(t)}_sessionSupportCheck(t){var e=this;navigator.xr.isSessionSupported(t).then((function(i){e._available[t]!==i&&(e._available[t]=i,e.fire("available",t,i),e.fire("available:"+t,i))})).catch((function(t){e.fire("error",t)}))}_onSessionStart(t,e,i){var n=this,r=!1;this._session=t;var s=function(){n.fire("visibility:change",t.visibilityState)},a=function(){n._setClipPlanes(n._camera.nearClip,n._camera.farClip)};t.addEventListener("end",(function e(){n._session=null,n._referenceSpace=null,n.views=[],n._width=0,n._height=0,n._type=null,n._spaceType=null,n._camera&&(n._camera.off("set_nearClip",a),n._camera.off("set_farClip",a),n._camera.camera.xr=null,n._camera=null),t.removeEventListener("end",e),t.removeEventListener("visibilitychange",s),r||n.fire("end"),n.app.tick()})),t.addEventListener("visibilitychange",s),this._camera.on("set_nearClip",a),this._camera.on("set_farClip",a),this._baseLayer=new XRWebGLLayer(t,this.app.graphicsDevice.gl),t.updateRenderState({baseLayer:this._baseLayer,depthNear:this._depthNear,depthFar:this._depthFar}),t.requestReferenceSpace(e).then((function(t){n._referenceSpace=t,n.app.tick(),i&&i(null),n.fire("start")})).catch((function(e){r=!0,t.end(),i&&i(e),n.fire("error",e)}))}_setClipPlanes(t,e){this._depthNear===t&&this._depthFar===e||(this._depthNear=t,this._depthFar=e,this._session&&this._session.updateRenderState({depthNear:this._depthNear,depthFar:this._depthFar}))}update(t){if(this._session){var e,i,n,r,s,a,o=t.session.renderState.baseLayer.framebufferWidth,l=t.session.renderState.baseLayer.framebufferHeight;this._width===o&&this._height===l||(this._width=o,this._height=l,this.app.graphicsDevice.setResolution(o,l));var h=t.getViewerPose(this._referenceSpace);if((a=h?h.views.length:0)>this.views.length)for(e=0;e<=a-this.views.length;e++)(i=this.viewsPool.pop())||(i={viewport:new X,projMat:new Q,viewMat:new Q,viewOffMat:new Q,viewInvMat:new Q,viewInvOffMat:new Q,projViewOffMat:new Q,viewMat3:new G,position:new Float32Array(3),rotation:new $}),this.views.push(i);else if(a<=this.views.length)for(e=0;e<this.views.length-a;e++)this.viewsPool.push(this.views.pop());if(h){var c=h.transform.position,u=h.transform.orientation;for(this._localPosition.set(c.x,c.y,c.z),this._localRotation.set(u.x,u.y,u.z,u.w),r=t.session.renderState.baseLayer,e=0;e<h.views.length;e++)n=h.views[e],i=this.views[e],s=r.getViewport(n),i.viewport.x=s.x,i.viewport.y=s.y,i.viewport.z=s.width,i.viewport.w=s.height,i.projMat.set(n.projectionMatrix),i.viewMat.set(n.transform.inverse.matrix),i.viewInvMat.set(n.transform.matrix)}this._camera.camera._node.setLocalPosition(this._localPosition),this._camera.camera._node.setLocalRotation(this._localRotation),this.input.update(t),this._type===qo&&(this.hitTest.supported&&this.hitTest.update(t),this.lightEstimation.supported&&this.lightEstimation.update(t),this.depthSensing.supported&&this.depthSensing.update(t,h&&h.views[0]),this.imageTracking.supported&&this.imageTracking.update(t)),this.fire("update",t)}}get supported(){return this._supported}get active(){return!!this._session}get type(){return this._type}get spaceType(){return this._spaceType}get session(){return this._session}get visibilityState(){return this._session?this._session.visibilityState:null}get camera(){return this._camera?this._camera.entity:null}}class Cl extends v{constructor(t,e){super(),this.system=t,this.entity=e,this.system.schema&&!this._accessorsBuilt&&this.buildAccessors(this.system.schema),this.on("set",(function(t,e,i){this.fire("set_"+t,t,e,i)})),this.on("set_enabled",this.onSetEnabled,this)}static _buildAccessors(t,e){e.forEach((function(e){var i="object"==typeof e?e.name:e;Object.defineProperty(t,i,{get:function(){return this.data[i]},set:function(t){var e=this.data,n=e[i];e[i]=t,this.fire("set",i,n,t)},configurable:!0})})),t._accessorsBuilt=!0}buildAccessors(t){Cl._buildAccessors(this,t)}onSetEnabled(t,e,i){e!==i&&this.entity.enabled&&(i?this.onEnable():this.onDisable())}onEnable(){}onDisable(){}onPostStateChange(){}get data(){var t=this.system.store[this.entity.getGuid()];return t?t.data:null}}class Il extends v{constructor(t){super(),this.app=t,this.store={},this.schema=[]}static _helper(t,e){for(var i=0,n=t.length;i<n;i++)t[i].f.call(t[i].s,e)}static initialize(t){this._helper(this._init,t)}static postInitialize(t){this._helper(this._postInit,t),this.fire("postinitialize",t)}static update(t,e){this._helper(e?this._toolsUpdate:this._update,t)}static animationUpdate(t,e){this._helper(this._animationUpdate,t)}static fixedUpdate(t,e){this._helper(this._fixedUpdate,t)}static postUpdate(t,e){this._helper(this._postUpdate,t)}static bind(t,e,i){switch(t){case"initialize":this._init.push({f:e,s:i});break;case"postInitialize":this._postInit.push({f:e,s:i});break;case"update":this._update.push({f:e,s:i});break;case"animationUpdate":this._animationUpdate.push({f:e,s:i});break;case"postUpdate":this._postUpdate.push({f:e,s:i});break;case"fixedUpdate":this._fixedUpdate.push({f:e,s:i});break;case"toolsUpdate":this._toolsUpdate.push({f:e,s:i});break;default:console.error("Component System does not support event",t)}}static _erase(t,e,i){for(var n=0;n<t.length;n++)t[n].f===e&&t[n].s===i&&t.splice(n--,1)}static unbind(t,e,i){switch(t){case"initialize":this._erase(this._init,e,i);break;case"postInitialize":this._erase(this._postInit,e,i);break;case"update":this._erase(this._update,e,i);break;case"animationUpdate":this._erase(this._animationUpdate,e,i);break;case"postUpdate":this._erase(this._postUpdate,e,i);break;case"fixedUpdate":this._erase(this._fixedUpdate,e,i);break;case"toolsUpdate":this._erase(this._toolsUpdate,e,i);break;default:console.error("Component System does not support event",t)}}addComponent(t,e){var i=new this.ComponentType(this,t),n=new this.DataType;return e=e||{},this.store[t.getGuid()]={entity:t,data:n},t[this.id]=i,t.c[this.id]=i,this.initializeComponentData(i,e,[]),this.fire("add",t,i),i}removeComponent(t){var e=this.store[t.getGuid()],i=t.c[this.id];this.fire("beforeremove",t,i),delete this.store[t.getGuid()],delete t[this.id],delete t.c[this.id],this.fire("remove",t,e.data)}cloneComponent(t,e){var i=this.store[t.getGuid()];return this.addComponent(e,i.data)}initializeComponentData(t,e={},i){for(var n,r,s,a,o=0,l=i.length;o<l;o++)"object"==typeof(n=i[o])?(r=n.name,s=n.type):(r=n,s=void 0),void 0!==(a=e[r])?(void 0!==s&&(a=Sl(a,s)),t[r]=a):t[r]=t.data[r];t.enabled&&t.entity.enabled&&t.onEnable()}getPropertiesOfType(t){var e=[];return(this.schema||[]).forEach((function(i){i&&"object"==typeof i&&i.type===t&&e.push(i)})),e}destroy(){this.off()}}function Sl(t,e){if(!t)return t;switch(e){case"rgb":return t instanceof D?t.clone():new D(t[0],t[1],t[2]);case"rgba":return t instanceof D?t.clone():new D(t[0],t[1],t[2],t[3]);case"vec2":return t instanceof W?t.clone():new W(t[0],t[1]);case"vec3":return t instanceof H?t.clone():new H(t[0],t[1],t[2]);case"vec4":return t instanceof X?t.clone():new X(t[0],t[1],t[2],t[3]);case"boolean":case"number":case"string":case"entity":return t;default:throw new Error("Could not convert unhandled type: "+e)}}Il._init=[],Il._postInit=[],Il._toolsUpdate=[],Il._update=[],Il._animationUpdate=[],Il._fixedUpdate=[],Il._postUpdate=[],y.attach(Il),Il.destroy=function(){Il.off("initialize"),Il.off("postInitialize"),Il.off("toolsUpdate"),Il.off("update"),Il.off("animationUpdate"),Il.off("fixedUpdate"),Il.off("postUpdate"),Il._init=[],Il._postInit=[],Il._toolsUpdate=[],Il._update=[],Il._animationUpdate=[],Il._fixedUpdate=[],Il._postUpdate=[]};class Ml{constructor(){this._left=1/0,this._right=-1/0,this._len=0,this._recip=0,this._p0=0,this._p1=0,this._t=0,this._hermite={valid:!1,p0:0,m0:0,p1:0,m1:0}}update(t,e){if(t<this._left||t>=this._right){var i=e.length;if(i)if(t<e[0])this._left=-1/0,this._right=e[0],this._len=0,this._recip=0,this._p0=this._p1=0;else if(t>=e[i-1])this._left=e[i-1],this._right=1/0,this._len=0,this._recip=0,this._p0=this._p1=i-1;else{var n=this._findKey(t,e);this._left=e[n],this._right=e[n+1],this._len=this._right-this._left;var r=1/this._len;this._recip=isFinite(r)?r:0,this._p0=n,this._p1=n+1}else this._left=-1/0,this._right=1/0,this._len=0,this._recip=0,this._p0=this._p1=0}this._t=0===this._recip?0:(t-this._left)*this._recip,this._hermite.valid=!1}_findKey(t,e){for(var i=0;t>=e[i+1];)i++;return i}eval(t,e,i){var n,r=i._data,s=i._components,a=this._p0*s;if(0===e)for(n=0;n<s;++n)t[n]=r[a+n];else{var o=this._t,l=this._p1*s;switch(e){case 1:for(n=0;n<s;++n)t[n]=k.lerp(r[a+n],r[l+n],o);break;case 2:var h=this._hermite;if(!h.valid){var c=o*o,u=o+o,d=1-o,f=d*d;h.valid=!0,h.p0=(1+u)*f,h.m0=o*f,h.p1=c*(3-u),h.m1=c*(o-1)}var p=(3*this._p0+1)*s,m=(3*this._p0+2)*s,g=(3*this._p1+1)*s,v=(3*this._p1+0)*s;for(n=0;n<s;++n)t[n]=h.p0*r[p+n]+h.m0*r[m+n]*this._len+h.p1*r[g+n]+h.m1*r[v+n]*this._len}}}}class Tl{constructor(t){var e;for(this._name=t.name+"Snapshot",this._time=-1,this._cache=[],this._results=[],e=0;e<t._inputs.length;++e)this._cache[e]=new Ml;var i=t._curves,n=t._outputs;for(e=0;e<i.length;++e){for(var r=n[i[e]._output],s=[],a=0;a<r._components;++a)s[a]=0;this._results[e]=s}}}class Pl{constructor(t,e,i,n,r){this._name=t.name,this._track=t,this._snapshot=new Tl(t),this._playing=n,this._time=e,this._speed=i,this._loop=r,this._blendWeight=1,this._blendOrder=0}get name(){return this._name}set name(t){this._name=t}get track(){return this._track}get snapshot(){return this._snapshot}get time(){return this._time}set time(t){this._time=t}get speed(){return this._speed}set speed(t){this._speed=t}get loop(){return this._loop}set loop(t){this._loop=t}get blendWeight(){return this._blendWeight}set blendWeight(t){this._blendWeight=t}get blendOrder(){return this._blendOrder}set blendOrder(t){this._blendOrder=t}_update(t){if(this._playing){var e=this._time,i=this._track.duration,n=this._speed,r=this._loop;e+=n*t,n>=0?e>i&&(r?e=e%i||0:(e=this._track.duration,this.pause())):e<0&&(r?e=i+(e%i||0):(e=0,this.pause())),this._time=e}this._time!=this._snapshot._time&&this._track.eval(this._time,this._snapshot)}play(){this._playing=!0,this._time=0}stop(){this._playing=!1,this._time=0}pause(){this._playing=!1}resume(){this._playing=!0}reset(){this._time=0}}class El{constructor(t){this._binder=t,this._clips=[],this._inputs=[],this._outputs=[],this._targets={}}static _dot(t,e){for(var i=t.length,n=0,r=0;r<i;++r)n+=t[r]*e[r];return n}static _normalize(t){var e=El._dot(t,t);if(e>0){e=1/Math.sqrt(e);for(var i=t.length,n=0;n<i;++n)t[n]*=e}}static _set(t,e,i){var n,r=t.length;if("quaternion"===i){var s=El._dot(e,e);for(s>0&&(s=1/Math.sqrt(s)),n=0;n<r;++n)t[n]=e[n]*s}else for(n=0;n<r;++n)t[n]=e[n]}static _blendVec(t,e,i){for(var n=1-i,r=t.length,s=0;s<r;++s)t[s]=t[s]*n+e[s]*i}static _blendQuat(t,e,i){var n=t.length,r=1-i;El._dot(t,e)<0&&(i=-i);for(var s=0;s<n;++s)t[s]=t[s]*r+e[s]*i;El._normalize(t)}static _blend(t,e,i,n){"quaternion"===n?El._blendQuat(t,e,i):El._blendVec(t,e,i)}static _stableSort(t,e){for(var i=t.length,n=0;n<i-1;++n)for(var r=n+1;r<i;++r)if(e(t[r],t[n])){var s=t[n];t[n]=t[r],t[r]=s}}get clips(){return this._clips}addClip(t){for(var e=this._targets,i=t.track.curves,n=t.snapshot,r=[],s=[],a=0;a<i.length;++a)for(var o=i[a].paths,l=0;l<o.length;++l){var h=o[l],c=e[h];if(!c){var u=this._binder.resolve(h);if(u){c={target:u,value:[],curves:0,blendCounter:0};for(var d=0;d<c.target.components;++d)c.value.push(0);e[h]=c}}c&&(c.curves++,r.push(n._results[a]),s.push(c))}this._clips.push(t),this._inputs.push(r),this._outputs.push(s)}removeClip(t){for(var e=this._targets,i=this._clips,n=i[t].track.curves,r=0;r<n.length;++r)for(var s=n[r].paths,a=0;a<s.length;++a){var o=s[a],l=e[o];l&&(l.curves--,0===l.curves&&(this._binder.unresolve(o),delete e[o]))}i.splice(t,1),this._inputs.splice(t,1),this._outputs.splice(t,1)}removeClips(){for(;this._clips.length>0;)this.removeClip(0)}findClip(t){for(var e=this._clips,i=0;i<e.length;++i){var n=e[i];if(n.name===t)return n}return null}update(t){var e,i,n=this._clips,r=n.map((function(t,e){return e}));for(El._stableSort(r,(function(t,e){return n[t].blendOrder<n[e].blendOrder})),e=0;e<n.length;++e){var s,a,o,l=r[e],h=n[l],c=this._inputs[l],u=this._outputs[l],d=h.blendWeight;if(d>0&&h._update(t),d>=1)for(i=0;i<c.length;++i)s=c[i],o=(a=u[i]).value,El._set(o,s,a.target.type),a.blendCounter++;else if(d>0)for(i=0;i<c.length;++i)s=c[i],o=(a=u[i]).value,0===a.blendCounter?El._set(o,s,a.target.type):El._blend(o,s,d,a.target.type),a.blendCounter++}var f=this._targets;for(var p in f)if(f.hasOwnProperty(p)){var m=f[p];m.target.func(m.value),m.blendCounter=0}this._binder.update(t)}}class kl{constructor(t,e,i){this._func=t,this._type=e,this._components=i}get func(){return this._func}get type(){return this._type}get components(){return this._components}}class Dl{constructor(t){if(this.propertyLocator=new Is,t){var e={};!function t(i){e[i.name]={node:i,count:0};for(var n=0;n<i.children.length;++n)t(i.children[n])}(t);var i=function(t){for(var e,i=t;i&&!(i instanceof ha);)i=i.parent;return i&&(i.render?e=i.render.meshInstances:i.model&&(e=i.model.meshInstances)),e};this.nodes=e,this.activeNodes=[],this.handlers={localPosition:function(t){var e=t.localPosition;return new kl((function(t){e.set.apply(e,t)}),"vector",3)},localRotation:function(t){var e=t.localRotation;return new kl((function(t){e.set.apply(e,t)}),"quaternion",4)},localScale:function(t){var e=t.localScale;return new kl((function(t){e.set.apply(e,t)}),"vector",3)},weights:function(t){var e=i(t);if(e){for(var n,r=0;r<e.length;++r)if(e[r].node.name===t.name&&e[r].morphInstance){n=e[r].morphInstance;break}if(n){return new kl((function(t){for(var e=0;e<t.length;++e)n.setWeight(e,t[e])}),"vector",n.morph._targets.length)}}return null},materialTexture:function(t,e){var n=i(t);if(n){for(var r,s=0;s<n.length;++s)if(n[s].node.name===t.name){r=n[s];break}if(r){var a=function(t){var i=this.animComponent.system.app.assets.get(t[0]);i&&i.resource&&"texture"===i.type&&(r.material[e]=i.resource,r.material.update())}.bind(this);return new kl(a,"vector",1)}}return null}.bind(this)}}}resolve(t){var e=this.propertyLocator.decode(t),i=this.nodes[e[0][0]||""];if(!i)return null;var n=this.handlers[e[2][0]];if(!n)return null;var r=n(i.node);return r?(0===i.count&&this.activeNodes.push(i.node),i.count++,r):null}unresolve(t){var e=this.propertyLocator.decode(t);if("graph"===e[1]){var i=this.nodes[e[0][0]];if(i.count--,0===i.count){var n=this.activeNodes,r=n.indexOf(i.node),s=n.length;r<s-1&&(n[r]=n[s-1]),n.pop()}}}update(t){for(var e=this.activeNodes,i=0;i<e.length;++i)e[i]._dirtifyLocal()}}class Ol{constructor(){this._written=!1,this._name="",this._keyFrames=[],this._quat=new $,this._pos=new H,this._scale=new H,this._targetNode=null}getTarget(){return this._targetNode}setTarget(t){this._targetNode=t}}class Rl{constructor(t){this._animation=null,this._time=0,this.looping=!0,this._interpolatedKeys=[],this._interpolatedKeyDict={},this._currKeyIndices={},this.graph=null;var e=this;!function t(i){var n=new Ol;n._name=i.name,e._interpolatedKeys.push(n),e._interpolatedKeyDict[i.name]=n,e._currKeyIndices[i.name]=0;for(var r=0;r<i._children.length;r++)t(i._children[r])}(t)}get animation(){return this._animation}set animation(t){this._animation=t,this.currentTime=0}get currentTime(){return this._time}set currentTime(t){this._time=t;for(var e=this._interpolatedKeys.length,i=0;i<e;i++){var n=this._interpolatedKeys[i]._name;this._currKeyIndices[n]=0}this.addTime(0),this.updateGraph()}get numNodes(){return this._interpolatedKeys.length}addTime(t){if(null!==this._animation){var e,i,n,r,s,a,o,l,h=this._animation._nodes,c=this._animation.duration;if(this._time===c&&!this.looping)return;if(this._time+=t,this._time>c)for(this._time=this.looping?0:c,e=0;e<h.length;e++)n=(i=h[e])._name,this._currKeyIndices[n]=0;else if(this._time<0)for(this._time=this.looping?c:0,e=0;e<h.length;e++)n=(i=h[e])._name,this._currKeyIndices[n]=i._keys.length-2;var u,d=t>=0?1:-1;for(e=0;e<h.length;e++)if(n=(i=h[e])._name,r=i._keys,void 0!==(s=this._interpolatedKeyDict[n])){if(u=!1,1!==r.length)for(var f=this._currKeyIndices[n];f<r.length-1&&f>=0;f+=d)if(a=r[f],o=r[f+1],a.time<=this._time&&o.time>=this._time){l=(this._time-a.time)/(o.time-a.time),s._pos.lerp(a.position,o.position,l),s._quat.slerp(a.rotation,o.rotation,l),s._scale.lerp(a.scale,o.scale,l),s._written=!0,this._currKeyIndices[n]=f,u=!0;break}(1===r.length||!u&&0===this._time&&this.looping)&&(s._pos.copy(r[0].position),s._quat.copy(r[0].rotation),s._scale.copy(r[0].scale),s._written=!0)}}}blend(t,e,i){for(var n=this._interpolatedKeys.length,r=0;r<n;r++){var s=t._interpolatedKeys[r],a=e._interpolatedKeys[r],o=this._interpolatedKeys[r];s._written&&a._written?(o._quat.slerp(s._quat,e._interpolatedKeys[r]._quat,i),o._pos.lerp(s._pos,e._interpolatedKeys[r]._pos,i),o._scale.lerp(s._scale,a._scale,i),o._written=!0):s._written?(o._quat.copy(s._quat),o._pos.copy(s._pos),o._scale.copy(s._scale),o._written=!0):a._written&&(o._quat.copy(a._quat),o._pos.copy(a._pos),o._scale.copy(a._scale),o._written=!0)}}setGraph(t){var e;if(this.graph=t,t)for(e=0;e<this._interpolatedKeys.length;e++){var i=this._interpolatedKeys[e],n=t.findByName(i._name);this._interpolatedKeys[e].setTarget(n)}else for(e=0;e<this._interpolatedKeys.length;e++)this._interpolatedKeys[e].setTarget(null)}updateGraph(){if(this.graph)for(var t=0;t<this._interpolatedKeys.length;t++){var e=this._interpolatedKeys[t];if(e._written){var i=e.getTarget();i.localPosition.copy(e._pos),i.localRotation.copy(e._quat),i.localScale.copy(e._scale),i._dirtyLocal||i._dirtifyLocal(),e._written=!1}}}}class Ll extends Cl{constructor(t,e){super(t,e),this.animationsIndex={},this.on("set_animations",this.onSetAnimations,this),this.on("set_assets",this.onSetAssets,this),this.on("set_loop",this.onSetLoop,this)}play(t,e){if(this.enabled&&this.entity.enabled){var i=this.data;if(i.animations[t]){if(e=e||0,i.prevAnim=i.currAnim,i.currAnim=t,i.model){i.skeleton||i.animEvaluator||this._createAnimationController();var n=i.animations[i.prevAnim],r=i.animations[i.currAnim];if(i.blending=e>0&&i.prevAnim,i.blending&&(i.blend=0,i.blendSpeed=1/e),i.skeleton&&(i.blending?(i.fromSkel.animation=n,i.fromSkel.addTime(i.skeleton._time),i.toSkel.animation=r):i.skeleton.animation=r),i.animEvaluator){var s=i.animEvaluator;if(i.blending)for(;s.clips.length>1;)s.removeClip(0);else i.animEvaluator.removeClips();var a=new Pl(i.animations[i.currAnim],0,1,!0,i.loop);a.name=i.currAnim,a.blendWeight=i.blending?0:1,a.reset(),i.animEvaluator.addClip(a)}}i.playing=!0}}}getAnimation(t){return this.data.animations[t]}setModel(t){var e=this.data;t!==e.model&&(this._resetAnimationController(),e.model=t,e.animations&&e.currAnim&&e.animations[e.currAnim]&&this.play(e.currAnim))}_resetAnimationController(){var t=this.data;t.skeleton=null,t.fromSkel=null,t.toSkel=null,t.animEvaluator=null}_createAnimationController(){var t=this.data,e=t.model,i=t.animations,n=!1,r=!1;for(var s in i){if(i.hasOwnProperty(s))i[s].constructor===os?r=!0:n=!0}var a=e.getGraph();n?(t.fromSkel=new Rl(a),t.toSkel=new Rl(a),t.skeleton=new Rl(a),t.skeleton.looping=t.loop,t.skeleton.setGraph(a)):r&&(t.animEvaluator=new El(new Dl(a)))}loadAnimationAssets(t){if(t&&t.length){var e,i=this,n=this.system.app.assets,r=t.length,s=function(t){if(t.resources.length>1)for(var e=0;e<t.resources.length;e++)i.animations[t.resources[e].name]=t.resources[e],i.animationsIndex[t.id]=t.resources[e].name;else i.animations[t.name]=t.resource,i.animationsIndex[t.id]=t.name;i.animations=i.animations},a=function(t){t.off("change",i.onAssetChanged,i),t.on("change",i.onAssetChanged,i),t.off("remove",i.onAssetRemoved,i),t.on("remove",i.onAssetRemoved,i),t.resource?s(t):(t.once("load",s,i),i.enabled&&i.entity.enabled&&n.load(t))};for(e=0;e<r;e++){var o=n.get(t[e]);o?a(o):n.on("add:"+t[e],a)}}}onAssetChanged(t,e,i,n){var r;if("resource"===e||"resources"===e)if("resources"===e&&i&&0===i.length&&(i=null),i){var s=!1;if(i.length>1){if(n&&n.length>1)for(r=0;r<n.length;r++)delete this.animations[n[r].name];else delete this.animations[t.name];for(s=!1,r=0;r<i.length;r++)this.animations[i[r].name]=i[r],s||this.data.currAnim!==i[r].name||this.data.playing&&this.data.enabled&&this.entity.enabled&&(s=!0,this.play(i[r].name,0));s||(this._stopCurrentAnimation(),this.onSetAnimations())}else{if(n&&n.length>1)for(r=0;r<n.length;r++)delete this.animations[n[r].name];this.animations[t.name]=i[0]||i,s=!1,this.data.currAnim===t.name&&this.data.playing&&this.data.enabled&&this.entity.enabled&&(s=!0,this.play(t.name,0)),s||(this._stopCurrentAnimation(),this.onSetAnimations())}this.animationsIndex[t.id]=t.name}else{if(n.length>1)for(r=0;r<n.length;r++)delete this.animations[n[r].name],this.data.currAnim===n[r].name&&this._stopCurrentAnimation();else delete this.animations[t.name],this.data.currAnim===t.name&&this._stopCurrentAnimation();delete this.animationsIndex[t.id]}}onAssetRemoved(t){if(t.off("remove",this.onAssetRemoved,this),this.animations){if(t.resources.length>1)for(var e=0;e<t.resources.length;e++)delete this.animations[t.resources[e].name],this.data.currAnim===t.resources[e].name&&this._stopCurrentAnimation();else delete this.animations[t.name],this.data.currAnim===t.name&&this._stopCurrentAnimation();delete this.animationsIndex[t.id]}}_stopCurrentAnimation(){var t=this.data;if(t.currAnim=null,t.playing=!1,t.skeleton&&(t.skeleton.currentTime=0,t.skeleton.animation=null),t.animEvaluator){for(var e=0;e<t.animEvaluator.clips.length;++e)t.animEvaluator.clips[e].stop();t.animEvaluator.update(0),t.animEvaluator.removeClips()}}onSetAnimations(t,e,i){var n=this.data,r=this.entity.model;if(r){var s=r.model;s&&s!==n.model&&this.setModel(s)}if(!n.currAnim&&n.activate&&n.enabled&&this.entity.enabled)for(var a in n.animations){this.play(a,0);break}}onSetAssets(t,e,i){if(e&&e.length)for(var n=0;n<e.length;n++)if(e[n]){var r=this.system.app.assets.get(e[n]);if(r){r.off("change",this.onAssetChanged,this),r.off("remove",this.onAssetRemoved,this);var s=this.animationsIndex[r.id];this.data.currAnim===s&&this._stopCurrentAnimation(),delete this.animations[s],delete this.animationsIndex[r.id]}}var a=i.map((function(t){return t instanceof As?t.id:t}));this.loadAnimationAssets(a)}onSetLoop(t,e,i){var n=this.data;if(n.skeleton&&(n.skeleton.looping=n.loop),n.animEvaluator)for(var r=0;r<n.animEvaluator.clips.length;++r)n.animEvaluator.clips[r].loop=n.loop}onSetCurrentTime(t,e,i){var n=this.data;if(n.skeleton){var r=n.skeleton;r.currentTime=i,r.addTime(0),r.updateGraph()}if(n.animEvaluator)for(var s=n.animEvaluator,a=0;a<s.clips.length;++a)s.clips[a].time=i}onEnable(){super.onEnable();var t=this.data,e=t.assets,i=this.system.app.assets;if(e)for(var n=0,r=e.length;n<r;n++){var s=e[n];s instanceof As||(s=i.get(s)),s&&!s.resource&&i.load(s)}if(t.activate&&!t.currAnim)for(var a in t.animations){this.play(a,0);break}}onBeforeRemove(){for(var t=0;t<this.assets.length;t++){var e=this.assets[t];"number"==typeof e&&(e=this.system.app.assets.get(e)),e&&(e.off("change",this.onAssetChanged,this),e.off("remove",this.onAssetRemoved,this))}var i=this.data;delete i.animation,delete i.skeleton,delete i.fromSkel,delete i.toSkel,delete i.animEvaluator}get currentTime(){var t=this.data;if(t.skeleton)return this.data.skeleton._time;if(t.animEvaluator){var e=t.animEvaluator.clips;if(e.length>0)return e[e.length-1].time}return 0}set currentTime(t){var e=this.data;if(e.skeleton){var i=e.skeleton;i.currentTime=t,i.addTime(0),i.updateGraph()}if(e.animEvaluator)for(var n=e.animEvaluator,r=0;r<n.clips.length;++r)n.clips[r].time=t}get duration(){return this.data.animations[this.data.currAnim].duration}}class Nl{constructor(){this.assets=[],this.speed=1,this.loop=!0,this.activate=!0,this.enabled=!0,this.animations={},this.model=null,this.prevAnim=null,this.currAnim=null,this.blending=!1,this.blend=0,this.blendSpeed=0,this.playing=!1,this.skeleton=null,this.fromSkel=null,this.toSkel=null,this.animEvaluator=null}}const zl=["enabled","assets","speed","loop","activate","animations","skeleton","model","prevAnim","currAnim","fromSkel","toSkel","blending","blendTimeRemaining","playing"];class Bl extends Il{constructor(t){super(t),this.id="animation",this.ComponentType=Ll,this.DataType=Nl,this.schema=zl,this.on("beforeremove",this.onBeforeRemove,this),this.on("update",this.onUpdate,this),Il.bind("update",this.onUpdate,this)}initializeComponentData(t,e,i){i=["activate","enabled","loop","speed","assets"],super.initializeComponentData(t,e,i)}cloneComponent(t,e){var i;this.addComponent(e,{}),e.animation.assets=t.animation.assets.slice(),e.animation.data.speed=t.animation.speed,e.animation.data.loop=t.animation.loop,e.animation.data.activate=t.animation.activate,e.animation.data.enabled=t.animation.enabled;var n={},r=t.animation.animations;for(i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);e.animation.animations=n;var s={},a=t.animation.animationsIndex;for(i in a)a.hasOwnProperty(i)&&(s[i]=a[i]);e.animation.animationsIndex=s}onBeforeRemove(t,e){e.onBeforeRemove()}onUpdate(t){var e=this.store;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=n.data;if(r.enabled&&n.entity.enabled){if(r.blending&&(r.blend+=t*r.blendSpeed,r.blend>=1&&(r.blend=1)),r.playing){var s=r.skeleton;if(null!==s&&null!==r.model){if(r.blending)s.blend(r.fromSkel,r.toSkel,r.blend);else{var a=t*r.speed;s.addTime(a),(r.speed>0&&s._time===s._animation.duration&&!r.loop||r.speed<0&&0===s._time&&!r.loop)&&(r.playing=!1)}r.blending&&1===r.blend&&(s.animation=r.toSkel._animation),s.updateGraph()}}var o=r.animEvaluator;if(o){for(var l=0;l<o.clips.length;++l){var h=o.clips[l];h.speed=r.speed,r.playing?h.resume():h.pause()}r.blending&&(o.clips[1].blendWeight=r.blend),o.update(t)}r.blending&&1===r.blend&&(r.blending=!1)}}}}Cl._buildAccessors(Ll.prototype,zl);const Fl=new W,jl=new H,Vl=new X,Ul=new D,Gl=new $;class Wl extends Dl{constructor(t,e){super(e),this.animComponent=t}static _packFloat(t){return t[0]}static _packBoolean(t){return!!t[0]}static _packVec2(t){return Fl.x=t[0],Fl.y=t[1],Fl}static _packVec3(t){return jl.x=t[0],jl.y=t[1],jl.z=t[2],jl}static _packVec4(t){return Vl.x=t[0],Vl.y=t[1],Vl.z=t[2],Vl.w=t[3],Vl}static _packColor(t){return Ul.r=t[0],Ul.g=t[1],Ul.b=t[2],Ul.a=t[3],Ul}static _packQuat(t){return Gl.x=t[0],Gl.y=t[1],Gl.z=t[2],Gl.w=t[3],Gl}resolve(t){var e,i=this.propertyLocator.decode(t),n=i[0],r=i[1],s=i[2],a=this._getEntityFromHierarchy(n);if(!a)return null;switch(r){case"entity":e=a;break;case"graph":if(!this.nodes||!this.nodes[n[0]])return null;e=this.nodes[n[0]].node;break;default:if(!(e=a.findComponent(r)))return null}return this._createAnimTargetForProperty(e,s)}update(t){var e=this.activeNodes;if(e)for(var i=0;i<e.length;i++)e[i]._dirtifyLocal()}_getEntityFromHierarchy(t){if(!this.animComponent.entity.name===t[0])return null;var e=this.animComponent.entity;return 1===t.length?e:e._parent.findByPath(t.join("/"))}_resolvePath(t,e,i){for(var n=e.length-(i?0:1),r=0;r<n;r++)t=t[e[r]];return t}_setter(t,e,i){var n=this._resolvePath(t,e),r=e[e.length-1],s="set"+r.substring(0,1).toUpperCase()+r.substring(1);if(n[s]){var a=n[s].bind(n);return function(t){a(i(t))}}var o=n[r];if("object"==typeof o&&o.hasOwnProperty("copy"))return function(t){o.copy(i(t))};if(-1!==[W,H,X,D,$].indexOf(n.constructor)&&e.length>1){var l=e.length>2?this._resolvePath(t,e.slice(0,-1)):t,h=e[e.length-2];return function(t){n[r]=i(t),l[h]=n}}return function(t){n[r]=i(t)}}_createAnimTargetForProperty(t,e){if(this.handlers&&"weights"===e[0])return this.handlers.weights(t);if(this.handlers&&"material"===e[0]&&2===e.length){var i=e[1];if(i.indexOf("Map")===i.length-3)return this.handlers.materialTexture(t,i)}var n,r,s,a=this._resolvePath(t,e,!0);if(void 0===a)return null;if("number"==typeof a)n=this._setter(t,e,Wl._packFloat),r="vector",s=1;else if("boolean"==typeof a)n=this._setter(t,e,Wl._packBoolean),r="vector",s=1;else if("object"==typeof a)switch(a.constructor){case W:n=this._setter(t,e,Wl._packVec2),r="vector",s=2;break;case H:n=this._setter(t,e,Wl._packVec3),r="vector",s=3;break;case X:n=this._setter(t,e,Wl._packVec4),r="vector",s=4;break;case D:n=this._setter(t,e,Wl._packColor),r="vector",s=4;break;case $:n=this._setter(t,e,Wl._packQuat),r="quaternion",s=4;break;default:return null}return-1!==e.indexOf("material")?new kl((function(e){n(e),t.material.update()}),r,s):new kl(n,r,s)}}class Hl{constructor(t,e,i){this._name=t,this._controller=e,this._component=i}play(t){this._controller.play(t)}pause(){this._controller.pause()}reset(){this._controller.reset()}update(t){this._controller.update(t)}assignAnimation(t,e){e.constructor===os&&(this._controller.assignAnimation(t,e),this._component.activate&&this._component.playable&&(this._component.playing=!0))}removeNodeAnimations(t){this._controller.removeNodeAnimations(t),this._component.playing=!1}get name(){return this._name}get playing(){return this._controller.playing}set playing(t){this._controller.playing=t}get playable(){return this._controller.playable}get activeState(){return this._controller.activeStateName}get previousState(){return this._controller.previousStateName}get activeStateProgress(){return this._controller.activeStateProgress}get activeStateDuration(){return this._controller.activeStateDuration}get activeStateCurrentTime(){return this._controller.activeStateCurrentTime}set activeStateCurrentTime(t){this._controller.activeStateCurrentTime=t}get transitioning(){return this._controller.transitioning}get transitionProgress(){return this.transitioning?this._controller.transitionProgress:null}get states(){return this._controller.states}}class Xl{constructor(t,e,i,n,r=1){this._state=t,this._parent=e,this._name=i,this._point=Array.isArray(n)?new pc.Vec2(n):n,this._speed=r,this._weight=1,this._animTrack=null}get parent(){return this._parent}get name(){return this._name}get path(){return this._parent?this._parent.path+"."+this._name:this._name}get point(){return this._point}get weight(){return this._parent?this._parent.weight*this._weight:this._weight}set weight(t){this._weight=t}get normalizedWeight(){var t=this._state.totalWeight;return 0===t?0:this.weight/t}get speed(){return this._speed}get animTrack(){return this._animTrack}set animTrack(t){this._animTrack=t}}function Zl(t,e){return Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y)}function Yl(t,e,i){return t<=e?e:t>=i?i:t}class ql extends Xl{constructor(t,e,i,n,r,s,a,o){super(t,e,i,n),this._type=r,this._parameters=s,this._parameterValues=null,this._children=[],this._findParameter=o;for(var l=0;l<a.length;l++){var h=a[l];h.children?this._children.push(new ql(t,this,h.name,h.point,h.type,h.parameter?[h.parameter]:h.parameters,h.children,o)):this._children.push(new Xl(t,this,h.name,h.point,h.speed))}}get parent(){return this._parent}get name(){return this._name}get point(){return this._point}get weight(){return this.calculateWeights(),this._parent?this._parent.weight*this._weight:this._weight}set weight(t){this._weight=t}get speed(){return this._speed}getChild(t){for(var e=0;e<this._children.length;e++)if(this._children[e].name===t)return this._children[e]}calculateWeights(){var t,e,i,n,r,s,a,o,l,h,c,u,d,f,p,m,g;switch(this._type){case"1D":var v=this._findParameter(this._parameters[0]).value;if(this._parameterValues&&this._parameterValues[0]===v)return;for(this._parameterValues=[v],this._children[0].weight=0,t=0;t<this._children.length-1;t++){var _=this._children[t],y=this._children[t+1];if(u=v,d=_.point,f=y.point,p=!0,m=void 0,g=void 0,m=Math.min(d,f),g=Math.max(d,f),p?u>=m&&u<=g:u>m&&u<g){var b=Math.abs(_.point-y.point),x=(b-Math.abs(_.point-v))/b;_.weight=x,y.weight=1-x}else y.weight=0}break;case"2D_CARTESIAN":if(o=this._parameters.map(function(t){return this._findParameter(t).value}.bind(this)),this._parameterValues&&this._parameterValues.equals(o))return;for(this._parameterValues=o,i=new pc.Vec2(this._parameterValues),c=0,t=0;t<this._children.length;t++){for(n=this._children[t].point.clone(),l=Number.MAX_VALUE,e=0;e<this._children.length;e++)t!==e&&(a=(r=this._children[e].point.clone()).clone().sub(n),(h=Yl(1-(s=i.clone().sub(n)).clone().dot(a)/a.lengthSq(),0,1))<l&&(l=h));this._children[t].weight=l,c+=l}for(t=0;t<this._children.length;t++)this._children[t].weight=this._children[t]._weight/c;break;case"2D_DIRECTIONAL":if(o=this._parameters.map(function(t){return this._findParameter(t).value}.bind(this)),this._parameterValues&&this._parameterValues.equals(o))return;for(this._parameterValues=o,i=new pc.Vec2(this._parameterValues),c=0,t=0;t<this._children.length;t++){for(n=this._children[t].point.clone(),l=Number.MAX_VALUE,e=0;e<this._children.length;e++)if(t!==e){r=this._children[e].point.clone();var w=Zl(n,i),A=Zl(n,r);a=new pc.Vec2((r.length()-n.length())/((r.length()+n.length())/2),2*A),s=new pc.Vec2((i.length()-n.length())/((r.length()+n.length())/2),2*w),(h=Yl(1-Math.abs(s.clone().dot(a)/a.lengthSq()),0,1))<l&&(l=h)}this._children[t].weight=l,c+=l}for(t=0;t<this._children.length;t++)this._children[t].weight=this._children[t]._weight/c;break;case"DIRECT":if(o=this._parameters.map(function(t){return this._findParameter(t).value}.bind(this)),this._parameterValues===o)return;for(this._parameterValues=o,c=0,t=0;t<this._children.length;t++)c+=Yl(this._parameterValues[t],0,Number.MAX_VALUE);for(t=0;t<this._children.length;t++)this._children[t].weight=Yl(this._parameterValues[t],0,Number.MAX_VALUE)/c}}getNodeCount(){for(var t=0,e=0;e<this._children.length;e++){this._children[e].constructor===ql?t+=this._children[e].getNodeCount():t++}return t}}class Kl{constructor(t,e,i,n,r){this._controller=t,this._name=e,this._animations={},this._animationList=[],this._speed=i||1,this._loop=void 0===n||n;var s=this._controller.findParameter.bind(this._controller);this._blendTree=r?new ql(this,null,e,1,r.type,r.parameter?[r.parameter]:r.parameters,r.children,s):new Xl(this,null,e,1,i)}_getNodeFromPath(t){for(var e=this._blendTree,i=1;i<t.length;i++)e=e.getChild(t[i]);return e}addAnimation(t,e){var i=this._animationList.findIndex((function(e){return e.path===t}));if(i>=0)this._animationList[i].animTrack=e;else{var n=this._getNodeFromPath(t);n.animTrack=e,this._animationList.push(n)}}get name(){return this._name}get animations(){return this._animationList}set animations(t){this._animationList=t}get speed(){return this._speed}get loop(){return this._loop}get nodeCount(){return this._blendTree&&this._blendTree.constructor===ql?this._blendTree.getNodeCount():1}get playable(){return"START"===this.name||"END"===this.name||"ANY"===this.name||this.animations.length===this.nodeCount}get looping(){if(this.animations.length>0){var t=this.name+"."+this.animations[0].animTrack.name,e=this._controller.animEvaluator.findClip(t);if(e)return e.loop}return!1}get totalWeight(){var t,e=0;for(t=0;t<this.animations.length;t++)e+=this.animations[t].weight;return e}get timelineDuration(){var t,e=0;for(t=0;t<this.animations.length;t++){var i=this.animations[t];i.animTrack.duration>e&&(e=i.animTrack.duration)}return e}}class Jl{constructor(t,e,i,n,r,s,a,o,l="NONE"){this._controller=t,this._from=e,this._to=i,this._time=n,this._priority=r,this._conditions=s||[],this._exitTime=a||null,this._transitionOffset=o||null,this._interruptionSource=l}get from(){return this._from}get to(){return this._to}get time(){return this._time}get priority(){return this._priority}get conditions(){return this._conditions}get exitTime(){return this._exitTime}get transitionOffset(){return this._transitionOffset}get interruptionSource(){return this._interruptionSource}get hasExitTime(){return!!this.exitTime}get hasConditionsMet(){var t,e=!0;for(t=0;t<this.conditions.length;t++){var i=this.conditions[t],n=this._controller.findParameter(i.parameterName);switch(i.predicate){case"GREATER_THAN":e=e&&n.value>i.value;break;case"LESS_THAN":e=e&&n.value<i.value;break;case"GREATER_THAN_EQUAL_TO":e=e&&n.value>=i.value;break;case"LESS_THAN_EQUAL_TO":e=e&&n.value<=i.value;break;case"EQUAL_TO":e=e&&n.value===i.value;break;case"NOT_EQUAL_TO":e=e&&n.value!==i.value}if(!e)return e}return e}}class Ql{constructor(t,e,i,n,r){var s;for(this._animEvaluator=t,this._states={},this._stateNames=[],s=0;s<e.length;s++)this._states[e[s].name]=new Kl(this,e[s].name,e[s].speed,e[s].loop,e[s].blendTree),this._stateNames.push(e[s].name);this._transitions=i.map(function(t){return new Jl(this,t.from,t.to,t.time,t.priority,t.conditions,t.exitTime,t.transitionOffset,t.interruptionSource)}.bind(this)),this._findTransitionsFromStateCache={},this._findTransitionsBetweenStatesCache={},this._parameters=n,this._previousStateName=null,this._activeStateName="START",this._playing=!1,this._activate=r,this._currTransitionTime=1,this._totalTransitionTime=1,this._isTransitioning=!1,this._transitionInterruptionSource="NONE",this._transitionPreviousStates=[],this._timeInState=0,this._timeInStateBefore=0}get animEvaluator(){return this._animEvaluator}get activeState(){return this._findState(this._activeStateName)}set activeState(t){this._activeStateName=t}get activeStateName(){return this._activeStateName}get activeStateAnimations(){return this.activeState.animations}get previousState(){return this._findState(this._previousStateName)}set previousState(t){this._previousStateName=t}get previousStateName(){return this._previousStateName}get playable(){var t,e=!0;for(t=0;t<this._stateNames.length;t++)this._states[this._stateNames[t]].playable||(e=!1);return e}get playing(){return this._playing}set playing(t){this._playing=t}get activeStateProgress(){return this._getActiveStateProgressForTime(this._timeInState)}get activeStateDuration(){if("START"===this.activeStateName||"END"===this.activeStateName)return 0;for(var t=0,e=0;e<this.activeStateAnimations.length;e++){var i=this._animEvaluator.findClip(this.activeStateAnimations[e].name);t=Math.max(t,i.track.duration)}return t}get activeStateCurrentTime(){return this._timeInState}set activeStateCurrentTime(t){this._timeInStateBefore=t,this._timeInState=t;for(var e=0;e<this.activeStateAnimations.length;e++){var i=this.animEvaluator.findClip(this.activeStateAnimations[e].name);i&&(i.time=t)}}get transitioning(){return this._isTransitioning}get transitionProgress(){return this._currTransitionTime/this._totalTransitionTime}get states(){return this._stateNames}_findState(t){return this._states[t]}_getActiveStateProgressForTime(t){if("START"===this.activeStateName||"END"===this.activeStateName||"ANY"===this.activeStateName)return 1;var e=this._animEvaluator.findClip(this.activeStateAnimations[0].name);return e?t/e.track.duration:null}_findTransitionsFromState(t){var e=this._findTransitionsFromStateCache[t];return e||((e=this._transitions.filter((function(e){return e.from===t}))).sort((function(t,e){return t.priority<e.priority})),this._findTransitionsFromStateCache[t]=e),e}_findTransitionsBetweenStates(t,e){var i=this._findTransitionsBetweenStatesCache[t+"->"+e];return i||((i=this._transitions.filter((function(i){return i.from===t&&i.to===e}))).sort((function(t,e){return t.priority<e.priority})),this._findTransitionsBetweenStatesCache[t+"->"+e]=i),i}_findTransition(t,e){var i=[];if(t&&e)i.concat(this._findTransitionsBetweenStates(t,e));else if(this._isTransitioning)switch(this._transitionInterruptionSource){case"PREV_STATE":i=(i=i.concat(this._findTransitionsFromState(this._previousStateName))).concat(this._findTransitionsFromState("ANY"));break;case"NEXT_STATE":i=(i=i.concat(this._findTransitionsFromState(this._activeStateName))).concat(this._findTransitionsFromState("ANY"));break;case"PREV_STATE_NEXT_STATE":i=(i=(i=i.concat(this._findTransitionsFromState(this._previousStateName))).concat(this._findTransitionsFromState(this._activeStateName))).concat(this._findTransitionsFromState("ANY"));break;case"NEXT_STATE_PREV_STATE":i=(i=(i=i.concat(this._findTransitionsFromState(this._activeStateName))).concat(this._findTransitionsFromState(this._previousStateName))).concat(this._findTransitionsFromState("ANY"))}else i=(i=i.concat(this._findTransitionsFromState(this._activeStateName))).concat(this._findTransitionsFromState("ANY"));return(i=i.filter(function(t){if(t.to===this.activeStateName)return!1;if(t.hasExitTime){var e=this._getActiveStateProgressForTime(this._timeInStateBefore),i=this._getActiveStateProgressForTime(this._timeInState);if(t.exitTime<1&&this.activeState.looping&&(e-=Math.floor(e),i-=Math.floor(i)),!(t.exitTime>e&&t.exitTime<=i))return null}return t.hasConditionsMet}.bind(this))).length>0?i[0]:null}_updateStateFromTransition(t){var e,i,n,r,s;for(this.previousState=t.from,this.activeState=t.to,e=0;e<t.conditions.length;e++){var a=t.conditions[e],o=this.findParameter(a.parameterName);"TRIGGER"===o.type&&(o.value=!1)}if(this.previousState){this._isTransitioning||(this._transitionPreviousStates=[]),this._transitionPreviousStates.push({name:this._previousStateName,weight:1});var l=Math.min(this._currTransitionTime/this._totalTransitionTime,1);for(e=0;e<this._transitionPreviousStates.length;e++)for(this._isTransitioning?e!==this._transitionPreviousStates.length-1?this._transitionPreviousStates[e].weight*=1-l:this._transitionPreviousStates[e].weight=l:this._transitionPreviousStates[e].weight=1,n=this._findState(this._transitionPreviousStates[e].name),i=0;i<n.animations.length;i++)r=n.animations[i],(s=this._animEvaluator.findClip(r.name+".previous."+e))||((s=this._animEvaluator.findClip(r.name)).name=r.name+".previous."+e),e!==this._transitionPreviousStates.length-1&&s.pause()}this._isTransitioning=!0,this._totalTransitionTime=t.time,this._currTransitionTime=0,this._transitionInterruptionSource=t.interruptionSource;var h=t.transitionOffset&&t.transitionOffset>0&&t.transitionOffset<1,c=this.activeState;for(e=0;e<c.animations.length;e++){if(s=this._animEvaluator.findClip(c.animations[e].name))s.reset();else{var u=Number.isFinite(c.animations[e].speed)?c.animations[e].speed:c.speed;(s=new Pl(c.animations[e].animTrack,0,u,!0,c.loop)).name=c.animations[e].name,this._animEvaluator.addClip(s)}if(t.time>0?s.blendWeight=0:s.blendWeight=c.animations[e].normalizedWeight,s.play(),h)s.time=c.timelineDuration*t.transitionOffset;else{var d=c.speed>=0?0:this.activeStateDuration;s.time=d}}var f=0,p=0;if(h){var m=c.timelineDuration*t.transitionOffset;f=m,p=m}this._timeInState=f,this._timeInStateBefore=p}_transitionToState(t){if(t!==this._activeStateName&&this._findState(t)){var e=this._findTransition(this._activeStateName,t);e||(this._animEvaluator.removeClips(),e=new Jl(this,null,t,0,0)),this._updateStateFromTransition(e)}}assignAnimation(t,e){var i=t.split("."),n=this._findState(i[0]);n&&(n.addAnimation(i,e),!this._playing&&this._activate&&this.playable&&this.play())}removeNodeAnimations(t){var e=this._findState(t);e&&(e.animations=[])}play(t){t&&this._transitionToState(t),this._playing=!0}pause(){this._playing=!1}reset(){this._previousStateName=null,this._activeStateName="START",this._playing=!1,this._currTransitionTime=1,this._totalTransitionTime=1,this._isTransitioning=!1,this._timeInState=0,this._timeInStateBefore=0,this._animEvaluator.removeClips()}update(t){if(this._playing){var e,i,n,r,s;this._timeInStateBefore=this._timeInState,this._timeInState+=t;var a=this._findTransition(this._activeStateName);if(a&&this._updateStateFromTransition(a),this._isTransitioning)if(this._currTransitionTime+=t,this._currTransitionTime<=this._totalTransitionTime){var o=this._currTransitionTime/this._totalTransitionTime;for(e=0;e<this._transitionPreviousStates.length;e++){n=this._findState(this._transitionPreviousStates[e].name);var l=this._transitionPreviousStates[e].weight;for(i=0;i<n.animations.length;i++)r=n.animations[i],(s=this._animEvaluator.findClip(r.name+".previous."+e))&&(s.blendWeight=(1-o)*r.normalizedWeight*l)}for(n=this.activeState,e=0;e<n.animations.length;e++)r=n.animations[e],this._animEvaluator.findClip(r.name).blendWeight=o*r.normalizedWeight}else{this._isTransitioning=!1;var h=this.activeStateAnimations.length,c=this._animEvaluator.clips.length;for(e=0;e<c-h;e++)this._animEvaluator.removeClip(0);for(this._transitionPreviousStates=[],n=this.activeState,e=0;e<n.animations.length;e++)r=n.animations[e],(s=this._animEvaluator.findClip(r.name))&&(s.blendWeight=r.normalizedWeight)}else if(this.activeState._blendTree.constructor===ql)for(n=this.activeState,e=0;e<n.animations.length;e++)r=n.animations[e],(s=this._animEvaluator.findClip(r.name))&&(s.blendWeight=r.normalizedWeight);this._animEvaluator.update(t)}}findParameter(t){return this._parameters[t]}}class $l extends Cl{constructor(t,e){super(t,e)}loadStateGraph(t){var e,i=this.data;i.stateGraph=t,i.parameters={};var n,r=Object.keys(t.parameters);for(e=0;e<r.length;e++){var s=r[e];i.parameters[s]={type:t.parameters[s].type,value:t.parameters[s].value}}if(i.layers=[],this.entity.model){var a=this.entity.model.model;a&&(n=a.getGraph())}else n=this.entity;function o(t,e,r,s){var a=new Wl(this,n),o=new El(a),l=new Ql(o,e,r,i.parameters,i.activate);i.layers.push(new Hl(t,l,this)),i.layerIndices[t]=s}for(e=0;e<t.layers.length;e++){var l=t.layers[e];o.bind(this)(l.name,l.states,l.transitions,e)}this.setupAnimationAssets()}setupAnimationAssets(){for(var t=0;t<this.data.layers.length;t++)for(var e=this.data.layers[t],i=e.name,n=0;n<e.states.length;n++){var r=e.states[n];if("START"!==r&&"END"!==r&&"ANY"!==r){var s=i+":"+r;this.data.animationAssets[s]||(this.data.animationAssets[s]={asset:null})}}this.loadAnimationAssets()}loadAnimationAssets(){for(var t=0;t<this.data.layers.length;t++)for(var e=this.data.layers[t],i=0;i<e.states.length;i++){var n=e.states[i],r=this.data.animationAssets[e.name+":"+n];if(r&&r.asset){var s=r.asset,a=this.system.app.assets.get(s);a&&(a.resource?this.assignAnimation(n,a.resource,e.name):(a.once("load",function(t,e){return function(i){this.assignAnimation(e,i.resource,t)}.bind(this)}.bind(this)(e.name,n)),this.system.app.assets.load(a)))}else this.removeNodeAnimations(n,e.name)}}removeStateGraph(){this.data.stateGraph=null,this.data.stateGraphAsset=null,this.data.animationAssets={},this.data.layers=[],this.data.layerIndices={},this.data.parameters={},this.data.playing=!1}resetStateGraph(){if(this.stateGraphAsset){var t=this.system.app.assets.get(this.stateGraphAsset).resource;this.loadStateGraph(t)}else this.removeStateGraph()}reset(){this.data.parameters=Object.assign({},this.data.stateGraph.parameters);for(var t=0;t<this.data.layers.length;t++){var e=this.data.layers[t].playing;this.data.layers[t].reset(),this.data.layers[t].playing=e}}findAnimationLayer(t){var e=this.data.layerIndices[t];return this.data.layers[e]||null}assignAnimation(t,e,i){if(this.data.stateGraph){var n=i?this.findAnimationLayer(i):this.baseLayer;n&&n.assignAnimation(t,e)}}removeNodeAnimations(t,e){var i=e?this.findAnimationLayer(e):this.baseLayer;i&&i.removeNodeAnimations(t)}getParameterValue(t,e){var i=this.data.parameters[t];if(i&&i.type===e)return i.value}setParameterValue(t,e,i){var n=this.data.parameters[t];n&&n.type===e&&(n.value=i)}getFloat(t){return this.getParameterValue(t,"FLOAT")}setFloat(t,e){this.setParameterValue(t,"FLOAT",e)}getInteger(t){return this.getParameterValue(t,"INTEGER")}setInteger(t,e){"number"==typeof e&&e%1==0&&this.setParameterValue(t,"INTEGER",e)}getBoolean(t){return this.getParameterValue(t,"BOOLEAN")}setBoolean(t,e){this.setParameterValue(t,"BOOLEAN",!!e)}getTrigger(t){return this.getParameterValue(t,"TRIGGER")}setTrigger(t){this.setParameterValue(t,"TRIGGER",!0)}resetTrigger(t){this.setParameterValue(t,"TRIGGER",!1)}get stateGraphAsset(){return this.data.stateGraphAsset}set stateGraphAsset(t){var e,i;null!==t?(t instanceof As?(e=t.id,(i=this.system.app.assets.get(e))||(this.system.app.assets.add(t),i=this.system.app.assets.get(e))):(e=t,i=this.system.app.assets.get(e)),i&&this.data.stateGraphAsset!==e&&(i.resource?(this.data.stateGraph=i.resource,this.loadStateGraph(this.data.stateGraph),i.on("change",function(t){this.data.stateGraph=new Ks(t._data),this.loadStateGraph(this.data.stateGraph)}.bind(this))):(i.once("load",function(t){this.data.stateGraph=t.resource,this.loadStateGraph(this.data.stateGraph)}.bind(this)),i.on("change",function(t){this.data.stateGraph=new Ks(t._data),this.loadStateGraph(this.data.stateGraph)}.bind(this)),this.system.app.assets.load(i)),this.data.stateGraphAsset=e)):this.removeStateGraph()}get animationAssets(){return this.data.animationAssets}set animationAssets(t){this.data.animationAssets=t,this.loadAnimationAssets()}get playable(){for(var t=0;t<this.data.layers.length;t++)if(!this.data.layers[t].playable)return!1;return!0}get baseLayer(){return this.data.layers.length>0?this.data.layers[0]:null}}class th{constructor(){this.stateGraphAsset=null,this.animationAssets={},this.speed=1,this.activate=!0,this.enabled=!0,this.playing=!1,this.stateGraph=null,this.layers=[],this.layerIndices={},this.parameters={}}}const eh=["enabled","speed","activate","playing"];class ih extends Il{constructor(t){super(t),this.id="anim",this.ComponentType=$l,this.DataType=th,this.schema=eh,this.on("beforeremove",this.onBeforeRemove,this),Il.bind("animationUpdate",this.onAnimationUpdate,this)}initializeComponentData(t,e,i){i=["activate","enabled","speed","playing"],super.initializeComponentData(t,e,i),e.stateGraphAsset&&(t.stateGraphAsset=e.stateGraphAsset),e.animationAssets&&(t.animationAssets=Object.assign(t.data.animationAssets,e.animationAssets))}onAnimationUpdate(t){var e=this.store;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=n.data;if(r.enabled&&n.entity.enabled&&r.playing)for(var s=0;s<r.layers.length;s++)r.layers[s].update(t*r.speed)}}}Cl._buildAccessors($l.prototype,eh);class nh extends Cl{constructor(t,e){super(t,e)}setCurrentListener(){if(this.enabled&&this.entity.audiolistener&&this.entity.enabled){this.system.current=this.entity;var t=this.system.current.getPosition();this.system.manager.listener.setPosition(t)}}onEnable(){this.setCurrentListener()}onDisable(){this.system.current===this.entity&&(this.system.current=null)}}class rh{constructor(){this.enabled=!0}}const sh=["enabled"];class ah extends Il{constructor(t,e){super(t),this.id="audiolistener",this.ComponentType=nh,this.DataType=rh,this.schema=sh,this.manager=e,this.current=null,Il.bind("update",this.onUpdate,this)}initializeComponentData(t,e,i){i=["enabled"],super.initializeComponentData(t,e,i)}onUpdate(t){if(this.current){var e=this.current.getPosition();this.manager.listener.setPosition(e);var i=this.current.getWorldTransform();this.manager.listener.setOrientation(i)}}}Cl._buildAccessors(nh.prototype,sh);class oh extends Cl{constructor(t,e){super(t,e),this.on("set_assets",this.onSetAssets,this),this.on("set_loop",this.onSetLoop,this),this.on("set_volume",this.onSetVolume,this),this.on("set_pitch",this.onSetPitch,this),this.on("set_minDistance",this.onSetMinDistance,this),this.on("set_maxDistance",this.onSetMaxDistance,this),this.on("set_rollOffFactor",this.onSetRollOffFactor,this),this.on("set_distanceModel",this.onSetDistanceModel,this),this.on("set_3d",this.onSet3d,this)}play(t){if(this.enabled&&this.entity.enabled){var e;this.channel&&this.stop();var i=this.data;if(i.sources[t])if(i["3d"]){var n=this.entity.getPosition();e=this.system.manager.playSound3d(i.sources[t],n,i),i.currentSource=t,i.channel=e}else e=this.system.manager.playSound(i.sources[t],i),i.currentSource=t,i.channel=e}}pause(){this.channel&&this.channel.pause()}unpause(){this.channel&&this.channel.paused&&this.channel.unpause()}stop(){this.channel&&(this.channel.stop(),this.channel=null)}onSetAssets(t,e,i){var n,r=[],s=i.length;if(e&&e.length)for(n=0;n<e.length;n++)if(e[n]){var a=this.system.app.assets.get(e[n]);a&&(a.off("change",this.onAssetChanged,this),a.off("remove",this.onAssetRemoved,this),this.currentSource===a.name&&this.stop())}if(s)for(n=0;n<s;n++)e.indexOf(i[n])<0&&(i[n]instanceof As?r.push(i[n].id):r.push(i[n]));!this.system._inTools&&r.length&&this.loadAudioSourceAssets(r)}onAssetChanged(t,e,i,n){"resource"===e&&(this.data.sources&&(this.data.sources[t.name]=i,this.data.currentSource===t.name&&this.channel&&(this.channel.paused?(this.play(t.name),this.pause()):this.play(t.name))))}onAssetRemoved(t){t.off("remove",this.onAssetRemoved,this),this.data.sources[t.name]&&(delete this.data.sources[t.name],this.data.currentSource===t.name&&(this.stop(),this.data.currentSource=null))}onSetLoop(t,e,i){e!=i&&this.channel&&this.channel.setLoop(i)}onSetVolume(t,e,i){e!=i&&this.channel&&this.channel.setVolume(i)}onSetPitch(t,e,i){e!=i&&this.channel&&this.channel.setPitch(i)}onSetMaxDistance(t,e,i){e!=i&&this.channel instanceof Jr&&this.channel.setMaxDistance(i)}onSetMinDistance(t,e,i){e!=i&&this.channel instanceof Jr&&this.channel.setMinDistance(i)}onSetRollOffFactor(t,e,i){e!=i&&this.channel instanceof Jr&&this.channel.setRollOffFactor(i)}onSetDistanceModel(t,e,i){e!==i&&this.channel instanceof Jr&&this.channel.setDistanceModel(i)}onSet3d(t,e,i){if(e!==i&&this.system.initialized&&this.currentSource){var n=!1,r=!1;this.channel&&(n=this.channel.paused,r=this.channel.suspended),this.play(this.currentSource),this.channel&&(this.channel.paused=n,this.channel.suspended=r)}}onEnable(){var t=this.data.assets;if(t)for(var e=this.system.app.assets,i=0,n=t.length;i<n;i++){var r=t[i];r instanceof As||(r=e.get(r)),r&&!r.resource&&e.load(r)}this.system.initialized&&(this.data.activate&&!this.channel?this.play(this.currentSource):this.unpause())}onDisable(){this.pause()}loadAudioSourceAssets(t){var e=this,i=t.map((function(t){return this.system.app.assets.get(t)}),this),n={},r=null,s=i.length,a=function(t){s--},o=function(){this.data.sources=n,this.data.currentSource=r,this.enabled&&this.activate&&r&&this.onEnable()}.bind(this);i.forEach((function(i,l){i?(r=r||i.name,i.off("change",this.onAssetChanged,this),i.on("change",this.onAssetChanged,this),i.off("remove",this.onAssetRemoved,this),i.on("remove",this.onAssetRemoved,this),i.off("error",a,this),i.on("error",a,this),i.ready((function(t){n[t.name]=t.resource,0===--s&&o()})),!i.resource&&e.enabled&&e.entity.enabled&&this.system.app.assets.load(i)):(0===--s&&o(),this.system.app.assets.on("add:"+t[l],(function(t){t.ready((function(t){e.data.sources[t.name]=t.resource})),t.resource||e.system.app.assets.load(t)})))}),this)}}class lh{constructor(){this.enabled=!0,this.assets=[],this.activate=!0,this.volume=1,this.pitch=1,this.loop=!1,this["3d"]=!0,this.minDistance=1,this.maxDistance=1e4,this.rollOffFactor=1,this.distanceModel="inverse",this.paused=!0,this.sources={},this.currentSource=null,this.channel=null}}const hh=["enabled","assets","volume","pitch","loop","activate","3d","minDistance","maxDistance","rollOffFactor","distanceModel","sources","currentSource","channel"];class ch extends Il{constructor(t,e){super(t),this.id="audiosource",this.ComponentType=oh,this.DataType=lh,this.schema=hh,this.manager=e,this.initialized=!1,Il.bind("initialize",this.onInitialize,this),Il.bind("update",this.onUpdate,this),this.on("remove",this.onRemove,this)}initializeComponentData(t,e,i){i=["activate","volume","pitch","loop","3d","minDistance","maxDistance","rollOffFactor","distanceModel","enabled","assets"],super.initializeComponentData(t,e,i),t.paused=!(t.enabled&&t.activate)}onInitialize(t){t.audiosource&&t.enabled&&t.audiosource.enabled&&t.audiosource.activate&&t.audiosource.play(t.audiosource.currentSource);var e,i=t._children,n=i.length;for(e=0;e<n;e++)i[e]instanceof ha&&this.onInitialize(i[e]);this.initialized=!0}onUpdate(t){var e=this.store;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],r=n.entity,s=n.data;if(s.enabled&&r.enabled&&s.channel instanceof Jr){var a=r.getPosition();s.channel.setPosition(a)}}}onRemove(t,e){e.channel&&(e.channel.stop(),e.channel=null)}setVolume(t){this.manager.setVolume(t)}}Cl._buildAccessors(oh.prototype,hh);class uh extends v{constructor(t,e,i){if(super(),!(t&&t instanceof Cl))throw new Error("The parentComponent argument is required and must be a Component");if(!e||"string"!=typeof e)throw new Error("The propertyName argument is required and must be a string");if(i&&"object"!=typeof i)throw new Error("If provided, the eventConfig argument must be an object");this._parentComponent=t,this._entityPropertyName=e,this._entity=null,this._app=t.system.app,this._configureEventListeners(i||{},{"entity#destroy":this._onEntityDestroy}),this._toggleLifecycleListeners("on")}_configureEventListeners(t,e){var i=this._parseEventListenerConfig(t,"external",this._parentComponent),n=this._parseEventListenerConfig(e,"internal",this);this._eventListenerConfigs=i.concat(n),this._listenerStatusFlags={},this._gainListeners={},this._loseListeners={}}_parseEventListenerConfig(t,e,i){return Object.keys(t).map((function(n,r){var s=n.split("#"),a=s[0],o=s[1],l=t[n];if(2!==s.length||"string"!=typeof a||0===a.length||"string"!=typeof o||0===o.length)throw new Error("Invalid event listener description: `"+n+"`");if("function"!=typeof l)throw new Error("Invalid or missing callback for event listener `"+n+"`");return{id:e+"_"+r+"_"+n,sourceName:a,eventName:o,callback:l,scope:i}}),this)}_toggleLifecycleListeners(t){this._parentComponent[t]("set_"+this._entityPropertyName,this._onSetEntity,this),this._parentComponent.system[t]("beforeremove",this._onParentComponentRemove,this),Il[t]("postinitialize",this._onPostInitialize,this),this._app[t]("tools:sceneloaded",this._onSceneLoaded,this);for(var e=[],i=0;i<this._eventListenerConfigs.length;++i){var n=this._eventListenerConfigs[i],r=this._app.systems[n.sourceName];r&&(-1===e.indexOf(r)&&e.push(r),r&&"gain"===n.eventName&&(this._gainListeners[n.sourceName]=n),r&&"lose"===n.eventName&&(this._loseListeners[n.sourceName]=n))}for(var s=0;s<e.length;++s)e[s][t]("add",this._onComponentAdd,this),e[s][t]("beforeremove",this._onComponentRemove,this)}_onSetEntity(t,e,i){if(i instanceof ha)this._updateEntityReference();else{if(null!=i&&"string"!=typeof i)return void console.warn("Entity field `"+this._entityPropertyName+"` was set to unexpected type '"+typeof i+"'");e!==i&&this._updateEntityReference()}}_onPostInitialize(){this._updateEntityReference()}onParentComponentEnable(){this._entity||this._updateEntityReference()}_onSceneLoaded(){this._updateEntityReference()}_updateEntityReference(){var t,e=this._parentComponent.data[this._entityPropertyName];if(e instanceof ha)e=(t=e).getGuid(),this._parentComponent.data[this._entityPropertyName]=e;else{var i=this._parentComponent.system.app.root;t=this._parentComponent.entity.isDescendantOf(i)&&e?i.findByGuid(e):null}this._entity!==t&&(this._entity&&this._onBeforeEntityChange(),this._entity=t,this._entity&&this._onAfterEntityChange(),this.fire("set:entity",this._entity))}_onBeforeEntityChange(){this._toggleEntityListeners("off"),this._callAllGainOrLoseListeners(this._loseListeners)}_onAfterEntityChange(){this._toggleEntityListeners("on"),this._callAllGainOrLoseListeners(this._gainListeners)}_onComponentAdd(t,e){var i=e.system.id;t===this._entity&&(this._callGainOrLoseListener(i,this._gainListeners),this._toggleComponentListeners("on",i))}_onComponentRemove(t,e){var i=e.system.id;t===this._entity&&(this._callGainOrLoseListener(i,this._loseListeners),this._toggleComponentListeners("off",i,!0))}_callAllGainOrLoseListeners(t){for(var e in this._entity.c)this._callGainOrLoseListener(e,t)}_callGainOrLoseListener(t,e){if(this._entity.c.hasOwnProperty(t)&&e[t]){var i=e[t];i.callback.call(i.scope)}}_toggleEntityListeners(t,e){if(this._entity)for(var i=0;i<this._eventListenerConfigs.length;++i)this._safeToggleListener(t,this._eventListenerConfigs[i],e)}_toggleComponentListeners(t,e,i){for(var n=0;n<this._eventListenerConfigs.length;++n){var r=this._eventListenerConfigs[n];r.sourceName===e&&this._safeToggleListener(t,r,i)}}_safeToggleListener(t,e,i){var n="on"===t;if(!n||!this._listenerStatusFlags[e.id]){var r=this._getEventSource(e.sourceName,i);r&&(r[t](e.eventName,e.callback,e.scope),this._listenerStatusFlags[e.id]=n)}}_getEventSource(t,e){if("entity"===t)return this._entity;var i=this._entity[t];return i||(e||console.warn("Entity has no component with name "+t),null)}_onEntityDestroy(t){this._entity===t&&(this._toggleEntityListeners("off",!0),this._entity=null)}_onParentComponentRemove(t,e){e===this._parentComponent&&(this._toggleLifecycleListeners("off"),this._toggleEntityListeners("off",!0))}hasComponent(t){return!(!this._entity||!this._entity.c)&&!!this._entity.c[t]}get entity(){return this._entity}}var dh="DEFAULT",fh="HOVER",ph="PRESSED",mh="INACTIVE",gh={};gh[dh]="_defaultTint",gh[fh]="hoverTint",gh[ph]="pressedTint",gh[mh]="inactiveTint";var vh={};vh[dh]="_defaultSpriteAsset",vh[fh]="hoverSpriteAsset",vh[ph]="pressedSpriteAsset",vh[mh]="inactiveSpriteAsset";var _h={};_h[dh]="_defaultSpriteFrame",_h[fh]="hoverSpriteFrame",_h[ph]="pressedSpriteFrame",_h[mh]="inactiveSpriteFrame";class yh extends Cl{constructor(t,e){super(t,e),this._visualState=dh,this._isHovering=!1,this._hoveringCounter=0,this._isPressed=!1,this._defaultTint=new D(1,1,1,1),this._defaultSpriteAsset=null,this._defaultSpriteFrame=0,this._imageReference=new uh(this,"imageEntity",{"element#gain":this._onImageElementGain,"element#lose":this._onImageElementLose,"element#set:color":this._onSetColor,"element#set:opacity":this._onSetOpacity,"element#set:spriteAsset":this._onSetSpriteAsset,"element#set:spriteFrame":this._onSetSpriteFrame}),this._toggleLifecycleListeners("on",t)}_toggleLifecycleListeners(t,e){this[t]("set_active",this._onSetActive,this),this[t]("set_transitionMode",this._onSetTransitionMode,this),this[t]("set_hoverTint",this._onSetTransitionValue,this),this[t]("set_pressedTint",this._onSetTransitionValue,this),this[t]("set_inactiveTint",this._onSetTransitionValue,this),this[t]("set_hoverSpriteAsset",this._onSetTransitionValue,this),this[t]("set_hoverSpriteFrame",this._onSetTransitionValue,this),this[t]("set_pressedSpriteAsset",this._onSetTransitionValue,this),this[t]("set_pressedSpriteFrame",this._onSetTransitionValue,this),this[t]("set_inactiveSpriteAsset",this._onSetTransitionValue,this),this[t]("set_inactiveSpriteFrame",this._onSetTransitionValue,this),e.app.systems.element[t]("add",this._onElementComponentAdd,this),e.app.systems.element[t]("beforeremove",this._onElementComponentRemove,this)}_onSetActive(t,e,i){e!==i&&this._updateVisualState()}_onSetTransitionMode(t,e,i){e!==i&&(this._cancelTween(),this._resetToDefaultVisualState(e),this._forceReapplyVisualState())}_onSetTransitionValue(t,e,i){e!==i&&this._forceReapplyVisualState()}_onElementComponentRemove(t){this.entity===t&&this._toggleHitElementListeners("off")}_onElementComponentAdd(t){this.entity===t&&this._toggleHitElementListeners("on")}_onImageElementLose(){this._cancelTween(),this._resetToDefaultVisualState(this.transitionMode)}_onImageElementGain(){this._storeDefaultVisualState(),this._forceReapplyVisualState()}_toggleHitElementListeners(t){if(this.entity.element){var e="on"===t;if(e&&this._hasHitElementListeners)return;this.entity.element[t]("mouseenter",this._onMouseEnter,this),this.entity.element[t]("mouseleave",this._onMouseLeave,this),this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.entity.element[t]("touchstart",this._onTouchStart,this),this.entity.element[t]("touchend",this._onTouchEnd,this),this.entity.element[t]("touchleave",this._onTouchLeave,this),this.entity.element[t]("touchcancel",this._onTouchCancel,this),this.entity.element[t]("selectstart",this._onSelectStart,this),this.entity.element[t]("selectend",this._onSelectEnd,this),this.entity.element[t]("selectenter",this._onSelectEnter,this),this.entity.element[t]("selectleave",this._onSelectLeave,this),this.entity.element[t]("click",this._onClick,this),this._hasHitElementListeners=e}}_storeDefaultVisualState(){this._imageReference.hasComponent("element")&&(this._storeDefaultColor(this._imageReference.entity.element.color),this._storeDefaultOpacity(this._imageReference.entity.element.opacity),this._storeDefaultSpriteAsset(this._imageReference.entity.element.spriteAsset),this._storeDefaultSpriteFrame(this._imageReference.entity.element.spriteFrame))}_storeDefaultColor(t){this._defaultTint.r=t.r,this._defaultTint.g=t.g,this._defaultTint.b=t.b}_storeDefaultOpacity(t){this._defaultTint.a=t}_storeDefaultSpriteAsset(t){this._defaultSpriteAsset=t}_storeDefaultSpriteFrame(t){this._defaultSpriteFrame=t}_onSetColor(t){this._isApplyingTint||(this._storeDefaultColor(t),this._forceReapplyVisualState())}_onSetOpacity(t){this._isApplyingTint||(this._storeDefaultOpacity(t),this._forceReapplyVisualState())}_onSetSpriteAsset(t){this._isApplyingSprite||(this._storeDefaultSpriteAsset(t),this._forceReapplyVisualState())}_onSetSpriteFrame(t){this._isApplyingSprite||(this._storeDefaultSpriteFrame(t),this._forceReapplyVisualState())}_onMouseEnter(t){this._isHovering=!0,this._updateVisualState(),this._fireIfActive("mouseenter",t)}_onMouseLeave(t){this._isHovering=!1,this._isPressed=!1,this._updateVisualState(),this._fireIfActive("mouseleave",t)}_onMouseDown(t){this._isPressed=!0,this._updateVisualState(),this._fireIfActive("mousedown",t)}_onMouseUp(t){this._isPressed=!1,this._updateVisualState(),this._fireIfActive("mouseup",t)}_onTouchStart(t){this._isPressed=!0,this._updateVisualState(),this._fireIfActive("touchstart",t)}_onTouchEnd(t){t.event.preventDefault(),this._isPressed=!1,this._updateVisualState(),this._fireIfActive("touchend",t)}_onTouchLeave(t){this._isPressed=!1,this._updateVisualState(),this._fireIfActive("touchleave",t)}_onTouchCancel(t){this._isPressed=!1,this._updateVisualState(),this._fireIfActive("touchcancel",t)}_onSelectStart(t){this._isPressed=!0,this._updateVisualState(),this._fireIfActive("selectstart",t)}_onSelectEnd(t){this._isPressed=!1,this._updateVisualState(),this._fireIfActive("selectend",t)}_onSelectEnter(t){this._hoveringCounter++,1===this._hoveringCounter&&(this._isHovering=!0,this._updateVisualState()),this._fireIfActive("selectenter",t)}_onSelectLeave(t){this._hoveringCounter--,0===this._hoveringCounter&&(this._isHovering=!1,this._isPressed=!1,this._updateVisualState()),this._fireIfActive("selectleave",t)}_onClick(t){this._fireIfActive("click",t)}_fireIfActive(t,e){this.data.active&&this.fire(t,e)}_updateVisualState(t){var e=this._visualState,i=this._determineVisualState();if((e!==i||t)&&this.enabled)switch(this._visualState=i,e===fh&&this._fireIfActive("hoverend"),e===ph&&this._fireIfActive("pressedend"),i===fh&&this._fireIfActive("hoverstart"),i===ph&&this._fireIfActive("pressedstart"),this.transitionMode){case 0:var n=this[gh[this._visualState]];this._applyTint(n);break;case 1:var r=vh[this._visualState],s=_h[this._visualState],a=this[r],o=this[s];this._applySprite(a,o)}}_forceReapplyVisualState(){this._updateVisualState(!0)}_resetToDefaultVisualState(t){if(this._imageReference.hasComponent("element"))switch(t){case 0:this._cancelTween(),this._applyTintImmediately(this._defaultTint);break;case 1:this._applySprite(this._defaultSpriteAsset,this._defaultSpriteFrame)}}_determineVisualState(){return this.active?this._isPressed?ph:this._isHovering?fh:dh:mh}_applySprite(t,e){e=e||0,this._imageReference.hasComponent("element")&&(this._isApplyingSprite=!0,this._imageReference.entity.element.spriteAsset=t,this._imageReference.entity.element.spriteFrame=e,this._isApplyingSprite=!1)}_applyTint(t){this._cancelTween(),0===this.fadeDuration?this._applyTintImmediately(t):this._applyTintWithTween(t)}_applyTintImmediately(t){var e;this._imageReference.hasComponent("element")&&t&&(this._isApplyingTint=!0,this._imageReference.entity.element.color=new D((e=t).r,e.g,e.b),this._imageReference.entity.element.opacity=t.a,this._isApplyingTint=!1)}_applyTintWithTween(t){if(this._imageReference.hasComponent("element")&&t){var e=this._imageReference.entity.element.color,i=this._imageReference.entity.element.opacity;this._tweenInfo={startTime:N(),from:new D(e.r,e.g,e.b,i),to:t.clone(),lerpColor:new D}}}_updateTintTween(){var t=N()-this._tweenInfo.startTime,e=0===this.fadeDuration?1:t/this.fadeDuration;if(e=k.clamp(e,0,1),Math.abs(e-1)>1e-5){var i=this._tweenInfo.lerpColor;i.lerp(this._tweenInfo.from,this._tweenInfo.to,e),this._applyTintImmediately(new D(i.r,i.g,i.b,i.a))}else this._applyTintImmediately(this._tweenInfo.to),this._cancelTween()}_cancelTween(){delete this._tweenInfo}onUpdate(){this._tweenInfo&&this._updateTintTween()}onEnable(){this._isHovering=!1,this._hoveringCounter=0,this._isPressed=!1,this._imageReference.onParentComponentEnable(),this._toggleHitElementListeners("on"),this._forceReapplyVisualState()}onDisable(){this._toggleHitElementListeners("off"),this._resetToDefaultVisualState(this.transitionMode)}onRemove(){this._toggleLifecycleListeners("off",this.system),this.onDisable()}}class bh{constructor(){this.enabled=!0,this.active=!0,this.imageEntity=null,this.hitPadding=new X,this.transitionMode=0,this.hoverTint=new D(.75,.75,.75),this.pressedTint=new D(.5,.5,.5),this.inactiveTint=new D(.25,.25,.25),this.fadeDuration=0,this.hoverSpriteAsset=null,this.hoverSpriteFrame=0,this.pressedSpriteAsset=null,this.pressedSpriteFrame=0,this.inactiveSpriteAsset=null,this.inactiveSpriteFrame=0}}const xh=["enabled","active",{name:"imageEntity",type:"entity"},{name:"hitPadding",type:"vec4"},"transitionMode",{name:"hoverTint",type:"rgba"},{name:"pressedTint",type:"rgba"},{name:"inactiveTint",type:"rgba"},"fadeDuration","hoverSpriteAsset","hoverSpriteFrame","pressedSpriteAsset","pressedSpriteFrame","inactiveSpriteAsset","inactiveSpriteFrame"];class wh extends Il{constructor(t){super(t),this.id="button",this.ComponentType=yh,this.DataType=bh,this.schema=xh,this.on("beforeremove",this._onRemoveComponent,this),Il.bind("update",this.onUpdate,this)}initializeComponentData(t,e,i){super.initializeComponentData(t,e,xh)}onUpdate(t){var e=this.store;for(var i in e){var n=e[i].entity,r=n.button;r.enabled&&n.enabled&&r.onUpdate()}}_onRemoveComponent(t,e){e.onRemove()}}var Ah;Cl._buildAccessors(yh.prototype,xh);class Ch{constructor(t,e){var i=this;this.app=t,this.camera=e,this.effects=[],this.enabled=!1,this.depthTarget=null,this.renderTargetScale=1,this.resizeTimeout=null,this.resizeLast=0,this._resizeTimeoutCallback=function(){i.resizeRenderTargets()},e.on("set_rect",this.onCameraRectChanged,this),this._origOverrideClear=!1,this._origClearColorBuffer=!1,this._origDepthColorBuffer=!1,this._origStencilColorBuffer=!1}_createOffscreenTarget(t,e){var i=this.camera.rect,n=Math.floor(i.z*this.app.graphicsDevice.width*this.renderTargetScale),r=Math.floor(i.w*this.app.graphicsDevice.height*this.renderTargetScale),s=this.app.graphicsDevice,a=e?s.getHdrFormat():7,o=this.app.graphicsDevice.supportsStencil,l=t?s.samples:1,h=new pe(s,{format:a,width:n,height:r});return h.name="posteffect #"+this.effects.length,h.minFilter=0,h.magFilter=0,h.addressU=1,h.addressV=1,new Cf(this.app.graphicsDevice,h,{depth:t,stencil:o,samples:l})}_resizeOffscreenTarget(t){var e=this.camera.rect,i=Math.floor(e.z*this.app.graphicsDevice.width*this.renderTargetScale),n=Math.floor(e.w*this.app.graphicsDevice.height*this.renderTargetScale),r=this.app.graphicsDevice,s=t.colorBuffer.format;t._colorBuffer.destroy();var a=new pe(r,{format:s,width:i,height:n});a.name="posteffect",a.minFilter=0,a.magFilter=0,a.addressU=1,a.addressV=1,t._colorBuffer=a,t.destroy()}_destroyOffscreenTarget(t){t._colorBuffer&&t._colorBuffer.destroy(),t._depthBuffer&&t._depthBuffer.destroy(),t.destroy()}setRenderTargetScale(t){this.renderTargetScale=t,this.resizeRenderTargets()}addEffect(t){var e=0===this.effects.length,i=this.effects,n={effect:t,inputTarget:this._createOffscreenTarget(e,t.hdr),outputTarget:null};if(!this.layer){this.layer=new Ii({opaqueSortMode:0,transparentSortMode:0,passThrough:!0,name:"PostEffectQueue",renderTarget:this.camera.renderTarget,clear:!1,onPostRender:function(){for(var t=0;t<this._commandList.length;t++)this._commandList[t]()}});var r,s=this.app.scene.layers.layerList,a=0,o=s.length-1;for(r=o;r>=0;r--)if(4===s[r].id){o=r-1,this._origOverrideClear=s[r].overrideClear,this._origClearColorBuffer=s[r].clearColorBuffer,this._origDepthColorBuffer=s[r].clearDepthBuffer,this._origStencilColorBuffer=s[r].clearStencilBuffer,s[r].overrideClear=!0,s[r].clearColorBuffer=!1,s[r].clearDepthBuffer=this.camera.clearDepthBuffer,s[r].clearStencilBuffer=this.camera.clearStencilBuffer;break}for(this._sourceLayers=[],r=0;r<this.camera.layers.length;r++){var l=this.camera.layers[r],h=this.app.scene.layers.getLayerById(l),c=this.app.scene.layers.layerList.indexOf(h);c<=o&&(1!=l&&(h.renderTarget=n.inputTarget,this._sourceLayers.push(h)),c>a&&(a=c))}this.app.scene.layers.insertOpaque(this.layer,a+1),this._sourceTarget=n.inputTarget,this.layer._commandList=[],this.layer.isPostEffect=!0}i.push(n);var u=i.length;u>1&&(i[u-2].outputTarget=n.inputTarget),this._newPostEffect=t,t.needsDepthBuffer&&this._requestDepthMap(),this.enable(),this._newPostEffect=void 0}removeEffect(t){var e,i,n=-1;for(e=0,i=this.effects.length;e<i;e++)if(this.effects[e].effect===t){n=e;break}if(n>=0){if(n>0)this.effects[n-1].outputTarget=n+1<this.effects.length?this.effects[n+1].inputTarget:null;else if(this.effects.length>1)for(this.effects[1].inputTarget._depth||(this._destroyOffscreenTarget(this.effects[1].inputTarget),this.effects[1].inputTarget=this._createOffscreenTarget(!0,this.effects[1].hdr),this._sourceTarget=this.effects[1].inputTarget),e=0;e<this._sourceLayers.length;e++)this._sourceLayers[e].renderTarget=this.effects[1].inputTarget;this._destroyOffscreenTarget(this.effects[n].inputTarget),this.effects.splice(n,1)}this.enabled&&t.needsDepthBuffer&&this._releaseDepthMap(),0===this.effects.length&&this.disable()}_requestDepthMaps(){for(var t=0,e=this.effects.length;t<e;t++){var i=this.effects[t].effect;this._newPostEffect!==i&&(i.needsDepthBuffer&&this._requestDepthMap())}}_releaseDepthMaps(){for(var t=0,e=this.effects.length;t<e;t++){this.effects[t].effect.needsDepthBuffer&&this._releaseDepthMap()}}_requestDepthMap(){Ah||(Ah=this.app.scene.layers.getLayerById(1)),Ah&&Ah.incrementCounter()}_releaseDepthMap(){Ah&&Ah.decrementCounter()}destroy(){for(var t=0,e=this.effects.length;t<e;t++)this.effects[t].inputTarget.destroy();this.effects.length=0,this.disable()}enable(){if(!this.enabled&&this.effects.length){this.enabled=!0;var t=this;this._requestDepthMaps(),this.app.graphicsDevice.on("resizecanvas",this._onCanvasResized,this),this.command=function(){if(t.enabled){var e=null,i=t.effects.length;if(i){t.layer.renderTarget=t.effects[0].inputTarget;for(var n=0;n<i;n++){var r=t.effects[n];n===i-1&&(e=t.camera.rect),r.effect.render(r.inputTarget,r.outputTarget,e)}}}},this.layer._commandList.push(this.command)}}disable(){if(this.enabled){this.enabled=!1,this.app.graphicsDevice.off("resizecanvas",this._onCanvasResized,this),this._releaseDepthMaps(),this._destroyOffscreenTarget(this._sourceTarget);var t=this.layer._commandList.indexOf(this.command);t>=0&&this.layer._commandList.splice(t,1);var e=this.app.scene.layers.layerList,i=e.length-1;for(t=0;t<=e.length;t++)if(4===e[t].id){i=t-1,e[t].overrideClear=this._origOverrideClear,e[t].clearColorBuffer=this._origClearColorBuffer,e[t].clearDepthBuffer=this._origDepthColorBuffer,e[t].clearStencilBuffer=this._origStencilColorBuffer;break}for(t=i;t>=0;t--)e[t].cameras.indexOf(this.camera)>=0&&(e[t].renderTarget=void 0);this.app.scene.layers.removeOpaque(this.layer),this.layer=null}}_onCanvasResized(t,e){var i=this.camera.rect,n=this.app.graphicsDevice;this.camera.camera.aspectRatio=n.width*i.z/(n.height*i.w),this.resizeTimeout||(N()-this.resizeLast>100?this.resizeRenderTargets():this.resizeTimeout=setTimeout(this._resizeTimeoutCallback,100))}resizeRenderTargets(){this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.resizeLast=N();for(var t=this.camera.rect,e=Math.floor(t.z*this.app.graphicsDevice.width*this.renderTargetScale),i=Math.floor(t.w*this.app.graphicsDevice.height*this.renderTargetScale),n=this.effects,r=0,s=n.length;r<s;r++){var a=n[r];a.inputTarget.width===e&&a.inputTarget.height===i||this._resizeOffscreenTarget(a.inputTarget)}}onCameraRectChanged(t,e,i){this.enabled&&this.resizeRenderTargets()}}class Ih extends Cl{constructor(t,e){super(t,e),this._camera=new Qe,this._camera.node=e,this._priority=0,this._postEffects=new Ch(t.app,this)}get camera(){return this._camera}get layers(){return this._camera.layers}set layers(t){var e,i,n=this._camera.layers;for(e=0;e<n.length;e++)(i=this.system.app.scene.layers.getLayerById(n[e]))&&i.removeCamera(this);if(this._camera.layers=t,this.enabled&&this.entity.enabled)for(e=0;e<t.length;e++)(i=this.system.app.scene.layers.getLayerById(t[e]))&&i.addCamera(this)}get postEffects(){return this._postEffects}get priority(){return this._priority}set priority(t){this._priority=t;for(var e=this.layers,i=0;i<e.length;i++){var n=this.system.app.scene.layers.getLayerById(e[i]);n&&n._sortCameras()}}screenToWorld(t,e,i,n){var r=this.system.app.graphicsDevice,s=r.clientRect.width,a=r.clientRect.height;return this._camera.screenToWorld(t,e,i,s,a,n)}worldToScreen(t,e){var i=this.system.app.graphicsDevice,n=i.clientRect.width,r=i.clientRect.height;return this._camera.worldToScreen(t,n,r,e)}onPrerender(){this._camera._viewMatDirty=!0,this._camera._viewProjMatDirty=!0}addCameraToLayers(){for(var t=this.layers,e=0;e<t.length;e++){var i=this.system.app.scene.layers.getLayerById(t[e]);i&&i.addCamera(this)}}removeCameraFromLayers(){for(var t=this.layers,e=0;e<t.length;e++){var i=this.system.app.scene.layers.getLayerById(t[e]);i&&i.removeCamera(this)}}onLayersChanged(t,e){this.addCameraToLayers(),t.off("add",this.onLayerAdded,this),t.off("remove",this.onLayerRemoved,this),e.on("add",this.onLayerAdded,this),e.on("remove",this.onLayerRemoved,this)}onLayerAdded(t){this.layers.indexOf(t.id)<0||t.addCamera(this)}onLayerRemoved(t){this.layers.indexOf(t.id)<0||t.removeCamera(this)}onEnable(){var t=this.system,e=t.app.scene,i=e.layers;t.addCamera(this),e.on("set:layers",this.onLayersChanged,this),i&&(i.on("add",this.onLayerAdded,this),i.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&this.addCameraToLayers(),this.postEffects.enable()}onDisable(){var t=this.system,e=t.app.scene,i=e.layers;this.postEffects.disable(),this.removeCameraFromLayers(),e.off("set:layers",this.onLayersChanged,this),i&&(i.off("add",this.onLayerAdded,this),i.off("remove",this.onLayerRemoved,this)),t.removeCamera(this)}onRemove(){this.onDisable(),this.off()}calculateAspectRatio(t){var e=t||this.system.app.graphicsDevice,i=this.rect;return e.width*i.z/(e.height*i.w)}frameBegin(t){0===this.aspectRatioMode&&(this.aspectRatio=this.calculateAspectRatio(t))}frameEnd(){}enterVr(t,e){if(t instanceof Function&&!e&&(e=t,t=null),this.system.app.vr)if(t||(t=this.system.app.vr.display),t){var i=this;t.capabilities.canPresent?t.requestPresent((function(n){n||(i.vrDisplay=t,i.vrDisplay.once("beforepresentchange",(function(t){t.presenting||(i.vrDisplay=null)}))),e(n)})):(i.vrDisplay=t,e())}else e("No pc.VrDisplay to present");else e("VrManager not created. Enable VR in project settings.")}exitVr(t){if(this.vrDisplay)if(this.vrDisplay.capabilities.canPresent){var e=this.vrDisplay;this.vrDisplay=null,e.exitPresent(t)}else this.vrDisplay=null,t();else t("Not presenting VR")}startXr(t,e,i){this.system.app.xr.start(this,t,e,i)}endXr(t){this._camera.xr?this._camera.xr.end(t):t&&t(new Error("Camera is not in XR"))}}[{name:"aspectRatio",readonly:!1},{name:"aspectRatioMode",readonly:!1},{name:"calculateProjection",readonly:!1},{name:"calculateTransform",readonly:!1},{name:"clearColor",readonly:!1},{name:"clearColorBuffer",readonly:!1},{name:"clearDepthBuffer",readonly:!1},{name:"clearStencilBuffer",readonly:!1},{name:"cullFaces",readonly:!1},{name:"farClip",readonly:!1},{name:"flipFaces",readonly:!1},{name:"fov",readonly:!1},{name:"frustum",readonly:!0},{name:"frustumCulling",readonly:!1},{name:"horizontalFov",readonly:!1},{name:"nearClip",readonly:!1},{name:"orthoHeight",readonly:!1},{name:"projection",readonly:!1},{name:"projectionMatrix",readonly:!0},{name:"rect",readonly:!1},{name:"renderTarget",readonly:!1},{name:"scissorRect",readonly:!1},{name:"viewMatrix",readonly:!0},{name:"vrDisplay",readonly:!1}].forEach((function(t){var e=t.name,i={get:function(){return this._camera[e]}};t.readonly||(i.set=function(t){this._camera[e]=t}),Object.defineProperty(Ih.prototype,e,i)}));class Sh{constructor(){this.enabled=!0}}const Mh=["enabled"];class Th extends Il{constructor(t){super(t),this.id="camera",this.ComponentType=Ih,this.DataType=Sh,this.schema=Mh,this.cameras=[],this.on("beforeremove",this.onBeforeRemove,this),this.app.on("prerender",this.onPrerender,this),Il.bind("update",this.onUpdate,this)}initializeComponentData(t,e,i){i=["aspectRatio","aspectRatioMode","calculateProjection","calculateTransform","clearColor","clearColorBuffer","clearDepthBuffer","clearStencilBuffer","cullFaces","farClip","flipFaces","fov","frustumCulling","horizontalFov","layers","renderTarget","nearClip","orthoHeight","projection","priority","rect","scissorRect"];for(var n=0;n<i.length;n++){var r=i[n];if(e.hasOwnProperty(r)){var s=e[r];switch(r){case"rect":case"scissorRect":Array.isArray(s)?t[r]=new X(s[0],s[1],s[2],s[3]):t[r]=s;break;case"clearColor":Array.isArray(s)?t[r]=new D(s[0],s[1],s[2],s[3]):t[r]=s;break;default:t[r]=s}}}super.initializeComponentData(t,e,["enabled"])}cloneComponent(t,e){var i=t.camera;this.addComponent(e,{aspectRatio:i.aspectRatio,aspectRatioMode:i.aspectRatioMode,calculateProjection:i.calculateProjection,calculateTransform:i.calculateTransform,clearColor:i.clearColor,clearColorBuffer:i.clearColorBuffer,clearDepthBuffer:i.clearDepthBuffer,clearStencilBuffer:i.clearStencilBuffer,cullFaces:i.cullFaces,farClip:i.farClip,flipFaces:i.flipFaces,fov:i.fov,frustumCulling:i.frustumCulling,horizontalFov:i.horizontalFov,layers:i.layers,renderTarget:i.renderTarget,nearClip:i.nearClip,orthoHeight:i.orthoHeight,projection:i.projection,priority:i.priority,rect:i.rect,scissorRect:i.scissorRect})}onBeforeRemove(t,e){this.removeCamera(e)}onUpdate(t){if(this.app.vr){var e=this.store;for(var i in e){var n=e[i];if(n.data.enabled&&n.entity.enabled){var r=n.entity.camera,s=r.vrDisplay;s&&(s.setClipPlanes(r.nearClip,r.farClip),n.entity&&(n.entity.localTransform.copy(s.combinedViewInv),n.entity._dirtyLocal=!1,n.entity._dirtifyWorld()))}}}}onPrerender(){for(var t=0,e=this.cameras.length;t<e;t++)this.cameras[t].onPrerender()}addCamera(t){this.cameras.push(t),this.sortCamerasByPriority()}removeCamera(t){var e=this.cameras.indexOf(t);e>=0&&(this.cameras.splice(e,1),this.sortCamerasByPriority())}sortCamerasByPriority(){this.cameras.sort((function(t,e){return t.priority-e.priority}))}}Cl._buildAccessors(Ih.prototype,Mh);class Ph extends Cl{constructor(t,e){super(t,e),this._compoundParent=null,this.entity.on("insert",this._onInsert,this),this.on("set_type",this.onSetType,this),this.on("set_halfExtents",this.onSetHalfExtents,this),this.on("set_radius",this.onSetRadius,this),this.on("set_height",this.onSetHeight,this),this.on("set_axis",this.onSetAxis,this),this.on("set_asset",this.onSetAsset,this),this.on("set_model",this.onSetModel,this)}onSetType(t,e,i){e!==i&&this.system.changeType(this,e,i)}onSetHalfExtents(t,e,i){var n=this.data.type;this.data.initialized&&"box"===n&&this.system.recreatePhysicalShapes(this)}onSetRadius(t,e,i){var n=this.data.type;!this.data.initialized||"sphere"!==n&&"capsule"!==n&&"cylinder"!==n&&"cone"!==n||this.system.recreatePhysicalShapes(this)}onSetHeight(t,e,i){var n=this.data.type;!this.data.initialized||"capsule"!==n&&"cylinder"!==n&&"cone"!==n||this.system.recreatePhysicalShapes(this)}onSetAxis(t,e,i){var n=this.data.type;!this.data.initialized||"capsule"!==n&&"cylinder"!==n&&"cone"!==n||this.system.recreatePhysicalShapes(this)}onSetAsset(t,e,i){var n,r=this.system.app.assets;e&&(n=r.get(e))&&n.off("remove",this.onAssetRemoved,this),i&&(i instanceof As&&(this.data.asset=i.id),(n=r.get(this.data.asset))&&(n.off("remove",this.onAssetRemoved,this),n.on("remove",this.onAssetRemoved,this))),this.data.initialized&&"mesh"===this.data.type&&(i||(this.data.model=null),this.system.recreatePhysicalShapes(this))}onSetModel(t,e,i){this.data.initialized&&"mesh"===this.data.type&&this.system.implementations.mesh.doRecreatePhysicalShape(this)}onAssetRemoved(t){t.off("remove",this.onAssetRemoved,this),this.data.asset===t.id&&(this.asset=null)}_getCompoundChildShapeIndex(t){for(var e=this.data.shape,i=e.getNumChildShapes(),n=0;n<i;n++){if(e.getChildShape(n).ptr===t.ptr)return n}return null}_onInsert(t){if("undefined"!=typeof Ammo)if(this._compoundParent)this.system.recreatePhysicalShapes(this);else if(!this.entity.rigidbody)for(var e=this.entity.parent;e;){if(e.collision&&"compound"===e.collision.type){0===e.collision.shape.getNumChildShapes()?this.system.recreatePhysicalShapes(e.collision):this.system.recreatePhysicalShapes(this);break}e=e.parent}}_updateCompound(){var t=this.entity;if(t._dirtyWorld){for(var e=t._dirtyLocal,i=t;i&&!e&&(!i.collision||i.collision!==this._compoundParent);)i._dirtyLocal&&(e=!0),i=i.parent;if(e){t.forEach(this.system.implementations.compound._updateEachDescendantTransform,t);var n=this._compoundParent.entity.rigidbody;n&&n.activate()}}}onEnable(){if("mesh"===this.data.type&&this.data.asset&&this.data.initialized){var t=this.system.app.assets.get(this.data.asset);if(t&&(!t.resource||!this.data.shape))return void this.system.recreatePhysicalShapes(this)}if(this.entity.rigidbody)this.entity.rigidbody.enabled&&this.entity.rigidbody.enableSimulation();else if(this._compoundParent&&this!==this._compoundParent)if(0===this._compoundParent.shape.getNumChildShapes())this.system.recreatePhysicalShapes(this._compoundParent);else{var e=this.system._getNodeTransform(this.entity,this._compoundParent.entity);this._compoundParent.shape.addChildShape(e,this.data.shape),Ammo.destroy(e),this._compoundParent.entity.rigidbody&&this._compoundParent.entity.rigidbody.activate()}else this.entity.trigger&&this.entity.trigger.enable()}onDisable(){this.entity.rigidbody?this.entity.rigidbody.disableSimulation():this._compoundParent&&this!==this._compoundParent?this._compoundParent.entity._destroying||(this.system._removeCompoundChild(this._compoundParent,this.data.shape),this._compoundParent.entity.rigidbody&&this._compoundParent.entity.rigidbody.activate()):this.entity.trigger&&this.entity.trigger.disable()}onBeforeRemove(){this.asset&&(this.asset=null),this.entity.off("insert",this._onInsert,this),this.off()}}class Eh{constructor(){this.enabled=!0,this.type="box",this.halfExtents=new H(.5,.5,.5),this.radius=.5,this.axis=1,this.height=2,this.asset=null,this.shape=null,this.model=null,this.initialized=!1}}var kh,Dh,Oh;class Rh{constructor(t,e,i){this.entity=e.entity,this.component=e,this.app=t,"undefined"==typeof Ammo||kh||(kh=new Ammo.btVector3,Dh=new Ammo.btQuaternion,Oh=new Ammo.btTransform),this.initialize(i)}initialize(t){var e=this.entity,i=t.shape;if(i&&"undefined"!=typeof Ammo){e.trigger&&e.trigger.destroy();var n=e.getPosition(),r=e.getRotation();kh.setValue(n.x,n.y,n.z),Dh.setValue(r.x,r.y,r.z,r.w),Oh.setOrigin(kh),Oh.setRotation(Dh);var s=this.app.systems.rigidbody.createBody(1,i,Oh);s.setRestitution(0),s.setFriction(0),s.setDamping(0,0),kh.setValue(0,0,0),s.setLinearFactor(kh),s.setAngularFactor(kh),s.setCollisionFlags(4|s.getCollisionFlags()),s.entity=e,this.body=s,this.component.enabled&&e.enabled&&this.enable()}}destroy(){var t=this.body;t&&(this.disable(),this.app.systems.rigidbody.destroyBody(t))}_getEntityTransform(t){var e=this.entity.getPosition(),i=this.entity.getRotation();kh.setValue(e.x,e.y,e.z),Dh.setValue(i.x,i.y,i.z,i.w),t.setOrigin(kh),t.setRotation(Dh)}updateTransform(){this._getEntityTransform(Oh);var t=this.body;t.setWorldTransform(Oh),t.activate()}enable(){var t=this.body;if(t){var e=this.app.systems;e.rigidbody.addBody(t,16,65517),e.rigidbody._triggers.push(this),t.forceActivationState(1),this.updateTransform()}}disable(){var t=this.body;if(t){var e=this.app.systems,i=e.rigidbody._triggers.indexOf(this);i>-1&&e.rigidbody._triggers.splice(i,1),e.rigidbody.removeBody(t),t.forceActivationState(5)}}}var Lh=new Q,Nh=new H,zh=new $;const Bh=["enabled","type","halfExtents","radius","axis","height","asset","shape","model"];class Fh{constructor(t){this.system=t}beforeInitialize(t,e){e.shape=null,e.model=new Ne,e.model.graph=new _i}afterInitialize(t,e){this.recreatePhysicalShapes(t),t.data.initialized=!0}reset(t,e){this.beforeInitialize(t,e),this.afterInitialize(t,e)}recreatePhysicalShapes(t){var e=t.entity,i=t.data;if("undefined"!=typeof Ammo){e.trigger&&(e.trigger.destroy(),delete e.trigger),i.shape&&(t._compoundParent&&(this.system._removeCompoundChild(t._compoundParent,i.shape),t._compoundParent.entity.rigidbody&&t._compoundParent.entity.rigidbody.activate()),Ammo.destroy(i.shape),i.shape=null),i.shape=this.createPhysicalShape(t.entity,i);var n=!t._compoundParent;if("compound"!==i.type||t._compoundParent&&t!==t._compoundParent){if("compound"!==i.type&&(t._compoundParent&&t===t._compoundParent&&e.forEach(this.system.implementations.compound._updateEachDescendant,t),!t.rigidbody)){t._compoundParent=null;for(var r=e.parent;r;){if(r.collision&&"compound"===r.collision.type){t._compoundParent=r.collision;break}r=r.parent}}}else t._compoundParent=t,e.forEach(this._addEachDescendant,t);t._compoundParent&&t!==t._compoundParent&&(n&&0===t._compoundParent.shape.getNumChildShapes()?this.system.recreatePhysicalShapes(t._compoundParent):(this.system.updateCompoundChildTransform(e),t._compoundParent.entity.rigidbody&&t._compoundParent.entity.rigidbody.activate())),e.rigidbody?(e.rigidbody.disableSimulation(),e.rigidbody.createBody(),e.enabled&&e.rigidbody.enabled&&e.rigidbody.enableSimulation()):t._compoundParent||(e.trigger?e.trigger.initialize(i):e.trigger=new Rh(this.system.app,t,i))}}createPhysicalShape(t,e){}updateTransform(t,e,i,n){t.entity.trigger&&t.entity.trigger.updateTransform()}beforeRemove(t,e){e.data.shape&&(e._compoundParent&&!e._compoundParent.entity._destroying&&(this.system._removeCompoundChild(e._compoundParent,e.data.shape),e._compoundParent.entity.rigidbody&&e._compoundParent.entity.rigidbody.activate()),e._compoundParent=null,Ammo.destroy(e.data.shape),e.data.shape=null)}remove(t,e){var i=this.system.app;t.rigidbody&&t.rigidbody.body&&(i.systems.rigidbody.removeBody(t.rigidbody.body),t.rigidbody.disableSimulation()),t.trigger&&(t.trigger.destroy(),delete t.trigger),i.scene.containsModel(e.model)&&(i.root.removeChild(e.model.graph),i.scene.removeModel(e.model))}clone(t,e){var i=this.system.store[t.getGuid()],n={enabled:i.data.enabled,type:i.data.type,halfExtents:[i.data.halfExtents.x,i.data.halfExtents.y,i.data.halfExtents.z],radius:i.data.radius,axis:i.data.axis,height:i.data.height,asset:i.data.asset,model:i.data.model};return this.system.addComponent(e,n)}}class jh extends Fh{constructor(t){super(t)}createPhysicalShape(t,e){if("undefined"!=typeof Ammo){var i=e.halfExtents,n=new Ammo.btVector3(i?i.x:.5,i?i.y:.5,i?i.z:.5),r=new Ammo.btBoxShape(n);return Ammo.destroy(n),r}}}class Vh extends Fh{constructor(t){super(t)}createPhysicalShape(t,e){if("undefined"!=typeof Ammo)return new Ammo.btSphereShape(e.radius)}}class Uh extends Fh{constructor(t){super(t)}createPhysicalShape(t,e){var i=null,n=void 0!==e.axis?e.axis:1,r=e.radius||.5,s=Math.max((e.height||2)-2*r,0);if("undefined"!=typeof Ammo)switch(n){case 0:i=new Ammo.btCapsuleShapeX(r,s);break;case 1:i=new Ammo.btCapsuleShape(r,s);break;case 2:i=new Ammo.btCapsuleShapeZ(r,s)}return i}}class Gh extends Fh{constructor(t){super(t)}createPhysicalShape(t,e){var i=null,n=null,r=void 0!==e.axis?e.axis:1,s=void 0!==e.radius?e.radius:.5,a=void 0!==e.height?e.height:1;if("undefined"!=typeof Ammo)switch(r){case 0:i=new Ammo.btVector3(.5*a,s,s),n=new Ammo.btCylinderShapeX(i);break;case 1:i=new Ammo.btVector3(s,.5*a,s),n=new Ammo.btCylinderShape(i);break;case 2:i=new Ammo.btVector3(s,s,.5*a),n=new Ammo.btCylinderShapeZ(i)}return i&&Ammo.destroy(i),n}}class Wh extends Fh{constructor(t){super(t)}createPhysicalShape(t,e){var i=null,n=void 0!==e.axis?e.axis:1,r=void 0!==e.radius?e.radius:.5,s=void 0!==e.height?e.height:1;if("undefined"!=typeof Ammo)switch(n){case 0:i=new Ammo.btConeShapeX(r,s);break;case 1:i=new Ammo.btConeShape(r,s);break;case 2:i=new Ammo.btConeShapeZ(r,s)}return i}}class Hh extends Fh{constructor(t){super(t)}beforeInitialize(t,e){}createPhysicalShape(t,e){if("undefined"!=typeof Ammo&&e.model){var i,n,r=e.model,s=new Ammo.btCompoundShape;for(i=0;i<r.meshInstances.length;i++){var a,o=r.meshInstances[i],l=o.mesh;if(this.system._triMeshCache[l.id])a=this.system._triMeshCache[l.id];else{var h,c=l.indexBuffer[0],u=l.vertexBuffer,d=u.getFormat(),f=d.size/4;for(n=0;n<d.elements.length;n++){var p=d.elements[n];"POSITION"===p.name&&(h=new Float32Array(u.lock(),p.offset))}var m,g,v,_=new Uint16Array(c.lock()),y=l.primitive[0].count/3,b=new Ammo.btVector3,x=new Ammo.btVector3,w=new Ammo.btVector3,A=l.primitive[0].base;for(a=new Ammo.btTriangleMesh,this.system._triMeshCache[l.id]=a,n=0;n<y;n++)m=_[A+3*n]*f,g=_[A+3*n+1]*f,v=_[A+3*n+2]*f,b.setValue(h[m],h[m+1],h[m+2]),x.setValue(h[g],h[g+1],h[g+2]),w.setValue(h[v],h[v+1],h[v+2]),a.addTriangle(b,x,w,!0);Ammo.destroy(b),Ammo.destroy(x),Ammo.destroy(w)}var C=new Ammo.btBvhTriangleMeshShape(a,!0),I=this.system._getNodeScaling(o.node);C.setLocalScaling(I),Ammo.destroy(I);var S=this.system._getNodeTransform(o.node);s.addChildShape(S,C),Ammo.destroy(S)}var M=t.getWorldTransform().getScale(),T=new Ammo.btVector3(M.x,M.y,M.z);return s.setLocalScaling(T),Ammo.destroy(T),s}}recreatePhysicalShapes(t){null!==t.data.asset&&t.enabled&&t.entity.enabled?this.loadModelAsset(t):this.doRecreatePhysicalShape(t)}loadModelAsset(t){var e=this,i=t.data.asset,n=t.data,r=this.system.app.assets,s=r.get(i);s?(s.ready((function(i){n.model=i.resource,e.doRecreatePhysicalShape(t)})),r.load(s)):r.once("add:"+i,(function(i){i.ready((function(i){n.model=i.resource,e.doRecreatePhysicalShape(t)})),r.load(i)}))}doRecreatePhysicalShape(t){var e=t.entity,i=t.data;i.model?(this.destroyShape(i),i.shape=this.createPhysicalShape(e,i),e.rigidbody?(e.rigidbody.disableSimulation(),e.rigidbody.createBody(),e.enabled&&e.rigidbody.enabled&&e.rigidbody.enableSimulation()):e.trigger?e.trigger.initialize(i):e.trigger=new Rh(this.system.app,t,i)):(this.beforeRemove(e,t),this.remove(e,i))}updateTransform(t,e,i,n){if(t.shape){var r=t.entity.getWorldTransform().getScale(),s=t.shape.getLocalScaling();r.x===s.x()&&r.y===s.y()&&r.z===s.z()||this.doRecreatePhysicalShape(t)}super.updateTransform(t,e,i,n)}destroyShape(t){if(t.shape){for(var e=t.shape.getNumChildShapes(),i=0;i<e;i++){var n=t.shape.getChildShape(i);Ammo.destroy(n)}Ammo.destroy(t.shape),t.shape=null}}remove(t,e){this.destroyShape(e),super.remove(t,e)}}class Xh extends Fh{constructor(t){super(t)}createPhysicalShape(t,e){if("undefined"!=typeof Ammo)return new Ammo.btCompoundShape}_addEachDescendant(t){t.collision&&!t.rigidbody&&(t.collision._compoundParent=this,t!==this.entity&&t.collision.system.recreatePhysicalShapes(t.collision))}_updateEachDescendant(t){t.collision&&t.collision._compoundParent===this&&(t.collision._compoundParent=null,t===this.entity||t.rigidbody||t.collision.system.recreatePhysicalShapes(t.collision))}_updateEachDescendantTransform(t){t.collision&&t.collision._compoundParent===this.collision._compoundParent&&this.collision.system.updateCompoundChildTransform(t)}}class Zh extends Il{constructor(t){super(t),this.id="collision",this.ComponentType=Ph,this.DataType=Eh,this.schema=Bh,this.implementations={},this._triMeshCache={},this.on("beforeremove",this.onBeforeRemove,this),this.on("remove",this.onRemove,this)}initializeComponentData(t,e,i){for(var n,r={},s=0,a=(i=["type","halfExtents","radius","axis","height","shape","model","asset","enabled"]).length;s<a;s++){var o=i[s];r[o]=e[o]}e.hasOwnProperty("asset")?-1!==(n=i.indexOf("model"))&&i.splice(n,1):e.hasOwnProperty("model")&&-1!==(n=i.indexOf("asset"))&&i.splice(n,1),r.type||(r.type=t.data.type),t.data.type=r.type,r.halfExtents&&Array.isArray(r.halfExtents)&&(r.halfExtents=new H(r.halfExtents[0],r.halfExtents[1],r.halfExtents[2]));var l=this._createImplementation(r.type);l.beforeInitialize(t,r),super.initializeComponentData(t,r,i),l.afterInitialize(t,r)}_createImplementation(t){if(void 0===this.implementations[t]){var e;switch(t){case"box":e=new jh(this);break;case"sphere":e=new Vh(this);break;case"capsule":e=new Uh(this);break;case"cylinder":e=new Gh(this);break;case"cone":e=new Wh(this);break;case"mesh":e=new Hh(this);break;case"compound":e=new Xh(this)}this.implementations[t]=e}return this.implementations[t]}_getImplementation(t){return this.implementations[t.collision.data.type]}cloneComponent(t,e){return this._getImplementation(t).clone(t,e)}onBeforeRemove(t,e){this.implementations[e.data.type].beforeRemove(t,e),e.onBeforeRemove()}onRemove(t,e){this.implementations[e.type].remove(t,e)}updateCompoundChildTransform(t){if(this._removeCompoundChild(t.collision._compoundParent,t.collision.data.shape),t.enabled&&t.collision.enabled){var e=this._getNodeTransform(t,t.collision._compoundParent.entity);t.collision._compoundParent.shape.addChildShape(e,t.collision.data.shape),Ammo.destroy(e)}}_removeCompoundChild(t,e){if(t.shape.removeChildShape)t.shape.removeChildShape(e);else{var i=t._getCompoundChildShapeIndex(e);null!==i&&t.shape.removeChildShapeByIndex(i)}}onTransformChanged(t,e,i,n){this.implementations[t.data.type].updateTransform(t,e,i,n)}changeType(t,e,i){this.implementations[e].beforeRemove(t.entity,t),this.implementations[e].remove(t.entity,t.data),this._createImplementation(i).reset(t,t.data)}recreatePhysicalShapes(t){this.implementations[t.data.type].recreatePhysicalShapes(t)}_calculateNodeRelativeTransform(t,e){if(t===e){var i=t.getWorldTransform().getScale();Lh.setScale(i.x,i.y,i.z)}else this._calculateNodeRelativeTransform(t.parent,e),Lh.mul(t.getLocalTransform())}_getNodeScaling(t){var e=t.getWorldTransform().getScale();return new Ammo.btVector3(e.x,e.y,e.z)}_getNodeTransform(t,e){var i,n;e?(this._calculateNodeRelativeTransform(t,e),i=Nh,n=zh,Lh.getTranslation(i),n.setFromMat4(Lh)):(i=t.getPosition(),n=t.getRotation());var r=new Ammo.btTransform;r.setIdentity();var s=r.getOrigin();s.setValue(i.x,i.y,i.z);var a=new Ammo.btQuaternion;return a.setValue(n.x,n.y,n.z,n.w),r.setRotation(a),Ammo.destroy(a),Ammo.destroy(s),r}destroy(){for(var t in this._triMeshCache)Ammo.destroy(this._triMeshCache[t]);this._triMeshCache=null,super.destroy()}}Cl._buildAccessors(Ph.prototype,Bh);class Yh{constructor(){this.list=[]}add(t){var e=t.id;if(this[e])throw new Error("ComponentSystem name '"+e+"' already registered or not allowed");this[e]=t,this.list.push(t)}remove(t){var e=t.id;if(!this[e])throw new Error("No ComponentSystem named '"+e+"' registered");delete this[e];var i=this.list.indexOf(this[e]);-1!==i&&this.list.splice(i,1)}}class qh{constructor(t){this.func=void 0===t.func?7:t.func,this.ref=t.ref||0,this.readMask=void 0===t.readMask?255:t.readMask,this.writeMask=void 0===t.writeMask?255:t.writeMask,this.fail=t.fail||0,this.zfail=t.zfail||0,this.zpass=t.zpass||0}clone(){return new qh({func:this.func,ref:this.ref,readMask:this.readMask,writeMask:this.writeMask,fail:this.fail,zfail:this.zfail,zpass:this.zpass})}}class Kh{constructor(t,e,i){this._entity=t,this._element=t.element,this.model=new Ne,this.node=new _i,this.model.graph=this.node,this.mesh=e,this.meshInstance=new Ee(this.node,this.mesh,i),this.meshInstance.name="ImageElement: "+t.name,this.meshInstance.castShadow=!1,this.meshInstance.receiveShadow=!1,this._meshDirty=!1,this.model.meshInstances.push(this.meshInstance),this._entity.addChild(this.model.graph),this.model._entity=this._entity,this.unmaskMeshInstance=null}destroy(){this.setMaterial(null),this._element.removeModelFromLayers(this.model),this.model.destroy(),this.model=null,this.node=null,this.mesh=null,this.meshInstance=null,this._entity=null,this._element=null}setMesh(t){this.meshInstance&&(this.mesh=t,this.meshInstance.mesh=t,this.meshInstance.visible=!!t,this.unmaskMeshInstance&&(this.unmaskMeshInstance.mesh=t),this.forceUpdateAabb())}setMask(t){if(this.meshInstance){if(t)for(var e in this.unmaskMeshInstance=new Ee(this.node,this.mesh,this.meshInstance.material),this.unmaskMeshInstance.name="Unmask: "+this._entity.name,this.unmaskMeshInstance.castShadow=!1,this.unmaskMeshInstance.receiveShadow=!1,this.unmaskMeshInstance.pick=!1,this.model.meshInstances.push(this.unmaskMeshInstance),this.meshInstance.parameters)this.unmaskMeshInstance.setParameter(e,this.meshInstance.parameters[e].data);else{var i=this.model.meshInstances.indexOf(this.unmaskMeshInstance);i>=0&&this.model.meshInstances.splice(i,1),this.unmaskMeshInstance=null}this._entity.enabled&&this._element.enabled&&(this._element.removeModelFromLayers(this.model),this._element.addModelToLayers(this.model))}}setMaterial(t){this.meshInstance&&(this.meshInstance.material=t,this.unmaskMeshInstance&&(this.unmaskMeshInstance.material=t))}setParameter(t,e){this.meshInstance&&(this.meshInstance.setParameter(t,e),this.unmaskMeshInstance&&this.unmaskMeshInstance.setParameter(t,e))}deleteParameter(t){this.meshInstance&&(this.meshInstance.deleteParameter(t),this.unmaskMeshInstance&&this.unmaskMeshInstance.deleteParameter(t))}setUnmaskDrawOrder(){if(this.meshInstance){if(this.unmaskMeshInstance){var t=function t(e){var i,n=e.children,r=n.length;if(r){for(var s=0;s<r;s++)n[s].element&&(i=n[s]);if(!i)return null;var a=t(i);return a||i}return null}(this._entity);t&&t.element?this.unmaskMeshInstance.drawOrder=t.element.drawOrder+t.element.getMaskOffset():this.unmaskMeshInstance.drawOrder=this.meshInstance.drawOrder+this._element.getMaskOffset()}}}setDrawOrder(t){this.meshInstance&&(this.meshInstance.drawOrder=t)}setCull(t){if(this.meshInstance){var e=this._element,i=null;t&&e._isScreenCulled()&&(i=function(t){return e.isVisibleForCamera(t)}),this.meshInstance.cull=t,this.meshInstance.isVisibleFunc=i,this.unmaskMeshInstance&&(this.unmaskMeshInstance.cull=t,this.unmaskMeshInstance.isVisibleFunc=i)}}setScreenSpace(t){this.meshInstance&&(this.meshInstance.screenSpace=t,this.unmaskMeshInstance&&(this.unmaskMeshInstance.screenSpace=t))}setLayer(t){this.meshInstance&&(this.meshInstance.layer=t,this.unmaskMeshInstance&&(this.unmaskMeshInstance.layer=t))}forceUpdateAabb(t){this.meshInstance&&(this.meshInstance._aabbVer=-1,this.unmaskMeshInstance&&(this.unmaskMeshInstance._aabbVer=-1))}setAabbFunc(t){this.meshInstance&&(this.meshInstance._updateAabbFunc=t,this.unmaskMeshInstance&&(this.unmaskMeshInstance._updateAabbFunc=t))}}class Jh{constructor(t){this._element=t,this._entity=t.entity,this._system=t.system,this._textureAsset=null,this._texture=null,this._materialAsset=null,this._material=null,this._spriteAsset=null,this._sprite=null,this._spriteFrame=0,this._pixelsPerUnit=null,this._rect=new X(0,0,1,1),this._mask=!1,this._maskRef=0,this._outerScale=new W,this._outerScaleUniform=new Float32Array(2),this._innerOffset=new X,this._innerOffsetUniform=new Float32Array(4),this._atlasRect=new X,this._atlasRectUniform=new Float32Array(4),this._defaultMesh=this._createMesh(),this._renderable=new Kh(this._entity,this._defaultMesh,this._material),this._color=new D(1,1,1,1),this._colorUniform=new Float32Array([1,1,1]),this._renderable.setParameter("material_emissive",this._colorUniform),this._renderable.setParameter("material_opacity",1),this._updateAabbFunc=this._updateAabb.bind(this),this._onScreenChange(this._element.screen),this._element.on("resize",this._onParentResizeOrPivotChange,this),this._element.on("set:pivot",this._onParentResizeOrPivotChange,this),this._element.on("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.on("set:screen",this._onScreenChange,this),this._element.on("set:draworder",this._onDrawOrderChange,this),this._element.on("screen:set:resolution",this._onResolutionChange,this)}destroy(){this.textureAsset=null,this.spriteAsset=null,this.materialAsset=null,this._renderable.setMesh(this._defaultMesh),this._renderable.destroy(),this._defaultMesh=null,this._element.off("resize",this._onParentResizeOrPivotChange,this),this._element.off("set:pivot",this._onParentResizeOrPivotChange,this),this._element.off("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.off("set:screen",this._onScreenChange,this),this._element.off("set:draworder",this._onDrawOrderChange,this),this._element.off("screen:set:resolution",this._onResolutionChange,this)}_onResolutionChange(t){}_onParentResizeOrPivotChange(){this._renderable.mesh&&this._updateMesh(this._renderable.mesh)}_onScreenSpaceChange(t){this._updateMaterial(t)}_onScreenChange(t,e){t?this._updateMaterial(t.screen.screenSpace):this._updateMaterial(!1)}_onDrawOrderChange(t){this._renderable.setDrawOrder(t),this.mask&&this._element.screen&&this._element.screen.screen.once("syncdraworder",(function(){this._renderable.setUnmaskDrawOrder()}),this)}_hasUserMaterial(){return!!this._materialAsset||!!this._material&&-1===this._system.defaultImageMaterials.indexOf(this._material)}_use9Slicing(){return this.sprite&&(1===this.sprite.renderMode||2===this.sprite.renderMode)}_updateMaterial(t){var e=!!this._mask,i=!(!this.sprite||1!==this.sprite.renderMode),n=!(!this.sprite||2!==this.sprite.renderMode);this._hasUserMaterial()||(this._material=this._system.getImageElementMaterial(t,e,i,n)),this._renderable&&(this._renderable.setCull(!0),this._renderable.setMaterial(this._material),this._renderable.setScreenSpace(t),this._renderable.setLayer(t?0:15))}_createMesh(){var t=this._element,e=t.calculatedWidth,i=t.calculatedHeight,n=this._rect,r=new ArrayBuffer(128),s=new Float32Array(r);s[5]=1,s[6]=n.x,s[7]=n.y,s[8]=e,s[13]=1,s[14]=n.x+n.z,s[15]=n.y,s[16]=e,s[17]=i,s[21]=1,s[22]=n.x+n.z,s[23]=n.y+n.w,s[25]=i,s[29]=1,s[30]=n.x,s[31]=n.y+n.w;var a=[{semantic:"POSITION",components:3,type:6},{semantic:"NORMAL",components:3,type:6},{semantic:"TEXCOORD0",components:2,type:6}],o=this._system.app.graphicsDevice,l=new bt(o,a),h=new _t(o,l,4,0,r),c=new Ie(o);return c.vertexBuffer=h,c.primitive[0].type=6,c.primitive[0].base=0,c.primitive[0].count=4,c.primitive[0].indexed=!1,c.aabb.setMinMax(H.ZERO,new H(e,i,0)),this._updateMesh(c),c}_updateMesh(t){var e=this._element,i=e.calculatedWidth,n=e.calculatedHeight,r=e._isScreenSpace();if(this._updateMaterial(r),this._renderable&&this._renderable.forceUpdateAabb(),!this.sprite||1!==this.sprite.renderMode&&2!==this.sprite.renderMode){var s=t.vertexBuffer,a=new Float32Array(s.lock()),o=e.pivot.x,l=e.pivot.y;a[0]=0-o*i,a[1]=0-l*n,a[8]=i-o*i,a[9]=0-l*n,a[16]=i-o*i,a[17]=n-l*n,a[24]=0-o*i,a[25]=n-l*n;var h=1,c=1,u=this._rect;if(this._sprite&&this._sprite.frameKeys[this._spriteFrame]&&this._sprite.atlas){var d=this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]];d&&(u=d.rect,h=this._sprite.atlas.texture.width,c=this._sprite.atlas.texture.height)}a[6]=u.x/h,a[7]=u.y/c,a[14]=(u.x+u.z)/h,a[15]=u.y/c,a[22]=(u.x+u.z)/h,a[23]=(u.y+u.w)/c,a[30]=u.x/h,a[31]=(u.y+u.w)/c,s.unlock();var f=new H(0-o*i,0-l*n,0),p=new H(i-o*i,n-l*n,0);t.aabb.setMinMax(f,p),this._renderable&&(this._renderable.node.setLocalScale(1,1,1),this._renderable.node.setLocalPosition(0,0,0),this._renderable.setAabbFunc(null))}else{var m=this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]],g=2/m.rect.z,v=2/m.rect.w;this._innerOffset.set(m.border.x*g,m.border.y*v,m.border.z*g,m.border.w*v);var _=this.sprite.atlas.texture;this._atlasRect.set(m.rect.x/_.width,m.rect.y/_.height,m.rect.z/_.width,m.rect.w/_.height);var y=null!==this._pixelsPerUnit?this._pixelsPerUnit:this.sprite.pixelsPerUnit,b=m.rect.z/y,x=m.rect.w/y;this._outerScale.set(Math.max(i,this._innerOffset.x*b),Math.max(n,this._innerOffset.y*x));var w=b,A=x;this._outerScale.x/=b,this._outerScale.y/=x,w*=k.clamp(i/(this._innerOffset.x*b),1e-4,1),A*=k.clamp(n/(this._innerOffset.y*x),1e-4,1),this._renderable&&(this._innerOffsetUniform[0]=this._innerOffset.x,this._innerOffsetUniform[1]=this._innerOffset.y,this._innerOffsetUniform[2]=this._innerOffset.z,this._innerOffsetUniform[3]=this._innerOffset.w,this._renderable.setParameter("innerOffset",this._innerOffsetUniform),this._atlasRectUniform[0]=this._atlasRect.x,this._atlasRectUniform[1]=this._atlasRect.y,this._atlasRectUniform[2]=this._atlasRect.z,this._atlasRectUniform[3]=this._atlasRect.w,this._renderable.setParameter("atlasRect",this._atlasRectUniform),this._outerScaleUniform[0]=this._outerScale.x,this._outerScaleUniform[1]=this._outerScale.y,this._renderable.setParameter("outerScale",this._outerScaleUniform),this._renderable.setAabbFunc(this._updateAabbFunc),this._renderable.node.setLocalScale(w,A,1),this._renderable.node.setLocalPosition((.5-e.pivot.x)*i,(.5-e.pivot.y)*n,0))}this._meshDirty=!1}_updateSprite(){var t=!1,e=null;this._sprite&&this._sprite.atlas&&(e=this._sprite.meshes[this.spriteFrame],t=1===this._sprite.renderMode||2===this._sprite.renderMode),this.mesh=t?e:this._defaultMesh,this.mesh&&(this._element._beingInitialized?this._meshDirty=!0:this._updateMesh(this.mesh))}_updateAabb(t){return t.center.set(0,0,0),t.halfExtents.set(.5*this._outerScale.x,.5*this._outerScale.y,.001),t.setFromTransformedAabb(t,this._renderable.node.getWorldTransform()),t}_toggleMask(){this._element._dirtifyMask();var t=this._element._isScreenSpace();this._updateMaterial(t),this._renderable.setMask(!!this._mask)}_onMaterialLoad(t){this.material=t.resource}_onMaterialAdded(t){this._system.app.assets.off("add:"+t.id,this._onMaterialAdded,this),this._materialAsset===t.id&&this._bindMaterialAsset(t)}_bindMaterialAsset(t){this._entity.enabled&&(t.on("load",this._onMaterialLoad,this),t.on("change",this._onMaterialChange,this),t.on("remove",this._onMaterialRemove,this),t.resource?this._onMaterialLoad(t):this._system.app.assets.load(t))}_unbindMaterialAsset(t){t.off("load",this._onMaterialLoad,this),t.off("change",this._onMaterialChange,this),t.off("remove",this._onMaterialRemove,this)}_onMaterialChange(){}_onMaterialRemove(){}_onTextureAdded(t){this._system.app.assets.off("add:"+t.id,this._onTextureAdded,this),this._textureAsset===t.id&&this._bindTextureAsset(t)}_bindTextureAsset(t){this._entity.enabled&&(t.on("load",this._onTextureLoad,this),t.on("change",this._onTextureChange,this),t.on("remove",this._onTextureRemove,this),t.resource?this._onTextureLoad(t):this._system.app.assets.load(t))}_unbindTextureAsset(t){t.off("load",this._onTextureLoad,this),t.off("change",this._onTextureChange,this),t.off("remove",this._onTextureRemove,this)}_onTextureLoad(t){this.texture=t.resource}_onTextureChange(t){}_onTextureRemove(t){}_onSpriteAssetAdded(t){this._system.app.assets.off("add:"+t.id,this._onSpriteAssetAdded,this),this._spriteAsset===t.id&&this._bindSpriteAsset(t)}_bindSpriteAsset(t){this._entity.enabled&&(t.on("load",this._onSpriteAssetLoad,this),t.on("change",this._onSpriteAssetChange,this),t.on("remove",this._onSpriteAssetRemove,this),t.resource?this._onSpriteAssetLoad(t):this._system.app.assets.load(t))}_unbindSpriteAsset(t){t.off("load",this._onSpriteAssetLoad,this),t.off("change",this._onSpriteAssetChange,this),t.off("remove",this._onSpriteAssetRemove,this),t.data.textureAtlasAsset&&this._system.app.assets.off("load:"+t.data.textureAtlasAsset,this._onTextureAtlasLoad,this)}_onSpriteAssetLoad(t){if(t&&t.resource)if(t.resource.atlas)this.sprite=t.resource;else{var e=t.data.textureAtlasAsset;if(e){var i=this._system.app.assets;i.off("load:"+e,this._onTextureAtlasLoad,this),i.once("load:"+e,this._onTextureAtlasLoad,this)}}else this.sprite=null}_onSpriteAssetChange(t){this._onSpriteAssetLoad(t)}_onSpriteAssetRemove(t){}_bindSprite(t){t.on("set:meshes",this._onSpriteMeshesChange,this),t.on("set:pixelsPerUnit",this._onSpritePpuChange,this),t.on("set:atlas",this._onAtlasTextureChange,this),t.atlas&&t.atlas.on("set:texture",this._onAtlasTextureChange,this)}_unbindSprite(t){t.off("set:meshes",this._onSpriteMeshesChange,this),t.off("set:pixelsPerUnit",this._onSpritePpuChange,this),t.off("set:atlas",this._onAtlasTextureChange,this),t.atlas&&t.atlas.off("set:texture",this._onAtlasTextureChange,this)}_onSpriteMeshesChange(){this._sprite&&(this._spriteFrame=k.clamp(this._spriteFrame,0,this._sprite.frameKeys.length-1)),this._updateSprite()}_onSpritePpuChange(){0!==this.sprite.renderMode&&null===this._pixelsPerUnit&&this._updateSprite()}_onAtlasTextureChange(){this.sprite&&this.sprite.atlas&&this.sprite.atlas.texture?(this._renderable.setParameter("texture_emissiveMap",this._sprite.atlas.texture),this._renderable.setParameter("texture_opacityMap",this._sprite.atlas.texture)):(this._renderable.deleteParameter("texture_emissiveMap"),this._renderable.deleteParameter("texture_opacityMap"))}_onTextureAtlasLoad(t){var e=this._spriteAsset;e instanceof As?this._onSpriteAssetLoad(e):this._onSpriteAssetLoad(this._system.app.assets.get(e))}onEnable(){var t;this._materialAsset&&(t=this._system.app.assets.get(this._materialAsset))&&t.resource!==this._material&&this._bindMaterialAsset(t),this._textureAsset&&(t=this._system.app.assets.get(this._textureAsset))&&t.resource!==this._texture&&this._bindTextureAsset(t),this._spriteAsset&&(t=this._system.app.assets.get(this._spriteAsset))&&t.resource!==this._sprite&&this._bindSpriteAsset(t),this._element.addModelToLayers(this._renderable.model)}onDisable(){this._element.removeModelFromLayers(this._renderable.model)}_setStencil(t){this._renderable.meshInstance.stencilFront=t,this._renderable.meshInstance.stencilBack=t;var e=0;if(this._element.maskedBy&&(e=this._element.maskedBy.element._image._maskRef),this._renderable.unmaskMeshInstance){var i=new qh({ref:e+1,func:2,zpass:5});this._renderable.unmaskMeshInstance.stencilFront=i,this._renderable.unmaskMeshInstance.stencilBack=i}}get color(){return this._color}set color(t){var e=t.r,i=t.g,n=t.b;this._color.r===e&&this._color.g===i&&this._color.b===n||(this._color.r=e,this._color.g=i,this._color.b=n,this._colorUniform[0]=e,this._colorUniform[1]=i,this._colorUniform[2]=n,this._renderable.setParameter("material_emissive",this._colorUniform),this._element&&this._element.fire("set:color",this._color))}get opacity(){return this._color.a}set opacity(t){t!==this._color.a&&(this._color.a=t,this._renderable.setParameter("material_opacity",t),this._element&&this._element.fire("set:opacity",t))}get rect(){return this._rect}set rect(t){var e,i,n,r;t instanceof X?(e=t.x,i=t.y,n=t.z,r=t.w):(e=t[0],i=t[1],n=t[2],r=t[3]),e===this._rect.x&&i===this._rect.y&&n===this._rect.z&&r===this._rect.w||(this._rect.set(e,i,n,r),this._renderable.mesh&&(this._element._beingInitialized?this._meshDirty=!0:this._updateMesh(this._renderable.mesh)))}get material(){return this._material}set material(t){if(this._material!==t){if(!t){var e=this._element._isScreenSpace();t=this.mask?e?this._system.defaultScreenSpaceImageMaskMaterial:this._system.defaultImageMaskMaterial:e?this._system.defaultScreenSpaceImageMaterial:this._system.defaultImageMaterial}this._material=t,t&&(this._renderable.setMaterial(t),this._hasUserMaterial()?(this._renderable.deleteParameter("material_opacity"),this._renderable.deleteParameter("material_emissive")):(this._colorUniform[0]=this._color.r,this._colorUniform[1]=this._color.g,this._colorUniform[2]=this._color.b,this._renderable.setParameter("material_emissive",this._colorUniform),this._renderable.setParameter("material_opacity",this._color.a)))}}get materialAsset(){return this._materialAsset}set materialAsset(t){var e=this._system.app.assets,i=t;if(t instanceof As&&(i=t.id),this._materialAsset!==i){if(this._materialAsset){e.off("add:"+this._materialAsset,this._onMaterialAdded,this);var n=e.get(this._materialAsset);n&&(n.off("load",this._onMaterialLoad,this),n.off("change",this._onMaterialChange,this),n.off("remove",this._onMaterialRemove,this))}if(this._materialAsset=i,this._materialAsset){var r=e.get(this._materialAsset);r?this._bindMaterialAsset(r):(this.material=null,e.on("add:"+this._materialAsset,this._onMaterialAdded,this))}else this.material=null}}get texture(){return this._texture}set texture(t){if(this._texture!==t){if(this._textureAsset){var e=this._system.app.assets.get(this._textureAsset);e&&e.resource!==t&&(this.textureAsset=null)}this._texture=t,t?(this._spriteAsset&&(this.spriteAsset=null),this._renderable.setParameter("texture_emissiveMap",this._texture),this._renderable.setParameter("texture_opacityMap",this._texture),this._colorUniform[0]=this._color.r,this._colorUniform[1]=this._color.g,this._colorUniform[2]=this._color.b,this._renderable.setParameter("material_emissive",this._colorUniform),this._renderable.setParameter("material_opacity",this._color.a)):(this._renderable.deleteParameter("texture_emissiveMap"),this._renderable.deleteParameter("texture_opacityMap"))}}get textureAsset(){return this._textureAsset}set textureAsset(t){var e=this._system.app.assets,i=t;if(t instanceof As&&(i=t.id),this._textureAsset!==i){if(this._textureAsset){e.off("add:"+this._textureAsset,this._onTextureAdded,this);var n=e.get(this._textureAsset);n&&(n.off("load",this._onTextureLoad,this),n.off("change",this._onTextureChange,this),n.off("remove",this._onTextureRemove,this))}if(this._textureAsset=i,this._textureAsset){var r=e.get(this._textureAsset);r?this._bindTextureAsset(r):(this.texture=null,e.on("add:"+this._textureAsset,this._onTextureAdded,this))}else this.texture=null}}get spriteAsset(){return this._spriteAsset}set spriteAsset(t){var e=this._system.app.assets,i=t;if(t instanceof As&&(i=t.id),this._spriteAsset!==i){if(this._spriteAsset){e.off("add:"+this._spriteAsset,this._onSpriteAssetAdded,this);var n=e.get(this._spriteAsset);n&&this._unbindSpriteAsset(n)}if(this._spriteAsset=i,this._spriteAsset){var r=e.get(this._spriteAsset);r?this._bindSpriteAsset(r):(this.sprite=null,e.on("add:"+this._spriteAsset,this._onSpriteAssetAdded,this))}else this.sprite=null;this._element&&this._element.fire("set:spriteAsset",i)}}get sprite(){return this._sprite}set sprite(t){if(this._sprite!==t){if(this._sprite&&this._unbindSprite(this._sprite),this._spriteAsset){var e=this._system.app.assets.get(this._spriteAsset);e&&e.resource!==t&&(this.spriteAsset=null)}this._sprite=t,this._sprite&&(this._bindSprite(this._sprite),this._textureAsset&&(this.textureAsset=null)),this._sprite&&this._sprite.atlas&&this._sprite.atlas.texture?(this._renderable.setParameter("texture_emissiveMap",this._sprite.atlas.texture),this._renderable.setParameter("texture_opacityMap",this._sprite.atlas.texture)):(this._renderable.deleteParameter("texture_emissiveMap"),this._renderable.deleteParameter("texture_opacityMap")),this._sprite&&(this._spriteFrame=k.clamp(this._spriteFrame,0,this._sprite.frameKeys.length-1)),this._updateSprite()}}get spriteFrame(){return this._spriteFrame}set spriteFrame(t){var e=this._spriteFrame;this._sprite?this._spriteFrame=k.clamp(t,0,this._sprite.frameKeys.length-1):this._spriteFrame=t,this._spriteFrame!==e&&(this._updateSprite(),this._element&&this._element.fire("set:spriteFrame",t))}get mesh(){return this._renderable.mesh}set mesh(t){this._renderable.setMesh(t),this._defaultMesh===t?this._renderable.setAabbFunc(null):this._renderable.setAabbFunc(this._updateAabbFunc)}get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t,this._toggleMask())}get pixelsPerUnit(){return this._pixelsPerUnit}set pixelsPerUnit(t){this._pixelsPerUnit!==t&&(this._pixelsPerUnit=t,!this._sprite||1!==this._sprite.renderMode&&2!==this._sprite.renderMode||this._updateSprite())}get aabb(){return this._renderable.meshInstance?this._renderable.meshInstance.aabb:null}}class Qh extends v{constructor(t){super(),this._app=t,t.i18n.on("set:locale",this._onSetLocale,this),this._autoLoad=!1,this._disableLocalization=!1,this._defaultAsset=null,this._localizedAsset=null}_bindDefaultAsset(){var t=this._app.assets.get(this._defaultAsset);t?this._onDefaultAssetAdd(t):this._app.assets.once("add:"+this._defaultAsset,this._onDefaultAssetAdd,this)}_unbindDefaultAsset(){if(this._defaultAsset){this._app.assets.off("add:"+this._defaultAsset,this._onDefaultAssetAdd,this);var t=this._app.assets.get(this._defaultAsset);t&&(t.off("add:localized",this._onLocaleAdd,this),t.off("remove:localized",this._onLocaleRemove,this),t.off("remove",this._onDefaultAssetRemove,this))}}_onDefaultAssetAdd(t){this._defaultAsset===t.id&&(t.on("add:localized",this._onLocaleAdd,this),t.on("remove:localized",this._onLocaleRemove,this),t.once("remove",this._onDefaultAssetRemove,this))}_onDefaultAssetRemove(t){this._defaultAsset===t.id&&(t.off("add:localized",this._onLocaleAdd,this),t.off("remove:localized",this._onLocaleAdd,this),this._app.assets.once("add:"+this._defaultAsset,this._onDefaultAssetAdd,this))}_bindLocalizedAsset(){if(this._autoLoad){var t=this._app.assets.get(this._localizedAsset);t&&(t.on("load",this._onLocalizedAssetLoad,this),t.on("change",this._onLocalizedAssetChange,this),t.on("remove",this._onLocalizedAssetRemove,this),t.resource?this._onLocalizedAssetLoad(t):this._app.assets.load(t))}}_unbindLocalizedAsset(){var t=this._app.assets.get(this._localizedAsset);t&&(t.off("load",this._onLocalizedAssetLoad,this),t.off("change",this._onLocalizedAssetChange,this),t.off("remove",this._onLocalizedAssetRemove,this))}_onLocalizedAssetAdd(t){this._localizedAsset===t.id&&this._bindLocalizedAsset()}_onLocalizedAssetLoad(t){this.fire("load",t)}_onLocalizedAssetChange(t,e,i,n){this.fire("change",t,e,i,n)}_onLocalizedAssetRemove(t){this._localizedAsset===t.id&&(this.localizedAsset=this._defaultAsset),this.fire("remove",t)}_onLocaleAdd(t,e){this._app.i18n.locale===t&&this._onSetLocale(t)}_onLocaleRemove(t,e){this._app.i18n.locale===t&&this._onSetLocale(t)}_onSetLocale(t){if(this._defaultAsset){var e=this._app.assets.get(this._defaultAsset);if(e&&!this._disableLocalization){var i=e.getLocalizedAssetId(t);this.localizedAsset=i||this._defaultAsset}else this.localizedAsset=this._defaultAsset}else this.localizedAsset=null}destroy(){this.defaultAsset=null,this._app.i18n.off("set:locale",this._onSetLocale,this),this.off()}get defaultAsset(){return this._defaultAsset}set defaultAsset(t){var e=t instanceof As?t.id:t;this._defaultAsset!==e&&(this._defaultAsset&&this._unbindDefaultAsset(),this._defaultAsset=e,this._defaultAsset&&this._bindDefaultAsset(),this._onSetLocale(this._app.i18n.locale))}get localizedAsset(){return this._localizedAsset}set localizedAsset(t){var e=t instanceof As?t.id:t;this._localizedAsset!==e&&(this._localizedAsset&&(this._app.assets.off("add:"+this._localizedAsset,this._onLocalizedAssetAdd,this),this._unbindLocalizedAsset(),this._localizedAsset=null),this._localizedAsset=e,this._localizedAsset&&(this._app.assets.get(this._localizedAsset)?this._bindLocalizedAsset():this._app.assets.once("add:"+this._localizedAsset,this._onLocalizedAssetAdd,this)))}get autoLoad(){return this._autoLoad}set autoLoad(t){this._autoLoad!==t&&(this._autoLoad=t,this._autoLoad&&this._localizedAsset&&(this._unbindLocalizedAsset(),this._bindLocalizedAsset()))}get disableLocalization(){return this._disableLocalization}set disableLocalization(t){this._disableLocalization!==t&&(this._disableLocalization=t,this._onSetLocale(this._app.i18n.locale))}}const $h=/[A-Z|a-z|0-9|_|-|/]/;class tc{constructor(t){this._symbols=t,this._index=0,this._last=0,this._cur=this._symbols.length>0?this._symbols[0]:null,this._buf=[],this._mode="text",this._error=null}read(){for(var t=this._read();8===t;)t=this._read();return 0!==t&&1!==t&&(this._last=this._index),t}buf(){return this._buf}last(){return this._last}error(){return this._error}debugPrint(){for(var t=["EOF","ERROR","TEXT","OPEN_BRACKET","CLOSE_BRACKET","EQUALS","STRING","IDENTIFIER","WHITESPACE"],e=this.read(),i="";i+=(i.length>0?"\n":"")+t[e]+" '"+this.buf().join("")+"'",0!==e&&1!==e;)e=this.read();return i}_read(){return this._buf=[],this._eof()?0:"text"===this._mode?this._text():this._tag()}_text(){for(;;)switch(this._cur){case null:return this._buf.length>0?2:0;case"[":return this._mode="tag",this._buf.length>0?2:this._tag();case"\\":switch(this._next(),this._cur){case"[":this._store();break;default:this._output("\\")}break;default:this._store()}}_tag(){for(;;)switch(this._cur){case null:return this._error="unexpected end of input reading tag",1;case"[":return this._store(),3;case"]":return this._store(),this._mode="text",4;case"=":return this._store(),5;case" ":case"\t":case"\n":case"\r":case"\v":case"\f":return this._whitespace();case'"':return this._string();default:return this._isIdentifierSymbol(this._cur)?this._identifier():(this._error="unrecognized character",1)}}_whitespace(){for(this._store();-1!==" \t\n\r\v\f".indexOf(this._cur);)this._store();return 8}_string(){for(this._next();;)switch(this._cur){case null:return this._error="unexpected end of input reading string",1;case'"':return this._next(),6;default:this._store()}}_identifier(){for(this._store();null!==this._cur&&this._isIdentifierSymbol(this._cur);)this._store();return 7}_isIdentifierSymbol(t){return 1===t.length&&null!==t.match($h)}_eof(){return null===this._cur}_next(){return this._eof()||(this._index++,this._cur=this._index<this._symbols.length?this._symbols[this._index]:null),this._cur}_store(){return this._buf.push(this._cur),this._next()}_output(t){this._buf.push(t)}}class ec{constructor(t){this._scanner=new tc(t),this._error=null}parse(t,e){for(;;){switch(this._scanner.read()){case 0:return!0;case 1:return!1;case 2:Array.prototype.push.apply(t,this._scanner.buf());break;case 3:if(!this._parseTag(t,e))return!1;break;default:return!1}}}error(){return"Error evaluating markup at #"+this._scanner.last().toString()+" ("+(this._scanner.error()||this._error)+")"}_parseTag(t,e){var i=this._scanner.read();if(7!==i)return this._error="expected identifier",!1;var n=this._scanner.buf().join("");if("/"===n[0]){for(var r=e.length-1;r>=0;--r)if(n==="/"+e[r].name&&null===e[r].end)return e[r].end=t.length,4===(i=this._scanner.read())||(this._error="expected close bracket",!1);return this._error="failed to find matching tag",!1}var s={name:n,value:null,attributes:{},start:t.length,end:null};if(5===(i=this._scanner.read())){if(6!==(i=this._scanner.read()))return this._error="expected string",!1;s.value=this._scanner.buf().join(""),i=this._scanner.read()}for(;;){switch(i){case 4:return e.push(s),!0;case 7:var a=this._scanner.buf().join("");if(5!==(i=this._scanner.read()))return this._error="expected equals",!1;if(6!==(i=this._scanner.read()))return this._error="expected string",!1;var o=this._scanner.buf().join("");s.attributes[a]=o;break;default:return this._error="expected close bracket or identifier",!1}i=this._scanner.read()}}}function ic(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n instanceof Object?(t.hasOwnProperty(i)||(t[i]={}),ic(t[i],e[i])):t[i]=n}}function nc(t){if(0===t.length)return null;for(var e={},i=0;i<t.length;++i){var n=t[i],r={};r[n.name]={value:n.value,attributes:n.attributes},ic(e,r)}return e}function rc(t){var e=new ec(t),i=[],n=[];if(!e.parse(i,n))return console.warn(e.error()),{symbols:t,tags:null};var r=n.find((function(t){return null===t.end}));return r?(console.warn("Markup error: found unclosed tag='"+r.name+"'"),{symbols:t,tags:null}):{symbols:i,tags:function(t,e){var i;if(0===t.length)return null;var n={};for(i=0;i<t.length;++i){var r=t[i];n.hasOwnProperty(r.start)?null===n[r.start].open?n[r.start].open=[r]:n[r.start].open.push(r):n[r.start]={open:[r],close:null},n.hasOwnProperty(r.end)?null===n[r.end].close?n[r.end].close=[r]:n[r.end].close.push(r):n[r.end]={open:null,close:[r]}}var s=[];function a(t){s=s.filter((function(e){return void 0===t.find((function(t){return t===e}))}))}function o(t){for(var e=0;e<t.length;++e)s.push(t[e])}var l=Object.keys(n).sort((function(t,e){return t-e})),h=[];for(i=0;i<l.length;++i){var c=n[l[i]];null!==c.close&&a(c.close),null!==c.open&&o(c.open),h.push({start:l[i],tags:nc(s)})}var u=[],d=null;for(i=0;i<h.length;++i){for(var f=h[i];u.length<f.start;)u.push(d?d.tags:null);d=f}for(;u.length<e;)u.push(null);return u}(n,i.length)}}class sc{constructor(){this.count=0,this.quad=0,this.lines={},this.positions=[],this.normals=[],this.uvs=[],this.colors=[],this.indices=[],this.meshInstance=null}}const ac=/^[\r\n]$/,oc=/^[ \t]$/,lc=/^[ \t\-]$/,hc=["","","","","","","","","","","",""],cc={width:0,height:0,xadvance:0,xoffset:0,yoffset:0};class uc{constructor(t){this._element=t,this._system=t.system,this._entity=t.entity,this._text="",this._symbols=[],this._colorPalette=[],this._symbolColors=null,this._i18nKey=null,this._fontAsset=new Qh(this._system.app),this._fontAsset.disableLocalization=!0,this._fontAsset.on("load",this._onFontLoad,this),this._fontAsset.on("change",this._onFontChange,this),this._fontAsset.on("remove",this._onFontRemove,this),this._font=null,this._color=new D(1,1,1,1),this._colorUniform=new Float32Array(3),this._spacing=1,this._fontSize=32,this._fontMinY=0,this._fontMaxY=0,this._originalFontSize=32,this._maxFontSize=32,this._minFontSize=8,this._autoFitWidth=!1,this._autoFitHeight=!1,this._maxLines=-1,this._lineHeight=32,this._scaledLineHeight=32,this._wrapLines=!1,this._drawOrder=0,this._alignment=new W(.5,.5),this._autoWidth=!0,this._autoHeight=!0,this.width=0,this.height=0,this._node=new _i,this._model=new Ne,this._model.graph=this._node,this._entity.addChild(this._node),this._meshInfo=[],this._material=null,this._aabbDirty=!0,this._aabb=new st,this._noResize=!1,this._currentMaterialType=null,this._maskedMaterialSrc=null,this._rtlReorder=!1,this._unicodeConverter=!1,this._rtl=!1,this._outlineColor=new D(0,0,0,1),this._outlineColorUniform=new Float32Array(4),this._outlineThicknessScale=.2,this._outlineThickness=0,this._shadowColor=new D(0,0,0,1),this._shadowColorUniform=new Float32Array(4),this._shadowOffsetScale=.005,this._shadowOffset=new W(0,0),this._shadowOffsetUniform=new Float32Array(2),this._enableMarkup=!1,this._onScreenChange(this._element.screen),t.on("resize",this._onParentResize,this),t.on("set:screen",this._onScreenChange,this),t.on("screen:set:screenspace",this._onScreenSpaceChange,this),t.on("set:draworder",this._onDrawOrderChange,this),t.on("set:pivot",this._onPivotChange,this),this._system.app.i18n.on("set:locale",this._onLocaleSet,this),this._system.app.i18n.on("data:add",this._onLocalizationData,this),this._system.app.i18n.on("data:remove",this._onLocalizationData,this),this._rangeStart=0,this._rangeEnd=0}destroy(){this._setMaterial(null),this._model&&(this._element.removeModelFromLayers(this._model),this._model.destroy(),this._model=null),this._fontAsset.destroy(),this.font=null,this._element.off("resize",this._onParentResize,this),this._element.off("set:screen",this._onScreenChange,this),this._element.off("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.off("set:draworder",this._onDrawOrderChange,this),this._element.off("set:pivot",this._onPivotChange,this),this._system.app.i18n.off("set:locale",this._onLocaleSet,this),this._system.app.i18n.off("data:add",this._onLocalizationData,this),this._system.app.i18n.off("data:remove",this._onLocalizationData,this)}_onParentResize(t,e){this._noResize||this._font&&this._updateText()}_onScreenChange(t){t?this._updateMaterial(t.screen.screenSpace):this._updateMaterial(!1)}_onScreenSpaceChange(t){this._updateMaterial(t)}_onDrawOrderChange(t){var e,i;if(this._drawOrder=t,this._model)for(e=0,i=this._model.meshInstances.length;e<i;e++)this._model.meshInstances[e].drawOrder=t}_onPivotChange(t){this._font&&this._updateText()}_onLocaleSet(t){if(this._i18nKey){if(this.fontAsset){var e=this._system.app.assets.get(this.fontAsset);e&&e.resource&&e.resource===this._font||(this.font=null)}this._resetLocalizedText()}}_onLocalizationData(t,e){this._i18nKey&&e[this._i18nKey]&&this._resetLocalizedText()}_resetLocalizedText(){this._setText(this._system.app.i18n.getText(this._i18nKey))}_setText(t){if(this.unicodeConverter){var e=this._system.getUnicodeConverter();e?t=e(t):console.warn("Element created with unicodeConverter option but no unicodeConverter function registered")}this._text!==t&&(this._font&&this._updateText(t),this._text=t)}_updateText(t){var e,i,n,r;if(void 0===t&&(t=this._text),this._symbols=E.getSymbols(t),0===this._symbols.length&&(this._symbols=[" "]),this._enableMarkup&&(n=class{constructor(){}static evaluate(t){return rc(t)}}.evaluate(this._symbols),this._symbols=n.symbols,r=n.tags),this._rtlReorder){var s=this._system.app.systems.element.getRtlReorder();s?(n=s(this._symbols),this._rtl=n.rtl,this._symbols=n.mapping.map((function(t){return this._symbols[t]}),this),r&&(r=n.mapping.map((function(t){return r[t]})))):console.warn("Element created with rtlReorder option but no rtlReorder function registered")}else this._rtl=!1;if(r){var a={};for(this._colorPalette=[Math.round(255*this._color.r),Math.round(255*this._color.g),Math.round(255*this._color.b)],this._symbolColors=[],a[this._color.toString(!1).toLowerCase()]=0,e=0,i=this._symbols.length;e<i;++e){var o=r[e],l=0;if(o&&o.color&&o.color.value){var h=o.color.value;if(7===h.length&&"#"===h[0]){var c=h.substring(1).toLowerCase();a.hasOwnProperty(c)?l=a[c]:/^([0-9a-f]{2}){3}$/.test(c)&&(l=this._colorPalette.length/3,a[c]=l,this._colorPalette.push(parseInt(c.substring(0,2),16)),this._colorPalette.push(parseInt(c.substring(2,4),16)),this._colorPalette.push(parseInt(c.substring(4,6),16)))}}this._symbolColors.push(l)}}else this._colorPalette=[],this._symbolColors=null;var u=this._calculateCharsPerTexture(),d=!1,f=this._element,p=f._isScreenSpace(),m=f._isScreenCulled(),g=function(t){return f.isVisibleForCamera(t)};for(e=0,i=this._meshInfo.length;e<i;e++){var v=u[e]||0,_=this._meshInfo[e];if(_.count!==v){if(d||(f.removeModelFromLayers(this._model),d=!0),_.count=v,_.positions.length=_.normals.length=3*v*4,_.indices.length=3*v*2,_.uvs.length=2*v*4,_.colors.length=4*v*4,_.meshInstance&&this._removeMeshInstance(_.meshInstance),0===v){_.meshInstance=null;continue}for(var y=0;y<v;y++)_.indices[3*y*2+0]=4*y,_.indices[3*y*2+1]=4*y+1,_.indices[3*y*2+2]=4*y+3,_.indices[3*y*2+3]=4*y+2,_.indices[3*y*2+4]=4*y+3,_.indices[3*y*2+5]=4*y+1,_.normals[4*y*3+0]=0,_.normals[4*y*3+1]=0,_.normals[4*y*3+2]=-1,_.normals[4*y*3+3]=0,_.normals[4*y*3+4]=0,_.normals[4*y*3+5]=-1,_.normals[4*y*3+6]=0,_.normals[4*y*3+7]=0,_.normals[4*y*3+8]=-1,_.normals[4*y*3+9]=0,_.normals[4*y*3+10]=0,_.normals[4*y*3+11]=-1;var b=Br(this._system.app.graphicsDevice,_.positions,{uvs:_.uvs,normals:_.normals,colors:_.colors,indices:_.indices}),x=new Ee(this._node,b,this._material);x.name="Text Element: "+this._entity.name,x.castShadow=!1,x.receiveShadow=!1,x.cull=!p,x.screenSpace=p,x.drawOrder=this._drawOrder,m&&(x.cull=!0,x.isVisibleFunc=g),this._setTextureParams(x,this._font.textures[e]),this._symbolColors?(this._colorUniform[0]=1,this._colorUniform[1]=1,this._colorUniform[2]=1):(this._colorUniform[0]=this._color.r,this._colorUniform[1]=this._color.g,this._colorUniform[2]=this._color.b),x.setParameter("material_emissive",this._colorUniform),x.setParameter("material_opacity",this._color.a),x.setParameter("font_sdfIntensity",this._font.intensity),x.setParameter("font_pxrange",this._getPxRange(this._font)),x.setParameter("font_textureWidth",this._font.data.info.maps[e].width),this._outlineColorUniform[0]=this._outlineColor.r,this._outlineColorUniform[1]=this._outlineColor.g,this._outlineColorUniform[2]=this._outlineColor.b,this._outlineColorUniform[3]=this._outlineColor.a,x.setParameter("outline_color",this._outlineColorUniform),x.setParameter("outline_thickness",this._outlineThicknessScale*this._outlineThickness),this._shadowColorUniform[0]=this._shadowColor.r,this._shadowColorUniform[1]=this._shadowColor.g,this._shadowColorUniform[2]=this._shadowColor.b,this._shadowColorUniform[3]=this._shadowColor.a,x.setParameter("shadow_color",this._shadowColorUniform);var w=this._font.data.info.maps[e].width/this._font.data.info.maps[e].height;this._shadowOffsetUniform[0]=this._shadowOffsetScale*this._shadowOffset.x,this._shadowOffsetUniform[1]=w*this._shadowOffsetScale*this._shadowOffset.y,x.setParameter("shadow_offset",this._shadowOffsetUniform),_.meshInstance=x,this._model.meshInstances.push(x)}}this._element.maskedBy&&this._element._setMaskedBy(this._element.maskedBy),d&&this._element.enabled&&this._entity.enabled&&this._element.addModelToLayers(this._model),this._updateMeshes(),this._rangeStart=0,this._rangeEnd=this._symbols.length,this._updateRenderRange()}_removeMeshInstance(t){t.material=null;var e=t.mesh;e&&e.destroy();var i=this._model.meshInstances.indexOf(t);-1!==i&&this._model.meshInstances.splice(i,1)}_setMaterial(t){var e,i;if(this._material=t,this._model)for(e=0,i=this._model.meshInstances.length;e<i;e++){this._model.meshInstances[e].material=t}}_updateMaterial(t){var e=this._element,i=e._isScreenCulled(),n=function(t){return e.isVisibleForCamera(t)},r=this._font&&"msdf"===this._font.type;if(this._material=this._system.getTextElementMaterial(t,r),this._model)for(var s=0,a=this._model.meshInstances.length;s<a;s++){var o=this._model.meshInstances[s];o.cull=!t,o.material=this._material,o.screenSpace=t,i?(o.cull=!0,o.isVisibleFunc=n):o.isVisibleFunc=null}}_updateMeshes(){var t=this._font.data,e=this,i=Math.min(this._minFontSize,this._maxFontSize),n=this._maxFontSize,r=this._shouldAutoFit();r&&(this._fontSize=this._maxFontSize);var s=this._symbols.length,a=0,o=0,l=0,h=0,c=1,u=0,d=0,f=0,p=0,m=0,g=0,v=Math.abs(this._element.anchor.x-this._element.anchor.z)>=1e-4,_=this._element.calculatedWidth;(this.autoWidth&&!v||!this._wrapLines)&&(_=Number.POSITIVE_INFINITY);var y,b,x,w,A,C=0,I=0,S=1;function M(t,i,n){e._lineWidths.push(Math.abs(n));var r=f>i?i+1:f,s=f>i?f+1:i,l=t.slice(r,s);if(g)for(var h=l.length;h--&&g>0;)ac.test(l[h])&&(l.splice(h,1),g--);e._lineContents.push(l.join("")),a=0,o-=e._scaledLineHeight,c++,p=0,m=0,g=0,u=0,f=i}for(var T=!0;T;){for(T=!1,this._scaledLineHeight=r?this._lineHeight*this._fontSize/(this._maxFontSize||1e-4):this._lineHeight,this.width=0,this.height=0,this._lineWidths=[],this._lineContents=[],a=0,o=0,l=0,h=0,c=1,u=0,d=0,f=0,p=0,m=0,g=0,S=this._fontSize/32,C=this._fontMinY*S,I=this._fontMaxY*S,x=0;x<this._meshInfo.length;x++)this._meshInfo[x].quad=0,this._meshInfo[x].lines={};var P=255,D=255,O=255;for(x=0;x<s;x++){y=this._symbols[x];var R,L=0,N=0,z=0,B=1;if(!(b=t.chars[y]))if(-1!==hc.indexOf(y))b=cc;else if(t.chars[" "])b=t.chars[" "];else for(var F in t.chars){b=t.chars[F];break}if(b){var j=0;if(m>0){var V=this._font.data.kerning;if(V){var U=V[E.getCodePoint(this._symbols[x-1])||0];U&&(j=U[E.getCodePoint(this._symbols[x])||0]||0)}}R=b.scale||1,B=S*((b.width+b.height)/2)/R,z=(b.xadvance+j)*S,L=(b.xoffset-j)*S,N=b.yoffset*S}else console.error("Couldn't substitute missing character: '"+y+"'");var G=ac.test(y);if(G)g++,(this._maxLines<0||c<this._maxLines)&&(M(this._symbols,x,h),d=x+1,f=x+1);else{var W=oc.test(y),H=this._meshInfo[b&&b.map||0],X=a+this._spacing*z;if(X>_&&m>0&&!W&&(this._maxLines<0||c<this._maxLines)){if(0!==p){var Z=Math.max(x-d,0);if(this._meshInfo.length<=1)H.lines[c-1]-=Z,H.quad-=Z;else{var Y=x;for(w=d;w<Y;w++){var q=this._symbols[w],K=t.chars[q],J=this._meshInfo[K&&K.map||0];J.lines[c-1]-=1,J.quad-=1}}x-=Z+1,M(this._symbols,d,u);continue}d=x,M(this._symbols,x,h)}A=H.quad,H.lines[c-1]=A;var Q,$=a-L,tt=$+B,et=o-N,it=et+B;if(this._rtl){var nt=B-L-this._spacing*z-L;$-=nt,tt-=nt}if(H.positions[4*A*3+0]=$,H.positions[4*A*3+1]=et,H.positions[4*A*3+2]=l,H.positions[4*A*3+3]=tt,H.positions[4*A*3+4]=et,H.positions[4*A*3+5]=l,H.positions[4*A*3+6]=tt,H.positions[4*A*3+7]=it,H.positions[4*A*3+8]=l,H.positions[4*A*3+9]=$,H.positions[4*A*3+10]=it,H.positions[4*A*3+11]=l,this.width=Math.max(this.width,X),this._shouldAutoFitWidth()&&this.width>this._element.calculatedWidth&&(Q=Math.floor(this._element.fontSize*this._element.calculatedWidth/(this.width||1e-4)),(Q=k.clamp(Q,i,n))!==this._element.fontSize)){this._fontSize=Q,T=!0;break}if(this.height=Math.max(this.height,I-(o+C)),this._shouldAutoFitHeight()&&this.height>this._element.calculatedHeight&&(Q=k.clamp(this._fontSize-1,i,n))!==this._element.fontSize){this._fontSize=Q,T=!0;break}a+=this._spacing*z,W||G||(h=a),lc.test(y)&&(p++,u=h,d=x+1),m++;var rt=this._getUv(y);if(H.uvs[4*A*2+0]=rt[0],H.uvs[4*A*2+1]=rt[1],H.uvs[4*A*2+2]=rt[2],H.uvs[4*A*2+3]=rt[1],H.uvs[4*A*2+4]=rt[2],H.uvs[4*A*2+5]=rt[3],H.uvs[4*A*2+6]=rt[0],H.uvs[4*A*2+7]=rt[3],this._symbolColors){var st=3*this._symbolColors[x];P=this._colorPalette[st],D=this._colorPalette[st+1],O=this._colorPalette[st+2]}H.colors[4*A*4+0]=P,H.colors[4*A*4+1]=D,H.colors[4*A*4+2]=O,H.colors[4*A*4+3]=255,H.colors[4*A*4+4]=P,H.colors[4*A*4+5]=D,H.colors[4*A*4+6]=O,H.colors[4*A*4+7]=255,H.colors[4*A*4+8]=P,H.colors[4*A*4+9]=D,H.colors[4*A*4+10]=O,H.colors[4*A*4+11]=255,H.colors[4*A*4+12]=P,H.colors[4*A*4+13]=D,H.colors[4*A*4+14]=O,H.colors[4*A*4+15]=255,H.quad++}}T||f<s&&M(this._symbols,s,a)}this._noResize=!0,this.autoWidth=this._autoWidth,this.autoHeight=this._autoHeight,this._noResize=!1;var at=this._element.pivot.x,ot=this._element.pivot.y,lt=this._alignment.x,ht=this._alignment.y;for(x=0;x<this._meshInfo.length;x++)if(0!==this._meshInfo[x].count){var ct=0;for(var ut in this._meshInfo[x].lines){var dt=this._meshInfo[x].lines[ut],ft=this._lineWidths[parseInt(ut,10)],pt=-at*this._element.calculatedWidth+lt*(this._element.calculatedWidth-ft)*(this._rtl?-1:1),mt=(1-ot)*this._element.calculatedHeight-I-(1-ht)*(this._element.calculatedHeight-this.height);for(A=ct;A<=dt;A++)this._meshInfo[x].positions[4*A*3]+=pt,this._meshInfo[x].positions[4*A*3+3]+=pt,this._meshInfo[x].positions[4*A*3+6]+=pt,this._meshInfo[x].positions[4*A*3+9]+=pt,this._meshInfo[x].positions[4*A*3+1]+=mt,this._meshInfo[x].positions[4*A*3+4]+=mt,this._meshInfo[x].positions[4*A*3+7]+=mt,this._meshInfo[x].positions[4*A*3+10]+=mt;if(this._rtl)for(A=ct;A<=dt;A++){for(var gt=4*A*3,vt=0;vt<4;++vt)this._meshInfo[x].positions[gt+3*vt]=this._element.calculatedWidth-this._meshInfo[x].positions[gt+3*vt]+2*pt;var _t=this._meshInfo[x].positions[gt+3],yt=this._meshInfo[x].positions[gt+6];this._meshInfo[x].positions[gt+3]=this._meshInfo[x].positions[gt+0],this._meshInfo[x].positions[gt+6]=this._meshInfo[x].positions[gt+9],this._meshInfo[x].positions[gt+0]=_t,this._meshInfo[x].positions[gt+9]=yt}ct=dt+1}for(var bt=4*this._meshInfo[x].count,xt=4*this._meshInfo[x].quad,wt=new Rt(this._meshInfo[x].meshInstance.mesh.vertexBuffer),At=0;At<bt;At++)At>=xt?(wt.element.POSITION.set(0,0,0),wt.element.TEXCOORD0.set(0,0),wt.element.COLOR.set(0,0,0,0)):(wt.element.POSITION.set(this._meshInfo[x].positions[3*At+0],this._meshInfo[x].positions[3*At+1],this._meshInfo[x].positions[3*At+2]),wt.element.TEXCOORD0.set(this._meshInfo[x].uvs[2*At+0],this._meshInfo[x].uvs[2*At+1]),wt.element.COLOR.set(this._meshInfo[x].colors[4*At+0],this._meshInfo[x].colors[4*At+1],this._meshInfo[x].colors[4*At+2],this._meshInfo[x].colors[4*At+3])),wt.next();wt.end(),this._meshInfo[x].meshInstance.mesh.aabb.compute(this._meshInfo[x].positions),this._meshInfo[x].meshInstance._aabbVer=-1}this._aabbDirty=!0}_onFontRender(){this.font=this._font}_onFontLoad(t){this.font!==t.resource&&(this.font=t.resource)}_onFontChange(t,e,i,n){if("data"===e){this._font.data=i;for(var r=this._font.data.info.maps.length,s=0;s<r;s++)if(this._meshInfo[s]){var a=this._meshInfo[s].meshInstance;a&&(a.setParameter("font_sdfIntensity",this._font.intensity),a.setParameter("font_pxrange",this._getPxRange(this._font)),a.setParameter("font_textureWidth",this._font.data.info.maps[s].width))}}}_onFontRemove(t){}_setTextureParams(t,e){this._font&&("msdf"===this._font.type?(t.deleteParameter("texture_emissiveMap"),t.deleteParameter("texture_opacityMap"),t.setParameter("texture_msdfMap",e)):"bitmap"===this._font.type&&(t.deleteParameter("texture_msdfMap"),t.setParameter("texture_emissiveMap",e),t.setParameter("texture_opacityMap",e)))}_getPxRange(t){for(var e=Object.keys(this._font.data.chars),i=0;i<e.length;i++){var n=this._font.data.chars[e[i]];if(n.range)return(n.scale||1)*n.range}return 2}_getUv(t){var e=this._font.data;if(!e.chars[t]){return e.chars[" "]?this._getUv(" "):[0,0,0,0]}var i=e.chars[t].map,n=e.info.maps[i].width,r=e.info.maps[i].height,s=e.chars[t].x,a=e.chars[t].y,o=s,l=a,h=s+e.chars[t].width,c=a-e.chars[t].height,u=1-e.chars[t].height/r;return[o/n,u-l/r,h/n,u-c/r]}onEnable(){this._fontAsset.autoLoad=!0,this._model&&this._element.addModelToLayers(this._model)}onDisable(){this._fontAsset.autoLoad=!1,this._model&&this._element.removeModelFromLayers(this._model)}_setStencil(t){if(this._model)for(var e=this._model.meshInstances,i=0;i<e.length;i++)e[i].stencilFront=t,e[i].stencilBack=t}_shouldAutoFitWidth(){return this._autoFitWidth&&!this._autoWidth}_shouldAutoFitHeight(){return this._autoFitHeight&&!this._autoHeight}_shouldAutoFit(){return this._autoFitWidth&&!this._autoWidth||this._autoFitHeight&&!this._autoHeight}_calculateCharsPerTexture(t){var e,i,n,r,s,a={};for(void 0===t&&(t=this._symbols.length),e=0,i=t;e<i;e++)n=this._symbols[e],(r=this._font.data.chars[n])||(r=this._font.data.chars[" "])||(r=this._font.data.chars[Object.keys(this._font.data.chars)[0]]),a[s=r.map]?a[s]++:a[s]=1;return a}_updateRenderRange(){var t,e,i=0===this._rangeStart?0:this._calculateCharsPerTexture(this._rangeStart),n=0===this._rangeEnd?0:this._calculateCharsPerTexture(this._rangeEnd);for(t=0,e=this._meshInfo.length;t<e;t++){var r=i[t]||0,s=n[t]||0,a=this._meshInfo[t].meshInstance;if(a){var o=a.mesh;o&&(o.primitive[0].base=3*r*2,o.primitive[0].count=3*(s-r)*2)}}}get text(){return this._text}set text(t){this._i18nKey=null;var e=null!=t&&t.toString()||"";this._setText(e)}get key(){return this._i18nKey}set key(t){var e=null!==t?t.toString():null;this._i18nKey!==e&&(this._i18nKey=e,e?(this._fontAsset.disableLocalization=!1,this._resetLocalizedText()):this._fontAsset.disableLocalization=!0)}get color(){return this._color}set color(t){var e=t.r,i=t.g,n=t.b;if(this._color.r!==e||this._color.g!==i||this._color.b!==n)if(this._color.r=e,this._color.g=i,this._color.b=n,this._symbolColors)this._font&&this._updateText();else{this._colorUniform[0]=this._color.r,this._colorUniform[1]=this._color.g,this._colorUniform[2]=this._color.b;for(var r=0,s=this._model.meshInstances.length;r<s;r++){this._model.meshInstances[r].setParameter("material_emissive",this._colorUniform)}}}get opacity(){return this._color.a}set opacity(t){if(this._color.a!==t&&(this._color.a=t,this._model))for(var e=0,i=this._model.meshInstances.length;e<i;e++){this._model.meshInstances[e].setParameter("material_opacity",t)}}get lineHeight(){return this._lineHeight}set lineHeight(t){var e=this._lineHeight;this._lineHeight=t,this._scaledLineHeight=t,e!==t&&this._font&&this._updateText()}get wrapLines(){return this._wrapLines}set wrapLines(t){var e=this._wrapLines;this._wrapLines=t,e!==t&&this._font&&this._updateText()}get lines(){return this._lineContents}get spacing(){return this._spacing}set spacing(t){var e=this._spacing;this._spacing=t,e!==t&&this._font&&this._updateText()}get fontSize(){return this._fontSize}set fontSize(t){var e=this._fontSize;this._fontSize=t,this._originalFontSize=t,e!==t&&this._font&&this._updateText()}get fontAsset(){return this._fontAsset.localizedAsset}set fontAsset(t){this._fontAsset.defaultAsset=t}get font(){return this._font}set font(t){var e,i,n;if(this._font&&(n=this._font.type,this._font.off&&this._font.off("render",this._onFontRender,this)),this._font=t,this._fontMinY=0,this._fontMaxY=0,t){var r=this._font.data;for(var s in r.chars){var a=r.chars[s];a.bounds&&(this._fontMinY=Math.min(this._fontMinY,a.bounds[1]),this._fontMaxY=Math.max(this._fontMaxY,a.bounds[3]))}if(this._font.on&&this._font.on("render",this._onFontRender,this),this._fontAsset.localizedAsset)this._system.app.assets.get(this._fontAsset.localizedAsset).resource!==this._font&&(this._fontAsset.defaultAsset=null);if(t.type!==n){var o=this._element._isScreenSpace();this._updateMaterial(o)}for(e=0,i=this._font.textures.length;e<i;e++)if(this._meshInfo[e]){var l=this._meshInfo[e].meshInstance;l&&(l.setParameter("font_sdfIntensity",this._font.intensity),l.setParameter("font_pxrange",this._getPxRange(this._font)),l.setParameter("font_textureWidth",this._font.data.info.maps[e].width),this._setTextureParams(l,this._font.textures[e]))}else this._meshInfo[e]=new sc;var h=!1;for(e=this._font.textures.length;e<this._meshInfo.length;e++)this._meshInfo[e].meshInstance&&(h||(this._element.removeModelFromLayers(this._model),h=!0),this._removeMeshInstance(this._meshInfo[e].meshInstance));this._meshInfo.length>this._font.textures.length&&(this._meshInfo.length=this._font.textures.length),this._updateText()}}get alignment(){return this._alignment}set alignment(t){t instanceof W?this._alignment.set(t.x,t.y):this._alignment.set(t[0],t[1]),this._font&&this._updateText()}get autoWidth(){return this._autoWidth}set autoWidth(t){var e=this._autoWidth;if(this._autoWidth=t,t&&Math.abs(this._element.anchor.x-this._element.anchor.z)<1e-4&&(this._element.width=this.width),e!==t){var i=this._shouldAutoFit()?this._maxFontSize:this._originalFontSize;i!==this._fontSize&&(this._fontSize=i,this._font&&this._updateText())}}get autoHeight(){return this._autoHeight}set autoHeight(t){var e=this._autoHeight;if(this._autoHeight=t,t&&Math.abs(this._element.anchor.y-this._element.anchor.w)<1e-4&&(this._element.height=this.height),e!==t){var i=this._shouldAutoFit()?this._maxFontSize:this._originalFontSize;i!==this._fontSize&&(this._fontSize=i,this._font&&this._updateText())}}get rtlReorder(){return this._rtlReorder}set rtlReorder(t){this._rtlReorder!==t&&(this._rtlReorder=t,this._font&&this._updateText())}get unicodeConverter(){return this._unicodeConverter}set unicodeConverter(t){this._unicodeConverter!==t&&(this._unicodeConverter=t,this._setText(this._text))}get aabb(){if(this._aabbDirty){for(var t=!1,e=0;e<this._meshInfo.length;e++)this._meshInfo[e].meshInstance&&(t?this._aabb.add(this._meshInfo[e].meshInstance.aabb):(this._aabb.copy(this._meshInfo[e].meshInstance.aabb),t=!0));this._aabbDirty=!1}return this._aabb}get outlineColor(){return this._outlineColor}set outlineColor(t){var e=t instanceof D?t.r:t[0],i=t instanceof D?t.g:t[1],n=t instanceof D?t.b:t[2],r=t instanceof D?t.a:t[3];if((this._outlineColor.r!==e||this._outlineColor.g!==i||this._outlineColor.b!==n||this._outlineColor.a!==r)&&(this._outlineColor.r=e,this._outlineColor.g=i,this._outlineColor.b=n,this._outlineColor.a=r,this._model)){this._outlineColorUniform[0]=this._outlineColor.r,this._outlineColorUniform[1]=this._outlineColor.g,this._outlineColorUniform[2]=this._outlineColor.b,this._outlineColorUniform[3]=this._outlineColor.a;for(var s=0,a=this._model.meshInstances.length;s<a;s++){this._model.meshInstances[s].setParameter("outline_color",this._outlineColorUniform)}}}get outlineThickness(){return this._outlineThickness}set outlineThickness(t){var e=this._outlineThickness;if(this._outlineThickness=t,e!==t&&this._font&&this._model)for(var i=0,n=this._model.meshInstances.length;i<n;i++){this._model.meshInstances[i].setParameter("outline_thickness",this._outlineThicknessScale*this._outlineThickness)}}get shadowColor(){return this._shadowColor}set shadowColor(t){var e=t instanceof D?t.r:t[0],i=t instanceof D?t.g:t[1],n=t instanceof D?t.b:t[2],r=t instanceof D?t.a:t[3];if((this._shadowColor.r!==e||this._shadowColor.g!==i||this._shadowColor.b!==n||this._shadowColor.a!==r)&&(this._shadowColor.r=e,this._shadowColor.g=i,this._shadowColor.b=n,this._shadowColor.a=r,this._model)){this._shadowColorUniform[0]=this._shadowColor.r,this._shadowColorUniform[1]=this._shadowColor.g,this._shadowColorUniform[2]=this._shadowColor.b,this._shadowColorUniform[3]=this._shadowColor.a;for(var s=0,a=this._model.meshInstances.length;s<a;s++){this._model.meshInstances[s].setParameter("shadow_color",this._shadowColorUniform)}}}get shadowOffset(){return this._shadowOffset}set shadowOffset(t){var e=t instanceof W?t.x:t[0],i=t instanceof W?t.y:t[1];if((this._shadowOffset.x!==e||this._shadowOffset.y!==i)&&(this._shadowOffset.set(e,i),this._font&&this._model))for(var n=0,r=this._model.meshInstances.length;n<r;n++){var s=this._font.data.info.maps[n].width/this._font.data.info.maps[n].height;this._shadowOffsetUniform[0]=this._shadowOffsetScale*this._shadowOffset.x,this._shadowOffsetUniform[1]=s*this._shadowOffsetScale*this._shadowOffset.y,this._model.meshInstances[n].setParameter("shadow_offset",this._shadowOffsetUniform)}}get minFontSize(){return this._minFontSize}set minFontSize(t){this._minFontSize!==t&&(this._minFontSize=t,this.font&&this._shouldAutoFit()&&this._updateText())}get maxFontSize(){return this._maxFontSize}set maxFontSize(t){this._maxFontSize!==t&&(this._maxFontSize=t,this.font&&this._shouldAutoFit()&&this._updateText())}get autoFitWidth(){return this._autoFitWidth}set autoFitWidth(t){this._autoFitWidth!==t&&(this._autoFitWidth=t,this._fontSize=this._shouldAutoFit()?this._maxFontSize:this._originalFontSize,this.font&&this._updateText())}get autoFitHeight(){return this._autoFitHeight}set autoFitHeight(t){this._autoFitHeight!==t&&(this._autoFitHeight=t,this._fontSize=this._shouldAutoFit()?this._maxFontSize:this._originalFontSize,this.font&&this._updateText())}get maxLines(){return this._maxLines}set maxLines(t){this._maxLines!==t&&(null===t&&-1===this._maxLines||(this._maxLines=null===t?-1:t,this.font&&this._wrapLines&&this._updateText()))}get enableMarkup(){return this._enableMarkup}set enableMarkup(t){t=!!t,this._enableMarkup!==t&&(this._enableMarkup=t,this.font&&this._updateText())}get symbols(){return this._symbols}get symbolColors(){return null===this._symbolColors?null:this._symbolColors.map((function(t){return this._colorPalette.slice(3*t,3*t+3)}),this)}get rtl(){return this._rtl}get rangeStart(){return this._rangeStart}set rangeStart(t){(t=Math.max(0,Math.min(t,this._symbols.length)))!==this._rangeStart&&(this._rangeStart=t,this._updateRenderRange())}get rangeEnd(){return this._rangeEnd}set rangeEnd(t){(t=Math.max(this._rangeStart,Math.min(t,this._symbols.length)))!==this._rangeEnd&&(this._rangeEnd=t,this._updateRenderRange())}}var dc=new H,fc=new Q,mc=new H,gc=new H,vc=new Q,_c=new Q,yc=new Q,bc=new Q;class xc extends Cl{constructor(t,e){super(t,e),this._beingInitialized=!1,this._anchor=new X,this._localAnchor=new X,this._pivot=new W,this._width=this._calculatedWidth=32,this._height=this._calculatedHeight=32,this._margin=new X(0,0,-32,-32),this._modelTransform=new Q,this._screenToWorld=new Q,this._anchorTransform=new Q,this._anchorDirty=!0,this._parentWorldTransform=new Q,this._screenTransform=new Q,this._screenCorners=[new H,new H,new H,new H],this._canvasCorners=[new W,new W,new W,new W],this._worldCorners=[new H,new H,new H,new H],this._cornersDirty=!0,this._canvasCornersDirty=!0,this._worldCornersDirty=!0,this.entity.on("insert",this._onInsert,this),this._patch(),this.screen=null,this._type="group",this._image=null,this._text=null,this._group=null,this._drawOrder=0,this._useInput=!1,this._layers=[4],this._addedModels=[],this._batchGroupId=-1,this._offsetReadAt=0,this._maskOffset=.5,this._maskedBy=null}_patch(){this.entity._sync=this._sync,this.entity.setPosition=this._setPosition,this.entity.setLocalPosition=this._setLocalPosition}_unpatch(){this.entity._sync=ha.prototype._sync,this.entity.setPosition=ha.prototype.setPosition,this.entity.setLocalPosition=ha.prototype.setLocalPosition}_setPosition(t,e,i){if(!this.element.screen)return ha.prototype.setPosition.call(this,t,e,i);t instanceof H?dc.copy(t):dc.set(t,e,i),this.getWorldTransform(),fc.copy(this.element._screenToWorld).invert(),fc.transformPoint(dc,this.localPosition),this._dirtyLocal||this._dirtifyLocal()}_setLocalPosition(t,e,i){t instanceof H?this.localPosition.copy(t):this.localPosition.set(t,e,i);var n=this.element,r=this.localPosition,s=n._pivot;n._margin.x=r.x-n._calculatedWidth*s.x,n._margin.z=n._localAnchor.z-n._localAnchor.x-n._calculatedWidth-n._margin.x,n._margin.y=r.y-n._calculatedHeight*s.y,n._margin.w=n._localAnchor.w-n._localAnchor.y-n._calculatedHeight-n._margin.y,this._dirtyLocal||this._dirtifyLocal()}_sync(){var t=this.element,e=t.screen;if(e){if(t._anchorDirty){var i=0,n=0,r=0,s=1;if(this._parent&&this._parent.element)i=this._parent.element.calculatedWidth,n=this._parent.element.calculatedHeight,r=this._parent.element.pivot.x,s=this._parent.element.pivot.y;else{var a=e.screen.resolution;i=a.x/e.screen.scale,n=a.y/e.screen.scale}t._anchorTransform.setTranslate(i*(t.anchor.x-r),-n*(s-t.anchor.y),0),t._anchorDirty=!1,t._calculateLocalAnchors()}t._sizeDirty&&t._calculateSize(!1,!1)}if(this._dirtyLocal){this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale);var o=this.localPosition,l=t._pivot;t._margin.x=o.x-t._calculatedWidth*l.x,t._margin.z=t._localAnchor.z-t._localAnchor.x-t._calculatedWidth-t._margin.x,t._margin.y=o.y-t._calculatedHeight*l.y,t._margin.w=t._localAnchor.w-t._localAnchor.y-t._calculatedHeight-t._margin.y,this._dirtyLocal=!1}if(!e)return this._dirtyWorld&&(t._cornersDirty=!0,t._canvasCornersDirty=!0,t._worldCornersDirty=!0),ha.prototype._sync.call(this);if(this._dirtyWorld){if(null===this._parent)this.worldTransform.copy(this.localTransform);else if(this._parent.element?t._screenToWorld.mul2(this._parent.element._modelTransform,t._anchorTransform):t._screenToWorld.copy(t._anchorTransform),t._modelTransform.mul2(t._screenToWorld,this.localTransform),e){t._screenToWorld.mul2(e.screen._screenMatrix,t._screenToWorld),e.screen.screenSpace||t._screenToWorld.mul2(e.worldTransform,t._screenToWorld),this.worldTransform.mul2(t._screenToWorld,this.localTransform);var h=t._parentWorldTransform;h.setIdentity();var c=this._parent;c&&c.element&&c!==e&&(vc.setTRS(H.ZERO,c.getLocalRotation(),c.getLocalScale()),h.mul2(c.element._parentWorldTransform,vc));var u=mc;u.set(0,0,this.localPosition.z);var d=gc;d.set(t._absLeft+t._pivot.x*t.calculatedWidth,t._absBottom+t._pivot.y*t.calculatedHeight,0),vc.setTranslate(-d.x,-d.y,-d.z),_c.setTRS(u,this.getLocalRotation(),this.getLocalScale()),yc.setTranslate(d.x,d.y,d.z),t._screenTransform.mul2(t._parentWorldTransform,yc).mul(_c).mul(vc),t._cornersDirty=!0,t._canvasCornersDirty=!0,t._worldCornersDirty=!0}else this.worldTransform.copy(t._modelTransform);this._dirtyWorld=!1}}_onInsert(t){var e=this._parseUpToScreen();this.entity._dirtifyWorld(),this._updateScreen(e.screen),this._dirtifyMask()}_dirtifyMask(){for(var t=this.entity;t;){var e=t.parent;if((null===e||e.screen)&&t.element){this.system._prerender&&this.system._prerender.length||(this.system._prerender=[],this.system.app.once("prerender",this._onPrerender,this));var i=this.system._prerender.indexOf(this.entity);i>=0&&this.system._prerender.splice(i,1),this.system._prerender.indexOf(t)<0&&this.system._prerender.push(t)}t=e}}_onPrerender(){for(var t=0;t<this.system._prerender.length;t++){var e=this.system._prerender[t];if(e.element){e.element.syncMask(1)}}this.system._prerender.length=0}_bindScreen(t){t._bindElement(this)}_unbindScreen(t){t._unbindElement(this)}_updateScreen(t){this.screen&&this.screen!==t&&this._unbindScreen(this.screen.screen);var e=this.screen;this.screen=t,this.screen&&this._bindScreen(this.screen.screen),this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY),this.fire("set:screen",this.screen,e),this._anchorDirty=!0;for(var i=this.entity.children,n=0,r=i.length;n<r;n++)i[n].element&&i[n].element._updateScreen(t);this.screen&&this.screen.screen.syncDrawOrder()}syncMask(t){var e=this._parseUpToScreen();this._updateMask(e.mask,t)}_setMaskedBy(t){var e=this._image||this._text;if(t){var i=t.element._image._maskRef,n=new qh({ref:i,func:2});e&&e._setStencil&&e._setStencil(n),this._maskedBy=t}else e&&e._setStencil&&e._setStencil(null),this._maskedBy=null}_updateMask(t,e){var i,n,r,s;if(t){if(this._setMaskedBy(t),this.mask){var a=t.element._image._maskRef;r=new qh({ref:a,func:2,zpass:3}),this._image._setStencil(r),this._image._maskRef=e,e++,t=this.entity}for(i=0,n=(s=this.entity.children).length;i<n;i++)s[i].element&&s[i].element._updateMask(t,e);this.mask&&e--}else{for(this._setMaskedBy(null),this.mask&&(r=new qh({ref:e,func:7,zpass:2}),this._image._setStencil(r),this._image._maskRef=e,e++,t=this.entity),i=0,n=(s=this.entity.children).length;i<n;i++)s[i].element&&s[i].element._updateMask(t,e);this.mask&&e--}}_parseUpToScreen(){for(var t={screen:null,mask:null},e=this.entity._parent;e&&!e.screen;)e.element&&e.element.mask&&(t.mask||(t.mask=e)),e=e.parent;return e&&e.screen&&(t.screen=e),t}_onScreenResize(t){this._anchorDirty=!0,this._cornersDirty=!0,this._worldCornersDirty=!0,this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY),this.fire("screen:set:resolution",t)}_onScreenSpaceChange(){this.fire("screen:set:screenspace",this.screen.screen.screenSpace)}_onScreenRemove(){this.screen&&(this.screen._destroying?this.screen=null:this._updateScreen(null))}_calculateLocalAnchors(){var t=1e3,e=1e3,i=this.entity._parent;if(i&&i.element)t=i.element.calculatedWidth,e=i.element.calculatedHeight;else if(this.screen){var n=this.screen.screen.resolution,r=this.screen.screen.scale;t=n.x/r,e=n.y/r}this._localAnchor.set(this._anchor.x*t,this._anchor.y*e,this._anchor.z*t,this._anchor.w*e)}getOffsetPosition(t,e){var i=this.entity.getLocalPosition().clone();return i.x+=t,i.y+=e,this._screenToWorld.transformPoint(i,i),i}onLayersChanged(t,e){this.addModelToLayers(this._image?this._image._model:this._text._model),t.off("add",this.onLayerAdded,this),t.off("remove",this.onLayerRemoved,this),e.on("add",this.onLayerAdded,this),e.on("remove",this.onLayerRemoved,this)}onLayerAdded(t){this.layers.indexOf(t.id)<0||(this._image?t.addMeshInstances(this._image._model.meshInstances):this._text&&t.addMeshInstances(this._text._model.meshInstances))}onLayerRemoved(t){this.layers.indexOf(t.id)<0||(this._image?t.removeMeshInstances(this._image._model.meshInstances):this._text&&t.removeMeshInstances(this._text._model.meshInstances))}onEnable(){this._image&&this._image.onEnable(),this._text&&this._text.onEnable(),this._group&&this._group.onEnable(),this.useInput&&this.system.app.elementInput&&this.system.app.elementInput.addElement(this),this.system.app.scene.on("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this.onLayerAdded,this),this.system.app.scene.layers.on("remove",this.onLayerRemoved,this)),this._batchGroupId>=0&&this.system.app.batcher.insert(Be.ELEMENT,this.batchGroupId,this.entity),this.fire("enableelement")}onDisable(){this.system.app.scene.off("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this.onLayerAdded,this),this.system.app.scene.layers.off("remove",this.onLayerRemoved,this)),this._image&&this._image.onDisable(),this._text&&this._text.onDisable(),this._group&&this._group.onDisable(),this.system.app.elementInput&&this.useInput&&this.system.app.elementInput.removeElement(this),this._batchGroupId>=0&&this.system.app.batcher.remove(Be.ELEMENT,this.batchGroupId,this.entity),this.fire("disableelement")}onRemove(){this.entity.off("insert",this._onInsert,this),this._unpatch(),this._image&&this._image.destroy(),this._text&&this._text.destroy(),this.system.app.elementInput&&this.useInput&&this.system.app.elementInput.removeElement(this),this.screen&&this.screen.screen&&(this._unbindScreen(this.screen.screen),this.screen.screen.syncDrawOrder()),this.off()}_calculateSize(t,e){if(this.entity._parent||this.screen){this._calculateLocalAnchors();var i=this._absRight-this._absLeft,n=this._absTop-this._absBottom;t?this._setWidth(i):this._setCalculatedWidth(i,!1),e?this._setHeight(n):this._setCalculatedHeight(n,!1);var r=this.entity.getLocalPosition();r.x=this._margin.x+this._calculatedWidth*this._pivot.x,r.y=this._margin.y+this._calculatedHeight*this._pivot.y,this.entity.setLocalPosition(r),this._sizeDirty=!1}}_setWidth(t){this._width=t,this._setCalculatedWidth(t,!1),this.fire("set:width",this._width)}_setHeight(t){this._height=t,this._setCalculatedHeight(t,!1),this.fire("set:height",this._height)}_setCalculatedWidth(t,e){if(!(Math.abs(t-this._calculatedWidth)<=1e-4)){if(this._calculatedWidth=t,this.entity._dirtifyLocal(),e){var i=this.entity.getLocalPosition(),n=this._pivot;this._margin.x=i.x-this._calculatedWidth*n.x,this._margin.z=this._localAnchor.z-this._localAnchor.x-this._calculatedWidth-this._margin.x}this._flagChildrenAsDirty(),this.fire("set:calculatedWidth",this._calculatedWidth),this.fire("resize",this._calculatedWidth,this._calculatedHeight)}}_setCalculatedHeight(t,e){if(!(Math.abs(t-this._calculatedHeight)<=1e-4)){if(this._calculatedHeight=t,this.entity._dirtifyLocal(),e){var i=this.entity.getLocalPosition(),n=this._pivot;this._margin.y=i.y-this._calculatedHeight*n.y,this._margin.w=this._localAnchor.w-this._localAnchor.y-this._calculatedHeight-this._margin.y}this._flagChildrenAsDirty(),this.fire("set:calculatedHeight",this._calculatedHeight),this.fire("resize",this._calculatedWidth,this._calculatedHeight)}}_flagChildrenAsDirty(){var t,e,i=this.entity._children;for(t=0,e=i.length;t<e;t++)i[t].element&&(i[t].element._anchorDirty=!0,i[t].element._sizeDirty=!0)}addModelToLayers(t){var e;this._addedModels.push(t);for(var i=0;i<this.layers.length;i++)(e=this.system.app.scene.layers.getLayerById(this.layers[i]))&&e.addMeshInstances(t.meshInstances)}removeModelFromLayers(t){var e,i=this._addedModels.indexOf(t);i>=0&&this._addedModels.splice(i,1);for(var n=0;n<this.layers.length;n++)(e=this.system.app.scene.layers.getLayerById(this.layers[n]))&&e.removeMeshInstances(t.meshInstances)}getMaskOffset(){var t=this.system.app.frame;this._offsetReadAt!==t&&(this._maskOffset=.5,this._offsetReadAt=t);var e=this._maskOffset;return this._maskOffset-=.001,e}isVisibleForCamera(t){var e,i,n,r;if(this.maskedBy){var s=this.maskedBy.element.screenCorners;e=Math.min(Math.min(s[0].x,s[1].x),Math.min(s[2].x,s[3].x)),i=Math.max(Math.max(s[0].x,s[1].x),Math.max(s[2].x,s[3].x)),r=Math.min(Math.min(s[0].y,s[1].y),Math.min(s[2].y,s[3].y)),n=Math.max(Math.max(s[0].y,s[1].y),Math.max(s[2].y,s[3].y))}else{var a=this.system.app.graphicsDevice.width,o=this.system.app.graphicsDevice.height,l=t._rect.z*a,h=t._rect.w*o;i=(e=t._rect.x*a)+l,r=(n=(1-t._rect.y)*o)-h}var c=this.screenCorners,u=Math.min(Math.min(c[0].x,c[1].x),Math.min(c[2].x,c[3].x)),d=Math.max(Math.max(c[0].x,c[1].x),Math.max(c[2].x,c[3].x)),f=Math.min(Math.min(c[0].y,c[1].y),Math.min(c[2].y,c[3].y)),p=Math.max(Math.max(c[0].y,c[1].y),Math.max(c[2].y,c[3].y));return!(d<e||u>i||f>n||p<r)}_isScreenSpace(){return!(!this.screen||!this.screen.screen)&&this.screen.screen.screenSpace}_isScreenCulled(){return!(!this.screen||!this.screen.screen)&&this.screen.screen.cull}}Object.defineProperty(xc.prototype,"type",{get:function(){return this._type},set:function(t){t!==this._type&&(this._type=t,this._image&&(this._image.destroy(),this._image=null),this._text&&(this._text.destroy(),this._text=null),"image"===t?this._image=new Jh(this):"text"===t&&(this._text=new uc(this)))}}),Object.defineProperty(xc.prototype,"layers",{get:function(){return this._layers},set:function(t){var e,i,n;if(this._addedModels.length)for(e=0;e<this._layers.length;e++)if(n=this.system.app.scene.layers.getLayerById(this._layers[e]))for(i=0;i<this._addedModels.length;i++)n.removeMeshInstances(this._addedModels[i].meshInstances);if(this._layers=t,this.enabled&&this.entity.enabled&&this._addedModels.length)for(e=0;e<this._layers.length;e++)if(n=this.system.app.scene.layers.getLayerById(this._layers[e]))for(i=0;i<this._addedModels.length;i++)n.addMeshInstances(this._addedModels[i].meshInstances)}}),Object.defineProperty(xc.prototype,"drawOrder",{get:function(){return this._drawOrder},set:function(t){var e=0;this.screen&&(e=this.screen.screen.priority),t>16777215&&(t=16777215),this._drawOrder=(e<<24)+t,this.fire("set:draworder",this._drawOrder)}}),Object.defineProperty(xc.prototype,"_absLeft",{get:function(){return this._localAnchor.x+this._margin.x}}),Object.defineProperty(xc.prototype,"_absRight",{get:function(){return this._localAnchor.z-this._margin.z}}),Object.defineProperty(xc.prototype,"_absTop",{get:function(){return this._localAnchor.w-this._margin.w}}),Object.defineProperty(xc.prototype,"_absBottom",{get:function(){return this._localAnchor.y+this._margin.y}}),Object.defineProperty(xc.prototype,"margin",{get:function(){return this._margin},set:function(t){this._margin.copy(t),this._calculateSize(!0,!0),this.fire("set:margin",this._margin)}}),Object.defineProperty(xc.prototype,"left",{get:function(){return this._margin.x},set:function(t){this._margin.x=t;var e=this.entity.getLocalPosition(),i=this._absRight,n=this._localAnchor.x+t;this._setWidth(i-n),e.x=t+this._calculatedWidth*this._pivot.x,this.entity.setLocalPosition(e)}}),Object.defineProperty(xc.prototype,"right",{get:function(){return this._margin.z},set:function(t){this._margin.z=t;var e=this.entity.getLocalPosition(),i=this._absLeft,n=this._localAnchor.z-t;this._setWidth(n-i),e.x=this._localAnchor.z-this._localAnchor.x-t-this._calculatedWidth*(1-this._pivot.x),this.entity.setLocalPosition(e)}}),Object.defineProperty(xc.prototype,"top",{get:function(){return this._margin.w},set:function(t){this._margin.w=t;var e=this.entity.getLocalPosition(),i=this._absBottom,n=this._localAnchor.w-t;this._setHeight(n-i),e.y=this._localAnchor.w-this._localAnchor.y-t-this._calculatedHeight*(1-this._pivot.y),this.entity.setLocalPosition(e)}}),Object.defineProperty(xc.prototype,"bottom",{get:function(){return this._margin.y},set:function(t){this._margin.y=t;var e=this.entity.getLocalPosition(),i=this._absTop,n=this._localAnchor.y+t;this._setHeight(i-n),e.y=t+this._calculatedHeight*this._pivot.y,this.entity.setLocalPosition(e)}}),Object.defineProperty(xc.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._hasSplitAnchorsX||this._setCalculatedWidth(t,!0),this.fire("set:width",this._width)}}),Object.defineProperty(xc.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._hasSplitAnchorsY||this._setCalculatedHeight(t,!0),this.fire("set:height",this._height)}}),Object.defineProperty(xc.prototype,"calculatedWidth",{get:function(){return this._calculatedWidth},set:function(t){this._setCalculatedWidth(t,!0)}}),Object.defineProperty(xc.prototype,"calculatedHeight",{get:function(){return this._calculatedHeight},set:function(t){this._setCalculatedHeight(t,!0)}}),Object.defineProperty(xc.prototype,"pivot",{get:function(){return this._pivot},set:function(t){var e=this._pivot.x,i=this._pivot.y;t instanceof W?this._pivot.set(t.x,t.y):this._pivot.set(t[0],t[1]);var n=this._margin.x+this._margin.z,r=this._pivot.x-e;this._margin.x+=n*r,this._margin.z-=n*r;var s=this._margin.y+this._margin.w,a=this._pivot.y-i;this._margin.y+=s*a,this._margin.w-=s*a,this._anchorDirty=!0,this._cornersDirty=!0,this._worldCornersDirty=!0,this._calculateSize(!1,!1),this._flagChildrenAsDirty(),this.fire("set:pivot",this._pivot)}}),Object.defineProperty(xc.prototype,"anchor",{get:function(){return this._anchor},set:function(t){t instanceof X?this._anchor.set(t.x,t.y,t.z,t.w):this._anchor.set(t[0],t[1],t[2],t[3]),this.entity._parent||this.screen?this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY):this._calculateLocalAnchors(),this._anchorDirty=!0,this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:anchor",this._anchor)}}),Object.defineProperty(xc.prototype,"_hasSplitAnchorsX",{get:function(){return Math.abs(this._anchor.x-this._anchor.z)>.001}}),Object.defineProperty(xc.prototype,"_hasSplitAnchorsY",{get:function(){return Math.abs(this._anchor.y-this._anchor.w)>.001}}),Object.defineProperty(xc.prototype,"aabb",{get:function(){return this._image?this._image.aabb:this._text?this._text.aabb:null}}),Object.defineProperty(xc.prototype,"screenCorners",{get:function(){if(!this._cornersDirty||!this.screen)return this._screenCorners;var t=this.entity.parent&&this.entity.parent.element&&this.entity.parent.element.screenCorners[0];this._screenCorners[0].set(this._absLeft,this._absBottom,0),this._screenCorners[1].set(this._absRight,this._absBottom,0),this._screenCorners[2].set(this._absRight,this._absTop,0),this._screenCorners[3].set(this._absLeft,this._absTop,0);for(var e=this.screen.screen.screenSpace,i=0;i<4;i++)this._screenTransform.transformPoint(this._screenCorners[i],this._screenCorners[i]),e&&this._screenCorners[i].scale(this.screen.screen.scale),t&&this._screenCorners[i].add(t);return this._cornersDirty=!1,this._canvasCornersDirty=!0,this._worldCornersDirty=!0,this._screenCorners}}),Object.defineProperty(xc.prototype,"canvasCorners",{get:function(){if(!this._canvasCornersDirty||!this.screen||!this.screen.screen.screenSpace)return this._canvasCorners;for(var t=this.system.app.graphicsDevice,e=this.screenCorners,i=t.canvas.clientWidth/t.width,n=t.canvas.clientHeight/t.height,r=0;r<4;r++)this._canvasCorners[r].set(e[r].x*i,(t.height-e[r].y)*n);return this._canvasCornersDirty=!1,this._canvasCorners}}),Object.defineProperty(xc.prototype,"worldCorners",{get:function(){if(!this._worldCornersDirty)return this._worldCorners;if(this.screen){var t=this.screenCorners;if(!this.screen.screen.screenSpace){vc.copy(this.screen.screen._screenMatrix),vc.data[13]=-vc.data[13],vc.mul2(this.screen.getWorldTransform(),vc);for(var e=0;e<4;e++)vc.transformPoint(t[e],this._worldCorners[e])}}else{var i=this.entity.getLocalPosition();vc.setTranslate(-i.x,-i.y,-i.z),_c.setTRS(H.ZERO,this.entity.getLocalRotation(),this.entity.getLocalScale()),yc.setTranslate(i.x,i.y,i.z);var n=this.entity.parent?this.entity.parent:this.entity;bc.copy(n.getWorldTransform()),bc.mul(yc).mul(_c).mul(vc),mc.set(i.x-this.pivot.x*this.calculatedWidth,i.y-this.pivot.y*this.calculatedHeight,i.z),bc.transformPoint(mc,this._worldCorners[0]),mc.set(i.x+(1-this.pivot.x)*this.calculatedWidth,i.y-this.pivot.y*this.calculatedHeight,i.z),bc.transformPoint(mc,this._worldCorners[1]),mc.set(i.x+(1-this.pivot.x)*this.calculatedWidth,i.y+(1-this.pivot.y)*this.calculatedHeight,i.z),bc.transformPoint(mc,this._worldCorners[2]),mc.set(i.x-this.pivot.x*this.calculatedWidth,i.y+(1-this.pivot.y)*this.calculatedHeight,i.z),bc.transformPoint(mc,this._worldCorners[3])}return this._worldCornersDirty=!1,this._worldCorners}}),Object.defineProperty(xc.prototype,"textWidth",{get:function(){return this._text?this._text.width:0}}),Object.defineProperty(xc.prototype,"textHeight",{get:function(){return this._text?this._text.height:0}}),Object.defineProperty(xc.prototype,"useInput",{get:function(){return this._useInput},set:function(t){this._useInput!==t&&(this._useInput=t,this.system.app.elementInput?t?this.enabled&&this.entity.enabled&&this.system.app.elementInput.addElement(this):this.system.app.elementInput.removeElement(this):!0===this._useInput&&console.warn("Elements will not get any input events because this.system.app.elementInput is not created"),this.fire("set:useInput",t))}}),Object.defineProperty(xc.prototype,"batchGroupId",{get:function(){return this._batchGroupId},set:function(t){this._batchGroupId!==t&&(this.entity.enabled&&this._batchGroupId>=0&&this.system.app.batcher.remove(Be.ELEMENT,this.batchGroupId,this.entity),this.entity.enabled&&t>=0&&this.system.app.batcher.insert(Be.ELEMENT,t,this.entity),t<0&&this._batchGroupId>=0&&this.enabled&&this.entity.enabled&&(this._image&&this._image._renderable.model?this.addModelToLayers(this._image._renderable.model):this._text&&this._text._model&&this.addModelToLayers(this._text._model)),this._batchGroupId=t)}}),Object.defineProperty(xc.prototype,"maskedBy",{get:function(){return this._maskedBy}});var wc=function(t){Object.defineProperty(xc.prototype,t,{get:function(){return this._text?this._text[t]:this._image?this._image[t]:null},set:function(e){this._text?this._text[t]=e:this._image&&(this._image[t]=e)}})};wc("fontSize"),wc("minFontSize"),wc("maxFontSize"),wc("maxLines"),wc("autoFitWidth"),wc("autoFitHeight"),wc("color"),wc("font"),wc("fontAsset"),wc("spacing"),wc("lineHeight"),wc("wrapLines"),wc("lines"),wc("alignment"),wc("autoWidth"),wc("autoHeight"),wc("rtlReorder"),wc("unicodeConverter"),wc("text"),wc("key"),wc("texture"),wc("textureAsset"),wc("material"),wc("materialAsset"),wc("sprite"),wc("spriteAsset"),wc("spriteFrame"),wc("pixelsPerUnit"),wc("opacity"),wc("rect"),wc("mask"),wc("outlineColor"),wc("outlineThickness"),wc("shadowColor"),wc("shadowOffset"),wc("enableMarkup"),wc("rangeStart"),wc("rangeEnd");class Ac{constructor(){this.enabled=!0}}const Cc=["enabled"];class Ic extends Il{constructor(t){super(t),this.id="element",this.ComponentType=xc,this.DataType=Ac,this.schema=Cc,this._unicodeConverter=null,this._rtlReorder=null,this._defaultTexture=new pe(t.graphicsDevice,{width:1,height:1,format:7}),this._defaultTexture.name="element-system";var e=this._defaultTexture.lock(),i=new Uint8Array(4);i[0]=255,i[1]=255,i[2]=255,i[3]=255,e.set(i),this._defaultTexture.unlock(),this.defaultImageMaterial=null,this.defaultImage9SlicedMaterial=null,this.defaultImage9TiledMaterial=null,this.defaultImageMaskMaterial=null,this.defaultImage9SlicedMaskMaterial=null,this.defaultImage9TiledMaskMaterial=null,this.defaultScreenSpaceImageMaterial=null,this.defaultScreenSpaceImage9SlicedMaterial=null,this.defaultScreenSpaceImage9TiledMaterial=null,this.defaultScreenSpaceImageMask9SlicedMaterial=null,this.defaultScreenSpaceImageMask9TiledMaterial=null,this.defaultScreenSpaceImageMaskMaterial=null,this.defaultTextMaterial=null,this.defaultBitmapTextMaterial=null,this.defaultScreenSpaceTextMaterial=null,this.defaultScreenSpaceBitmapTextMaterial=null,this.defaultImageMaterials=[],this.on("beforeremove",this.onRemoveComponent,this)}destroy(){this._defaultTexture.destroy()}initializeComponentData(t,e,i){t._beingInitialized=!0,void 0!==e.anchor&&(e.anchor instanceof X?t.anchor.copy(e.anchor):t.anchor.set(e.anchor[0],e.anchor[1],e.anchor[2],e.anchor[3])),void 0!==e.pivot&&(e.pivot instanceof W?t.pivot.copy(e.pivot):t.pivot.set(e.pivot[0],e.pivot[1]));var n,r=Math.abs(t.anchor.x-t.anchor.z)>.001,s=Math.abs(t.anchor.y-t.anchor.w)>.001,a=!1;void 0!==e.margin&&(e.margin instanceof X?t.margin.copy(e.margin):t._margin.set(e.margin[0],e.margin[1],e.margin[2],e.margin[3]),a=!0),void 0!==e.left&&(t._margin.x=e.left,a=!0),void 0!==e.bottom&&(t._margin.y=e.bottom,a=!0),void 0!==e.right&&(t._margin.z=e.right,a=!0),void 0!==e.top&&(t._margin.w=e.top,a=!0),a&&(t.margin=t._margin);var o=!1;void 0===e.width||r?r&&(o=!0):t.width=e.width,void 0===e.height||s?s&&(o=!0):t.height=e.height,o&&(t.anchor=t.anchor),void 0!==e.enabled&&(t.enabled=e.enabled),void 0!==e.useInput&&(t.useInput=e.useInput),t.batchGroupId=void 0===e.batchGroupId||null===e.batchGroupId?-1:e.batchGroupId,e.layers&&Array.isArray(e.layers)&&(t.layers=e.layers.slice(0)),void 0!==e.type&&(t.type=e.type),"image"===t.type?(void 0!==e.rect&&(t.rect=e.rect),void 0!==e.color&&((n=e.color)instanceof D||(n=new D(e.color[0],e.color[1],e.color[2])),t.color=n),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.textureAsset&&(t.textureAsset=e.textureAsset),e.texture&&(t.texture=e.texture),void 0!==e.spriteAsset&&(t.spriteAsset=e.spriteAsset),e.sprite&&(t.sprite=e.sprite),void 0!==e.spriteFrame&&(t.spriteFrame=e.spriteFrame),void 0!==e.pixelsPerUnit&&null!==e.pixelsPerUnit&&(t.pixelsPerUnit=e.pixelsPerUnit),void 0!==e.materialAsset&&(t.materialAsset=e.materialAsset),e.material&&(t.material=e.material),void 0!==e.mask&&(t.mask=e.mask)):"text"===t.type&&(void 0!==e.autoWidth&&(t.autoWidth=e.autoWidth),void 0!==e.autoHeight&&(t.autoHeight=e.autoHeight),void 0!==e.rtlReorder&&(t.rtlReorder=e.rtlReorder),void 0!==e.unicodeConverter&&(t.unicodeConverter=e.unicodeConverter),null!==e.text&&void 0!==e.text?t.text=e.text:null!==e.key&&void 0!==e.key&&(t.key=e.key),void 0!==e.color&&((n=e.color)instanceof D||(n=new D(n[0],n[1],n[2])),t.color=n),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.spacing&&(t.spacing=e.spacing),void 0!==e.fontSize&&(t.fontSize=e.fontSize,e.lineHeight||(t.lineHeight=e.fontSize)),void 0!==e.lineHeight&&(t.lineHeight=e.lineHeight),void 0!==e.maxLines&&(t.maxLines=e.maxLines),void 0!==e.wrapLines&&(t.wrapLines=e.wrapLines),void 0!==e.minFontSize&&(t.minFontSize=e.minFontSize),void 0!==e.maxFontSize&&(t.maxFontSize=e.maxFontSize),e.autoFitWidth&&(t.autoFitWidth=e.autoFitWidth),e.autoFitHeight&&(t.autoFitHeight=e.autoFitHeight),void 0!==e.fontAsset&&(t.fontAsset=e.fontAsset),void 0!==e.font&&(t.font=e.font),void 0!==e.alignment&&(t.alignment=e.alignment),void 0!==e.outlineColor&&(t.outlineColor=e.outlineColor),void 0!==e.outlineThickness&&(t.outlineThickness=e.outlineThickness),void 0!==e.shadowColor&&(t.shadowColor=e.shadowColor),void 0!==e.shadowOffset&&(t.shadowOffset=e.shadowOffset),void 0!==e.enableMarkup&&(t.enableMarkup=e.enableMarkup));var l=t._parseUpToScreen();l.screen&&t._updateScreen(l.screen),super.initializeComponentData(t,e,i),t._beingInitialized=!1,"image"===t.type&&t._image._meshDirty&&t._image._updateMesh(t._image.mesh)}onRemoveComponent(t,e){e.onRemove()}cloneComponent(t,e){var i=t.element,n={enabled:i.enabled,width:i.width,height:i.height,anchor:i.anchor.clone(),pivot:i.pivot.clone(),margin:i.margin.clone(),alignment:i.alignment&&i.alignment.clone()||i.alignment,autoWidth:i.autoWidth,autoHeight:i.autoHeight,type:i.type,rect:i.rect&&i.rect.clone()||i.rect,rtlReorder:i.rtlReorder,unicodeConverter:i.unicodeConverter,materialAsset:i.materialAsset,material:i.material,color:i.color&&i.color.clone()||i.color,opacity:i.opacity,textureAsset:i.textureAsset,texture:i.texture,spriteAsset:i.spriteAsset,sprite:i.sprite,spriteFrame:i.spriteFrame,pixelsPerUnit:i.pixelsPerUnit,spacing:i.spacing,lineHeight:i.lineHeight,wrapLines:i.wrapLines,layers:i.layers,fontSize:i.fontSize,minFontSize:i.minFontSize,maxFontSize:i.maxFontSize,autoFitWidth:i.autoFitWidth,autoFitHeight:i.autoFitHeight,maxLines:i.maxLines,fontAsset:i.fontAsset,font:i.font,useInput:i.useInput,batchGroupId:i.batchGroupId,mask:i.mask,outlineColor:i.outlineColor&&i.outlineColor.clone()||i.outlineColor,outlineThickness:i.outlineThickness,shadowColor:i.shadowColor&&i.shadowColor.clone()||i.shadowColor,shadowOffset:i.shadowOffset&&i.shadowOffset.clone()||i.shadowOffset,enableMarkup:i.enableMarkup};return void 0!==i.key&&null!==i.key?n.key=i.key:n.text=i.text,this.addComponent(e,n)}getTextElementMaterial(t,e){return t?e?(this.defaultScreenSpaceTextMaterial||(this.defaultScreenSpaceTextMaterial=new af,this.defaultScreenSpaceTextMaterial.name="defaultScreenSpaceTextMaterial",this.defaultScreenSpaceTextMaterial.msdfMap=this._defaultTexture,this.defaultScreenSpaceTextMaterial.useLighting=!1,this.defaultScreenSpaceTextMaterial.useGammaTonemap=!1,this.defaultScreenSpaceTextMaterial.useFog=!1,this.defaultScreenSpaceTextMaterial.useSkybox=!1,this.defaultScreenSpaceTextMaterial.diffuse.set(0,0,0),this.defaultScreenSpaceTextMaterial.emissive.set(1,1,1),this.defaultScreenSpaceTextMaterial.opacity=.5,this.defaultScreenSpaceTextMaterial.blendType=4,this.defaultScreenSpaceTextMaterial.depthWrite=!1,this.defaultScreenSpaceTextMaterial.depthTest=!1,this.defaultScreenSpaceTextMaterial.emissiveVertexColor=!0,this.defaultScreenSpaceTextMaterial.update()),this.defaultScreenSpaceTextMaterial):(this.defaultScreenSpaceBitmapTextMaterial||(this.defaultScreenSpaceBitmapTextMaterial=new af,this.defaultScreenSpaceBitmapTextMaterial.name="defaultScreenSpaceBitmapTextMaterial",this.defaultScreenSpaceBitmapTextMaterial.emissive.set(.5,.5,.5),this.defaultScreenSpaceBitmapTextMaterial.emissiveMap=this._defaultTexture,this.defaultScreenSpaceBitmapTextMaterial.emissiveTint=!0,this.defaultScreenSpaceBitmapTextMaterial.opacity=.5,this.defaultScreenSpaceBitmapTextMaterial.opacityMap=this._defaultTexture,this.defaultScreenSpaceBitmapTextMaterial.opacityMapChannel="a",this.defaultScreenSpaceBitmapTextMaterial.useLighting=!1,this.defaultScreenSpaceBitmapTextMaterial.useGammaTonemap=!1,this.defaultScreenSpaceBitmapTextMaterial.useFog=!1,this.defaultScreenSpaceBitmapTextMaterial.useSkybox=!1,this.defaultScreenSpaceBitmapTextMaterial.diffuse.set(0,0,0),this.defaultScreenSpaceBitmapTextMaterial.blendType=4,this.defaultScreenSpaceBitmapTextMaterial.depthWrite=!1,this.defaultScreenSpaceBitmapTextMaterial.depthTest=!1,this.defaultScreenSpaceBitmapTextMaterial.emissiveVertexColor=!0,this.defaultScreenSpaceBitmapTextMaterial.update()),this.defaultScreenSpaceBitmapTextMaterial):e?(this.defaultTextMaterial||(this.defaultTextMaterial=new af,this.defaultTextMaterial.name="defaultTextMaterial",this.defaultTextMaterial.msdfMap=this._defaultTexture,this.defaultTextMaterial.useLighting=!1,this.defaultTextMaterial.useGammaTonemap=!1,this.defaultTextMaterial.useFog=!1,this.defaultTextMaterial.useSkybox=!1,this.defaultTextMaterial.diffuse.set(0,0,0),this.defaultTextMaterial.emissive.set(1,1,1),this.defaultTextMaterial.opacity=.5,this.defaultTextMaterial.blendType=4,this.defaultTextMaterial.depthWrite=!1,this.defaultTextMaterial.emissiveVertexColor=!0,this.defaultTextMaterial.update()),this.defaultTextMaterial):(this.defaultBitmapTextMaterial||(this.defaultBitmapTextMaterial=new af,this.defaultBitmapTextMaterial.name="defaultBitmapTextMaterial",this.defaultBitmapTextMaterial.emissive.set(.5,.5,.5),this.defaultBitmapTextMaterial.emissiveTint=!0,this.defaultBitmapTextMaterial.emissiveMap=this._defaultTexture,this.defaultBitmapTextMaterial.opacity=.5,this.defaultBitmapTextMaterial.opacityMap=this._defaultTexture,this.defaultBitmapTextMaterial.opacityMapChannel="a",this.defaultBitmapTextMaterial.useLighting=!1,this.defaultBitmapTextMaterial.useGammaTonemap=!1,this.defaultBitmapTextMaterial.useFog=!1,this.defaultBitmapTextMaterial.useSkybox=!1,this.defaultBitmapTextMaterial.diffuse.set(0,0,0),this.defaultBitmapTextMaterial.blendType=4,this.defaultBitmapTextMaterial.depthWrite=!1,this.defaultBitmapTextMaterial.emissiveVertexColor=!0,this.defaultBitmapTextMaterial.update()),this.defaultBitmapTextMaterial)}_createBaseImageMaterial(){var t=new af;return t.diffuse.set(0,0,0),t.emissive.set(.5,.5,.5),t.emissiveMap=this._defaultTexture,t.emissiveTint=!0,t.opacityMap=this._defaultTexture,t.opacityMapChannel="a",t.opacityTint=!0,t.opacity=0,t.useLighting=!1,t.useGammaTonemap=!1,t.useFog=!1,t.useSkybox=!1,t.blendType=4,t.depthWrite=!1,t}getImageElementMaterial(t,e,i,n){return t?e?i?(this.defaultScreenSpaceImageMask9SlicedMaterial||(this.defaultScreenSpaceImageMask9SlicedMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImageMask9SlicedMaterial.name="defaultScreenSpaceImageMask9SlicedMaterial",this.defaultScreenSpaceImageMask9SlicedMaterial.nineSlicedMode=1,this.defaultScreenSpaceImageMask9SlicedMaterial.depthTest=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.alphaTest=1,this.defaultScreenSpaceImageMask9SlicedMaterial.redWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.greenWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.blueWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImageMask9SlicedMaterial)),this.defaultScreenSpaceImageMask9SlicedMaterial):n?(this.defaultScreenSpaceImageMask9TiledMaterial||(this.defaultScreenSpaceImageMask9TiledMaterial=this.defaultScreenSpaceImage9TiledMaterial.clone(),this.defaultScreenSpaceImageMask9TiledMaterial.name="defaultScreenSpaceImageMask9TiledMaterial",this.defaultScreenSpaceImageMask9TiledMaterial.nineSlicedMode=2,this.defaultScreenSpaceImageMask9TiledMaterial.depthTest=!1,this.defaultScreenSpaceImageMask9TiledMaterial.alphaTest=1,this.defaultScreenSpaceImageMask9TiledMaterial.redWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.greenWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.blueWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImageMask9TiledMaterial)),this.defaultScreenSpaceImageMask9TiledMaterial):(this.defaultScreenSpaceImageMaskMaterial||(this.defaultScreenSpaceImageMaskMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImageMaskMaterial.name="defaultScreenSpaceImageMaskMaterial",this.defaultScreenSpaceImageMaskMaterial.depthTest=!1,this.defaultScreenSpaceImageMaskMaterial.alphaTest=1,this.defaultScreenSpaceImageMaskMaterial.redWrite=!1,this.defaultScreenSpaceImageMaskMaterial.greenWrite=!1,this.defaultScreenSpaceImageMaskMaterial.blueWrite=!1,this.defaultScreenSpaceImageMaskMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMaskMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImageMaskMaterial)),this.defaultScreenSpaceImageMaskMaterial):i?(this.defaultScreenSpaceImage9SlicedMaterial||(this.defaultScreenSpaceImage9SlicedMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImage9SlicedMaterial.name="defaultScreenSpaceImage9SlicedMaterial",this.defaultScreenSpaceImage9SlicedMaterial.nineSlicedMode=1,this.defaultScreenSpaceImage9SlicedMaterial.depthTest=!1,this.defaultScreenSpaceImage9SlicedMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImage9SlicedMaterial)),this.defaultScreenSpaceImage9SlicedMaterial):n?(this.defaultScreenSpaceImage9TiledMaterial||(this.defaultScreenSpaceImage9TiledMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImage9TiledMaterial.name="defaultScreenSpaceImage9TiledMaterial",this.defaultScreenSpaceImage9TiledMaterial.nineSlicedMode=2,this.defaultScreenSpaceImage9TiledMaterial.depthTest=!1,this.defaultScreenSpaceImage9TiledMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImage9TiledMaterial)),this.defaultScreenSpaceImage9TiledMaterial):(this.defaultScreenSpaceImageMaterial||(this.defaultScreenSpaceImageMaterial=this._createBaseImageMaterial(),this.defaultScreenSpaceImageMaterial.name="defaultScreenSpaceImageMaterial",this.defaultScreenSpaceImageMaterial.depthTest=!1,this.defaultScreenSpaceImageMaterial.update(),this.defaultImageMaterials.push(this.defaultScreenSpaceImageMaterial)),this.defaultScreenSpaceImageMaterial):e?i?(this.defaultImage9SlicedMaskMaterial||(this.defaultImage9SlicedMaskMaterial=this._createBaseImageMaterial(),this.defaultImage9SlicedMaskMaterial.name="defaultImage9SlicedMaskMaterial",this.defaultImage9SlicedMaskMaterial.nineSlicedMode=1,this.defaultImage9SlicedMaskMaterial.alphaTest=1,this.defaultImage9SlicedMaskMaterial.redWrite=!1,this.defaultImage9SlicedMaskMaterial.greenWrite=!1,this.defaultImage9SlicedMaskMaterial.blueWrite=!1,this.defaultImage9SlicedMaskMaterial.alphaWrite=!1,this.defaultImage9SlicedMaskMaterial.update(),this.defaultImageMaterials.push(this.defaultImage9SlicedMaskMaterial)),this.defaultImage9SlicedMaskMaterial):n?(this.defaultImage9TiledMaskMaterial||(this.defaultImage9TiledMaskMaterial=this._createBaseImageMaterial(),this.defaultImage9TiledMaskMaterial.name="defaultImage9TiledMaskMaterial",this.defaultImage9TiledMaskMaterial.nineSlicedMode=2,this.defaultImage9TiledMaskMaterial.alphaTest=1,this.defaultImage9TiledMaskMaterial.redWrite=!1,this.defaultImage9TiledMaskMaterial.greenWrite=!1,this.defaultImage9TiledMaskMaterial.blueWrite=!1,this.defaultImage9TiledMaskMaterial.alphaWrite=!1,this.defaultImage9TiledMaskMaterial.update(),this.defaultImageMaterials.push(this.defaultImage9TiledMaskMaterial)),this.defaultImage9TiledMaskMaterial):(this.defaultImageMaskMaterial||(this.defaultImageMaskMaterial=this._createBaseImageMaterial(),this.defaultImageMaskMaterial.name="defaultImageMaskMaterial",this.defaultImageMaskMaterial.alphaTest=1,this.defaultImageMaskMaterial.redWrite=!1,this.defaultImageMaskMaterial.greenWrite=!1,this.defaultImageMaskMaterial.blueWrite=!1,this.defaultImageMaskMaterial.alphaWrite=!1,this.defaultImageMaskMaterial.update(),this.defaultImageMaterials.push(this.defaultImageMaskMaterial)),this.defaultImageMaskMaterial):i?(this.defaultImage9SlicedMaterial||(this.defaultImage9SlicedMaterial=this._createBaseImageMaterial(),this.defaultImage9SlicedMaterial.name="defaultImage9SlicedMaterial",this.defaultImage9SlicedMaterial.nineSlicedMode=1,this.defaultImage9SlicedMaterial.update(),this.defaultImageMaterials.push(this.defaultImage9SlicedMaterial)),this.defaultImage9SlicedMaterial):n?(this.defaultImage9TiledMaterial||(this.defaultImage9TiledMaterial=this._createBaseImageMaterial(),this.defaultImage9TiledMaterial.name="defaultImage9TiledMaterial",this.defaultImage9TiledMaterial.nineSlicedMode=2,this.defaultImage9TiledMaterial.update(),this.defaultImageMaterials.push(this.defaultImage9TiledMaterial)),this.defaultImage9TiledMaterial):(this.defaultImageMaterial||(this.defaultImageMaterial=this._createBaseImageMaterial(),this.defaultImageMaterial.name="defaultImageMaterial",this.defaultImageMaterial.update(),this.defaultImageMaterials.push(this.defaultImageMaterial)),this.defaultImageMaterial)}registerUnicodeConverter(t){this._unicodeConverter=t}registerRtlReorder(t){this._rtlReorder=t}getUnicodeConverter(){return this._unicodeConverter}getRtlReorder(){return this._rtlReorder}}Cl._buildAccessors(xc.prototype,Cc);class Sc extends Cl{constructor(t,e){super(t,e),this._minWidth=0,this._minHeight=0,this._maxWidth=null,this._maxHeight=null,this._fitWidthProportion=0,this._fitHeightProportion=0,this._excludeFromLayout=!1}}function Mc(t){var e="_"+t;Object.defineProperty(Sc.prototype,t,{get:function(){return this[e]},set:function(t){this[e]!==t&&(this[e]=t,this.fire("resize"))}})}Mc("minWidth"),Mc("minHeight"),Mc("maxWidth"),Mc("maxHeight"),Mc("fitWidthProportion"),Mc("fitHeightProportion"),Mc("excludeFromLayout");class Tc{constructor(){this.enabled=!0}}const Pc=["enabled"];class Ec extends Il{constructor(t){super(t),this.id="layoutchild",this.ComponentType=Sc,this.DataType=Tc,this.schema=Pc}initializeComponentData(t,e,i){void 0!==e.enabled&&(t.enabled=e.enabled),void 0!==e.minWidth&&(t.minWidth=e.minWidth),void 0!==e.minHeight&&(t.minHeight=e.minHeight),void 0!==e.maxWidth&&(t.maxWidth=e.maxWidth),void 0!==e.maxHeight&&(t.maxHeight=e.maxHeight),void 0!==e.fitWidthProportion&&(t.fitWidthProportion=e.fitWidthProportion),void 0!==e.fitHeightProportion&&(t.fitHeightProportion=e.fitHeightProportion),void 0!==e.excludeFromLayout&&(t.excludeFromLayout=e.excludeFromLayout),super.initializeComponentData(t,e,i)}cloneComponent(t,e){var i=t.layoutchild;return this.addComponent(e,{enabled:i.enabled,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,fitWidthProportion:i.fitWidthProportion,fitHeightProportion:i.fitHeightProportion,excludeFromLayout:i.excludeFromLayout})}}Cl._buildAccessors(Sc.prototype,Pc);var kc={0:{axis:"x",size:"width",calculatedSize:"calculatedWidth",minSize:"minWidth",maxSize:"maxWidth",fitting:"widthFitting",fittingProportion:"fitWidthProportion"},1:{axis:"y",size:"height",calculatedSize:"calculatedHeight",minSize:"minHeight",maxSize:"maxHeight",fitting:"heightFitting",fittingProportion:"fitHeightProportion"}},Dc={0:1,1:0},Oc={minWidth:0,minHeight:0,maxWidth:Number.POSITIVE_INFINITY,maxHeight:Number.POSITIVE_INFINITY,width:null,height:null,fitWidthProportion:0,fitHeightProportion:0},Rc="NONE",Lc="APPLY_STRETCHING",Nc="APPLY_SHRINKING",zc=new W;function Bc(t){var e,i=kc[t],n=kc[Dc[t]];function r(t,e){return-e[i.size]*t.pivot[i.axis]}function s(t,e){return-e[n.size]*t.pivot[n.axis]}function a(t,e){return e[i.size]*(1-t.pivot[i.axis])}function o(t){var e=t.entity.layoutchild;return!e||!e.enabled||!e.excludeFromLayout}function l(t,e,i){switch(t){case 0:return Rc;case 1:return e<i?Lc:Rc;case 2:return e>=i?Nc:Rc;case 3:return e<i?Lc:e>=i?Nc:Rc;default:throw new Error("Unrecognized fitting mode: "+t)}}function h(t,i){return g(t,i.size)+(t.length-1)*e.spacing[i.axis]}function c(t,e,i){for(var n=_(t,i.maxSize),r=v(t,i.fittingProportion),s=x(r,n),a=zc[i.axis]-e,o=0;o<t.length;++o){var l=n[o],h=d(l,a,r,s),c=t[l][i.size]+h,u=t[l][i.maxSize],f=Math.min(c,u);t[l][i.size]=f,a-=h-Math.max(c-f,0)}}function u(t,e,i){for(var n=_(t,i.minSize,!0),r=function(t){if(1===t.length)return[1];for(var e=[],i=t.length,n=0;n<i;++n)e.push((1-t[n])/(i-1));return e}(v(t,i.fittingProportion)),s=x(r,n),a=e-zc[i.axis],o=0;o<t.length;++o){var l=n[o],h=d(l,a,r,s),c=t[l][i.size]-h,u=t[l][i.minSize],f=Math.max(c,u);t[l][i.size]=f,a-=h-Math.max(f-c,0)}}function d(t,e,i,n){var r=i[t],s=n[t];return Math.abs(r)<1e-5&&Math.abs(s)<1e-5?e:e*r/s}function f(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],r=Math.max(p(n,"minWidth"),0),s=Math.max(p(n,"minHeight"),0),a=Math.max(p(n,"maxWidth"),r),o=Math.max(p(n,"maxHeight"),s),l=m(p(n,"width"),r,a),h=m(p(n,"height"),s,o),c=p(n,"fitWidthProportion"),u=p(n,"fitHeightProportion");e.push({minWidth:r,minHeight:s,maxWidth:a,maxHeight:o,width:l,height:h,fitWidthProportion:c,fitHeightProportion:u})}return e}function p(t,e){var i=t.entity.layoutchild;return i&&i.enabled&&void 0!==i[e]&&null!==i[e]?i[e]:void 0!==t[e]?t[e]:Oc[e]}function m(t,e,i){return Math.min(Math.max(t,e),i)}function g(t,e){return t.reduce((function(t,i){return t+i[e]}),0)}function v(t,e){var i,n=g(t,e),r=[],s=t.length;if(0===n)for(i=0;i<s;++i)r.push(1/s);else for(i=0;i<s;++i)r.push(t[i][e]/n);return r}function _(t,e,i){return t.forEach(y),t.slice().sort((function(t,n){return i?n[e]-t[e]:t[e]-n[e]})).map(b)}function y(t,e){t.index=e}function b(t){return t.index}function x(t,e){var i=[];i[e[t.length-1]]=t[e[t.length-1]];for(var n=t.length-2;n>=0;--n)i[e[n]]=i[e[n+1]]+t[e[n]];return i}return function(t,d){t=t.filter(o),e=d,zc.x=e.containerSize.x-e.padding.x-e.padding.z,zc.y=e.containerSize.y-e.padding.y-e.padding.w,function(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.anchor;0===n.x&&0===n.y&&0===n.z&&0===n.w||(i.anchor=X.ZERO)}}(t);var p=function(t){var i=0===e.orientation&&e.reverseX||1===e.orientation&&e.reverseY,n=0===e.orientation&&e.reverseY||1===e.orientation&&e.reverseX;if(i)for(var r=0;r<t.length;++r)i&&t[r].reverse();n&&t.reverse();return t}(function(t){if(!e.wrap)return[t];for(var n=[[]],r=f(t),s=0,a=2===e[i.fitting],o=0;o<t.length;++o){n[n.length-1].length>0&&(s+=e.spacing[i.axis]);var l=r[o][i.size];s+=l,!a&&s>zc[i.axis]&&0!==n[n.length-1].length&&(s=l,n.push([])),n[n.length-1].push(t[o]),a&&s>zc[i.axis]&&o!==t.length-1&&(s=0,n.push([]))}return n}(t)),m=function(t,i){var r,s,a,o=[],d=[];for(s=0;s<t.length;++s){for((a=t[s]).largestElement=null,a.largestSize={width:Number.NEGATIVE_INFINITY,height:Number.NEGATIVE_INFINITY},r=0;r<a.length;++r){var f=i[s][r];f[n.size]>a.largestSize[n.size]&&(a.largestElement=a[r],a.largestSize=f)}o.push(a.largestElement),d.push(a.largestSize)}var p=h(d,n),m=l(e[n.fitting],p,zc[n.axis]);m===Lc?c(d,p,n):m===Nc&&u(d,p,n);for(s=0;s<t.length;++s)for(a=t[s],r=0;r<a.length;++r){var g=i[s][r],v=g[n.size],_=1===t.length?zc[n.axis]:a.largestSize[n.size],y=l(e[n.fitting],v,_);y===Lc?g[n.size]=Math.min(_,g[n.maxSize]):y===Nc&&(g[n.size]=Math.max(_,g[n.minSize]))}return i}(p,function(t){for(var n=[],r=0;r<t.length;++r){var s=f(t[r]),a=h(s,i),o=l(e[i.fitting],a,zc[i.axis]);o===Lc?c(s,a,i):o===Nc&&u(s,a,i),n.push(s)}return n}(p)),g=function(t,o){var l={};l[i.axis]=0,l[n.axis]=0,t[i.size]=Number.NEGATIVE_INFINITY;for(var h=[],c=0;c<t.length;++c){var u=t[c];if(0===u.length)return;for(var d=[],f=o[c],p=0;p<u.length;++p){var m=u[p],g=f[p];l[n.axis]-=s(m,g),l[i.axis]-=r(m,g),d[p]={},d[p][i.axis]=l[i.axis],d[p][n.axis]=l[n.axis],l[n.axis]+=s(m,g),l[i.axis]+=a(m,g)+e.spacing[i.axis]}u[i.size]=l[i.axis]-e.spacing[i.axis],u[n.size]=u.largestSize[n.size],t[i.size]=Math.max(t[i.size],u[i.size]),l[i.axis]=0,l[n.axis]+=u[n.size]+e.spacing[n.axis],h.push(d)}return t[n.size]=l[n.axis]-e.spacing[n.axis],h}(p,m);return function(t,r,s){for(var a=e.alignment[i.axis],o=e.alignment[n.axis],l=e.padding[i.axis],h=e.padding[n.axis],c=0;c<t.length;++c)for(var u=t[c],d=r[c],f=s[c],p=(zc[i.axis]-u[i.size])*a+l,m=(zc[n.axis]-t[n.size])*o+h,g=0;g<u.length;++g){var v=(u[n.size]-d[g][n.size])*e.alignment[n.axis];f[g][i.axis]+=p,f[g][n.axis]+=m+v}}(p,m,g),function(t,r,s){for(var a=0;a<t.length;++a)for(var o=t[a],l=r[a],h=s[a],c=0;c<o.length;++c){var u=o[c];u[i.calculatedSize]=l[c][i.size],u[n.calculatedSize]=l[c][n.size],0===e.orientation?u.entity.setLocalPosition(h[c][i.axis],h[c][n.axis],u.entity.getLocalPosition().z):u.entity.setLocalPosition(h[c][n.axis],h[c][i.axis],u.entity.getLocalPosition().z)}}(p,m,g),function(t){var i=t.width,n=t.height,r=(zc.x-i)*e.alignment.x+e.padding.x,s=(zc.y-n)*e.alignment.y+e.padding.y;return{bounds:new X(r,s,i,n)}}(p)}}var Fc={};Fc[0]=Bc(0),Fc[1]=Bc(1);class jc{constructor(){}calculateLayout(t,e){var i=Fc[e.orientation];if(i)return i(t,e);throw new Error("Unrecognized orientation value: "+e.orientation)}}function Vc(t){return t.element}function Uc(t){return t.enabled&&t.element&&t.element.enabled}class Gc extends Cl{constructor(t,e){super(t,e),this._orientation=0,this._reverseX=!1,this._reverseY=!0,this._alignment=new W(0,1),this._padding=new X,this._spacing=new W,this._widthFitting=0,this._heightFitting=0,this._wrap=!1,this._layoutCalculator=new jc,this._listenForReflowEvents(this.entity,"on"),this.entity.children.forEach(function(t){this._listenForReflowEvents(t,"on")}.bind(this)),this.entity.on("childinsert",this._onChildInsert,this),this.entity.on("childremove",this._onChildRemove,this),t.app.systems.element.on("add",this._onElementOrLayoutComponentAdd,this),t.app.systems.element.on("beforeremove",this._onElementOrLayoutComponentRemove,this),t.app.systems.layoutchild.on("add",this._onElementOrLayoutComponentAdd,this),t.app.systems.layoutchild.on("beforeremove",this._onElementOrLayoutComponentRemove,this)}_isSelfOrChild(t){return t===this.entity||-1!==this.entity.children.indexOf(t)}_listenForReflowEvents(t,e){t.element&&(t.element[e]("enableelement",this._scheduleReflow,this),t.element[e]("disableelement",this._scheduleReflow,this),t.element[e]("resize",this._scheduleReflow,this),t.element[e]("set:pivot",this._scheduleReflow,this)),t.layoutchild&&(t.layoutchild[e]("set_enabled",this._scheduleReflow,this),t.layoutchild[e]("resize",this._scheduleReflow,this))}_onElementOrLayoutComponentAdd(t){this._isSelfOrChild(t)&&(this._listenForReflowEvents(t,"on"),this._scheduleReflow())}_onElementOrLayoutComponentRemove(t){this._isSelfOrChild(t)&&(this._listenForReflowEvents(t,"off"),this._scheduleReflow())}_onChildInsert(t){this._listenForReflowEvents(t,"on"),this._scheduleReflow()}_onChildRemove(t){this._listenForReflowEvents(t,"off"),this._scheduleReflow()}_scheduleReflow(){this.enabled&&this.entity&&this.entity.enabled&&!this._isPerformingReflow&&this.system.scheduleReflow(this)}reflow(){var t=Vc(this.entity),e=this.entity.children.filter(Uc).map(Vc);if(t&&0!==e.length){var i=Math.max(t.calculatedWidth,0),n=Math.max(t.calculatedHeight,0),r={orientation:this._orientation,reverseX:this._reverseX,reverseY:this._reverseY,alignment:this._alignment,padding:this._padding,spacing:this._spacing,widthFitting:this._widthFitting,heightFitting:this._heightFitting,wrap:this._wrap,containerSize:new W(i,n)};this._isPerformingReflow=!0;var s=this._layoutCalculator.calculateLayout(e,r);this._isPerformingReflow=!1,this.fire("reflow",s)}}onEnable(){this._scheduleReflow()}onRemove(){this.entity.off("childinsert",this._onChildInsert,this),this.entity.off("childremove",this._onChildRemove,this),this._listenForReflowEvents(this.entity,"off"),this.entity.children.forEach(function(t){this._listenForReflowEvents(t,"off")}.bind(this)),this.system.app.systems.element.off("add",this._onElementOrLayoutComponentAdd,this),this.system.app.systems.element.off("beforeremove",this._onElementOrLayoutComponentRemove,this),this.system.app.systems.layoutchild.off("add",this._onElementOrLayoutComponentAdd,this),this.system.app.systems.layoutchild.off("beforeremove",this._onElementOrLayoutComponentRemove,this)}}function Wc(t){var e="_"+t;Object.defineProperty(Gc.prototype,t,{get:function(){return this[e]},set:function(t){this[e]!==t&&(this[e]=t,this._scheduleReflow())}})}Wc("orientation"),Wc("reverseX"),Wc("reverseY"),Wc("alignment"),Wc("padding"),Wc("spacing"),Wc("widthFitting"),Wc("heightFitting"),Wc("wrap");class Hc{constructor(){this.enabled=!0}}const Xc=["enabled"];class Zc extends Il{constructor(t){super(t),this.id="layoutgroup",this.ComponentType=Gc,this.DataType=Hc,this.schema=Xc,this._reflowQueue=[],this.on("beforeremove",this._onRemoveComponent,this),Il.bind("postUpdate",this._onPostUpdate,this)}initializeComponentData(t,e,i){void 0!==e.enabled&&(t.enabled=e.enabled),void 0!==e.orientation&&(t.orientation=e.orientation),void 0!==e.reverseX&&(t.reverseX=e.reverseX),void 0!==e.reverseY&&(t.reverseY=e.reverseY),void 0!==e.alignment&&(e.alignment instanceof W?t.alignment.copy(e.alignment):t.alignment.set(e.alignment[0],e.alignment[1]),t.alignment=t.alignment),void 0!==e.padding&&(e.padding instanceof X?t.padding.copy(e.padding):t.padding.set(e.padding[0],e.padding[1],e.padding[2],e.padding[3]),t.padding=t.padding),void 0!==e.spacing&&(e.spacing instanceof W?t.spacing.copy(e.spacing):t.spacing.set(e.spacing[0],e.spacing[1]),t.spacing=t.spacing),void 0!==e.widthFitting&&(t.widthFitting=e.widthFitting),void 0!==e.heightFitting&&(t.heightFitting=e.heightFitting),void 0!==e.wrap&&(t.wrap=e.wrap),super.initializeComponentData(t,e,i)}cloneComponent(t,e){var i=t.layoutgroup;return this.addComponent(e,{enabled:i.enabled,orientation:i.orientation,reverseX:i.reverseX,reverseY:i.reverseY,alignment:i.alignment,padding:i.padding,spacing:i.spacing,widthFitting:i.widthFitting,heightFitting:i.heightFitting,wrap:i.wrap})}scheduleReflow(t){-1===this._reflowQueue.indexOf(t)&&this._reflowQueue.push(t)}_onPostUpdate(){this._processReflowQueue()}_processReflowQueue(){if(0!==this._reflowQueue.length)for(var t=0;this._reflowQueue.length>0;){var e=this._reflowQueue.slice();this._reflowQueue.length=0,e.sort((function(t,e){return t.entity.graphDepth-e.entity.graphDepth}));for(var i=0;i<e.length;++i)e[i].reflow();if(++t>=100){console.warn("Max reflow iterations limit reached, bailing.");break}}}_onRemoveComponent(t,e){e.onRemove()}}Cl._buildAccessors(Gc.prototype,Xc);var Yc=new H,qc=new H,Kc=new H,Jc={r:0,g:1,b:2,a:3};class Qc{constructor(){this._type=0,this._color=new D(.8,.8,.8),this._intensity=1,this._castShadows=!1,this.enabled=!1,this.mask=1,this.isStatic=!1,this.key=0,this.bakeDir=!0,this.attenuationStart=10,this.attenuationEnd=10,this._falloffMode=0,this._shadowType=0,this._vsmBlurSize=11,this.vsmBlurMode=1,this.vsmBias=.0025,this._cookie=null,this.cookieIntensity=1,this._cookieFalloff=!0,this._cookieChannel="rgb",this._cookieTransform=null,this._cookieTransformUniform=new Float32Array(4),this._cookieOffset=null,this._cookieOffsetUniform=new Float32Array(2),this._cookieTransformSet=!1,this._cookieOffsetSet=!1,this._innerConeAngle=40,this._outerConeAngle=45,this._shape=0,this._finalColor=new Float32Array([.8,.8,.8]);var t=Math.pow(this._finalColor[0],2.2);this._linearFinalColor=new Float32Array([t,t,t]),this._position=new H(0,0,0),this._direction=new H(0,0,0),this._innerConeAngleCos=Math.cos(this._innerConeAngle*Math.PI/180),this._outerConeAngleCos=Math.cos(this._outerConeAngle*Math.PI/180),this._shadowCamera=null,this._shadowMatrix=new Q,this.shadowDistance=40,this._shadowResolution=1024,this.shadowBias=-5e-4,this._normalOffsetBias=0,this.shadowUpdateMode=2,this._scene=null,this._node=null,this._rendererParams=[],this._isVsm=!1,this._isPcf=!0,this._cacheShadowMap=!1,this._isCachedShadowMap=!1,this._visibleLength=[0],this._visibleList=[[]],this._visibleCameraSettings=[]}destroy(){this._destroyShadowMap()}clone(){var t=new Qc;return t.type=this._type,t.setColor(this._color),t.intensity=this._intensity,t.castShadows=this.castShadows,t.enabled=this.enabled,t.attenuationStart=this.attenuationStart,t.attenuationEnd=this.attenuationEnd,t.falloffMode=this._falloffMode,t.shadowType=this._shadowType,t.vsmBlurSize=this._vsmBlurSize,t.vsmBlurMode=this.vsmBlurMode,t.vsmBias=this.vsmBias,t.shadowUpdateMode=this.shadowUpdateMode,t.mask=this.mask,t.innerConeAngle=this._innerConeAngle,t.outerConeAngle=this._outerConeAngle,t.shape=this._shape,t.shadowBias=this.shadowBias,t.normalOffsetBias=this._normalOffsetBias,t.shadowResolution=this._shadowResolution,t.shadowDistance=this.shadowDistance,t}getColor(){return this._color}getBoundingSphere(t){if(2===this._type){var e=this.attenuationEnd,i=this._outerConeAngle,n=Math.cos(i*k.DEG_TO_RAD),r=this._node;Yc.copy(r.up),Yc.scale(.5*-e*n),Yc.add(r.getPosition()),t.center=Yc,qc.copy(r.up),qc.scale(-e),Kc.copy(r.right),Kc.scale(Math.sin(i*k.DEG_TO_RAD)*e),qc.add(Kc),t.radius=.5*qc.length()}else 1===this._type&&(t.center=this._node.getPosition(),t.radius=this.attenuationEnd)}getBoundingBox(t){if(2===this._type){var e=this.attenuationEnd,i=this._outerConeAngle,n=this._node,r=Math.abs(Math.sin(i*k.DEG_TO_RAD)*e);t.center.set(0,.5*-e,0),t.halfExtents.set(r,.5*e,r),t.setFromTransformedAabb(t,n.getWorldTransform())}else 1===this._type&&(t.center.copy(this._node.getPosition()),t.halfExtents.set(this.attenuationEnd,this.attenuationEnd,this.attenuationEnd))}_updateFinalColor(){var t=this._color,e=t.r,i=t.g,n=t.b,r=this._intensity,s=this._finalColor,a=this._linearFinalColor;s[0]=e*r,s[1]=i*r,s[2]=n*r,r>=1?(a[0]=Math.pow(e,2.2)*r,a[1]=Math.pow(i,2.2)*r,a[2]=Math.pow(n,2.2)*r):(a[0]=Math.pow(s[0],2.2),a[1]=Math.pow(s[1],2.2),a[2]=Math.pow(s[2],2.2))}setColor(){var t,e,i;1===arguments.length?(t=arguments[0].r,e=arguments[0].g,i=arguments[0].b):3===arguments.length&&(t=arguments[0],e=arguments[1],i=arguments[2]),this._color.set(t,e,i),this._updateFinalColor()}_destroyShadowMap(){if(this._shadowCamera){if(!this._isCachedShadowMap){var t,e=this._shadowCamera.renderTarget;if(e)if(e.length)for(t=0;t<e.length;t++)e[t].colorBuffer&&e[t].colorBuffer.destroy(),e[t].destroy();else e.colorBuffer&&e.colorBuffer.destroy(),e.depthBuffer&&e.depthBuffer.destroy(),e.destroy()}this._shadowCamera.renderTarget=null,this._shadowCamera=null,this._shadowCubeMap=null,0===this.shadowUpdateMode&&(this.shadowUpdateMode=1)}}updateShadow(){2!==this.shadowUpdateMode&&(this.shadowUpdateMode=1)}updateKey(){var t=this._type<<29|(this._castShadows?1:0)<<28|this._shadowType<<25|this._falloffMode<<23|(0!==this._normalOffsetBias?1:0)<<22|(this._cookie?1:0)<<21|(this._cookieFalloff?1:0)<<20|Jc[this._cookieChannel.charAt(0)]<<18|(this._cookieTransform?1:0)<<12|this._shape<<9;3===this._cookieChannel.length&&(t|=Jc[this._cookieChannel.charAt(1)]<<16,t|=Jc[this._cookieChannel.charAt(2)]<<14),t!==this.key&&null!==this._scene&&(this._scene.layers._dirtyLights=!0),this.key=t}uploadAreaLightLUTs(){function t(t,e,i){var n=new pe(t,{width:64,height:64,format:i,addressU:1,addressV:1,type:"default",magFilter:1,minFilter:0,anisotropy:1});return n.lock().set(e),n.unlock(),n.upload(),n}function e(t,e,i){for(var n=t.length,r=new Float32Array(n),s=0;s<n;s++){var a=s%4;r[s]=(t[s]+e[a])*i[a]}return r}function i(t){for(var e=t.length,i=new Uint16Array(e),n=k.float2Half,r=0;r<e;r++)i[r]=n(t[r]);return i}function n(t){for(var e=t.length,i=new Uint8ClampedArray(e),n=0;n<e;n++)i[n]=255*t[n];return i}var r=qd.getApplication(),s=pc._areaLightLutData;if(s&&!s.ready){s.ready=!0;var a,o,l=r.graphicsDevice,h=l._areaLightLutFormat;if(14===h)a=s.data1,o=s.data2;else if(12===h)a=i(s.data1),o=i(s.data2);else{a=n(e(s.data1,[0,.2976,.01381,0],[.999,3.08737,1.6546,.603249])),o=n(e(s.data2,[-.306897,0,0,0],[1.442787,1,1,1]))}var c=t(l,a,h),u=t(l,o,h);l.scope.resolve("areaLightsLutTex1").setValue(c),l.scope.resolve("areaLightsLutTex2").setValue(u)}}get type(){return this._type}set type(t){if(this._type!==t){this._type=t,this._destroyShadowMap(),this.updateKey();var e=this._shadowType;this._shadowType=null,this.shadowType=e}}get shape(){return this._shape}set shape(t=0){if(this._shape!==t){0!==t&&this.uploadAreaLightLUTs(),this._shape=t,this._destroyShadowMap(),this.updateKey();var e=this._shadowType;this._shadowType=null,this.shadowType=e}}get shadowType(){return this._shadowType}set shadowType(t){if(this._shadowType!==t){var e=qd.getApplication().graphicsDevice;1===this._type&&(t=0),4!==t||e.webgl2||(t=0),3!==t||e.textureFloatRenderable||(t=2),2!==t||e.textureHalfFloatRenderable||(t=1),this._isVsm=t>=1&&t<=3,this._isPcf=4===t||0===t,this._shadowType=t,this._destroyShadowMap(),this.updateKey()}}get castShadows(){return this._castShadows&&4!==this.mask&&0!==this.mask}set castShadows(t){this._castShadows!==t&&(this._castShadows=t,this.updateKey())}get shadowResolution(){return this._shadowResolution}set shadowResolution(t){if(this._shadowResolution!==t){var e=qd.getApplication().graphicsDevice;t=1===this._type?Math.min(t,e.maxCubeMapSize):Math.min(t,e.maxTextureSize),this._shadowResolution=t}}get vsmBlurSize(){return this._vsmBlurSize}set vsmBlurSize(t){this._vsmBlurSize!==t&&(t%2==0&&t++,this._vsmBlurSize=t)}get normalOffsetBias(){return this._normalOffsetBias}set normalOffsetBias(t){this._normalOffsetBias!==t&&((!this._normalOffsetBias&&t||this._normalOffsetBias&&!t)&&this.updateKey(),this._normalOffsetBias=t)}get falloffMode(){return this._falloffMode}set falloffMode(t){this._falloffMode!==t&&(this._falloffMode=t,this.updateKey())}get innerConeAngle(){return this._innerConeAngle}set innerConeAngle(t){this._innerConeAngle!==t&&(this._innerConeAngle=t,this._innerConeAngleCos=Math.cos(t*Math.PI/180))}get outerConeAngle(){return this._outerConeAngle}set outerConeAngle(t){this._outerConeAngle!==t&&(this._outerConeAngle=t,this._outerConeAngleCos=Math.cos(t*Math.PI/180))}get intensity(){return this._intensity}set intensity(t){this._intensity!==t&&(this._intensity=t,this._updateFinalColor())}get cookie(){return this._cookie}set cookie(t){this._cookie!==t&&(this._cookie=t,this.updateKey())}get cookieFalloff(){return this._cookieFalloff}set cookieFalloff(t){this._cookieFalloff!==t&&(this._cookieFalloff=t,this.updateKey())}get cookieChannel(){return this._cookieChannel}set cookieChannel(t){if(this._cookieChannel!==t){if(t.length<3)for(var e=t.charAt(t.length-1),i=3-t.length,n=0;n<i;n++)t+=e;this._cookieChannel=t,this.updateKey()}}get cookieTransform(){return this._cookieTransform}set cookieTransform(t){this._cookieTransform!==t&&(this._cookieTransform=t,this._cookieTransformSet=!!t,t&&!this._cookieOffset&&(this.cookieOffset=new W,this._cookieOffsetSet=!1),this.updateKey())}get cookieOffset(){return this._cookieOffset}set cookieOffset(t){this._cookieOffset!==t&&(!(!this._cookieTransformSet&&!t)&&!t&&this._cookieOffset?this._cookieOffset.set(0,0):this._cookieOffset=t,this._cookieOffsetSet=!!t,t&&!this._cookieTransform&&(this.cookieTransform=new X(1,1,0,0),this._cookieTransformSet=!1),this.updateKey())}}var $c=[],tu=[];class eu extends Cl{constructor(t,e){super(t,e),this._cookieAsset=null,this._cookieAssetId=null,this._cookieAssetAdd=!1,this._cookieMatrix=null}addLightToLayers(){for(var t,e=0;e<this.layers.length;e++)(t=this.system.app.scene.layers.getLayerById(this.layers[e]))&&t.addLight(this)}removeLightFromLayers(){for(var t,e=0;e<this.layers.length;e++)(t=this.system.app.scene.layers.getLayerById(this.layers[e]))&&t.removeLight(this)}onLayersChanged(t,e){this.enabled&&this.entity.enabled&&this.addLightToLayers(),t.off("add",this.onLayerAdded,this),t.off("remove",this.onLayerRemoved,this),e.on("add",this.onLayerAdded,this),e.on("remove",this.onLayerRemoved,this)}onLayerAdded(t){this.layers.indexOf(t.id)<0||this.enabled&&this.entity.enabled&&t.addLight(this)}onLayerRemoved(t){this.layers.indexOf(t.id)<0||t.removeLight(this)}refreshProperties(){for(var t,e=0;e<$c.length;e++)this[t=$c[e]]=this[t];this.enabled&&this.entity.enabled&&this.onEnable()}updateShadow(){this.light.updateShadow()}onCookieAssetSet(){var t=!1;"cubemap"!==this._cookieAsset.type||this._cookieAsset.loadFaces||(this._cookieAsset.loadFaces=!0,t=!0),this._cookieAsset.resource&&!t||this.system.app.assets.load(this._cookieAsset),this._cookieAsset.resource&&this.onCookieAssetLoad()}onCookieAssetAdd(t){this._cookieAssetId===t.id&&(this._cookieAsset=t,this.light.enabled&&this.onCookieAssetSet(),this._cookieAsset.on("load",this.onCookieAssetLoad,this),this._cookieAsset.on("remove",this.onCookieAssetRemove,this))}onCookieAssetLoad(){this._cookieAsset&&this._cookieAsset.resource&&(this.cookie=this._cookieAsset.resource)}onCookieAssetRemove(){this._cookieAssetId&&(this._cookieAssetAdd&&(this.system.app.assets.off("add:"+this._cookieAssetId,this.onCookieAssetAdd,this),this._cookieAssetAdd=!1),this._cookieAsset&&(this._cookieAsset.off("load",this.onCookieAssetLoad,this),this._cookieAsset.off("remove",this.onCookieAssetRemove,this),this._cookieAsset=null),this.cookie=null)}onEnable(){this.light.enabled=!0,this.system.app.scene.on("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this.onLayerAdded,this),this.system.app.scene.layers.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&this.addLightToLayers(),this._cookieAsset&&!this.cookie&&this.onCookieAssetSet()}onDisable(){this.light.enabled=!1,this.system.app.scene.off("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this.onLayerAdded,this),this.system.app.scene.layers.off("remove",this.onLayerRemoved,this)),this.removeLightFromLayers()}onRemove(){this.onDisable(),this.light.destroy(),this.cookieAsset=null}}function iu(t,e,i,n){var r=eu.prototype;$c.push(t),tu.push(e),Object.defineProperty(r,t,{get:function(){return this.data[t]},set:function(e){var r=this.data,s=r[t];(n||s!==e)&&(r[t]=e,i&&i.call(this,e,s))},configurable:!0})}iu("enabled",!0,(function(t,e){this.onSetEnabled(null,e,t)})),iu("light",null),iu("type","directional",(function(t,e){this.system.changeType(this,e,t),this.refreshProperties()})),iu("color",new D(1,1,1),(function(t,e){this.light.setColor(t)}),!0),iu("intensity",1,(function(t,e){this.light.intensity=t})),iu("shape",0,(function(t,e){this.light.shape=t})),iu("castShadows",!1,(function(t,e){this.light.castShadows=t})),iu("shadowDistance",40,(function(t,e){this.light.shadowDistance=t})),iu("shadowResolution",1024,(function(t,e){this.light.shadowResolution=t})),iu("shadowBias",.05,(function(t,e){this.light.shadowBias=-.01*t})),iu("normalOffsetBias",0,(function(t,e){this.light.normalOffsetBias=t})),iu("range",10,(function(t,e){this.light.attenuationEnd=t})),iu("innerConeAngle",40,(function(t,e){this.light.innerConeAngle=t})),iu("outerConeAngle",45,(function(t,e){this.light.outerConeAngle=t})),iu("falloffMode",0,(function(t,e){this.light.falloffMode=t})),iu("shadowType",0,(function(t,e){this.light.shadowType=t})),iu("vsmBlurSize",11,(function(t,e){this.light.vsmBlurSize=t})),iu("vsmBlurMode",1,(function(t,e){this.light.vsmBlurMode=t})),iu("vsmBias",.0025,(function(t,e){this.light.vsmBias=t})),iu("cookieAsset",null,(function(t,e){if(!this._cookieAssetId||!(t instanceof As&&t.id===this._cookieAssetId||t===this._cookieAssetId))if(this.onCookieAssetRemove(),this._cookieAssetId=null,t instanceof As)this.data.cookieAsset=t.id,this._cookieAssetId=t.id,this.onCookieAssetAdd(t);else if("number"==typeof t){this._cookieAssetId=t;var i=this.system.app.assets.get(t);i?this.onCookieAssetAdd(i):(this._cookieAssetAdd=!0,this.system.app.assets.on("add:"+this._cookieAssetId,this.onCookieAssetAdd,this))}})),iu("cookie",null,(function(t,e){this.light.cookie=t})),iu("cookieIntensity",1,(function(t,e){this.light.cookieIntensity=t})),iu("cookieFalloff",!0,(function(t,e){this.light.cookieFalloff=t})),iu("cookieChannel","rgb",(function(t,e){this.light.cookieChannel=t})),iu("cookieAngle",0,(function(t,e){if(0!==t||null!==this.cookieScale){this._cookieMatrix||(this._cookieMatrix=new X);var i=1,n=1;this.cookieScale&&(i=this.cookieScale.x,n=this.cookieScale.y);var r=Math.cos(t*k.DEG_TO_RAD),s=Math.sin(t*k.DEG_TO_RAD);this._cookieMatrix.set(r/i,-s/i,s/n,r/n),this.light.cookieTransform=this._cookieMatrix}else this.light.cookieTransform=null})),iu("cookieScale",null,(function(t,e){if(null!==t||0!==this.cookieAngle){this._cookieMatrix||(this._cookieMatrix=new X);var i=t.x,n=t.y,r=Math.cos(this.cookieAngle*k.DEG_TO_RAD),s=Math.sin(this.cookieAngle*k.DEG_TO_RAD);this._cookieMatrix.set(r/i,-s/i,s/n,r/n),this.light.cookieTransform=this._cookieMatrix}else this.light.cookieTransform=null}),!0),iu("cookieOffset",null,(function(t,e){this.light.cookieOffset=t}),!0),iu("shadowUpdateMode",2,(function(t,e){this.light.shadowUpdateMode=t})),iu("mask",1,(function(t,e){this.light.mask=t})),iu("affectDynamic",!0,(function(t,e){t?this.light.mask|=1:this.light.mask&=-2})),iu("affectLightmapped",!1,(function(t,e){t?(this.light.mask|=2,this.bake&&(this.light.mask&=-5)):(this.light.mask&=-3,this.bake&&(this.light.mask|=4))})),iu("bake",!1,(function(t,e){t?(this.light.mask|=4,this.affectLightmapped&&(this.light.mask&=-3)):(this.light.mask&=-5,this.affectLightmapped&&(this.light.mask|=2))})),iu("bakeDir",!0,(function(t,e){this.light.bakeDir=t})),iu("isStatic",!1,(function(t,e){this.light.isStatic=t})),iu("layers",[0],(function(t,e){var i,n;for(i=0;i<e.length;i++)(n=this.system.app.scene.layers.getLayerById(e[i]))&&n.removeLight(this);for(i=0;i<t.length;i++)(n=this.system.app.scene.layers.getLayerById(t[i]))&&this.enabled&&this.entity.enabled&&n.addLight(this)}));class nu{constructor(){for(var t,e=$c,i=tu,n=0;n<e.length;n++)(t=i[n])&&t.clone?this[e[n]]=t.clone():this[e[n]]=t}}const ru={directional:0,omni:1,point:1,spot:2};class su extends Il{constructor(t){super(t),this.id="light",this.ComponentType=eu,this.DataType=nu,this.on("beforeremove",this._onRemoveComponent,this)}initializeComponentData(t,e){for(var i=$c,n={},r=0,s=i.length;r<s;r++){var a=i[r];n[a]=e[a]}n.type||(n.type=t.data.type),t.data.type=n.type,n.layers&&Array.isArray(n.layers)&&(n.layers=n.layers.slice(0)),n.color&&Array.isArray(n.color)&&(n.color=new D(n.color[0],n.color[1],n.color[2])),n.cookieOffset&&n.cookieOffset instanceof Array&&(n.cookieOffset=new W(n.cookieOffset[0],n.cookieOffset[1])),n.cookieScale&&n.cookieScale instanceof Array&&(n.cookieScale=new W(n.cookieScale[0],n.cookieScale[1])),n.enable&&(console.warn("WARNING: enable: Property is deprecated. Set enabled property instead."),n.enabled=n.enable);var o=new Qc;o.type=ru[n.type],o._node=t.entity,o._scene=this.app.scene,t.data.light=o,super.initializeComponentData(t,n,i)}_onRemoveComponent(t,e){e.onRemove()}cloneComponent(t,e){for(var i,n=t.light,r=[],s=$c,a=0;a<s.length;a++)"light"!==(i=s[a])&&(n[i]&&n[i].clone?r[i]=n[i].clone():r[i]=n[i]);this.addComponent(e,r)}changeType(t,e,i){e!==i&&(t.light.type=ru[i])}}class au extends Cl{constructor(t,e){super(t,e),this._type="asset",this._asset=null,this._model=null,this._mapping={},this._castShadows=!0,this._receiveShadows=!0,this._materialAsset=null,this._material=t.defaultMaterial,this._castShadowsLightmap=!0,this._lightmapped=!1,this._lightmapSizeMultiplier=1,this._isStatic=!1,this._layers=[0],this._batchGroupId=-1,this._aabb=null,this._area=null,this._assetOld=0,this._materialEvents=null,this._dirtyModelAsset=!1,this._dirtyMaterialAsset=!1,this._clonedModel=!1,e.on("remove",this.onRemoveChild,this),e.on("insert",this.onInsertChild,this)}addModelToLayers(){for(var t,e=this.system.app.scene.layers,i=0;i<this._layers.length;i++)(t=e.getLayerById(this._layers[i]))&&t.addMeshInstances(this.meshInstances)}removeModelFromLayers(){for(var t,e=this.system.app.scene.layers,i=0;i<this._layers.length;i++)(t=e.getLayerById(this._layers[i]))&&t.removeMeshInstances(this.meshInstances)}onRemoveChild(){this._model&&this.removeModelFromLayers()}onInsertChild(){this._model&&this.enabled&&this.entity.enabled&&this.addModelToLayers()}onRemove(){"asset"===this.type?this.asset=null:this.model=null,this.materialAsset=null,this._unsetMaterialEvents(),this.entity.off("remove",this.onRemoveChild,this),this.entity.off("insert",this.onInsertChild,this)}onLayersChanged(t,e){this.addModelToLayers(),t.off("add",this.onLayerAdded,this),t.off("remove",this.onLayerRemoved,this),e.on("add",this.onLayerAdded,this),e.on("remove",this.onLayerRemoved,this)}onLayerAdded(t){this.layers.indexOf(t.id)<0||t.addMeshInstances(this.meshInstances)}onLayerRemoved(t){this.layers.indexOf(t.id)<0||t.removeMeshInstances(this.meshInstances)}_setMaterialEvent(t,e,i,n){var r=e+":"+i;this.system.app.assets.on(r,n,this),this._materialEvents||(this._materialEvents=[]),this._materialEvents[t]||(this._materialEvents[t]={}),this._materialEvents[t][r]={id:i,handler:n}}_unsetMaterialEvents(){var t=this.system.app.assets,e=this._materialEvents;if(e){for(var i=0,n=e.length;i<n;i++)if(e[i]){var r=e[i];for(var s in r)t.off(s,r[s].handler,this)}this._materialEvents=null}}_getAssetByIdOrPath(t){var e=null;if(isNaN(parseInt(t,10))){if(this.asset){var i=this._getMaterialAssetUrl(t);i&&(e=this.system.app.assets.getByUrl(i))}}else e=this.system.app.assets.get(t);return e}_getMaterialAssetUrl(t){if(!this.asset)return null;var e=this.system.app.assets.get(this.asset);return e?e.getAbsoluteUrl(t):null}_loadAndSetMeshInstanceMaterial(t,e,i){var n=this.system.app.assets;t&&(t.resource?(e.material=t.resource,this._setMaterialEvent(i,"remove",t.id,(function(){e.material=this.system.defaultMaterial}))):(this._setMaterialEvent(i,"load",t.id,(function(n){e.material=n.resource,this._setMaterialEvent(i,"remove",t.id,(function(){e.material=this.system.defaultMaterial}))})),this.enabled&&this.entity.enabled&&n.load(t)))}onEnable(){var t=this.system.app,e=t.scene;e.on("set:layers",this.onLayersChanged,this),e.layers&&(e.layers.on("add",this.onLayerAdded,this),e.layers.on("remove",this.onLayerRemoved,this));var i,n="asset"===this._type;if(this._model?this.addModelToLayers():n&&this._asset&&(i=t.assets.get(this._asset))&&i.resource!==this._model&&this._bindModelAsset(i),this._materialAsset&&(i=t.assets.get(this._materialAsset))&&i.resource!==this._material&&this._bindMaterialAsset(i),n&&this._mapping)for(var r in this._mapping)this._mapping[r]&&(i=this._getAssetByIdOrPath(this._mapping[r]))&&!i.resource&&t.assets.load(i);this._batchGroupId>=0&&t.batcher.insert(Be.MODEL,this.batchGroupId,this.entity)}onDisable(){var t=this.system.app,e=t.scene;e.off("set:layers",this.onLayersChanged,this),e.layers&&(e.layers.off("add",this.onLayerAdded,this),e.layers.off("remove",this.onLayerRemoved,this)),this._batchGroupId>=0&&t.batcher.remove(Be.MODEL,this.batchGroupId,this.entity),this._model&&this.removeModelFromLayers()}hide(){if(this._model){var t,e,i=this._model.meshInstances;for(t=0,e=i.length;t<e;t++)i[t].visible=!1}}show(){if(this._model){var t,e,i=this._model.meshInstances;for(t=0,e=i.length;t<e;t++)i[t].visible=!0}}_bindMaterialAsset(t){if(t.on("load",this._onMaterialAssetLoad,this),t.on("unload",this._onMaterialAssetUnload,this),t.on("remove",this._onMaterialAssetRemove,this),t.on("change",this._onMaterialAssetChange,this),t.resource)this._onMaterialAssetLoad(t);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(t)}}_unbindMaterialAsset(t){t.off("load",this._onMaterialAssetLoad,this),t.off("unload",this._onMaterialAssetUnload,this),t.off("remove",this._onMaterialAssetRemove,this),t.off("change",this._onMaterialAssetChange,this)}_onMaterialAssetAdd(t){this.system.app.assets.off("add:"+t.id,this._onMaterialAssetAdd,this),this._materialAsset===t.id&&this._bindMaterialAsset(t)}_onMaterialAssetLoad(t){this._setMaterial(t.resource)}_onMaterialAssetUnload(t){this._setMaterial(this.system.defaultMaterial)}_onMaterialAssetRemove(t){this._onMaterialAssetUnload(t)}_onMaterialAssetChange(t){}_bindModelAsset(t){if(this._unbindModelAsset(t),t.on("load",this._onModelAssetLoad,this),t.on("unload",this._onModelAssetUnload,this),t.on("change",this._onModelAssetChange,this),t.on("remove",this._onModelAssetRemove,this),t.resource)this._onModelAssetLoad(t);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(t)}}_unbindModelAsset(t){t.off("load",this._onModelAssetLoad,this),t.off("unload",this._onModelAssetUnload,this),t.off("change",this._onModelAssetChange,this),t.off("remove",this._onModelAssetRemove,this)}_onModelAssetAdded(t){this.system.app.assets.off("add:"+t.id,this._onModelAssetAdded,this),t.id===this._asset&&this._bindModelAsset(t)}_onModelAssetLoad(t){this.model=t.resource.clone(),this._clonedModel=!0}_onModelAssetUnload(t){this.model=null}_onModelAssetChange(t,e,i,n){"data"===e&&(this.mapping=this._mapping)}_onModelAssetRemove(t){this.model=null}_setMaterial(t){if(this._material!==t){this._material=t;var e=this._model;if(e&&"asset"!==this._type)for(var i=e.meshInstances,n=0,r=i.length;n<r;n++)i[n].material=t}}get meshInstances(){return this._model?this._model.meshInstances:null}set meshInstances(t){this._model&&(this._model.meshInstances=t)}get aabb(){return this._aabb}set aabb(t){this._aabb=t;var e=this._model.meshInstances;if(e)for(var i=0;i<e.length;i++)e[i].setOverrideAabb(this._aabb)}get type(){return this._type}set type(t){if(this._type!==t)if(this._area=null,this._type=t,"asset"===t)null!==this._asset?this._bindModelAsset(this._asset):this.model=null;else{var e=Xr(this.system.app.graphicsDevice,t);this._area=e.area;var i=e.mesh,n=new _i,r=new Ne;r.graph=n,r.meshInstances=[new Ee(n,i,this._material)],this.system._inTools&&r.generateWireframe(),this.model=r,this._asset=null}}get asset(){return this._asset}set asset(t){var e=this.system.app.assets,i=t;if(t instanceof As&&(i=t.id),this._asset!==i){if(this._asset){e.off("add:"+this._asset,this._onModelAssetAdded,this);var n=e.get(this._asset);n&&this._unbindModelAsset(n)}if(this._asset=i,this._asset){var r=e.get(this._asset);r?this._bindModelAsset(r):(this.model=null,e.on("add:"+this._asset,this._onModelAssetAdded,this))}else this.model=null}}get model(){return this._model}set model(t){var e;if(this._model!==t&&(!t||!t._immutable)&&(this._model&&(this._model._immutable=!1,this.removeModelFromLayers(),this.entity.removeChild(this._model.getGraph()),delete this._model._entity,this._clonedModel&&(this._model.destroy(),this._clonedModel=!1)),this._model=t,this._model)){this._model._immutable=!0;var i=this._model.meshInstances;for(e=0;e<i.length;e++)i[e].castShadow=this._castShadows,i[e].receiveShadow=this._receiveShadows,i[e].isStatic=this._isStatic,i[e].setOverrideAabb(this._aabb);this.lightmapped=this._lightmapped,this.entity.addChild(this._model.graph),this.enabled&&this.entity.enabled&&this.addModelToLayers(),this._model._entity=this.entity,this.entity.animation&&this.entity.animation.setModel(this._model),this.entity.anim&&this.entity.anim.resetStateGraph(),"asset"===this.type?this.mapping=this._mapping:this._unsetMaterialEvents()}}get lightmapped(){return this._lightmapped}set lightmapped(t){if(t!==this._lightmapped&&(this._lightmapped=t,this._model))for(var e=this._model.meshInstances,i=0;i<e.length;i++)e[i].setLightmapped(t)}get castShadows(){return this._castShadows}set castShadows(t){if(this._castShadows!==t){var e,i,n=this._model;if(n){var r=this.layers,s=this.system.app.scene;if(this._castShadows&&!t)for(i=0;i<r.length;i++)(e=this.system.app.scene.layers.getLayerById(this.layers[i]))&&e.removeShadowCasters(n.meshInstances);var a=n.meshInstances;for(i=0;i<a.length;i++)a[i].castShadow=t;if(!this._castShadows&&t)for(i=0;i<r.length;i++)(e=s.layers.getLayerById(r[i]))&&e.addShadowCasters(n.meshInstances)}this._castShadows=t}}get receiveShadows(){return this._receiveShadows}set receiveShadows(t){if(this._receiveShadows!==t&&(this._receiveShadows=t,this._model))for(var e=this._model.meshInstances,i=0,n=e.length;i<n;i++)e[i].receiveShadow=t}get castShadowsLightmap(){return this._castShadowsLightmap}set castShadowsLightmap(t){this._castShadowsLightmap=t}get lightmapSizeMultiplier(){return this._lightmapSizeMultiplier}set lightmapSizeMultiplier(t){this._lightmapSizeMultiplier=t}get isStatic(){return this._isStatic}set isStatic(t){var e;if(this._isStatic!==t&&(this._isStatic=t,this._model)){var i=this._model.meshInstances;for(e=0;e<i.length;e++)i[e].isStatic=t}}get layers(){return this._layers}set layers(t){var e,i,n=this.system.app.scene.layers;if(this.meshInstances)for(e=0;e<this._layers.length;e++)(i=n.getLayerById(this._layers[e]))&&i.removeMeshInstances(this.meshInstances);for(this._layers.length=0,e=0;e<t.length;e++)this._layers[e]=t[e];if(this.enabled&&this.entity.enabled&&this.meshInstances)for(e=0;e<this._layers.length;e++)(i=n.getLayerById(this._layers[e]))&&i.addMeshInstances(this.meshInstances)}get batchGroupId(){return this._batchGroupId}set batchGroupId(t){if(this._batchGroupId!==t){var e=this.system.app.batcher;this.entity.enabled&&this._batchGroupId>=0&&e.remove(Be.MODEL,this.batchGroupId,this.entity),this.entity.enabled&&t>=0&&e.insert(Be.MODEL,t,this.entity),t<0&&this._batchGroupId>=0&&this.enabled&&this.entity.enabled&&this.addModelToLayers(),this._batchGroupId=t}}get materialAsset(){return this._materialAsset}set materialAsset(t){var e=t;t instanceof As&&(e=t.id);var i=this.system.app.assets;if(e!==this._materialAsset){if(this._materialAsset){i.off("add:"+this._materialAsset,this._onMaterialAssetAdd,this);var n=i.get(this._materialAsset);n&&this._unbindMaterialAsset(n)}if(this._materialAsset=e,this._materialAsset){var r=i.get(this._materialAsset);r?this._bindMaterialAsset(r):(this._setMaterial(this.system.defaultMaterial),i.on("add:"+this._materialAsset,this._onMaterialAssetAdd,this))}else this._setMaterial(this.system.defaultMaterial)}}get material(){return this._material}set material(t){this._material!==t&&(this.materialAsset=null,this._setMaterial(t))}get mapping(){return this._mapping}set mapping(t){if("asset"===this._type&&(this._unsetMaterialEvents(),t||(t={}),this._mapping=t,this._model))for(var e=this._model.meshInstances,i=this.asset?this.system.app.assets.get(this.asset):null,n=i?i.data.mapping:null,r=null,s=0,a=e.length;s<a;s++)if(void 0!==t[s])t[s]?(r=this.system.app.assets.get(t[s]),this._loadAndSetMeshInstanceMaterial(r,e[s],s)):e[s].material=this.system.defaultMaterial;else if(n)if(n[s]&&(n[s].material||n[s].path)){if(void 0!==n[s].material)r=this.system.app.assets.get(n[s].material);else if(void 0!==n[s].path){var o=this._getMaterialAssetUrl(n[s].path);o&&(r=this.system.app.assets.getByUrl(o))}this._loadAndSetMeshInstanceMaterial(r,e[s],s)}else e[s].material=this.system.defaultMaterial}}class ou{constructor(){this.enabled=!0}}const lu=["enabled"];class hu extends Il{constructor(t){super(t),this.id="model",this.ComponentType=au,this.DataType=ou,this.schema=lu,this.defaultMaterial=t.scene.defaultMaterial,this.on("beforeremove",this.onRemove,this)}initializeComponentData(t,e,i){i=["material","materialAsset","asset","castShadows","receiveShadows","castShadowsLightmap","lightmapped","lightmapSizeMultiplier","type","mapping","layers","isStatic","batchGroupId"],null!==e.batchGroupId&&void 0!==e.batchGroupId||(e.batchGroupId=-1),e.layers&&e.layers.length&&(e.layers=e.layers.slice(0));for(var n=0;n<i.length;n++)e.hasOwnProperty(i[n])&&(t[i[n]]=e[i[n]]);super.initializeComponentData(t,e,["enabled"])}cloneComponent(t,e){var i={type:t.model.type,asset:t.model.asset,castShadows:t.model.castShadows,receiveShadows:t.model.receiveShadows,castShadowsLightmap:t.model.castShadowsLightmap,lightmapped:t.model.lightmapped,lightmapSizeMultiplier:t.model.lightmapSizeMultiplier,isStatic:t.model.isStatic,enabled:t.model.enabled,layers:t.model.layers,batchGroupId:t.model.batchGroupId,mapping:u({},t.model.mapping)},n=t.model.materialAsset;n instanceof As||null==n||(n=this.app.assets.get(n));var r=t.model.material;r&&r!==this.defaultMaterial&&n&&r!==n.resource||(i.materialAsset=n);var s=this.addComponent(e,i);if(t.model.model&&"asset"===t.model.type&&!t.model.asset&&(s.model=t.model.model.clone(),s._clonedModel=!0),i.materialAsset||(s.material=r),t.model.model)for(var a=t.model.model.meshInstances,o=s.model.meshInstances,l=0;l<a.length;l++)o[l].mask=a[l].mask,o[l].material=a[l].material,o[l].layer=a[l].layer,o[l].receiveShadow=a[l].receiveShadow}onRemove(t,e){e.onRemove()}}Cl._buildAccessors(au.prototype,lu);class cu extends Cl{constructor(t,e){super(t,e),this._type="asset",this._castShadows=!0,this._receiveShadows=!0,this._castShadowsLightmap=!0,this._lightmapped=!1,this._lightmapSizeMultiplier=1,this._isStatic=!1,this._batchGroupId=-1,this._meshInstances=[],this._layers=[0],this._aabb=null,this._area=null,this._rootBone=new uh(this,"rootBone"),this._rootBone.on("set:entity",this._onSetRootBone,this),this._assetReference=new Da("asset",this,t.app.assets,{add:this._onRenderAssetAdded,load:this._onRenderAssetLoad,remove:this._onRenderAssetRemove,unload:this._onRenderAssetUnload},this),this._material=t.defaultMaterial,this._materialReferences=[],e.on("remove",this.onRemoveChild,this),e.on("insert",this.onInsertChild,this)}_onSetRootBone(t){t&&this._onRootBoneChanged()}_onRootBoneChanged(){this._clearSkinInstances(),this._cloneSkinInstances()}destroyMeshInstances(){var t=this._meshInstances;if(t){this.removeFromLayers();for(var e=0;e<t.length;e++)t[e].destroy();this._meshInstances.length=0}}addToLayers(){for(var t,e=this.system.app.scene.layers,i=0;i<this._layers.length;i++)(t=e.getLayerById(this._layers[i]))&&t.addMeshInstances(this._meshInstances)}removeFromLayers(){if(this._meshInstances&&this._meshInstances.length)for(var t,e=this.system.app.scene.layers,i=0;i<this._layers.length;i++)(t=e.getLayerById(this._layers[i]))&&t.removeMeshInstances(this._meshInstances)}onRemoveChild(){this.removeFromLayers()}onInsertChild(){this._meshInstances&&this.enabled&&this.entity.enabled&&this.addToLayers()}onRemove(){this.destroyMeshInstances(),this.asset=null,this.materialAsset=null,this.entity.off("remove",this.onRemoveChild,this),this.entity.off("insert",this.onInsertChild,this)}onLayersChanged(t,e){this.addToLayers(),t.off("add",this.onLayerAdded,this),t.off("remove",this.onLayerRemoved,this),e.on("add",this.onLayerAdded,this),e.on("remove",this.onLayerRemoved,this)}onLayerAdded(t){this.layers.indexOf(t.id)<0||t.addMeshInstances(this._meshInstances)}onLayerRemoved(t){this.layers.indexOf(t.id)<0||t.removeMeshInstances(this._meshInstances)}onEnable(){var t=this.system.app,e=t.scene;this._rootBone.onParentComponentEnable(),e.on("set:layers",this.onLayersChanged,this),e.layers&&(e.layers.on("add",this.onLayerAdded,this),e.layers.on("remove",this.onLayerRemoved,this));var i="asset"===this._type;this._meshInstances&&this._meshInstances.length?this.addToLayers():i&&this.asset&&this._onRenderAssetAdded();for(var n=0;n<this._materialReferences.length;n++)this._materialReferences[n].asset&&this.system.app.assets.load(this._materialReferences[n].asset);this._batchGroupId>=0&&t.batcher.insert(Be.RENDER,this.batchGroupId,this.entity)}onDisable(){var t=this.system.app,e=t.scene;e.off("set:layers",this.onLayersChanged,this),e.layers&&(e.layers.off("add",this.onLayerAdded,this),e.layers.off("remove",this.onLayerRemoved,this)),this._batchGroupId>=0&&t.batcher.remove(Be.RENDER,this.batchGroupId,this.entity),this.removeFromLayers()}hide(){if(this._meshInstances)for(var t=0;t<this._meshInstances.length;t++)this._meshInstances[t].visible=!1}show(){if(this._meshInstances)for(var t=0;t<this._meshInstances.length;t++)this._meshInstances[t].visible=!0}_onRenderAssetAdded(){this._assetReference.asset&&(this._assetReference.asset.resource?this._onRenderAssetLoad():this.enabled&&this.entity.enabled&&this.system.app.assets.load(this._assetReference.asset))}_onRenderAssetLoad(){if(this.destroyMeshInstances(),this._assetReference.asset){var t=this._assetReference.asset.resource;t.off("set:meshes",this._onSetMeshes,this),t.on("set:meshes",this._onSetMeshes,this),t.meshes&&this._onSetMeshes(t.meshes)}}_onSetMeshes(t){this._cloneMeshes(t)}_clearSkinInstances(){for(var t=0;t<this._meshInstances.length;t++)this._meshInstances[t].skinInstance=null}_cloneSkinInstances(){if(this._meshInstances.length&&this._rootBone.entity instanceof _i)for(var t,e,i,n=new Map,r=0;r<this._meshInstances.length;r++){var s=this._meshInstances[r],a=s.mesh;if(a.skin&&!a.skinInstance){if(e=a.skin,!(i=n.get(e))){i=new Le(e),n.set(e,i);var o=[];for(t=0;t<e.boneNames.length;t++){var l=e.boneNames[t],h=this._rootBone.entity.findByName(l);h||(console.error("Failed to find bone ["+l+"] in the entity hierarchy, RenderComponent on "+this.entity.name+", rootBone: "+this._rootBone.entity.name),h=this.entity),o.push(h)}i.bones=o}s.skinInstance=i}}}_cloneMeshes(t){if(t&&t.length){for(var e=[],i=0;i<t.length;i++){var n=t[i],r=this._materialReferences[i]&&this._materialReferences[i].asset&&this._materialReferences[i].asset.resource,s=new Ee(this.entity,n,r||this.system.defaultMaterial);e.push(s),n.morph&&(s.morphInstance=new Oe(n.morph))}this.meshInstances=e,this._cloneSkinInstances()}}_onRenderAssetUnload(){"asset"===this._type&&this.destroyMeshInstances()}_onRenderAssetRemove(){this._assetReference.asset&&this._assetReference.asset.resource&&this._assetReference.asset.resource.off("set:meshes",this._onSetMeshes,this),this._onRenderAssetUnload()}_onMaterialAdded(t,e,i){i.resource?this._onMaterialLoad(t,e,i):this.enabled&&this.entity.enabled&&this.system.app.assets.load(i)}_onMaterialLoad(t,e,i){this._meshInstances[t]&&(this._meshInstances[t].material=i.resource)}_onMaterialRemove(t,e,i){this._meshInstances[t]&&(this._meshInstances[t].material=this.system.defaultMaterial)}_onMaterialUnload(t,e,i){this._meshInstances[t]&&(this._meshInstances[t].material=this.system.defaultMaterial)}generateWireframe(){var t,e,i=[];for(t=0;t<this._meshInstances.length;t++)e=this._meshInstances[t].mesh,-1===i.indexOf(e)&&i.push(e);for(t=0;t<i.length;++t)(e=i[t]).primitive[1]||e.generateWireframe()}get aabb(){return this._aabb}set aabb(t){this._aabb=t;var e=this._meshInstances;if(e)for(var i=0;i<e.length;i++)e[i].setOverrideAabb(this._aabb)}get type(){return this._type}set type(t){if(this._type!==t&&(this._area=null,this._type=t,this.destroyMeshInstances(),"asset"!==t)){var e=this._material;e&&e!==this.system.defaultMaterial||(e=this._materialReferences[0]&&this._materialReferences[0].asset&&this._materialReferences[0].asset.resource);var i=Xr(this.system.app.graphicsDevice,t);this._area=i.area,this.meshInstances=[new Ee(this.entity,i.mesh,e||this.system.defaultMaterial)],this.system._inTools&&this.generateWireframe()}}get meshInstances(){return this._meshInstances}set meshInstances(t){if(this.destroyMeshInstances(),this._meshInstances=t,this._meshInstances){for(var e=this._meshInstances,i=0;i<e.length;i++)e[i].castShadow=this._castShadows,e[i].receiveShadow=this._receiveShadows,e[i].isStatic=this._isStatic,e[i].setLightmapped(this._lightmapped),e[i].setOverrideAabb(this._aabb);this.enabled&&this.entity.enabled&&this.addToLayers()}}get lightmapped(){return this._lightmapped}set lightmapped(t){if(t!==this._lightmapped){this._lightmapped=t;var e=this._meshInstances;if(e)for(var i=0;i<e.length;i++)e[i].setLightmapped(t)}}get castShadows(){return this._castShadows}set castShadows(t){if(this._castShadows!==t){var e,i,n=this._meshInstances;if(n){var r=this.layers,s=this.system.app.scene;if(this._castShadows&&!t)for(e=0;e<r.length;e++)(i=s.layers.getLayerById(this.layers[e]))&&i.removeShadowCasters(n);for(e=0;e<n.length;e++)n[e].castShadow=t;if(!this._castShadows&&t)for(e=0;e<r.length;e++)(i=s.layers.getLayerById(r[e]))&&i.addShadowCasters(n)}this._castShadows=t}}get receiveShadows(){return this._receiveShadows}set receiveShadows(t){if(this._receiveShadows!==t){this._receiveShadows=t;var e=this._meshInstances;if(e)for(var i=0;i<e.length;i++)e[i].receiveShadow=t}}get castShadowsLightmap(){return this._castShadowsLightmap}set castShadowsLightmap(t){this._castShadowsLightmap=t}get lightmapSizeMultiplier(){return this._lightmapSizeMultiplier}set lightmapSizeMultiplier(t){this._lightmapSizeMultiplier=t}get isStatic(){return this._isStatic}set isStatic(t){if(this._isStatic!==t){this._isStatic=t;var e=this._meshInstances;if(e)for(var i=0;i<e.length;i++)e[i].isStatic=t}}get layers(){return this._layers}set layers(t){var e,i,n=this.system.app.scene.layers;if(this._meshInstances)for(e=0;e<this._layers.length;e++)(i=n.getLayerById(this._layers[e]))&&i.removeMeshInstances(this._meshInstances);for(this._layers.length=0,e=0;e<t.length;e++)this._layers[e]=t[e];if(this.enabled&&this.entity.enabled&&this._meshInstances)for(e=0;e<this._layers.length;e++)(i=n.getLayerById(this._layers[e]))&&i.addMeshInstances(this._meshInstances)}get batchGroupId(){return this._batchGroupId}set batchGroupId(t){if(this._batchGroupId!==t){var e=this.system.app.batcher;this.entity.enabled&&this._batchGroupId>=0&&e.remove(Be.RENDER,this.batchGroupId,this.entity),this.entity.enabled&&t>=0&&e.insert(Be.RENDER,t,this.entity),t<0&&this._batchGroupId>=0&&this.enabled&&this.entity.enabled&&this.addToLayers(),this._batchGroupId=t}}get material(){return this._material}set material(t){if(this._material!==t&&(this._material=t,this._meshInstances&&"asset"!==this._type))for(var e=0;e<this._meshInstances.length;e++)this._meshInstances[e].material=t}get materialAssets(){return this._materialReferences.map((function(t){return t.id}))}set materialAssets(t){var e;if(t=t||[],this._materialReferences.length>t.length){for(e=t.length;e<this._materialReferences.length;e++)this._materialReferences[e].id=null;this._materialReferences.length=t.length}for(e=0;e<t.length;e++)if(this._materialReferences[e]||this._materialReferences.push(new Da(e,this,this.system.app.assets,{add:this._onMaterialAdded,load:this._onMaterialLoad,remove:this._onMaterialRemove,unload:this._onMaterialUnload},this)),t[e]){var i=t[e]instanceof As?t[e].id:t[e];this._materialReferences[e].id!==i&&(this._materialReferences[e].id=i),this._materialReferences[e].asset&&this._onMaterialAdded(e,this,this._materialReferences[e].asset)}else this._materialReferences[e].id=null,this._meshInstances[e]&&(this._meshInstances[e].material=this.system.defaultMaterial)}get asset(){return this._assetReference.id}set asset(t){var e=t instanceof As?t.id:t;this._assetReference.id!==e&&(this._assetReference.asset&&this._assetReference.asset.resource&&this._onRenderAssetRemove(),this._assetReference.id=e,this._assetReference.asset&&this._onRenderAssetAdded())}}class uu{constructor(){this.enabled=!0,this.rootBone=null}}const du=[{name:"rootBone",type:"entity"},"enabled"],fu=["material","asset","materialAssets","castShadows","receiveShadows","castShadowsLightmap","lightmapped","lightmapSizeMultiplier","type","layers","isStatic","batchGroupId"];class pu extends Il{constructor(t){super(t),this.id="render",this.ComponentType=cu,this.DataType=uu,this.schema=du,this.defaultMaterial=t.scene.defaultMaterial,this.on("beforeremove",this.onRemove,this)}initializeComponentData(t,e,i){null!==e.batchGroupId&&void 0!==e.batchGroupId||(e.batchGroupId=-1),e.layers&&e.layers.length&&(e.layers=e.layers.slice(0));for(var n=0;n<fu.length;n++)e.hasOwnProperty(fu[n])&&(t[fu[n]]=e[fu[n]]);super.initializeComponentData(t,e,du)}cloneComponent(t,e){var i,n={};for(i=0;i<fu.length;i++)n[fu[i]]=t.render[fu[i]];var r=this.addComponent(e,n);if(t.render){var s=t.render.meshInstances,a=r.meshInstances;for(i=0;i<s.length&&i<a.length;i++)a[i].mask=s[i].mask,a[i].material=s[i].material,a[i].layer=s[i].layer,a[i].receiveShadow=s[i].receiveShadow}}onRemove(t,e){e.onRemove()}}Cl._buildAccessors(cu.prototype,du);const mu=["emitterExtents","emitterRadius","emitterExtentsInner","emitterRadiusInner","loop","initialVelocity","animSpeed","normalMap","particleNormal"],gu=["numParticles","lifetime","rate","rate2","startAngle","startAngle2","lighting","halfLambert","intensity","wrap","wrapBounds","depthWrite","noFog","sort","stretch","alignToMotion","preWarm","emitterShape","animTilesX","animTilesY","animStartFrame","animNumFrames","animNumAnimations","animIndex","randomizeAnimIndex","animLoop","colorMap","localSpace","screenSpace","orientation"],vu=["scaleGraph","scaleGraph2","colorGraph","colorGraph2","alphaGraph","alphaGraph2","velocityGraph","velocityGraph2","localVelocityGraph","localVelocityGraph2","rotationSpeedGraph","rotationSpeedGraph2","radialSpeedGraph","radialSpeedGraph2"],_u=["colorMapAsset","normalMapAsset","meshAsset"];var yu;class bu extends Cl{constructor(t,e){super(t,e),this.on("set_colorMapAsset",this.onSetColorMapAsset,this),this.on("set_normalMapAsset",this.onSetNormalMapAsset,this),this.on("set_meshAsset",this.onSetMeshAsset,this),this.on("set_mesh",this.onSetMesh,this),this.on("set_loop",this.onSetLoop,this),this.on("set_blendType",this.onSetBlendType,this),this.on("set_depthSoftening",this.onSetDepthSoftening,this),this.on("set_layers",this.onSetLayers,this),mu.forEach(function(t){this.on("set_"+t,this.onSetSimpleProperty,this)}.bind(this)),gu.forEach(function(t){this.on("set_"+t,this.onSetComplexProperty,this)}.bind(this)),vu.forEach(function(t){this.on("set_"+t,this.onSetGraphProperty,this)}.bind(this)),this._requestedDepth=!1,this._drawOrder=0}get drawOrder(){return this._drawOrder}set drawOrder(t){this._drawOrder=t,this.emitter&&(this.emitter.drawOrder=t)}addModelToLayers(){if(this.data.model)for(var t,e=0;e<this.layers.length;e++)(t=this.system.app.scene.layers.getLayerById(this.layers[e]))&&(t.addMeshInstances(this.data.model.meshInstances),this.emitter._layer=t)}removeModelFromLayers(t){if(this.data.model)for(var e,i=0;i<this.layers.length;i++)(e=this.system.app.scene.layers.getLayerById(this.layers[i]))&&e.removeMeshInstances(this.data.model.meshInstances)}onSetLayers(t,e,i){if(this.data.model){var n,r;for(n=0;n<e.length;n++)(r=this.system.app.scene.layers.getLayerById(e[n]))&&r.removeMeshInstances(this.data.model.meshInstances);if(this.enabled&&this.entity.enabled)for(n=0;n<i.length;n++)(r=this.system.app.scene.layers.getLayerById(i[n]))&&r.addMeshInstances(this.data.model.meshInstances)}}onLayersChanged(t,e){this.addModelToLayers(),t.off("add",this.onLayerAdded,this),t.off("remove",this.onLayerRemoved,this),e.on("add",this.onLayerAdded,this),e.on("remove",this.onLayerRemoved,this)}onLayerAdded(t){this.data.model&&(this.layers.indexOf(t.id)<0||t.addMeshInstances(this.data.model.meshInstances))}onLayerRemoved(t){this.data.model&&(this.layers.indexOf(t.id)<0||t.removeMeshInstances(this.data.model.meshInstances))}_bindColorMapAsset(t){if(t.on("load",this._onColorMapAssetLoad,this),t.on("unload",this._onColorMapAssetUnload,this),t.on("remove",this._onColorMapAssetRemove,this),t.on("change",this._onColorMapAssetChange,this),t.resource)this._onColorMapAssetLoad(t);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(t)}}_unbindColorMapAsset(t){t.off("load",this._onColorMapAssetLoad,this),t.off("unload",this._onColorMapAssetUnload,this),t.off("remove",this._onColorMapAssetRemove,this),t.off("change",this._onColorMapAssetChange,this)}_onColorMapAssetLoad(t){this.colorMap=t.resource}_onColorMapAssetUnload(t){this.colorMap=null}_onColorMapAssetRemove(t){this._onColorMapAssetUnload(t)}_onColorMapAssetChange(t){}onSetColorMapAsset(t,e,i){var n,r=this,s=this.system.app.assets;e&&(n=s.get(e))&&this._unbindColorMapAsset(n),i?(i instanceof As&&(this.data.colorMapAsset=i.id,i=i.id),(n=s.get(i))?r._bindColorMapAsset(n):s.once("add:"+i,(function(t){r._bindColorMapAsset(t)}))):this.colorMap=null}_bindNormalMapAsset(t){if(t.on("load",this._onNormalMapAssetLoad,this),t.on("unload",this._onNormalMapAssetUnload,this),t.on("remove",this._onNormalMapAssetRemove,this),t.on("change",this._onNormalMapAssetChange,this),t.resource)this._onNormalMapAssetLoad(t);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(t)}}_unbindNormalMapAsset(t){t.off("load",this._onNormalMapAssetLoad,this),t.off("unload",this._onNormalMapAssetUnload,this),t.off("remove",this._onNormalMapAssetRemove,this),t.off("change",this._onNormalMapAssetChange,this)}_onNormalMapAssetLoad(t){this.normalMap=t.resource}_onNormalMapAssetUnload(t){this.normalMap=null}_onNormalMapAssetRemove(t){this._onNormalMapAssetUnload(t)}_onNormalMapAssetChange(t){}onSetNormalMapAsset(t,e,i){var n,r=this,s=this.system.app.assets;e&&(n=s.get(e))&&this._unbindNormalMapAsset(n),i?(i instanceof As&&(this.data.normalMapAsset=i.id,i=i.id),(n=s.get(i))?r._bindNormalMapAsset(n):s.once("add:"+i,(function(t){r._bindNormalMapAsset(t)}))):this.normalMap=null}_bindMeshAsset(t){if(t.on("load",this._onMeshAssetLoad,this),t.on("unload",this._onMeshAssetUnload,this),t.on("remove",this._onMeshAssetRemove,this),t.on("change",this._onMeshAssetChange,this),t.resource)this._onMeshAssetLoad(t);else{if(!this.enabled||!this.entity.enabled)return;this.system.app.assets.load(t)}}_unbindMeshAsset(t){t.off("load",this._onMeshAssetLoad,this),t.off("unload",this._onMeshAssetUnload,this),t.off("remove",this._onMeshAssetRemove,this),t.off("change",this._onMeshAssetChange,this)}_onMeshAssetLoad(t){this._onMeshChanged(t.resource)}_onMeshAssetUnload(t){this.mesh=null}_onMeshAssetRemove(t){this._onMeshAssetUnload(t)}_onMeshAssetChange(t){}onSetMeshAsset(t,e,i){var n,r=this.system.app.assets;e&&(n=r.get(e))&&this._unbindMeshAsset(n),i?(i instanceof As&&(this.data.meshAsset=i.id,i=i.id),(n=r.get(i))&&(this._bindMeshAsset(n),n.resource?this._onMeshChanged(n.resource):r.load(n))):this._onMeshChanged(null)}onSetMesh(t,e,i){!i||i instanceof As||"number"==typeof i?this.meshAsset=i:this._onMeshChanged(i)}_onMeshChanged(t){!t||t instanceof Ie||(t=t.meshInstances[0]?t.meshInstances[0].mesh:null),this.data.mesh=t,this.emitter&&(this.emitter.mesh=t,this.emitter.resetMaterial(),this.rebuild())}onSetLoop(t,e,i){this.emitter&&(this.emitter[t]=i,this.emitter.resetTime())}onSetBlendType(t,e,i){this.emitter&&(this.emitter[t]=i,this.emitter.material.blendType=i,this.emitter.resetMaterial(),this.rebuild())}_requestDepth(){this._requestedDepth||(yu||(yu=this.system.app.scene.layers.getLayerById(1)),yu&&(yu.incrementCounter(),this._requestedDepth=!0))}_releaseDepth(){this._requestedDepth&&yu&&(yu.decrementCounter(),this._requestedDepth=!1)}onSetDepthSoftening(t,e,i){e!==i&&(i?(this.enabled&&this.entity.enabled&&this._requestDepth(),this.emitter&&(this.emitter[t]=i)):(this.enabled&&this.entity.enabled&&this._releaseDepth(),this.emitter&&(this.emitter[t]=i)),this.emitter&&(this.reset(),this.emitter.resetMaterial(),this.rebuild()))}onSetSimpleProperty(t,e,i){this.emitter&&(this.emitter[t]=i,this.emitter.resetMaterial())}onSetComplexProperty(t,e,i){this.emitter&&(this.emitter[t]=i,this.emitter.resetMaterial(),this.rebuild(),this.reset())}onSetGraphProperty(t,e,i){this.emitter&&(this.emitter[t]=i,this.emitter.rebuildGraphs(),this.emitter.resetMaterial())}onEnable(){for(var t=this.data,e=0,i=_u.length;e<i;e++){var n=t[_u[e]];if(n){if(!(n instanceof As)){if(!(parseInt(n,10)>=0))continue;n=this.system.app.assets.get(n)}n&&!n.resource&&this.system.app.assets.load(n)}}if(!this.emitter){var r=t.mesh;r instanceof Ie||(r=null),this.emitter=new Nr(this.system.app.graphicsDevice,{numParticles:t.numParticles,emitterExtents:t.emitterExtents,emitterExtentsInner:t.emitterExtentsInner,emitterRadius:t.emitterRadius,emitterRadiusInner:t.emitterRadiusInner,emitterShape:t.emitterShape,initialVelocity:t.initialVelocity,wrap:t.wrap,localSpace:t.localSpace,screenSpace:t.screenSpace,wrapBounds:t.wrapBounds,lifetime:t.lifetime,rate:t.rate,rate2:t.rate2,orientation:t.orientation,particleNormal:t.particleNormal,animTilesX:t.animTilesX,animTilesY:t.animTilesY,animStartFrame:t.animStartFrame,animNumFrames:t.animNumFrames,animNumAnimations:t.animNumAnimations,animIndex:t.animIndex,randomizeAnimIndex:t.randomizeAnimIndex,animSpeed:t.animSpeed,animLoop:t.animLoop,startAngle:t.startAngle,startAngle2:t.startAngle2,scaleGraph:t.scaleGraph,scaleGraph2:t.scaleGraph2,colorGraph:t.colorGraph,colorGraph2:t.colorGraph2,alphaGraph:t.alphaGraph,alphaGraph2:t.alphaGraph2,localVelocityGraph:t.localVelocityGraph,localVelocityGraph2:t.localVelocityGraph2,velocityGraph:t.velocityGraph,velocityGraph2:t.velocityGraph2,rotationSpeedGraph:t.rotationSpeedGraph,rotationSpeedGraph2:t.rotationSpeedGraph2,radialSpeedGraph:t.radialSpeedGraph,radialSpeedGraph2:t.radialSpeedGraph2,colorMap:t.colorMap,normalMap:t.normalMap,loop:t.loop,preWarm:t.preWarm,sort:t.sort,stretch:t.stretch,alignToMotion:t.alignToMotion,lighting:t.lighting,halfLambert:t.halfLambert,intensity:t.intensity,depthSoftening:t.depthSoftening,scene:this.system.app.scene,mesh:r,depthWrite:t.depthWrite,noFog:t.noFog,node:this.entity,blendType:t.blendType}),this.emitter.meshInstance.node=this.entity,this.emitter.drawOrder=this.drawOrder,this.psys=new Ne,this.psys.graph=this.entity,this.psys.emitter=this.emitter,this.psys.meshInstances=[this.emitter.meshInstance],t.model=this.psys,this.emitter.psys=this.psys,t.autoPlay||(this.pause(),this.emitter.meshInstance.visible=!1)}t.model&&this.emitter.colorMap&&this.addModelToLayers(),this.system.app.scene.on("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this.onLayerAdded,this),this.system.app.scene.layers.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&t.depthSoftening&&this._requestDepth()}onDisable(){this.system.app.scene.off("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this.onLayerAdded,this),this.system.app.scene.layers.off("remove",this.onLayerRemoved,this)),this.data.model&&(this.removeModelFromLayers(),this.data.depthSoftening&&this._releaseDepth()),this.emitter&&(this.emitter.camera=null)}onBeforeRemove(){this.enabled&&(this.enabled=!1);var t=this.data;t.model&&(this.entity.removeChild(t.model.getGraph()),t.model.destroy(),t.model=null),this.emitter&&(this.emitter.destroy(),this.emitter=null);for(var e=0;e<_u.length;e++){var i=_u[e];t[i]&&(this[i]=null)}this.off()}reset(){this.emitter&&this.emitter.reset()}stop(){this.emitter&&(this.emitter.loop=!1,this.emitter.resetTime(),this.emitter.addTime(0,!0))}pause(){this.data.paused=!0}unpause(){this.data.paused=!1}play(){this.data.paused=!1,this.emitter&&(this.emitter.meshInstance.visible=!0,this.emitter.loop=this.data.loop,this.emitter.resetTime())}isPlaying(){return!this.data.paused&&(!(!this.emitter||!this.emitter.loop)||Date.now()<=this.emitter.endTime)}rebuild(){var t=this.enabled;this.enabled=!1,this.emitter&&(this.emitter.rebuild(),this.emitter.meshInstance.node=this.entity,this.data.model.meshInstances=[this.emitter.meshInstance]),this.enabled=t}}class xu{constructor(){this.numParticles=1,this.rate=1,this.rate2=null,this.startAngle=0,this.startAngle2=null,this.lifetime=50,this.emitterExtents=new H,this.emitterExtentsInner=new H,this.emitterRadius=0,this.emitterRadiusInner=0,this.emitterShape=0,this.initialVelocity=0,this.wrapBounds=new H,this.localSpace=!1,this.screenSpace=!1,this.colorMap=null,this.colorMapAsset=null,this.normalMap=null,this.normalMapAsset=null,this.loop=!0,this.preWarm=!1,this.sort=0,this.mode=0,this.scene=null,this.lighting=!1,this.halfLambert=!1,this.intensity=1,this.stretch=0,this.alignToMotion=!1,this.depthSoftening=0,this.meshAsset=null,this.mesh=null,this.depthWrite=!1,this.noFog=!1,this.orientation=0,this.particleNormal=new H(0,1,0),this.animTilesX=1,this.animTilesY=1,this.animStartFrame=0,this.animNumFrames=1,this.animNumAnimations=1,this.animIndex=0,this.randomizeAnimIndex=!1,this.animSpeed=1,this.animLoop=!0,this.scaleGraph=null,this.scaleGraph2=null,this.colorGraph=null,this.colorGraph2=null,this.alphaGraph=null,this.alphaGraph2=null,this.localVelocityGraph=null,this.localVelocityGraph2=null,this.velocityGraph=null,this.velocityGraph2=null,this.rotationSpeedGraph=null,this.rotationSpeedGraph2=null,this.radialSpeedGraph=null,this.radialSpeedGraph2=null,this.blendType=2,this.model=null,this.enabled=!0,this.paused=!1,this.autoPlay=!0,this.layers=[0]}}const wu=["enabled","autoPlay","numParticles","lifetime","rate","rate2","startAngle","startAngle2","loop","preWarm","lighting","halfLambert","intensity","depthWrite","noFog","depthSoftening","sort","blendType","stretch","alignToMotion","emitterShape","emitterExtents","emitterExtentsInner","emitterRadius","emitterRadiusInner","initialVelocity","wrap","wrapBounds","localSpace","screenSpace","colorMapAsset","normalMapAsset","mesh","meshAsset","orientation","particleNormal","localVelocityGraph","localVelocityGraph2","velocityGraph","velocityGraph2","rotationSpeedGraph","rotationSpeedGraph2","radialSpeedGraph","radialSpeedGraph2","scaleGraph","scaleGraph2","colorGraph","colorGraph2","alphaGraph","alphaGraph2","colorMap","normalMap","animTilesX","animTilesY","animStartFrame","animNumFrames","animNumAnimations","animIndex","randomizeAnimIndex","animSpeed","animLoop","layers"];class Au extends Il{constructor(t){super(t),this.id="particlesystem",this.ComponentType=bu,this.DataType=xu,this.schema=wu,this.propertyTypes={emitterExtents:"vec3",emitterExtentsInner:"vec3",particleNormal:"vec3",wrapBounds:"vec3",localVelocityGraph:"curveset",localVelocityGraph2:"curveset",velocityGraph:"curveset",velocityGraph2:"curveset",colorGraph:"curveset",colorGraph2:"curveset",alphaGraph:"curve",alphaGraph2:"curve",rotationSpeedGraph:"curve",rotationSpeedGraph2:"curve",radialSpeedGraph:"curve",radialSpeedGraph2:"curve",scaleGraph:"curve",scaleGraph2:"curve"},this.on("beforeremove",this.onBeforeRemove,this),Il.bind("update",this.onUpdate,this)}initializeComponentData(t,e,i){var n={};i=[];var r,s=this.propertyTypes;for(var a in(e.mesh instanceof As||"number"==typeof e.mesh)&&(e.meshAsset=e.mesh,delete e.mesh),e)e.hasOwnProperty(a)&&(i.push(a),n[a]=e[a]),"vec3"===s[a]?Array.isArray(n[a])&&(n[a]=new H(n[a][0],n[a][1],n[a][2])):"curve"===s[a]?n[a]instanceof V||(r=n[a].type,n[a]=new V(n[a].keys),n[a].type=r):"curveset"===s[a]&&(n[a]instanceof U||(r=n[a].type,n[a]=new U(n[a].keys),n[a].type=r)),n.layers&&Array.isArray(n.layers)&&(n.layers=n.layers.slice(0));super.initializeComponentData(t,n,i)}cloneComponent(t,e){for(var i=t.particlesystem.data,n=this.schema,r={},s=0,a=n.length;s<a;s++){var o=n[s],l=i[o];l instanceof H||l instanceof V||l instanceof U?(l=l.clone(),r[o]=l):"layers"===o?r.layers=i.layers.slice(0):null!=l&&(r[o]=l)}return this.addComponent(e,r)}onUpdate(t){var e,i,n,r,s=this.store,a=this.app.stats.particles;for(var o in s)if(s.hasOwnProperty(o)){var l=(r=s[o]).entity,h=r.data;if(h.enabled&&l.enabled){var c=h.model.emitter;if(!c.meshInstance.visible)continue;if(c.lighting){var u,d,f=h.layers;for(i=0;i<f.length;i++)if(u=this.app.scene.layers.getLayerById(f[i])){for(u._lightCube||(u._lightCube=new Float32Array(18)),d=u._lightCube,i=0;i<6;i++)d[3*i]=this.app.scene.ambientLight.r,d[3*i+1]=this.app.scene.ambientLight.g,d[3*i+2]=this.app.scene.ambientLight.b;var p=u._splitLights[0];for(n=0;n<p.length;n++)for(r=0;r<6;r++){var m=Math.max(c.lightCubeDir[r].dot(p[n]._direction),0)*p[n]._intensity;d[3*r]+=p[n]._color.r*m,d[3*r+1]+=p[n]._color.g*m,d[3*r+2]+=p[n]._color.b*m}}c.constantLightCube.setValue(d)}if(!h.paused){if(c.simTime+=t,c.simTime>c.fixedTimeStep&&(e=Math.floor(c.simTime/c.fixedTimeStep),c.simTime-=e*c.fixedTimeStep),e){for(e=Math.min(e,c.maxSubSteps),i=0;i<e;i++)c.addTime(c.fixedTimeStep,!1);a._updatesPerFrame+=e,a._frameTime+=c._addTimeTime,c._addTimeTime=0}c.finishFrame()}}}}onBeforeRemove(t,e){e.onBeforeRemove()}}Cl._buildAccessors(bu.prototype,wu);class Cu{constructor(t,e){this._constructor=t,this._pool=[],this._count=0,this._resize(e)}_resize(t){if(t>this._pool.length)for(var e=this._pool.length;e<t;e++)this._pool[e]=new this._constructor}allocate(){return this._count>=this._pool.length&&this._resize(2*this._pool.length),this._pool[this._count++]}freeAll(){this._count=0}}var Iu,Su,Mu,Tu,Pu,Eu,ku;class Du extends Cl{constructor(t,e){super(t,e),"undefined"==typeof Ammo||Iu||(Iu=new Ammo.btTransform,Su=new Ammo.btVector3,Mu=new Ammo.btVector3,Tu=new Ammo.btQuaternion,Pu=new Ammo.btVector3(0,0,0)),this.on("set_mass",this.onSetMass,this),this.on("set_linearDamping",this.onSetLinearDamping,this),this.on("set_angularDamping",this.onSetAngularDamping,this),this.on("set_linearFactor",this.onSetLinearFactor,this),this.on("set_angularFactor",this.onSetAngularFactor,this),this.on("set_friction",this.onSetFriction,this),this.on("set_restitution",this.onSetRestitution,this),this.on("set_type",this.onSetType,this),this.on("set_group",this.onSetGroupOrMask,this),this.on("set_mask",this.onSetGroupOrMask,this),this.on("set_body",this.onSetBody,this),this._linearVelocity=new H(0,0,0),this._angularVelocity=new H(0,0,0)}get linearVelocity(){var t=this.body;if(t&&"dynamic"===this.type){var e=t.getLinearVelocity();this._linearVelocity.set(e.x(),e.y(),e.z())}return this._linearVelocity}set linearVelocity(t){var e=this.body;e&&"dynamic"===this.type&&(e.activate(),Su.setValue(t.x,t.y,t.z),e.setLinearVelocity(Su),this._linearVelocity.copy(t))}get angularVelocity(){var t=this.body;if(t&&"dynamic"===this.type){var e=t.getAngularVelocity();this._angularVelocity.set(e.x(),e.y(),e.z())}return this._angularVelocity}set angularVelocity(t){var e=this.body;e&&"dynamic"===this.type&&(e.activate(),Su.setValue(t.x,t.y,t.z),e.setAngularVelocity(Su),this._angularVelocity.copy(t))}createBody(){var t,e=this.entity;if(e.collision&&(t=e.collision.shape,e.trigger&&(e.trigger.destroy(),delete e.trigger)),t){this.body&&this.system.onRemove(this.entity,this);var i="dynamic"===this.type?this.mass:0;this._getEntityTransform(Iu);var n=this.system.createBody(i,t,Iu);if(n.setRestitution(this.restitution),n.setFriction(this.friction),n.setDamping(this.linearDamping,this.angularDamping),"dynamic"===this.type){var r=this.linearFactor;Su.setValue(r.x,r.y,r.z),n.setLinearFactor(Su);var s=this.angularFactor;Su.setValue(s.x,s.y,s.z),n.setAngularFactor(Su)}else"kinematic"===this.type&&(n.setCollisionFlags(2|n.getCollisionFlags()),n.setActivationState(4));n.entity=e,e.rigidbody.body=n,this.enabled&&this.entity.enabled&&this.enableSimulation()}}isActive(){var t=this.body;return!!t&&t.isActive()}activate(){var t=this.body;t&&t.activate()}enableSimulation(){if(this.entity.collision&&this.entity.collision.enabled&&!this.data.simulationEnabled){var t=this.body;if(t){switch(this.system.addBody(t,this.group,this.mask),this.type){case"dynamic":this.system._dynamic.push(this),t.forceActivationState(1),this.syncEntityToBody();break;case"kinematic":this.system._kinematic.push(this),t.forceActivationState(4);break;case"static":t.forceActivationState(1),this.syncEntityToBody()}"compound"===this.entity.collision.type&&this.system._compounds.push(this.entity.collision),t.activate(),this.data.simulationEnabled=!0}}}disableSimulation(){var t,e=this.body;e&&this.data.simulationEnabled&&((t=this.system._compounds.indexOf(this.entity.collision))>-1&&this.system._compounds.splice(t,1),(t=this.system._dynamic.indexOf(this))>-1&&this.system._dynamic.splice(t,1),(t=this.system._kinematic.indexOf(this))>-1&&this.system._kinematic.splice(t,1),this.system.removeBody(e),e.forceActivationState(5),this.data.simulationEnabled=!1)}applyForce(){var t,e,i,n,r,s;switch(arguments.length){case 1:t=arguments[0].x,e=arguments[0].y,i=arguments[0].z;break;case 2:t=arguments[0].x,e=arguments[0].y,i=arguments[0].z,n=arguments[1].x,r=arguments[1].y,s=arguments[1].z;break;case 3:t=arguments[0],e=arguments[1],i=arguments[2];break;case 6:t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4],s=arguments[5]}var a=this.body;a&&(a.activate(),Su.setValue(t,e,i),void 0!==n?(Mu.setValue(n,r,s),a.applyForce(Su,Mu)):a.applyForce(Su,Pu))}applyTorque(){var t,e,i;switch(arguments.length){case 1:t=arguments[0].x,e=arguments[0].y,i=arguments[0].z;break;case 3:t=arguments[0],e=arguments[1],i=arguments[2];break;default:return}var n=this.body;n&&(n.activate(),Su.setValue(t,e,i),n.applyTorque(Su))}applyImpulse(){var t,e,i,n,r,s;switch(arguments.length){case 1:t=arguments[0].x,e=arguments[0].y,i=arguments[0].z;break;case 2:t=arguments[0].x,e=arguments[0].y,i=arguments[0].z,n=arguments[1].x,r=arguments[1].y,s=arguments[1].z;break;case 3:t=arguments[0],e=arguments[1],i=arguments[2];break;case 6:t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4],s=arguments[5];break;default:return}var a=this.body;a&&(a.activate(),Su.setValue(t,e,i),void 0!==n?(Mu.setValue(n,r,s),a.applyImpulse(Su,Mu)):a.applyImpulse(Su,Pu))}applyTorqueImpulse(){var t,e,i;switch(arguments.length){case 1:t=arguments[0].x,e=arguments[0].y,i=arguments[0].z;break;case 3:t=arguments[0],e=arguments[1],i=arguments[2];break;default:return}var n=this.body;n&&(n.activate(),Su.setValue(t,e,i),n.applyTorqueImpulse(Su))}isStatic(){return"static"===this.type}isStaticOrKinematic(){return"static"===this.type||"kinematic"===this.type}isKinematic(){return"kinematic"===this.type}_getEntityTransform(t){var e=this.entity.getPosition(),i=this.entity.getRotation();Su.setValue(e.x,e.y,e.z),Tu.setValue(i.x,i.y,i.z,i.w),t.setOrigin(Su),t.setRotation(Tu)}syncEntityToBody(){var t=this.data.body;if(t){if(this._getEntityTransform(Iu),t.setWorldTransform(Iu),"kinematic"===this.type){var e=t.getMotionState();e&&e.setWorldTransform(Iu)}t.activate()}}_updateDynamic(){var t=this.data.body;if(t.isActive()){var e=t.getMotionState();if(e){e.getWorldTransform(Iu);var i=Iu.getOrigin(),n=Iu.getRotation();this.entity.setPosition(i.x(),i.y(),i.z()),this.entity.setRotation(n.x(),n.y(),n.z(),n.w())}}}_updateKinematic(){var t=this.data.body.getMotionState();t&&(this._getEntityTransform(Iu),t.setWorldTransform(Iu))}teleport(){arguments.length<3?(arguments[0]&&this.entity.setPosition(arguments[0]),arguments[1]&&(arguments[1]instanceof $?this.entity.setRotation(arguments[1]):this.entity.setEulerAngles(arguments[1]))):(6===arguments.length&&this.entity.setEulerAngles(arguments[3],arguments[4],arguments[5]),this.entity.setPosition(arguments[0],arguments[1],arguments[2])),this.syncEntityToBody()}onEnable(){this.body||this.createBody(),this.enableSimulation()}onDisable(){this.disableSimulation()}onSetMass(t,e,i){var n=this.data.body;if(n&&"dynamic"===this.type){var r=this.enabled&&this.entity.enabled;r&&this.disableSimulation(),n.getCollisionShape().calculateLocalInertia(i,Su),n.setMassProps(i,Su),n.updateInertiaTensor(),r&&this.enableSimulation()}}onSetLinearDamping(t,e,i){var n=this.data.body;n&&n.setDamping(i,this.data.angularDamping)}onSetAngularDamping(t,e,i){var n=this.data.body;n&&n.setDamping(this.data.linearDamping,i)}onSetLinearFactor(t,e,i){var n=this.data.body;n&&"dynamic"===this.type&&(Su.setValue(i.x,i.y,i.z),n.setLinearFactor(Su))}onSetAngularFactor(t,e,i){var n=this.data.body;n&&"dynamic"===this.type&&(Su.setValue(i.x,i.y,i.z),n.setAngularFactor(Su))}onSetFriction(t,e,i){var n=this.data.body;n&&n.setFriction(i)}onSetRestitution(t,e,i){var n=this.data.body;n&&n.setRestitution(i)}onSetType(t,e,i){i!==e&&(this.disableSimulation(),"dynamic"===i?(this.data.group=1,this.data.mask=65535):"kinematic"===i?(this.data.group=4,this.data.mask=65535):(this.data.group=2,this.data.mask=65533),this.createBody())}onSetGroupOrMask(t,e,i){i!==e&&(this.enabled&&this.entity.enabled&&(this.disableSimulation(),this.enableSimulation()))}onSetBody(t,e,i){this.body&&this.data.simulationEnabled&&this.body.activate()}}class Ou{constructor(){this.enabled=!0,this.mass=1,this.linearDamping=0,this.angularDamping=0,this.linearFactor=new H(1,1,1),this.angularFactor=new H(1,1,1),this.friction=.5,this.restitution=0,this.type="static",this.group=2,this.mask=65533,this.body=null,this.simulationEnabled=!1}}var Ru={},Lu={};class Nu{constructor(t,e,i){this.entity=t,this.point=e,this.normal=i}}class zu{constructor(t,e,i){0===arguments.length?(this.a=null,this.b=null,this.localPointA=new H,this.localPointB=new H,this.pointA=new H,this.pointB=new H,this.normal=new H):(this.a=t,this.b=e,this.localPointA=i.localPoint,this.localPointB=i.localPointOther,this.pointA=i.point,this.pointB=i.pointOther,this.normal=i.normal)}}class Bu{constructor(t,e,i,n,r){0===arguments.length?(this.localPoint=new H,this.localPointOther=new H,this.point=new H,this.pointOther=new H,this.normal=new H):(this.localPoint=t,this.localPointOther=e,this.point=i,this.pointOther=n,this.normal=r)}}class Fu{constructor(t,e){this.other=t,this.contacts=e}}const ju=["enabled","type","mass","linearDamping","angularDamping","linearFactor","angularFactor","friction","restitution","group","mask","body"];class Vu extends Il{constructor(t){super(t),this.id="rigidbody",this._stats=t.stats.frame,this.ComponentType=Du,this.DataType=Ou,this.contactPointPool=null,this.contactResultPool=null,this.singleContactResultPool=null,this.schema=ju,this.maxSubSteps=10,this.fixedTimeStep=1/60,this.gravity=new H(0,-9.81,0),this._dynamic=[],this._kinematic=[],this._triggers=[],this._compounds=[],this.on("beforeremove",this.onBeforeRemove,this),this.on("remove",this.onRemove,this)}onLibraryLoaded(){if("undefined"!=typeof Ammo){if(this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.overlappingPairCache=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.dynamicsWorld=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.overlappingPairCache,this.solver,this.collisionConfiguration),this.dynamicsWorld.setInternalTickCallback){var t=Ammo.addFunction(this._checkForCollisions.bind(this),"vif");this.dynamicsWorld.setInternalTickCallback(t)}Eu=new Ammo.btVector3,ku=new Ammo.btVector3,this.contactPointPool=new Cu(Bu,1),this.contactResultPool=new Cu(Fu,1),this.singleContactResultPool=new Cu(zu,1),Il.bind("update",this.onUpdate,this)}else Il.unbind("update",this.onUpdate,this)}initializeComponentData(t,e,i){for(var n={},r=0,s=(i=["enabled","mass","linearDamping","angularDamping","linearFactor","angularFactor","friction","restitution","type","group","mask"]).length;r<s;r++){var a=i[r];n[a]=e[a]}e.bodyType&&(n.type=e.bodyType),n.linearFactor&&Array.isArray(n.linearFactor)&&(n.linearFactor=new H(n.linearFactor[0],n.linearFactor[1],n.linearFactor[2])),n.angularFactor&&Array.isArray(n.angularFactor)&&(n.angularFactor=new H(n.angularFactor[0],n.angularFactor[1],n.angularFactor[2])),super.initializeComponentData(t,n,i)}cloneComponent(t,e){var i={enabled:t.rigidbody.enabled,mass:t.rigidbody.mass,linearDamping:t.rigidbody.linearDamping,angularDamping:t.rigidbody.angularDamping,linearFactor:[t.rigidbody.linearFactor.x,t.rigidbody.linearFactor.y,t.rigidbody.linearFactor.z],angularFactor:[t.rigidbody.angularFactor.x,t.rigidbody.angularFactor.y,t.rigidbody.angularFactor.z],friction:t.rigidbody.friction,restitution:t.rigidbody.restitution,type:t.rigidbody.type,group:t.rigidbody.group,mask:t.rigidbody.mask};this.addComponent(e,i)}onBeforeRemove(t,e){e.enabled&&(e.enabled=!1)}onRemove(t,e){var i=e.body;i&&(this.removeBody(i),this.destroyBody(i),e.body=null)}addBody(t,e,i){void 0!==e&&void 0!==i?this.dynamicsWorld.addRigidBody(t,e,i):this.dynamicsWorld.addRigidBody(t)}removeBody(t){this.dynamicsWorld.removeRigidBody(t)}createBody(t,e,i){var n=new Ammo.btVector3(0,0,0);0!==t&&e.calculateLocalInertia(t,n);var r=new Ammo.btDefaultMotionState(i),s=new Ammo.btRigidBodyConstructionInfo(t,r,e,n),a=new Ammo.btRigidBody(s);return Ammo.destroy(s),Ammo.destroy(n),a}destroyBody(t){var e=t.getMotionState();e&&Ammo.destroy(e),Ammo.destroy(t)}raycastFirst(t,e){var i=null;Eu.setValue(t.x,t.y,t.z),ku.setValue(e.x,e.y,e.z);var n=new Ammo.ClosestRayResultCallback(Eu,ku);if(this.dynamicsWorld.rayTest(Eu,ku,n),n.hasHit()){var r=n.get_m_collisionObject(),s=Ammo.castObject(r,Ammo.btRigidBody);if(s){var a=n.get_m_hitPointWorld(),o=n.get_m_hitNormalWorld();if(i=new Nu(s.entity,new H(a.x(),a.y(),a.z()),new H(o.x(),o.y(),o.z())),arguments.length>2)(0,arguments[2])(i)}}return Ammo.destroy(n),i}raycastAll(t,e){var i=[];Eu.setValue(t.x,t.y,t.z),ku.setValue(e.x,e.y,e.z);var n=new Ammo.AllHitsRayResultCallback(Eu,ku);if(this.dynamicsWorld.rayTest(Eu,ku,n),n.hasHit())for(var r=n.get_m_collisionObjects(),s=n.get_m_hitPointWorld(),a=n.get_m_hitNormalWorld(),o=r.size(),l=0;l<o;l++){var h=Ammo.castObject(r.at(l),Ammo.btRigidBody);if(h){var c=s.at(l),u=a.at(l),d=new Nu(h.entity,new H(c.x(),c.y(),c.z()),new H(u.x(),u.y(),u.z()));i.push(d)}}return Ammo.destroy(n),i}_storeCollision(t,e){var i=!1,n=t.getGuid();return Ru[n]=Ru[n]||{others:[],entity:t},Ru[n].others.indexOf(e)<0&&(Ru[n].others.push(e),i=!0),Lu[n]=Lu[n]||{others:[],entity:t},Lu[n].others.push(e),i}_createContactPointFromAmmo(t){var e=t.get_m_localPointA(),i=t.get_m_localPointB(),n=t.getPositionWorldOnA(),r=t.getPositionWorldOnB(),s=t.get_m_normalWorldOnB(),a=this.contactPointPool.allocate();return a.localPoint.set(e.x(),e.y(),e.z()),a.localPointOther.set(i.x(),i.y(),i.z()),a.point.set(n.x(),n.y(),n.z()),a.pointOther.set(r.x(),r.y(),r.z()),a.normal.set(s.x(),s.y(),s.z()),a}_createReverseContactPointFromAmmo(t){var e=t.get_m_localPointA(),i=t.get_m_localPointB(),n=t.getPositionWorldOnA(),r=t.getPositionWorldOnB(),s=t.get_m_normalWorldOnB(),a=this.contactPointPool.allocate();return a.localPointOther.set(e.x(),e.y(),e.z()),a.localPoint.set(i.x(),i.y(),i.z()),a.pointOther.set(n.x(),n.y(),n.z()),a.point.set(r.x(),r.y(),r.z()),a.normal.set(s.x(),s.y(),s.z()),a}_createSingleContactResult(t,e,i){var n=this.singleContactResultPool.allocate();return n.a=t,n.b=e,n.localPointA=i.localPoint,n.localPointB=i.localPointOther,n.pointA=i.point,n.pointB=i.pointOther,n.normal=i.normal,n}_createContactResult(t,e){var i=this.contactResultPool.allocate();return i.other=t,i.contacts=e,i}_cleanOldCollisions(){for(var t in Ru)if(Ru.hasOwnProperty(t)){for(var e=Lu[t],i=Ru[t],n=i.entity,r=n.collision,s=n.rigidbody,a=i.others,o=a.length;o--;){var l=a[o];(!e||e.others.indexOf(l)<0)&&(a.splice(o,1),n.trigger?(r&&r.fire("triggerleave",l),l.rigidbody&&l.rigidbody.fire("triggerleave",n)):l.trigger||(s&&s.fire("collisionend",l),r&&r.fire("collisionend",l)))}0===a.length&&delete Ru[t]}}_hasContactEvent(t){var e=t.collision;if(e&&(e.hasEvent("collisionstart")||e.hasEvent("collisionend")||e.hasEvent("contact")))return!0;var i=t.rigidbody;return i&&(i.hasEvent("collisionstart")||i.hasEvent("collisionend")||i.hasEvent("contact"))}_checkForCollisions(t,e){var i=Ammo.wrapPointer(t,Ammo.btDynamicsWorld).getDispatcher(),n=i.getNumManifolds();Lu={};for(var r=0;r<n;r++){var s=i.getManifoldByIndexInternal(r),a=s.getBody0(),o=s.getBody1(),l=Ammo.castObject(a,Ammo.btRigidBody),h=Ammo.castObject(o,Ammo.btRigidBody),c=l.entity,u=h.entity;if(c&&u){var d,f,p,m,g,v=l.getCollisionFlags(),_=h.getCollisionFlags(),y=s.getNumContacts(),b=[],x=[];if(y>0)if(4&v||4&_)f=c.collision&&(c.collision.hasEvent("triggerenter")||c.collision.hasEvent("triggerleave")),p=u.collision&&(u.collision.hasEvent("triggerenter")||u.collision.hasEvent("triggerleave")),m=c.rigidbody&&(c.rigidbody.hasEvent("triggerenter")||c.rigidbody.hasEvent("triggerleave")),g=u.rigidbody&&(u.rigidbody.hasEvent("triggerenter")||u.rigidbody.hasEvent("triggerleave")),f&&(!(d=this._storeCollision(c,u))||4&_||c.collision.fire("triggerenter",u)),p&&(!(d=this._storeCollision(u,c))||4&v||u.collision.fire("triggerenter",c)),m&&(d||(d=this._storeCollision(u,c)),d&&c.rigidbody.fire("triggerenter",u)),g&&(d||(d=this._storeCollision(c,u)),d&&u.rigidbody.fire("triggerenter",c));else{f=this._hasContactEvent(c),p=this._hasContactEvent(u);var w=this.hasEvent("contact");if(w||f||p){for(var A=0;A<y;A++){var C=s.getContactPoint(A),I=this._createContactPointFromAmmo(C),S=null;if((f||p)&&(S=this._createReverseContactPointFromAmmo(C),b.push(I),x.push(S)),w){var M=this._createSingleContactResult(c,u,I);this.fire("contact",M)}}if(f){var T=this._createContactResult(u,b);d=this._storeCollision(c,u),c.collision&&(c.collision.fire("contact",T),d&&c.collision.fire("collisionstart",T)),c.rigidbody&&(c.rigidbody.fire("contact",T),d&&c.rigidbody.fire("collisionstart",T))}if(p){var P=this._createContactResult(c,x);d=this._storeCollision(u,c),u.collision&&(u.collision.fire("contact",P),d&&u.collision.fire("collisionstart",P)),u.rigidbody&&(u.rigidbody.fire("contact",P),d&&u.rigidbody.fire("collisionstart",P))}}}}}this._cleanOldCollisions(),this.contactPointPool.freeAll(),this.contactResultPool.freeAll(),this.singleContactResultPool.freeAll()}onUpdate(t){var e,i,n=this.dynamicsWorld.getGravity();n.x()===this.gravity.x&&n.y()===this.gravity.y&&n.z()===this.gravity.z||(n.setValue(this.gravity.x,this.gravity.y,this.gravity.z),this.dynamicsWorld.setGravity(n));var r=this._triggers;for(e=0,i=r.length;e<i;e++)r[e].updateTransform();var s=this._compounds;for(e=0,i=s.length;e<i;e++)s[e]._updateCompound();var a=this._kinematic;for(e=0,i=a.length;e<i;e++)a[e]._updateKinematic();this.dynamicsWorld.stepSimulation(t,this.maxSubSteps,this.fixedTimeStep);var o=this._dynamic;for(e=0,i=o.length;e<i;e++)o[e]._updateDynamic();this.dynamicsWorld.setInternalTickCallback||this._checkForCollisions(Ammo.getPointer(this.dynamicsWorld),t)}destroy(){"undefined"!=typeof Ammo&&(Ammo.destroy(this.dynamicsWorld),Ammo.destroy(this.solver),Ammo.destroy(this.overlappingPairCache),Ammo.destroy(this.dispatcher),Ammo.destroy(this.collisionConfiguration),this.dynamicsWorld=null,this.solver=null,this.overlappingPairCache=null,this.dispatcher=null,this.collisionConfiguration=null)}}Cl._buildAccessors(Du.prototype,ju);var Uu=new Q;class Gu extends Cl{constructor(t,e){super(t,e),this._resolution=new W(640,320),this._referenceResolution=new W(640,320),this._scaleMode="none",this.scale=1,this._scaleBlend=.5,this._priority=0,this._screenSpace=!1,this.cull=this._screenSpace,this._screenMatrix=new Q,this._elements=new Set,t.app.graphicsDevice.on("resizecanvas",this._onResize,this)}syncDrawOrder(){this.system.queueDrawOrderSync(this.entity.getGuid(),this._processDrawOrderSync,this)}_recurseDrawOrderSync(t,e){if(!(t instanceof ha))return e;if(t.element){var i=t.element.drawOrder;t.element.drawOrder=e++,t.element._batchGroupId>=0&&i!=t.element.drawOrder&&this.system.app.batcher.markGroupDirty(t.element._batchGroupId)}t.particlesystem&&(t.particlesystem.drawOrder=e++);for(var n=t.children,r=0;r<n.length;r++)e=this._recurseDrawOrderSync(n[r],e);return e}_processDrawOrderSync(){this._recurseDrawOrderSync(this.entity,1),this.fire("syncdraworder")}_calcProjectionMatrix(){var t,e,i=this._resolution.x/this.scale,n=this._resolution.y/this.scale;t=i,e=-n,this._screenMatrix.setOrtho(0,t,e,0,1,-1),this._screenSpace||(Uu.setScale(.5*i,.5*n,1),this._screenMatrix.mul2(Uu,this._screenMatrix))}_updateScale(){this.scale=this._calcScale(this._resolution,this.referenceResolution)}_calcScale(t,e){var i=Math.log2(t.x/e.x),n=Math.log2(t.y/e.y);return Math.pow(2,i*(1-this._scaleBlend)+n*this._scaleBlend)}_onResize(t,e){this._screenSpace&&(this._resolution.set(t,e),this.resolution=this._resolution)}_bindElement(t){this._elements.add(t)}_unbindElement(t){this._elements.delete(t)}onRemove(){this.system.app.graphicsDevice.off("resizecanvas",this._onResize,this),this.fire("remove"),this._elements.forEach(t=>t._onScreenRemove()),this._elements.clear(),this.off()}set resolution(t){this._screenSpace?this._resolution.set(this.system.app.graphicsDevice.width,this.system.app.graphicsDevice.height):this._resolution.set(t.x,t.y),this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:resolution",this._resolution),this._elements.forEach(t=>t._onScreenResize(this._resolution))}get resolution(){return this._resolution}set referenceResolution(t){this._referenceResolution.set(t.x,t.y),this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:referenceresolution",this._resolution),this._elements.forEach(t=>t._onScreenResize(this._resolution))}get referenceResolution(){return"none"===this._scaleMode?this._resolution:this._referenceResolution}set screenSpace(t){this._screenSpace=t,this._screenSpace&&this._resolution.set(this.system.app.graphicsDevice.width,this.system.app.graphicsDevice.height),this.resolution=this._resolution,this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:screenspace",this._screenSpace),this._elements.forEach(t=>t._onScreenSpaceChange())}get screenSpace(){return this._screenSpace}set scaleMode(t){"none"!==t&&"blend"!==t&&(t="none"),this._screenSpace||"none"===t||(t="none"),this._scaleMode=t,this.resolution=this._resolution,this.fire("set:scalemode",this._scaleMode)}get scaleMode(){return this._scaleMode}set scaleBlend(t){this._scaleBlend=t,this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtifyLocal(),this.fire("set:scaleblend",this._scaleBlend),this._elements.forEach(t=>t._onScreenResize(this._resolution))}get scaleBlend(){return this._scaleBlend}get priority(){return this._priority}set priority(t){t>255&&(t=255),this._priority=t}}class Wu{constructor(){this.enabled=!0}}const Hu=["enabled"];class Xu extends Il{constructor(t){super(t),this.id="screen",this.ComponentType=Gu,this.DataType=Wu,this.schema=Hu,this.windowResolution=new W,this._drawOrderSyncQueue=new O,this.app.graphicsDevice.on("resizecanvas",this._onResize,this),Il.bind("update",this._onUpdate,this),this.on("beforeremove",this.onRemoveComponent,this)}initializeComponentData(t,e,i){void 0!==e.priority&&(t.priority=e.priority),void 0!==e.screenSpace&&(t.screenSpace=e.screenSpace),t.cull=t.screenSpace,void 0!==e.scaleMode&&(t.scaleMode=e.scaleMode),void 0!==e.scaleBlend&&(t.scaleBlend=e.scaleBlend),void 0!==e.resolution&&(e.resolution instanceof W?t._resolution.copy(e.resolution):t._resolution.set(e.resolution[0],e.resolution[1]),t.resolution=t._resolution),void 0!==e.referenceResolution&&(e.referenceResolution instanceof W?t._referenceResolution.copy(e.referenceResolution):t._referenceResolution.set(e.referenceResolution[0],e.referenceResolution[1]),t.referenceResolution=t._referenceResolution),t.syncDrawOrder(),super.initializeComponentData(t,e,i)}destroy(){this.off(),this.app.graphicsDevice.off("resizecanvas",this._onResize,this)}_onUpdate(t){var e=this.store;for(var i in e)e[i].entity.screen.update&&e[i].entity.screen.update(t)}_onResize(t,e){this.windowResolution.x=t,this.windowResolution.y=e}cloneComponent(t,e){var i=t.screen;return this.addComponent(e,{enabled:i.enabled,screenSpace:i.screenSpace,scaleMode:i.scaleMode,resolution:i.resolution.clone(),referenceResolution:i.referenceResolution.clone()})}onRemoveComponent(t,e){e.onRemove()}processDrawOrderSyncQueue(){for(var t=this._drawOrderSyncQueue.list(),e=0;e<t.length;e++){var i=t[e];i.callback.call(i.scope)}this._drawOrderSyncQueue.clear()}queueDrawOrderSync(t,e,i){this._drawOrderSyncQueue.list().length||this.app.once("prerender",this.processDrawOrderSyncQueue,this),this._drawOrderSyncQueue.has(t)||this._drawOrderSyncQueue.push(t,{callback:e,scope:i})}}Cl._buildAccessors(Gu.prototype,Hu);const Zu=["x","y","z","w"],Yu=[void 0,void 0,W,H,X];function qu(t,e,i,n){var r,s;switch(e.type){case"boolean":return!!i;case"number":if("number"==typeof i)return i;if("string"==typeof i){var a=parseInt(i,10);return isNaN(a)?null:a}return"boolean"==typeof i?0+i:null;case"json":var o={};if(Array.isArray(e.schema))for(i&&"object"==typeof i||(i={}),r=0;r<e.schema.length;r++){var l=e.schema[r];if(l.name)if(l.array){o[l.name]=[];var h=Array.isArray(i[l.name])?i[l.name]:[];for(s=0;s<h.length;s++)o[l.name].push(qu(t,l,h[s]))}else{var c=i.hasOwnProperty(l.name)?i[l.name]:l.default;o[l.name]=qu(t,l,c)}}return o;case"asset":return i instanceof As?i:"number"==typeof i?t.assets.get(i)||null:"string"==typeof i&&t.assets.get(parseInt(i,10))||null;case"entity":return i instanceof _i?i:"string"==typeof i?t.getEntityFromIndex(i):null;case"rgb":case"rgba":if(i instanceof D)return n instanceof D?(n.copy(i),n):i.clone();if(i instanceof Array&&i.length>=3&&i.length<=4){for(r=0;r<i.length;r++)if("number"!=typeof i[r])return null;return n||(n=new D),n.r=i[0],n.g=i[1],n.b=i[2],n.a=3===i.length?1:i[3],n}return"string"==typeof i&&/#([0-9abcdef]{2}){3,4}/i.test(i)?(n||(n=new D),n.fromString(i),n):null;case"vec2":case"vec3":case"vec4":var u=parseInt(e.type.slice(3),10),d=Yu[u];if(i instanceof d)return n instanceof d?(n.copy(i),n):i.clone();if(i instanceof Array&&i.length===u){for(r=0;r<i.length;r++)if("number"!=typeof i[r])return null;for(n||(n=new d),r=0;r<u;r++)n[Zu[r]]=i[r];return n}return null;case"curve":if(i){var f;if(i instanceof V||i instanceof U)f=i.clone();else(f=new(i.keys[0]instanceof Array?U:V)(i.keys)).type=i.type;return f}}return i}class Ku{constructor(t){this.scriptType=t,this.index={}}add(t,e){this.index[t]||Ku.reservedNames.has(t)||(this.index[t]=e,Object.defineProperty(this.scriptType.prototype,t,{get:function(){return this.__attributes[t]},set:function(i){var n,r,s="attr:"+t,a=this.__attributes[t],o=a;if(a&&"json"!==e.type&&a.clone&&(this._callbacks.attr||this._callbacks[s])&&(o=a.clone()),e.array){if(this.__attributes[t]=[],i)for(n=0,r=i.length;n<r;n++)this.__attributes[t].push(qu(this.app,e,i[n],a?a[n]:null))}else this.__attributes[t]=qu(this.app,e,i,a);this.fire("attr",t,this.__attributes[t],o),this.fire(s,this.__attributes[t],o)}}))}remove(t){return!!this.index[t]&&(delete this.index[t],delete this.scriptType.prototype[t],!0)}has(t){return!!this.index[t]}get(t){return this.index[t]||null}}Ku.reservedNames=new Set(["app","entity","enabled","_enabled","_enabledOld","_destroyed","__attributes","__attributesRaw","__scriptType","__executionOrder","_callbacks","has","get","on","off","fire","once","hasEvent"]);class Ju extends Cl{constructor(t,e){super(t,e),this._scripts=[],this._updateList=new R({sortBy:"__executionOrder"}),this._postUpdateList=new R({sortBy:"__executionOrder"}),this._scriptsIndex={},this._destroyedScripts=[],this._destroyed=!1,this._scriptsData=null,this._oldState=!0,this._enabled=!0,this._beingEnabled=!1,this._isLoopingThroughScripts=!1,this._executionOrder=-1,this.on("set_enabled",this._onSetEnabled,this)}onEnable(){this._beingEnabled=!0,this._checkState(),this.entity._beingEnabled||this.onPostStateChange(),this._beingEnabled=!1}onDisable(){this._checkState()}onPostStateChange(){for(var t,e=this._beginLooping(),i=0,n=this.scripts.length;i<n;i++)(t=this.scripts[i])._initialized&&!t._postInitialized&&t.enabled&&(t._postInitialized=!0,t.postInitialize&&this._scriptMethod(t,Ju.scriptMethods.postInitialize));this._endLooping(e)}_beginLooping(){var t=this._isLoopingThroughScripts;return this._isLoopingThroughScripts=!0,t}_endLooping(t){this._isLoopingThroughScripts=t,this._isLoopingThroughScripts||this._removeDestroyedScripts()}_onSetEnabled(t,e,i){this._beingEnabled=!0,this._checkState(),this._beingEnabled=!1}_checkState(){var t=this.enabled&&this.entity.enabled;if(t!==this._oldState){this._oldState=t,this.fire(t?"enable":"disable"),this.fire("state",t),t?this.system._addComponentToEnabled(this):this.system._removeComponentFromEnabled(this);for(var e,i=this._beginLooping(),n=0,r=this.scripts.length;n<r;n++)(e=this.scripts[n]).enabled=e._enabled;this._endLooping(i)}}_onBeforeRemove(){this.fire("remove");for(var t=this._beginLooping(),e=0;e<this.scripts.length;e++){var i=this.scripts[e];i&&this.destroy(i.__scriptType.__name)}this._endLooping(t)}_removeDestroyedScripts(){var t=this._destroyedScripts.length;if(t){var e;for(e=0;e<t;e++){var i=this._destroyedScripts[e];this._removeScriptInstance(i)}this._destroyedScripts.length=0,this._resetExecutionOrder(0,this._scripts.length)}}_onInitializeAttributes(){for(var t=0,e=this.scripts.length;t<e;t++)this.scripts[t].__initializeAttributes()}_scriptMethod(t,e,i){t[e](i)}_onInitialize(){for(var t,e=this._scripts,i=this._beginLooping(),n=0,r=e.length;n<r;n++)!(t=e[n])._initialized&&t.enabled&&(t._initialized=!0,t.initialize&&this._scriptMethod(t,Ju.scriptMethods.initialize));this._endLooping(i)}_onPostInitialize(){this.onPostStateChange()}_onUpdate(t){var e=this._updateList;if(e.length){var i,n=this._beginLooping();for(e.loopIndex=0;e.loopIndex<e.length;e.loopIndex++)(i=e.items[e.loopIndex]).enabled&&this._scriptMethod(i,Ju.scriptMethods.update,t);this._endLooping(n)}}_onPostUpdate(t){var e=this._postUpdateList;if(e.length){var i,n=this._beginLooping();for(e.loopIndex=0;e.loopIndex<e.length;e.loopIndex++)(i=e.items[e.loopIndex]).enabled&&this._scriptMethod(i,Ju.scriptMethods.postUpdate,t);this._endLooping(n)}}_insertScriptInstance(t,e,i){-1===e?(this._scripts.push(t),t.__executionOrder=i,t.update&&this._updateList.append(t),t.postUpdate&&this._postUpdateList.append(t)):(this._scripts.splice(e,0,t),t.__executionOrder=e,this._resetExecutionOrder(e+1,i+1),t.update&&this._updateList.insert(t),t.postUpdate&&this._postUpdateList.insert(t))}_removeScriptInstance(t){var e=this._scripts.indexOf(t);return-1===e||(this._scripts.splice(e,1),t.update&&this._updateList.remove(t),t.postUpdate&&this._postUpdateList.remove(t)),e}_resetExecutionOrder(t,e){for(var i=t;i<e;i++)this._scripts[i].__executionOrder=i}_resolveEntityScriptAttribute(t,e,i,n,r,s){if(t.array){var a=i.length;if(!a)return;for(var o=i.slice(),l=0;l<a;l++){var h=o[l]instanceof ha?o[l].getGuid():o[l];s[h]&&(o[l]=n?s[h].getGuid():s[h])}r[e]=o}else{if(i instanceof ha)i=i.getGuid();else if("string"!=typeof i)return;s[i]&&(r[e]=s[i])}}has(t){if("string"==typeof t)return!!this._scriptsIndex[t];if(!t)return!1;var e=t,i=e.__name,n=this._scriptsIndex[i];return(n&&n.instance)instanceof e}get(t){if("string"==typeof t){var e=this._scriptsIndex[t];return e?e.instance:null}if(!t)return null;var i=t,n=i.__name,r=this._scriptsIndex[n],s=r&&r.instance;return s instanceof i?s:null}create(t,e={}){var i=this,n=t,r=t;if("string"==typeof n?n=this.system.app.scripts.get(n):n&&(r=n.__name),n){if(!this._scriptsIndex[r]||!this._scriptsIndex[r].instance){var s=new n({app:this.system.app,entity:this.entity,enabled:!e.hasOwnProperty("enabled")||e.enabled,attributes:e.attributes}),a=this._scripts.length,o=-1;return"number"==typeof e.ind&&-1!==e.ind&&a>e.ind&&(o=e.ind),this._insertScriptInstance(s,o,a),this._scriptsIndex[r]={instance:s,onSwap:function(){i.swap(r)}},this[r]=s,e.preloading||s.__initializeAttributes(),this.fire("create",r,s),this.fire("create:"+r,s),this.system.app.scripts.on("swap:"+r,this._scriptsIndex[r].onSwap),e.preloading||(s.enabled&&!s._initialized&&(s._initialized=!0,s.initialize&&this._scriptMethod(s,Ju.scriptMethods.initialize)),s.enabled&&!s._postInitialized&&(s._postInitialized=!0,s.postInitialize&&this._scriptMethod(s,Ju.scriptMethods.postInitialize))),s}console.warn("script '"+r+"' is already added to entity '"+this.entity.name+"'")}else this._scriptsIndex[r]={awaiting:!0,ind:this._scripts.length},console.warn("script '"+r+"' is not found, awaiting it to be added to registry");return null}destroy(t){var e=t,i=t;"string"==typeof i?i=this.system.app.scripts.get(i):i&&(e=i.__name);var n=this._scriptsIndex[e];if(delete this._scriptsIndex[e],!n)return!1;var r=n.instance;if(r&&!r._destroyed)if(r.enabled=!1,r._destroyed=!0,this._isLoopingThroughScripts)this._destroyedScripts.push(r);else{var s=this._removeScriptInstance(r);s>=0&&this._resetExecutionOrder(s,this._scripts.length)}return this.system.app.scripts.off("swap:"+e,n.onSwap),delete this[e],this.fire("destroy",e,r||null),this.fire("destroy:"+e,r||null),r&&r.fire("destroy"),!0}swap(t){var e=t,i=t;"string"==typeof i?i=this.system.app.scripts.get(i):i&&(e=i.__name);var n=this._scriptsIndex[e];if(!n||!n.instance)return!1;var r=n.instance,s=this._scripts.indexOf(r),a=new i({app:this.system.app,entity:this.entity,enabled:r.enabled,attributes:r.__attributes});return!!a.swap&&(a.__initializeAttributes(),this._scripts[s]=a,this._scriptsIndex[e].instance=a,this[e]=a,a.__executionOrder=s,r.update&&this._updateList.remove(r),r.postUpdate&&this._postUpdateList.remove(r),a.update&&this._updateList.insert(a),a.postUpdate&&this._postUpdateList.insert(a),this._scriptMethod(a,Ju.scriptMethods.swap,r),this.fire("swap",e,a),this.fire("swap:"+e,a),!0)}resolveDuplicatedEntityReferenceProperties(t,e){var i,n,r=this.entity.script;for(var s in t._scriptsIndex){var a=this.system.app.scripts.get(s);if(a){var o=t._scriptsIndex[s];if(o&&o.instance){var l=r[s].__attributesRaw,h=r[s].__attributes;if(l||h){var c=!!l,u=o.instance.__attributes;for(var d in u)if(u[d]){var f=a.attributes.get(d);if(f)if("entity"===f.type)this._resolveEntityScriptAttribute(f,d,u[d],c,l||h,e);else if("json"===f.type&&Array.isArray(f.schema)){var p=u[d],m=l?l[d]:h[d];for(i=0;i<f.schema.length;i++){var g=f.schema[i];if("entity"===g.type)if(f.array)for(n=0;n<p.length;n++)this._resolveEntityScriptAttribute(g,g.name,p[n][g.name],c,m[n],e);else this._resolveEntityScriptAttribute(g,g.name,p[g.name],c,m,e)}}}}}}}}move(t,e){var i=this._scripts.length;if(e>=i||e<0)return!1;var n=t,r=t;"string"!=typeof r?r=t.__name:n=null;var s=this._scriptsIndex[r];if(!s||!s.instance)return!1;var a=s.instance;if(n&&!(a instanceof n))return!1;var o=this._scripts.indexOf(a);return-1!==o&&o!==e&&(this._scripts.splice(e,0,this._scripts.splice(o,1)[0]),this._resetExecutionOrder(0,i),this._updateList.sort(),this._postUpdateList.sort(),this.fire("move",r,a,e,o),this.fire("move:"+r,a,e,o),!0)}get enabled(){return this._enabled}set enabled(t){var e=this._enabled;this._enabled=t,this.fire("set","enabled",e,t)}get scripts(){return this._scripts}set scripts(t){for(var e in this._scriptsData=t,t)if(t.hasOwnProperty(e)){var i=this._scriptsIndex[e];if(i){if("boolean"==typeof t[e].enabled&&(i.enabled=!!t[e].enabled),"object"==typeof t[e].attributes)for(var n in t[e].attributes)if(!Ku.reservedNames.has(n)){if(!i.__attributes.hasOwnProperty(n)){var r=this.system.app.scripts.get(e);r&&r.attributes.add(n,{})}i[n]=t[e].attributes[n]}}else console.log(this.order)}}}Ju.scriptMethods={initialize:"initialize",postInitialize:"postInitialize",update:"update",postUpdate:"postUpdate",swap:"swap"};class Qu{constructor(){this.enabled=!0}}var $u=0;class td extends Il{constructor(t){super(t),this.id="script",this.ComponentType=Ju,this.DataType=Qu,this._components=new R({sortBy:"_executionOrder"}),this._enabledComponents=new R({sortBy:"_executionOrder"}),this.preloading=!0,this.on("beforeremove",this._onBeforeRemove,this),Il.bind("initialize",this._onInitialize,this),Il.bind("postInitialize",this._onPostInitialize,this),Il.bind("update",this._onUpdate,this),Il.bind("postUpdate",this._onPostUpdate,this)}initializeComponentData(t,e){if(t._executionOrder=$u++,this._components.append(t),$u>Number.MAX_SAFE_INTEGER&&this._resetExecutionOrder(),t.enabled=!e.hasOwnProperty("enabled")||!!e.enabled,t.enabled&&t.entity.enabled&&this._enabledComponents.append(t),e.hasOwnProperty("order")&&e.hasOwnProperty("scripts")){t._scriptsData=e.scripts;for(var i=0;i<e.order.length;i++)t.create(e.order[i],{enabled:e.scripts[e.order[i]].enabled,attributes:e.scripts[e.order[i]].attributes,preloading:this.preloading})}}cloneComponent(t,e){var i,n,r=[],s={};for(i=0;i<t.script._scripts.length;i++){var a=t.script._scripts[i],o=a.__scriptType.__name;r.push(o);var l={};for(n in a.__attributes)l[n]=a.__attributes[n];s[o]={enabled:a._enabled,attributes:l}}for(n in t.script._scriptsIndex)n.awaiting&&r.splice(n.ind,0,n);var h={enabled:t.script.enabled,order:r,scripts:s};return this.addComponent(e,h)}_resetExecutionOrder(){$u=0;for(var t=0,e=this._components.length;t<e;t++)this._components.items[t]._executionOrder=$u++}_callComponentMethod(t,e,i){for(t.loopIndex=0;t.loopIndex<t.length;t.loopIndex++)t.items[t.loopIndex][e](i)}_onInitialize(){this.preloading=!1,this._callComponentMethod(this._components,"_onInitializeAttributes"),this._callComponentMethod(this._enabledComponents,"_onInitialize")}_onPostInitialize(){this._callComponentMethod(this._enabledComponents,"_onPostInitialize")}_onUpdate(t){this._callComponentMethod(this._enabledComponents,"_onUpdate",t)}_onPostUpdate(t){this._callComponentMethod(this._enabledComponents,"_onPostUpdate",t)}_addComponentToEnabled(t){this._enabledComponents.insert(t)}_removeComponentFromEnabled(t){this._enabledComponents.remove(t)}_onBeforeRemove(t,e){this._components.items.indexOf(e)>=0&&e._onBeforeRemove(),this._removeComponentFromEnabled(e),this._components.remove(e)}}class ed extends Cl{constructor(t,e){super(t,e),this.on("set_scripts",this.onSetScripts,this)}send(t,e){var i,n=Array.prototype.slice.call(arguments,2),r=this.entity.script.instances;if(r&&r[t]&&(i=r[t].instance[e]))return i.apply(r[t].instance,n)}onEnable(){this.data.areScriptsLoaded&&!this.system.preloading&&(this.data.initialized?this.system._enableScriptComponent(this):this.system._initializeScriptComponent(this),this.data.postInitialized||this.system._postInitializeScriptComponent(this))}onDisable(){this.system._disableScriptComponent(this)}onSetScripts(t,e,i){if(!this.system._inTools||this.runInTools){if(this._updateScriptAttributes(e,i))return;this.enabled&&this.system._disableScriptComponent(this),this.system._destroyScriptComponent(this),this.data.areScriptsLoaded=!1;var n=i.map((function(t){return t.url}));if(this._loadFromCache(n))return;this._loadScripts(n)}}_updateScriptAttributes(t,e){var i=!0;if(t.length!==e.length)i=!1;else{var n,r=e.length;for(n=0;n<r;n++)if(t[n].url!==e[n].url){i=!1;break}}if(i)for(var s in this.instances)this.instances.hasOwnProperty(s)&&this.system._updateAccessors(this.entity,this.instances[s]);return i}_loadFromCache(t){var e,i,n=[],r=this.system.app._scriptPrefix||"",s=/^http(s)?:\/\//i;for(e=0,i=t.length;e<i;e++){var a=t[e];s.test(a)||(a=x.join(r,a));var o=this.system.app.loader.getFromCache(a,"script");if(!o)return!1;n.push(o)}for(e=0,i=n.length;e<i;e++){var l=n[e];if(!0!==l&&(l&&this.entity.script&&!this.entity.script.instances[l._pcScriptName])){var h=new l(this.entity);this.system._preRegisterInstance(this.entity,t[e],l._pcScriptName,h)}}return this.data&&(this.data.areScriptsLoaded=!0),this.system.preloading||(this.system.onInitialize(this.entity),this.system.onPostInitialize(this.entity)),!0}_loadScripts(t){var e=t.length,i=this.system.app._scriptPrefix||"";t.forEach(function(t){var n=null,r=null;t.toLowerCase().startsWith("http://")||t.toLowerCase().startsWith("https://")?(r=t,n=t):(r=t,n=x.join(i,t)),this.system.app.loader.load(n,"script",function(t,i){if(e--,t)console.error(t);else if(i&&this.entity.script&&!this.entity.script.instances[i._pcScriptName]){var n=new i(this.entity);this.system._preRegisterInstance(this.entity,r,i._pcScriptName,n)}0===e&&(this.data.areScriptsLoaded=!0,this.system.preloading||(this.system.onInitialize(this.entity),this.system.onPostInitialize(this.entity)))}.bind(this))}.bind(this))}}class id{constructor(){this.scripts=[],this.enabled=!0,this.instances={},this._instances={},this.runInTools=!1,this.attributes={},this.initialized=!1,this.postInitialized=!1,this.areScriptsLoaded=!1}}const nd=["enabled","scripts","instances","runInTools"];class rd extends Il{constructor(t){super(t),this.id="script",this.ComponentType=ed,this.DataType=id,this.schema=nd,this.preloading=!1,this.instancesWithUpdate=[],this.instancesWithFixedUpdate=[],this.instancesWithPostUpdate=[],this.instancesWithToolsUpdate=[],this.on("beforeremove",this.onBeforeRemove,this),Il.bind("initialize",this.onInitialize,this),Il.bind("postInitialize",this.onPostInitialize,this),Il.bind("update",this.onUpdate,this),Il.bind("fixedUpdate",this.onFixedUpdate,this),Il.bind("postUpdate",this.onPostUpdate,this),Il.bind("toolsUpdate",this.onToolsUpdate,this)}initializeComponentData(t,e,i){i=["runInTools","enabled","scripts"],e.scripts&&e.scripts.length&&e.scripts.forEach((function(t){if(t.attributes&&Array.isArray(t.attributes)){for(var e={},i=0;i<t.attributes.length;i++)e[t.attributes[i].name]=t.attributes[i];t.attributes=e}})),super.initializeComponentData(t,e,i)}cloneComponent(t,e){for(var i=this.store[t.getGuid()],n={runInTools:i.data.runInTools,scripts:[],enabled:i.data.enabled},r=i.data.scripts,s=0,a=r.length;s<a;s++){var o=r[s].attributes;o&&delete r[s].attributes,n.scripts.push(u({},r[s])),o&&(n.scripts[s].attributes=this._cloneAttributes(o),r[s].attributes=o)}return this.addComponent(e,n)}onBeforeRemove(t,e){e.enabled&&this._disableScriptComponent(e),this._destroyScriptComponent(e)}onInitialize(t){if(this._registerInstances(t),t.enabled){t.script&&t.script.enabled&&this._initializeScriptComponent(t.script);var e,i=t._children,n=i.length;for(e=0;e<n;e++)i[e]instanceof ha&&this.onInitialize(i[e])}}onPostInitialize(t){if(t.enabled){t.script&&t.script.enabled&&this._postInitializeScriptComponent(t.script);var e,i=t._children,n=i.length;for(e=0;e<n;e++)i[e]instanceof ha&&this.onPostInitialize(i[e])}}_callInstancesMethod(t,e){var i=t.data.instances;for(var n in i)if(i.hasOwnProperty(n)){var r=i[n].instance;r[e]&&r[e]()}}_initializeScriptComponent(t){this._callInstancesMethod(t,"initialize"),t.data.initialized=!0,t.enabled&&t.entity.enabled&&this._enableScriptComponent(t)}_enableScriptComponent(t){this._callInstancesMethod(t,"onEnable")}_disableScriptComponent(t){this._callInstancesMethod(t,"onDisable")}_destroyScriptComponent(t){var e,i=t.data.instances;for(var n in i)if(i.hasOwnProperty(n)){var r=i[n].instance;r.destroy&&r.destroy(),r.update&&(e=this.instancesWithUpdate.indexOf(r))>=0&&this.instancesWithUpdate.splice(e,1),r.fixedUpdate&&(e=this.instancesWithFixedUpdate.indexOf(r))>=0&&this.instancesWithFixedUpdate.splice(e,1),r.postUpdate&&(e=this.instancesWithPostUpdate.indexOf(r))>=0&&this.instancesWithPostUpdate.splice(e,1),r.toolsUpdate&&(e=this.instancesWithToolsUpdate.indexOf(r))>=0&&this.instancesWithToolsUpdate.splice(e,1),t.instances[n].instance===t[n]&&delete t[n],delete t.instances[n]}}_postInitializeScriptComponent(t){this._callInstancesMethod(t,"postInitialize"),t.data.postInitialized=!0}_updateInstances(t,e,i){for(var n,r=0,s=e.length;r<s;r++)(n=e[r])&&n.entity&&n.entity.enabled&&n.entity.script.enabled&&n[t](i)}onUpdate(t){this._updateInstances("update",this.instancesWithUpdate,t)}onFixedUpdate(t){this._updateInstances("fixedUpdate",this.instancesWithFixedUpdate,t)}onPostUpdate(t){this._updateInstances("postUpdate",this.instancesWithPostUpdate,t)}onToolsUpdate(t){this._updateInstances("toolsUpdate",this.instancesWithToolsUpdate,t)}broadcast(t,e){var i,n,r,s=Array.prototype.slice.call(arguments,2),a=this.store;for(i in a)a.hasOwnProperty(i)&&(n=a[i].data).instances[t]&&(r=n.instances[t].instance[e])&&r.apply(n.instances[t].instance,s)}_preRegisterInstance(t,e,i,n){if(t.script){if(t.script.data._instances=t.script.data._instances||{},t.script.data._instances[i])throw Error("Script name collision '"+i+"'. Scripts from '"+e+"' and '"+t.script.data._instances[i].url+"' {"+t.getGuid()+"}");t.script.data._instances[i]={url:e,name:i,instance:n}}}_registerInstances(t){var e,i,n;if(t.script&&t.script.data._instances){for(n in t.script.instances=t.script.data._instances,t.script.instances){if(i=(e=t.script.instances[n]).instance,y.attach(i),i.update&&this.instancesWithUpdate.push(i),i.fixedUpdate&&this.instancesWithFixedUpdate.push(i),i.postUpdate&&this.instancesWithPostUpdate.push(i),i.toolsUpdate&&this.instancesWithToolsUpdate.push(i),t.script.scripts&&this._createAccessors(t,e),t.script[n])throw Error("Script with name '"+n+"' is already attached to Script Component");t.script[n]=i}delete t.script.data._instances}var r,s=t._children,a=s.length;for(r=0;r<a;r++)s[r]instanceof ha&&this._registerInstances(s[r])}_cloneAttributes(t){var e={};for(var i in t)if(t.hasOwnProperty(i))if("entity"!==t[i].type)e[i]=u({},t[i]);else{var n=t[i].value;delete t[i].value,e[i]=u({},t[i]),e[i].value=n,t[i].value=n}return e}_createAccessors(t,e){var i,n=t.script.scripts.length,r=e.url;for(i=0;i<n;i++){var s=t.script.scripts[i];if(s.url===r){var a=s.attributes;if(s.name&&a){for(var o in a)a.hasOwnProperty(o)&&this._createAccessor(a[o],e);t.script.data.attributes[s.name]=this._cloneAttributes(a)}break}}}_createAccessor(t,e){var i=this;t={name:t.name,value:t.value,type:t.type},i._convertAttributeValue(t),Object.defineProperty(e.instance,t.name,{get:function(){return t.value},set:function(n){var r=t.value;t.value=n,i._convertAttributeValue(t),e.instance.fire("set",t.name,r,t.value)},configurable:!0})}_updateAccessors(t,e){var i,n,r,s,a,o,l,h,c=t.script.scripts.length,u=e.url;for(i=0;i<c;i++)if((s=(r=t.script).scripts[i]).url===u){if(a=s.name,o=s.attributes,a){if(o)for(n in o)o.hasOwnProperty(n)&&this._createAccessor(o[n],e);if(l=r.data.attributes[a])for(n in l)h=l[n],n in o?o[n].value!==h.value&&e.instance.onAttributeChanged&&e.instance.onAttributeChanged(h.name,h.value,o[n].value):delete e.instance[h.name];o?r.data.attributes[a]=this._cloneAttributes(o):delete r.data.attributes[a]}break}}_convertAttributeValue(t){if("rgb"===t.type||"rgba"===t.type)Array.isArray(t.value)&&(t.value=3===t.value.length?new D(t.value[0],t.value[1],t.value[2]):new D(t.value[0],t.value[1],t.value[2],t.value[3]));else if("vec2"===t.type)Array.isArray(t.value)&&(t.value=new W(t.value[0],t.value[1]));else if("vec3"===t.type||"vector"===t.type)Array.isArray(t.value)&&(t.value=new H(t.value[0],t.value[1],t.value[2]));else if("vec4"===t.type)Array.isArray(t.value)&&(t.value=new X(t.value[0],t.value[1],t.value[2],t.value[3]));else if("entity"===t.type)null!==t.value&&"string"==typeof t.value&&(t.value=this.app.root.findByGuid(t.value));else if("curve"===t.type||"colorcurve"===t.type){var e=t.value.keys[0]instanceof Array?U:V;t.value=new e(t.value.keys),t.value.type=t.value.type}}}Cl._buildAccessors(ed.prototype,nd);var sd=new W,ad=new H,od=new H,ld=new H,hd=new H,cd=new H,ud=new $;const dd={x:"y",y:"x"};class fd extends v{constructor(t,e){if(super(),!(t&&t instanceof xc))throw new Error("Element was null or not an ElementComponent");if(e&&"x"!==e&&"y"!==e)throw new Error("Unrecognized axis: "+e);this._element=t,this._app=t.system.app,this._axis=e||null,this._enabled=!0,this._dragScale=new H,this._dragStartMousePosition=new H,this._dragStartHandlePosition=new H,this._deltaMousePosition=new H,this._deltaHandlePosition=new H,this._isDragging=!1,this._toggleLifecycleListeners("on")}_toggleLifecycleListeners(t){this._element[t]("mousedown",this._onMouseDownOrTouchStart,this),this._element[t]("touchstart",this._onMouseDownOrTouchStart,this)}_toggleDragListeners(t){var e="on"===t,i=e?"addEventListener":"removeEventListener";this._hasDragListeners&&e||(this._handleMouseUpOrTouchEnd||(this._handleMouseUpOrTouchEnd=this._onMouseUpOrTouchEnd.bind(this)),this._app.mouse&&(this._app.mouse[t]("mousemove",this._onMove,this),window[i]("mouseup",this._handleMouseUpOrTouchEnd,!1)),w.touch&&(this._app.touch[t]("touchmove",this._onMove,this),window[i]("touchend",this._handleMouseUpOrTouchEnd,!1),window[i]("touchcancel",this._handleMouseUpOrTouchEnd,!1)),this._hasDragListeners=e)}_onMouseDownOrTouchStart(t){if(this._element&&!this._isDragging&&this.enabled){this._dragCamera=t.camera,this._calculateDragScale();var e=this._screenToLocal(t);e&&(this._toggleDragListeners("on"),this._isDragging=!0,this._dragStartMousePosition.copy(e),this._dragStartHandlePosition.copy(this._element.entity.getLocalPosition()),this.fire("drag:start"))}}_onMouseUpOrTouchEnd(){this._isDragging&&(this._isDragging=!1,this._toggleDragListeners("off"),this.fire("drag:end"))}_screenToLocal(t){this._determineInputPosition(t),this._chooseRayOriginAndDirection(),hd.copy(this._element.entity.getPosition()),cd.copy(this._element.entity.forward).scale(-1);var e=cd.dot(ld);if(Math.abs(e)>0){var i=hd.sub(od).dot(cd)/e,n=od.add(ld.scale(i));return ud.copy(this._element.entity.getRotation()).invert().transformVector(n,n),n.mul(this._dragScale),n}return null}_determineInputPosition(t){var e=this._app.graphicsDevice.maxPixelRatio;void 0!==t.x&&void 0!==t.y?(sd.x=t.x*e,sd.y=t.y*e):t.changedTouches?(sd.x=t.changedTouches[0].x*e,sd.y=t.changedTouches[0].y*e):console.warn("Could not determine position from input event")}_chooseRayOriginAndDirection(){this._element.screen&&this._element.screen.screen.screenSpace?(od.set(sd.x,-sd.y,0),ld.set(0,0,-1)):(ad.copy(this._dragCamera.screenToWorld(sd.x,sd.y,1)),od.copy(this._dragCamera.entity.getPosition()),ld.copy(ad).sub(od).normalize())}_calculateDragScale(){var t=this._element.entity.parent,e=this._element.screen&&this._element.screen.screen,i=e&&e.screenSpace,n=i?e.scale:1,r=this._dragScale;for(r.set(n,n,n);t&&(r.mul(t.getLocalScale()),t=t.parent,!i||!t.screen););r.x=1/r.x,r.y=1/r.y,r.z=1/r.z}_onMove(t){if(this._element&&this._isDragging&&this.enabled&&this._element.enabled&&this._element.entity.enabled){var e=this._screenToLocal(t);if(this._dragStartMousePosition&&e){if(this._deltaMousePosition.copy(e).sub(this._dragStartMousePosition),this._deltaHandlePosition.copy(this._dragStartHandlePosition).add(this._deltaMousePosition),this._axis){var i=this._element.entity.getLocalPosition(),n=dd[this._axis];this._deltaHandlePosition[n]=i[n]}this._element.entity.setLocalPosition(this._deltaHandlePosition),this.fire("drag:move",this._deltaHandlePosition)}}}destroy(){this._toggleLifecycleListeners("off"),this._toggleDragListeners("off")}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get isDragging(){return this._isDragging}}var pd=new W;class md extends Cl{constructor(t,e){super(t,e),this._viewportReference=new uh(this,"viewportEntity",{"element#gain":this._onViewportElementGain,"element#resize":this._onSetContentOrViewportSize}),this._contentReference=new uh(this,"contentEntity",{"element#gain":this._onContentElementGain,"element#lose":this._onContentElementLose,"element#resize":this._onSetContentOrViewportSize}),this._scrollbarUpdateFlags={},this._scrollbarReferences={},this._scrollbarReferences[0]=new uh(this,"horizontalScrollbarEntity",{"scrollbar#set:value":this._onSetHorizontalScrollbarValue,"scrollbar#gain":this._onHorizontalScrollbarGain}),this._scrollbarReferences[1]=new uh(this,"verticalScrollbarEntity",{"scrollbar#set:value":this._onSetVerticalScrollbarValue,"scrollbar#gain":this._onVerticalScrollbarGain}),this._prevContentSizes={},this._prevContentSizes[0]=null,this._prevContentSizes[1]=null,this._scroll=new W,this._velocity=new H,this._dragStartPosition=new H,this._disabledContentInput=!1,this._disabledContentInputEntities=[],this._toggleLifecycleListeners("on",t),this._toggleElementListeners("on")}_toggleLifecycleListeners(t,e){this[t]("set_horizontal",this._onSetHorizontalScrollingEnabled,this),this[t]("set_vertical",this._onSetVerticalScrollingEnabled,this),e.app.systems.element[t]("add",this._onElementComponentAdd,this),e.app.systems.element[t]("beforeremove",this._onElementComponentRemove,this)}_toggleElementListeners(t){if(this.entity.element){if("on"===t&&this._hasElementListeners)return;this.entity.element[t]("resize",this._onSetContentOrViewportSize,this),this._hasElementListeners="on"===t}}_onElementComponentAdd(t){this.entity===t&&this._toggleElementListeners("on")}_onElementComponentRemove(t){this.entity===t&&this._toggleElementListeners("off")}_onViewportElementGain(){this._syncAll()}_onContentElementGain(){this._destroyDragHelper(),this._contentDragHelper=new fd(this._contentReference.entity.element),this._contentDragHelper.on("drag:start",this._onContentDragStart,this),this._contentDragHelper.on("drag:end",this._onContentDragEnd,this),this._contentDragHelper.on("drag:move",this._onContentDragMove,this),this._prevContentSizes[0]=null,this._prevContentSizes[1]=null,this._syncAll()}_onContentElementLose(){this._destroyDragHelper()}_onContentDragStart(){this._contentReference.entity&&this.enabled&&this.entity.enabled&&this._dragStartPosition.copy(this._contentReference.entity.getLocalPosition())}_onContentDragEnd(){this._prevContentDragPosition=null,this._enableContentInput()}_onContentDragMove(t){if(this._contentReference.entity&&this.enabled&&this.entity.enabled&&(this._wasDragged=!0,this._setScrollFromContentPosition(t),this._setVelocityFromContentPositionDelta(t),!this._disabledContentInput)){var e=t.x-this._dragStartPosition.x,i=t.y-this._dragStartPosition.y;(Math.abs(e)>this.dragThreshold||Math.abs(i)>this.dragThreshold)&&this._disableContentInput()}}_onSetContentOrViewportSize(){this._syncAll()}_onSetHorizontalScrollbarValue(t){!this._scrollbarUpdateFlags[0]&&this.enabled&&this.entity.enabled&&this._onSetScroll(t,null)}_onSetVerticalScrollbarValue(t){!this._scrollbarUpdateFlags[1]&&this.enabled&&this.entity.enabled&&this._onSetScroll(null,t)}_onSetHorizontalScrollingEnabled(){this._syncScrollbarEnabledState(0)}_onSetVerticalScrollingEnabled(){this._syncScrollbarEnabledState(1)}_onHorizontalScrollbarGain(){this._syncScrollbarEnabledState(0),this._syncScrollbarPosition(0)}_onVerticalScrollbarGain(){this._syncScrollbarEnabledState(1),this._syncScrollbarPosition(1)}_onSetScroll(t,e,i){!1!==i&&this._velocity.set(0,0,0);var n=!1;n|=this._updateAxis(t,"x",0),(n|=this._updateAxis(e,"y",1))&&this.fire("set:scroll",this._scroll)}_updateAxis(t,e,i){var n=null!==t&&Math.abs(t-this._scroll[e])>1e-5;return(n||this._isDragging()||0===t)&&(this._scroll[e]=this._determineNewScrollValue(t,e,i),this._syncContentPosition(i),this._syncScrollbarPosition(i)),n}_determineNewScrollValue(t,e,i){if(!this._getScrollingEnabled(i))return this._scroll[e];switch(this.scrollMode){case 0:return k.clamp(t,0,this._getMaxScrollValue(i));case 1:return this._setVelocityFromOvershoot(t,e,i),t;case 2:return t;default:return console.warn("Unhandled scroll mode:"+this.scrollMode),t}}_syncAll(){this._syncContentPosition(0),this._syncContentPosition(1),this._syncScrollbarPosition(0),this._syncScrollbarPosition(1),this._syncScrollbarEnabledState(0),this._syncScrollbarEnabledState(1)}_syncContentPosition(t){var e=this._getAxis(t),i=this._getSign(t),n=this._contentReference.entity;if(n){var r=this._prevContentSizes[t],s=this._getContentSize(t);if(null!==r&&Math.abs(r-s)>1e-4){var a=this._getMaxOffset(t,r),o=this._getMaxOffset(t,s);this._scroll[e]=0===o?1:k.clamp(this._scroll[e]*a/o,0,1)}var l=this._scroll[e]*this._getMaxOffset(t),h=n.getLocalPosition();h[e]=l*i,n.setLocalPosition(h),this._prevContentSizes[t]=s}}_syncScrollbarPosition(t){var e=this._getAxis(t),i=this._scrollbarReferences[t].entity;i&&i.scrollbar&&(this._scrollbarUpdateFlags[t]=!0,i.scrollbar.value=this._scroll[e],i.scrollbar.handleSize=this._getScrollbarHandleSize(e,t),this._scrollbarUpdateFlags[t]=!1)}_syncScrollbarEnabledState(t){var e=this._scrollbarReferences[t].entity;if(e){var i=this._getScrollingEnabled(t),n=this._getScrollbarVisibility(t);switch(n){case 0:return void(e.enabled=i);case 1:return void(e.enabled=i&&this._contentIsLargerThanViewport(t));default:console.warn("Unhandled scrollbar visibility:"+n),e.enabled=i}}}_contentIsLargerThanViewport(t){return this._getContentSize(t)>this._getViewportSize(t)}_contentPositionToScrollValue(t){var e=this._getMaxOffset(0),i=this._getMaxOffset(1);return pd.x=0===e?0:t.x/e,pd.y=0===i?0:t.y/-i,pd}_getMaxOffset(t,e){e=void 0===e?this._getContentSize(t):e;var i=this._getViewportSize(t);return e<i?-this._getViewportSize(t):i-e}_getMaxScrollValue(t){return this._contentIsLargerThanViewport(t)?1:0}_getScrollbarHandleSize(t,e){var i=this._getViewportSize(e),n=this._getContentSize(e);if(Math.abs(n)<.001)return 1;var r=Math.min(i/n,1),s=this._toOvershoot(this._scroll[t],e);return 0===s?r:r/(1+Math.abs(s))}_getViewportSize(t){return this._getSize(t,this._viewportReference)}_getContentSize(t){return this._getSize(t,this._contentReference)}_getSize(t,e){return e.entity&&e.entity.element?e.entity.element[this._getCalculatedDimension(t)]:0}_getScrollingEnabled(t){return 0===t?this.horizontal:1===t?this.vertical:void console.warn("Unrecognized orientation: "+t)}_getScrollbarVisibility(t){return 0===t?this.horizontalScrollbarVisibility:1===t?this.verticalScrollbarVisibility:void console.warn("Unrecognized orientation: "+t)}_getSign(t){return 0===t?1:-1}_getAxis(t){return 0===t?"x":"y"}_getCalculatedDimension(t){return 0===t?"calculatedWidth":"calculatedHeight"}_destroyDragHelper(){this._contentDragHelper&&this._contentDragHelper.destroy()}onUpdate(){this._contentReference.entity&&(this._updateVelocity(),this._syncScrollbarEnabledState(0),this._syncScrollbarEnabledState(1))}_updateVelocity(){if(!this._isDragging()&&(1===this.scrollMode&&(this._hasOvershoot("x",0)&&this._setVelocityFromOvershoot(this.scroll.x,"x",0),this._hasOvershoot("y",1)&&this._setVelocityFromOvershoot(this.scroll.y,"y",1)),this._velocity.x*=1-this.friction,this._velocity.y*=1-this.friction,Math.abs(this._velocity.x)>1e-4||Math.abs(this._velocity.y)>1e-4)){var t=this._contentReference.entity.getLocalPosition();t.x+=this._velocity.x,t.y+=this._velocity.y,this._contentReference.entity.setLocalPosition(t),this._setScrollFromContentPosition(t)}}_hasOvershoot(t,e){return Math.abs(this._toOvershoot(this.scroll[t],e))>.001}_toOvershoot(t,e){var i=this._getMaxScrollValue(e);return t<0?t:t>i?t-i:0}_setVelocityFromOvershoot(t,e,i){var n=this._toOvershoot(t,i)*this._getMaxOffset(i)*this._getSign(i);Math.abs(n)>0&&(this._velocity[e]=-n/(50*this.bounceAmount+1))}_setVelocityFromContentPositionDelta(t){this._prevContentDragPosition?(this._velocity.sub2(t,this._prevContentDragPosition),this._prevContentDragPosition.copy(t)):(this._velocity.set(0,0,0),this._prevContentDragPosition=t.clone())}_setScrollFromContentPosition(t){var e=this._contentPositionToScrollValue(t);this._isDragging()&&(e=this._applyScrollValueTension(e)),this._onSetScroll(e.x,e.y,!1)}_applyScrollValueTension(t){var e,i;return e=this._getMaxScrollValue(0),(i=this._toOvershoot(t.x,0))>0?t.x=e+1*Math.log10(1+i):i<0&&(t.x=-1*Math.log10(1-i)),e=this._getMaxScrollValue(1),(i=this._toOvershoot(t.y,1))>0?t.y=e+1*Math.log10(1+i):i<0&&(t.y=-1*Math.log10(1-i)),t}_isDragging(){return this._contentDragHelper&&this._contentDragHelper.isDragging}_setScrollbarComponentsEnabled(t){this._scrollbarReferences[0].hasComponent("scrollbar")&&(this._scrollbarReferences[0].entity.scrollbar.enabled=t),this._scrollbarReferences[1].hasComponent("scrollbar")&&(this._scrollbarReferences[1].entity.scrollbar.enabled=t)}_setContentDraggingEnabled(t){this._contentDragHelper&&(this._contentDragHelper.enabled=t)}_enableContentInput(){for(;this._disabledContentInputEntities.length;){var t=this._disabledContentInputEntities.pop();t.element&&(t.element.useInput=!0)}this._disabledContentInput=!1}_disableContentInput(){var t=this,e=function e(i){i.element&&i.element.useInput&&(t._disabledContentInputEntities.push(i),i.element.useInput=!1);var n,r,s=i.children;for(n=0,r=s.length;n<r;n++)e(s[n])},i=this._contentReference.entity;if(i){var n,r=i.children,s=r.length;for(n=0;n<s;n++)e(r[n])}this._disabledContentInput=!0}onEnable(){this._viewportReference.onParentComponentEnable(),this._contentReference.onParentComponentEnable(),this._scrollbarReferences[0].onParentComponentEnable(),this._scrollbarReferences[1].onParentComponentEnable(),this._setScrollbarComponentsEnabled(!0),this._setContentDraggingEnabled(!0),this._syncAll()}onDisable(){this._setScrollbarComponentsEnabled(!1),this._setContentDraggingEnabled(!1)}onRemove(){this._toggleLifecycleListeners("off",this.system),this._toggleElementListeners("off"),this._destroyDragHelper()}get scroll(){return this._scroll}set scroll(t){this._onSetScroll(t.x,t.y)}}class gd{constructor(){this.enabled=!0}}const vd=[{name:"enabled",type:"boolean"},{name:"horizontal",type:"boolean"},{name:"vertical",type:"boolean"},{name:"scrollMode",type:"number"},{name:"bounceAmount",type:"number"},{name:"friction",type:"number"},{name:"dragThreshold",type:"number"},{name:"horizontalScrollbarVisibility",type:"number"},{name:"verticalScrollbarVisibility",type:"number"},{name:"viewportEntity",type:"entity"},{name:"contentEntity",type:"entity"},{name:"horizontalScrollbarEntity",type:"entity"},{name:"verticalScrollbarEntity",type:"entity"}];class _d extends Il{constructor(t){super(t),this.id="scrollview",this.ComponentType=md,this.DataType=gd,this.schema=vd,this.on("beforeremove",this._onRemoveComponent,this),Il.bind("update",this.onUpdate,this)}initializeComponentData(t,e,i){void 0===e.dragThreshold&&(e.dragThreshold=10),super.initializeComponentData(t,e,vd)}onUpdate(t){var e=this.store;for(var i in e){var n=e[i].entity,r=n.scrollview;r.enabled&&n.enabled&&r.onUpdate()}}_onRemoveComponent(t,e){e.onRemove()}}Cl._buildAccessors(md.prototype,vd);class yd extends Cl{constructor(t,e){super(t,e),this._app=t.app,this._handleReference=new uh(this,"handleEntity",{"element#gain":this._onHandleElementGain,"element#lose":this._onHandleElementLose,"element#set:anchor":this._onSetHandleAlignment,"element#set:margin":this._onSetHandleAlignment,"element#set:pivot":this._onSetHandleAlignment}),this._toggleLifecycleListeners("on")}_toggleLifecycleListeners(t){this[t]("set_value",this._onSetValue,this),this[t]("set_handleSize",this._onSetHandleSize,this),this[t]("set_orientation",this._onSetOrientation,this)}_onHandleElementGain(){this._destroyDragHelper(),this._handleDragHelper=new fd(this._handleReference.entity.element,this._getAxis()),this._handleDragHelper.on("drag:move",this._onHandleDrag,this),this._updateHandlePositionAndSize()}_onHandleElementLose(){this._destroyDragHelper()}_onHandleDrag(t){this._handleReference.entity&&this.enabled&&this.entity.enabled&&(this.value=this._handlePositionToScrollValue(t[this._getAxis()]))}_onSetValue(t,e,i){Math.abs(i-e)>1e-5&&(this.data.value=k.clamp(i,0,1),this._updateHandlePositionAndSize(),this.fire("set:value",this.data.value))}_onSetHandleSize(t,e,i){Math.abs(i-e)>1e-5&&(this.data.handleSize=k.clamp(i,0,1),this._updateHandlePositionAndSize())}_onSetHandleAlignment(){this._updateHandlePositionAndSize()}_onSetOrientation(t,e,i){i!==e&&this._handleReference.hasComponent("element")&&(this._handleReference.entity.element[this._getOppositeDimension()]=0)}_updateHandlePositionAndSize(){var t=this._handleReference.entity,e=t&&t.element;if(t){var i=t.getLocalPosition();i[this._getAxis()]=this._getHandlePosition(),this._handleReference.entity.setLocalPosition(i)}e&&(e[this._getDimension()]=this._getHandleLength())}_handlePositionToScrollValue(t){return t*this._getSign()/this._getUsableTrackLength()}_scrollValueToHandlePosition(t){return t*this._getSign()*this._getUsableTrackLength()}_getUsableTrackLength(){return Math.max(this._getTrackLength()-this._getHandleLength(),.001)}_getTrackLength(){return this.entity.element?0===this.orientation?this.entity.element.calculatedWidth:this.entity.element.calculatedHeight:0}_getHandleLength(){return this._getTrackLength()*this.handleSize}_getHandlePosition(){return this._scrollValueToHandlePosition(this.value)}_getSign(){return 0===this.orientation?1:-1}_getAxis(){return 0===this.orientation?"x":"y"}_getDimension(){return 0===this.orientation?"width":"height"}_getOppositeDimension(){return 0===this.orientation?"height":"width"}_destroyDragHelper(){this._handleDragHelper&&this._handleDragHelper.destroy()}_setHandleDraggingEnabled(t){this._handleDragHelper&&(this._handleDragHelper.enabled=t)}onEnable(){this._handleReference.onParentComponentEnable(),this._setHandleDraggingEnabled(!0)}onDisable(){this._setHandleDraggingEnabled(!1)}onRemove(){this._destroyDragHelper(),this._toggleLifecycleListeners("off")}}class bd{constructor(){this.enabled=!0}}const xd=[{name:"enabled",type:"boolean"},{name:"orientation",type:"number"},{name:"value",type:"number"},{name:"handleSize",type:"number"},{name:"handleEntity",type:"entity"}];class wd extends Il{constructor(t){super(t),this.id="scrollbar",this.ComponentType=yd,this.DataType=bd,this.schema=xd,this.on("beforeremove",this._onRemoveComponent,this)}initializeComponentData(t,e,i){super.initializeComponentData(t,e,xd)}_onRemoveComponent(t,e){e.onRemove()}}Cl._buildAccessors(yd.prototype,xd);function Ad(t,e){return t%e||0}class Cd extends v{constructor(t,e,i){super(),this._manager=t,this._volume=void 0!==i.volume?k.clamp(Number(i.volume)||0,0,1):1,this._pitch=void 0!==i.pitch?Math.max(.01,Number(i.pitch)||0):1,this._loop=!(void 0===i.loop||!i.loop),this._sound=e,this._state=2,this._suspended=!1,this._suspendEndEvent=!1,this._suspendInstanceEvents=!1,this._playWhenLoaded=!0,this._startTime=Math.max(0,Number(i.startTime)||0),this._duration=Math.max(0,Number(i.duration)||0),this._startOffset=null,this.source=null,this._onPlayCallback=i.onPlay,this._onPauseCallback=i.onPause,this._onResumeCallback=i.onResume,this._onStopCallback=i.onStop,this._onEndCallback=i.onEnd,qr()?(this._startedAt=0,this._currentTime=0,this._currentOffset=0,this._inputNode=null,this._connectorNode=null,this._firstNode=null,this._lastNode=null,this._initializeNodes(),this._endedHandler=this._onEnded.bind(this)):(this._isReady=!1,this._loadedMetadataHandler=this._onLoadedMetadata.bind(this),this._timeUpdateHandler=this._onTimeUpdate.bind(this),this._endedHandler=this._onEnded.bind(this),this._createSource())}_onPlay(){this.fire("play"),this._onPlayCallback&&this._onPlayCallback(this)}_onPause(){this.fire("pause"),this._onPauseCallback&&this._onPauseCallback(this)}_onResume(){this.fire("resume"),this._onResumeCallback&&this._onResumeCallback(this)}_onStop(){this.fire("stop"),this._onStopCallback&&this._onStopCallback(this)}_onEnded(){this._suspendEndEvent?this._suspendEndEvent=!1:(this.fire("end"),this._onEndCallback&&this._onEndCallback(this),this.stop())}_onManagerVolumeChange(){this.volume=this._volume}_onManagerSuspend(){0!==this._state||this._suspended||(this._suspended=!0,this.pause())}_onManagerResume(){this._suspended&&(this._suspended=!1,this.resume())}get loop(){return this._loop}set loop(t){this._loop=!!t,this.source&&(this.source.loop=this._loop)}get startTime(){return this._startTime}set startTime(t){this._startTime=Math.max(0,Number(t)||0);const e=0===this._state;this.stop(),e&&this.play()}get duration(){return this._sound?this._duration?Ad(this._duration,this._sound.duration):this._sound.duration:0}set duration(t){this._duration=Math.max(0,Number(t)||0);const e=0===this._state;this.stop(),e&&this.play()}get isPlaying(){return 0===this._state}get isPaused(){return 1===this._state}get isStopped(){return 2===this._state}get isSuspended(){return this._suspended}}qr()?(Object.assign(Cd.prototype,{_initializeNodes:function(){this.gain=this._manager.context.createGain(),this._inputNode=this.gain,this._connectorNode=this.gain,this._connectorNode.connect(this._manager.context.destination)},play:function(){2!==this._state&&this.stop(),this.source||this._createSource();let t=Ad(this._startOffset,this.duration);return t=Ad(this._startTime+t,this._sound.duration),this._startOffset=null,this._duration?this.source.start(0,t,this._duration):this.source.start(0,t),this._startedAt=this._manager.context.currentTime,this._currentTime=0,this._currentOffset=t,this._state=0,this._playWhenLoaded=!1,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._manager.on("volumechange",this._onManagerVolumeChange,this),this._manager.on("suspend",this._onManagerSuspend,this),this._manager.on("resume",this._onManagerResume,this),this._manager.on("destroy",this._onManagerDestroy,this),this._manager.suspended&&this._onManagerSuspend(),this._suspendInstanceEvents||this._onPlay(),!0},pause:function(){return!(0!==this._state||!this.source)&&(this._updateCurrentTime(),this._state=1,this._suspendEndEvent=!0,this.source.stop(0),this.source=null,this._playWhenLoaded=!1,this._startOffset=null,this._suspendInstanceEvents||this._onPause(),!0)},resume:function(){if(1!==this._state)return!1;this.source||this._createSource();let t=this.currentTime;return null!==this._startOffset&&(t=Ad(this._startOffset,this.duration),t=Ad(this._startTime+t,this._sound.duration),this._startOffset=null),this._duration?this.source.start(0,t,this._duration):this.source.start(0,t),this._state=0,this._startedAt=this._manager.context.currentTime,this._currentOffset=t,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._playWhenLoaded=!1,this._suspendInstanceEvents||this._onResume(),!0},stop:function(){return!(2===this._state||!this.source)&&(this._manager.off("volumechange",this._onManagerVolumeChange,this),this._manager.off("suspend",this._onManagerSuspend,this),this._manager.off("resume",this._onManagerResume,this),this._manager.off("destroy",this._onManagerDestroy,this),this._startedAt=0,this._currentTime=0,this._currentOffset=0,this._startOffset=null,this._playWhenLoaded=!1,this._suspendEndEvent=!0,0===this._state&&this.source.stop(0),this.source=null,this._state=2,this._suspendInstanceEvents||this._onStop(),!0)},setExternalNodes:function(t,e){if(!t)return void console.error("The firstNode must be a valid Audio Node");e||(e=t);const i=this._manager.context.destination;this._firstNode!==t&&(this._firstNode?this._connectorNode.disconnect(this._firstNode):this._connectorNode.disconnect(i),this._firstNode=t,this._connectorNode.connect(t)),this._lastNode!==e&&(this._lastNode&&this._lastNode.disconnect(i),this._lastNode=e,this._lastNode.connect(i))},clearExternalNodes:function(){const t=this._manager.context.destination;this._firstNode&&(this._connectorNode.disconnect(this._firstNode),this._firstNode=null),this._lastNode&&(this._lastNode.disconnect(t),this._lastNode=null),this._connectorNode.connect(t)},getExternalNodes:function(){return[this._firstNode,this._lastNode]},_createSource:function(){if(!this._sound)return null;const t=this._manager.context;return this._sound.buffer&&(this.source=t.createBufferSource(),this.source.buffer=this._sound.buffer,this.source.connect(this._inputNode),this.source.onended=this._endedHandler,this.source.loopStart=Ad(this._startTime,this.source.buffer.duration),this._duration&&(this.source.loopEnd=Math.max(this.source.loopStart,Ad(this._startTime+this._duration,this.source.buffer.duration)))),this.source},_updateCurrentTime:function(){this._currentTime=Ad((this._manager.context.currentTime-this._startedAt)*this._pitch+this._currentOffset,this.duration)},_onManagerDestroy:function(){this.source&&0===this._state&&(this.source.stop(0),this.source=null)}}),Object.defineProperty(Cd.prototype,"volume",{get:function(){return this._volume},set:function(t){t=k.clamp(t,0,1),this._volume=t,this.gain&&(this.gain.gain.value=t*this._manager.volume)}}),Object.defineProperty(Cd.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._currentOffset=this.currentTime,this._startedAt=this._manager.context.currentTime,this._pitch=Math.max(Number(t)||0,.01),this.source&&(this.source.playbackRate.value=this._pitch)}}),Object.defineProperty(Cd.prototype,"sound",{get:function(){return this._sound},set:function(t){this._sound=t,2!==this._state?this.stop():this._createSource()}}),Object.defineProperty(Cd.prototype,"currentTime",{get:function(){return null!==this._startOffset?this._startOffset:1===this._state?this._currentTime:2!==this._state&&this.source?(this._updateCurrentTime(),this._currentTime):0},set:function(t){if(!(t<0))if(0===this._state){this.stop();const e=this._suspendInstanceEvents;this._suspendInstanceEvents=!0,this._startOffset=t,this.play(),this._suspendInstanceEvents=e}else this._startOffset=t,this._currentTime=t}})):(Object.assign(Cd.prototype,{play:function(){return 2!==this._state&&this.stop(),!(!this.source&&!this._createSource())&&(this.volume=this._volume,this.pitch=this._pitch,this.loop=this._loop,this.source.play(),this._state=0,this._playWhenLoaded=!1,this._manager.on("volumechange",this._onManagerVolumeChange,this),this._manager.on("suspend",this._onManagerSuspend,this),this._manager.on("resume",this._onManagerResume,this),this._manager.on("destroy",this._onManagerDestroy,this),this._manager.suspended&&this._onManagerSuspend(),this._suspendInstanceEvents||this._onPlay(),!0)},pause:function(){return!(!this.source||0!==this._state)&&(this._suspendEndEvent=!0,this.source.pause(),this._playWhenLoaded=!1,this._state=1,this._startOffset=null,this._suspendInstanceEvents||this._onPause(),!0)},resume:function(){return!(!this.source||1!==this._state)&&(this._state=0,this._playWhenLoaded=!1,this.source.paused&&(this.source.play(),this._suspendInstanceEvents||this._onResume()),!0)},stop:function(){return!(!this.source||2===this._state)&&(this._manager.off("volumechange",this._onManagerVolumeChange,this),this._manager.off("suspend",this._onManagerSuspend,this),this._manager.off("resume",this._onManagerResume,this),this._manager.off("destroy",this._onManagerDestroy,this),this._suspendEndEvent=!0,this.source.pause(),this._playWhenLoaded=!1,this._state=2,this._startOffset=null,this._suspendInstanceEvents||this._onStop(),!0)},setExternalNodes:function(){},clearExternalNodes:function(){},getExternalNodes:function(){return[null,null]},_onLoadedMetadata:function(){this.source.removeEventListener("loadedmetadata",this._loadedMetadataHandler),this._isReady=!0;let t=Ad(this._startOffset,this.duration);t=Ad(this._startTime+t,this._sound.duration),this._startOffset=null,this.source.currentTime=t},_createSource:function(){return this._sound&&this._sound.audio&&(this._isReady=!1,this.source=this._sound.audio.cloneNode(!0),this.source.addEventListener("loadedmetadata",this._loadedMetadataHandler),this.source.addEventListener("timeupdate",this._timeUpdateHandler),this.source.onended=this._endedHandler),this.source},_onTimeUpdate:function(){this._duration&&this.source.currentTime>Ad(this._startTime+this._duration,this.source.duration)&&(this.loop?this.source.currentTime=Ad(this._startTime,this.source.duration):(this.source.removeEventListener("timeupdate",this._timeUpdateHandler),this.source.pause(),this._onEnded()))},_onManagerDestroy:function(){this.source&&this.source.pause()}}),Object.defineProperty(Cd.prototype,"volume",{get:function(){return this._volume},set:function(t){t=k.clamp(t,0,1),this._volume=t,this.source&&(this.source.volume=t*this._manager.volume)}}),Object.defineProperty(Cd.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch=Math.max(Number(t)||0,.01),this.source&&(this.source.playbackRate=this._pitch)}}),Object.defineProperty(Cd.prototype,"sound",{get:function(){return this._sound},set:function(t){this.stop(),this._sound=t}}),Object.defineProperty(Cd.prototype,"currentTime",{get:function(){return null!==this._startOffset?this._startOffset:2!==this._state&&this.source?this.source.currentTime-this._startTime:0},set:function(t){t<0||(this._startOffset=t,this.source&&this._isReady&&(this.source.currentTime=Ad(this._startTime+Ad(t,this.duration),this._sound.duration),this._startOffset=null))}}));class Id extends Cd{constructor(t,e,i){super(t,e,i),i=i||{},this._position=new H,i.position&&(this.position=i.position),this._velocity=new H,i.velocity&&(this.velocity=i.velocity),this.maxDistance=void 0!==i.maxDistance?Number(i.maxDistance):1e4,this.refDistance=void 0!==i.refDistance?Number(i.refDistance):1,this.rollOffFactor=void 0!==i.rollOffFactor?Number(i.rollOffFactor):1,this.distanceModel=void 0!==i.distanceModel?i.distanceModel:"linear"}}if(qr())Object.assign(Id.prototype,{_initializeNodes:function(){this.gain=this._manager.context.createGain(),this.panner=this._manager.context.createPanner(),this.panner.connect(this.gain),this._inputNode=this.panner,this._connectorNode=this.gain,this._connectorNode.connect(this._manager.context.destination)}}),Object.defineProperty(Id.prototype,"position",{get:function(){return this._position},set:function(t){this._position.copy(t),this.panner.setPosition(t.x,t.y,t.z)}}),Object.defineProperty(Id.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity.copy(t),this.panner.setVelocity(t.x,t.y,t.z)}}),Object.defineProperty(Id.prototype,"maxDistance",{get:function(){return this.panner.maxDistance},set:function(t){this.panner.maxDistance=t}}),Object.defineProperty(Id.prototype,"refDistance",{get:function(){return this.panner.refDistance},set:function(t){this.panner.refDistance=t}}),Object.defineProperty(Id.prototype,"rollOffFactor",{get:function(){return this.panner.rolloffFactor},set:function(t){this.panner.rolloffFactor=t}}),Object.defineProperty(Id.prototype,"distanceModel",{get:function(){return this.panner.distanceModel},set:function(t){this.panner.distanceModel=t}});else{let t=new H;const e=function(e,i,n,r,s,a){t=t.sub2(e,i);const o=t.length();if(o<n)return 1;if(o>r)return 0;let l=0;return"linear"===a?l=1-s*(o-n)/(r-n):"inverse"===a?l=n/(n+s*(o-n)):"exponential"===a&&(l=Math.pow(o/n,-s)),k.clamp(l,0,1)};Object.defineProperty(Id.prototype,"position",{get:function(){return this._position},set:function(t){if(this._position.copy(t),this.source){const t=this._manager.listener.getPosition(),i=e(t,this._position,this.refDistance,this.maxDistance,this.rollOffFactor,this.distanceModel),n=this.volume;this.source.volume=n*i*this._manager.volume}}}),Object.defineProperty(Id.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity.copy(t)}}),Object.defineProperty(Id.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t}}),Object.defineProperty(Id.prototype,"refDistance",{get:function(){return this._refDistance},set:function(t){this._refDistance=t}}),Object.defineProperty(Id.prototype,"rollOffFactor",{get:function(){return this._rollOffFactor},set:function(t){this._rollOffFactor=t}}),Object.defineProperty(Id.prototype,"distanceModel",{get:function(){return this._distanceModel},set:function(t){this._distanceModel=t}})}var Sd={volume:0,pitch:0,loop:!1,startTime:0,duration:0,position:new H,maxDistance:0,refDistance:0,rollOffFactor:0,distanceModel:0,onPlay:null,onPause:null,onResume:null,onStop:null,onEnd:null};class Md extends v{constructor(t,e,i){super(),this._component=t,this._assets=t.system.app.assets,this._manager=t.system.manager,this.name=e||"Untitled",i=i||{},this._volume=void 0!==i.volume?k.clamp(Number(i.volume)||0,0,1):1,this._pitch=void 0!==i.pitch?Math.max(.01,Number(i.pitch)||0):1,this._loop=!(void 0===i.loop||!i.loop),this._duration=i.duration>0?i.duration:null,this._startTime=Math.max(0,Number(i.startTime)||0),this._overlap=!!i.overlap,this._autoPlay=!!i.autoPlay,this._firstNode=null,this._lastNode=null,this._asset=i.asset,this._asset instanceof As&&(this._asset=this._asset.id),this._onInstancePlayHandler=this._onInstancePlay.bind(this),this._onInstancePauseHandler=this._onInstancePause.bind(this),this._onInstanceResumeHandler=this._onInstanceResume.bind(this),this._onInstanceStopHandler=this._onInstanceStop.bind(this),this._onInstanceEndHandler=this._onInstanceEnd.bind(this),this.instances=[]}play(){if(this.overlap||this.stop(),this.isLoaded||this._hasAsset()){var t=this._createInstance();if(this.instances.push(t),this.isLoaded)t.play();else{var e=function(e){var i=t._playWhenLoaded;t.sound=e,i&&t.play()};this.off("load",e),this.once("load",e),this.load()}return t}}pause(){for(var t=!1,e=this.instances,i=0,n=e.length;i<n;i++)e[i].pause()&&(t=!0);return t}resume(){for(var t=!1,e=this.instances,i=0,n=e.length;i<n;i++)e[i].resume()&&(t=!0);return t}stop(){for(var t=!1,e=this.instances,i=e.length;i--;)e[i].stop(),t=!0;return e.length=0,t}load(){if(this._hasAsset()){var t=this._assets.get(this._asset);if(!t)return this._assets.off("add:"+this._asset,this._onAssetAdd,this),void this._assets.once("add:"+this._asset,this._onAssetAdd,this);if(t.off("remove",this._onAssetRemoved,this),t.on("remove",this._onAssetRemoved,this),!t.resource)return t.off("load",this._onAssetLoad,this),t.once("load",this._onAssetLoad,this),void this._assets.load(t);this.fire("load",t.resource)}}setExternalNodes(t,e){if(t){if(e||(e=t),this._firstNode=t,this._lastNode=e,!this._overlap)for(var i=this.instances,n=0,r=i.length;n<r;n++)i[n].setExternalNodes(t,e)}else console.error("The firstNode must have a valid AudioNode")}clearExternalNodes(){if(this._firstNode=null,this._lastNode=null,!this._overlap)for(var t=this.instances,e=0,i=t.length;e<i;e++)t[e].clearExternalNodes()}getExternalNodes(){return[this._firstNode,this._lastNode]}_hasAsset(){return null!=this._asset}_createInstance(){var t=null,e=this._component,i=null;if(this._hasAsset()){var n=this._assets.get(this._asset);n&&(i=n.resource)}var r=Sd;return r.volume=this._volume*e.volume,r.pitch=this._pitch*e.pitch,r.loop=this._loop,r.startTime=this._startTime,r.duration=this._duration,r.onPlay=this._onInstancePlayHandler,r.onPause=this._onInstancePauseHandler,r.onResume=this._onInstanceResumeHandler,r.onStop=this._onInstanceStopHandler,r.onEnd=this._onInstanceEndHandler,e.positional?(r.position.copy(e.entity.getPosition()),r.maxDistance=e.maxDistance,r.refDistance=e.refDistance,r.rollOffFactor=e.rollOffFactor,r.distanceModel=e.distanceModel,t=new Id(this._manager,i,r)):t=new Cd(this._manager,i,r),this._firstNode&&t.setExternalNodes(this._firstNode,this._lastNode),t}_onInstancePlay(t){this.fire("play",t),this._component.fire("play",this,t)}_onInstancePause(t){this.fire("pause",t),this._component.fire("pause",this,t)}_onInstanceResume(t){this.fire("resume",t),this._component.fire("resume",this,t)}_onInstanceStop(t){var e=this.instances.indexOf(t);-1!==e&&this.instances.splice(e,1),this.fire("stop",t),this._component.fire("stop",this,t)}_onInstanceEnd(t){var e=this.instances.indexOf(t);-1!==e&&this.instances.splice(e,1),this.fire("end",t),this._component.fire("end",this,t)}_onAssetAdd(t){this.load()}_onAssetLoad(t){this.load()}_onAssetRemoved(t){t.off("remove",this._onAssetRemoved,this),this._assets.off("add:"+t.id,this._onAssetAdd,this),this.stop()}updatePosition(t){for(var e=this.instances,i=0,n=e.length;i<n;i++)e[i].position=t}get volume(){return this._volume}set volume(t){if(this._volume=k.clamp(Number(t)||0,0,1),!this._overlap)for(var e=this.instances,i=0,n=e.length;i<n;i++)e[i].volume=this._volume*this._component.volume}get pitch(){return this._pitch}set pitch(t){if(this._pitch=Math.max(Number(t)||0,.01),!this._overlap)for(var e=this.instances,i=0,n=e.length;i<n;i++)e[i].pitch=this.pitch*this._component.pitch}get loop(){return this._loop}set loop(t){this._loop=!!t;for(var e=this.instances,i=0,n=e.length;i<n;i++)e[i].loop=this._loop}get autoPlay(){return this._autoPlay}set autoPlay(t){this._autoPlay=!!t}get overlap(){return this._overlap}set overlap(t){this._overlap=!!t}get startTime(){return this._startTime}set startTime(t){if(this._startTime=Math.max(0,Number(t)||0),!this._overlap)for(var e=this.instances,i=0,n=e.length;i<n;i++)e[i].startTime=this._startTime}get duration(){var t=0;if(this._hasAsset()){var e=this._assets.get(this._asset);t=e.resource?e.resource.duration:0}return null!=this._duration?this._duration%(t||1):t}set duration(t){if(this._duration=Math.max(0,Number(t)||0)||null,!this._overlap)for(var e=this.instances,i=0,n=e.length;i<n;i++)e[i].duration=this._duration}get asset(){return this._asset}set asset(t){var e=this._asset;if(e){this._assets.off("add:"+e,this._onAssetAdd,this);var i=this._assets.get(e);i&&i.off("remove",this._onAssetRemoved,this)}this._asset=t,this._asset instanceof As&&(this._asset=this._asset.id),this._hasAsset()&&this._component.enabled&&this._component.entity.enabled&&this.load()}get isLoaded(){if(this._hasAsset()){var t=this._assets.get(this._asset);if(t)return!!t.resource}return!1}get isPlaying(){for(var t=this.instances,e=0,i=t.length;e<i;e++)if(t[e].isPlaying)return!0;return!1}get isPaused(){var t=this.instances,e=t.length;if(0===e)return!1;for(var i=0;i<e;i++)if(!t[i].isPaused)return!1;return!0}get isStopped(){for(var t=this.instances,e=0,i=t.length;e<i;e++)if(!t[e].isStopped)return!1;return!0}}class Td extends Cl{constructor(t,e){super(t,e),this._volume=1,this._pitch=1,this._positional=!0,this._refDistance=1,this._maxDistance=1e4,this._rollOffFactor=1,this._distanceModel="linear",this._slots={},this._playingBeforeDisable={}}get positional(){return this._positional}set positional(t){this._positional=t;var e=this._slots;for(var i in e){var n=e[i];if(!n.overlap)for(var r=n.instances,s=r.length-1;s>=0;s--){var a=r[s].isPlaying||r[s].isSuspended,o=r[s].currentTime;a&&r[s].stop();var l=n._createInstance();a&&(l.play(),l.currentTime=o),r.push(l)}}}get slots(){return this._slots}set slots(t){var e,i=this._slots;if(i)for(e in i)i[e].stop();var n={};for(e in t)t[e]instanceof Md?n[t[e].name]=t[e]:t[e].name&&(n[t[e].name]=new Md(this,t[e].name,t[e]));this._slots=n,this.enabled&&this.entity.enabled&&this.onEnable()}onEnable(){if(!this.system._inTools){var t=this._slots,e=this._playingBeforeDisable;for(var i in t){var n=t[i];n.autoPlay&&n.isStopped?n.play():e[i]?n.resume():n.isLoaded||n.load()}}}onDisable(){var t=this._slots,e={};for(var i in t)t[i].overlap||t[i].isPlaying&&(t[i].pause(),e[i]=!0);this._playingBeforeDisable=e}onRemove(){this.off()}addSlot(t,e){var i=this._slots;if(i[t])return null;var n=new Md(this,t,e);return i[t]=n,n.autoPlay&&this.enabled&&this.entity.enabled&&n.play(),n}removeSlot(t){var e=this._slots;e[t]&&(e[t].stop(),delete e[t])}slot(t){return this._slots[t]}play(t){if(!this.enabled||!this.entity.enabled)return null;var e=this._slots[t];return e?e.play():null}pause(t){var e,i=this._slots;if(t){if(!(e=i[t]))return;e.pause()}else for(var n in i)i[n].pause()}resume(t){var e=this._slots;if(t){var i=e[t];if(!i)return;i.isPaused&&i.resume()}else for(var n in e)e[n].resume()}stop(t){var e=this._slots;if(t){var i=e[t];if(!i)return;i.stop()}else for(var n in e)e[n].stop()}}function Pd(t,e){Object.defineProperty(Td.prototype,t,{get:function(){return this[e]},set:function(i){this[e]=i;var n=this._slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,l=a.length;o<l;o++)a[o][t]=i}}})}function Ed(t,e){Object.defineProperty(Td.prototype,t,{get:function(){return this[e]},set:function(i){this[e]=i;var n=this._slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,l=a.length;o<l;o++)a[o][t]=s[t]*i}}})}Ed("pitch","_pitch"),Ed("volume","_volume"),Pd("refDistance","_refDistance"),Pd("maxDistance","_maxDistance"),Pd("rollOffFactor","_rollOffFactor"),Pd("distanceModel","_distanceModel");class kd{constructor(){this.enabled=!0}}const Dd=["enabled"];class Od extends Il{constructor(t,e){super(t),this.id="sound",this.ComponentType=Td,this.DataType=kd,this.schema=Dd,this.manager=e,Il.bind("update",this.onUpdate,this),this.on("beforeremove",this.onBeforeRemove,this)}initializeComponentData(t,e,i){i=["volume","pitch","positional","refDistance","maxDistance","rollOffFactor","distanceModel","slots"];for(var n=0;n<i.length;n++)e.hasOwnProperty(i[n])&&(t[i[n]]=e[i[n]]);super.initializeComponentData(t,e,["enabled"])}cloneComponent(t,e){var i=t.sound,n=i.slots,r={};for(var s in n){var a=n[s];r[s]={name:a.name,volume:a.volume,pitch:a.pitch,loop:a.loop,duration:a.duration,startTime:a.startTime,overlap:a.overlap,autoPlay:a.autoPlay,asset:a.asset}}var o={distanceModel:i.distanceModel,enabled:i.enabled,maxDistance:i.maxDistance,pitch:i.pitch,positional:i.positional,refDistance:i.refDistance,rollOffFactor:i.rollOffFactor,slots:r,volume:i.volume};return this.addComponent(e,o)}onUpdate(t){var e=this.store;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i].entity;if(n.enabled){var r=n.sound;if(r.enabled&&r.positional){var s=n.getPosition(),a=r.slots;for(var o in a)a[o].updatePosition(s)}}}}onBeforeRemove(t,e){var i=e.slots;for(var n in i)i[n].overlap||i[n].stop();e.onRemove()}get volume(){return this.manager.volume}set volume(t){this.manager.volume=t}get context(){return qr()?this.manager.context:null}}Cl._buildAccessors(Td.prototype,Dd);class Rd extends v{constructor(t,e){super(),this._component=t,this._frame=0,this._sprite=null,this._spriteAsset=null,this.spriteAsset=e.spriteAsset,this.name=e.name,this.fps=e.fps||0,this.loop=e.loop||!1,this._playing=!1,this._paused=!1,this._time=0}_onSpriteAssetAdded(t){this._component.system.app.assets.off("add:"+t.id,this._onSpriteAssetAdded,this),this._spriteAsset===t.id&&this._bindSpriteAsset(t)}_bindSpriteAsset(t){t.on("load",this._onSpriteAssetLoad,this),t.on("remove",this._onSpriteAssetRemove,this),t.resource?this._onSpriteAssetLoad(t):this._component.system.app.assets.load(t)}_unbindSpriteAsset(t){t.off("load",this._onSpriteAssetLoad,this),t.off("remove",this._onSpriteAssetRemove,this),t.resource&&t.resource.atlas&&this._component.system.app.assets.off("load:"+t.data.textureAtlasAsset,this._onTextureAtlasLoad,this)}_onSpriteAssetLoad(t){if(t.resource)if(t.resource.atlas)this.sprite=t.resource;else{var e=t.data.textureAtlasAsset,i=this._component.system.app.assets;i.off("load:"+e,this._onTextureAtlasLoad,this),i.once("load:"+e,this._onTextureAtlasLoad,this)}else this.sprite=null}_onTextureAtlasLoad(t){var e=this._spriteAsset;e instanceof As?this._onSpriteAssetLoad(e):this._onSpriteAssetLoad(this._component.system.app.assets.get(e))}_onSpriteAssetRemove(t){this.sprite=null}_onSpriteMeshesChange(){this._component.currentClip===this&&this._component._showFrame(this.frame)}_onSpritePpuChanged(){this._component.currentClip===this&&0!==this.sprite.renderMode&&this._component._showFrame(this.frame)}_update(t){if(0!==this.fps&&this._playing&&!this._paused&&this._sprite){var e=this.fps<0?-1:1,i=this._time+t*this._component.speed*e,n=this.duration,r=i>n||i<0;this._setTime(i);var s=this.frame;(s=this._sprite?Math.floor(this._sprite.frameKeys.length*this._time/n):0)!==this._frame&&this._setFrame(s),r&&(this.loop?(this.fire("loop"),this._component.fire("loop",this)):(this._playing=!1,this._paused=!1,this.fire("end"),this._component.fire("end",this)))}}_setTime(t){this._time=t;var e=this.duration;this._time<0?this.loop?this._time=this._time%e+e:this._time=0:this._time>e&&(this.loop?this._time%=e:this._time=e)}_setFrame(t){this._sprite?this._frame=k.clamp(t,0,this._sprite.frameKeys.length-1):this._frame=t,this._component.currentClip===this&&this._component._showFrame(this._frame)}_destroy(){this._sprite&&(this.sprite=null),this._spriteAsset&&(this.spriteAsset=null)}play(){this._playing||(this._playing=!0,this._paused=!1,this.frame=0,this.fire("play"),this._component.fire("play",this))}pause(){this._playing&&!this._paused&&(this._paused=!0,this.fire("pause"),this._component.fire("pause",this))}resume(){this._paused&&(this._paused=!1,this.fire("resume"),this._component.fire("resume",this))}stop(){this._playing&&(this._playing=!1,this._paused=!1,this._time=0,this.frame=0,this.fire("stop"),this._component.fire("stop",this))}get spriteAsset(){return this._spriteAsset}set spriteAsset(t){var e=this._component.system.app.assets,i=t;if(t instanceof As&&(i=t.id),this._spriteAsset!==i){if(this._spriteAsset){var n=e.get(this._spriteAsset);n&&this._unbindSpriteAsset(n)}if(this._spriteAsset=i,this._spriteAsset){var r=e.get(this._spriteAsset);r?this._bindSpriteAsset(r):(this.sprite=null,e.on("add:"+this._spriteAsset,this._onSpriteAssetAdded,this))}else this.sprite=null}}get sprite(){return this._sprite}set sprite(t){var e;(this._sprite&&(this._sprite.off("set:meshes",this._onSpriteMeshesChange,this),this._sprite.off("set:pixelsPerUnit",this._onSpritePpuChanged,this),this._sprite.off("set:atlas",this._onSpriteMeshesChange,this),this._sprite.atlas&&this._sprite.atlas.off("set:texture",this._onSpriteMeshesChange,this)),this._sprite=t,this._sprite&&(this._sprite.on("set:meshes",this._onSpriteMeshesChange,this),this._sprite.on("set:pixelsPerUnit",this._onSpritePpuChanged,this),this._sprite.on("set:atlas",this._onSpriteMeshesChange,this),this._sprite.atlas&&this._sprite.atlas.on("set:texture",this._onSpriteMeshesChange,this)),this._component.currentClip===this)&&(t&&t.atlas?(t.atlas.texture&&((e=this._component._meshInstance)&&(e.setParameter("texture_emissiveMap",t.atlas.texture),e.setParameter("texture_opacityMap",t.atlas.texture)),this._component.enabled&&this._component.entity.enabled&&this._component._showModel()),this.time&&this.fps?this.time=this.time:this.frame=this.frame):((e=this._component._meshInstance)&&(e.deleteParameter("texture_emissiveMap"),e.deleteParameter("texture_opacityMap")),this._component._hideModel()))}get frame(){return this._frame}set frame(t){this._setFrame(t);var e=this.fps||Number.MIN_VALUE;this._setTime(this._frame/e)}get isPlaying(){return this._playing}get isPaused(){return this._paused}get duration(){if(this._sprite){var t=this.fps||Number.MIN_VALUE;return this._sprite.frameKeys.length/Math.abs(t)}return 0}get time(){return this._time}set time(t){this._setTime(t),this._sprite?this.frame=Math.min(this._sprite.frameKeys.length-1,Math.floor(this._time*Math.abs(this.fps))):this.frame=0}}class Ld extends Cl{constructor(t,e){super(t,e),this._type="simple",this._material=t.defaultMaterial,this._color=new D(1,1,1,1),this._colorUniform=new Float32Array(3),this._speed=1,this._flipX=!1,this._flipY=!1,this._width=1,this._height=1,this._drawOrder=0,this._layers=[0],this._outerScale=new W(1,1),this._outerScaleUniform=new Float32Array(2),this._innerOffset=new X,this._innerOffsetUniform=new Float32Array(4),this._atlasRect=new X,this._atlasRectUniform=new Float32Array(4),this._batchGroupId=-1,this._batchGroup=null,this._node=new _i,this._model=new Ne,this._model.graph=this._node,this._meshInstance=null,e.addChild(this._model.graph),this._model._entity=e,this._updateAabbFunc=this._updateAabb.bind(this),this._addedModel=!1,this._autoPlayClip=null,this._clips={},this._defaultClip=new Rd(this,{name:this.entity.name,fps:0,loop:!1,spriteAsset:null}),this._currentClip=this._defaultClip}onEnable(){var t=this.system.app,e=t.scene;e.on("set:layers",this._onLayersChanged,this),e.layers&&(e.layers.on("add",this._onLayerAdded,this),e.layers.on("remove",this._onLayerRemoved,this)),this._showModel(),this._autoPlayClip&&this._tryAutoPlay(),this._batchGroupId>=0&&t.batcher.insert(Be.SPRITE,this._batchGroupId,this.entity)}onDisable(){var t=this.system.app,e=t.scene;e.off("set:layers",this._onLayersChanged,this),e.layers&&(e.layers.off("add",this._onLayerAdded,this),e.layers.off("remove",this._onLayerRemoved,this)),this.stop(),this._hideModel(),this._batchGroupId>=0&&t.batcher.remove(Be.SPRITE,this._batchGroupId,this.entity)}onDestroy(){for(var t in this._currentClip=null,this._defaultClip&&(this._defaultClip._destroy(),this._defaultClip=null),this._clips)this._clips[t]._destroy();this._clips=null,this._hideModel(),this._model=null,this._node&&(this._node.parent&&this._node.parent.removeChild(this._node),this._node=null),this._meshInstance&&(this._meshInstance.material=null,this._meshInstance.mesh=null,this._meshInstance=null)}_showModel(){if(!this._addedModel&&this._meshInstance){var t,e,i=[this._meshInstance];for(t=0,e=this._layers.length;t<e;t++){var n=this.system.app.scene.layers.getLayerById(this._layers[t]);n&&n.addMeshInstances(i)}this._addedModel=!0}}_hideModel(){if(this._addedModel&&this._meshInstance){var t,e,i=[this._meshInstance];for(t=0,e=this._layers.length;t<e;t++){var n=this.system.app.scene.layers.getLayerById(this._layers[t]);n&&n.removeMeshInstances(i)}this._addedModel=!1}}_showFrame(t){if(this.sprite){var e=this.sprite.meshes[t];if(e){var i;if(i=1===this.sprite.renderMode?this.system.default9SlicedMaterialSlicedMode:2===this.sprite.renderMode?this.system.default9SlicedMaterialTiledMode:this.system.defaultMaterial,this._meshInstance||(this._meshInstance=new Ee(this._node,e,this._material),this._meshInstance.castShadow=!1,this._meshInstance.receiveShadow=!1,this._meshInstance.drawOrder=this._drawOrder,this._model.meshInstances.push(this._meshInstance),this._colorUniform[0]=this._color.r,this._colorUniform[1]=this._color.g,this._colorUniform[2]=this._color.b,this._meshInstance.setParameter("material_emissive",this._colorUniform),this._meshInstance.setParameter("material_opacity",this._color.a),this.enabled&&this.entity.enabled&&this._showModel()),this._meshInstance.material!==i&&(this._meshInstance.material=i),this._meshInstance.mesh!==e&&(this._meshInstance.mesh=e,this._meshInstance.visible=!0,this._meshInstance._aabbVer=-1),this.sprite.atlas&&this.sprite.atlas.texture?(this._meshInstance.setParameter("texture_emissiveMap",this.sprite.atlas.texture),this._meshInstance.setParameter("texture_opacityMap",this.sprite.atlas.texture)):(this._meshInstance.deleteParameter("texture_emissiveMap"),this._meshInstance.deleteParameter("texture_opacityMap")),!this.sprite.atlas||1!==this.sprite.renderMode&&2!==this.sprite.renderMode)this._meshInstance._updateAabbFunc=null;else{this._meshInstance._updateAabbFunc=this._updateAabbFunc;var n=this.sprite.atlas.frames[this.sprite.frameKeys[t]];if(n){var r=2/n.rect.z,s=2/n.rect.w;this._innerOffset.set(n.border.x*r,n.border.y*s,n.border.z*r,n.border.w*s);var a=this.sprite.atlas.texture;this._atlasRect.set(n.rect.x/a.width,n.rect.y/a.height,n.rect.z/a.width,n.rect.w/a.height)}else this._innerOffset.set(0,0,0,0);this._innerOffsetUniform[0]=this._innerOffset.x,this._innerOffsetUniform[1]=this._innerOffset.y,this._innerOffsetUniform[2]=this._innerOffset.z,this._innerOffsetUniform[3]=this._innerOffset.w,this._meshInstance.setParameter("innerOffset",this._innerOffsetUniform),this._atlasRectUniform[0]=this._atlasRect.x,this._atlasRectUniform[1]=this._atlasRect.y,this._atlasRectUniform[2]=this._atlasRect.z,this._atlasRectUniform[3]=this._atlasRect.w,this._meshInstance.setParameter("atlasRect",this._atlasRectUniform)}this._updateTransform()}else this._meshInstance&&(this._meshInstance.mesh=null,this._meshInstance.visible=!1)}}_updateTransform(){var t=this.flipX?-1:1,e=this.flipY?-1:1,i=0,n=0;if(this.sprite&&(1===this.sprite.renderMode||2===this.sprite.renderMode)){var r=1,s=1;if(this.sprite.atlas){var a=this.sprite.atlas.frames[this.sprite.frameKeys[this.frame]];a&&(r=a.rect.z,s=a.rect.w,i=(.5-a.pivot.x)*this._width,n=(.5-a.pivot.y)*this._height)}var o=r/this.sprite.pixelsPerUnit,l=s/this.sprite.pixelsPerUnit;this._outerScale.set(Math.max(this._width,this._innerOffset.x*o),Math.max(this._height,this._innerOffset.y*l)),t*=o,e*=l,this._outerScale.x/=o,this._outerScale.y/=l,t*=k.clamp(this._width/(this._innerOffset.x*o),1e-4,1),e*=k.clamp(this._height/(this._innerOffset.y*l),1e-4,1),this._meshInstance&&(this._outerScaleUniform[0]=this._outerScale.x,this._outerScaleUniform[1]=this._outerScale.y,this._meshInstance.setParameter("outerScale",this._outerScaleUniform))}this._node.setLocalScale(t,e,1),this._node.setLocalPosition(i,n,0)}_updateAabb(t){return t.center.set(0,0,0),t.halfExtents.set(.5*this._outerScale.x,.5*this._outerScale.y,.001),t.setFromTransformedAabb(t,this._node.getWorldTransform()),t}_tryAutoPlay(){if(this._autoPlayClip&&"animated"===this.type){var t=this._clips[this._autoPlayClip];!t||t.isPlaying||this._currentClip&&this._currentClip.isPlaying||this.enabled&&this.entity.enabled&&this.play(t.name)}}_onLayersChanged(t,e){t.off("add",this.onLayerAdded,this),t.off("remove",this.onLayerRemoved,this),e.on("add",this.onLayerAdded,this),e.on("remove",this.onLayerRemoved,this),this.enabled&&this.entity.enabled&&this._showModel()}_onLayerAdded(t){this.layers.indexOf(t.id)<0||this._addedModel&&this.enabled&&this.entity.enabled&&this._meshInstance&&t.addMeshInstances([this._meshInstance])}_onLayerRemoved(t){this._meshInstance&&(this.layers.indexOf(t.id)<0||t.removeMeshInstances([this._meshInstance]))}removeModelFromLayers(){for(var t,e=0;e<this.layers.length;e++)(t=this.system.app.scene.layers.getLayerById(this.layers[e]))&&t.removeMeshInstances([this._meshInstance])}addClip(t){var e=new Rd(this,{name:t.name,fps:t.fps,loop:t.loop,spriteAsset:t.spriteAsset});return this._clips[t.name]=e,e.name&&e.name===this._autoPlayClip&&this._tryAutoPlay(),e}removeClip(t){delete this._clips[t]}clip(t){return this._clips[t]}play(t){var e=this._clips[t],i=this._currentClip;return i&&i!==e&&(i._playing=!1),this._currentClip=e,this._currentClip&&(this._currentClip=e,this._currentClip.play()),e}pause(){this._currentClip!==this._defaultClip&&this._currentClip.isPlaying&&this._currentClip.pause()}resume(){this._currentClip!==this._defaultClip&&this._currentClip.isPaused&&this._currentClip.resume()}stop(){this._currentClip!==this._defaultClip&&this._currentClip.stop()}get type(){return this._type}set type(t){this._type!==t&&(this._type=t,"simple"===this._type?(this.stop(),this._currentClip=this._defaultClip,this.enabled&&this.entity.enabled&&(this._currentClip.frame=this.frame,this._currentClip.sprite?this._showModel():this._hideModel())):"animated"===this._type&&(this.stop(),this._autoPlayClip&&this._tryAutoPlay(),this._currentClip&&this._currentClip.isPlaying&&this.enabled&&this.entity.enabled?this._showModel():this._hideModel()))}get frame(){return this._currentClip.frame}set frame(t){this._currentClip.frame=t}get spriteAsset(){return this._defaultClip._spriteAsset}set spriteAsset(t){this._defaultClip.spriteAsset=t}get sprite(){return this._currentClip.sprite}set sprite(t){this._currentClip.sprite=t}get material(){return this._material}set material(t){this._material=t,this._meshInstance&&(this._meshInstance.material=t)}get color(){return this._color}set color(t){this._color.r=t.r,this._color.g=t.g,this._color.b=t.b,this._meshInstance&&(this._colorUniform[0]=this._color.r,this._colorUniform[1]=this._color.g,this._colorUniform[2]=this._color.b,this._meshInstance.setParameter("material_emissive",this._colorUniform))}get opacity(){return this._color.a}set opacity(t){this._color.a=t,this._meshInstance&&this._meshInstance.setParameter("material_opacity",t)}get clips(){return this._clips}set clips(t){var e,i;if(t){for(e in this._clips){var n=!1;for(i in t)if(t[i].name===e){n=!0,this._clips[e].fps=t[i].fps,this._clips[e].loop=t[i].loop,t[i].hasOwnProperty("sprite")?this._clips[e].sprite=t[i].sprite:t[i].hasOwnProperty("spriteAsset")&&(this._clips[e].spriteAsset=t[i].spriteAsset);break}n||this.removeClip(e)}for(i in t)this._clips[t[i].name]||this.addClip(t[i]);this._autoPlayClip&&this._tryAutoPlay(),this._currentClip&&this._currentClip.sprite||this._hideModel()}else for(e in this._clips)this.removeClip(e)}get currentClip(){return this._currentClip}get speed(){return this._speed}set speed(t){this._speed=t}get flipX(){return this._flipX}set flipX(t){this._flipX!==t&&(this._flipX=t,this._updateTransform())}get flipY(){return this._flipY}set flipY(t){this._flipY!==t&&(this._flipY=t,this._updateTransform())}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._outerScale.x=this._width,!this.sprite||2!==this.sprite.renderMode&&1!==this.sprite.renderMode||this._updateTransform())}get height(){return this._height}set height(t){t!==this._height&&(this._height=t,this._outerScale.y=this.height,!this.sprite||2!==this.sprite.renderMode&&1!==this.sprite.renderMode||this._updateTransform())}get batchGroupId(){return this._batchGroupId}set batchGroupId(t){if(this._batchGroupId!==t){var e=this._batchGroupId;this._batchGroupId=t,this.entity.enabled&&e>=0&&this.system.app.batcher.remove(Be.SPRITE,e,this.entity),this.entity.enabled&&t>=0?this.system.app.batcher.insert(Be.SPRITE,t,this.entity):e>=0&&this._currentClip&&this._currentClip.sprite&&this.enabled&&this.entity.enabled&&this._showModel()}}get autoPlayClip(){return this._autoPlayClip}set autoPlayClip(t){this._autoPlayClip=t instanceof Rd?t.name:t,this._tryAutoPlay()}get drawOrder(){return this._drawOrder}set drawOrder(t){this._drawOrder=t,this._meshInstance&&(this._meshInstance.drawOrder=t)}get layers(){return this._layers}set layers(t){this._addedModel&&this._hideModel(),this._layers=t,this._meshInstance&&this.enabled&&this.entity.enabled&&this._showModel()}get aabb(){return this._meshInstance?this._meshInstance.aabb:null}}class Nd{constructor(){this.enabled=!0}}const zd=["enabled"];class Bd extends Il{constructor(t){super(t),this.id="sprite",this.ComponentType=Ld,this.DataType=Nd,this.schema=zd,this._defaultTexture=null,this._defaultMaterial=null,this._default9SlicedMaterialSlicedMode=null,this._default9SlicedMaterialTiledMode=null,Il.bind("update",this.onUpdate,this),this.on("beforeremove",this.onBeforeRemove,this)}get defaultMaterial(){if(!this._defaultMaterial){var t=new pe(this.app.graphicsDevice,{width:1,height:1,format:7}),e=new Uint8Array(t.lock());e[0]=e[1]=e[2]=e[3]=255,t.name="sprite",t.unlock();var i=new af;i.diffuse.set(0,0,0),i.emissive.set(.5,.5,.5),i.emissiveMap=t,i.emissiveMapTint=!0,i.opacityMap=t,i.opacityMapChannel="a",i.opacityTint=!0,i.opacity=0,i.useLighting=!1,i.useGammaTonemap=!1,i.useFog=!1,i.useSkybox=!1,i.blendType=4,i.depthWrite=!1,i.pixelSnap=!1,i.cull=0,i.update(),this._defaultTexture=t,this._defaultMaterial=i}return this._defaultMaterial}set defaultMaterial(t){this._defaultMaterial=t}get default9SlicedMaterialSlicedMode(){if(!this._default9SlicedMaterialSlicedMode){var t=this.defaultMaterial.clone();t.nineSlicedMode=1,t.update(),this._default9SlicedMaterialSlicedMode=t}return this._default9SlicedMaterialSlicedMode}set default9SlicedMaterialSlicedMode(t){this._default9SlicedMaterialSlicedMode=t}get default9SlicedMaterialTiledMode(){if(!this._default9SlicedMaterialTiledMode){var t=this.defaultMaterial.clone();t.nineSlicedMode=2,t.update(),this._default9SlicedMaterialTiledMode=t}return this._default9SlicedMaterialTiledMode}set default9SlicedMaterialTiledMode(t){this._default9SlicedMaterialTiledMode=t}destroy(){this._defaultTexture&&(this._defaultTexture.destroy(),this._defaultTexture=null)}initializeComponentData(t,e,i){if(void 0!==e.enabled&&(t.enabled=e.enabled),t.type=e.type,e.layers&&Array.isArray(e.layers)&&(t.layers=e.layers.slice(0)),void 0!==e.drawOrder&&(t.drawOrder=e.drawOrder),void 0!==e.color&&(e.color instanceof D?t.color.set(e.color.r,e.color.g,e.color.b,void 0!==e.opacity?e.opacity:1):t.color.set(e.color[0],e.color[1],e.color[2],void 0!==e.opacity?e.opacity:1),t.color=t.color),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.flipX&&(t.flipX=e.flipX),void 0!==e.flipY&&(t.flipY=e.flipY),void 0!==e.width&&(t.width=e.width),void 0!==e.height&&(t.height=e.height),void 0!==e.spriteAsset&&(t.spriteAsset=e.spriteAsset),e.sprite&&(t.sprite=e.sprite),void 0!==e.frame&&(t.frame=e.frame),e.clips)for(var n in e.clips)t.addClip(e.clips[n]);void 0!==e.speed&&(t.speed=e.speed),e.autoPlayClip&&(t.autoPlayClip=e.autoPlayClip),t.batchGroupId=void 0===e.batchGroupId||null===e.batchGroupId?-1:e.batchGroupId,super.initializeComponentData(t,e,i)}cloneComponent(t,e){var i=t.sprite;return this.addComponent(e,{enabled:i.enabled,type:i.type,spriteAsset:i.spriteAsset,sprite:i.sprite,frame:i.frame,color:i.color.clone(),opacity:i.opacity,flipX:i.flipX,flipY:i.flipY,speed:i.speed,clips:i.clips,autoPlayClip:i.autoPlayClip,batchGroupId:i.batchGroupId,drawOrder:i.drawOrder,layers:i.layers.slice(0)})}onUpdate(t){var e=this.store;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(n.data.enabled&&n.entity.enabled){var r=n.entity.sprite;r._currentClip&&r._currentClip._update(t)}}}onBeforeRemove(t,e){e.onDestroy()}}Cl._buildAccessors(Ld.prototype,zd);class Fd extends Cl{constructor(t,e){super(t,e),this._oldState=!0,this._size=new H,this.on("set_enabled",this._onSetEnabled,this)}onEnable(){this._checkState()}onDisable(){this._checkState()}_onSetEnabled(t,e,i){this._checkState()}_checkState(){var t=this.enabled&&this.entity.enabled;t!==this._oldState&&(this._oldState=t,this.fire("enable"),this.fire("state",this.enabled))}_onBeforeRemove(){this.fire("remove")}set size(t){t instanceof H?this._size.copy(t):t instanceof Array&&t.length>=3&&this.size.set(t[0],t[1],t[2])}get size(){return this._size}}class jd{constructor(){this.enabled=!0}}const Vd=["enabled"];class Ud extends Il{constructor(t){super(t),this.id="zone",this.ComponentType=Fd,this.DataType=jd,this.schema=Vd,this.on("beforeremove",this._onBeforeRemove,this)}initializeComponentData(t,e,i){t.enabled=!e.hasOwnProperty("enabled")||!!e.enabled,e.size&&(e.size instanceof H?t.size.copy(e.size):e.size instanceof Array&&e.size.length>=3&&t.size.set(e.size[0],e.size[1],e.size[2]))}cloneComponent(t,e){var i={size:t.zone.size};return this.addComponent(e,i)}_onBeforeRemove(t,e){e._onBeforeRemove()}}Cl._buildAccessors(Fd.prototype,Vd);class Gd{constructor(t){this.frame={fps:0,ms:0,dt:0,updateStart:0,updateTime:0,renderStart:0,renderTime:0,physicsStart:0,physicsTime:0,cullTime:0,sortTime:0,skinTime:0,morphTime:0,instancingTime:0,triangles:0,otherPrimitives:0,shaders:0,materials:0,cameras:0,shadowMapUpdates:0,shadowMapTime:0,depthMapTime:0,forwardTime:0,_timeToCountFrames:0,_fpsAccum:0},this.drawCalls={forward:0,depth:0,shadow:0,immediate:0,misc:0,total:0,skinned:0,instanced:0,removedByInstancing:0},this.misc={renderTargetCreationTime:0},this.particles={updatesPerFrame:0,_updatesPerFrame:0,frameTime:0,_frameTime:0},this.shaders=t._shaderStats,this.vram=t._vram,Object.defineProperty(this.vram,"totalUsed",{get:function(){return this.tex+this.vb+this.ib}}),Object.defineProperty(this.vram,"geom",{get:function(){return this.vb+this.ib}})}get scene(){return qd.getApplication().scene._stats}get lightmapper(){return qd.getApplication().lightmapper._stats}get batcher(){return qd.getApplication().batcher._stats}}class Wd{constructor(t,e){this.name=t,this.url=e}}class Hd{constructor(t){this._app=t,this._list=[],this._index={},this._urlIndex={}}destroy(){this._app=null}list(){return this._list}add(t,e){if(this._index.hasOwnProperty(t))return!1;var i=new Wd(t,e),n=this._list.push(i);return this._index[i.name]=n-1,this._urlIndex[i.url]=n-1,!0}find(t){return this._index.hasOwnProperty(t)?this._list[this._index[t]]:null}findByUrl(t){return this._urlIndex.hasOwnProperty(t)?this._list[this._urlIndex[t]]:null}remove(t){if(this._index.hasOwnProperty(t)){var e=this._index[t],i=this._list[e];for(delete this._urlIndex[i.url],delete this._index[t],this._list.splice(e,1),e=0;e<this._list.length;e++)i=this._list[e],this._index[i.name]=e,this._urlIndex[i.url]=e}}loadSceneHierarchy(t,e){var i=this,n=this._app.loader.getHandler("hierarchy");this._app.assets&&this._app.assets.prefix&&!gs.test(t)&&(t=x.join(this._app.assets.prefix,t)),n.load(t,(function(r,s){if(r)e&&e(r);else{i._app._preloadScripts(s,(function(){i._app.systems.script.preloading=!0;var a=n.open(t,s);i._app.systems.script.preloading=!1,i._app.loader.clearCache(t,"hierarchy"),i._app.root.addChild(a),Il.initialize(a),Il.postInitialize(a),e&&e(r,a)}))}}))}loadSceneSettings(t,e){var i=this;this._app.assets&&this._app.assets.prefix&&!gs.test(t)&&(t=x.join(this._app.assets.prefix,t)),this._app.loader.load(t,"scenesettings",(function(t,n){t?e&&e(t):(i._app.applySceneSettings(n),e&&e(null))}))}loadScene(t,e){var i=this,n=this._app.loader.getHandler("scene");this._app.assets&&this._app.assets.prefix&&!gs.test(t)&&(t=x.join(this._app.assets.prefix,t)),n.load(t,(function(r,s){if(r)e&&e(r);else{i._app._preloadScripts(s,(function(){i._app.systems.script.preloading=!0;var r=n.open(t,s);i._app.systems.script.preloading=!1,i._app.loader.clearCache(t,"scene"),i._app.loader.patch({resource:r,type:"scene"},i._app.assets),i._app.root.addChild(r.root),i._app.systems.rigidbody&&"undefined"!=typeof Ammo&&i._app.systems.rigidbody.gravity.set(r._gravity.x,r._gravity.y,r._gravity.z),e&&e(null,r)}))}}))}}class Xd{constructor(t){this.length=t,this.count=0}inc(){this.count++}done(){return this.count===this.length}}var Zd=!1,Yd=new _i;class qd extends v{constructor(t,e={}){super(),console.log("Powered by PlayCanvas 1.38.0 98cb89ec5"),qd._applications[t.id]=this,qd._currentApplication=this,this,this._time=0,this.timeScale=1,this.maxDeltaTime=.1,this.frame=0,this.autoRender=!0,this.renderNextFrame=!1,this.useLegacyScriptAttributeCloning=eo.legacy,this._librariesLoaded=!1,this._fillMode="KEEP_ASPECT",this._resolutionMode="FIXED",this._allowResize=!0,this.context=this,e.graphicsDeviceOptions||(e.graphicsDeviceOptions={}),e.graphicsDeviceOptions.xrCompatible=!0,e.graphicsDeviceOptions.alpha=e.graphicsDeviceOptions.alpha||!1,this.graphicsDevice=new wf(t,e.graphicsDeviceOptions),this.stats=new Gd(this.graphicsDevice),this._soundManager=new $r(e),this.loader=new Ka(this),this._entityIndex={},this.scene=new Zr,this.root=new ha(this),this.root._enabledInHierarchy=!0,this._enableList=[],this._enableList.size=0,this.assets=new Wo(this.loader),e.assetPrefix&&(this.assets.prefix=e.assetPrefix),this.bundles=new Ho(this.assets),this.enableBundles="undefined"!=typeof TextDecoder,this.scriptsOrder=e.scriptsOrder||[],this.scripts=new Xo(this),this.i18n=new ms(this),this.scenes=new Hd(this);var i=this;this.defaultLayerWorld=new Ii({name:"World",id:0}),this.graphicsDevice.webgl2?(this.defaultLayerDepth=new Ii({enabled:!1,name:"Depth",id:1,onEnable:function(){if(!this.renderTarget){var t=new pe(i.graphicsDevice,{format:17,width:i.graphicsDevice.width,height:i.graphicsDevice.height});t.name="rt-depth2",t.minFilter=0,t.magFilter=0,t.addressU=1,t.addressV=1,this.renderTarget=new Cf({colorBuffer:null,depthBuffer:t,autoResolve:!1}),i.graphicsDevice.scope.resolve("uDepthMap").setValue(t)}},onDisable:function(){this.renderTarget&&(this.renderTarget._depthBuffer.destroy(),this.renderTarget.destroy(),this.renderTarget=null)},onPreRenderOpaque:function(t){var e=i.graphicsDevice.gl;this.srcFbo=e.getParameter(e.FRAMEBUFFER_BINDING),this.renderTarget&&this.renderTarget.width===i.graphicsDevice.width&&this.renderTarget.height===i.graphicsDevice.height||(this.onDisable(),this.onEnable()),this.oldClear=this.cameras[t].camera._clearOptions,this.cameras[t].camera._clearOptions=this.depthClearOptions},onPostRenderOpaque:function(t){if(this.renderTarget){this.cameras[t].camera._clearOptions=this.oldClear;var e=i.graphicsDevice.gl;i.graphicsDevice.setRenderTarget(this.renderTarget),i.graphicsDevice.updateBegin(),e.bindFramebuffer(e.READ_FRAMEBUFFER,this.srcFbo),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.renderTarget._glFrameBuffer),e.blitFramebuffer(0,0,this.renderTarget.width,this.renderTarget.height,0,0,this.renderTarget.width,this.renderTarget.height,e.DEPTH_BUFFER_BIT,e.NEAREST)}}}),this.defaultLayerDepth.depthClearOptions={flags:0}):(this.defaultLayerDepth=new Ii({enabled:!1,name:"Depth",id:1,shaderPass:2,onEnable:function(){if(!this.renderTarget){var t=new pe(i.graphicsDevice,{format:7,width:i.graphicsDevice.width,height:i.graphicsDevice.height});t.name="rt-depth1",t.minFilter=0,t.magFilter=0,t.addressU=1,t.addressV=1,this.renderTarget=new Cf(i.graphicsDevice,t,{depth:!0,stencil:i.graphicsDevice.supportsStencil}),i.graphicsDevice.scope.resolve("uDepthMap").setValue(t)}},onDisable:function(){this.renderTarget&&(this.renderTarget._colorBuffer.destroy(),this.renderTarget.destroy(),this.renderTarget=null)},onPostCull:function(t){for(var e,n,r,s,a,o,l=this.instances.visibleOpaque[t],h=l.list,c=0,u=i.scene.layers.layerList,d=i.scene.layers.subLayerEnabled,f=i.scene.layers.subLayerList,p=i.scene.layers.getLayerById(0).renderTarget,m=this.cameras[t],g=0;g<u.length&&(e=u[g])!==this;g++)if(e.renderTarget===p&&e.enabled&&d[g]&&!((s=e.cameras.indexOf(m))<0))for(a=(r=f[g]?e.instances.visibleTransparent[s]:e.instances.visibleOpaque[s]).length,r=r.list,n=0;n<a;n++)(o=r[n]).material&&o.material.depthWrite&&!o._noDepthDrawGl1&&(h[c]=o,c++);l.length=c},onPreRenderOpaque:function(t){this.renderTarget&&this.renderTarget.width===i.graphicsDevice.width&&this.renderTarget.height===i.graphicsDevice.height||(this.onDisable(),this.onEnable()),this.oldClear=this.cameras[t].camera._clearOptions,this.cameras[t].camera._clearOptions=this.rgbaDepthClearOptions},onDrawCall:function(){i.graphicsDevice.setColorWrite(!0,!0,!0,!0)},onPostRenderOpaque:function(t){this.renderTarget&&(this.cameras[t].camera._clearOptions=this.oldClear)}}),this.defaultLayerDepth.rgbaDepthClearOptions={color:[254/255,254/255,254/255,254/255],depth:1,flags:3}),this.defaultLayerSkybox=new Ii({enabled:!1,name:"Skybox",id:2,opaqueSortMode:0}),this.defaultLayerUi=new Ii({enabled:!0,name:"UI",id:4,transparentSortMode:1,passThrough:!1}),this.defaultLayerImmediate=new Ii({enabled:!0,name:"Immediate",id:3,opaqueSortMode:0,passThrough:!0}),this.defaultLayerComposition=new Dn,this.defaultLayerComposition.pushOpaque(this.defaultLayerWorld),this.defaultLayerComposition.pushOpaque(this.defaultLayerDepth),this.defaultLayerComposition.pushOpaque(this.defaultLayerSkybox),this.defaultLayerComposition.pushTransparent(this.defaultLayerWorld),this.defaultLayerComposition.pushOpaque(this.defaultLayerImmediate),this.defaultLayerComposition.pushTransparent(this.defaultLayerImmediate),this.defaultLayerComposition.pushTransparent(this.defaultLayerUi),this.scene.layers=this.defaultLayerComposition,this._immediateLayer=this.defaultLayerImmediate,this.scene.on("set:layers",(function(t,e){for(var n,r=e.layerList,s=0;s<r.length;s++)switch((n=r[s]).id){case 1:n.onEnable=i.defaultLayerDepth.onEnable,n.onDisable=i.defaultLayerDepth.onDisable,n.onPreRenderOpaque=i.defaultLayerDepth.onPreRenderOpaque,n.onPostRenderOpaque=i.defaultLayerDepth.onPostRenderOpaque,n.depthClearOptions=i.defaultLayerDepth.depthClearOptions,n.rgbaDepthClearOptions=i.defaultLayerDepth.rgbaDepthClearOptions,n.shaderPass=i.defaultLayerDepth.shaderPass,n.onPostCull=i.defaultLayerDepth.onPostCull,n.onDrawCall=i.defaultLayerDepth.onDrawCall;break;case 4:n.passThrough=i.defaultLayerUi.passThrough;break;case 3:n.passThrough=i.defaultLayerImmediate.passThrough}})),this.renderer=new Sn(this.graphicsDevice),this.renderer.scene=this.scene,this.lightmapper=new Wn(this.graphicsDevice,this.root,this.scene,this.renderer,this.assets),this.once("prerender",this._firstBake,this),this.batcher=new Ze(this.graphicsDevice,this.root,this.scene),this.once("prerender",this._firstBatch,this),this.keyboard=e.keyboard||null,this.mouse=e.mouse||null,this.touch=e.touch||null,this.gamepads=e.gamepads||null,this.elementInput=e.elementInput||null,this.elementInput&&(this.elementInput.app=this),this.vr=null,this.xr=new Al(this),this.elementInput&&this.elementInput.attachSelectEvents(),this._inTools=!1,this._skyboxLast=0,this._scriptPrefix=e.scriptPrefix||"",this.enableBundles&&this.loader.addHandler("bundle",new la(this.assets)),this.loader.addHandler("animation",new Ys),this.loader.addHandler("animclip",new qs),this.loader.addHandler("animstategraph",new Js),this.loader.addHandler("model",new Wa(this.graphicsDevice,this.scene.defaultMaterial)),this.loader.addHandler("render",new qa(this.assets)),this.loader.addHandler("material",new Na(this)),this.loader.addHandler("texture",new Uo(this.graphicsDevice,this.assets,this.loader)),this.loader.addHandler("text",new fo),this.loader.addHandler("json",new Ma),this.loader.addHandler("audio",new ea(this._soundManager)),this.loader.addHandler("script",new io(this)),this.loader.addHandler("scene",new Ja(this)),this.loader.addHandler("cubemap",new fa(this.graphicsDevice,this.assets,this.loader)),this.loader.addHandler("html",new Sa),this.loader.addHandler("css",new da),this.loader.addHandler("shader",new no),this.loader.addHandler("hierarchy",new Ia(this)),this.loader.addHandler("scenesettings",new Qa(this)),this.loader.addHandler("folder",new pa),this.loader.addHandler("font",new va(this.loader)),this.loader.addHandler("binary",new ia),this.loader.addHandler("textureatlas",new _o(this.loader)),this.loader.addHandler("sprite",new ho(this.assets,this.graphicsDevice)),this.loader.addHandler("template",new uo(this)),this.loader.addHandler("container",new ua(this.graphicsDevice,this.scene.defaultMaterial)),this.systems=new Yh,this.systems.add(new Vu(this)),this.systems.add(new Zh(this)),this.systems.add(new Bl(this)),this.systems.add(new ih(this)),this.systems.add(new hu(this)),this.systems.add(new pu(this)),this.systems.add(new Th(this)),this.systems.add(new su(this)),eo.legacy?this.systems.add(new rd(this)):this.systems.add(new td(this)),this.systems.add(new ch(this,this._soundManager)),this.systems.add(new Od(this,this._soundManager)),this.systems.add(new ah(this,this._soundManager)),this.systems.add(new Au(this)),this.systems.add(new Xu(this)),this.systems.add(new Ic(this)),this.systems.add(new wh(this)),this.systems.add(new _d(this)),this.systems.add(new wd(this)),this.systems.add(new Bd(this)),this.systems.add(new Zc(this)),this.systems.add(new Ec(this)),this.systems.add(new Ud(this)),this._visibilityChangeHandler=this.onVisibilityChange.bind(this),"undefined"!=typeof document&&(void 0!==document.hidden?(this._hiddenAttr="hidden",document.addEventListener("visibilitychange",this._visibilityChangeHandler,!1)):void 0!==document.mozHidden?(this._hiddenAttr="mozHidden",document.addEventListener("mozvisibilitychange",this._visibilityChangeHandler,!1)):void 0!==document.msHidden?(this._hiddenAttr="msHidden",document.addEventListener("msvisibilitychange",this._visibilityChangeHandler,!1)):void 0!==document.webkitHidden&&(this._hiddenAttr="webkitHidden",document.addEventListener("webkitvisibilitychange",this._visibilityChangeHandler,!1))),this.meshInstanceArray=[],this.tick=Jd(this)}static getApplication(t){return t?qd._applications[t]:qd._currentApplication}get fillMode(){return this._fillMode}get resolutionMode(){return this._resolutionMode}configure(t,e){var i=this;F.get(t,(function(t,n){if(t)e(t);else{var r=n.application_properties,s=n.scenes,a=n.assets;i._parseApplicationProperties(r,(function(t){i._parseScenes(s),i._parseAssets(a),e(t||null)}))}}))}preload(t){var e,i,n=this;n.fire("preload:start");var r=this.assets.list({preload:!0}),s=new Xd(r.length),a=!1,o=function(){n.graphicsDevice&&!a&&s.done()&&(a=!0,n.fire("preload:end"),t())};i=r.length;var l=function(){return s.count};if(s.length){var h=function(t){s.inc(),n.fire("preload:progress",l()/i),s.done()&&o()},c=function(t,e){s.inc(),n.fire("preload:progress",l()/i),s.done()&&o()};for(e=0;e<r.length;e++)r[e].loaded?(s.inc(),n.fire("preload:progress",l()/i),s.done()&&o()):(r[e].once("load",h),r[e].once("error",c),this.assets.load(r[e]))}else o()}_preloadScripts(t,e){if(eo.legacy){var i=this;i.systems.script.preloading=!0;var n,r=this._getScriptReferences(t),s=0,a=r.length,o=new Xd(a),l=/^http(s)?:\/\//;if(a){var h=function(t,n){t&&console.error(t),o.inc(),o.done()&&(i.systems.script.preloading=!1,e())};for(s=0;s<a;s++)n=r[s],!l.test(n.toLowerCase())&&i._scriptPrefix&&(n=x.join(i._scriptPrefix,r[s])),this.loader.load(n,"script",h)}else i.systems.script.preloading=!1,e()}else e()}_parseApplicationProperties(t,e){var i,n;if("number"==typeof t.maxAssetRetries&&t.maxAssetRetries>0&&this.loader.enableRetry(t.maxAssetRetries),t.useDevicePixelRatio||(t.useDevicePixelRatio=t.use_device_pixel_ratio),t.resolutionMode||(t.resolutionMode=t.resolution_mode),t.fillMode||(t.fillMode=t.fill_mode),this._width=t.width,this._height=t.height,t.useDevicePixelRatio&&(this.graphicsDevice.maxPixelRatio=window.devicePixelRatio),this.setCanvasResolution(t.resolutionMode,this._width,this._height),this.setCanvasFillMode(t.fillMode,this._width,this._height),t.layers&&t.layerOrder){var r=new Dn,s={};for(var a in t.layers){var o=t.layers[a];o.id=parseInt(a,10),o.enabled=1!==o.id,s[a]=new Ii(o)}for(i=0,n=t.layerOrder.length;i<n;i++){var l=t.layerOrder[i],h=s[l.layer];h&&(l.transparent?r.pushTransparent(h):r.pushOpaque(h),r.subLayerEnabled[i]=l.enabled)}this.scene.layers=r}if(t.batchGroups)for(i=0,n=t.batchGroups.length;i<n;i++){var c=t.batchGroups[i];this.batcher.addGroup(c.name,c.dynamic,c.maxAabbSize,c.id,c.layers)}t.i18nAssets&&(this.i18n.assets=t.i18nAssets),this._loadLibraries(t.libraries,e)}_loadLibraries(t,e){var i=t.length,n=i,r=this,s=/^http(s)?:\/\//;if(i)for(var a=function(t,i){n--,t?e(t):0===n&&(r.onLibrariesLoaded(),e(null))},o=0;o<i;++o){var l=t[o];!s.test(l.toLowerCase())&&r._scriptPrefix&&(l=x.join(r._scriptPrefix,l)),this.loader.load(l,"script",a)}else r.onLibrariesLoaded(),e(null)}_parseScenes(t){if(t)for(var e=0;e<t.length;e++)this.scenes.add(t[e].name,t[e].url)}_parseAssets(t){var e,i,n=[],r={},s={};if(eo.legacy){if(this.enableBundles)for(i in t)"bundle"===t[i].type&&(s[i]=!0,n.push(t[i]));for(i in t)s[i]||n.push(t[i])}else{for(e=0;e<this.scriptsOrder.length;e++)t[i=this.scriptsOrder[e]]&&(r[i]=!0,n.push(t[i]));if(this.enableBundles)for(i in t)"bundle"===t[i].type&&(s[i]=!0,n.push(t[i]));for(i in t)r[i]||s[i]||n.push(t[i])}for(e=0;e<n.length;e++){var a=n[e],o=new As(a.name,a.type,a.file,a.data);if(o.id=parseInt(a.id,10),o.preload=!!a.preload&&a.preload,o.loaded="script"===a.type&&a.data&&a.data.loadingType>0,o.tags.add(a.tags),a.i18n)for(var l in a.i18n)o.addLocalizedAssetId(l,a.i18n[l]);this.assets.add(o)}}_getScriptReferences(t){var e,i,n=[];t.settings.priority_scripts&&(n=t.settings.priority_scripts);var r=[],s={};for(e=0;e<n.length;e++)r.push(n[e]),s[n[e]]=!0;var a=t.entities;for(i in a)if(a[i].components.script){var o=a[i].components.script.scripts;for(e=0;e<o.length;e++)s[o[e].url]||(r.push(o[e].url),s[o[e].url]=!0)}return r}start(){this.frame=0,this.fire("start",{timestamp:N(),target:this}),this._librariesLoaded||this.onLibrariesLoaded(),Il.initialize(this.root),this.fire("initialize"),Il.postInitialize(this.root),this.fire("postinitialize"),this.tick()}update(t){this.frame++,this.graphicsDevice.updateClientRect(),this.vr&&this.vr.poll(),eo.legacy&&Il.fixedUpdate(1/60,this._inTools),Il.update(t,this._inTools),Il.animationUpdate(t,this._inTools),Il.postUpdate(t,this._inTools),this.fire("update",t),this.controller&&this.controller.update(t),this.mouse&&this.mouse.update(t),this.keyboard&&this.keyboard.update(t),this.gamepads&&this.gamepads.update(t)}render(){this.fire("prerender"),this.root.syncHierarchy(),this.batcher.updateAll(),this.renderer.renderComposition(this.scene.layers),this.fire("postrender")}_fillFrameStatsBasic(t,e,i){var n=this.stats.frame;n.dt=e,n.ms=i,t>n._timeToCountFrames?(n.fps=n._fpsAccum,n._fpsAccum=0,n._timeToCountFrames=t+1e3):n._fpsAccum++,this.stats.drawCalls.total=this.graphicsDevice._drawCallsPerFrame,this.graphicsDevice._drawCallsPerFrame=0}_fillFrameStats(){var t=this.stats.frame;t.cameras=this.renderer._camerasRendered,t.materials=this.renderer._materialSwitches,t.shaders=this.graphicsDevice._shaderSwitchesPerFrame,t.shadowMapUpdates=this.renderer._shadowMapUpdates,t.shadowMapTime=this.renderer._shadowMapTime,t.depthMapTime=this.renderer._depthMapTime,t.forwardTime=this.renderer._forwardTime;var e=this.graphicsDevice._primsPerFrame;t.triangles=e[4]/3+Math.max(e[5]-2,0)+Math.max(e[6]-2,0),t.cullTime=this.renderer._cullTime,t.sortTime=this.renderer._sortTime,t.skinTime=this.renderer._skinTime,t.morphTime=this.renderer._morphTime,t.instancingTime=this.renderer._instancingTime,t.otherPrimitives=0;for(var i=0;i<e.length;i++)i<4&&(t.otherPrimitives+=e[i]),e[i]=0;this.renderer._camerasRendered=0,this.renderer._materialSwitches=0,this.renderer._shadowMapUpdates=0,this.graphicsDevice._shaderSwitchesPerFrame=0,this.renderer._cullTime=0,this.renderer._layerCompositionUpdateTime=0,this.renderer._sortTime=0,this.renderer._skinTime=0,this.renderer._morphTime=0,this.renderer._instancingTime=0,this.renderer._shadowMapTime=0,this.renderer._depthMapTime=0,this.renderer._forwardTime=0,(t=this.stats.drawCalls).forward=this.renderer._forwardDrawCalls,t.culled=this.renderer._numDrawCallsCulled,t.depth=0,t.shadow=this.renderer._shadowDrawCalls,t.skinned=this.renderer._skinDrawCalls,t.immediate=0,t.instanced=0,t.removedByInstancing=0,t.misc=t.total-(t.forward+t.shadow),this.renderer._depthDrawCalls=0,this.renderer._shadowDrawCalls=0,this.renderer._forwardDrawCalls=0,this.renderer._numDrawCallsCulled=0,this.renderer._skinDrawCalls=0,this.renderer._immediateRendered=0,this.renderer._instancedDrawCalls=0,this.renderer._removedByInstancing=0,this.stats.misc.renderTargetCreationTime=this.graphicsDevice.renderTargetCreationTime,(t=this.stats.particles).updatesPerFrame=t._updatesPerFrame,t.frameTime=t._frameTime,t._updatesPerFrame=0,t._frameTime=0}setCanvasFillMode(t,e,i){this._fillMode=t,this.resizeCanvas(e,i)}setCanvasResolution(t,e,i){this._resolutionMode=t,"AUTO"===t&&void 0===e&&(e=this.graphicsDevice.canvas.clientWidth,i=this.graphicsDevice.canvas.clientHeight),this.graphicsDevice.resizeCanvas(e,i)}isHidden(){return document[this._hiddenAttr]}onVisibilityChange(){this.isHidden()?this._soundManager.suspend():this._soundManager.resume()}resizeCanvas(t,e){if(this._allowResize&&(!this.xr||!this.xr.session)){var i=window.innerWidth,n=window.innerHeight;if("KEEP_ASPECT"===this._fillMode){var r=this.graphicsDevice.canvas.width/this.graphicsDevice.canvas.height;r>i/n?e=(t=i)/r:t=(e=n)*r}else"FILL_WINDOW"===this._fillMode&&(t=i,e=n);return this.graphicsDevice.canvas.style.width=t+"px",this.graphicsDevice.canvas.style.height=e+"px","AUTO"===this._resolutionMode&&this.setCanvasResolution("AUTO"),{width:t,height:e}}}onLibrariesLoaded(){this._librariesLoaded=!0,this.systems.rigidbody.onLibraryLoaded()}applySceneSettings(t){var e;if(this.systems.rigidbody&&"undefined"!=typeof Ammo){var i=t.physics.gravity;this.systems.rigidbody.gravity.set(i[0],i[1],i[2])}this.scene.applySettings(t),t.render.hasOwnProperty("skybox")&&(t.render.skybox?(e=this.assets.get(t.render.skybox))?this.setSkybox(e):this.assets.once("add:"+t.render.skybox,this.setSkybox,this):this.setSkybox(null))}setSkybox(t){if(t){if(this._skyboxLast===t.id)return void(0!==this.scene.skyboxMip||t.loadFaces?this._onSkyboxChange(t):this._skyboxLoad(t));this._skyboxLast&&(this.assets.off("add:"+this._skyboxLast,this.setSkybox,this),this.assets.off("load:"+this._skyboxLast,this._onSkyboxChange,this),this.assets.off("remove:"+this._skyboxLast,this._skyboxRemove,this)),this._skyboxLast=t.id,this.assets.on("load:"+t.id,this._onSkyboxChange,this),this.assets.once("remove:"+t.id,this._skyboxRemove,this),t.resource&&this.scene.setSkybox(t.resources),this._skyboxLoad(t)}else{if(!this._skyboxLast)return;this._skyboxRemove({id:this._skyboxLast})}}enableVr(){this.vr||(this.vr=new Yo(this))}disableVr(){this.vr&&(this.vr.destroy(),this.vr=null)}_onSkyboxChange(t){this.scene.setSkybox(t.resources)}_skyboxLoad(t){0===this.scene.skyboxMip&&(t.loadFaces=!0),this.assets.load(t),this._onSkyboxChange(t)}_skyboxRemove(t){this._skyboxLast&&(this.assets.off("add:"+t.id,this.setSkybox,this),this.assets.off("load:"+t.id,this._onSkyboxChange,this),this.assets.off("remove:"+t.id,this._skyboxRemove,this),this.scene.setSkybox(null),this._skyboxLast=null)}_firstBake(){this.lightmapper.bake(null,this.scene.lightmapMode)}_firstBatch(){this.scene._needsStaticPrepare&&(this.renderer.prepareStaticMeshes(this.graphicsDevice,this.scene),this.scene._needsStaticPrepare=!1),this.batcher.generate()}_processTimestamp(t){return t}_preRenderImmediate(){for(var t=0;t<this._immediateData.lineBatches.length;t++)this._immediateData.lineBatches[t]&&this._immediateData.lineBatches[t].finalize(this.meshInstanceArray)}_postRenderImmediate(){for(var t=0;t<this._immediateData.layers.length;t++)this._immediateData.layers[t].clearMeshInstances(!0);this._immediateData.layers.length=0}_initImmediate(){this._immediateData||(this._immediateData=new Pn(this.graphicsDevice),this.on("prerender",this._preRenderImmediate,this),this.on("postrender",this._postRenderImmediate,this))}_addLines(t,e,i){var n=i&&i.layer?i.layer:this.scene.layers.getLayerById(3),r=!i||void 0===i.depthTest||i.depthTest,s=i&&i.mask?i.mask:void 0;this._initImmediate(),this._immediateData.addLayer(n);var a=this._immediateData.getLayerIdx(n);if(void 0===a){var o=new En;o.init(this.graphicsDevice,this._immediateData.lineVertexFormat,n,t.length/2),o.material.depthTest=r,s&&(o.meshInstance.mask=s),a=this._immediateData.lineBatches.push(o)-1,this._immediateData.addLayerIdx(a,n)}else this._immediateData.lineBatches[a].init(this.graphicsDevice,this._immediateData.lineVertexFormat,n,t.length/2),this._immediateData.lineBatches[a].material.depthTest=r,s&&(this._immediateData.lineBatches[a].meshInstance.mask=s);this._immediateData.lineBatches[a].addLines(t,e)}renderLine(t,e,i){var n,r=i,s=arguments[3],a=arguments[4];s instanceof D?(r=s,"number"==typeof a?(Zd||(console.warn("lineBatch argument is deprecated for renderLine. Use options.layer instead"),Zd=!0),n=1===a?{layer:this.scene.layers.getLayerById(3),depthTest:!1}:{layer:this.scene.layers.getLayerById(3),depthTest:!0}):n=a):"number"==typeof s?(Zd||(console.warn("lineBatch argument is deprecated for renderLine. Use options.layer instead"),Zd=!0),r=i,n=1===s?{layer:this.scene.layers.getLayerById(3),depthTest:!1}:{layer:this.scene.layers.getLayerById(3),depthTest:!0}):s&&(n=s),this._addLines([t,e],[i,r],n)}renderLines(t,e,i){i?"number"==typeof i&&(Zd||(console.warn("lineBatch argument is deprecated for renderLine. Use options.layer instead"),Zd=!0),i=1===i?{layer:this.scene.layers.getLayerById(3),depthTest:!1}:{layer:this.scene.layers.getLayerById(3),depthTest:!0}):i={layer:this.scene.layers.getLayerById(3),depthTest:!0},!e.length||t.length===e.length?t.length%2==0?this._addLines(t,e,i):console.error("renderLines: array length is not divisible by 2"):console.error("renderLines: position/color arrays have different lengths")}renderWireCube(t,e,i){var n;if(this._initImmediate(),!this._immediateData.cubeLocalPos){var r=.5;this._immediateData.cubeLocalPos=[new H(-r,-r,-r),new H(-r,r,-r),new H(r,r,-r),new H(r,-r,-r),new H(-r,-r,r),new H(-r,r,r),new H(r,r,r),new H(r,-r,r)],this._immediateData.cubeWorldPos=[new H,new H,new H,new H,new H,new H,new H,new H]}var s=this._immediateData.cubeLocalPos,a=this._immediateData.cubeWorldPos;for(n=0;n<8;n++)t.transformPoint(s[n],a[n]);this.renderLines([a[0],a[1],a[1],a[2],a[2],a[3],a[3],a[0],a[4],a[5],a[5],a[6],a[6],a[7],a[7],a[4],a[0],a[4],a[1],a[5],a[2],a[6],a[3],a[7]],e,i)}renderMeshInstance(t,e){e||(e={layer:this.scene.layers.getLayerById(3)}),this._initImmediate(),this._immediateData.addLayer(e.layer),this.meshInstanceArray[0]=t,e.layer.addMeshInstances(this.meshInstanceArray,!0)}renderMesh(t,e,i,n){n||(n={layer:this.scene.layers.getLayerById(3)}),this._initImmediate(),Yd.worldTransform=i,Yd._dirtyWorld=Yd._dirtyNormal=!1;var r=new Ee(Yd,t,e);r.cull=!1,n.mask&&(r.mask=n.mask),this._immediateData.addLayer(n.layer),this.meshInstanceArray[0]=r,n.layer.addMeshInstances(this.meshInstanceArray,!0)}renderQuad(t,e,i){if(i||(i={layer:this.scene.layers.getLayerById(3)}),this._initImmediate(),!this._immediateData.quadMesh){var n=new bt(this.graphicsDevice,[{semantic:"POSITION",components:3,type:6}]),r=new _t(this.graphicsDevice,n,4),s=new Rt(r);s.element.POSITION.set(-.5,-.5,0),s.next(),s.element.POSITION.set(.5,-.5,0),s.next(),s.element.POSITION.set(-.5,.5,0),s.next(),s.element.POSITION.set(.5,.5,0),s.end(),this._immediateData.quadMesh=new Ie(this.graphicsDevice),this._immediateData.quadMesh.vertexBuffer=r,this._immediateData.quadMesh.primitive[0].type=5,this._immediateData.quadMesh.primitive[0].base=0,this._immediateData.quadMesh.primitive[0].count=4,this._immediateData.quadMesh.primitive[0].indexed=!1}Yd.worldTransform=t,Yd._dirtyWorld=Yd._dirtyNormal=!1;var a=new Ee(Yd,this._immediateData.quadMesh,e);a.cull=!1,this.meshInstanceArray[0]=a,this._immediateData.addLayer(i.layer),i.layer.addMeshInstances(this.meshInstanceArray,!0)}destroy(){var t,e,i=this.graphicsDevice.canvas.id;this.off("librariesloaded"),document.removeEventListener("visibilitychange",this._visibilityChangeHandler,!1),document.removeEventListener("mozvisibilitychange",this._visibilityChangeHandler,!1),document.removeEventListener("msvisibilitychange",this._visibilityChangeHandler,!1),document.removeEventListener("webkitvisibilitychange",this._visibilityChangeHandler,!1),this._visibilityChangeHandler=null,this.onVisibilityChange=null,this.root.destroy(),this.root=null,this.mouse&&(this.mouse.off(),this.mouse.detach(),this.mouse=null),this.keyboard&&(this.keyboard.off(),this.keyboard.detach(),this.keyboard=null),this.touch&&(this.touch.off(),this.touch.detach(),this.touch=null),this.elementInput&&(this.elementInput.detach(),this.elementInput=null),this.controller&&(this.controller=null);var n=this.systems.list;for(t=0,e=n.length;t<e;t++)n[t].destroy();Il.destroy();var r=this.assets.list();for(t=0;t<r.length;t++)r[t].unload(),r[t].off();for(var s in this.assets.off(),this.bundles.destroy(),this.bundles=null,this.i18n.destroy(),this.i18n=null,this.loader.getHandler("script")._cache){var a=this.loader.getHandler("script")._cache[s],o=a.parentNode;o&&o.removeChild(a)}this.loader.getHandler("script")._cache={},this.loader.destroy(),this.loader=null,this.scene.destroy(),this.scene=null,this.systems=[],this.context=null,this.scripts.destroy(),this.scripts=null,this.scenes.destroy(),this.scenes=null,this.lightmapper.destroy(),this.lightmapper=null,this.batcher.destroyManager(),this.batcher=null,this._entityIndex={},this.defaultLayerDepth.onPreRenderOpaque=null,this.defaultLayerDepth.onPostRenderOpaque=null,this.defaultLayerDepth.onDisable=null,this.defaultLayerDepth.onEnable=null,this.defaultLayerDepth=null,this.defaultLayerWorld=null,Lt&&(Lt.destroy(),Lt=null),this.vr&&(this.vr.destroy(),this.vr=null),this.xr.end(),this.graphicsDevice.destroy(),this.graphicsDevice=null,this.renderer=null,this.tick=null,this.off(),this._soundManager&&(this._soundManager.destroy(),this._soundManager=null),eo.app=null,Nr.DEFAULT_PARAM_TEXTURE=null,qd._applications[i]=null,qd._currentApplication===this&&(qd._currentApplication=null)}getEntityFromIndex(t){return this._entityIndex[t]}}qd._currentApplication=null,qd._applications={};var Kd={},Jd=function(t){var e,i=t;return function(t,n){if(i.graphicsDevice){qd._currentApplication=i,e&&(window.cancelAnimationFrame(e),e=null),i;var r=i._processTimestamp(t)||N(),s=r-(i._time||r),a=s/1e3;a=k.clamp(a,0,i.maxDeltaTime),a*=i.timeScale,i._time=r,e=i.vr&&i.vr.display?i.vr.display.requestAnimationFrame(i.tick):i.xr.session?i.xr.session.requestAnimationFrame(i.tick):window.requestAnimationFrame(i.tick),i.graphicsDevice.contextLost||(i._fillFrameStatsBasic(r,a,s),i.fire("frameupdate",s),n?(i.xr.update(n),i.graphicsDevice.defaultFramebuffer=n.session.renderState.baseLayer.framebuffer):i.graphicsDevice.defaultFramebuffer=null,i.update(a),i.fire("framerender"),(i.autoRender||i.renderNextFrame)&&(i.render(),i.renderNextFrame=!1),Kd.timestamp=N(),Kd.target=i,i.fire("frameend",Kd),i.fire("frameEnd",Kd),i.vr&&i.vr.display&&i.vr.display.presenting&&i.vr.display.submitFrame())}}};const Qd=[],$d=[],tf=[],ef=[],nf={},rf=[];class sf{copy(t){for(const e in t)t.hasOwnProperty(e)&&"copy"!==e&&(this[e]=t[e])}}class af extends _e{constructor(){super(),this._assetReferences={},this._validator=null,this.shaderOptBuilder=new ye,this.reset()}reset(){for(let t=0;t<Qd.length;t++){const e=$d[t];this[Qd[t]]=e&&e.clone?e.clone():e}for(let t=0;t<tf.length;t++)this[tf[t]]=null;for(let t=0;t<ef.length;t++)this[ef[t]]=new Float32Array(3);this._chunks=new sf,this.cubeMapMinUniform=new Float32Array(3),this.cubeMapMaxUniform=new Float32Array(3)}clone(){const t=new af;this._cloneInternal(t);for(let e=0;e<Qd.length;e++){const i=Qd[e];void 0!==this[i]&&(this[i]&&this[i].copy?t[i]?t[i].copy(this[i]):t[i]=this[i].clone():t[i]=this[i])}return t}_updateMapTransform(t,e,i){return 1===e.x&&1===e.y&&0===i.x&&0===i.y?null:((t=t||new X).set(e.x,e.y,i.x,i.y),t)}_setParameter(t,e){this.parameters[t]||this._propsSet.push(t),this.setParameter(t,e)}_clearParameters(){const t=this._propsSet;for(let e=0;e<t.length;e++)delete this.parameters[t[e]];this._propsSet=[]}_updateMap(t){const e=t+"Map",i=this[e];if(i){this._setParameter("texture_"+e,i);const t=e+"Transform";this[t]=this._updateMapTransform(this[t],this[e+"Tiling"],this[e+"Offset"]);const n=this[t];if(n){const i=e+"TransformUniform";let r=this[i];r||(r=new Float32Array(4),this[i]=r),r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=n.w,this._setParameter("texture_"+t,r)}}}getUniform(t,e,i){const n=nf[t];return n?n(this,e,i):null}updateUniforms(){this._clearParameters(),this._setParameter("material_ambient",this.ambientUniform),this.diffuseMap&&!this.diffuseTint||this._setParameter("material_diffuse",this.diffuseUniform),this.useMetalness?(!this.metalnessMap||this.metalness<1)&&this._setParameter("material_metalness",this.metalness):this.specularMap&&!this.specularTint||this._setParameter("material_specular",this.specularUniform),this.enableGGXSpecular&&this._setParameter("material_anisotropy",this.anisotropy),this.clearCoat>0&&(this._setParameter("material_clearCoat",this.clearCoat),this._setParameter("material_clearCoatGlossiness",this.clearCoatGlossiness),this._setParameter("material_clearCoatReflectivity",this.clearCoat),this._setParameter("material_clearCoatBumpiness",this.clearCoatBumpiness));let t=this.getUniform("shininess",this.shininess,!0);this._setParameter(t.name,t.value),this.emissiveMap&&!this.emissiveTint||this._setParameter("material_emissive",this.emissiveUniform),this.emissiveMap&&this._setParameter("material_emissiveIntensity",this.emissiveIntensity),this.refraction>0&&(this._setParameter("material_refraction",this.refraction),this._setParameter("material_refractionIndex",this.refractionIndex)),this._setParameter("material_opacity",this.opacity),!1===this.opacityFadesSpecular&&this._setParameter("material_alphaFade",this.alphaFade),this.occludeSpecular&&this._setParameter("material_occludeSpecularIntensity",this.occludeSpecularIntensity),1===this.cubeMapProjection&&this._setParameter(this.getUniform("cubeMapProjectionBox",this.cubeMapProjectionBox,!0));for(let t in he)this._updateMap(t);this.ambientSH&&this._setParameter("ambientSH[0]",this.ambientSH),this.normalMap&&this._setParameter("material_bumpiness",this.bumpiness),this.normalMap&&this.normalDetailMap&&this._setParameter("material_normalDetailMapBumpiness",this.normalDetailMapBumpiness),this.heightMap&&(t=this.getUniform("heightMapFactor",this.heightMapFactor,!0),this._setParameter(t.name,t.value)),this.cubeMap&&this._setParameter("texture_cubeMap",this.cubeMap),this.prefilteredCubeMap128?this._setParameter("texture_prefilteredCubeMap128",this.prefilteredCubeMap128):this._scene&&this._scene._skyboxPrefiltered[0]&&this._setParameter("texture_prefilteredCubeMap128",this._scene._skyboxPrefiltered[0]),this.prefilteredCubeMap64?this._setParameter("texture_prefilteredCubeMap64",this.prefilteredCubeMap64):this._scene&&this._scene._skyboxPrefiltered[1]&&this._setParameter("texture_prefilteredCubeMap64",this._scene._skyboxPrefiltered[1]),this.prefilteredCubeMap32?this._setParameter("texture_prefilteredCubeMap32",this.prefilteredCubeMap32):this._scene&&this._scene._skyboxPrefiltered[2]&&this._setParameter("texture_prefilteredCubeMap32",this._scene._skyboxPrefiltered[2]),this.prefilteredCubeMap16?this._setParameter("texture_prefilteredCubeMap16",this.prefilteredCubeMap16):this._scene&&this._scene._skyboxPrefiltered[3]&&this._setParameter("texture_prefilteredCubeMap16",this._scene._skyboxPrefiltered[3]),this.prefilteredCubeMap8?this._setParameter("texture_prefilteredCubeMap8",this.prefilteredCubeMap8):this._scene&&this._scene._skyboxPrefiltered[4]&&this._setParameter("texture_prefilteredCubeMap8",this._scene._skyboxPrefiltered[4]),this.prefilteredCubeMap4?this._setParameter("texture_prefilteredCubeMap4",this.prefilteredCubeMap4):this._scene&&this._scene._skyboxPrefiltered[5]&&this._setParameter("texture_prefilteredCubeMap4",this._scene._skyboxPrefiltered[5]),this.sphereMap&&this._setParameter("texture_sphereMap",this.sphereMap),this.dpAtlas&&this._setParameter("texture_sphereMap",this.dpAtlas),this._setParameter("material_reflectivity",this.reflectivity),!this.dirtyShader&&this._scene||(this.shader=null,this.clearVariants()),this._processColor()}_processColor(){if(!this.dirtyColor)return;if(!this._scene&&this.useGammaTonemap)return;let t=!1;this.useGammaTonemap&&(t=this._scene.gammaCorrection);for(let e=0;e<rf.length;e++){const i=this["_"+rf[e]],n=this[rf[e]+"Uniform"];t?(n[0]=Math.pow(i.r,2.2),n[1]=Math.pow(i.g,2.2),n[2]=Math.pow(i.b,2.2)):(n[0]=i.r,n[1]=i.g,n[2]=i.b)}for(let t=0;t<3;t++)this.emissiveUniform[t]*=this.emissiveIntensity;this.dirtyColor=!1}updateShader(t,e,i,n,r,s){!this._colorProcessed&&this._scene&&(this._colorProcessed=!0,this._processColor());const a=t.useTexCubeLod,o=!t.extTextureLod;let l,h,c,u,d,f;this.useSkybox&&(l=e._skyboxPrefiltered[0],h=e._skyboxPrefiltered[1],c=e._skyboxPrefiltered[2],u=e._skyboxPrefiltered[3],d=e._skyboxPrefiltered[4],f=e._skyboxPrefiltered[5]);const p=this.prefilteredCubeMap128||l,m=this.prefilteredCubeMap64||h,g=this.prefilteredCubeMap32||c,v=this.prefilteredCubeMap16||u,_=this.prefilteredCubeMap8||d,y=this.prefilteredCubeMap4||f;if(p){const i=p&&m&&g&&v&&_&&y;if(o&&i){if(!p.dpAtlas){const e=[p,m,g,v,_,y];p.dpAtlas=function(t,e,i){var n,r=new X,s=new X,a=2*e[0].width*2,o=Jt(t,Ft.fullscreenQuadVS,Ft.dpAtlasQuadPS,"dpAtlasQuad"),l=t.scope.resolve("source"),h=t.scope.resolve("params"),c=new pe(t,{type:e[0].type,format:e[0].format,width:a,height:a,mipmaps:!1});c.name="paraboloid";for(var u,d=new Cf(t,c,{depth:!1}),f=(a+2)/a-1,p=0;p<6;p++)n=me(t,e[p],p,i),l.setValue(n),u=ge(r,p),s.x=u*f,s.y=2*s.x,s.x+=1,s.y+=1,h.setValue(s.data),r.x*=a,r.y*=a,r.z*=a,r.w*=a,zt(t,d,o,r);return c}(t,e),p.sh=function(t,e,i){var n,r,s,a=e.width;if(7!==e.format)return;if(!e._levels[0])return;if(!e._levels[0][0].length){if(!(e._levels[0][0]instanceof HTMLImageElement))return;var o=t.gl,l=Jt(t,Ft.fullscreenQuadVS,Ft.fullscreenQuadPS,"fsQuadSimple"),h=t.scope.resolve("source");for(n=0;n<6;n++){var c=e._levels[0][n],u=new pe(t,{cubemap:!1,type:"default",format:e.format,width:a,height:a,mipmaps:!1});u.name="prefiltered-cube",u._levels[0]=c,u.upload();var d=new pe(t,{cubemap:!1,type:"default",format:e.format,width:a,height:a,mipmaps:!1});d.name="prefiltered-cube";var f=new Cf(t,d,{depth:!1});h.setValue(u),zt(t,f,l);var p=new Uint8Array(a*a*4);o.bindFramebuffer(o.FRAMEBUFFER,f._glFrameBuffer),o.readPixels(0,0,u.width,u.height,o.RGBA,o.UNSIGNED_BYTE,p),e._levels[0][n]=p}}var m=[];for(s=0;s<a;s++)for(r=0;r<a;r++){var g=r/(a-1)*2-1,v=s/(a-1)*2-1;m[s*a+r]=new H(g,v,1).normalize()}var _,y,b,x,w,A,C,I,S,M,T,P,E,k,D=new Float32Array(27),O=0;for(n=0;n<6;n++)for(s=0;s<a;s++)for(r=0;r<a;r++)for(_=s*a+r,w=Sf(r,s,a),M=4*w/17,T=8*w/17,P=15*w/17,E=5*w/68,k=15*w/68,A=m[_],0==n?(C=A.z,I=-A.y,S=-A.x):1==n?(C=-A.z,I=-A.y,S=A.x):2==n?(C=A.x,I=A.z,S=A.y):3==n?(C=A.x,I=-A.z,S=-A.y):4==n?(C=A.x,I=-A.y,S=A.z):5==n&&(C=-A.x,I=-A.y,S=-A.z),i||(C=-C),b=e._levels[0][n][4*_+3]/255,y=0;y<3;y++)x=e._levels[0][n][4*_+y]/255,"rgbm"===e.type?(x*=8*b,x*=x):x=Math.pow(x,2.2),D[0+y]+=x*M,D[3+y]+=x*T*C,D[6+y]+=x*T*I,D[9+y]+=x*T*S,D[12+y]+=x*P*C*S,D[15+y]+=x*P*S*I,D[18+y]+=x*P*I*C,D[21+y]+=x*E*(3*S*S-1),D[24+y]+=x*k*(C*C-I*I),O+=w;for(y=0;y<D.length;y++)D[y]*=4*Math.PI/O;return D}(t,v)}this.dpAtlas=p.dpAtlas,this.ambientSH=p.sh,this._setParameter("ambientSH[0]",this.ambientSH),this._setParameter("texture_sphereMap",this.dpAtlas)}else a?p._levels.length<6?i?this._setParameter("texture_prefilteredCubeMap128",p):console.log("Can't use prefiltered cubemap: "+i+", "+a+", "+p._levels):this._setParameter("texture_prefilteredCubeMap128",p):i?(this._setParameter("texture_prefilteredCubeMap128",p),this._setParameter("texture_prefilteredCubeMap64",m),this._setParameter("texture_prefilteredCubeMap32",g),this._setParameter("texture_prefilteredCubeMap16",v),this._setParameter("texture_prefilteredCubeMap8",_),this._setParameter("texture_prefilteredCubeMap4",y)):console.log("Can't use prefiltered cubemap: "+i+", "+a+", "+p._levels);this.useSkybox&&!e.skyboxRotation.equals($.IDENTITY)&&e._skyboxRotationMat3&&this._setParameter("cubeMapRotationMatrix",e._skyboxRotationMat3.data)}let b=r>1&&r<=18,x=b?ce.optionsContextMin:ce.optionsContext;b?this.shaderOptBuilder.updateMinRef(x,t,e,this,i,n,r,s,p):this.shaderOptBuilder.updateRef(x,t,e,this,i,n,r,s,p),this.onUpdateShader&&(x=this.onUpdateShader(x));const w=t.getProgramLibrary();this.shader=w.getProgram("standard",x),i||(this.clearVariants(),this.variants[0]=this.shader),this.dirtyShader=!1}}function of(t,e,i,n,r,s,a){var o="_"+e+"Map",l=o+"Tiling",h=o+"Offset",c=o.substring(1)+"Transform",u=c+"Uniform",d=o+"Uv",f=o+"Channel",p="_"+e+"VertexColor",m="_"+e+"VertexColorChannel",g="_"+e+"Mode";if(t[o]=null,t[l]=new W(1,1),t[h]=new W(0,0),t[c]=null,t[u]=null,t[d]=i,n>0){var v=r||(n>1?"rgb":"g");t[f]=v,s&&(t[m]=v)}s&&(t[p]=!1),a&&(t[g]="mul"),he[e]=n,Object.defineProperty(af.prototype,o.substring(1),{get:function(){return this[o]},set:function(t){var e=this[o];!!e^!!t&&(this.dirtyShader=!0),e&&t&&(e.type===t.type&&e.fixCubemapSeams===t.fixCubemapSeams&&e.format===t.format||(this.dirtyShader=!0)),this[o]=t}});var _=l.substring(1),y=h.substring(1);Object.defineProperty(af.prototype,_,{get:function(){return this[l]},set:function(t){this.dirtyShader=!0,this[l]=t}}),nf[_]=function(t,e,i){var n=t._updateMapTransform(i?t[c]:null,e,t[h]);return{name:"texture_"+c,value:n.data}},Object.defineProperty(af.prototype,y,{get:function(){return this[h]},set:function(t){this.dirtyShader=!0,this[h]=t}}),nf[y]=function(t,e,i){var n=t._updateMapTransform(i?t[c]:null,t[l],e);return{name:"texture_"+c,value:n.data}},Object.defineProperty(af.prototype,d.substring(1),{get:function(){return this[d]},set:function(t){this[d]!==t&&(this.dirtyShader=!0),this[d]=t}}),Object.defineProperty(af.prototype,f.substring(1),{get:function(){return this[f]},set:function(t){this[f]!==t&&(this.dirtyShader=!0),this[f]=t}}),s&&(Object.defineProperty(af.prototype,p.substring(1),{get:function(){return this[p]},set:function(t){this.dirtyShader=!0,this[p]=t}}),Object.defineProperty(af.prototype,m.substring(1),{get:function(){return this[m]},set:function(t){this[m]!==t&&(this.dirtyShader=!0),this[m]=t}})),a&&Object.defineProperty(af.prototype,g.substring(1),{get:function(){return this[g]},set:function(t){this.dirtyShader=!0,this[g]=t}}),Qd.push(o.substring(1)),Qd.push(l.substring(1)),Qd.push(h.substring(1)),Qd.push(d.substring(1)),Qd.push(f.substring(1)),s&&(Qd.push(p.substring(1)),Qd.push(m.substring(1))),a&&Qd.push(g.substring(1)),tf.push(c)}function lf(t,e,i,n){var r="_"+e,s=e+"Uniform",a=e+"Intensity",o="_"+a;t[r]=i,t[s]=new Float32Array(3),Object.defineProperty(af.prototype,e,{get:function(){return this.dirtyColor=!0,this.dirtyShader=!0,this[r]},set:function(t){var e=this[r];(0===e.r&&0===e.g&&0===e.b||1===e.r&&1===e.g&&1===e.b)^(0===t.r&&0===t.g&&0===t.b||1===t.r&&1===t.g&&1===t.b)&&(this.dirtyShader=!0),this.dirtyColor=!0,this[r]=t}}),Qd.push(e),ef.push(s),rf.push(e),nf[e]=function(t,i,r){var a=r?t[s]:new Float32Array(3),l=!1;t.useGammaTonemap&&(l=(t._scene||qd.getApplication().scene).gammaCorrection);for(var h=0;h<3;h++)a[h]=l?Math.pow(i.data[h],2.2):i.data[h],n&&(a[h]*=t[o]);return{name:"material_"+e,value:a}},n&&(t[o]=1,Object.defineProperty(af.prototype,a,{get:function(){return this[o]},set:function(t){var e=this[o];(0===e||1===e)^(0===t||1===t)&&(this.dirtyShader=!0),this.dirtyColor=!0,this[o]=t}}),Qd.push(a),nf[a]=function(t,i,n){var a=n?t[s]:new Float32Array(3),l=!1;t.useGammaTonemap&&(l=(t._scene||qd.getApplication().scene).gammaCorrection);for(var h=0;h<3;h++)a[h]=l?Math.pow(t[r].data[h],2.2):t[r].data[h],a[h]*=t[o];return{name:"material_"+e,value:a}})}function hf(t,e,i,n){var r="_"+e;t[r]=i,Object.defineProperty(af.prototype,e,{get:function(){return this[r]},set:function(t){var e=this[r];e!==t&&(this[r]=t,(0===e||1===e||(0===t||1===t))&&(this.dirtyShader=!0))}}),Qd.push(e),nf[e]=void 0!==n?n:function(t,i,n){return{name:"material_"+e,value:i}}}function cf(t,e,i){var n="_"+e;t[n]=null,Object.defineProperty(af.prototype,e,{get:function(){return this[n]},set:function(t){!!this[n]^!!t&&(this.dirtyShader=!0),this[n]=t}}),Qd.push(e),nf[e]=i}function uf(t,e,i){Object.defineProperty(af.prototype,i,{get:function(){return this[e]},set:function(t){this[e]=t}})}function df(t,e,i){var n="_"+e;t[n]=i,Object.defineProperty(af.prototype,e,{get:function(){return this[n]},set:function(t){this[n]!==t&&(this.dirtyShader=!0),this[n]=t}}),Qd.push(e)}af.TEXTURE_PARAMETERS=Ea,af.CUBEMAP_PARAMETERS=ka,function(t){t.dirtyShader=!0,t.dirtyColor=!0,t._scene=null,t._colorProcessed=!1,lf(t,"ambient",new D(.7,.7,.7)),lf(t,"diffuse",new D(1,1,1)),lf(t,"specular",new D(0,0,0)),lf(t,"emissive",new D(0,0,0),!0),hf(t,"shininess",25,(function(t,e){let i;return i=0===t.shadingModel?Math.pow(2,.01*e*11):.01*e,{name:"material_shininess",value:i}})),hf(t,"heightMapFactor",1,(function(t,e){return{name:"material_heightMapFactor",value:.025*e}})),hf(t,"opacity",1),hf(t,"alphaFade",1),hf(t,"alphaTest",0),hf(t,"bumpiness",1),hf(t,"normalDetailMapBumpiness",1),hf(t,"reflectivity",1),hf(t,"occludeSpecularIntensity",1),hf(t,"refraction",0),hf(t,"refractionIndex",1/1.5),hf(t,"metalness",1),hf(t,"anisotropy",0),hf(t,"clearCoat",0),hf(t,"clearCoatGlossiness",1),hf(t,"clearCoatBumpiness",1),hf(t,"aoUvSet",0,null),cf(t,"ambientSH",(function(t,e,i){return{name:"ambientSH[0]",value:e}})),cf(t,"cubeMapProjectionBox",(function(t,e,i){const n=i?t.cubeMapMinUniform:new Float32Array(3),r=i?t.cubeMapMaxUniform:new Float32Array(3);return n[0]=e.center.x-e.halfExtents.x,n[1]=e.center.y-e.halfExtents.y,n[2]=e.center.z-e.halfExtents.z,r[0]=e.center.x+e.halfExtents.x,r[1]=e.center.y+e.halfExtents.y,r[2]=e.center.z+e.halfExtents.z,[{name:"envBoxMin",value:n},{name:"envBoxMax",value:r}]})),Object.defineProperty(af.prototype,"chunks",{get:function(){return this.dirtyShader=!0,this._chunks},set:function(t){this.dirtyShader=!0,this._chunks=t}}),Qd.push("chunks"),df(t,"ambientTint",!1),df(t,"diffuseTint",!1),df(t,"specularTint",!1),df(t,"emissiveTint",!1),df(t,"fastTbn",!1),df(t,"specularAntialias",!1),df(t,"useMetalness",!1),df(t,"enableGGXSpecular",!1),df(t,"occludeDirect",!1),df(t,"normalizeNormalMap",!0),df(t,"conserveEnergy",!0),df(t,"opacityFadesSpecular",!0),df(t,"occludeSpecular",1),df(t,"shadingModel",1),df(t,"fresnelModel",0),df(t,"cubeMapProjection",0),df(t,"customFragmentShader",null),df(t,"forceFragmentPrecision",null),df(t,"useFog",!0),df(t,"useLighting",!0),df(t,"useGammaTonemap",!0),df(t,"useSkybox",!0),df(t,"forceUv1",!1),df(t,"pixelSnap",!1),df(t,"twoSidedLighting",!1),df(t,"nineSlicedMode",void 0),of(t,"diffuse",0,3,"",!0),of(t,"specular",0,3,"",!0),of(t,"emissive",0,3,"",!0),of(t,"normal",0,-1,"",!1),of(t,"metalness",0,1,"",!0),of(t,"gloss",0,1,"",!0),of(t,"opacity",0,1,"a",!0),of(t,"height",0,1,"",!1),of(t,"ao",0,1,"",!0),of(t,"light",1,3,"",!0),of(t,"msdf",0,3,"",!1),of(t,"diffuseDetail",0,3,"",!1,!0),of(t,"normalDetail",0,-1,"",!1),of(t,"clearCoat",0,1,"",!0),of(t,"clearCoatGloss",0,1,"",!0),of(t,"clearCoatNormal",0,-1,"",!1),cf(t,"cubeMap"),cf(t,"sphereMap"),cf(t,"dpAtlas"),cf(t,"prefilteredCubeMap128"),cf(t,"prefilteredCubeMap64"),cf(t,"prefilteredCubeMap32"),cf(t,"prefilteredCubeMap16"),cf(t,"prefilteredCubeMap8"),cf(t,"prefilteredCubeMap4"),uf(0,"diffuseTint","diffuseMapTint"),uf(0,"specularTint","specularMapTint"),uf(0,"emissiveTint","emissiveMapTint"),uf(0,"aoVertexColor","aoMapVertexColor"),uf(0,"diffuseVertexColor","diffuseMapVertexColor"),uf(0,"specularVertexColor","specularMapVertexColor"),uf(0,"emissiveVertexColor","emissiveMapVertexColor"),uf(0,"metalnessVertexColor","metalnessMapVertexColor"),uf(0,"glossVertexColor","glossMapVertexColor"),uf(0,"opacityVertexColor","opacityMapVertexColor"),uf(0,"lightVertexColor","lightMapVertexColor");for(let e=0;e<Qd.length;e++)$d[e]=t[Qd[e]];t._propsSet=[]}(af.prototype);class ff{constructor(t){this._device=t,this._cache={},this._generators={},this._isClearingCache=!1,this._precached=!1,this._programsCollection=[],this._defaultStdMatOption={},this._defaultStdMatOptionMin={};var e=new af;e.shaderOptBuilder.updateRef(this._defaultStdMatOption,t,{},e,null,[],0,null,null),e.shaderOptBuilder.updateMinRef(this._defaultStdMatOptionMin,t,{},e,null,[],3,null,null)}register(t,e){this.isRegistered(t)||(this._generators[t]=e)}unregister(t){this.isRegistered(t)&&delete this._generators[t]}isRegistered(t){return void 0!==this._generators[t]}getProgram(t,e){var i=this._generators[t];if(void 0===i)return null;var n=this._device,r=i.generateKey(e),s=this._cache[r];if(!s){var a;e.lights&&(a=e.lights,e.lights=a.map((function(t){var e=t.clone?t.clone():t;return e.key=t.key,e}))),this.storeNewProgram(t,e),e.lights&&(e.lights=a),this._precached&&console.warn("ProgramLibrary#getProgram: Cache miss for shader",t,"key",r,"after shaders precaching");var o=i.createShaderDefinition(n,e);s=this._cache[r]=new Bt(n,o)}return s}storeNewProgram(t,e){var i={};if("standard"===t){var n=this._getDefaultStdMatOptions(e.pass);for(var r in e)(e.hasOwnProperty(r)&&n[r]!==e[r]||"pass"===r)&&(i[r]=e[r])}else i=e;this._programsCollection.push(JSON.stringify({name:t,options:i}))}dumpPrograms(){var t="var device = pc.app ? pc.app.graphicsDevice : pc.Application.getApplication().graphicsDevice;\n";t+="var shaders = [",this._programsCollection[0]&&(t+="\n\t"+this._programsCollection[0]);for(var e=1;e<this._programsCollection.length;++e)t+=",\n\t"+this._programsCollection[e];t+="\n];\n",t+="device.programLib.precompile(shaders);\n",t+='if (pc.version != "1.38.0" || pc.revision != "98cb89ec5")\n',t+='\tconsole.warn("precompile-shaders.js: engine version mismatch, rebuild shaders lib with current engine");';var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download","precompile-shaders.js"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}clearCache(){var t=this._cache;for(var e in this._isClearingCache=!0,t)t.hasOwnProperty(e)&&t[e].destroy();this._cache={},this._isClearingCache=!1}removeFromCache(t){if(!this._isClearingCache){var e=this._cache;for(var i in e)if(e.hasOwnProperty(i)&&e[i]===t){delete e[i];break}}}_getDefaultStdMatOptions(t){return t>1&&t<=18?this._defaultStdMatOptionMin:this._defaultStdMatOption}precompile(t){if(t)for(var e=new Array(t.length),i=0;i<t.length;i++){if("standard"===t[i].name){var n=t[i].options,r=this._getDefaultStdMatOptions(n.pass);for(var s in r)r.hasOwnProperty(s)&&void 0===n[s]&&(n[s]=r[s]);n.useTexCubeLod=this._device.useTexCubeLod}e[i]=this.getProgram(t[i].name,t[i].options)}this._precached=!0}}class pf{constructor(){this.globalId=0,this.revision=0}equals(t){return this.globalId===t.globalId&&this.revision===t.revision}copy(t){this.globalId=t.globalId,this.revision=t.revision}reset(){this.globalId=0,this.revision=0}}let mf=0;class gf{constructor(){mf++,this.version=new pf,this.version.globalId=mf}increment(){this.version.revision++}}class vf{constructor(t){this.name=t,this.value=null,this.versionObject=new gf}setValue(t){this.value=t,this.versionObject.increment()}getValue(){return this.value}}class _f{constructor(t){this.name=t,this.variables={},this.namespaces={}}resolve(t){return this.variables.hasOwnProperty(t)||(this.variables[t]=new vf(t)),this.variables[t]}getSubSpace(t){return this.namespaces.hasOwnProperty(t)||(this.namespaces[t]=new _f(t)),this.namespaces[t]}}class yf{constructor(t,e,i,n){if(this.locationId=n,this.scopeId=t.scope.resolve(e),this.version=new pf,"[0]"===e.substr(e.length-3))switch(i){case 2:i=17;break;case 3:i=21;break;case 4:i=22;break;case 5:i=23}this.dataType=i,this.value=[null,null,null,null],this.array=[]}}var bf=function(t,e){var i=t.width,n=t.height;if(i>e||n>e){var r=e/Math.max(i,n),s=Math.floor(i*r),a=Math.floor(n*r);console.warn("Image dimensions larger than max supported texture size of "+e+". Resizing from "+i+", "+n+" to "+s+", "+a+".");var o=document.createElement("canvas");return o.width=s,o.height=a,o.getContext("2d").drawImage(t,0,0,i,n,0,0,s,a),o}return t};function xf(t,e){var i=!0,n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null);var r=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&(i=!1),t.bindTexture(t.TEXTURE_2D,null),t.deleteTexture(n),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteFramebuffer(r),i}class wf extends v{constructor(t,e){var i;super(),this.canvas=t,this._enableAutoInstancing=!1,this.autoInstancingMaxObjects=16384,this.defaultFramebuffer=null,this._maxPixelRatio=1,this._width=0,this._height=0,this.updateClientRect(),this.shaders=[],this.buffers=[],this.textures=[],this.targets=[],this.contextLost=!1,this._contextLostHandler=function(t){t.preventDefault(),this.contextLost=!0,this.loseContext(),this.fire("devicelost")}.bind(this),this._contextRestoredHandler=function(){this.restoreContext(),this.contextLost=!1,this.fire("devicerestored")}.bind(this);var n=!e||void 0===e.preferWebGl2||e.preferWebGl2,r=n?["webgl2","experimental-webgl2","webgl","experimental-webgl"]:["webgl","experimental-webgl"],s=null;for((e=e||{}).stencil=!0,i=0;i<r.length;i++){try{s=t.getContext(r[i],e)}catch(t){}if(s){this.webgl2=n&&i<2;break}}if(!s)throw new Error("WebGL not supported");this.gl=s,this._tempEnableSafariTextureUnitWorkaround=!!window.safari;var a,o,l,h,c,u=!!window.chrome,d=-1!==navigator.appVersion.indexOf("Mac");for(var f in this._tempMacChromeBlitFramebufferWorkaround=d&&u&&!e.alpha,window.setupVertexArrayObject(s),t.addEventListener("webglcontextlost",this._contextLostHandler,!1),t.addEventListener("webglcontextrestored",this._contextRestoredHandler,!1),this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState(),this.initializeContextCaches(),this.defaultClearOptions={color:[0,0,0,1],depth:1,stencil:0,flags:3},this.glAddress=[s.REPEAT,s.CLAMP_TO_EDGE,s.MIRRORED_REPEAT],this.glBlendEquation=[s.FUNC_ADD,s.FUNC_SUBTRACT,s.FUNC_REVERSE_SUBTRACT,this.webgl2?s.MIN:this.extBlendMinmax?this.extBlendMinmax.MIN_EXT:s.FUNC_ADD,this.webgl2?s.MAX:this.extBlendMinmax?this.extBlendMinmax.MAX_EXT:s.FUNC_ADD],this.glBlendFunction=[s.ZERO,s.ONE,s.SRC_COLOR,s.ONE_MINUS_SRC_COLOR,s.DST_COLOR,s.ONE_MINUS_DST_COLOR,s.SRC_ALPHA,s.SRC_ALPHA_SATURATE,s.ONE_MINUS_SRC_ALPHA,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA],this.glComparison=[s.NEVER,s.LESS,s.EQUAL,s.LEQUAL,s.GREATER,s.NOTEQUAL,s.GEQUAL,s.ALWAYS],this.glStencilOp=[s.KEEP,s.ZERO,s.REPLACE,s.INCR,s.INCR_WRAP,s.DECR,s.DECR_WRAP,s.INVERT],this.glClearFlag=[0,s.COLOR_BUFFER_BIT,s.DEPTH_BUFFER_BIT,s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT,s.STENCIL_BUFFER_BIT,s.STENCIL_BUFFER_BIT|s.COLOR_BUFFER_BIT,s.STENCIL_BUFFER_BIT|s.DEPTH_BUFFER_BIT,s.STENCIL_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT],this.glCull=[0,s.BACK,s.FRONT,s.FRONT_AND_BACK],this.glFilter=[s.NEAREST,s.LINEAR,s.NEAREST_MIPMAP_NEAREST,s.NEAREST_MIPMAP_LINEAR,s.LINEAR_MIPMAP_NEAREST,s.LINEAR_MIPMAP_LINEAR],this.glPrimitive=[s.POINTS,s.LINES,s.LINE_LOOP,s.LINE_STRIP,s.TRIANGLES,s.TRIANGLE_STRIP,s.TRIANGLE_FAN],this.glType=[s.BYTE,s.UNSIGNED_BYTE,s.SHORT,s.UNSIGNED_SHORT,s.INT,s.UNSIGNED_INT,s.FLOAT],this.pcUniformType={},this.pcUniformType[s.BOOL]=0,this.pcUniformType[s.INT]=1,this.pcUniformType[s.FLOAT]=2,this.pcUniformType[s.FLOAT_VEC2]=3,this.pcUniformType[s.FLOAT_VEC3]=4,this.pcUniformType[s.FLOAT_VEC4]=5,this.pcUniformType[s.INT_VEC2]=6,this.pcUniformType[s.INT_VEC3]=7,this.pcUniformType[s.INT_VEC4]=8,this.pcUniformType[s.BOOL_VEC2]=9,this.pcUniformType[s.BOOL_VEC3]=10,this.pcUniformType[s.BOOL_VEC4]=11,this.pcUniformType[s.FLOAT_MAT2]=12,this.pcUniformType[s.FLOAT_MAT3]=13,this.pcUniformType[s.FLOAT_MAT4]=14,this.pcUniformType[s.SAMPLER_2D]=15,this.pcUniformType[s.SAMPLER_CUBE]=16,this.webgl2&&(this.pcUniformType[s.SAMPLER_2D_SHADOW]=18,this.pcUniformType[s.SAMPLER_CUBE_SHADOW]=19,this.pcUniformType[s.SAMPLER_3D]=20),this.targetToSlot={},this.targetToSlot[s.TEXTURE_2D]=0,this.targetToSlot[s.TEXTURE_CUBE_MAP]=1,this.targetToSlot[s.TEXTURE_3D]=2,this.commitFunction=[],this.commitFunction[0]=function(t,e){t.value!==e&&(s.uniform1i(t.locationId,e),t.value=e)},this.commitFunction[1]=this.commitFunction[0],this.commitFunction[2]=function(t,e){t.value!==e&&(s.uniform1f(t.locationId,e),t.value=e)},this.commitFunction[3]=function(t,e){c=t.value,a=e[0],o=e[1],c[0]===a&&c[1]===o||(s.uniform2fv(t.locationId,e),c[0]=a,c[1]=o)},this.commitFunction[4]=function(t,e){c=t.value,a=e[0],o=e[1],l=e[2],c[0]===a&&c[1]===o&&c[2]===l||(s.uniform3fv(t.locationId,e),c[0]=a,c[1]=o,c[2]=l)},this.commitFunction[5]=function(t,e){c=t.value,a=e[0],o=e[1],l=e[2],h=e[3],c[0]===a&&c[1]===o&&c[2]===l&&c[3]===h||(s.uniform4fv(t.locationId,e),c[0]=a,c[1]=o,c[2]=l,c[3]=h)},this.commitFunction[6]=function(t,e){c=t.value,a=e[0],o=e[1],c[0]===a&&c[1]===o||(s.uniform2iv(t.locationId,e),c[0]=a,c[1]=o)},this.commitFunction[9]=this.commitFunction[6],this.commitFunction[7]=function(t,e){c=t.value,a=e[0],o=e[1],l=e[2],c[0]===a&&c[1]===o&&c[2]===l||(s.uniform3iv(t.locationId,e),c[0]=a,c[1]=o,c[2]=l)},this.commitFunction[10]=this.commitFunction[7],this.commitFunction[8]=function(t,e){c=t.value,a=e[0],o=e[1],l=e[2],h=e[3],c[0]===a&&c[1]===o&&c[2]===l&&c[3]===h||(s.uniform4iv(t.locationId,e),c[0]=a,c[1]=o,c[2]=l,c[3]=h)},this.commitFunction[11]=this.commitFunction[8],this.commitFunction[12]=function(t,e){s.uniformMatrix2fv(t.locationId,!1,e)},this.commitFunction[13]=function(t,e){s.uniformMatrix3fv(t.locationId,!1,e)},this.commitFunction[14]=function(t,e){s.uniformMatrix4fv(t.locationId,!1,e)},this.commitFunction[17]=function(t,e){s.uniform1fv(t.locationId,e)},this.commitFunction[21]=function(t,e){s.uniform2fv(t.locationId,e)},this.commitFunction[22]=function(t,e){s.uniform3fv(t.locationId,e)},this.commitFunction[23]=function(t,e){s.uniform4fv(t.locationId,e)},this.scope=new _f("Device"),this.programLib=new ff(this),ue)this.programLib.register(f,ue[f]);this.supportsBoneTextures=this.extTextureFloat&&this.maxVertexTextures>0,this.useTexCubeLod=this.extTextureLod&&this.maxTextures<16;var p=this.vertexUniformsCount;for(p-=16,p-=8,p-=1,p-=16,this.boneLimit=Math.floor(p/3),this.boneLimit=Math.min(this.boneLimit,128),"Mali-450 MP"===this.unmaskedRenderer&&(this.boneLimit=34),this._drawCallsPerFrame=0,this._shaderSwitchesPerFrame=0,this._primsPerFrame=[],i=0;i<=6;i++)this._primsPerFrame[i]=0;this._renderTargetCreationTime=0,this._vram={tex:0,vb:0,ib:0},this._shaderStats={vsCompiled:0,fsCompiled:0,linked:0,materialShaders:0,compileTime:0},this.constantTexSource=this.scope.resolve("source"),this.extTextureFloat?this.webgl2?this.textureFloatRenderable=!!this.extColorBufferFloat:this.textureFloatRenderable=xf(s,s.FLOAT):this.textureFloatRenderable=!1,this.extTextureHalfFloat?this.webgl2?this.textureHalfFloatRenderable=!!this.extColorBufferFloat:this.textureHalfFloatRenderable=xf(s,this.extTextureHalfFloat.HALF_FLOAT_OES):this.textureHalfFloatRenderable=!1,this.supportsMorphTargetTexturesCore="highp"===this.maxPrecision&&this.maxVertexTextures>=2,this._textureFloatHighPrecision=void 0,this._textureHalfFloatUpdatable=void 0,this.grabPassAvailable=!0,this.grabPassApha=e.alpha,this.createGrabPass(),bt.init(this),this._areaLightLutFormat=this.extTextureFloat?14:this.extTextureHalfFloat&&this.textureHalfFloatUpdatable?12:7}getPrecision(){var t=this.gl,e="highp";if(t.getShaderPrecisionFormat){var i=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT),n=t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT),r=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),s=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT),a=i.precision>0&&r.precision>0,o=n.precision>0&&s.precision>0;a||(e=o?"mediump":"lowp")}return e}initializeExtensions(){var t,e=this.gl,i=e.getSupportedExtensions(),n=function(){for(var t=0;t<arguments.length;t++)if(-1!==i.indexOf(arguments[t]))return e.getExtension(arguments[t]);return null};this.webgl2?(this.extBlendMinmax=!0,this.extDrawBuffers=!0,this.extInstancing=!0,this.extStandardDerivatives=!0,this.extTextureFloat=!0,this.extTextureHalfFloat=!0,this.extTextureHalfFloatLinear=!0,this.extTextureLod=!0,this.extUintElement=!0,this.extVertexArrayObject=!0,this.extColorBufferFloat=n("EXT_color_buffer_float"),this.extDisjointTimerQuery=n("EXT_disjoint_timer_query_webgl2","EXT_disjoint_timer_query")):(this.extBlendMinmax=n("EXT_blend_minmax"),this.extDrawBuffers=n("EXT_draw_buffers"),this.extInstancing=n("ANGLE_instanced_arrays"),this.extInstancing&&(t=this.extInstancing,e.drawArraysInstanced=t.drawArraysInstancedANGLE.bind(t),e.drawElementsInstanced=t.drawElementsInstancedANGLE.bind(t),e.vertexAttribDivisor=t.vertexAttribDivisorANGLE.bind(t)),this.extStandardDerivatives=n("OES_standard_derivatives"),this.extTextureFloat=n("OES_texture_float"),this.extTextureHalfFloat=n("OES_texture_half_float"),this.extTextureHalfFloatLinear=n("OES_texture_half_float_linear"),this.extTextureLod=n("EXT_shader_texture_lod"),this.extUintElement=n("OES_element_index_uint"),this.extVertexArrayObject=n("OES_vertex_array_object"),this.extVertexArrayObject&&(t=this.extVertexArrayObject,e.createVertexArray=t.createVertexArrayOES.bind(t),e.deleteVertexArray=t.deleteVertexArrayOES.bind(t),e.isVertexArray=t.isVertexArrayOES.bind(t),e.bindVertexArray=t.bindVertexArrayOES.bind(t)),this.extColorBufferFloat=null,this.extDisjointTimerQuery=null),this.extDebugRendererInfo=n("WEBGL_debug_renderer_info"),this.extTextureFloatLinear=n("OES_texture_float_linear"),this.extFloatBlend=n("EXT_float_blend"),this.extTextureFilterAnisotropic=n("EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"),this.extCompressedTextureETC1=n("WEBGL_compressed_texture_etc1"),this.extCompressedTextureETC=n("WEBGL_compressed_texture_etc"),this.extCompressedTexturePVRTC=n("WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"),this.extCompressedTextureS3TC=n("WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"),this.extCompressedTextureATC=n("WEBGL_compressed_texture_atc"),this.extCompressedTextureASTC=n("WEBGL_compressed_texture_astc"),this.extParallelShaderCompile=n("KHR_parallel_shader_compile"),this.supportsInstancing=!!this.extInstancing}initializeCapabilities(){var t,e=this.gl;this.maxPrecision=this.precision=this.getPrecision();var i=e.getContextAttributes();this.supportsMsaa=i.antialias,this.supportsStencil=i.stencil,this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubeMapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxRenderBufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxCombinedTextures=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.vertexUniformsCount=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.fragmentUniformsCount=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.webgl2?(this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS),this.maxColorAttachments=e.getParameter(e.MAX_COLOR_ATTACHMENTS),this.maxVolumeSize=e.getParameter(e.MAX_3D_TEXTURE_SIZE)):(t=this.extDrawBuffers,this.maxDrawBuffers=t?e.getParameter(t.MAX_DRAW_BUFFERS_EXT):1,this.maxColorAttachments=t?e.getParameter(t.MAX_COLOR_ATTACHMENTS_EXT):1,this.maxVolumeSize=1),t=this.extDebugRendererInfo,this.unmaskedRenderer=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):"",this.unmaskedVendor=t?e.getParameter(t.UNMASKED_VENDOR_WEBGL):"",t=this.extTextureFilterAnisotropic,this.maxAnisotropy=t?e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,this.samples=e.getParameter(e.SAMPLES)}initializeRenderState(){var t=this.gl;this.blending=!1,t.disable(t.BLEND),this.blendSrc=1,this.blendDst=0,this.blendSrcAlpha=1,this.blendDstAlpha=0,this.separateAlphaBlend=!1,this.blendEquation=0,this.blendAlphaEquation=0,this.separateAlphaEquation=!1,t.blendFunc(t.ONE,t.ZERO),t.blendEquation(t.FUNC_ADD),this.writeRed=!0,this.writeGreen=!0,this.writeBlue=!0,this.writeAlpha=!0,t.colorMask(!0,!0,!0,!0),this.cullMode=1,t.enable(t.CULL_FACE),t.cullFace(t.BACK),this.depthTest=!0,t.enable(t.DEPTH_TEST),this.depthFunc=3,t.depthFunc(t.LEQUAL),this.depthWrite=!0,t.depthMask(!0),this.stencil=!1,t.disable(t.STENCIL_TEST),this.stencilFuncFront=this.stencilFuncBack=7,this.stencilRefFront=this.stencilRefBack=0,this.stencilMaskFront=this.stencilMaskBack=255,t.stencilFunc(t.ALWAYS,0,255),this.stencilFailFront=this.stencilFailBack=0,this.stencilZfailFront=this.stencilZfailBack=0,this.stencilZpassFront=this.stencilZpassBack=0,this.stencilWriteMaskFront=255,this.stencilWriteMaskBack=255,t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.stencilMask(255),this.alphaToCoverage=!1,this.raster=!0,this.webgl2&&(t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.RASTERIZER_DISCARD)),this.depthBiasEnabled=!1,t.disable(t.POLYGON_OFFSET_FILL),this.clearDepth=1,t.clearDepth(1),this.clearRed=0,this.clearBlue=0,this.clearGreen=0,this.clearAlpha=0,t.clearColor(0,0,0,0),this.clearStencil=0,t.clearStencil(0),this.vx=this.vy=this.vw=this.vh=0,this.sx=this.sy=this.sw=this.sh=0,this.webgl2?t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.NICEST):this.extStandardDerivatives&&t.hint(this.extStandardDerivatives.FRAGMENT_SHADER_DERIVATIVE_HINT_OES,t.NICEST),t.enable(t.SCISSOR_TEST),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),this.unpackFlipY=!1,t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),this.unpackPremultiplyAlpha=!1,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1)}initializeContextCaches(){this.vertexShaderCache={},this.fragmentShaderCache={},this._vaoMap=new Map,this.boundVao=null,this.indexBuffer=null,this.vertexBuffers=[],this.shader=null,this.renderTarget=null,this.activeFramebuffer=null,this.feedback=null,this.transformFeedbackBuffer=null,this.textureUnit=0,this.textureUnits=[];for(var t=0;t<this.maxCombinedTextures;t++)this.textureUnits.push([null,null,null])}loseContext(){var t;for(t=0;t<this.shaders.length;t++)this.shaders[t].loseContext();for(this.destroyGrabPass();this.textures.length>0;){var e=this.textures[0];this.destroyTexture(e),e.dirtyAll()}for(t=0;t<this.buffers.length;t++)this.buffers[t].loseContext();for(t=0;t<this.targets.length;t++)this.targets[t].loseContext()}restoreContext(){var t,e;for(this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState(),this.initializeContextCaches(),t=0,e=this.shaders.length;t<e;t++)this.compileAndLinkShader(this.shaders[t]);for(t=0,e=this.buffers.length;t<e;t++)this.buffers[t].unlock();this.createGrabPass()}createGrabPass(){if(!this.grabPassTexture){var t=new pe(this,{format:!1===this.grabPassApha?6:7,minFilter:1,magFilter:1,addressU:1,addressV:1,mipmaps:!1});t.name="texture_grabPass";var e=this.scope.resolve(t.name);e.setValue(t);var i=new Cf({colorBuffer:t,depth:!1});this.grabPassRenderTarget=i,this.grabPassTextureId=e,this.grabPassTexture=t}}updateGrabPass(){var t=this.gl;if(!this.grabPassAvailable)return!1;var e=this.renderTarget,i=e&&e._glResolveFrameBuffer,n=this.grabPassTexture,r=this.width,s=this.height;if(this.webgl2&&!this._tempMacChromeBlitFramebufferWorkaround&&r===n._width&&s===n._height){i&&e.resolve(!0);var a=e?e._glFrameBuffer:null,o=e?e._glResolveFrameBuffer||e._glFrameBuffer:null;this.initRenderTarget(this.grabPassRenderTarget);var l=this.grabPassRenderTarget._glFrameBuffer;t.bindFramebuffer(t.READ_FRAMEBUFFER,o),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,l),t.blitFramebuffer(0,0,r,s,0,0,r,s,t.COLOR_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,a)}else{i&&(e.resolve(!0),t.bindFramebuffer(t.FRAMEBUFFER,e._glResolveFrameBuffer));var h=n._glFormat;t.copyTexImage2D(t.TEXTURE_2D,0,h,0,0,r,s,0),n._width=r,n._height=s,i&&t.bindFramebuffer(t.FRAMEBUFFER,e._glFrameBuffer)}return!0}destroyGrabPass(){this.grabPassRenderTarget.destroy(),this.grabPassRenderTarget=null,this.grabPassTextureId=null,this.grabPassTexture.destroy(),this.grabPassTexture=null}updateClientRect(){this.clientRect=this.canvas.getBoundingClientRect()}setViewport(t,e,i,n){this.vx===t&&this.vy===e&&this.vw===i&&this.vh===n||(this.gl.viewport(t,e,i,n),this.vx=t,this.vy=e,this.vw=i,this.vh=n)}setScissor(t,e,i,n){this.sx===t&&this.sy===e&&this.sw===i&&this.sh===n||(this.gl.scissor(t,e,i,n),this.sx=t,this.sy=e,this.sw=i,this.sh=n)}getProgramLibrary(){return this.programLib}setProgramLibrary(t){this.programLib=t}setFramebuffer(t){this.activeFramebuffer!==t&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.activeFramebuffer=t)}_checkFbo(){var t=this.gl;switch(t.checkFramebufferStatus(t.FRAMEBUFFER)){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case t.FRAMEBUFFER_UNSUPPORTED:console.error("ERROR: FRAMEBUFFER_UNSUPPORTED");break;case t.FRAMEBUFFER_COMPLETE:}}copyRenderTarget(t,e,i,n){var r=this.gl;if(!this.webgl2&&n)return!1;if(i)if(e){if(!t._colorBuffer||!e._colorBuffer)return!1;if(t._colorBuffer._format!==e._colorBuffer._format)return!1}else if(!t._colorBuffer)return!1;if(n){if(!t._depthBuffer||!e._depthBuffer)return!1;if(t._depthBuffer._format!==e._depthBuffer._format)return!1}if(this.webgl2&&e){var s=this.renderTarget;this.renderTarget=e,this.updateBegin(),r.bindFramebuffer(r.READ_FRAMEBUFFER,t?t._glFrameBuffer:null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e._glFrameBuffer);var a=t?t.width:e.width,o=t?t.height:e.height;r.blitFramebuffer(0,0,a,o,0,0,a,o,(i?r.COLOR_BUFFER_BIT:0)|(n?r.DEPTH_BUFFER_BIT:0),r.NEAREST),this.renderTarget=s,r.bindFramebuffer(r.FRAMEBUFFER,s?s._glFrameBuffer:null)}else{var l=this.getCopyShader();this.constantTexSource.setValue(t._colorBuffer),zt(this,e,l)}return!0}initRenderTarget(t){if(!t._glFrameBuffer){t._device=this;var e=this.gl;t._glFrameBuffer=e.createFramebuffer(),this.setFramebuffer(t._glFrameBuffer);var i=t._colorBuffer;i&&(i._glTexture||(i._width=Math.min(i.width,this.maxRenderBufferSize),i._height=Math.min(i.height,this.maxRenderBufferSize),this.setTexture(i,0)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,i._cubemap?e.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:e.TEXTURE_2D,i._glTexture,0));var n=t._depthBuffer;if(n&&this.webgl2)n._glTexture||(n._width=Math.min(n.width,this.maxRenderBufferSize),n._height=Math.min(n.height,this.maxRenderBufferSize),this.setTexture(n,0)),t._stencil?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,n._cubemap?e.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:e.TEXTURE_2D,t._depthBuffer._glTexture,0):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,n._cubemap?e.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:e.TEXTURE_2D,t._depthBuffer._glTexture,0);else if(t._depth){t._samples>1&&this.webgl2||(t._glDepthBuffer||(t._glDepthBuffer=e.createRenderbuffer()),e.bindRenderbuffer(e.RENDERBUFFER,t._glDepthBuffer),t._stencil?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t._glDepthBuffer)):(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t._glDepthBuffer)),e.bindRenderbuffer(e.RENDERBUFFER,null))}this.webgl2&&t._samples>1&&(t._glResolveFrameBuffer=t._glFrameBuffer,t._glFrameBuffer=e.createFramebuffer(),this.setFramebuffer(t._glFrameBuffer),i&&(t._glMsaaColorBuffer||(t._glMsaaColorBuffer=e.createRenderbuffer()),e.bindRenderbuffer(e.RENDERBUFFER,t._glMsaaColorBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,t._samples,i._glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,t._glMsaaColorBuffer)),t._depth&&(t._glMsaaDepthBuffer||(t._glMsaaDepthBuffer=e.createRenderbuffer()),e.bindRenderbuffer(e.RENDERBUFFER,t._glMsaaDepthBuffer),t._stencil?(e.renderbufferStorageMultisample(e.RENDERBUFFER,t._samples,e.DEPTH24_STENCIL8,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t._glMsaaDepthBuffer)):(e.renderbufferStorageMultisample(e.RENDERBUFFER,t._samples,e.DEPTH_COMPONENT32F,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t._glMsaaDepthBuffer)))),this.targets.push(t)}}getCopyShader(){return this._copyShader||(this._copyShader=Jt(this,Ft.fullscreenQuadVS,Ft.outputTex2DPS,"outputTex2D")),this._copyShader}updateBegin(){if(this.boundVao=null,this._tempEnableSafariTextureUnitWorkaround)for(var t=0;t<this.textureUnits.length;++t)for(var e=0;e<3;++e)this.textureUnits[t][e]=null;var i=this.renderTarget;i?i._glFrameBuffer?this.setFramebuffer(i._glFrameBuffer):this.initRenderTarget(i):this.setFramebuffer(this.defaultFramebuffer)}updateEnd(){var t=this.gl;this.boundVao=null,this.gl.bindVertexArray(null);var e=this.renderTarget;if(e){var i=e._colorBuffer;i&&i._glTexture&&i.mipmaps&&i.pot&&(this.activeTexture(this.maxCombinedTextures-1),this.bindTexture(i),t.generateMipmap(i._glTarget)),this.webgl2&&e._samples>1&&e.autoResolve&&e.resolve()}}initializeTexture(t){var e,i=this.gl;switch(t._glTexture=i.createTexture(),t._glTarget=t._cubemap?i.TEXTURE_CUBE_MAP:t._volume?i.TEXTURE_3D:i.TEXTURE_2D,t._format){case 0:t._glFormat=i.ALPHA,t._glInternalFormat=i.ALPHA,t._glPixelType=i.UNSIGNED_BYTE;break;case 1:t._glFormat=i.LUMINANCE,t._glInternalFormat=i.LUMINANCE,t._glPixelType=i.UNSIGNED_BYTE;break;case 2:t._glFormat=i.LUMINANCE_ALPHA,t._glInternalFormat=i.LUMINANCE_ALPHA,t._glPixelType=i.UNSIGNED_BYTE;break;case 3:t._glFormat=i.RGB,t._glInternalFormat=i.RGB,t._glPixelType=i.UNSIGNED_SHORT_5_6_5;break;case 4:t._glFormat=i.RGBA,t._glInternalFormat=i.RGBA,t._glPixelType=i.UNSIGNED_SHORT_5_5_5_1;break;case 5:t._glFormat=i.RGBA,t._glInternalFormat=i.RGBA,t._glPixelType=i.UNSIGNED_SHORT_4_4_4_4;break;case 6:t._glFormat=i.RGB,t._glInternalFormat=this.webgl2?i.RGB8:i.RGB,t._glPixelType=i.UNSIGNED_BYTE;break;case 7:t._glFormat=i.RGBA,t._glInternalFormat=this.webgl2?i.RGBA8:i.RGBA,t._glPixelType=i.UNSIGNED_BYTE;break;case 8:e=this.extCompressedTextureS3TC,t._glFormat=i.RGB,t._glInternalFormat=e.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 9:e=this.extCompressedTextureS3TC,t._glFormat=i.RGBA,t._glInternalFormat=e.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case 10:e=this.extCompressedTextureS3TC,t._glFormat=i.RGBA,t._glInternalFormat=e.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 21:e=this.extCompressedTextureETC1,t._glFormat=i.RGB,t._glInternalFormat=e.COMPRESSED_RGB_ETC1_WEBGL;break;case 24:e=this.extCompressedTexturePVRTC,t._glFormat=i.RGB,t._glInternalFormat=e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 25:e=this.extCompressedTexturePVRTC,t._glFormat=i.RGBA,t._glInternalFormat=e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 26:e=this.extCompressedTexturePVRTC,t._glFormat=i.RGB,t._glInternalFormat=e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 27:e=this.extCompressedTexturePVRTC,t._glFormat=i.RGBA,t._glInternalFormat=e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;case 22:e=this.extCompressedTextureETC,t._glFormat=i.RGB,t._glInternalFormat=e.COMPRESSED_RGB8_ETC2;break;case 23:e=this.extCompressedTextureETC,t._glFormat=i.RGBA,t._glInternalFormat=e.COMPRESSED_RGBA8_ETC2_EAC;break;case 28:e=this.extCompressedTextureASTC,t._glFormat=i.RGBA,t._glInternalFormat=e.COMPRESSED_RGBA_ASTC_4x4_KHR;break;case 29:e=this.extCompressedTextureATC,t._glFormat=i.RGB,t._glInternalFormat=e.COMPRESSED_RGB_ATC_WEBGL;break;case 30:e=this.extCompressedTextureATC,t._glFormat=i.RGBA,t._glInternalFormat=e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL;break;case 11:e=this.extTextureHalfFloat,t._glFormat=i.RGB,this.webgl2?(t._glInternalFormat=i.RGB16F,t._glPixelType=i.HALF_FLOAT):(t._glInternalFormat=i.RGB,t._glPixelType=e.HALF_FLOAT_OES);break;case 12:e=this.extTextureHalfFloat,t._glFormat=i.RGBA,this.webgl2?(t._glInternalFormat=i.RGBA16F,t._glPixelType=i.HALF_FLOAT):(t._glInternalFormat=i.RGBA,t._glPixelType=e.HALF_FLOAT_OES);break;case 13:t._glFormat=i.RGB,this.webgl2?t._glInternalFormat=i.RGB32F:t._glInternalFormat=i.RGB,t._glPixelType=i.FLOAT;break;case 14:t._glFormat=i.RGBA,this.webgl2?t._glInternalFormat=i.RGBA32F:t._glInternalFormat=i.RGBA,t._glPixelType=i.FLOAT;break;case 15:t._glFormat=i.RED,t._glInternalFormat=i.R32F,t._glPixelType=i.FLOAT;break;case 16:this.webgl2?(t._glFormat=i.DEPTH_COMPONENT,t._glInternalFormat=i.DEPTH_COMPONENT32F,t._glPixelType=i.FLOAT):(t._glFormat=i.DEPTH_COMPONENT,t._glInternalFormat=i.DEPTH_COMPONENT,t._glPixelType=i.UNSIGNED_SHORT);break;case 17:t._glFormat=i.DEPTH_STENCIL,t._glInternalFormat=i.DEPTH24_STENCIL8,t._glPixelType=i.UNSIGNED_INT_24_8;break;case 18:t._glFormat=i.RGB,t._glInternalFormat=i.R11F_G11F_B10F,t._glPixelType=i.FLOAT;break;case 19:t._glFormat=i.RGB,t._glInternalFormat=i.SRGB8,t._glPixelType=i.UNSIGNED_BYTE;break;case 20:t._glFormat=i.RGBA,t._glInternalFormat=i.SRGB8_ALPHA8,t._glPixelType=i.UNSIGNED_BYTE}this.textures.push(t)}destroyTexture(t){if(t._glTexture){var e=this.textures.indexOf(t);for(var i in-1!==e&&this.textures.splice(e,1),this.scope.variables){var n=this.scope.variables[i];n.value===t&&(n.value=null)}for(var r=0;r<this.textureUnits.length;r++)for(var s=this.textureUnits[r],a=0;a<s.length;a++)s[a]===t._glTexture&&(s[a]=null);this.gl.deleteTexture(t._glTexture),delete t._glTexture,delete t._glTarget,delete t._glFormat,delete t._glInternalFormat,delete t._glPixelType,this._vram.tex-=t._gpuSize}}setUnpackFlipY(t){if(this.unpackFlipY!==t){this.unpackFlipY=t;var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t)}}setUnpackPremultiplyAlpha(t){if(this.unpackPremultiplyAlpha!==t){this.unpackPremultiplyAlpha=t;var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t)}}_isBrowserInterface(t){return"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}uploadTexture(t){var e=this.gl;if(t._needsUpload||!(t._needsMipmapsUpload&&t._mipmapsUploaded||!t.pot)){for(var i,n,r=0,s=Math.log2(Math.max(t._width,t._height))+1;t._levels[r]||0===r;)if(t._needsUpload||0!==r){if(r&&(!t._needsMipmapsUpload||!t._mipmaps))break;var a;if(i=t._levels[r],1==r&&!t._compressed&&t._levels.length<s&&(e.generateMipmap(t._glTarget),t._mipmapsUploaded=!0),t._cubemap){if(this._isBrowserInterface(i[0])){for(a=0;a<6;a++)if(t._levelsUpdated[0][a]){var o=i[a];o instanceof HTMLImageElement&&(o.width>this.maxCubeMapSize||o.height>this.maxCubeMapSize)&&(o=bf(o,this.maxCubeMapSize),0===r&&(t._width=o.width,t._height=o.height)),this.setUnpackFlipY(!1),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+a,r,t._glInternalFormat,t._glFormat,t._glPixelType,o)}}else for(n=1/Math.pow(2,r),a=0;a<6;a++)if(t._levelsUpdated[0][a]){var l=i[a];t._compressed?e.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+a,r,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),0,l):(this.setUnpackFlipY(!1),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+a,r,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),0,t._glFormat,t._glPixelType,l))}}else t._volume?(n=1/Math.pow(2,r),t._compressed?e.compressedTexImage3D(e.TEXTURE_3D,r,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),Math.max(t._depth*n,1),0,i):(this.setUnpackFlipY(!1),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage3D(e.TEXTURE_3D,r,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),Math.max(t._depth*n,1),0,t._glFormat,t._glPixelType,i))):(this._isBrowserInterface(i)?(i instanceof HTMLImageElement&&(i.width>this.maxTextureSize||i.height>this.maxTextureSize)&&(i=bf(i,this.maxTextureSize),0===r&&(t._width=i.width,t._height=i.height)),this.setUnpackFlipY(t._flipY),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_2D,r,t._glInternalFormat,t._glFormat,t._glPixelType,i)):(n=1/Math.pow(2,r),t._compressed?e.compressedTexImage2D(e.TEXTURE_2D,r,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),0,i):(this.setUnpackFlipY(!1),this.setUnpackPremultiplyAlpha(t._premultiplyAlpha),e.texImage2D(e.TEXTURE_2D,r,t._glInternalFormat,Math.max(t._width*n,1),Math.max(t._height*n,1),0,t._glFormat,t._glPixelType,i))),t._mipmapsUploaded=0!==r);r++}else r++;if(t._needsUpload)if(t._cubemap)for(var h=0;h<6;h++)t._levelsUpdated[0][h]=!1;else t._levelsUpdated[0]=!1;!t._compressed&&t._mipmaps&&t._needsMipmapsUpload&&t.pot&&1===t._levels.length&&(e.generateMipmap(t._glTarget),t._mipmapsUploaded=!0),t._gpuSize&&(this._vram.tex-=t._gpuSize),t._gpuSize=t.gpuSize,this._vram.tex+=t._gpuSize}}activeTexture(t){this.textureUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.textureUnit=t)}bindTexture(t){var e=t._glTarget,i=t._glTexture,n=this.textureUnit,r=this.targetToSlot[e];this.textureUnits[n][r]!==i&&(this.gl.bindTexture(e,i),this.textureUnits[n][r]=i)}bindTextureOnUnit(t,e){var i=t._glTarget,n=t._glTexture,r=this.targetToSlot[i];this.textureUnits[e][r]!==n&&(this.activeTexture(e),this.gl.bindTexture(i,n),this.textureUnits[e][r]=n)}setTextureParameters(t){var e=this.gl,i=t._parameterFlags,n=t._glTarget;if(1&i){var r=t._minFilter;(!t.pot||!t._mipmaps||t._compressed&&1===t._levels.length)&&(2===r||3===r?r=0:4!==r&&5!==r||(r=1)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,this.glFilter[r])}if(2&i&&e.texParameteri(n,e.TEXTURE_MAG_FILTER,this.glFilter[t._magFilter]),4&i&&(this.webgl2?e.texParameteri(n,e.TEXTURE_WRAP_S,this.glAddress[t._addressU]):e.texParameteri(n,e.TEXTURE_WRAP_S,this.glAddress[t.pot?t._addressU:1])),8&i&&(this.webgl2?e.texParameteri(n,e.TEXTURE_WRAP_T,this.glAddress[t._addressV]):e.texParameteri(n,e.TEXTURE_WRAP_T,this.glAddress[t.pot?t._addressV:1])),16&i&&this.webgl2&&e.texParameteri(n,e.TEXTURE_WRAP_R,this.glAddress[t._addressW]),32&i&&this.webgl2&&e.texParameteri(n,e.TEXTURE_COMPARE_MODE,t._compareOnRead?e.COMPARE_REF_TO_TEXTURE:e.NONE),64&i&&this.webgl2&&e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,this.glComparison[t._compareFunc]),128&i){var s=this.extTextureFilterAnisotropic;s&&e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.max(1,Math.min(Math.round(t._anisotropy),this.maxAnisotropy)))}}setTexture(t,e){if(t._glTexture||this.initializeTexture(t),t._parameterFlags>0||t._needsUpload||t._needsMipmapsUpload||t===this.grabPassTexture){this.activeTexture(e),this.bindTexture(t),t._parameterFlags&&(this.setTextureParameters(t),t._parameterFlags=0);var i=!1;t===this.grabPassTexture&&(i=this.updateGrabPass(),i=!0),i||!t._needsUpload&&!t._needsMipmapsUpload||(this.uploadTexture(t),t._needsUpload=!1,t._needsMipmapsUpload=!1)}else this.bindTextureOnUnit(t,e)}createVertexArray(t){var e,i,n,r,s=t.length>1;if(s){for(n="",e=0;e<t.length;e++)n+=(i=t[e]).id+i.format.renderingingHash;r=this._vaoMap.get(n)}if(!r){var a,o,l=this.gl;for(r=l.createVertexArray(),l.bindVertexArray(r),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),e=0;e<t.length;e++){i=t[e],l.bindBuffer(l.ARRAY_BUFFER,i.bufferId),o=i.format.elements;for(var h=0;h<o.length;h++){a=o[h];var c=gt[a.name];l.vertexAttribPointer(c,a.numComponents,this.glType[a.dataType],a.normalize,a.stride,a.offset),l.enableVertexAttribArray(c),i.instancing&&l.vertexAttribDivisor(c,1)}}l.bindVertexArray(null),l.bindBuffer(l.ARRAY_BUFFER,null),s&&this._vaoMap.set(n,r)}return r}setBuffers(){var t,e,i=this.gl;1===this.vertexBuffers.length?((t=this.vertexBuffers[0])._vao||(t._vao=this.createVertexArray(this.vertexBuffers)),e=t._vao):e=this.createVertexArray(this.vertexBuffers),this.boundVao!==e&&(this.boundVao=e,i.bindVertexArray(e)),this.vertexBuffers.length=0;var n=this.indexBuffer?this.indexBuffer.bufferId:null;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n)}draw(t,e,i){var n,r,s,a,o,l,h,c,u,d,f,p=this.gl,m=this.shader,g=m.samplers,v=m.uniforms;i||this.setBuffers();var _=0;for(n=0,s=g.length;n<s;n++)if(o=(a=g[n]).scopeId.value)if(o instanceof pe)l=o,this.setTexture(l,_),a.slot!==_&&(p.uniform1i(a.locationId,_),a.slot=_),_++;else{for(a.array.length=0,h=o.length,r=0;r<h;r++)l=o[r],this.setTexture(l,_),a.array[r]=_,_++;p.uniform1iv(a.locationId,a.array)}for(n=0,s=v.length;n<s;n++)u=(c=v[n]).scopeId,d=c.version,f=u.versionObject.version,d.globalId===f.globalId&&d.revision===f.revision||(d.globalId=f.globalId,d.revision=f.revision,null!==u.value&&this.commitFunction[c.dataType](c,u.value));this.webgl2&&this.transformFeedbackBuffer&&(p.bindBufferBase(p.TRANSFORM_FEEDBACK_BUFFER,0,this.transformFeedbackBuffer.bufferId),p.beginTransformFeedback(p.POINTS));var y=this.glPrimitive[t.type],b=t.count;if(t.indexed){var x=this.indexBuffer,w=x.glFormat,A=t.base*x.bytesPerIndex;e>0?p.drawElementsInstanced(y,b,w,A,e):p.drawElements(y,b,w,A)}else{var C=t.base;e>0?p.drawArraysInstanced(y,C,b,e):p.drawArrays(y,C,b)}this.webgl2&&this.transformFeedbackBuffer&&(p.endTransformFeedback(),p.bindBufferBase(p.TRANSFORM_FEEDBACK_BUFFER,0,null)),this._drawCallsPerFrame++}clear(t){var e=this.defaultClearOptions,i=null==(t=t||e).flags?e.flags:t.flags;if(0!==i){var n=this.gl;if(1&i){var r=null==t.color?e.color:t.color;this.setClearColor(r[0],r[1],r[2],r[3])}if(2&i){var s=null==t.depth?e.depth:t.depth;this.setClearDepth(s),this.depthWrite||n.depthMask(!0)}if(4&i){var a=null==t.stencil?e.stencil:t.stencil;this.setClearStencil(a)}n.clear(this.glClearFlag[i]),2&i&&(this.depthWrite||n.depthMask(!1))}}readPixels(t,e,i,n,r){var s=this.gl;s.readPixels(t,e,i,n,s.RGBA,s.UNSIGNED_BYTE,r)}setClearDepth(t){t!==this.clearDepth&&(this.gl.clearDepth(t),this.clearDepth=t)}setClearColor(t,e,i,n){t===this.clearRed&&e===this.clearGreen&&i===this.clearBlue&&n===this.clearAlpha||(this.gl.clearColor(t,e,i,n),this.clearRed=t,this.clearGreen=e,this.clearBlue=i,this.clearAlpha=n)}setClearStencil(t){t!==this.clearStencil&&(this.gl.clearStencil(t),this.clearStencil=t)}setRenderTarget(t){this.renderTarget=t}getRenderTarget(){return this.renderTarget}getDepthTest(){return this.depthTest}setDepthTest(t){if(this.depthTest!==t){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.depthTest=t}}setDepthFunc(t){this.depthFunc!==t&&(this.gl.depthFunc(this.glComparison[t]),this.depthFunc=t)}getDepthWrite(){return this.depthWrite}setDepthWrite(t){this.depthWrite!==t&&(this.gl.depthMask(t),this.depthWrite=t)}setColorWrite(t,e,i,n){this.writeRed===t&&this.writeGreen===e&&this.writeBlue===i&&this.writeAlpha===n||(this.gl.colorMask(t,e,i,n),this.writeRed=t,this.writeGreen=e,this.writeBlue=i,this.writeAlpha=n)}setAlphaToCoverage(t){this.webgl2&&this.alphaToCoverage!==t&&(this.alphaToCoverage=t,t?this.gl.enable(this.gl.SAMPLE_ALPHA_TO_COVERAGE):this.gl.disable(this.gl.SAMPLE_ALPHA_TO_COVERAGE))}setTransformFeedbackBuffer(t){if(this.transformFeedbackBuffer!==t&&(this.transformFeedbackBuffer=t,this.webgl2)){var e=this.gl;t?(this.feedback||(this.feedback=e.createTransformFeedback()),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.feedback)):e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}}setRaster(t){this.raster!==t&&(this.raster=t,this.webgl2&&(t?this.gl.disable(this.gl.RASTERIZER_DISCARD):this.gl.enable(this.gl.RASTERIZER_DISCARD)))}setDepthBias(t){this.depthBiasEnabled!==t&&(this.depthBiasEnabled=t,t?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL))}setDepthBiasValues(t,e){this.gl.polygonOffset(e,t)}getBlending(){return this.blending}setBlending(t){if(this.blending!==t){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.blending=t}}setStencilTest(t){if(this.stencil!==t){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.stencil=t}}setStencilFunc(t,e,i){this.stencilFuncFront===t&&this.stencilRefFront===e&&this.stencilMaskFront===i&&this.stencilFuncBack===t&&this.stencilRefBack===e&&this.stencilMaskBack===i||(this.gl.stencilFunc(this.glComparison[t],e,i),this.stencilFuncFront=this.stencilFuncBack=t,this.stencilRefFront=this.stencilRefBack=e,this.stencilMaskFront=this.stencilMaskBack=i)}setStencilFuncFront(t,e,i){if(this.stencilFuncFront!==t||this.stencilRefFront!==e||this.stencilMaskFront!==i){var n=this.gl;n.stencilFuncSeparate(n.FRONT,this.glComparison[t],e,i),this.stencilFuncFront=t,this.stencilRefFront=e,this.stencilMaskFront=i}}setStencilFuncBack(t,e,i){if(this.stencilFuncBack!==t||this.stencilRefBack!==e||this.stencilMaskBack!==i){var n=this.gl;n.stencilFuncSeparate(n.BACK,this.glComparison[t],e,i),this.stencilFuncBack=t,this.stencilRefBack=e,this.stencilMaskBack=i}}setStencilOperation(t,e,i,n){this.stencilFailFront===t&&this.stencilZfailFront===e&&this.stencilZpassFront===i&&this.stencilFailBack===t&&this.stencilZfailBack===e&&this.stencilZpassBack===i||(this.gl.stencilOp(this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailFront=this.stencilFailBack=t,this.stencilZfailFront=this.stencilZfailBack=e,this.stencilZpassFront=this.stencilZpassBack=i),this.stencilWriteMaskFront===n&&this.stencilWriteMaskBack===n||(this.gl.stencilMask(n),this.stencilWriteMaskFront=n,this.stencilWriteMaskBack=n)}setStencilOperationFront(t,e,i,n){this.stencilFailFront===t&&this.stencilZfailFront===e&&this.stencilZpassFront===i||(this.gl.stencilOpSeparate(this.gl.FRONT,this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailFront=t,this.stencilZfailFront=e,this.stencilZpassFront=i),this.stencilWriteMaskFront!==n&&(this.gl.stencilMaskSeparate(this.gl.FRONT,n),this.stencilWriteMaskFront=n)}setStencilOperationBack(t,e,i,n){this.stencilFailBack===t&&this.stencilZfailBack===e&&this.stencilZpassBack===i||(this.gl.stencilOpSeparate(this.gl.BACK,this.glStencilOp[t],this.glStencilOp[e],this.glStencilOp[i]),this.stencilFailBack=t,this.stencilZfailBack=e,this.stencilZpassBack=i),this.stencilWriteMaskBack!==n&&(this.gl.stencilMaskSeparate(this.gl.BACK,n),this.stencilWriteMaskBack=n)}setBlendFunction(t,e){(this.blendSrc!==t||this.blendDst!==e||this.separateAlphaBlend)&&(this.gl.blendFunc(this.glBlendFunction[t],this.glBlendFunction[e]),this.blendSrc=t,this.blendDst=e,this.separateAlphaBlend=!1)}setBlendFunctionSeparate(t,e,i,n){this.blendSrc===t&&this.blendDst===e&&this.blendSrcAlpha===i&&this.blendDstAlpha===n&&this.separateAlphaBlend||(this.gl.blendFuncSeparate(this.glBlendFunction[t],this.glBlendFunction[e],this.glBlendFunction[i],this.glBlendFunction[n]),this.blendSrc=t,this.blendDst=e,this.blendSrcAlpha=i,this.blendDstAlpha=n,this.separateAlphaBlend=!0)}setBlendEquation(t){(this.blendEquation!==t||this.separateAlphaEquation)&&(this.gl.blendEquation(this.glBlendEquation[t]),this.blendEquation=t,this.separateAlphaEquation=!1)}setBlendEquationSeparate(t,e){this.blendEquation===t&&this.blendAlphaEquation===e&&this.separateAlphaEquation||(this.gl.blendEquationSeparate(this.glBlendEquation[t],this.glBlendEquation[e]),this.blendEquation=t,this.blendAlphaEquation=e,this.separateAlphaEquation=!0)}setCullMode(t){if(this.cullMode!==t){if(0===t)this.gl.disable(this.gl.CULL_FACE);else{0===this.cullMode&&this.gl.enable(this.gl.CULL_FACE);var e=this.glCull[t];this.cullFace!==e&&(this.gl.cullFace(e),this.cullFace=e)}this.cullMode=t}}getCullMode(){return this.cullMode}setIndexBuffer(t){this.indexBuffer=t}setVertexBuffer(t){t&&this.vertexBuffers.push(t)}compileShaderSource(t,e){var i=this.gl,n=e?this.vertexShaderCache[t]:this.fragmentShaderCache[t];return n||(n=i.createShader(e?i.VERTEX_SHADER:i.FRAGMENT_SHADER),i.shaderSource(n,t),i.compileShader(n),e?this.vertexShaderCache[t]=n:this.fragmentShaderCache[t]=n),n}compileAndLinkShader(t){var e,i=this.gl,n=t.definition,r=n.attributes,s=this.compileShaderSource(n.vshader,!0),a=this.compileShaderSource(n.fshader,!1),o=i.createProgram();if(i.attachShader(o,s),i.attachShader(o,a),this.webgl2&&n.useTransformFeedback){var l=[];for(e in r)r.hasOwnProperty(e)&&l.push("out_"+e);i.transformFeedbackVaryings(o,l,i.INTERLEAVED_ATTRIBS)}for(e in r)if(r.hasOwnProperty(e)){var h=r[e],c=gt[h];i.bindAttribLocation(o,c,e)}i.linkProgram(o),t._glVertexShader=s,t._glFragmentShader=a,t._glProgram=o}createShader(t){this.compileAndLinkShader(t),this.shaders.push(t)}destroyShader(t){var e=this.shaders.indexOf(t);-1!==e&&this.shaders.splice(e,1),t._glProgram&&(this.gl.deleteProgram(t._glProgram),t._glProgram=null,this.removeShaderFromCache(t))}_addLineNumbers(t){for(var e=t.split("\n"),i=0,n=e.length;i<n;i++)e[i]=i+1+":\t"+e[i];return e.join("\n")}postLink(t){var e,i,n,r,s=this.gl,a=t._glVertexShader,o=t._glFragmentShader,l=t._glProgram,h=t.definition;if(!s.getShaderParameter(a,s.COMPILE_STATUS))return console.error("Failed to compile vertex shader:\n\n"+this._addLineNumbers(h.vshader)+"\n\n"+s.getShaderInfoLog(a)),!1;if(!s.getShaderParameter(o,s.COMPILE_STATUS))return console.error("Failed to compile fragment shader:\n\n"+this._addLineNumbers(h.fshader)+"\n\n"+s.getShaderInfoLog(o)),!1;if(!s.getProgramParameter(l,s.LINK_STATUS))return console.error("Failed to link shader program. Error: "+s.getProgramInfoLog(l)),!1;e=0;for(var c=s.getProgramParameter(l,s.ACTIVE_ATTRIBUTES);e<c;)i=s.getActiveAttrib(l,e++),n=s.getAttribLocation(l,i.name),void 0===h.attributes[i.name]&&console.error('Vertex shader attribute "'+i.name+'" is not mapped to a semantic in shader definition.'),r=new yf(this,h.attributes[i.name],this.pcUniformType[i.type],n),t.attributes.push(r);e=0;for(var u=s.getProgramParameter(l,s.ACTIVE_UNIFORMS);e<u;)i=s.getActiveUniform(l,e++),n=s.getUniformLocation(l,i.name),r=new yf(this,i.name,this.pcUniformType[i.type],n),i.type===s.SAMPLER_2D||i.type===s.SAMPLER_CUBE||this.webgl2&&(i.type===s.SAMPLER_2D_SHADOW||i.type===s.SAMPLER_CUBE_SHADOW||i.type===s.SAMPLER_3D)?t.samplers.push(r):t.uniforms.push(r);return t.ready=!0,!0}setShader(t){if(t!==this.shader){if(!t.ready&&!this.postLink(t))return!1;this.shader=t,this.gl.useProgram(t._glProgram),this.attributesInvalidated=!0}return!0}getHdrFormat(){return this.textureHalfFloatRenderable?12:this.textureFloatRenderable?14:7}getBoneLimit(){return this.boneLimit}setBoneLimit(t){this.boneLimit=t}resizeCanvas(t,e){this._width=t,this._height=e;var i=Math.min(this._maxPixelRatio,window.devicePixelRatio);t*=i,e*=i,this.canvas.width===t&&this.canvas.height===e||(this.canvas.width=t,this.canvas.height=e,this.fire("resizecanvas",t,e))}setResolution(t,e){this._width=t,this._height=e,this.canvas.width=t,this.canvas.height=e,this.fire("resizecanvas",t,e)}clearShaderCache(){var t,e=this.gl;for(t in this.fragmentShaderCache)e.deleteShader(this.fragmentShaderCache[t]),delete this.fragmentShaderCache[t];for(t in this.vertexShaderCache)e.deleteShader(this.vertexShaderCache[t]),delete this.vertexShaderCache[t];this.programLib.clearCache()}clearVertexArrayObjectCache(){var t=this.gl;this._vaoMap.forEach((function(e,i,n){t.deleteVertexArray(e)})),this._vaoMap.clear()}removeShaderFromCache(t){this.programLib.removeFromCache(t)}destroy(){var t=this.gl;this.destroyGrabPass(),this.webgl2&&this.feedback&&t.deleteTransformFeedback(this.feedback),this.clearShaderCache(),this.clearVertexArrayObjectCache(),this.canvas.removeEventListener("webglcontextlost",this._contextLostHandler,!1),this.canvas.removeEventListener("webglcontextrestored",this._contextRestoredHandler,!1),this._contextLostHandler=null,this._contextRestoredHandler=null,this.canvas=null,this.gl=null}get width(){return this.gl.drawingBufferWidth||this.canvas.width}get height(){return this.gl.drawingBufferHeight||this.canvas.height}get fullscreen(){return!!document.fullscreenElement}set fullscreen(t){t?this.gl.canvas.requestFullscreen():document.exitFullscreen()}get enableAutoInstancing(){return this._enableAutoInstancing}set enableAutoInstancing(t){this._enableAutoInstancing=t&&this.extInstancing}get maxPixelRatio(){return this._maxPixelRatio}set maxPixelRatio(t){this._maxPixelRatio=t,this.resizeCanvas(this._width,this._height)}get textureFloatHighPrecision(){return void 0===this._textureFloatHighPrecision&&(this._textureFloatHighPrecision=function(t){if(!t.textureFloatRenderable)return!1;var e=Jt(t,Ft.fullscreenQuadVS,Ft.precisionTestPS,"ptest1"),i=Jt(t,Ft.fullscreenQuadVS,Ft.precisionTest2PS,"ptest2"),n={format:14,width:1,height:1,mipmaps:!1,minFilter:0,magFilter:0},r=new pe(t,n);r.name="testFHP";var s=new Cf(t,r,{depth:!1});zt(t,s,e),n.format=7;var a=new pe(t,n);a.name="testFHP";var o=new Cf(t,a,{depth:!1});t.constantTexSource.setValue(r),zt(t,o,i);var l=t.activeFramebuffer;t.setFramebuffer(o._glFrameBuffer);var h=new Uint8Array(4);t.readPixels(0,0,1,1,h),t.setFramebuffer(l);var c=h[0]/255/16777216+h[1]/255/65536+h[2]/255/256+h[3]/255;return r.destroy(),s.destroy(),a.destroy(),o.destroy(),0===c}(this)),this._textureFloatHighPrecision}get textureHalfFloatUpdatable(){return void 0===this._textureHalfFloatUpdatable&&(this.webgl2?this._textureHalfFloatUpdatable=!0:this._textureHalfFloatUpdatable=function(t,e){var i=!0,n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);var r=new Uint16Array(16);return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,r),t.getError()!==t.NO_ERROR&&(i=!1,console.log("Above error related to HALF_FLOAT_OES can be ignored, it was triggered by testing half float texture support")),t.bindTexture(t.TEXTURE_2D,null),t.deleteTexture(n),i}(this.gl,this.extTextureHalfFloat.HALF_FLOAT_OES)),this._textureHalfFloatUpdatable}}var Af={depth:!0,face:0};class Cf{constructor(t){var e=arguments[1],i=arguments[2];if(t instanceof wf?(this._colorBuffer=e,t=i):this._colorBuffer=t.colorBuffer,this._glFrameBuffer=null,this._glDepthBuffer=null,t=void 0!==t?t:Af,this._depthBuffer=t.depthBuffer,this._face=void 0!==t.face?t.face:0,this._depthBuffer){var n=this._depthBuffer._format;16===n?(this._depth=!0,this._stencil=!1):17===n?(this._depth=!0,this._stencil=!0):(this._depth=!1,this._stencil=!1)}else this._depth=void 0===t.depth||t.depth,this._stencil=void 0!==t.stencil&&t.stencil;this._samples=void 0!==t.samples?t.samples:1,this.autoResolve=void 0===t.autoResolve||t.autoResolve,this._glResolveFrameBuffer=null,this._glMsaaColorBuffer=null,this._glMsaaDepthBuffer=null}destroy(){if(this._device){var t=this._device,e=t.targets.indexOf(this);-1!==e&&t.targets.splice(e,1);var i=t.gl;this._glFrameBuffer&&(i.deleteFramebuffer(this._glFrameBuffer),this._glFrameBuffer=null),this._glDepthBuffer&&(i.deleteRenderbuffer(this._glDepthBuffer),this._glDepthBuffer=null),this._glResolveFrameBuffer&&(i.deleteFramebuffer(this._glResolveFrameBuffer),this._glResolveFrameBuffer=null),this._glMsaaColorBuffer&&(i.deleteRenderbuffer(this._glMsaaColorBuffer),this._glMsaaColorBuffer=null),this._glMsaaDepthBuffer&&(i.deleteRenderbuffer(this._glMsaaDepthBuffer),this._glMsaaDepthBuffer=null)}}loseContext(){this._glFrameBuffer=void 0,this._glDepthBuffer=void 0,this._glResolveFrameBuffer=void 0,this._glMsaaColorBuffer=void 0,this._glMsaaDepthBuffer=void 0}resolve(t=!0,e=!!this._depthBuffer){if(this._device&&this._device.webgl2){var i=this._device.gl;i.bindFramebuffer(i.READ_FRAMEBUFFER,this._glFrameBuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this._glResolveFrameBuffer),i.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,(t?i.COLOR_BUFFER_BIT:0)|(e?i.DEPTH_BUFFER_BIT:0),i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this._glFrameBuffer)}}copy(t,e,i){if(!this._device){if(!t._device)return!1;this._device=t._device}return this._device.copyRenderTarget(t,this,e,i)}get colorBuffer(){return this._colorBuffer}get depthBuffer(){return this._depthBuffer}get face(){return this._face}get width(){return this._colorBuffer?this._colorBuffer.width:this._depthBuffer.width}get height(){return this._colorBuffer?this._colorBuffer.height:this._depthBuffer.height}}function If(t,e){return Math.atan2(t*e,Math.sqrt(t*t+e*e+1))}function Sf(t,e,i){var n=2*(t+.5)/i-1,r=2*(e+.5)/i-1,s=1/i,a=(n*=1-1/i)-s,o=(r*=1-1/i)-s,l=n+s,h=r+s,c=If(a,o)-If(a,h)-If(l,o)+If(l,h);return 0===t&&0===e||t===i-1&&0===e||0===t&&e===i-1||t===i-1&&e===i-1?c/=3:0!==t&&0!==e&&t!==i-1&&e!==i-1||(c*=.5),c}var Mf=new RegExp("^\\s*function(?:\\s|\\s*\\/\\*.*\\*\\/\\s*)+([^\\(\\s\\/]*)\\s*");class Tf extends v{constructor(t){super();var e=this.constructor;this.app=t.app,this.entity=t.entity,this._enabled="boolean"!=typeof t.enabled||t.enabled,this._enabledOld=this.enabled,this.__destroyed=!1,this.__attributes={},this.__attributesRaw=t.attributes||{},this.__scriptType=e,this.__executionOrder=-1}static __getScriptName(t){if("function"==typeof t){if("name"in Function.prototype)return t.name;if(t===Function||t===Function.prototype.constructor)return"Function";var e=(""+t).match(Mf);return e?e[1]:void 0}}static get scriptName(){return this.__name}static get attributes(){return this.hasOwnProperty("__attributes")||(this.__attributes=new Ku(this)),this.__attributes}__initializeAttributes(t){if(t||this.__attributesRaw){for(var e in this.__scriptType.attributes.index)this.__attributesRaw&&this.__attributesRaw.hasOwnProperty(e)?this[e]=this.__attributesRaw[e]:this.__attributes.hasOwnProperty(e)||(this.__scriptType.attributes.index[e].hasOwnProperty("default")?this[e]=this.__scriptType.attributes.index[e].default:this[e]=null);this.__attributesRaw=null}}static extend(t){for(var e in t)t.hasOwnProperty(e)&&(this.prototype[e]=t[e])}get enabled(){return this._enabled&&!this._destroyed&&this.entity.script.enabled&&this.entity.enabled}set enabled(t){this._enabled=!!t,this.enabled!==this._enabledOld&&(this._enabledOld=this.enabled,this.fire(this.enabled?"enable":"disable"),this.fire("state",this.enabled),!this._initialized&&this.enabled&&(this._initialized=!0,this.__initializeAttributes(!0),this.initialize&&this.entity.script._scriptMethod(this,Ju.scriptMethods.initialize)),this._initialized&&!this._postInitialized&&this.enabled&&!this.entity.script._beingEnabled&&(this._postInitialized=!0,this.postInitialize&&this.entity.script._scriptMethod(this,Ju.scriptMethods.postInitialize)))}}Tf.__name=null;new Set(["system","entity","create","destroy","swap","move","scripts","_scripts","_scriptsIndex","_scriptsData","enabled","_oldState","onEnable","onDisable","onPostStateChange","_onSetEnabled","_checkState","_onBeforeRemove","_onInitializeAttributes","_onInitialize","_onPostInitialize","_onUpdate","_onPostUpdate","_callbacks","has","get","on","off","fire","once","hasEvent"]);var Pf={};Ku.reservedNames.forEach((t,e,i)=>{Pf[t]=1});class Ef{constructor(t,e){e?(this.key=e.keyCode,this.element=e.target,this.event=e):(this.key=null,this.element=null,this.event=null)}}new Ef;function kf(){return!!(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement)}class Df{constructor(t,e){var i={x:0,y:0};if(e){if(e instanceof Df)throw Error("Expected MouseEvent");i=t._getTargetCoords(e)}else e={};if(i)this.x=i.x,this.y=i.y;else{if(!kf())return;this.x=0,this.y=0}this.wheelDelta=0,"wheel"===e.type&&(e.deltaY>0?this.wheelDelta=1:e.deltaY<0&&(this.wheelDelta=-1)),kf()?(this.dx=e.movementX||e.webkitMovementX||e.mozMovementX||0,this.dy=e.movementY||e.webkitMovementY||e.mozMovementY||0):(this.dx=this.x-t._lastX,this.dy=this.y-t._lastY),"mousedown"===e.type||"mouseup"===e.type?this.button=e.button:this.button=-1,this.buttons=t._buttons.slice(0),this.element=e.target,this.ctrlKey=e.ctrlKey||!1,this.altKey=e.altKey||!1,this.shiftKey=e.shiftKey||!1,this.metaKey=e.metaKey||!1,this.event=e}}class Of extends v{constructor(t){super(),this._lastX=0,this._lastY=0,this._buttons=[!1,!1,!1],this._lastbuttons=[!1,!1,!1],this._upHandler=this._handleUp.bind(this),this._downHandler=this._handleDown.bind(this),this._moveHandler=this._handleMove.bind(this),this._wheelHandler=this._handleWheel.bind(this),this._contextMenuHandler=function(t){t.preventDefault()},this._target=null,this._attached=!1,this.attach(t)}static isPointerLocked(){return kf()}attach(t){if(this._target=t,!this._attached){this._attached=!0;var e=!!w.passiveEvents&&{passive:!1};window.addEventListener("mouseup",this._upHandler,e),window.addEventListener("mousedown",this._downHandler,e),window.addEventListener("mousemove",this._moveHandler,e),window.addEventListener("wheel",this._wheelHandler,e)}}detach(){if(this._attached){this._attached=!1,this._target=null;var t=!!w.passiveEvents&&{passive:!1};window.removeEventListener("mouseup",this._upHandler,t),window.removeEventListener("mousedown",this._downHandler,t),window.removeEventListener("mousemove",this._moveHandler,t),window.removeEventListener("wheel",this._wheelHandler,t)}}disableContextMenu(){this._target&&this._target.addEventListener("contextmenu",this._contextMenuHandler)}enableContextMenu(){this._target&&this._target.removeEventListener("contextmenu",this._contextMenuHandler)}enablePointerLock(t,e){if(document.body.requestPointerLock){t&&document.addEventListener("pointerlockchange",(function e(){t(),document.removeEventListener("pointerlockchange",e)}),!1),e&&document.addEventListener("pointerlockerror",(function t(){e(),document.removeEventListener("pointerlockerror",t)}),!1),document.body.requestPointerLock()}else e&&e()}disablePointerLock(t){if(document.exitPointerLock){t&&document.addEventListener("pointerlockchange",(function e(){t(),document.removeEventListener("pointerlockchange",e)}),!1),document.exitPointerLock()}}update(){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2]}isPressed(t){return this._buttons[t]}wasPressed(t){return this._buttons[t]&&!this._lastbuttons[t]}wasReleased(t){return!this._buttons[t]&&this._lastbuttons[t]}_handleUp(t){this._buttons[t.button]=!1;var e=new Df(this,t);e.event&&this.fire("mouseup",e)}_handleDown(t){this._buttons[t.button]=!0;var e=new Df(this,t);e.event&&this.fire("mousedown",e)}_handleMove(t){var e=new Df(this,t);e.event&&(this.fire("mousemove",e),this._lastX=e.x,this._lastY=e.y)}_handleWheel(t){var e=new Df(this,t);e.event&&this.fire("mousewheel",e)}_getTargetCoords(t){var e=this._target.getBoundingClientRect(),i=Math.floor(e.left),n=Math.floor(e.top);return t.clientX<i||t.clientX>=i+this._target.clientWidth||t.clientY<n||t.clientY>=n+this._target.clientHeight?null:{x:t.clientX-i,y:t.clientY-n}}}var Rf,Lf,Nf=new H,zf=new H,Bf=new dt,Ff=new dt,jf=new dt;Bf.end=new H,Ff.end=new H,jf.end=new H;var Vf=new H,Uf=new H,Gf=new H,Wf=new H,Hf=new H,Xf=new H,Zf=new H,Yf=new W,qf=new H,Kf=new H,Jf=new H,Qf=new H,$f=new H,tp=new H,ep=new H,ip=new H,np=new X;function rp(t,e,i){return Zf.cross(t,e).dot(i)}class sp{constructor(t,e,i){this.event=t,this.element=e,this.camera=i,this._stopPropagation=!1}stopPropagation(){this._stopPropagation=!0,this.event&&(this.event.stopImmediatePropagation(),this.event.stopPropagation())}}class ap extends sp{constructor(t,e,i,n,r,s,a){super(t,e,i),this.x=n,this.y=r,this.ctrlKey=t.ctrlKey||!1,this.altKey=t.altKey||!1,this.shiftKey=t.shiftKey||!1,this.metaKey=t.metaKey||!1,this.button=t.button,Of.isPointerLocked()?(this.dx=t.movementX||t.webkitMovementX||t.mozMovementX||0,this.dy=t.movementY||t.webkitMovementY||t.mozMovementY||0):(this.dx=n-s,this.dy=r-a),this.wheelDelta=0,"wheel"===t.type&&(t.deltaY>0?this.wheelDelta=1:t.deltaY<0&&(this.wheelDelta=-1))}}class op extends sp{constructor(t,e,i,n,r,s){super(t,e,i),this.touches=t.touches,this.changedTouches=t.changedTouches,this.x=n,this.y=r,this.touch=s}}class lp extends sp{constructor(t,e,i,n){super(t,e,i),this.inputSource=n}}new X,new Float32Array(4);E.endsWith=function(t,e){return t.endsWith(e)},E.startsWith=function(t,e){return t.startsWith(e)};Object.defineProperty(D.prototype,"data",{get:function(){return this._data||(this._data=new Float32Array(4)),this._data[0]=this.r,this._data[1]=this.g,this._data[2]=this.b,this._data[3]=this.a,this._data}}),Object.defineProperty(D.prototype,"data3",{get:function(){return this._data3||(this._data3=new Float32Array(3)),this._data3[0]=this.r,this._data3[1]=this.g,this._data3[2]=this.b,this._data3}}),k.INV_LOG2=Math.LOG2E,k.intToBytes=k.intToBytes32,k.bytesToInt=k.bytesToInt32,Object.defineProperty(W.prototype,"data",{get:function(){return this._data||(this._data=new Float32Array(2)),this._data[0]=this.x,this._data[1]=this.y,this._data}}),Object.defineProperty(H.prototype,"data",{get:function(){return this._data||(this._data=new Float32Array(3)),this._data[0]=this.x,this._data[1]=this.y,this._data[2]=this.z,this._data}}),Object.defineProperty(X.prototype,"data",{get:function(){return this._data||(this._data=new Float32Array(4)),this._data[0]=this.x,this._data[1]=this.y,this._data[2]=this.z,this._data[3]=this.w,this._data}});ct.prototype.intersectRay=ct.prototype.intersectsRay,ut.prototype.update=function(t,e){var i=new Q;i.mul2(t,e),this.setFromMat4(i)};function hp(t){this.name="UnsupportedBrowserError",this.message=t||""}function cp(t){this.name="ContextCreationError",this.message=t||""}hp.prototype=Error.prototype,cp.prototype=Error.prototype;Object.defineProperty(Ft,"transformSkinnedVS",{get:function(){return"#define SKIN\n"+Ft.transformVS}}),Object.defineProperties(pe.prototype,{rgbm:{get:function(){return"rgbm"===this.type},set:function(t){this.type=t?"rgbm":"default"}},swizzleGGGR:{get:function(){return"swizzleGGGR"===this.type},set:function(t){this.type=t?"swizzleGGGR":"default"}}});_i.prototype._dirtify=function(t){t?this._dirtifyLocal():this._dirtifyWorld()},_i.prototype.addLabel=function(t){this._labels[t]=!0},_i.prototype.getLabels=function(){return Object.keys(this._labels)},_i.prototype.hasLabel=function(t){return!!this._labels[t]},_i.prototype.removeLabel=function(t){delete this._labels[t]},_i.prototype.findByLabel=function(t,e){var i,n=this._children.length;for(e=e||[],this.hasLabel(t)&&e.push(this),i=0;i<n;++i)e=this._children[i].findByLabel(t,e);return e},_i.prototype.getChildren=function(){return this.children},_i.prototype.getName=function(){return this.name},_i.prototype.getPath=function(){return this.path},_i.prototype.getRoot=function(){return this.root},_i.prototype.getParent=function(){return this.parent},_i.prototype.setName=function(t){this.name=t},_e.prototype.getName=function(){return this.name},_e.prototype.setName=function(t){this.name=t},_e.prototype.getShader=function(){return this.shader},_e.prototype.setShader=function(t){this.shader=t};is.prototype.getDuration=function(){return this.duration},is.prototype.getName=function(){return this.name},is.prototype.getNodes=function(){return this.nodes},is.prototype.setDuration=function(t){this.duration=t},is.prototype.setName=function(t){this.name=t},Rl.prototype.getAnimation=function(){return this.animation},Rl.prototype.getCurrentTime=function(){return this.currentTime},Rl.prototype.getLooping=function(){return this.looping},Rl.prototype.getNumNodes=function(){return this.numNodes},Rl.prototype.setAnimation=function(t){this.animation=t},Rl.prototype.setCurrentTime=function(t){this.currentTime=t},Rl.prototype.setLooping=function(t){this.looping=t};$r.prototype.getListener=function(){return this.listener},$r.prototype.getVolume=function(){return this.volume},$r.prototype.setVolume=function(t){this.volume=t};Wo.prototype.getAssetById=function(t){return this.get(t)},Object.defineProperty(dl.prototype,"ray",{get:function(){return this._rayLocal}}),Object.defineProperty(dl.prototype,"position",{get:function(){return this._localPosition}}),Object.defineProperty(dl.prototype,"rotation",{get:function(){return this._localRotation}});Object.defineProperty(class{constructor(t,e){this._app=null,this._attached=!1,this._target=null,this._enabled=!0,this._lastX=0,this._lastY=0,this._upHandler=this._handleUp.bind(this),this._downHandler=this._handleDown.bind(this),this._moveHandler=this._handleMove.bind(this),this._wheelHandler=this._handleWheel.bind(this),this._touchstartHandler=this._handleTouchStart.bind(this),this._touchendHandler=this._handleTouchEnd.bind(this),this._touchcancelHandler=this._touchendHandler,this._touchmoveHandler=this._handleTouchMove.bind(this),this._sortHandler=this._sortElements.bind(this),this._elements=[],this._hoveredElement=null,this._pressedElement=null,this._touchedElements={},this._touchesForWhichTouchLeaveHasFired={},this._selectedElements={},this._selectedPressedElements={},this._useMouse=!e||!1!==e.useMouse,this._useTouch=!e||!1!==e.useTouch,this._useXr=!e||!1!==e.useXr,this._selectEventsAttached=!1,w.touch&&(this._clickedEntities={}),this.attach(t)}attach(t){this._attached&&(this._attached=!1,this.detach()),this._target=t,this._attached=!0;var e=!!w.passiveEvents&&{passive:!0};this._useMouse&&(window.addEventListener("mouseup",this._upHandler,e),window.addEventListener("mousedown",this._downHandler,e),window.addEventListener("mousemove",this._moveHandler,e),window.addEventListener("wheel",this._wheelHandler,e)),this._useTouch&&w.touch&&(this._target.addEventListener("touchstart",this._touchstartHandler,e),this._target.addEventListener("touchend",this._touchendHandler,!1),this._target.addEventListener("touchmove",this._touchmoveHandler,!1),this._target.addEventListener("touchcancel",this._touchcancelHandler,!1)),this.attachSelectEvents()}attachSelectEvents(){!this._selectEventsAttached&&this._useXr&&this.app&&this.app.xr&&this.app.xr.supported&&(this._clickedEntities||(this._clickedEntities={}),this._selectEventsAttached=!0,this.app.xr.on("start",this._onXrStart,this))}detach(){if(this._attached){this._attached=!1;var t=!!w.passiveEvents&&{passive:!0};this._useMouse&&(window.removeEventListener("mouseup",this._upHandler,t),window.removeEventListener("mousedown",this._downHandler,t),window.removeEventListener("mousemove",this._moveHandler,t),window.removeEventListener("wheel",this._wheelHandler,t)),this._useTouch&&(this._target.removeEventListener("touchstart",this._touchstartHandler,t),this._target.removeEventListener("touchend",this._touchendHandler,!1),this._target.removeEventListener("touchmove",this._touchmoveHandler,!1),this._target.removeEventListener("touchcancel",this._touchcancelHandler,!1)),this._selectEventsAttached&&(this._selectEventsAttached=!1,this.app.xr.off("start",this._onXrStart,this),this.app.xr.off("end",this._onXrEnd,this),this.app.xr.off("update",this._onXrUpdate,this),this.app.xr.input.off("selectstart",this._onSelectStart,this),this.app.xr.input.off("selectend",this._onSelectEnd,this),this.app.xr.input.off("remove",this._onXrInputRemove,this)),this._target=null}}addElement(t){-1===this._elements.indexOf(t)&&this._elements.push(t)}removeElement(t){var e=this._elements.indexOf(t);-1!==e&&this._elements.splice(e,1)}_handleUp(t){this._enabled&&(Of.isPointerLocked()||(this._calcMouseCoords(t),null!==Rf&&this._onElementMouseEvent("mouseup",t)))}_handleDown(t){this._enabled&&(Of.isPointerLocked()||(this._calcMouseCoords(t),null!==Rf&&this._onElementMouseEvent("mousedown",t)))}_handleMove(t){this._enabled&&(this._calcMouseCoords(t),null!==Rf&&(this._onElementMouseEvent("mousemove",t),this._lastX=Rf,this._lastY=Lf))}_handleWheel(t){this._enabled&&(this._calcMouseCoords(t),null!==Rf&&this._onElementMouseEvent("mousewheel",t))}_determineTouchedElements(t){var e,i,n,r={},s=this.app.systems.camera.cameras;for(e=s.length-1;e>=0;e--){var a=s[e],o=0;for(i=0,n=t.changedTouches.length;i<n;i++)if(r[t.changedTouches[i].identifier])o++;else{var l=this._calcTouchCoords(t.changedTouches[i]),h=this._getTargetElement(a,l.x,l.y);h&&(o++,r[t.changedTouches[i].identifier]={element:h,camera:a,x:l.x,y:l.y})}if(o===n)break}return r}_handleTouchStart(t){if(this._enabled){for(var e=this._determineTouchedElements(t),i=0,n=t.changedTouches.length;i<n;i++){var r=t.changedTouches[i],s=e[r.identifier],a=this._touchedElements[r.identifier];!s||a&&s.element===a.element||(this._fireEvent(t.type,new op(t,s.element,s.camera,s.x,s.y,r)),this._touchesForWhichTouchLeaveHasFired[r.identifier]=!1)}for(var o in e)this._touchedElements[o]=e[o]}}_handleTouchEnd(t){if(this._enabled){var e=this.app.systems.camera.cameras;for(var i in this._clickedEntities)delete this._clickedEntities[i];for(var n=0,r=t.changedTouches.length;n<r;n++){var s=t.changedTouches[n],a=this._touchedElements[s.identifier];if(a){var o=a.element,l=a.camera,h=a.x,c=a.y;if(delete this._touchedElements[s.identifier],delete this._touchesForWhichTouchLeaveHasFired[s.identifier],this._fireEvent(t.type,new op(t,o,l,h,c,s)),0===t.touches.length)for(var u=this._calcTouchCoords(s),d=e.length-1;d>=0;d--){this._getTargetElement(e[d],u.x,u.y)===o&&(this._clickedEntities[o.entity.getGuid()]||(this._fireEvent("click",new op(t,o,l,h,c,s)),this._clickedEntities[o.entity.getGuid()]=!0))}}}}}_handleTouchMove(t){if(t.preventDefault(),this._enabled)for(var e=this._determineTouchedElements(t),i=0,n=t.changedTouches.length;i<n;i++){var r=t.changedTouches[i],s=e[r.identifier],a=this._touchedElements[r.identifier];if(a){var o=this._calcTouchCoords(r);s&&s.element===a.element||this._touchesForWhichTouchLeaveHasFired[r.identifier]||(this._fireEvent("touchleave",new op(t,a.element,a.camera,o.x,o.y,r)),this._touchesForWhichTouchLeaveHasFired[r.identifier]=!0),this._fireEvent("touchmove",new op(t,a.element,a.camera,o.x,o.y,r))}}}_onElementMouseEvent(t,e){var i,n=this._hoveredElement;this._hoveredElement=null;for(var r,s=this.app.systems.camera.cameras,a=s.length-1;a>=0&&(r=s[a],!(i=this._getTargetElement(r,Rf,Lf)));a--);i&&(this._fireEvent(t,new ap(e,i,r,Rf,Lf,this._lastX,this._lastY)),this._hoveredElement=i,"mousedown"===t&&(this._pressedElement=i)),n!==this._hoveredElement&&(n&&this._fireEvent("mouseleave",new ap(e,n,r,Rf,Lf,this._lastX,this._lastY)),this._hoveredElement&&this._fireEvent("mouseenter",new ap(e,this._hoveredElement,r,Rf,Lf,this._lastX,this._lastY))),"mouseup"===t&&this._pressedElement&&(this._pressedElement===this._hoveredElement?(this._pressedElement=null,this._clickedEntities&&this._clickedEntities[this._hoveredElement.entity.getGuid()]||this._fireEvent("click",new ap(e,this._hoveredElement,r,Rf,Lf,this._lastX,this._lastY))):this._pressedElement=null)}_onXrStart(){this.app.xr.on("end",this._onXrEnd,this),this.app.xr.on("update",this._onXrUpdate,this),this.app.xr.input.on("selectstart",this._onSelectStart,this),this.app.xr.input.on("selectend",this._onSelectEnd,this),this.app.xr.input.on("remove",this._onXrInputRemove,this)}_onXrEnd(){this.app.xr.off("update",this._onXrUpdate,this),this.app.xr.input.off("selectstart",this._onSelectStart,this),this.app.xr.input.off("selectend",this._onSelectEnd,this),this.app.xr.input.off("remove",this._onXrInputRemove,this)}_onXrUpdate(){if(this._enabled)for(var t=this.app.xr.input.inputSources,e=0;e<t.length;e++)this._onElementSelectEvent("selectmove",t[e],null)}_onXrInputRemove(t){var e=this._selectedElements[t.id];e&&(t._elementEntity=null,this._fireEvent("selectleave",new lp(null,e,null,t))),delete this._selectedElements[t.id],delete this._selectedPressedElements[t.id]}_onSelectStart(t,e){this._enabled&&this._onElementSelectEvent("selectstart",t,e)}_onSelectEnd(t,e){this._enabled&&this._onElementSelectEvent("selectend",t,e)}_onElementSelectEvent(t,e,i){var n,r,s,a=this._selectedElements[e.id],o=this.app.systems.camera.cameras;if(e.elementInput){jf.set(e.getOrigin(),e.getDirection());for(var l=o.length-1;l>=0&&(s=o[l],!(n=this._getTargetElementByRay(jf,s)));l--);}e._elementEntity=n||null,n?(this._selectedElements[e.id]=n,r=n):delete this._selectedElements[e.id],a!==r&&(a&&this._fireEvent("selectleave",new lp(i,a,s,e)),r&&this._fireEvent("selectenter",new lp(i,r,s,e))),"selectstart"===t&&(this._selectedPressedElements[e.id]=r,r&&this._fireEvent("selectstart",new lp(i,r,s,e)));var h=this._selectedPressedElements[e.id];!e.elementInput&&h&&(delete this._selectedPressedElements[e.id],a&&this._fireEvent("selectend",new lp(i,a,s,e))),"selectend"===t&&e.elementInput&&(delete this._selectedPressedElements[e.id],a&&this._fireEvent("selectend",new lp(i,a,s,e)),h&&h===a&&this._fireEvent("click",new lp(i,h,s,e)))}_fireEvent(t,e){for(var i=e.element;i.fire(t,e),!e._stopPropagation&&i.entity.parent&&(i=i.entity.parent.element););}_calcMouseCoords(t){var e=this._target.getBoundingClientRect(),i=Math.floor(e.left),n=Math.floor(e.top);t.clientX<i||t.clientX>=i+this._target.clientWidth||t.clientY<n||t.clientY>=n+this._target.clientHeight?(Rf=null,Lf=null):(Rf=t.clientX-i,Lf=t.clientY-n)}_calcTouchCoords(t){for(var e=0,i=0,n=t.target;!(n instanceof HTMLElement);)n=n.parentNode;var r=n;do{e+=r.offsetLeft-r.scrollLeft,i+=r.offsetTop-r.scrollTop,r=r.offsetParent}while(r);return{x:t.pageX-e,y:t.pageY-i}}_sortElements(t,e){var i=this.app.scene.layers.sortTransparentLayers(t.layers,e.layers);return 0!==i?i:t.screen&&!e.screen?-1:!t.screen&&e.screen?1:t.screen||e.screen?t.screen.screen.screenSpace&&!e.screen.screen.screenSpace?-1:e.screen.screen.screenSpace&&!t.screen.screen.screenSpace?1:e.drawOrder-t.drawOrder:0}_getTargetElement(t,e,i){var n,r,s=null;this._elements.sort(this._sortHandler);for(var a=0,o=this._elements.length;a<o;a++){var l,h=this._elements[a],c=!1;if(h.screen&&h.screen.screen.screenSpace?(void 0===n&&(n=Bf,!1===this._calculateRayScreen(e,i,t,n)&&(n=null)),l=n,c=!0):(void 0===r&&(r=Ff,!1===this._calculateRay3d(e,i,t,r)&&(r=null)),l=r),l&&this._checkElement(l,h,c)){s=h;break}}return s}_getTargetElementByRay(t,e){var i=null;Bf.origin.copy(t.origin),Bf.direction.copy(t.direction),Bf.end.copy(Bf.direction).scale(2*e.farClip).add(Bf.origin),this._elements.sort(this._sortHandler);for(var n=0,r=this._elements.length;n<r;n++){var s=this._elements[n];if((!s.screen||!s.screen.screen.screenSpace)&&this._checkElement(Bf,s,!1)){i=s;break}}return i}_buildHitCorners(t,e,i,n){var r=e;if(t.entity&&t.entity.button){var s=t.entity.button.hitPadding||np;qf.copy(t.entity.up),Kf.copy(qf).scale(-1),Qf.copy(t.entity.right),Jf.copy(Qf).scale(-1),qf.scale(s.w*n),Kf.scale(s.y*n),Qf.scale(s.z*i),Jf.scale(s.x*i),$f.copy(r[0]).add(Kf).add(Jf),tp.copy(r[1]).add(Kf).add(Qf),ep.copy(r[2]).add(qf).add(Qf),ip.copy(r[3]).add(qf).add(Jf),r=[$f,tp,ep,ip]}return r}_calculateScaleToScreen(t){var e=t.entity,i=t.screen.screen.scale;for(Yf.set(i,i);e&&!e.screen;)Yf.mul(e.getLocalScale()),e=e.parent;return Yf}_calculateRayScreen(t,e,i,n){var r=this.app.graphicsDevice.width,s=this.app.graphicsDevice.height,a=i.rect.z*r,o=i.rect.w*s,l=i.rect.x*r,h=l+a,c=(1-i.rect.y)*s,u=c-o,d=t*r/this._target.clientWidth,f=e*s/this._target.clientHeight;return d>=l&&d<=h&&f<=c&&f>=u&&(d=r*(d-l)/a,f=s-(f=s*(f-u)/o),n.origin.set(d,f,1),n.direction.set(0,0,-1),n.end.copy(n.direction).scale(2).add(n.origin),!0)}_calculateRay3d(t,e,i,n){var r=this._target.clientWidth,s=this._target.clientHeight,a=i.rect.z*r,o=i.rect.w*s,l=i.rect.x*r,h=l+a,c=(1-i.rect.y)*s,u=c-o,d=t,f=e;return t>=l&&t<=h&&e<=c&&f>=u&&(d=r*(d-l)/a,f=s*(f-u)/o,i.screenToWorld(d,f,i.nearClip,Nf),i.screenToWorld(d,f,i.farClip,zf),n.origin.copy(Nf),n.direction.set(0,0,-1),n.end.copy(zf),!0)}_checkElement(t,e,i){var n;if(e.maskedBy&&!this._checkElement(t,e.maskedBy.element,i))return!1;n=i?this._calculateScaleToScreen(e):e.entity.getWorldTransform().getScale();var r=this._buildHitCorners(e,i?e.screenCorners:e.worldCorners,n.x,n.y);return!!function(t,e,i){if(Vf.sub2(e,t),Uf.sub2(i[0],t),Gf.sub2(i[1],t),Wf.sub2(i[2],t),Xf.cross(Wf,Vf),Uf.dot(Xf)>=0){if(-Gf.dot(Xf)<0)return!1;if(rp(Vf,Gf,Uf)<0)return!1}else{if(Hf.sub2(i[3],t),Hf.dot(Xf)<0)return!1;if(rp(Vf,Uf,Hf)<0)return!1}return!(Vf.sub2(i[0],i[2]).lengthSq()<1e-8)&&!(Vf.sub2(i[1],i[3]).lengthSq()<1e-8)}(t.origin,t.end,r)}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get app(){return this._app||qd.getApplication()}set app(t){this._app=t}}.prototype,"wheel",{get:function(){return-2*this.wheelDelta}}),Object.defineProperty(Df.prototype,"wheel",{get:function(){return-2*this.wheelDelta}});function up(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dp(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}qd.prototype.isFullscreen=function(){return!!document.fullscreenElement},qd.prototype.enableFullscreen=function(t,e,i){t=t||this.graphicsDevice.canvas;e&&document.addEventListener("fullscreenchange",(function t(){e(),document.removeEventListener("fullscreenchange",t)}),!1),i&&document.addEventListener("fullscreenerror",(function t(){i(),document.removeEventListener("fullscreenerror",t)}),!1),t.requestFullscreen?t.requestFullscreen(Element.ALLOW_KEYBOARD_INPUT):i()},qd.prototype.disableFullscreen=function(t){t&&document.addEventListener("fullscreenchange",(function e(){t(),document.removeEventListener("fullscreenchange",e)}),!1),document.exitFullscreen()},qd.prototype.getSceneUrl=function(t){var e=this.scenes.find(t);return e?e.url:null},qd.prototype.loadScene=function(t,e){this.scenes.loadScene(t,e)},qd.prototype.loadSceneHierarchy=function(t,e){this.scenes.loadSceneHierarchy(t,e)},qd.prototype.loadSceneSettings=function(t,e){this.scenes.loadSceneSettings(t,e)},Object.defineProperty(Ih.prototype,"node",{get:function(){return this.entity}}),Object.defineProperty(eu.prototype,"enable",{get:function(){return this.enabled},set:function(t){this.enabled=t}}),au.prototype.setVisible=function(t){this.enabled=t},Object.defineProperty(Du.prototype,"bodyType",{get:function(){return this.type},set:function(t){this.type=t}}),Du.prototype.syncBodyToEntity=function(){this._updateDynamic()},Vu.prototype.setGravity=function(){1===arguments.length?this.gravity.copy(arguments[0]):this.gravity.set(arguments[0],arguments[1],arguments[2])};var fp=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};up(this,t),this._config=n,this._graph=new l.dia.Graph({},{cellNamespace:l.shape}),this._paper=new l.dia.Paper({el:e,model:this._graph,width:e.offsetWidth,cellViewNamespace:l.shapes,height:e.offsetHeight,clickThreshold:1,restrictTranslate:this._config.restrictTranslate,background:{color:"#20292B"},gridSize:10,linkPinning:!1,defaultLink:function(t,e){var i=new l.shapes.standard.Link({connector:{name:"normal"}});return i.attr({line:{stroke:l.V(e).attr("stroke"),strokeWidth:2,targetMarker:null}}),i},validateConnection:function(t,e,i,n,r,s){if(l.V(t).id===l.V(i).id)return!1;if(!l.V(e)||!l.V(n))return!1;var a=l.V(e).attr("port"),o=l.V(n.parentNode).attr("port");return!(a.includes("in")&&o.includes("in")||a.includes("out")&&o.includes("out"))&&((!a.includes("in")||"hidden"===l.V(e.children[1]).attr().visibility)&&t._portElementsCache[a].portContentElement.children()[0].attr().edgeType===i._portElementsCache[o].portContentElement.children()[0].attr().edgeType)},markAvailable:!0,drawGrid:{name:"doubleMesh",args:[{color:"#0e1923",thickness:1},{color:"#06101b",scaleFactor:10,thickness:2}]}});var r=new ResizeObserver((function(t){i._resizeGraph()}));r.observe(e),this._panPaper=!1,this._translate=new W,this._totalTranslate=new W,this._pan=new W,this._mousePos=new W,this._paper.on("blank:pointerdown",(function(t){i._panPaper=!0,i._mousePos=new W(t.offsetX,t.offsetY)})),this._paper.on("blank:pointerup",(function(){i._panPaper=!1,i._translate.add(i._pan)})),e.addEventListener("mousemove",(function(t){i._panPaper&&(i._pan=i._mousePos.clone().sub(new W(t.offsetX,t.offsetY)),i._mousePos=new W(t.offsetX,t.offsetY),i._paper.translate(i._paper.translate().tx-i._pan.x,i._paper.translate().ty-i._pan.y))}));var s=function(t,e,n,r){t.preventDefault();var s=i._paper.scale().sx+.025*r;i._scaleToPoint(s,e,n)},a=function(t,e,i,n,r){return s(e,i,n,r)};if(this._paper.on("cell:mousewheel",a),this._paper.on("blank:mousewheel",s),n.adjustVertices){var o=_.partial(this.adjustVertices.bind(this),this._graph);this._graph.on("add remove change:source change:target",o),this._paper.on("cell:pointerup",o)}}var e,i,n;return e=t,(i=[{key:"_resizeGraph",value:function(){this._paper.setDimensions(this._dom.offsetWidth,this._dom.offsetHeight)}},{key:"_scaleToPoint",value:function(t,e,i){if(t>=(this._config.minZoom||.25)&&t<=(this._config.maxZoom||1.5)){var n=this._paper.scale().sx/t,r=e-e*n,s=i-i*n,a=this._paper.translate(),o=a.tx-r*t,l=a.ty-s*t;this._paper.translate(o,l);var h=this._paper.matrix();h.a=t,h.d=t,this._paper.matrix(h)}}},{key:"adjustVertices",value:function(t,e){var i=this;if(!this.ignoreAdjustVertices)if((e=e.model||e)instanceof l.dia.Element)_.chain(t.getConnectedLinks(e)).groupBy((function(t){return _.omit([t.source().id,t.target().id],e.id)[0]})).each((function(e,n){"undefined"!==n&&i.adjustVertices(t,_.first(e))})).value();else{var n=e.get("source").id||e.previous("source").id,r=e.get("target").id||e.previous("target").id;if(n&&r){var s=_.filter(t.getLinks(),(function(t){var e=t.source().id,i=t.target().id;return e===n&&i===r||e===r&&i===n})),a=s.length;switch(a){case 0:break;case 1:e.unset("vertices"),e.set("connector",{name:"normal"});break;default:var o=t.getCell(n).getBBox().center(),h=t.getCell(r).getBBox().center(),c=(l.g.Line(o,h).midpoint(),o.theta(h));_.each(s,(function(t,e){var n=20*Math.ceil(e/2),r=e%2?1:-1;a%2==0&&(n-=10*r);var s=c<180?1:-1,o=l.g.toRad(c+r*s*90),h=l.g.Point.fromPolar(n*r,o,0);i.ignoreAdjustVertices=!0,t.source(t.getSourceCell(),{anchor:{name:"center",args:{dx:h.x,dy:h.y}}}),t.target(t.getTargetCell(),{anchor:{name:"center",args:{dx:h.x,dy:h.y}}}),i.ignoreAdjustVertices=!1}))}}}}}])&&dp(e.prototype,i),n&&dp(e,n),t}();i(38);function pp(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var mp=function(){function t(e,i,r,s,a,o,h,c,u){var d=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._graphView=e,this._paper=i,this._graph=r,this._graphSchema=s,this.nodeData=a,this.nodeSchema=o,this.state=t.STATES.DEFAULT;var f=0,p=0;if(o.inPorts&&(f=25*o.inPorts.length+10),o.outPorts){var m=25*o.outPorts.length+10;m>f&&(f=m)}o.attributes&&(p=32*o.attributes.length+10);var g,v={x:226,y:28+f+p};g=o.outPorts||o.inPorts?a.attributes&&a.attributes.name?"".concat(a.attributes.name," (").concat(o.name,")"):o.name:a.attributes&&a.attributes.name||a.name;var _=new l.shapes.html.Element({attrs:{body:{fill:o.fill,stroke:o.stroke,strokeWidth:2,width:v.x,height:v.y},labelBackground:{fill:"#293538",width:v.x-2,height:26,refX:1,refY:1},icon:{text:o.icon||"",fontFamily:"pc-icon",fontSize:14,fill:o.iconColor||"#F60",refX:8,refY:8},label:{text:g,fill:"white",textAnchor:"left",refX:28,refY:14,fontSize:12,fontWeight:600,width:40,height:40},texture:a.texture?{href:a.texture,fill:"red",width:95,height:95,refX:5,refY:65}:null},ports:{groups:{in:{position:{name:"line",args:{start:{x:0,y:28},end:{x:0,y:28+25*(o.inPorts?o.inPorts.length:0)}}},label:{position:{name:"right",args:{y:5}}},markup:'<circle class="port-body"></circle><circle class="port-inner-body" visibility="hidden"></circle>',attrs:{".port-body":{strokeWidth:2,fill:"#20292B",magnet:!0,r:5,cy:5,cx:1},".port-inner-body":{strokeWidth:2,stroke:"#0379EE",r:1,cy:5,cx:1}}},out:{position:{name:"line",args:{start:{x:v.x-10,y:28},end:{x:v.x-10,y:28+25*(o.outPorts?o.outPorts.length:0)}}},label:{position:{name:"left",args:{y:5,x:-5}}},markup:'<circle class="port-body"></circle><circle class="port-inner-body" visibility="hidden"></circle>',attrs:{".port-body":{strokeWidth:2,fill:"#20292B",magnet:!0,r:5,cy:5,cx:9},".port-inner-body":{strokeWidth:2,stroke:"#0379EE",r:1,cy:5,cx:9}}}}}});_.position(a.posX,a.posY),_.resize(v.x,v.y),o.inPorts&&o.inPorts.forEach((function(t,e){_.addPort({id:"in".concat(e),group:"in",edgeType:t.edgeType,markup:'<circle class="port-body" edgeType="'.concat(t.type,'"></circle><circle class="port-inner-body" visibility="hidden"></circle>'),attrs:{".port-body":{stroke:d._graphSchema.edges[t.type].stroke},text:{text:t.name,fill:"white","font-size":12}}}),d._graph.on("change:target",(function(i){if(!d._suppressChangeTargetEvent){var n=i.get("target"),r=i.get("source");if(n&&r){if(n&&n.port&&n.port.includes("out")){var s=n;n=r,r=s}if(n&&n.id&&n.id===d.model.id&&r&&r.port&&n.port&&Number(n.port.replace("in",""))===e){var a=d._graphView.getNode(r.id).nodeData.id,o="".concat(a,",").concat(r.port.replace("out",""),"-").concat(d.nodeData.id,",").concat(n.port.replace("in","")),l={to:d.nodeData.id,from:a,outPort:Number(r.port.replace("out","")),inPort:Number(n.port.replace("in","")),edgeType:t.type};d._suppressChangeTargetEvent=!0,d._graph.removeCells(i),d._suppressChangeTargetEvent=!1,c(o,l)}}}}))})),o.outPorts&&o.outPorts.forEach((function(t,e){return _.addPort({id:"out".concat(e),group:"out",markup:'<circle class="port-body" edgeType="'.concat(t.type,'"></circle><circle class="port-inner-body" visibility="hidden"></circle>'),attrs:{type:t.type,".port-body":{stroke:d._graphSchema.edges[t.type].stroke},text:{text:t.name,fill:"white","font-size":12}}})}));var y=[];o.attributes&&o.attributes.forEach((function(t,e){var i,r,s=new n.Container({class:"graph-node-container"}),o=new n.Label({text:t.name,class:"graph-node-label"});switch(a.attributes&&(a.attributes[t.name]?r=a.attributes[t.name]:Object.keys(a.attributes).forEach((function(e){var i=a.attributes[e];i.name===t.name&&(r=i.defaultValue)}))),r||(r=a[t.name]),t.type){case"TEXT_INPUT":i=new n.TextInput({class:"graph-node-input",value:r}),"name"===t.name&&(i.onValidate=function(t){if(""===t)return!1;var e=d._graphView._parent._graphData;return!Object.keys(e.get("data.nodes")).filter((function(t){return Number(t)!==d.nodeData.id})).map((function(t){return e.get("data.nodes.".concat(t,".attributes.name"))})).includes(t)});break;case"BOOLEAN_INPUT":(i=new n.BooleanInput({class:"graph-node-input",value:r})).on("change",(function(){d._graphView._parent.selectNode(d.nodeData)}));break;case"NUMERIC_INPUT":i=new n.NumericInput({class:"graph-node-input",hideSlider:!0,value:r&&r.x?r.x:r});break;case"VEC_2_INPUT":(i=new n.VectorInput({dimensions:2,class:"graph-node-input",hideSlider:!0,value:[r.x,r.y]})).dom.setAttribute("style","margin-right: 6px;"),i.inputs.forEach((function(t){return t._sliderControl.dom.remove()}));break;case"VEC_3_INPUT":(i=new n.VectorInput({dimensions:3,class:"graph-node-input",hideSlider:!0,value:[r.x,r.y,r.z]})).dom.setAttribute("style","margin-right: 6px;"),i.inputs.forEach((function(t){return t._sliderControl.dom.remove()}));break;case"VEC_4_INPUT":(i=new n.VectorInput({dimensions:4,class:"graph-node-input",hideSlider:!0,value:[r.x,r.y,r.z,r.w]})).dom.setAttribute("style","margin-right: 6px;"),i.inputs.forEach((function(t){return t._sliderControl.dom.remove()}))}i.on("focus",(function(){d._graphView._parent.selectNode(d.nodeData)})),i.enabled=!d._graphView._config.readOnly,i.dom.setAttribute("id","input_".concat(t.name)),s.dom.setAttribute("style","margin-top: ".concat(0===e?33+f:5,"px; margin-bottom: 5px;")),s.append(o),s.append(i),y.push(s)}));var b=function(){var t=document.querySelector("#nodediv_".concat(_.id));y.forEach((function(e){t.appendChild(e.dom)})),d._paper.findViewByModel(_).on("element:pointerdown",(function(){d._hasLinked?d._hasLinked=!1:u(d.nodeData)}))};this._graphView._batchingCells?(this._graphView._cells.push(_),this._graphView._cellMountedFunctions.push(b)):(this._graph.addCell(_),b()),this.model=_}var e,i,r;return e=t,(i=[{key:"addContextMenu",value:function(t){if(!this._graphView._config.readOnly){var e=this._paper.findViewByModel(this.model),i=document.createElement("div");this._paper.el.appendChild(i),this._contextMenuElement=i,this._contextMenu=new n.ContextMenu({triggerElement:e.el,dom:i,items:this._graphView._parent.initialiseNodeContextMenuItems(this.nodeData,t)})}}},{key:"mapVectorToArray",value:function(t){var e=[];return Number.isFinite(t.x)&&e.push(t.x),Number.isFinite(t.y)&&e.push(t.y),Number.isFinite(t.z)&&e.push(t.z),Number.isFinite(t.w)&&e.push(t.w),e}},{key:"updateAttribute",value:function(t,e){var i;"name"===t&&(i=this.nodeSchema.outPorts||this.nodeSchema.inPorts?"".concat(e," (").concat(this.nodeSchema.name,")"):e,this.model.attr("label/text",i));var n=document.querySelector("#nodediv_".concat(this.model.id)).querySelector("#input_".concat(t));n&&(n.ui.suspendEvents=!0,Number.isFinite(e.x)?n.ui.value=this.mapVectorToArray(e):n.ui.value=e,n.ui.error=!1,n.ui.suspendEvents=!1)}},{key:"updateNodeType",value:function(t){this._paper.findViewByModel(this.model).el.removeEventListener("contextmenu",this._contextMenu._contextMenuEvent),this._paper.el.removeChild(this._contextMenuElement),this.addContextMenu(this._graphSchema.nodes[t].contextMenuItems)}},{key:"updatePosition",value:function(t){this.model.position(t.x,t.y)}},{key:"addEvent",value:function(t,e,i){var n=this,r=this._paper.findViewByModel(this.model);switch(t){case"updatePosition":r.on("element:pointerup",(function(){var t=n._graphView.getWindowToGraphPosition(r.el.getBoundingClientRect());e(n.nodeData.id,t)}));break;case"updateAttribute":document.querySelector("#nodediv_".concat(this.model.id)).querySelector("#input_".concat(i.name)).ui.on("change",(function(t){if("name"===i.name){var r=!1;Object.keys(n._graphView._graphData.get("data.nodes")).forEach((function(e){n._graphView._graphData.get("data.nodes")[e].name===t&&(r=!0)}));var s,a=document.querySelector("#nodediv_".concat(n.model.id)).querySelector("#input_".concat(i.name));if(r)return void(a.ui.error=!0);a.ui.error=!1,s=n.nodeSchema.outPorts||n.nodeSchema.inPorts?"".concat(n.nodeSchema.name," (").concat(t,")"):t,n.model.attr("label/text",s)}e(n.nodeData.id,i,t)}))}}},{key:"select",value:function(){this.model.attr({body:{stroke:"#F60",strokeWidth:1}}),this.state=t.STATES.SELECTED}},{key:"hover",value:function(){this.state!==t.STATES.SELECTED&&this.model.attr({body:{stroke:"rgba(255, 102, 0, 0.32)",strokeWidth:1}})}},{key:"hoverRemove",value:function(){this.state===t.STATES.DEFAULT?this.deselect():this.state===t.STATES.SELECTED&&this.select()}},{key:"deselect",value:function(){var e=this._graphSchema.nodes[this.nodeData.nodeType];this.model.attr("body/stroke",e.stroke),this.state=t.STATES.DEFAULT}}])&&pp(e.prototype,i),r&&pp(e,r),t}();mp.STATES={DEFAULT:0,SELECTED:1};var gp=mp,vp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAhGVYSWZNTQAqAAAACAAFARIAAwAAAAEAAQAAARoABQAAAAEAAABKARsABQAAAAEAAABSASgAAwAAAAEAAgAAh2kABAAAAAEAAABaAAAAAAAAASAAAAABAAABIAAAAAEAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAMqADAAQAAAABAAAAMgAAAAAgz5x9AAAACXBIWXMAACxLAAAsSwGlPZapAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAAJYklEQVRoBd1ZW2xcxRmec87aWbu+JbFJbCFiwCURUpukrURpARmJtmorQR5wJB5aCO8JeahUJ1XJIhHbUlW1ofELD01Q2xeM6l6QKvGShLiqeMEJeQkyCU6k4iQ22OvL2t7LmX7fzJnds8d7Lo4dqvaX9sztn3/+b/7LzDkrxP8JWZuG4+inbSLdfCBlWXulsLulEPssIdsgnz9FUliTWBA/95KU8nJJFM6Loc5Jb3hDxcaAQHm7se0VS4peISR+6yeAu2TJ0qmNgro7IGUA8ihUL+/4+mEEZljybMnNv3Y3Vlo3EPv47AlLbjKAAB5pWRl3YOtrge7IZnIg/VPdKWvLKH0/UuLmDU6W5OrTSa1jJ1nX+cXsi461ZfxLBEG1urmmc2zmQBIdY4HQlYQrz0LY5sVCEs00D9a0R5UOgTnIevBwSY9SXhUJxIuHTEDGl96ExpnU8dmMp7hgCeKDdaVPaIxok9qj69HaKiyIhqkxkZ4ZF3XZT0QqNyXswqIS4dY1iWJjpyi09ojV9v0i1/mEkHXN6xGPDO8eKg5uf4sAAqRME+hDE4FN/0QtkTs5ULj52oj4ys1/lBVfK3Rtz9IDPxTZPYdECQAT0lydtPavDG294eNXJlkDjQzOsS8+RdHNehTRAm1Xz4qma29HscWOLTzcJ+a+diSWjwzQ+pI7uO2brNKtPOvINTHiBVY3J0URrbDz3MsbBsE1aM3O9/oEZcYRdn5f6tj0CfABg/IxZQynaiJcyhbOX6r6ajTqshOi418/QwzcqjF6d12MpUbE10r7PuGmt0cLsey98pGfvpl57r6V8+fPk1dWAXGeOv4bAN0XJYW7ttkguB43l66avvOBWO58Mi4RpK2GxtVzJ398gVPx8wW7DnDGRihxIbrTeiyhE4wvTaLD+LZJncEFS407xdTTZwCmKThUaVtirpSd6BHDj82hs1SOEUfU9Va4atcY2OsBoaVUQLBtlDdlrZUcuGzr1d/XGqr0SdGWannoSG9vr4oR9eCofeyLcTRC3You1fXewYqgiBrPCbrHCs6KAnaXi/BcYWy1YjOSBDXFf/b9t2NSs3uhNNj+DFiLGkgCt9r24YA6J7hAGPGAm9vzklhCOkWa9IhLmJauM0u1Xj2DmNCHpeEMlknScuPn1zsW3vzWjHKtOLdiRuFhF0UEceeJNwDioE9trbjOkpytAS081CfufPeU4GkfRVwzDuzKtvufpQwFBMdKqEuRqWHqIotIysISvH7IMgzNrqB49yEECIMEGUqC96tifvehcJng4wbGre1KW+mugFjIy+EShdiCu1MYcbeLiINF5U5QUjHqJ0H5ncrIUHgwsvDw82Jle8geahHq3mbm1Swtexf7PYvI7ppMXmc9gjSMmH3m97zsDSNDqVo1INxey9mK6Zg6enqKVSSEKKqbC19bzcPHDpbaIkJ0q86QB9NhFGmXomoGgIkGtOlN3mTFodrGUlLdgqtk01wk8qGeWo5eG1vSSnYFhJUoMlfxMB76O0nvMp84pVUP9QEYmEGB8Pp0oRUuNuyo9JZB6DHOs3EIx1Abx1MxTImGlbLg1Mv7np5ilcOPYz5QRnE1E1Dpd6Q183R31NNYZC6KqVaarKRU7IbnemU7lBWkbkFbaLfyVBb1OCg1AaRvHvs4N/Ka4s1koYBARCQQ3n2CVNllpuexijUgzGysAhFQTjGiz8znia/7sIKZ6C1GHmbEaJI3OG6C/VIUc96LgTAe5npaQytHJcHJBxVWk4xVTAmd0c9fy8dnFUf5oSaXW6LQ9kilUasmSzfZrS0iNapafOxbwd3JEBcPEs8ZviXSAtqVghwaDreegA2cpuvvKLcsj3rA2TZ9oeeMWcJ1L7PqWURGWmRFvR/o64RZwMgx3tCCu1MKOd+4DMeNPdTeq51mj+6tn/9EtOACGaTgRi13PRVkqW4XVq+wQwEppaPfChnsSw/8qCzAv5jxBKbo+/75imjGLutxc6awNClY26L52juiY+yosItLCiM3gxukR3XJxbhmXLCXZq+/T169Jir44HAORS9+NYmZie/VSYjJIbsbd6+2HlFo6VFTUku3RPrWmGjAj67IDahS3Gv4Ad36wYj6hBS2ppSlj9yhjscxniufI3CJC/Dv3rBJzB4LuNk2J/hiwpvAtvEhLUppXN4vbD1VrZCKKfQFusViz8FIEJRgreaGd+zYYd2+fVu7FjvdtP1bFJFpeH5936AoFquZraayHgh0GWjsM1bQE/CWRItirThy5ibGCIKkYkTVMlvnIPSUqoc8GCt851jHBzUtqaJ/pQ2AfgAeC2TvFNNP/i7u4wPe0vN/an33hZtG1QoQ9CSxCndr5rGTycHQCrSKskwlrRrrGABUiCBmvj0Y61LkdaaunJyeni5PrwIiEliFQnhA0jL8lhtLHgATBCom0Gdcy5TaEqfVC1ecTCufG8j/4Xs3EB+CP5KRUzU37kOEYWbKbcHXDr6D1yLuulmgvHVgJBhjEY7PI7AZf0k+akvp3nSH2h8lAMQHxVLEklkHdR/1z+IjtuRrYZuvN7TK1ExAVe/1xqW8WX5Q7HLxjs+P2Is9fcksizmQkU3dHv9O/swzk2j6dQ8BAi6nf+YlYdlnUE1M5h2b54T6W2EJfysU+T6BP6RT/FthpzpbVtq/gc9Fd/G3wtL0C6U3dv/dU8gYOcIiHmeq//MM/k05kRjJPWS0irmB4q/uH/BcSq3Euuu6FoJ+0W+emmqkjgOM/O+CYXAXf10NAsqa+KDe4a7loVJA4WYH4Gb8hpkoZry5Gy4YE87y7M8Lp3r+WEuYL+Bz1el3LTdkSfHL9Om/8p8ibMHkWpZ70yPd4hX33x8+7gOhYqKjo8Pq6upSdcdxJMCozY51LQBBttRsmUzGej1/+NV76Wq0gu2unt7+1v5Bc/3wxYVyJ1/b7GKsa5FxDdh0/40HC1bTqxh60UjaaKkAlJaH6z8eHW7+4PWsAWHk+pWnVXynOvWLDXYFgu5lrIJJBpgFQLsKpYZe6ThHMK4+lJmFE5eyeNEq5C/WT4wO5/52OGsUZknyAHFN6QFQ/YFHJBD+Ie8HYOZacDHBH8jq6+sTIyMjljg8sctpaO5FUtgrbPvrmNmNi8guMpHgE7hZy6zllj4SLt6zS/nLWybffzf3559QeXUV15x6o6C08O26N6TGlHuZDo8v+rO+Yf5fKP8Dv3QCcfozpmMAAAAASUVORK5CYII=";function _p(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}l.connectors.smoothInOut=function(t,e,i,n){var r=t.clone();r.offset(30,0);var s=e.clone();s.offset(-30,0);var a=new l.g.Path(l.g.Path.createSegment("M",t));return a.appendSegment(l.g.Path.createSegment("C",r,s,e)),a};var yp=function(){function t(e,i,n,r,s,a,o){var l=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._graphView=e,this._paper=i,this._graph=n,this._graphSchema=r,this.edgeData=s,this._edgeSchema=a,this.state=t.STATES.DEFAULT;var h=t.createLink(a,s),c=this._graphView.getNode(s.from);s&&Number.isFinite(s.outPort)?h.source({id:c.model.id,port:"out".concat(s.outPort)}):h.source(c.model);var u=this._graphView.getNode(s.to);s&&Number.isFinite(s.inPort)?h.target({id:u.model.id,port:"in".concat(s.inPort)}):h.target(u.model);var d=function(){l._paper.findViewByModel(h).on("cell:pointerdown",(function(){o(s)})),s&&Number.isFinite(s.inPort)&&l._graphView.updatePortStatesForEdge(h,!0),h.toBack()};this._graphView._batchingCells?(this._graphView._cells.push(h),this._graphView._cellMountedFunctions.push(d)):(this._graph.addCell(h),d()),this.model=h}var e,i,r;return e=t,r=[{key:"createLink",value:function(t,e){var i=new l.shapes.standard.Link;return i.attr({line:{strokeWidth:t.strokeWidth||1,stroke:t.stroke}}),t.smooth?i.set("connector",{name:"smooth"}):t.smoothInOut&&i.set("connector",{name:"smoothInOut"}),e&&Number.isFinite(e.outPort)?(i.attr("line/targetMarker",null),i):(t.targetMarker?i.attr("line/targetMarker",{type:"path",d:"m1.18355,0.8573c-0.56989,-0.39644 -0.57234,-1.2387 -0.00478,-1.63846l7.25619,-5.11089c0.66255,-0.46663 1.57585,0.00721 1.57585,0.81756l0,10.1587c0,0.8077 -0.908,1.2821 -1.57106,0.8209l-7.2562,-5.04781z",stroke:t.targetMarkerStroke||t.stroke,fill:t.targetMarkerStroke||t.stroke}):i.attr("line/targetMarker",null),i.attr("line/sourceMarker",{type:"image","xlink:href":vp,width:12,height:12,y:-6,x:-6}),i)}}],(i=[{key:"addContextMenu",value:function(t){if(!this._graphView._config.readOnly){var e=this._paper.findViewByModel(this.model);if(e){var i=document.createElement("div");this._paper.el.appendChild(i),new n.ContextMenu({triggerElement:e.el,dom:i,items:t})}}}},{key:"select",value:function(){this.model.attr("line/stroke","#F60"),this.model.attr("line/targetMarker",{stroke:"#F60",fill:"#F60"}),this.model.attr("line/sourceMarker",{stroke:"#F60",fill:"#F60"}),this.model.attr("line/sourceMarker/xlink:href","data:image/png;base64,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"),this.state=t.STATES.SELECTED}},{key:"deselect",value:function(){var e=this._edgeSchema;this.model.attr("line/stroke",e.stroke),this.model.attr("line/strokeWidth",e.strokeWidth||1),this.model.attr("line/targetMarker",{stroke:e.targetMarkerStroke||e.stroke,fill:e.targetMarkerStroke||e.stroke}),this.model.attr("line/sourceMarker",{stroke:e.targetMarkerStroke||e.stroke,fill:e.targetMarkerStroke||e.stroke}),this.model.attr("line/sourceMarker/xlink:href",vp),this.state=t.STATES.DEFAULT}},{key:"mute",value:function(){var t=this._edgeSchema;this.model.attr("line/stroke","#42495B"),this.model.attr("line/strokeWidth",t.strokeWidth||1),this.model.attr("line/targetMarker",{stroke:"#9BA1A3",fill:"#9BA1A3"}),this.model.attr("line/sourceMarker",{stroke:"#9BA1A3",fill:"#9BA1A3"}),this.model.attr("line/sourceMarker/xlink:href","data:image/png;base64,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")}},{key:"addSourceMarker",value:function(){var t=this._edgeSchema;this.model.attr("line/sourceMarker",{type:"path",d:"m-2.57106,0.93353c-0.56989,-0.39644 -0.57234,-1.2387 -0.00478,-1.63846l7.25619,-5.11089c0.66251,-0.46663 1.57585,0.00721 1.57585,0.81756l0,10.1587c0,0.8077 -0.90803,1.2821 -1.57106,0.8209l-7.2562,-5.04781z",stroke:t.targetMarkerStroke||t.stroke,fill:t.targetMarkerStroke||t.stroke})}},{key:"addTargetMarker",value:function(){var t=this._edgeSchema;this.model.attr("line/targetMarker",{type:"path",d:"m-2.57106,0.93353c-0.56989,-0.39644 -0.57234,-1.2387 -0.00478,-1.63846l7.25619,-5.11089c0.66251,-0.46663 1.57585,0.00721 1.57585,0.81756l0,10.1587c0,0.8077 -0.90803,1.2821 -1.57106,0.8209l-7.2562,-5.04781z",stroke:t.targetMarkerStroke||t.stroke,fill:t.targetMarkerStroke||t.stroke})}}])&&_p(e.prototype,i),r&&_p(e,r),t}();yp.STATES={DEFAULT:0,SELECTED:1};var bp=yp;function xp(t){return(xp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wp(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ap(t,e){return(Ap=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Cp(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Sp(t);if(e){var r=Sp(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Ip(this,i)}}function Ip(t,e){return!e||"object"!==xp(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Sp(t){return(Sp=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Mp="EVENT_UPDATE_TRANSLATE",Tp="EVENT_UPDATE_SCALE",Pp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ap(t,e)}(a,t);var e,i,r,s=Cp(a);function a(t,e,i,n,r){var o,h;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(o=s.call(this,e,r))._parent=t,o._dom=e,o._graphSchema=i,o._graphData=n,o._config=r,o._nodes={},o._edges={},o._cells=[],o._cellMountedFunctions=[],l.shapes.html={},l.shapes.html.Element=l.shapes.standard.Rectangle.extend({defaults:l.util.deepSupplement({type:"html.Element",markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"labelBackground"},{tagName:"text",selector:"icon"},{tagName:"text",selector:"label"},{tagName:"image",selector:"texture"}]},l.shapes.standard.Rectangle.prototype.defaults)}),l.shapes.html.ElementView=(h=o._paper,l.dia.ElementView.extend({initialize:function(){var t=this;_.bindAll(this,"updateBox"),l.dia.ElementView.prototype.initialize.apply(this,arguments),this.div=document.createElement("div"),this.div.setAttribute("id","nodediv_".concat(this.model.id)),this.div.classList.add("graph-node-div"),this.model.on("change",this.updateBox,this),h.on("cell:mousewheel",this.updateBox,this),h.on("blank:mousewheel",this.updateBox,this),h.on("blank:pointerup",this.updateBox,this),document.addEventListener("mousemove",(function(e){t.updateBox()})),this.model.on("remove",this.removeBox,this),this.updateBox()},render:function(){return l.dia.ElementView.prototype.render.apply(this,arguments),h.$el.append(this.div),this.updateBox(),this},updateBox:function(){var t=this.model.getBBox();this.div.setAttribute("style","\n            position: absolute;\n            width: ".concat(t.width,"px;\n            height: ").concat(t.height,"px;\n            left: ").concat(t.width/2*h.scale().sx,"px;\n            top: ").concat(t.height/2*h.scale().sx,"px;\n            transform: translate(").concat(h.translate().tx+h.scale().sx*t.x-t.width/2,"px, ").concat(h.translate().ty+h.scale().sx*t.y-t.height/2,"px) scale(").concat(h.scale().sx,");\n        "))},removeBox:function(t){this.div.remove()}})),o._graph.on("remove",(function(t){return o.updatePortStatesForEdge(t,!1)})),o._graph.on("change:target",(function(t){return o.updatePortStatesForEdge(t,!0)})),o._paper.on("cell:mousewheel",(function(){t.dom.dispatchEvent(new CustomEvent(Tp,{detail:{scale:o._paper.scale().sx}}))})),o._paper.on("blank:mousewheel",(function(){t.dom.dispatchEvent(new CustomEvent(Tp,{detail:{scale:o._paper.scale().sx}}))})),o._paper.on("blank:pointerup",(function(){t.dom.dispatchEvent(new CustomEvent(Mp,{detail:{pos:{x:o._paper.translate().tx,y:o._paper.translate().ty}}}))})),o._paper.on({"cell:mouseenter":function(t){var e,i,n=o.getNode(t.model.id);n&&n.state!==gp.STATES.SELECTED&&(n.hover(),(e=o._parent._selectedItem&&"EDGE"===o._parent._selectedItem._type?o.getEdge(o._parent._selectedItem._id):null)&&(i=e.model.id),o._config.edgeHoverEffect&&Object.keys(o._edges).forEach((function(t){var e=o.getEdge(t);e.model.id!==i&&([e.edgeData.from,e.edgeData.to].includes(n.nodeData.id)?e.deselect():e.mute())})));var r=o.getEdge(t.model.id);o._config.edgeHoverEffect&&r&&r.state!==bp.STATES.SELECTED&&(r.deselect(),(e=o._parent._selectedItem&&"EDGE"===o._parent._selectedItem._type?o.getEdge(o._parent._selectedItem._id):null)&&(i=e.model.id),Object.keys(o._edges).forEach((function(t){var e=o.getEdge(t);r.model.id!==e.model.id&&i!==e.model.id&&e.mute()})),o.getNode(r.edgeData.from).hover(),o.getNode(r.edgeData.to).hover())},"cell:mouseleave":function(t,e){var i;if(!e.relatedTarget||!e.relatedTarget.classList.contains("graph-node-input")){var n=o.getNode(t.model.id);n&&n.state!==gp.STATES.SELECTED&&((i=o._parent._selectedItem&&"EDGE"===o._parent._selectedItem._type?o.getEdge(o._parent._selectedItem._id):null)&&[i.edgeData.from,i.edgeData.to].includes(n.nodeData.id)||n.hoverRemove(),o._config.edgeHoverEffect&&Object.keys(o._edges).forEach((function(t){var e=o.getEdge(t);i&&e.model.id===i.model.id||e.deselect()})));var r=o.getEdge(t.model.id);o._config.edgeHoverEffect&&r&&r.state!==bp.STATES.SELECTED&&(Object.keys(o._edges).forEach((function(t){var e=o.getEdge(t);e.state===bp.STATES.SELECTED?e.select():e.state===bp.STATES.DEFAULT&&(o._parent._selectedItem&&"EDGE"===o._parent._selectedItem._type?e.mute():e.deselect())})),(i=o._parent._selectedItem&&"EDGE"===o._parent._selectedItem._type?o.getEdge(o._parent._selectedItem._id):null)&&[i.edgeData.from,i.edgeData.to].includes(r.edgeData.from)||o.getNode(r.edgeData.from).hoverRemove(),i&&[i.edgeData.from,i.edgeData.to].includes(r.edgeData.to)||o.getNode(r.edgeData.to).hoverRemove())}}}),o}return e=a,(i=[{key:"batchCells",value:function(){this._batchingCells=!0}},{key:"isBatchingCells",value:function(){return this._batchingCells}},{key:"addCellMountedFunction",value:function(t){this._cellMountedFunctions.push(t)}},{key:"applyBatchedCells",value:function(){this._batchingCells=!1,this._graph.addCells(this._cells),this._cellMountedFunctions.forEach((function(t){return t()})),this._cells=[],this._cellMountedFunctions=[]}},{key:"updatePortStatesForEdge",value:function(t,e){var i=t.get("source"),n=t.get("target");i&&i.port&&n&&n.port&&(this._paper.findViewByModel(i.id)._portElementsCache[i.port].portContentElement.children()[1].attr("visibility",e?"visible":"hidden"),this._paper.findViewByModel(n.id)._portElementsCache[n.port].portContentElement.children()[1].attr("visibility",e?"visible":"hidden"))}},{key:"getGraphPosition",value:function(t){var e=this._paper.el.getBoundingClientRect();return new W((t.x-e.x)/this._paper.scale().sx,(t.y-e.y)/this._paper.scale().sx)}},{key:"getWindowToGraphPosition",value:function(t){var e=this._paper.scale().sx,i=this._paper.translate(),n=this._paper.el.getBoundingClientRect();return new W(-i.tx/e+(t.x-n.x)/e,-i.ty/e+(t.y-n.y)/e)}},{key:"addCanvasContextMenu",value:function(t){this._viewContextMenu=document.createElement("div"),this._paper.el.appendChild(this._viewContextMenu);var e=new n.ContextMenu({dom:this._viewContextMenu,items:t});return window.contextMenu=e,e._contextMenuEvent}},{key:"addNodeContextMenu",value:function(t,e){var i=this,n=function(){i.getNode(t).addContextMenu(e)};this._batchingCells?this._cellMountedFunctions.push(n):n()}},{key:"addEdgeContextMenu",value:function(t,e){this.getEdge(t).addContextMenu(e)}},{key:"getNode",value:function(t){return this._nodes[t]}},{key:"addNode",value:function(t,e,i,n,r){var s=new gp(this,this._paper,this._graph,this._graphSchema,t,e,i,n,r);return this._nodes[t.id]=s,this._nodes[s.model.id]=s,s.nodeData}},{key:"removeNode",value:function(t){var e=this.getNode(t);this._graph.removeCells(e.model),delete this._nodes[e.nodeData.id],delete this._nodes[t]}},{key:"updateNodeAttribute",value:function(t,e,i){this.getNode(t).updateAttribute(e,i)}},{key:"updateNodePosition",value:function(t,e){this.getNode(t).updatePosition(e)}},{key:"updateNodeType",value:function(t,e){this.getNode(t).updateNodeType(e)}},{key:"addNodeEvent",value:function(t,e,i,n){var r=this,s=function(){r.getNode(t).addEvent(e,i,n)};this._batchingCells?this._cellMountedFunctions.push(s):s()}},{key:"getEdge",value:function(t){if(this._edges[t])return this._edges[t]}},{key:"addEdge",value:function(t,e,i){var n;return(n=Number.isFinite(t.outPort)?this.getEdge("".concat(t.from,",").concat(t.outPort,"-").concat(t.to,",").concat(t.inPort)):this.getEdge("".concat(t.from,"-").concat(t.to)))?t.to===n.edgeData.to?t.outPort||n.addTargetMarker():t.inPort||n.addSourceMarker():(n=new bp(this,this._paper,this._graph,this._graphSchema,t,e,i),Number.isFinite(t.outPort)?this._edges["".concat(t.from,",").concat(t.outPort,"-").concat(t.to,",").concat(t.inPort)]=n:this._edges["".concat(t.from,"-").concat(t.to)]=n,this._edges[n.model.id]=n),n.edgeData}},{key:"removeEdge",value:function(t){var e=this.getEdge(t);e&&(this._graph.removeCells(e.model),delete this._edges[e.model.id]),delete this._edges[t]}},{key:"disableInputEvents",value:function(){document.querySelectorAll(".graph-node-input").forEach((function(t){t.classList.add("graph-node-input-no-pointer-events")}))}},{key:"enableInputEvents",value:function(){document.querySelectorAll(".graph-node-input").forEach((function(t){t.classList.remove("graph-node-input-no-pointer-events")}))}},{key:"addUnconnectedEdge",value:function(t,e,i,n,r){var s=this;this.disableInputEvents();var a=bp.createLink(i);a.source(this.getNode(t).model),a.target(this.getNode(t).model);var o=function(e){var i=s.getWindowToGraphPosition(new W(e.clientX,e.clientY)),n=s._paper.findViewByModel(s.getNode(t).model),r=s.getGraphPosition(n.el.getBoundingClientRect()),o=i.clone().sub(r),l=new W(e.clientX,e.clientY).clone().sub(n.el.getBoundingClientRect()).normalize().scale(20);o=r.add(o).sub(l),a.target({x:o.x,y:o.y})},l=function i(l){if(s.getNode(l.model.id)){var h=s.getNode(l.model.id).nodeData.id,c=s.getNode(t).model;l.model.id!==c.id&&!l.model.isLink()&&n(e,t,h)&&(a.target(l.model),r(e,t,h)),s._graph.removeCells(a),document.removeEventListener("mousemove",o),s._paper.off("cell:pointerdown",i),s.enableInputEvents()}};document.addEventListener("mousemove",o),document.addEventListener("mousedown",(function(){s._paper.off("cell:pointerdown",l),document.removeEventListener("mousemove",o),s._graph.removeCells(a),s.enableInputEvents()})),this._paper.on("cell:pointerdown",l),this._graph.addCell(a)}},{key:"onBlankSelection",value:function(t){this._paper.on("blank:pointerdown",(function(){t()}))}},{key:"selectNode",value:function(t){var e=this,i=this.getNode(t);i&&(i.select(),Object.keys(this._edges).forEach((function(t){e.getEdge(t).deselect()})))}},{key:"deselectNode",value:function(t){var e=this.getNode(t);e&&e.deselect()}},{key:"selectEdge",value:function(t){var e=this,i=this.getEdge(t);i&&(i.select(),Object.keys(this._edges).forEach((function(t){var n=e.getEdge(t);i.model.id!==n.model.id&&n.mute()})),this.getNode(i.edgeData.from).hover(),this.getNode(i.edgeData.to).hover())}},{key:"deselectEdge",value:function(t){var e=this,i=this.getEdge(t);i&&(Object.keys(this._edges).forEach((function(t){e.getEdge(t).deselect()})),this.getNode(i.edgeData.from).hoverRemove(),this.getNode(i.edgeData.to).hoverRemove())}},{key:"setGraphPosition",value:function(t,e){this._paper.translate(t,e)}},{key:"getGraphPosition",value:function(){var t=this._paper.translate();return new W([t.tx,t.ty])}},{key:"setGraphScale",value:function(t){this._paper.scale(t)}},{key:"getGraphScale",value:function(){return this._paper.scale().sx}}])&&wp(e.prototype,i),r&&wp(e,r),a}(fp);i(41);function Ep(t){return(Ep="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kp(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Dp(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?kp(Object(i),!0).forEach((function(e){Op(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):kp(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Op(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Rp(t,e){return(Rp=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Lp(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=Bp(t);if(e){var r=Bp(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return Np(this,i)}}function Np(t,e){return!e||"object"!==Ep(e)&&"function"!=typeof e?zp(t):e}function zp(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Bp(t){return(Bp=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fp(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jp(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vp(t,e,i){return e&&jp(t.prototype,e),i&&jp(t,i),t}var Up={ADD_NODE:"EVENT_ADD_NODE",DELETE_NODE:"EVENT_DELETE_NODE",SELECT_NODE:"EVENT_SELECT_NODE",UPDATE_NODE_POSITION:"EVENT_UPDATE_NODE_POSITION",UPDATE_NODE_ATTRIBUTE:"EVENT_UPDATE_NODE_ATTRIBUTE",ADD_EDGE:"EVENT_ADD_EDGE",DELETE_EDGE:"EVENT_DELETE_EDGE",SELECT_EDGE:"EVENT_SELECT_EDGE",DESELECT_ITEM:"EVENT_DESELECT_ITEM",UPDATE_TRANSLATE:"EVENT_UPDATE_TRANSLATE",UPDATE_SCALE:"EVENT_UPDATE_SCALE"},Gp={edgeHoverEffect:!0,passiveUIEvents:!1,readOnly:!1,restrictTranslate:!1,incrementNodeNames:!1},Wp=function(){function t(e,i,n,r){Fp(this,t),this._graph=e,this._type=i,this._id=n,this._edgeId=r}return Vp(t,[{key:"selectItem",value:function(){switch(this._type){case"NODE":this._graph.view.selectNode(this._id);break;case"EDGE":this._graph.view.selectEdge(this._id)}}},{key:"deselectItem",value:function(){switch(this._type){case"NODE":this._graph.view.deselectNode(this._id);break;case"EDGE":this._graph.view.deselectEdge(this._id)}}},{key:"type",get:function(){return this._type}},{key:"id",get:function(){return this._id}},{key:"edgeId",get:function(){return this._edgeId}}]),t}(),Hp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rp(t,e)}(i,t);var e=Lp(i);function i(t){var n;return Fp(this,i),t||(t={}),(n=e.call(this,t.dom?t.dom:document.createElement("div"),t)).class.add("pcui-graph"),n.diff=s.diff,n._graphData=new r.Observer({data:t.graphData}),n._graphSchema=t.graphSchema,n._contextMenuItems=t.contextMenuItems,n._suppressGraphDataEvents=!1,n._config=Dp(Dp({},Gp),t.config),n._config.readOnly&&(n._config.passiveUIEvents=!0),n.view=new Pp(zp(n),n.dom,n._graphSchema,n._graphData,n._config),n._buildGraphFromData(),n._config.readOnly||n._addCanvasContextMenu(),n._selectedItem=null,n.view.onBlankSelection((function(){n.deselectItem()})),n}return Vp(i,[{key:"_buildGraphFromData",value:function(){var t=this;this.view.batchCells(),Object.keys(this._graphData.get("data.nodes")).forEach((function(e){var i=t._graphData.get("data.nodes.".concat(e)),n=t._graphSchema.nodes[i.nodeType];n.attributes&&(n.attributes&&!i.attributes&&(i.attributes={}),n.attributes.forEach((function(n){!i.attributes[n.name]&&n.defaultValue&&(t._suppressGraphDataEvents=!0,t._graphData.set("data.nodes.".concat(e,".attributes.").concat(n.name),n.defaultValue),t._suppressGraphDataEvents=!1)}))),t.createNode(t._graphData.get("data.nodes.".concat(e)),void 0,!0)})),Object.keys(this._graphData.get("data.edges")).forEach((function(e){t.createEdge(t._graphData.get("data.edges.".concat(e)),e,!0)})),this.view.applyBatchedCells()}},{key:"_addCanvasContextMenu",value:function(){var t=this,e=function(e){switch(e.action){case Up.ADD_NODE:e.onClick=function(i){var n=Dp(Dp({},e),{},{id:Number("".concat(Date.now()).concat(Math.floor(1e4*Math.random())))});e.attributes&&(n.attributes=Dp({},e.attributes)),delete n.action,delete n.text,delete n.onClick;var r=t._graphSchema.nodes[n.nodeType];r.attributes&&!n.attributes&&(n.attributes={}),r.attributes&&r.attributes.forEach((function(t){!n.attributes[t.name]&&t.defaultValue&&(n.attributes[t.name]=t.defaultValue)})),t._config.incrementNodeNames&&n.attributes.name&&(n.attributes.name="".concat(n.attributes.name," ").concat(Object.keys(t._graphData.get("data.nodes")).length));for(var s=i.target;!s.classList.contains("pcui-contextmenu");)s=s.parentElement;var a={x:Number(s.style.left.replace("px","")),y:Number(s.style.top.replace("px",""))};a=t.getWindowToGraphPosition(a),n.posX=a.x,n.posY=a.y,t._config.passiveUIEvents?t.dom.dispatchEvent(new CustomEvent(Up.ADD_NODE,{detail:n})):(t.createNode(n),t._graphData.set("data.nodes.".concat(n.id),n),t.selectNode(n))}}return e},i=this._contextMenuItems.map((function(t){return(t=e(t)).items?(t.items.map((function(t){return e(t)})),t):t}));this.view.addCanvasContextMenu(i)}},{key:"selectNode",value:function(t,e){var i=this._selectedItem;i&&"NODE"===i.type&&i._id===t.id||(this.deselectItem(),e||this.dom.dispatchEvent(new CustomEvent(Up.SELECT_NODE,{detail:{node:t,prevItem:i}})),this._selectedItem=new Wp(this,"NODE",t.id),this._selectedItem.selectItem())}},{key:"selectEdge",value:function(t,e,i){var n=this._selectedItem;this.deselectItem(),i||this.dom.dispatchEvent(new CustomEvent(Up.SELECT_EDGE,{detail:{edge:t,edgeId:e,prevItem:n}})),this._selectedItem=new Wp(this,"EDGE","".concat(t.from,"-").concat(t.to),e),this._selectedItem.selectItem()}},{key:"deselectItem",value:function(t){this._selectedItem&&(t||this.dom.dispatchEvent(new CustomEvent(Up.DESELECT_ITEM,{detail:{type:this._selectedItem._type,id:this._selectedItem._id,edgeId:this._selectedItem._edgeId}})),this._selectedItem.deselectItem(),this._selectedItem=null)}},{key:"_isValidEdge",value:function(t,e,i){var n=this._graphSchema.edges[t];return n.from.includes(this._graphData.get("data.nodes.".concat(e,".nodeType")))&&n.to.includes(this._graphData.get("data.nodes.".concat(i,".nodeType")))}},{key:"createEdge",value:function(t,e,i){var n=this,r=this._graphSchema.edges[t.edgeType];this.view.addEdge(t,r,(function(t){n.selectEdge(t,e)}));var s=o(r.contextMenuItems).map((function(t){return t.action===Up.DELETE_EDGE&&(t.onClick=function(){n._config.passiveUIEvents?n.dom.dispatchEvent(new CustomEvent(Up.DELETE_EDGE,{detail:{edgeId:e,edge:n._graphData.get("data.edges.".concat(e))}})):n.deleteEdge(e)}),t})),a=function(){Number.isFinite(t.outPort)?n.view.addEdgeContextMenu("".concat(t.from,",").concat(t.outPort,"-").concat(t.to,",").concat(t.inPort),s):n.view.addEdgeContextMenu("".concat(t.from,"-").concat(t.to),s)};this.view.isBatchingCells()?this.view.addCellMountedFunction(a):a(),this._graphData.get("data.edges.".concat(e))||this._graphData.set("data.edges.".concat(e),t),i||this.dom.dispatchEvent(new CustomEvent(Up.ADD_EDGE,{detail:{edge:t,edgeId:e}}))}},{key:"onEdgeConnected",value:function(t,e,i){var n=Number("".concat(Date.now()).concat(Math.floor(1e4*Math.random()))),r={from:e,to:i,edgeType:t,conditions:{}};this._config.passiveUIEvents?this.dom.dispatchEvent(new CustomEvent(Up.ADD_EDGE,{detail:{edge:r,edgeId:n}})):(this.createEdge(r,n),this.suppressNodeSelect=!0,this.selectEdge(r,n))}},{key:"_createUnconnectedEdgeForNode",value:function(t,e){var i=this._graphSchema.edges[e];this.view.addUnconnectedEdge(t.id,e,i,this._isValidEdge.bind(this),this.onEdgeConnected.bind(this))}},{key:"onCreateEdge",value:function(t,e){var i=this;this._config.passiveUIEvents?this.dom.dispatchEvent(new CustomEvent(Up.ADD_EDGE,{detail:{edge:e,edgeId:t}})):(Number.isFinite(e.inPort)&&Object.keys(this._graphData.get("data.edges")).forEach((function(t){var n=i._graphData.get("data.edges.".concat(t));n.to===e.to&&n.inPort===e.inPort&&i.deleteEdge(t)})),this.createEdge(e,t))}},{key:"onNodeSelected",value:function(t){this.suppressNodeSelect?this.suppressNodeSelect=!1:(this.dom.dispatchEvent(new CustomEvent(Up.SELECT_NODE,{detail:{node:t,prevItem:this._selectedItem}})),this._selectedItem&&this._selectedItem.deselectItem(),this._selectedItem=new Wp(this,"NODE",t.id),this._selectedItem.selectItem())}},{key:"onNodePositionUpdated",value:function(t,e){var i=this._graphData.get("data.nodes.".concat(t)),n=i.posX,r=i.posY;e.x===i.posX&&e.y===i.posY||(i.posX=e.x,i.posY=e.y,this._config.passiveUIEvents?this.updateNodePosition(t,{x:n,y:r}):this._graphData.set("data.nodes.".concat(t),i),this.dom.dispatchEvent(new CustomEvent(Up.UPDATE_NODE_POSITION,{detail:i})))}},{key:"_onNodeAttributeUpdated",value:function(t,e,i){var n,r=this._graphData.get("data.nodes.".concat(t)),s=void 0!==r.attributes[e.name]?e.name:void 0;if(s||Object.keys(r.attributes).forEach((function(t){r.attributes[t].name===e.name&&(s=t)})),n=Number.isFinite(r.attributes[s].x)?Dp({},r.attributes[s]):r.attributes[s],Array.isArray(i)){var a=["x","y","z","w"];i.forEach((function(t,e){r.attributes[s][a[e]]=t}))}else Object.keys(n).includes("x")&&Number.isFinite(i)?r.attributes[s].x=i:r.attributes[s]=i;JSON.stringify(r.attributes[s])!==JSON.stringify(n)&&(this._config.passiveUIEvents?this.updateNodeAttribute(t,e.name,n):this._graphData.set("data.nodes.".concat(t),r),this.dom.dispatchEvent(new CustomEvent(Up.UPDATE_NODE_ATTRIBUTE,{detail:{node:r,attribute:e.name,attributeKey:s}})))}},{key:"initialiseNodeContextMenuItems",value:function(t,e){var i=this;return o(e).map((function(e){return e.action===Up.ADD_EDGE&&(e.onClick=function(){return i._createUnconnectedEdgeForNode(t,e.edgeType)}),e.action===Up.DELETE_NODE&&(e.onClick=function(){return i.deleteNode(t.id,!1,i._config.passiveUIEvents)}),e}))}},{key:"createNode",value:function(t,e,i){var n=this,r=this._graphSchema.nodes[t.nodeType];t=this.view.addNode(t,r,e,this.onCreateEdge.bind(this),this.onNodeSelected.bind(this)),this._graphData.get("data.nodes.".concat(t.id))||this._graphData.set("data.nodes.".concat(t.id),t),i||this.dom.dispatchEvent(new CustomEvent(Up.ADD_NODE,{detail:t})),this.view.addNodeEvent(t.id,"updatePosition",this.onNodePositionUpdated.bind(this)),r.attributes&&r.attributes.forEach((function(e){n.view.addNodeEvent(t.id,"updateAttribute",n._onNodeAttributeUpdated.bind(n),e)}));var s=this.initialiseNodeContextMenuItems(t,r.contextMenuItems);this.view.addNodeContextMenu(t.id,s)}},{key:"updateNodePosition",value:function(t,e){this._graphData.get("data.nodes.".concat(t))&&(this._graphData.set("data.nodes.".concat(t,".posX"),e.x),this._graphData.set("data.nodes.".concat(t,".posY"),e.y),this.view.updateNodePosition(t,e))}},{key:"updateNodeAttribute",value:function(t,e,i){this._graphData.get("data.nodes.".concat(t))&&(this._graphData.set("data.nodes.".concat(t,".attributes.").concat(e),i),this.view.updateNodeAttribute(t,e,i))}},{key:"updateNodeType",value:function(t,e){Number.isFinite(e)&&this._graphData.get("data.nodes.".concat(t))&&(this._graphData.set("data.nodes.".concat(t,".nodeType"),e),this.view.updateNodeType(t,e))}},{key:"deleteNode",value:function(t,e,i){if(this._graphData.get("data.nodes.".concat(t))){this._selectedItem&&this._selectedItem._id===t&&this.deselectItem(),i||this.view.removeNode(t);var n=this._graphData.get("data.nodes.".concat(t));i||this._graphData.unset("data.nodes.".concat(t));for(var r=[],s={},a=Object.keys(this._graphData.get("data.edges")),o=0;o<a.length;o++){var l=this._graphData.get("data.edges.".concat(a[o]));s[a[o]]=l,l.from!==t&&l.to!==t||(i||this._graphData.unset("data.edges.".concat(a[o])),r.push(a[o]),i||this.view.removeEdge("".concat(l.from,"-").concat(l.to)))}return e||this.dom.dispatchEvent(new CustomEvent(Up.DELETE_NODE,{detail:{node:n,edges:r}})),{node:n,edges:r,edgeData:s}}}},{key:"deleteEdge",value:function(t,e){var i=this;if(this._graphData.get("data.edges.".concat(t))){var n=this._graphData.get("data.edges.".concat(t))||{},r=n.from,s=n.to,a=n.outPort,o=n.inPort;this._selectedItem&&this._selectedItem._id==="".concat(r,"-").concat(s)&&this.deselectItem(),Number.isFinite(a)?this.view.removeEdge("".concat(r,",").concat(a,"-").concat(s,",").concat(o)):this.view.removeEdge("".concat(r,"-").concat(s)),this.view.removeEdge("".concat(r,"-").concat(s)),e||this.dom.dispatchEvent(new CustomEvent(Up.DELETE_EDGE,{detail:{edgeId:t,edge:this._graphData.get("data.edges.".concat(t))}})),this._graphData.unset("data.edges.".concat(t));var l=this._graphData.get("data.edges");Object.keys(l).forEach((function(t){var e=l[t],n=i._graphSchema.edges[e.edgeType];[e.from,e.to].includes(r)&&[e.from,e.to].includes(s)&&(i.view.addEdge(e,n,(function(e){i.selectEdge(e,t)})),i.selectEdge(e,t))}))}}},{key:"setGraphPosition",value:function(t,e){this.view.setGraphPosition(t,e)}},{key:"getGraphPosition",value:function(){return this.view.getGraphPosition()}},{key:"setGraphScale",value:function(t){var e=this;this.view.setGraphScale(t),Object.keys(this.view._nodes).forEach((function(t){e.view._paper.findViewByModel(e.view._nodes[t].model).updateBox()}))}},{key:"getGraphScale",value:function(){return this.view.getGraphScale()}},{key:"getWindowToGraphPosition",value:function(t){return this.view.getWindowToGraphPosition(t)}},{key:"getGraphPosition",value:function(t){return this.view.getGraphPosition(t)}},{key:"on",value:function(t,e){(!this._config.readOnly||t.includes("EVENT_SELECT_")||t.includes("EVENT_DESELECT"))&&this.dom.addEventListener(t,(function(t){e(t.detail)}))}},{key:"selectedItem",get:function(){return this._selectedItem}}]),i}(n.Element);Hp.GRAPH_ACTIONS=Up;var Xp=Hp}])}));